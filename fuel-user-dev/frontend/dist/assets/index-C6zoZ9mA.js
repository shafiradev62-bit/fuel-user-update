var V3=Object.defineProperty;var qA=e=>{throw TypeError(e)};var U3=(e,i,d)=>i in e?V3(e,i,{enumerable:!0,configurable:!0,writable:!0,value:d}):e[i]=d;var ZA=(e,i,d)=>U3(e,typeof i!="symbol"?i+"":i,d),XS=(e,i,d)=>i.has(e)||qA("Cannot "+d);var qs=(e,i,d)=>(XS(e,i,"read from private field"),d?d.call(e):i.get(e)),wl=(e,i,d)=>i.has(e)?qA("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(e):i.set(e,d),jo=(e,i,d,j)=>(XS(e,i,"write to private field"),j?j.call(e,d):i.set(e,d),d),Qu=(e,i,d)=>(XS(e,i,"access private method"),d);var XE=(e,i,d,j)=>({set _(_e){jo(e,i,_e,d)},get _(){return qs(e,i,j)}});function _mergeNamespaces(e,i){for(var d=0;d<i.length;d++){const j=i[d];if(typeof j!="string"&&!Array.isArray(j)){for(const _e in j)if(_e!=="default"&&!(_e in e)){const nt=Object.getOwnPropertyDescriptor(j,_e);nt&&Object.defineProperty(e,_e,nt.get?nt:{enumerable:!0,get:()=>j[_e]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const _e of document.querySelectorAll('link[rel="modulepreload"]'))j(_e);new MutationObserver(_e=>{for(const nt of _e)if(nt.type==="childList")for(const ct of nt.addedNodes)ct.tagName==="LINK"&&ct.rel==="modulepreload"&&j(ct)}).observe(document,{childList:!0,subtree:!0});function d(_e){const nt={};return _e.integrity&&(nt.integrity=_e.integrity),_e.referrerPolicy&&(nt.referrerPolicy=_e.referrerPolicy),_e.crossOrigin==="use-credentials"?nt.credentials="include":_e.crossOrigin==="anonymous"?nt.credentials="omit":nt.credentials="same-origin",nt}function j(_e){if(_e.ep)return;_e.ep=!0;const nt=d(_e);fetch(_e.href,nt)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var jsxRuntime={exports:{}},reactJsxRuntime_production_min={},react={exports:{}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$1=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),t=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$3=Symbol.for("react.forward_ref"),w$1=Symbol.for("react.suspense"),x=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(e){return e===null||typeof e!="object"?null:(e=z$1&&e[z$1]||e["@@iterator"],typeof e=="function"?e:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(e,i,d){this.props=e,this.context=i,this.refs=D$1,this.updater=d||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(e,i){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,i,"setState")};E$1.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(e,i,d){this.props=e,this.context=i,this.refs=D$1,this.updater=d||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$2(e,i,d){var j,_e={},nt=null,ct=null;if(i!=null)for(j in i.ref!==void 0&&(ct=i.ref),i.key!==void 0&&(nt=""+i.key),i)J.call(i,j)&&!L$1.hasOwnProperty(j)&&(_e[j]=i[j]);var c=arguments.length-2;if(c===1)_e.children=d;else if(1<c){for(var pt=Array(c),gt=0;gt<c;gt++)pt[gt]=arguments[gt+2];_e.children=pt}if(e&&e.defaultProps)for(j in c=e.defaultProps,c)_e[j]===void 0&&(_e[j]=c[j]);return{$$typeof:l$1,type:e,key:nt,ref:ct,props:_e,_owner:K$1.current}}function N$1(e,i){return{$$typeof:l$1,type:e.type,key:i,ref:e.ref,props:e.props,_owner:e._owner}}function O$1(e){return typeof e=="object"&&e!==null&&e.$$typeof===l$1}function escape$1(e){var i={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(d){return i[d]})}var P$1=/\/+/g;function Q$1(e,i){return typeof e=="object"&&e!==null&&e.key!=null?escape$1(""+e.key):i.toString(36)}function R$1(e,i,d,j,_e){var nt=typeof e;(nt==="undefined"||nt==="boolean")&&(e=null);var ct=!1;if(e===null)ct=!0;else switch(nt){case"string":case"number":ct=!0;break;case"object":switch(e.$$typeof){case l$1:case n$1:ct=!0}}if(ct)return ct=e,_e=_e(ct),e=j===""?"."+Q$1(ct,0):j,I$1(_e)?(d="",e!=null&&(d=e.replace(P$1,"$&/")+"/"),R$1(_e,i,d,"",function(gt){return gt})):_e!=null&&(O$1(_e)&&(_e=N$1(_e,d+(!_e.key||ct&&ct.key===_e.key?"":(""+_e.key).replace(P$1,"$&/")+"/")+e)),i.push(_e)),1;if(ct=0,j=j===""?".":j+":",I$1(e))for(var c=0;c<e.length;c++){nt=e[c];var pt=j+Q$1(nt,c);ct+=R$1(nt,i,d,pt,_e)}else if(pt=A$1(e),typeof pt=="function")for(e=pt.call(e),c=0;!(nt=e.next()).done;)nt=nt.value,pt=j+Q$1(nt,c++),ct+=R$1(nt,i,d,pt,_e);else if(nt==="object")throw i=String(e),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return ct}function S$1(e,i,d){if(e==null)return e;var j=[],_e=0;return R$1(e,j,"","",function(nt){return i.call(d,nt,_e++)}),j}function T$1(e){if(e._status===-1){var i=e._result;i=i(),i.then(function(d){(e._status===0||e._status===-1)&&(e._status=1,e._result=d)},function(d){(e._status===0||e._status===-1)&&(e._status=2,e._result=d)}),e._status===-1&&(e._status=0,e._result=i)}if(e._status===1)return e._result.default;throw e._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};function X$2(){throw Error("act(...) is not supported in production builds of React.")}react_production_min.Children={map:S$1,forEach:function(e,i,d){S$1(e,function(){i.apply(this,arguments)},d)},count:function(e){var i=0;return S$1(e,function(){i++}),i},toArray:function(e){return S$1(e,function(i){return i})||[]},only:function(e){if(!O$1(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w$1;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.act=X$2;react_production_min.cloneElement=function(e,i,d){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var j=C$1({},e.props),_e=e.key,nt=e.ref,ct=e._owner;if(i!=null){if(i.ref!==void 0&&(nt=i.ref,ct=K$1.current),i.key!==void 0&&(_e=""+i.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(pt in i)J.call(i,pt)&&!L$1.hasOwnProperty(pt)&&(j[pt]=i[pt]===void 0&&c!==void 0?c[pt]:i[pt])}var pt=arguments.length-2;if(pt===1)j.children=d;else if(1<pt){c=Array(pt);for(var gt=0;gt<pt;gt++)c[gt]=arguments[gt+2];j.children=c}return{$$typeof:l$1,type:e.type,key:_e,ref:nt,props:j,_owner:ct}};react_production_min.createContext=function(e){return e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:t,_context:e},e.Consumer=e};react_production_min.createElement=M$2;react_production_min.createFactory=function(e){var i=M$2.bind(null,e);return i.type=e,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(e){return{$$typeof:v$3,render:e}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:T$1}};react_production_min.memo=function(e,i){return{$$typeof:x,type:e,compare:i===void 0?null:i}};react_production_min.startTransition=function(e){var i=V$1.transition;V$1.transition={};try{e()}finally{V$1.transition=i}};react_production_min.unstable_act=X$2;react_production_min.useCallback=function(e,i){return U$1.current.useCallback(e,i)};react_production_min.useContext=function(e){return U$1.current.useContext(e)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(e){return U$1.current.useDeferredValue(e)};react_production_min.useEffect=function(e,i){return U$1.current.useEffect(e,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(e,i,d){return U$1.current.useImperativeHandle(e,i,d)};react_production_min.useInsertionEffect=function(e,i){return U$1.current.useInsertionEffect(e,i)};react_production_min.useLayoutEffect=function(e,i){return U$1.current.useLayoutEffect(e,i)};react_production_min.useMemo=function(e,i){return U$1.current.useMemo(e,i)};react_production_min.useReducer=function(e,i,d){return U$1.current.useReducer(e,i,d)};react_production_min.useRef=function(e){return U$1.current.useRef(e)};react_production_min.useState=function(e){return U$1.current.useState(e)};react_production_min.useSyncExternalStore=function(e,i,d){return U$1.current.useSyncExternalStore(e,i,d)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.3.1";react.exports=react_production_min;var reactExports=react.exports;const React=getDefaultExportFromCjs(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(e,i,d){var j,_e={},nt=null,ct=null;d!==void 0&&(nt=""+d),i.key!==void 0&&(nt=""+i.key),i.ref!==void 0&&(ct=i.ref);for(j in i)m$1.call(i,j)&&!p$1.hasOwnProperty(j)&&(_e[j]=i[j]);if(e&&e.defaultProps)for(j in i=e.defaultProps,i)_e[j]===void 0&&(_e[j]=i[j]);return{$$typeof:k,type:e,key:nt,ref:ct,props:_e,_owner:n.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;jsxRuntime.exports=reactJsxRuntime_production_min;var jsxRuntimeExports=jsxRuntime.exports,client={},reactDom={exports:{}},reactDom_production_min={},scheduler={exports:{}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function i(rr,ar){var $r=rr.length;rr.push(ar);e:for(;0<$r;){var Ar=$r-1>>>1,Xr=rr[Ar];if(0<_e(Xr,ar))rr[Ar]=ar,rr[$r]=Xr,$r=Ar;else break e}}function d(rr){return rr.length===0?null:rr[0]}function j(rr){if(rr.length===0)return null;var ar=rr[0],$r=rr.pop();if($r!==ar){rr[0]=$r;e:for(var Ar=0,Xr=rr.length,us=Xr>>>1;Ar<us;){var Wr=2*(Ar+1)-1,Vs=rr[Wr],yn=Wr+1,_n=rr[yn];if(0>_e(Vs,$r))yn<Xr&&0>_e(_n,Vs)?(rr[Ar]=_n,rr[yn]=$r,Ar=yn):(rr[Ar]=Vs,rr[Wr]=$r,Ar=Wr);else if(yn<Xr&&0>_e(_n,$r))rr[Ar]=_n,rr[yn]=$r,Ar=yn;else break e}}return ar}function _e(rr,ar){var $r=rr.sortIndex-ar.sortIndex;return $r!==0?$r:rr.id-ar.id}if(typeof performance=="object"&&typeof performance.now=="function"){var nt=performance;e.unstable_now=function(){return nt.now()}}else{var ct=Date,c=ct.now();e.unstable_now=function(){return ct.now()-c}}var pt=[],gt=[],St=1,kt=null,At=3,Nt=!1,Vt=!1,zt=!1,Jt=typeof setTimeout=="function"?setTimeout:null,Dt=typeof clearTimeout=="function"?clearTimeout:null,It=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Mt(rr){for(var ar=d(gt);ar!==null;){if(ar.callback===null)j(gt);else if(ar.startTime<=rr)j(gt),ar.sortIndex=ar.expirationTime,i(pt,ar);else break;ar=d(gt)}}function Ht(rr){if(zt=!1,Mt(rr),!Vt)if(d(pt)!==null)Vt=!0,xr(tr);else{var ar=d(gt);ar!==null&&jr(Ht,ar.startTime-rr)}}function tr(rr,ar){Vt=!1,zt&&(zt=!1,Dt(mr),mr=-1),Nt=!0;var $r=At;try{for(Mt(ar),kt=d(pt);kt!==null&&(!(kt.expirationTime>ar)||rr&&!Yr());){var Ar=kt.callback;if(typeof Ar=="function"){kt.callback=null,At=kt.priorityLevel;var Xr=Ar(kt.expirationTime<=ar);ar=e.unstable_now(),typeof Xr=="function"?kt.callback=Xr:kt===d(pt)&&j(pt),Mt(ar)}else j(pt);kt=d(pt)}if(kt!==null)var us=!0;else{var Wr=d(gt);Wr!==null&&jr(Ht,Wr.startTime-ar),us=!1}return us}finally{kt=null,At=$r,Nt=!1}}var er=!1,dr=null,mr=-1,Ur=5,Dr=-1;function Yr(){return!(e.unstable_now()-Dr<Ur)}function es(){if(dr!==null){var rr=e.unstable_now();Dr=rr;var ar=!0;try{ar=dr(!0,rr)}finally{ar?ms():(er=!1,dr=null)}}else er=!1}var ms;if(typeof It=="function")ms=function(){It(es)};else if(typeof MessageChannel<"u"){var Ms=new MessageChannel,Kr=Ms.port2;Ms.port1.onmessage=es,ms=function(){Kr.postMessage(null)}}else ms=function(){Jt(es,0)};function xr(rr){dr=rr,er||(er=!0,ms())}function jr(rr,ar){mr=Jt(function(){rr(e.unstable_now())},ar)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(rr){rr.callback=null},e.unstable_continueExecution=function(){Vt||Nt||(Vt=!0,xr(tr))},e.unstable_forceFrameRate=function(rr){0>rr||125<rr?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ur=0<rr?Math.floor(1e3/rr):5},e.unstable_getCurrentPriorityLevel=function(){return At},e.unstable_getFirstCallbackNode=function(){return d(pt)},e.unstable_next=function(rr){switch(At){case 1:case 2:case 3:var ar=3;break;default:ar=At}var $r=At;At=ar;try{return rr()}finally{At=$r}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(rr,ar){switch(rr){case 1:case 2:case 3:case 4:case 5:break;default:rr=3}var $r=At;At=rr;try{return ar()}finally{At=$r}},e.unstable_scheduleCallback=function(rr,ar,$r){var Ar=e.unstable_now();switch(typeof $r=="object"&&$r!==null?($r=$r.delay,$r=typeof $r=="number"&&0<$r?Ar+$r:Ar):$r=Ar,rr){case 1:var Xr=-1;break;case 2:Xr=250;break;case 5:Xr=1073741823;break;case 4:Xr=1e4;break;default:Xr=5e3}return Xr=$r+Xr,rr={id:St++,callback:ar,priorityLevel:rr,startTime:$r,expirationTime:Xr,sortIndex:-1},$r>Ar?(rr.sortIndex=$r,i(gt,rr),d(pt)===null&&rr===d(gt)&&(zt?(Dt(mr),mr=-1):zt=!0,jr(Ht,$r-Ar))):(rr.sortIndex=Xr,i(pt,rr),Vt||Nt||(Vt=!0,xr(tr))),rr},e.unstable_shouldYield=Yr,e.unstable_wrapCallback=function(rr){var ar=At;return function(){var $r=At;At=ar;try{return rr.apply(this,arguments)}finally{At=$r}}}})(scheduler_production_min);scheduler.exports=scheduler_production_min;var schedulerExports=scheduler.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(e){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+e,d=1;d<arguments.length;d++)i+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+e+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(e,i){ha(e,i),ha(e+"Capture",i)}function ha(e,i){for(ea[e]=i,e=0;e<i.length;e++)da.add(i[e])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(e){return ja.call(ma,e)?!0:ja.call(la,e)?!1:ka.test(e)?ma[e]=!0:(la[e]=!0,!1)}function pa(e,i,d,j){if(d!==null&&d.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return j?!1:d!==null?!d.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function qa(e,i,d,j){if(i===null||typeof i>"u"||pa(e,i,d,j))return!0;if(j)return!1;if(d!==null)switch(d.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v$2(e,i,d,j,_e,nt,ct){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=j,this.attributeNamespace=_e,this.mustUseProperty=d,this.propertyName=e,this.type=i,this.sanitizeURL=nt,this.removeEmptyString=ct}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){z[e]=new v$2(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var i=e[0];z[i]=new v$2(i,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){z[e]=new v$2(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){z[e]=new v$2(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){z[e]=new v$2(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){z[e]=new v$2(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){z[e]=new v$2(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){z[e]=new v$2(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){z[e]=new v$2(e,5,!1,e.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$2(i,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$2(i,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var i=e.replace(ra,sa);z[i]=new v$2(i,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){z[e]=new v$2(e,1,!1,e.toLowerCase(),null,!1,!1)});z.xlinkHref=new v$2("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){z[e]=new v$2(e,1,!1,e.toLowerCase(),null,!0,!0)});function ta(e,i,d,j){var _e=z.hasOwnProperty(i)?z[i]:null;(_e!==null?_e.type!==0:j||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,d,_e,j)&&(d=null),j||_e===null?oa(i)&&(d===null?e.removeAttribute(i):e.setAttribute(i,""+d)):_e.mustUseProperty?e[_e.propertyName]=d===null?_e.type===3?!1:"":d:(i=_e.attributeName,j=_e.attributeNamespace,d===null?e.removeAttribute(i):(_e=_e.type,d=_e===3||_e===4&&d===!0?"":""+d,j?e.setAttributeNS(j,i,d):e.setAttribute(i,d))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(e){return e===null||typeof e!="object"?null:(e=Ja&&e[Ja]||e["@@iterator"],typeof e=="function"?e:null)}var A=Object.assign,La;function Ma(e){if(La===void 0)try{throw Error()}catch(d){var i=d.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+e}var Na=!1;function Oa(e,i){if(!e||Na)return"";Na=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(gt){var j=gt}Reflect.construct(e,[],i)}else{try{i.call()}catch(gt){j=gt}e.call(i.prototype)}else{try{throw Error()}catch(gt){j=gt}e()}}catch(gt){if(gt&&j&&typeof gt.stack=="string"){for(var _e=gt.stack.split(`
`),nt=j.stack.split(`
`),ct=_e.length-1,c=nt.length-1;1<=ct&&0<=c&&_e[ct]!==nt[c];)c--;for(;1<=ct&&0<=c;ct--,c--)if(_e[ct]!==nt[c]){if(ct!==1||c!==1)do if(ct--,c--,0>c||_e[ct]!==nt[c]){var pt=`
`+_e[ct].replace(" at new "," at ");return e.displayName&&pt.includes("<anonymous>")&&(pt=pt.replace("<anonymous>",e.displayName)),pt}while(1<=ct&&0<=c);break}}}finally{Na=!1,Error.prepareStackTrace=d}return(e=e?e.displayName||e.name:"")?Ma(e):""}function Pa(e){switch(e.tag){case 5:return Ma(e.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return e=Oa(e.type,!1),e;case 11:return e=Oa(e.type.render,!1),e;case 1:return e=Oa(e.type,!0),e;default:return""}}function Qa(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Ca:return(e.displayName||"Context")+".Consumer";case Ba:return(e._context.displayName||"Context")+".Provider";case Da:var i=e.render;return e=e.displayName,e||(e=i.displayName||i.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case Ga:return i=e.displayName||null,i!==null?i:Qa(e.type)||"Memo";case Ha:i=e._payload,e=e._init;try{return Qa(e(i))}catch{}}return null}function Ra(e){var i=e.type;switch(e.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=i.render,e=e.displayName||e.name||"",i.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Ta(e){var i=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(e){var i=Ta(e)?"checked":"value",d=Object.getOwnPropertyDescriptor(e.constructor.prototype,i),j=""+e[i];if(!e.hasOwnProperty(i)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var _e=d.get,nt=d.set;return Object.defineProperty(e,i,{configurable:!0,get:function(){return _e.call(this)},set:function(ct){j=""+ct,nt.call(this,ct)}}),Object.defineProperty(e,i,{enumerable:d.enumerable}),{getValue:function(){return j},setValue:function(ct){j=""+ct},stopTracking:function(){e._valueTracker=null,delete e[i]}}}}function Va(e){e._valueTracker||(e._valueTracker=Ua(e))}function Wa(e){if(!e)return!1;var i=e._valueTracker;if(!i)return!0;var d=i.getValue(),j="";return e&&(j=Ta(e)?e.checked?"true":"false":e.value),e=j,e!==d?(i.setValue(e),!0):!1}function Xa(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Ya(e,i){var d=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??e._wrapperState.initialChecked})}function Za(e,i){var d=i.defaultValue==null?"":i.defaultValue,j=i.checked!=null?i.checked:i.defaultChecked;d=Sa(i.value!=null?i.value:d),e._wrapperState={initialChecked:j,initialValue:d,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(e,i){i=i.checked,i!=null&&ta(e,"checked",i,!1)}function bb(e,i){ab(e,i);var d=Sa(i.value),j=i.type;if(d!=null)j==="number"?(d===0&&e.value===""||e.value!=d)&&(e.value=""+d):e.value!==""+d&&(e.value=""+d);else if(j==="submit"||j==="reset"){e.removeAttribute("value");return}i.hasOwnProperty("value")?cb(e,i.type,d):i.hasOwnProperty("defaultValue")&&cb(e,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(e.defaultChecked=!!i.defaultChecked)}function db(e,i,d){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var j=i.type;if(!(j!=="submit"&&j!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+e._wrapperState.initialValue,d||i===e.value||(e.value=i),e.defaultValue=i}d=e.name,d!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,d!==""&&(e.name=d)}function cb(e,i,d){(i!=="number"||Xa(e.ownerDocument)!==e)&&(d==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+d&&(e.defaultValue=""+d))}var eb=Array.isArray;function fb(e,i,d,j){if(e=e.options,i){i={};for(var _e=0;_e<d.length;_e++)i["$"+d[_e]]=!0;for(d=0;d<e.length;d++)_e=i.hasOwnProperty("$"+e[d].value),e[d].selected!==_e&&(e[d].selected=_e),_e&&j&&(e[d].defaultSelected=!0)}else{for(d=""+Sa(d),i=null,_e=0;_e<e.length;_e++){if(e[_e].value===d){e[_e].selected=!0,j&&(e[_e].defaultSelected=!0);return}i!==null||e[_e].disabled||(i=e[_e])}i!==null&&(i.selected=!0)}}function gb(e,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function hb(e,i){var d=i.value;if(d==null){if(d=i.children,i=i.defaultValue,d!=null){if(i!=null)throw Error(p(92));if(eb(d)){if(1<d.length)throw Error(p(93));d=d[0]}i=d}i==null&&(i=""),d=i}e._wrapperState={initialValue:Sa(d)}}function ib(e,i){var d=Sa(i.value),j=Sa(i.defaultValue);d!=null&&(d=""+d,d!==e.value&&(e.value=d),i.defaultValue==null&&e.defaultValue!==d&&(e.defaultValue=d)),j!=null&&(e.defaultValue=""+j)}function jb(e){var i=e.textContent;i===e._wrapperState.initialValue&&i!==""&&i!==null&&(e.value=i)}function kb(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(e,i){return e==null||e==="http://www.w3.org/1999/xhtml"?kb(i):e==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var mb,nb=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,d,j,_e){MSApp.execUnsafeLocalFunction(function(){return e(i,d,j,_e)})}:e}(function(e,i){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;i.firstChild;)e.appendChild(i.firstChild)}});function ob(e,i){if(i){var d=e.firstChild;if(d&&d===e.lastChild&&d.nodeType===3){d.nodeValue=i;return}}e.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(e){qb.forEach(function(i){i=i+e.charAt(0).toUpperCase()+e.substring(1),pb[i]=pb[e]})});function rb(e,i,d){return i==null||typeof i=="boolean"||i===""?"":d||typeof i!="number"||i===0||pb.hasOwnProperty(e)&&pb[e]?(""+i).trim():i+"px"}function sb(e,i){e=e.style;for(var d in i)if(i.hasOwnProperty(d)){var j=d.indexOf("--")===0,_e=rb(d,i[d],j);d==="float"&&(d="cssFloat"),j?e.setProperty(d,_e):e[d]=_e}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(e,i){if(i){if(tb[e]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,e));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(e,i){if(e.indexOf("-")===-1)return typeof i.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var yb=null,zb=null,Ab=null;function Bb(e){if(e=Cb(e)){if(typeof yb!="function")throw Error(p(280));var i=e.stateNode;i&&(i=Db(i),yb(e.stateNode,e.type,i))}}function Eb(e){zb?Ab?Ab.push(e):Ab=[e]:zb=e}function Fb(){if(zb){var e=zb,i=Ab;if(Ab=zb=null,Bb(e),i)for(e=0;e<i.length;e++)Bb(i[e])}}function Gb(e,i){return e(i)}function Hb(){}var Ib=!1;function Jb(e,i,d){if(Ib)return e(i,d);Ib=!0;try{return Gb(e,i,d)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(e,i){var d=e.stateNode;if(d===null)return null;var j=Db(d);if(j===null)return null;d=j[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(j=!j.disabled)||(e=e.type,j=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!j;break e;default:e=!1}if(e)return null;if(d&&typeof d!="function")throw Error(p(231,i,typeof d));return d}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(e,i,d,j,_e,nt,ct,c,pt){var gt=Array.prototype.slice.call(arguments,3);try{i.apply(d,gt)}catch(St){this.onError(St)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(e){Ob=!0,Pb=e}};function Tb(e,i,d,j,_e,nt,ct,c,pt){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(e,i,d,j,_e,nt,ct,c,pt){if(Tb.apply(this,arguments),Ob){if(Ob){var gt=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=gt)}}function Vb(e){var i=e,d=e;if(e.alternate)for(;i.return;)i=i.return;else{e=i;do i=e,i.flags&4098&&(d=i.return),e=i.return;while(e)}return i.tag===3?d:null}function Wb(e){if(e.tag===13){var i=e.memoizedState;if(i===null&&(e=e.alternate,e!==null&&(i=e.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(e){if(Vb(e)!==e)throw Error(p(188))}function Yb(e){var i=e.alternate;if(!i){if(i=Vb(e),i===null)throw Error(p(188));return i!==e?null:e}for(var d=e,j=i;;){var _e=d.return;if(_e===null)break;var nt=_e.alternate;if(nt===null){if(j=_e.return,j!==null){d=j;continue}break}if(_e.child===nt.child){for(nt=_e.child;nt;){if(nt===d)return Xb(_e),e;if(nt===j)return Xb(_e),i;nt=nt.sibling}throw Error(p(188))}if(d.return!==j.return)d=_e,j=nt;else{for(var ct=!1,c=_e.child;c;){if(c===d){ct=!0,d=_e,j=nt;break}if(c===j){ct=!0,j=_e,d=nt;break}c=c.sibling}if(!ct){for(c=nt.child;c;){if(c===d){ct=!0,d=nt,j=_e;break}if(c===j){ct=!0,j=nt,d=_e;break}c=c.sibling}if(!ct)throw Error(p(189))}}if(d.alternate!==j)throw Error(p(190))}if(d.tag!==3)throw Error(p(188));return d.stateNode.current===d?e:i}function Zb(e){return e=Yb(e),e!==null?$b(e):null}function $b(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var i=$b(e);if(i!==null)return i;e=e.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(e){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,e,void 0,(e.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(e){return e>>>=0,e===0?32:31-(pc(e)/qc|0)|0}var rc=64,sc=4194304;function tc(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function uc(e,i){var d=e.pendingLanes;if(d===0)return 0;var j=0,_e=e.suspendedLanes,nt=e.pingedLanes,ct=d&268435455;if(ct!==0){var c=ct&~_e;c!==0?j=tc(c):(nt&=ct,nt!==0&&(j=tc(nt)))}else ct=d&~_e,ct!==0?j=tc(ct):nt!==0&&(j=tc(nt));if(j===0)return 0;if(i!==0&&i!==j&&!(i&_e)&&(_e=j&-j,nt=i&-i,_e>=nt||_e===16&&(nt&4194240)!==0))return i;if(j&4&&(j|=d&16),i=e.entangledLanes,i!==0)for(e=e.entanglements,i&=j;0<i;)d=31-oc(i),_e=1<<d,j|=e[d],i&=~_e;return j}function vc(e,i){switch(e){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(e,i){for(var d=e.suspendedLanes,j=e.pingedLanes,_e=e.expirationTimes,nt=e.pendingLanes;0<nt;){var ct=31-oc(nt),c=1<<ct,pt=_e[ct];pt===-1?(!(c&d)||c&j)&&(_e[ct]=vc(c,i)):pt<=i&&(e.expiredLanes|=c),nt&=~c}}function xc(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function yc(){var e=rc;return rc<<=1,!(rc&4194240)&&(rc=64),e}function zc(e){for(var i=[],d=0;31>d;d++)i.push(e);return i}function Ac(e,i,d){e.pendingLanes|=i,i!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,i=31-oc(i),e[i]=d}function Bc(e,i){var d=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;var j=e.eventTimes;for(e=e.expirationTimes;0<d;){var _e=31-oc(d),nt=1<<_e;i[_e]=0,j[_e]=-1,e[_e]=-1,d&=~nt}}function Cc(e,i){var d=e.entangledLanes|=i;for(e=e.entanglements;d;){var j=31-oc(d),_e=1<<j;_e&i|e[j]&i&&(e[j]|=i),d&=~_e}}var C=0;function Dc(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(e,i){switch(e){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(e,i,d,j,_e,nt){return e===null||e.nativeEvent!==nt?(e={blockedOn:i,domEventName:d,eventSystemFlags:j,nativeEvent:nt,targetContainers:[_e]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),e):(e.eventSystemFlags|=j,i=e.targetContainers,_e!==null&&i.indexOf(_e)===-1&&i.push(_e),e)}function Uc(e,i,d,j,_e){switch(i){case"focusin":return Lc=Tc(Lc,e,i,d,j,_e),!0;case"dragenter":return Mc=Tc(Mc,e,i,d,j,_e),!0;case"mouseover":return Nc=Tc(Nc,e,i,d,j,_e),!0;case"pointerover":var nt=_e.pointerId;return Oc.set(nt,Tc(Oc.get(nt)||null,e,i,d,j,_e)),!0;case"gotpointercapture":return nt=_e.pointerId,Pc.set(nt,Tc(Pc.get(nt)||null,e,i,d,j,_e)),!0}return!1}function Vc(e){var i=Wc(e.target);if(i!==null){var d=Vb(i);if(d!==null){if(i=d.tag,i===13){if(i=Wb(d),i!==null){e.blockedOn=i,Ic(e.priority,function(){Gc(d)});return}}else if(i===3&&d.stateNode.current.memoizedState.isDehydrated){e.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Xc(e){if(e.blockedOn!==null)return!1;for(var i=e.targetContainers;0<i.length;){var d=Yc(e.domEventName,e.eventSystemFlags,i[0],e.nativeEvent);if(d===null){d=e.nativeEvent;var j=new d.constructor(d.type,d);wb=j,d.target.dispatchEvent(j),wb=null}else return i=Cb(d),i!==null&&Fc(i),e.blockedOn=d,!1;i.shift()}return!0}function Zc(e,i,d){Xc(e)&&d.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(e,i){e.blockedOn===i&&(e.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(e){function i(_e){return ad(_e,e)}if(0<Kc.length){ad(Kc[0],e);for(var d=1;d<Kc.length;d++){var j=Kc[d];j.blockedOn===e&&(j.blockedOn=null)}}for(Lc!==null&&ad(Lc,e),Mc!==null&&ad(Mc,e),Nc!==null&&ad(Nc,e),Oc.forEach(i),Pc.forEach(i),d=0;d<Qc.length;d++)j=Qc[d],j.blockedOn===e&&(j.blockedOn=null);for(;0<Qc.length&&(d=Qc[0],d.blockedOn===null);)Vc(d),d.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(e,i,d,j){var _e=C,nt=cd.transition;cd.transition=null;try{C=1,fd(e,i,d,j)}finally{C=_e,cd.transition=nt}}function gd(e,i,d,j){var _e=C,nt=cd.transition;cd.transition=null;try{C=4,fd(e,i,d,j)}finally{C=_e,cd.transition=nt}}function fd(e,i,d,j){if(dd){var _e=Yc(e,i,d,j);if(_e===null)hd(e,i,j,id$2,d),Sc(e,j);else if(Uc(_e,e,i,d,j))j.stopPropagation();else if(Sc(e,j),i&4&&-1<Rc.indexOf(e)){for(;_e!==null;){var nt=Cb(_e);if(nt!==null&&Ec(nt),nt=Yc(e,i,d,j),nt===null&&hd(e,i,j,id$2,d),nt===_e)break;_e=nt}_e!==null&&j.stopPropagation()}else hd(e,i,j,null,d)}}var id$2=null;function Yc(e,i,d,j){if(id$2=null,e=xb(j),e=Wc(e),e!==null)if(i=Vb(e),i===null)e=null;else if(d=i.tag,d===13){if(e=Wb(i),e!==null)return e;e=null}else if(d===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;e=null}else i!==e&&(e=null);return id$2=e,null}function jd(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var e,i=ld,d=i.length,j,_e="value"in kd?kd.value:kd.textContent,nt=_e.length;for(e=0;e<d&&i[e]===_e[e];e++);var ct=d-e;for(j=1;j<=ct&&i[d-j]===_e[nt-j];j++);return md=_e.slice(e,1<j?1-j:void 0)}function od(e){var i=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&i===13&&(e=13)):e=i,e===10&&(e=13),32<=e||e===13?e:0}function pd(){return!0}function qd(){return!1}function rd(e){function i(d,j,_e,nt,ct){this._reactName=d,this._targetInst=_e,this.type=j,this.nativeEvent=nt,this.target=ct,this.currentTarget=null;for(var c in e)e.hasOwnProperty(c)&&(d=e[c],this[c]=d?d(nt):nt[c]);return this.isDefaultPrevented=(nt.defaultPrevented!=null?nt.defaultPrevented:nt.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==yd&&(yd&&e.type==="mousemove"?(wd=e.screenX-yd.screenX,xd=e.screenY-yd.screenY):xd=wd=0,yd=e),wd)},movementY:function(e){return"movementY"in e?e.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(e){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(e):(e=Od[e])?!!i[e]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(e){if(e.key){var i=Md[e.key]||e.key;if(i!=="Unidentified")return i}return e.type==="keypress"?(e=od(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Nd[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(e){return e.type==="keypress"?od(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?od(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae$1=ia&&"CompositionEvent"in window,be$1=null;ia&&"documentMode"in document&&(be$1=document.documentMode);var ce$1=ia&&"TextEvent"in window&&!be$1,de$1=ia&&(!ae$1||be$1&&8<be$1&&11>=be$1),ee$1=" ",fe=!1;function ge$1(e,i){switch(e){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he$1(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var ie$1=!1;function je(e,i){switch(e){case"compositionend":return he$1(i);case"keypress":return i.which!==32?null:(fe=!0,ee$1);case"textInput":return e=i.data,e===ee$1&&fe?null:e;default:return null}}function ke(e,i){if(ie$1)return e==="compositionend"||!ae$1&&ge$1(e,i)?(e=nd(),md=ld=kd=null,ie$1=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de$1&&i.locale!=="ko"?null:i.data;default:return null}}var le$1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me$1(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i==="input"?!!le$1[e.type]:i==="textarea"}function ne$1(e,i,d,j){Eb(j),i=oe$1(i,"onChange"),0<i.length&&(d=new td("onChange","change",null,d,j),e.push({event:d,listeners:i}))}var pe$1=null,qe=null;function re(e){se$1(e,0)}function te$1(e){var i=ue(e);if(Wa(i))return e}function ve$1(e,i){if(e==="change")return i}var we$1=!1;if(ia){var xe$1;if(ia){var ye$1="oninput"in document;if(!ye$1){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye$1=typeof ze.oninput=="function"}xe$1=ye$1}else xe$1=!1;we$1=xe$1&&(!document.documentMode||9<document.documentMode)}function Ae(){pe$1&&(pe$1.detachEvent("onpropertychange",Be),qe=pe$1=null)}function Be(e){if(e.propertyName==="value"&&te$1(qe)){var i=[];ne$1(i,qe,e,xb(e)),Jb(re,i)}}function Ce(e,i,d){e==="focusin"?(Ae(),pe$1=i,qe=d,pe$1.attachEvent("onpropertychange",Be)):e==="focusout"&&Ae()}function De(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return te$1(qe)}function Ee(e,i){if(e==="click")return te$1(i)}function Fe(e,i){if(e==="input"||e==="change")return te$1(i)}function Ge(e,i){return e===i&&(e!==0||1/e===1/i)||e!==e&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(e,i){if(He(e,i))return!0;if(typeof e!="object"||e===null||typeof i!="object"||i===null)return!1;var d=Object.keys(e),j=Object.keys(i);if(d.length!==j.length)return!1;for(j=0;j<d.length;j++){var _e=d[j];if(!ja.call(i,_e)||!He(e[_e],i[_e]))return!1}return!0}function Je(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Ke(e,i){var d=Je(e);e=0;for(var j;d;){if(d.nodeType===3){if(j=e+d.textContent.length,e<=i&&j>=i)return{node:d,offset:i-e};e=j}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Je(d)}}function Le(e,i){return e&&i?e===i?!0:e&&e.nodeType===3?!1:i&&i.nodeType===3?Le(e,i.parentNode):"contains"in e?e.contains(i):e.compareDocumentPosition?!!(e.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var e=window,i=Xa();i instanceof e.HTMLIFrameElement;){try{var d=typeof i.contentWindow.location.href=="string"}catch{d=!1}if(d)e=i.contentWindow;else break;i=Xa(e.document)}return i}function Ne(e){var i=e&&e.nodeName&&e.nodeName.toLowerCase();return i&&(i==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||i==="textarea"||e.contentEditable==="true")}function Oe(e){var i=Me(),d=e.focusedElem,j=e.selectionRange;if(i!==d&&d&&d.ownerDocument&&Le(d.ownerDocument.documentElement,d)){if(j!==null&&Ne(d)){if(i=j.start,e=j.end,e===void 0&&(e=i),"selectionStart"in d)d.selectionStart=i,d.selectionEnd=Math.min(e,d.value.length);else if(e=(i=d.ownerDocument||document)&&i.defaultView||window,e.getSelection){e=e.getSelection();var _e=d.textContent.length,nt=Math.min(j.start,_e);j=j.end===void 0?nt:Math.min(j.end,_e),!e.extend&&nt>j&&(_e=j,j=nt,nt=_e),_e=Ke(d,nt);var ct=Ke(d,j);_e&&ct&&(e.rangeCount!==1||e.anchorNode!==_e.node||e.anchorOffset!==_e.offset||e.focusNode!==ct.node||e.focusOffset!==ct.offset)&&(i=i.createRange(),i.setStart(_e.node,_e.offset),e.removeAllRanges(),nt>j?(e.addRange(i),e.extend(ct.node,ct.offset)):(i.setEnd(ct.node,ct.offset),e.addRange(i)))}}for(i=[],e=d;e=e.parentNode;)e.nodeType===1&&i.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<i.length;d++)e=i[d],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te$1=!1;function Ue(e,i,d){var j=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Te$1||Qe==null||Qe!==Xa(j)||(j=Qe,"selectionStart"in j&&Ne(j)?j={start:j.selectionStart,end:j.selectionEnd}:(j=(j.ownerDocument&&j.ownerDocument.defaultView||window).getSelection(),j={anchorNode:j.anchorNode,anchorOffset:j.anchorOffset,focusNode:j.focusNode,focusOffset:j.focusOffset}),Se&&Ie(Se,j)||(Se=j,j=oe$1(Re,"onSelect"),0<j.length&&(i=new td("onSelect","select",null,i,d),e.push({event:i,listeners:j}),i.target=Qe)))}function Ve(e,i){var d={};return d[e.toLowerCase()]=i.toLowerCase(),d["Webkit"+e]="webkit"+i,d["Moz"+e]="moz"+i,d}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(e){if(Xe[e])return Xe[e];if(!We[e])return e;var i=We[e],d;for(d in i)if(i.hasOwnProperty(d)&&d in Ye)return Xe[e]=i[d];return e}var $e$1=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(e,i){df.set(e,i),fa(i,[e])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e$1,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(e,i,d){var j=e.type||"unknown-event";e.currentTarget=d,Ub(j,i,void 0,e),e.currentTarget=null}function se$1(e,i){i=(i&4)!==0;for(var d=0;d<e.length;d++){var j=e[d],_e=j.event;j=j.listeners;e:{var nt=void 0;if(i)for(var ct=j.length-1;0<=ct;ct--){var c=j[ct],pt=c.instance,gt=c.currentTarget;if(c=c.listener,pt!==nt&&_e.isPropagationStopped())break e;nf(_e,c,gt),nt=pt}else for(ct=0;ct<j.length;ct++){if(c=j[ct],pt=c.instance,gt=c.currentTarget,c=c.listener,pt!==nt&&_e.isPropagationStopped())break e;nf(_e,c,gt),nt=pt}}}if(Qb)throw e=Rb,Qb=!1,Rb=null,e}function D(e,i){var d=i[of];d===void 0&&(d=i[of]=new Set);var j=e+"__bubble";d.has(j)||(pf(i,e,2,!1),d.add(j))}function qf(e,i,d){var j=0;i&&(j|=4),pf(d,e,j,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(e){if(!e[rf]){e[rf]=!0,da.forEach(function(d){d!=="selectionchange"&&(mf.has(d)||qf(d,!1,e),qf(d,!0,e))});var i=e.nodeType===9?e:e.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(e,i,d,j){switch(jd(i)){case 1:var _e=ed;break;case 4:_e=gd;break;default:_e=fd}d=_e.bind(null,i,d,e),_e=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(_e=!0),j?_e!==void 0?e.addEventListener(i,d,{capture:!0,passive:_e}):e.addEventListener(i,d,!0):_e!==void 0?e.addEventListener(i,d,{passive:_e}):e.addEventListener(i,d,!1)}function hd(e,i,d,j,_e){var nt=j;if(!(i&1)&&!(i&2)&&j!==null)e:for(;;){if(j===null)return;var ct=j.tag;if(ct===3||ct===4){var c=j.stateNode.containerInfo;if(c===_e||c.nodeType===8&&c.parentNode===_e)break;if(ct===4)for(ct=j.return;ct!==null;){var pt=ct.tag;if((pt===3||pt===4)&&(pt=ct.stateNode.containerInfo,pt===_e||pt.nodeType===8&&pt.parentNode===_e))return;ct=ct.return}for(;c!==null;){if(ct=Wc(c),ct===null)return;if(pt=ct.tag,pt===5||pt===6){j=nt=ct;continue e}c=c.parentNode}}j=j.return}Jb(function(){var gt=nt,St=xb(d),kt=[];e:{var At=df.get(e);if(At!==void 0){var Nt=td,Vt=e;switch(e){case"keypress":if(od(d)===0)break e;case"keydown":case"keyup":Nt=Rd;break;case"focusin":Vt="focus",Nt=Fd;break;case"focusout":Vt="blur",Nt=Fd;break;case"beforeblur":case"afterblur":Nt=Fd;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Nt=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Nt=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Nt=Vd;break;case $e$1:case af:case bf:Nt=Hd;break;case cf:Nt=Xd;break;case"scroll":Nt=vd;break;case"wheel":Nt=Zd;break;case"copy":case"cut":case"paste":Nt=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Nt=Td}var zt=(i&4)!==0,Jt=!zt&&e==="scroll",Dt=zt?At!==null?At+"Capture":null:At;zt=[];for(var It=gt,Mt;It!==null;){Mt=It;var Ht=Mt.stateNode;if(Mt.tag===5&&Ht!==null&&(Mt=Ht,Dt!==null&&(Ht=Kb(It,Dt),Ht!=null&&zt.push(tf(It,Ht,Mt)))),Jt)break;It=It.return}0<zt.length&&(At=new Nt(At,Vt,null,d,St),kt.push({event:At,listeners:zt}))}}if(!(i&7)){e:{if(At=e==="mouseover"||e==="pointerover",Nt=e==="mouseout"||e==="pointerout",At&&d!==wb&&(Vt=d.relatedTarget||d.fromElement)&&(Wc(Vt)||Vt[uf]))break e;if((Nt||At)&&(At=St.window===St?St:(At=St.ownerDocument)?At.defaultView||At.parentWindow:window,Nt?(Vt=d.relatedTarget||d.toElement,Nt=gt,Vt=Vt?Wc(Vt):null,Vt!==null&&(Jt=Vb(Vt),Vt!==Jt||Vt.tag!==5&&Vt.tag!==6)&&(Vt=null)):(Nt=null,Vt=gt),Nt!==Vt)){if(zt=Bd,Ht="onMouseLeave",Dt="onMouseEnter",It="mouse",(e==="pointerout"||e==="pointerover")&&(zt=Td,Ht="onPointerLeave",Dt="onPointerEnter",It="pointer"),Jt=Nt==null?At:ue(Nt),Mt=Vt==null?At:ue(Vt),At=new zt(Ht,It+"leave",Nt,d,St),At.target=Jt,At.relatedTarget=Mt,Ht=null,Wc(St)===gt&&(zt=new zt(Dt,It+"enter",Vt,d,St),zt.target=Mt,zt.relatedTarget=Jt,Ht=zt),Jt=Ht,Nt&&Vt)t:{for(zt=Nt,Dt=Vt,It=0,Mt=zt;Mt;Mt=vf(Mt))It++;for(Mt=0,Ht=Dt;Ht;Ht=vf(Ht))Mt++;for(;0<It-Mt;)zt=vf(zt),It--;for(;0<Mt-It;)Dt=vf(Dt),Mt--;for(;It--;){if(zt===Dt||Dt!==null&&zt===Dt.alternate)break t;zt=vf(zt),Dt=vf(Dt)}zt=null}else zt=null;Nt!==null&&wf(kt,At,Nt,zt,!1),Vt!==null&&Jt!==null&&wf(kt,Jt,Vt,zt,!0)}}e:{if(At=gt?ue(gt):window,Nt=At.nodeName&&At.nodeName.toLowerCase(),Nt==="select"||Nt==="input"&&At.type==="file")var tr=ve$1;else if(me$1(At))if(we$1)tr=Fe;else{tr=De;var er=Ce}else(Nt=At.nodeName)&&Nt.toLowerCase()==="input"&&(At.type==="checkbox"||At.type==="radio")&&(tr=Ee);if(tr&&(tr=tr(e,gt))){ne$1(kt,tr,d,St);break e}er&&er(e,At,gt),e==="focusout"&&(er=At._wrapperState)&&er.controlled&&At.type==="number"&&cb(At,"number",At.value)}switch(er=gt?ue(gt):window,e){case"focusin":(me$1(er)||er.contentEditable==="true")&&(Qe=er,Re=gt,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te$1=!0;break;case"contextmenu":case"mouseup":case"dragend":Te$1=!1,Ue(kt,d,St);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(kt,d,St)}var dr;if(ae$1)e:{switch(e){case"compositionstart":var mr="onCompositionStart";break e;case"compositionend":mr="onCompositionEnd";break e;case"compositionupdate":mr="onCompositionUpdate";break e}mr=void 0}else ie$1?ge$1(e,d)&&(mr="onCompositionEnd"):e==="keydown"&&d.keyCode===229&&(mr="onCompositionStart");mr&&(de$1&&d.locale!=="ko"&&(ie$1||mr!=="onCompositionStart"?mr==="onCompositionEnd"&&ie$1&&(dr=nd()):(kd=St,ld="value"in kd?kd.value:kd.textContent,ie$1=!0)),er=oe$1(gt,mr),0<er.length&&(mr=new Ld(mr,e,null,d,St),kt.push({event:mr,listeners:er}),dr?mr.data=dr:(dr=he$1(d),dr!==null&&(mr.data=dr)))),(dr=ce$1?je(e,d):ke(e,d))&&(gt=oe$1(gt,"onBeforeInput"),0<gt.length&&(St=new Ld("onBeforeInput","beforeinput",null,d,St),kt.push({event:St,listeners:gt}),St.data=dr))}se$1(kt,i)})}function tf(e,i,d){return{instance:e,listener:i,currentTarget:d}}function oe$1(e,i){for(var d=i+"Capture",j=[];e!==null;){var _e=e,nt=_e.stateNode;_e.tag===5&&nt!==null&&(_e=nt,nt=Kb(e,d),nt!=null&&j.unshift(tf(e,nt,_e)),nt=Kb(e,i),nt!=null&&j.push(tf(e,nt,_e))),e=e.return}return j}function vf(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function wf(e,i,d,j,_e){for(var nt=i._reactName,ct=[];d!==null&&d!==j;){var c=d,pt=c.alternate,gt=c.stateNode;if(pt!==null&&pt===j)break;c.tag===5&&gt!==null&&(c=gt,_e?(pt=Kb(d,nt),pt!=null&&ct.unshift(tf(d,pt,c))):_e||(pt=Kb(d,nt),pt!=null&&ct.push(tf(d,pt,c)))),d=d.return}ct.length!==0&&e.push({event:i,listeners:ct})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(e){return(typeof e=="string"?e:""+e).replace(xf,`
`).replace(yf,"")}function Af(e,i,d){if(i=zf(i),zf(e)!==i&&d)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(e,i){return e==="textarea"||e==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(e){return Hf.resolve(null).then(e).catch(If)}:Ff;function If(e){setTimeout(function(){throw e})}function Kf(e,i){var d=i,j=0;do{var _e=d.nextSibling;if(e.removeChild(d),_e&&_e.nodeType===8)if(d=_e.data,d==="/$"){if(j===0){e.removeChild(_e),bd(i);return}j--}else d!=="$"&&d!=="$?"&&d!=="$!"||j++;d=_e}while(d);bd(i)}function Lf(e){for(;e!=null;e=e.nextSibling){var i=e.nodeType;if(i===1||i===3)break;if(i===8){if(i=e.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return e}function Mf(e){e=e.previousSibling;for(var i=0;e;){if(e.nodeType===8){var d=e.data;if(d==="$"||d==="$!"||d==="$?"){if(i===0)return e;i--}else d==="/$"&&i++}e=e.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(e){var i=e[Of];if(i)return i;for(var d=e.parentNode;d;){if(i=d[uf]||d[Of]){if(d=i.alternate,i.child!==null||d!==null&&d.child!==null)for(e=Mf(e);e!==null;){if(d=e[Of])return d;e=Mf(e)}return i}e=d,d=e.parentNode}return null}function Cb(e){return e=e[Of]||e[uf],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function ue(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(p(33))}function Db(e){return e[Pf]||null}var Sf=[],Tf=-1;function Uf(e){return{current:e}}function E(e){0>Tf||(e.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(e,i){Tf++,Sf[Tf]=e.current,e.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(e,i){var d=e.type.contextTypes;if(!d)return Vf;var j=e.stateNode;if(j&&j.__reactInternalMemoizedUnmaskedChildContext===i)return j.__reactInternalMemoizedMaskedChildContext;var _e={},nt;for(nt in d)_e[nt]=i[nt];return j&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=_e),_e}function Zf(e){return e=e.childContextTypes,e!=null}function $f(){E(Wf),E(H)}function ag(e,i,d){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,d)}function bg(e,i,d){var j=e.stateNode;if(i=i.childContextTypes,typeof j.getChildContext!="function")return d;j=j.getChildContext();for(var _e in j)if(!(_e in i))throw Error(p(108,Ra(e)||"Unknown",_e));return A({},d,j)}function cg(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,e),G(Wf,Wf.current),!0}function dg(e,i,d){var j=e.stateNode;if(!j)throw Error(p(169));d?(e=bg(e,i,Xf),j.__reactInternalMemoizedMergedChildContext=e,E(Wf),E(H),G(H,e)):E(Wf),G(Wf,d)}var eg=null,fg=!1,gg=!1;function hg(e){eg===null?eg=[e]:eg.push(e)}function ig(e){fg=!0,hg(e)}function jg(){if(!gg&&eg!==null){gg=!0;var e=0,i=C;try{var d=eg;for(C=1;e<d.length;e++){var j=d[e];do j=j(!0);while(j!==null)}eg=null,fg=!1}catch(_e){throw eg!==null&&(eg=eg.slice(e+1)),ac(fc,jg),_e}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(e,i){kg[lg++]=ng,kg[lg++]=mg,mg=e,ng=i}function ug(e,i,d){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=e;var j=rg;e=sg;var _e=32-oc(j)-1;j&=~(1<<_e),d+=1;var nt=32-oc(i)+_e;if(30<nt){var ct=_e-_e%5;nt=(j&(1<<ct)-1).toString(32),j>>=ct,_e-=ct,rg=1<<32-oc(i)+_e|d<<_e|j,sg=nt+e}else rg=1<<nt|d<<_e|j,sg=e}function vg(e){e.return!==null&&(tg(e,1),ug(e,1,0))}function wg(e){for(;e===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;e===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(e,i){var d=Bg(5,null,null,0);d.elementType="DELETED",d.stateNode=i,d.return=e,i=e.deletions,i===null?(e.deletions=[d],e.flags|=16):i.push(d)}function Cg(e,i){switch(e.tag){case 5:var d=e.type;return i=i.nodeType!==1||d.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(e.stateNode=i,xg=e,yg=Lf(i.firstChild),!0):!1;case 6:return i=e.pendingProps===""||i.nodeType!==3?null:i,i!==null?(e.stateNode=i,xg=e,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(d=qg!==null?{id:rg,overflow:sg}:null,e.memoizedState={dehydrated:i,treeContext:d,retryLane:1073741824},d=Bg(18,null,null,0),d.stateNode=i,d.return=e,e.child=d,xg=e,yg=null,!0):!1;default:return!1}}function Dg(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Eg(e){if(I){var i=yg;if(i){var d=i;if(!Cg(e,i)){if(Dg(e))throw Error(p(418));i=Lf(d.nextSibling);var j=xg;i&&Cg(e,i)?Ag(j,d):(e.flags=e.flags&-4097|2,I=!1,xg=e)}}else{if(Dg(e))throw Error(p(418));e.flags=e.flags&-4097|2,I=!1,xg=e}}}function Fg(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;xg=e}function Gg(e){if(e!==xg)return!1;if(!I)return Fg(e),I=!0,!1;var i;if((i=e.tag!==3)&&!(i=e.tag!==5)&&(i=e.type,i=i!=="head"&&i!=="body"&&!Ef(e.type,e.memoizedProps)),i&&(i=yg)){if(Dg(e))throw Hg(),Error(p(418));for(;i;)Ag(e,i),i=Lf(i.nextSibling)}if(Fg(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(p(317));e:{for(e=e.nextSibling,i=0;e;){if(e.nodeType===8){var d=e.data;if(d==="/$"){if(i===0){yg=Lf(e.nextSibling);break e}i--}else d!=="$"&&d!=="$!"&&d!=="$?"||i++}e=e.nextSibling}yg=null}}else yg=xg?Lf(e.stateNode.nextSibling):null;return!0}function Hg(){for(var e=yg;e;)e=Lf(e.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(e){zg===null?zg=[e]:zg.push(e)}var Kg=ua.ReactCurrentBatchConfig;function Lg(e,i,d){if(e=d.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(p(309));var j=d.stateNode}if(!j)throw Error(p(147,e));var _e=j,nt=""+e;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===nt?i.ref:(i=function(ct){var c=_e.refs;ct===null?delete c[nt]:c[nt]=ct},i._stringRef=nt,i)}if(typeof e!="string")throw Error(p(284));if(!d._owner)throw Error(p(290,e))}return e}function Mg(e,i){throw e=Object.prototype.toString.call(i),Error(p(31,e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e))}function Ng(e){var i=e._init;return i(e._payload)}function Og(e){function i(Dt,It){if(e){var Mt=Dt.deletions;Mt===null?(Dt.deletions=[It],Dt.flags|=16):Mt.push(It)}}function d(Dt,It){if(!e)return null;for(;It!==null;)i(Dt,It),It=It.sibling;return null}function j(Dt,It){for(Dt=new Map;It!==null;)It.key!==null?Dt.set(It.key,It):Dt.set(It.index,It),It=It.sibling;return Dt}function _e(Dt,It){return Dt=Pg(Dt,It),Dt.index=0,Dt.sibling=null,Dt}function nt(Dt,It,Mt){return Dt.index=Mt,e?(Mt=Dt.alternate,Mt!==null?(Mt=Mt.index,Mt<It?(Dt.flags|=2,It):Mt):(Dt.flags|=2,It)):(Dt.flags|=1048576,It)}function ct(Dt){return e&&Dt.alternate===null&&(Dt.flags|=2),Dt}function c(Dt,It,Mt,Ht){return It===null||It.tag!==6?(It=Qg(Mt,Dt.mode,Ht),It.return=Dt,It):(It=_e(It,Mt),It.return=Dt,It)}function pt(Dt,It,Mt,Ht){var tr=Mt.type;return tr===ya?St(Dt,It,Mt.props.children,Ht,Mt.key):It!==null&&(It.elementType===tr||typeof tr=="object"&&tr!==null&&tr.$$typeof===Ha&&Ng(tr)===It.type)?(Ht=_e(It,Mt.props),Ht.ref=Lg(Dt,It,Mt),Ht.return=Dt,Ht):(Ht=Rg(Mt.type,Mt.key,Mt.props,null,Dt.mode,Ht),Ht.ref=Lg(Dt,It,Mt),Ht.return=Dt,Ht)}function gt(Dt,It,Mt,Ht){return It===null||It.tag!==4||It.stateNode.containerInfo!==Mt.containerInfo||It.stateNode.implementation!==Mt.implementation?(It=Sg(Mt,Dt.mode,Ht),It.return=Dt,It):(It=_e(It,Mt.children||[]),It.return=Dt,It)}function St(Dt,It,Mt,Ht,tr){return It===null||It.tag!==7?(It=Tg(Mt,Dt.mode,Ht,tr),It.return=Dt,It):(It=_e(It,Mt),It.return=Dt,It)}function kt(Dt,It,Mt){if(typeof It=="string"&&It!==""||typeof It=="number")return It=Qg(""+It,Dt.mode,Mt),It.return=Dt,It;if(typeof It=="object"&&It!==null){switch(It.$$typeof){case va:return Mt=Rg(It.type,It.key,It.props,null,Dt.mode,Mt),Mt.ref=Lg(Dt,null,It),Mt.return=Dt,Mt;case wa:return It=Sg(It,Dt.mode,Mt),It.return=Dt,It;case Ha:var Ht=It._init;return kt(Dt,Ht(It._payload),Mt)}if(eb(It)||Ka(It))return It=Tg(It,Dt.mode,Mt,null),It.return=Dt,It;Mg(Dt,It)}return null}function At(Dt,It,Mt,Ht){var tr=It!==null?It.key:null;if(typeof Mt=="string"&&Mt!==""||typeof Mt=="number")return tr!==null?null:c(Dt,It,""+Mt,Ht);if(typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case va:return Mt.key===tr?pt(Dt,It,Mt,Ht):null;case wa:return Mt.key===tr?gt(Dt,It,Mt,Ht):null;case Ha:return tr=Mt._init,At(Dt,It,tr(Mt._payload),Ht)}if(eb(Mt)||Ka(Mt))return tr!==null?null:St(Dt,It,Mt,Ht,null);Mg(Dt,Mt)}return null}function Nt(Dt,It,Mt,Ht,tr){if(typeof Ht=="string"&&Ht!==""||typeof Ht=="number")return Dt=Dt.get(Mt)||null,c(It,Dt,""+Ht,tr);if(typeof Ht=="object"&&Ht!==null){switch(Ht.$$typeof){case va:return Dt=Dt.get(Ht.key===null?Mt:Ht.key)||null,pt(It,Dt,Ht,tr);case wa:return Dt=Dt.get(Ht.key===null?Mt:Ht.key)||null,gt(It,Dt,Ht,tr);case Ha:var er=Ht._init;return Nt(Dt,It,Mt,er(Ht._payload),tr)}if(eb(Ht)||Ka(Ht))return Dt=Dt.get(Mt)||null,St(It,Dt,Ht,tr,null);Mg(It,Ht)}return null}function Vt(Dt,It,Mt,Ht){for(var tr=null,er=null,dr=It,mr=It=0,Ur=null;dr!==null&&mr<Mt.length;mr++){dr.index>mr?(Ur=dr,dr=null):Ur=dr.sibling;var Dr=At(Dt,dr,Mt[mr],Ht);if(Dr===null){dr===null&&(dr=Ur);break}e&&dr&&Dr.alternate===null&&i(Dt,dr),It=nt(Dr,It,mr),er===null?tr=Dr:er.sibling=Dr,er=Dr,dr=Ur}if(mr===Mt.length)return d(Dt,dr),I&&tg(Dt,mr),tr;if(dr===null){for(;mr<Mt.length;mr++)dr=kt(Dt,Mt[mr],Ht),dr!==null&&(It=nt(dr,It,mr),er===null?tr=dr:er.sibling=dr,er=dr);return I&&tg(Dt,mr),tr}for(dr=j(Dt,dr);mr<Mt.length;mr++)Ur=Nt(dr,Dt,mr,Mt[mr],Ht),Ur!==null&&(e&&Ur.alternate!==null&&dr.delete(Ur.key===null?mr:Ur.key),It=nt(Ur,It,mr),er===null?tr=Ur:er.sibling=Ur,er=Ur);return e&&dr.forEach(function(Yr){return i(Dt,Yr)}),I&&tg(Dt,mr),tr}function zt(Dt,It,Mt,Ht){var tr=Ka(Mt);if(typeof tr!="function")throw Error(p(150));if(Mt=tr.call(Mt),Mt==null)throw Error(p(151));for(var er=tr=null,dr=It,mr=It=0,Ur=null,Dr=Mt.next();dr!==null&&!Dr.done;mr++,Dr=Mt.next()){dr.index>mr?(Ur=dr,dr=null):Ur=dr.sibling;var Yr=At(Dt,dr,Dr.value,Ht);if(Yr===null){dr===null&&(dr=Ur);break}e&&dr&&Yr.alternate===null&&i(Dt,dr),It=nt(Yr,It,mr),er===null?tr=Yr:er.sibling=Yr,er=Yr,dr=Ur}if(Dr.done)return d(Dt,dr),I&&tg(Dt,mr),tr;if(dr===null){for(;!Dr.done;mr++,Dr=Mt.next())Dr=kt(Dt,Dr.value,Ht),Dr!==null&&(It=nt(Dr,It,mr),er===null?tr=Dr:er.sibling=Dr,er=Dr);return I&&tg(Dt,mr),tr}for(dr=j(Dt,dr);!Dr.done;mr++,Dr=Mt.next())Dr=Nt(dr,Dt,mr,Dr.value,Ht),Dr!==null&&(e&&Dr.alternate!==null&&dr.delete(Dr.key===null?mr:Dr.key),It=nt(Dr,It,mr),er===null?tr=Dr:er.sibling=Dr,er=Dr);return e&&dr.forEach(function(es){return i(Dt,es)}),I&&tg(Dt,mr),tr}function Jt(Dt,It,Mt,Ht){if(typeof Mt=="object"&&Mt!==null&&Mt.type===ya&&Mt.key===null&&(Mt=Mt.props.children),typeof Mt=="object"&&Mt!==null){switch(Mt.$$typeof){case va:e:{for(var tr=Mt.key,er=It;er!==null;){if(er.key===tr){if(tr=Mt.type,tr===ya){if(er.tag===7){d(Dt,er.sibling),It=_e(er,Mt.props.children),It.return=Dt,Dt=It;break e}}else if(er.elementType===tr||typeof tr=="object"&&tr!==null&&tr.$$typeof===Ha&&Ng(tr)===er.type){d(Dt,er.sibling),It=_e(er,Mt.props),It.ref=Lg(Dt,er,Mt),It.return=Dt,Dt=It;break e}d(Dt,er);break}else i(Dt,er);er=er.sibling}Mt.type===ya?(It=Tg(Mt.props.children,Dt.mode,Ht,Mt.key),It.return=Dt,Dt=It):(Ht=Rg(Mt.type,Mt.key,Mt.props,null,Dt.mode,Ht),Ht.ref=Lg(Dt,It,Mt),Ht.return=Dt,Dt=Ht)}return ct(Dt);case wa:e:{for(er=Mt.key;It!==null;){if(It.key===er)if(It.tag===4&&It.stateNode.containerInfo===Mt.containerInfo&&It.stateNode.implementation===Mt.implementation){d(Dt,It.sibling),It=_e(It,Mt.children||[]),It.return=Dt,Dt=It;break e}else{d(Dt,It);break}else i(Dt,It);It=It.sibling}It=Sg(Mt,Dt.mode,Ht),It.return=Dt,Dt=It}return ct(Dt);case Ha:return er=Mt._init,Jt(Dt,It,er(Mt._payload),Ht)}if(eb(Mt))return Vt(Dt,It,Mt,Ht);if(Ka(Mt))return zt(Dt,It,Mt,Ht);Mg(Dt,Mt)}return typeof Mt=="string"&&Mt!==""||typeof Mt=="number"?(Mt=""+Mt,It!==null&&It.tag===6?(d(Dt,It.sibling),It=_e(It,Mt),It.return=Dt,Dt=It):(d(Dt,It),It=Qg(Mt,Dt.mode,Ht),It.return=Dt,Dt=It),ct(Dt)):d(Dt,It)}return Jt}var Ug=Og(!0),Vg=Og(!1),Wg=Uf(null),Xg=null,Yg=null,Zg=null;function $g(){Zg=Yg=Xg=null}function ah(e){var i=Wg.current;E(Wg),e._currentValue=i}function bh(e,i,d){for(;e!==null;){var j=e.alternate;if((e.childLanes&i)!==i?(e.childLanes|=i,j!==null&&(j.childLanes|=i)):j!==null&&(j.childLanes&i)!==i&&(j.childLanes|=i),e===d)break;e=e.return}}function ch(e,i){Xg=e,Zg=Yg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&i&&(dh=!0),e.firstContext=null)}function eh(e){var i=e._currentValue;if(Zg!==e)if(e={context:e,memoizedValue:i,next:null},Yg===null){if(Xg===null)throw Error(p(308));Yg=e,Xg.dependencies={lanes:0,firstContext:e}}else Yg=Yg.next=e;return i}var fh=null;function gh(e){fh===null?fh=[e]:fh.push(e)}function hh(e,i,d,j){var _e=i.interleaved;return _e===null?(d.next=d,gh(i)):(d.next=_e.next,_e.next=d),i.interleaved=d,ih(e,j)}function ih(e,i){e.lanes|=i;var d=e.alternate;for(d!==null&&(d.lanes|=i),d=e,e=e.return;e!==null;)e.childLanes|=i,d=e.alternate,d!==null&&(d.childLanes|=i),d=e,e=e.return;return d.tag===3?d.stateNode:null}var jh=!1;function kh(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lh(e,i){e=e.updateQueue,i.updateQueue===e&&(i.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mh(e,i){return{eventTime:e,lane:i,tag:0,payload:null,callback:null,next:null}}function nh(e,i,d){var j=e.updateQueue;if(j===null)return null;if(j=j.shared,K&2){var _e=j.pending;return _e===null?i.next=i:(i.next=_e.next,_e.next=i),j.pending=i,ih(e,d)}return _e=j.interleaved,_e===null?(i.next=i,gh(j)):(i.next=_e.next,_e.next=i),j.interleaved=i,ih(e,d)}function oh(e,i,d){if(i=i.updateQueue,i!==null&&(i=i.shared,(d&4194240)!==0)){var j=i.lanes;j&=e.pendingLanes,d|=j,i.lanes=d,Cc(e,d)}}function ph(e,i){var d=e.updateQueue,j=e.alternate;if(j!==null&&(j=j.updateQueue,d===j)){var _e=null,nt=null;if(d=d.firstBaseUpdate,d!==null){do{var ct={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};nt===null?_e=nt=ct:nt=nt.next=ct,d=d.next}while(d!==null);nt===null?_e=nt=i:nt=nt.next=i}else _e=nt=i;d={baseState:j.baseState,firstBaseUpdate:_e,lastBaseUpdate:nt,shared:j.shared,effects:j.effects},e.updateQueue=d;return}e=d.lastBaseUpdate,e===null?d.firstBaseUpdate=i:e.next=i,d.lastBaseUpdate=i}function qh(e,i,d,j){var _e=e.updateQueue;jh=!1;var nt=_e.firstBaseUpdate,ct=_e.lastBaseUpdate,c=_e.shared.pending;if(c!==null){_e.shared.pending=null;var pt=c,gt=pt.next;pt.next=null,ct===null?nt=gt:ct.next=gt,ct=pt;var St=e.alternate;St!==null&&(St=St.updateQueue,c=St.lastBaseUpdate,c!==ct&&(c===null?St.firstBaseUpdate=gt:c.next=gt,St.lastBaseUpdate=pt))}if(nt!==null){var kt=_e.baseState;ct=0,St=gt=pt=null,c=nt;do{var At=c.lane,Nt=c.eventTime;if((j&At)===At){St!==null&&(St=St.next={eventTime:Nt,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var Vt=e,zt=c;switch(At=i,Nt=d,zt.tag){case 1:if(Vt=zt.payload,typeof Vt=="function"){kt=Vt.call(Nt,kt,At);break e}kt=Vt;break e;case 3:Vt.flags=Vt.flags&-65537|128;case 0:if(Vt=zt.payload,At=typeof Vt=="function"?Vt.call(Nt,kt,At):Vt,At==null)break e;kt=A({},kt,At);break e;case 2:jh=!0}}c.callback!==null&&c.lane!==0&&(e.flags|=64,At=_e.effects,At===null?_e.effects=[c]:At.push(c))}else Nt={eventTime:Nt,lane:At,tag:c.tag,payload:c.payload,callback:c.callback,next:null},St===null?(gt=St=Nt,pt=kt):St=St.next=Nt,ct|=At;if(c=c.next,c===null){if(c=_e.shared.pending,c===null)break;At=c,c=At.next,At.next=null,_e.lastBaseUpdate=At,_e.shared.pending=null}}while(!0);if(St===null&&(pt=kt),_e.baseState=pt,_e.firstBaseUpdate=gt,_e.lastBaseUpdate=St,i=_e.shared.interleaved,i!==null){_e=i;do ct|=_e.lane,_e=_e.next;while(_e!==i)}else nt===null&&(_e.shared.lanes=0);rh|=ct,e.lanes=ct,e.memoizedState=kt}}function sh(e,i,d){if(e=i.effects,i.effects=null,e!==null)for(i=0;i<e.length;i++){var j=e[i],_e=j.callback;if(_e!==null){if(j.callback=null,j=d,typeof _e!="function")throw Error(p(191,_e));_e.call(j)}}}var th={},uh=Uf(th),vh$1=Uf(th),wh=Uf(th);function xh(e){if(e===th)throw Error(p(174));return e}function yh(e,i){switch(G(wh,i),G(vh$1,e),G(uh,th),e=i.nodeType,e){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:e=e===8?i.parentNode:i,i=e.namespaceURI||null,e=e.tagName,i=lb(i,e)}E(uh),G(uh,i)}function zh(){E(uh),E(vh$1),E(wh)}function Ah(e){xh(wh.current);var i=xh(uh.current),d=lb(i,e.type);i!==d&&(G(vh$1,e),G(uh,d))}function Bh(e){vh$1.current===e&&(E(uh),E(vh$1))}var L=Uf(0);function Ch(e){for(var i=e;i!==null;){if(i.tag===13){var d=i.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Dh=[];function Eh(){for(var e=0;e<Dh.length;e++)Dh[e]._workInProgressVersionPrimary=null;Dh.length=0}var Fh=ua.ReactCurrentDispatcher,Gh=ua.ReactCurrentBatchConfig,Hh=0,M$1=null,N=null,O=null,Ih=!1,Jh=!1,Kh=0,Lh=0;function P(){throw Error(p(321))}function Mh(e,i){if(i===null)return!1;for(var d=0;d<i.length&&d<e.length;d++)if(!He(e[d],i[d]))return!1;return!0}function Nh(e,i,d,j,_e,nt){if(Hh=nt,M$1=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Fh.current=e===null||e.memoizedState===null?Oh:Ph,e=d(j,_e),Jh){nt=0;do{if(Jh=!1,Kh=0,25<=nt)throw Error(p(301));nt+=1,O=N=null,i.updateQueue=null,Fh.current=Qh,e=d(j,_e)}while(Jh)}if(Fh.current=Rh,i=N!==null&&N.next!==null,Hh=0,O=N=M$1=null,Ih=!1,i)throw Error(p(300));return e}function Sh(){var e=Kh!==0;return Kh=0,e}function Th(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return O===null?M$1.memoizedState=O=e:O=O.next=e,O}function Uh(){if(N===null){var e=M$1.alternate;e=e!==null?e.memoizedState:null}else e=N.next;var i=O===null?M$1.memoizedState:O.next;if(i!==null)O=i,N=e;else{if(e===null)throw Error(p(310));N=e,e={memoizedState:N.memoizedState,baseState:N.baseState,baseQueue:N.baseQueue,queue:N.queue,next:null},O===null?M$1.memoizedState=O=e:O=O.next=e}return O}function Vh(e,i){return typeof i=="function"?i(e):i}function Wh(e){var i=Uh(),d=i.queue;if(d===null)throw Error(p(311));d.lastRenderedReducer=e;var j=N,_e=j.baseQueue,nt=d.pending;if(nt!==null){if(_e!==null){var ct=_e.next;_e.next=nt.next,nt.next=ct}j.baseQueue=_e=nt,d.pending=null}if(_e!==null){nt=_e.next,j=j.baseState;var c=ct=null,pt=null,gt=nt;do{var St=gt.lane;if((Hh&St)===St)pt!==null&&(pt=pt.next={lane:0,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null}),j=gt.hasEagerState?gt.eagerState:e(j,gt.action);else{var kt={lane:St,action:gt.action,hasEagerState:gt.hasEagerState,eagerState:gt.eagerState,next:null};pt===null?(c=pt=kt,ct=j):pt=pt.next=kt,M$1.lanes|=St,rh|=St}gt=gt.next}while(gt!==null&&gt!==nt);pt===null?ct=j:pt.next=c,He(j,i.memoizedState)||(dh=!0),i.memoizedState=j,i.baseState=ct,i.baseQueue=pt,d.lastRenderedState=j}if(e=d.interleaved,e!==null){_e=e;do nt=_e.lane,M$1.lanes|=nt,rh|=nt,_e=_e.next;while(_e!==e)}else _e===null&&(d.lanes=0);return[i.memoizedState,d.dispatch]}function Xh(e){var i=Uh(),d=i.queue;if(d===null)throw Error(p(311));d.lastRenderedReducer=e;var j=d.dispatch,_e=d.pending,nt=i.memoizedState;if(_e!==null){d.pending=null;var ct=_e=_e.next;do nt=e(nt,ct.action),ct=ct.next;while(ct!==_e);He(nt,i.memoizedState)||(dh=!0),i.memoizedState=nt,i.baseQueue===null&&(i.baseState=nt),d.lastRenderedState=nt}return[nt,j]}function Yh(){}function Zh(e,i){var d=M$1,j=Uh(),_e=i(),nt=!He(j.memoizedState,_e);if(nt&&(j.memoizedState=_e,dh=!0),j=j.queue,$h(ai.bind(null,d,j,e),[e]),j.getSnapshot!==i||nt||O!==null&&O.memoizedState.tag&1){if(d.flags|=2048,bi(9,ci.bind(null,d,j,_e,i),void 0,null),Q===null)throw Error(p(349));Hh&30||di(d,i,_e)}return _e}function di(e,i,d){e.flags|=16384,e={getSnapshot:i,value:d},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.stores=[e]):(d=i.stores,d===null?i.stores=[e]:d.push(e))}function ci(e,i,d,j){i.value=d,i.getSnapshot=j,ei(i)&&fi(e)}function ai(e,i,d){return d(function(){ei(i)&&fi(e)})}function ei(e){var i=e.getSnapshot;e=e.value;try{var d=i();return!He(e,d)}catch{return!0}}function fi(e){var i=ih(e,1);i!==null&&gi(i,e,1,-1)}function hi(e){var i=Th();return typeof e=="function"&&(e=e()),i.memoizedState=i.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vh,lastRenderedState:e},i.queue=e,e=e.dispatch=ii.bind(null,M$1,e),[i.memoizedState,e]}function bi(e,i,d,j){return e={tag:e,create:i,destroy:d,deps:j,next:null},i=M$1.updateQueue,i===null?(i={lastEffect:null,stores:null},M$1.updateQueue=i,i.lastEffect=e.next=e):(d=i.lastEffect,d===null?i.lastEffect=e.next=e:(j=d.next,d.next=e,e.next=j,i.lastEffect=e)),e}function ji(){return Uh().memoizedState}function ki(e,i,d,j){var _e=Th();M$1.flags|=e,_e.memoizedState=bi(1|i,d,void 0,j===void 0?null:j)}function li(e,i,d,j){var _e=Uh();j=j===void 0?null:j;var nt=void 0;if(N!==null){var ct=N.memoizedState;if(nt=ct.destroy,j!==null&&Mh(j,ct.deps)){_e.memoizedState=bi(i,d,nt,j);return}}M$1.flags|=e,_e.memoizedState=bi(1|i,d,nt,j)}function mi(e,i){return ki(8390656,8,e,i)}function $h(e,i){return li(2048,8,e,i)}function ni(e,i){return li(4,2,e,i)}function oi(e,i){return li(4,4,e,i)}function pi(e,i){if(typeof i=="function")return e=e(),i(e),function(){i(null)};if(i!=null)return e=e(),i.current=e,function(){i.current=null}}function qi(e,i,d){return d=d!=null?d.concat([e]):null,li(4,4,pi.bind(null,i,e),d)}function ri(){}function si(e,i){var d=Uh();i=i===void 0?null:i;var j=d.memoizedState;return j!==null&&i!==null&&Mh(i,j[1])?j[0]:(d.memoizedState=[e,i],e)}function ti(e,i){var d=Uh();i=i===void 0?null:i;var j=d.memoizedState;return j!==null&&i!==null&&Mh(i,j[1])?j[0]:(e=e(),d.memoizedState=[e,i],e)}function ui(e,i,d){return Hh&21?(He(d,i)||(d=yc(),M$1.lanes|=d,rh|=d,e.baseState=!0),i):(e.baseState&&(e.baseState=!1,dh=!0),e.memoizedState=d)}function vi(e,i){var d=C;C=d!==0&&4>d?d:4,e(!0);var j=Gh.transition;Gh.transition={};try{e(!1),i()}finally{C=d,Gh.transition=j}}function wi(){return Uh().memoizedState}function xi(e,i,d){var j=yi(e);if(d={lane:j,action:d,hasEagerState:!1,eagerState:null,next:null},zi(e))Ai(i,d);else if(d=hh(e,i,d,j),d!==null){var _e=R();gi(d,e,j,_e),Bi(d,i,j)}}function ii(e,i,d){var j=yi(e),_e={lane:j,action:d,hasEagerState:!1,eagerState:null,next:null};if(zi(e))Ai(i,_e);else{var nt=e.alternate;if(e.lanes===0&&(nt===null||nt.lanes===0)&&(nt=i.lastRenderedReducer,nt!==null))try{var ct=i.lastRenderedState,c=nt(ct,d);if(_e.hasEagerState=!0,_e.eagerState=c,He(c,ct)){var pt=i.interleaved;pt===null?(_e.next=_e,gh(i)):(_e.next=pt.next,pt.next=_e),i.interleaved=_e;return}}catch{}finally{}d=hh(e,i,_e,j),d!==null&&(_e=R(),gi(d,e,j,_e),Bi(d,i,j))}}function zi(e){var i=e.alternate;return e===M$1||i!==null&&i===M$1}function Ai(e,i){Jh=Ih=!0;var d=e.pending;d===null?i.next=i:(i.next=d.next,d.next=i),e.pending=i}function Bi(e,i,d){if(d&4194240){var j=i.lanes;j&=e.pendingLanes,d|=j,i.lanes=d,Cc(e,d)}}var Rh={readContext:eh,useCallback:P,useContext:P,useEffect:P,useImperativeHandle:P,useInsertionEffect:P,useLayoutEffect:P,useMemo:P,useReducer:P,useRef:P,useState:P,useDebugValue:P,useDeferredValue:P,useTransition:P,useMutableSource:P,useSyncExternalStore:P,useId:P,unstable_isNewReconciler:!1},Oh={readContext:eh,useCallback:function(e,i){return Th().memoizedState=[e,i===void 0?null:i],e},useContext:eh,useEffect:mi,useImperativeHandle:function(e,i,d){return d=d!=null?d.concat([e]):null,ki(4194308,4,pi.bind(null,i,e),d)},useLayoutEffect:function(e,i){return ki(4194308,4,e,i)},useInsertionEffect:function(e,i){return ki(4,2,e,i)},useMemo:function(e,i){var d=Th();return i=i===void 0?null:i,e=e(),d.memoizedState=[e,i],e},useReducer:function(e,i,d){var j=Th();return i=d!==void 0?d(i):i,j.memoizedState=j.baseState=i,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},j.queue=e,e=e.dispatch=xi.bind(null,M$1,e),[j.memoizedState,e]},useRef:function(e){var i=Th();return e={current:e},i.memoizedState=e},useState:hi,useDebugValue:ri,useDeferredValue:function(e){return Th().memoizedState=e},useTransition:function(){var e=hi(!1),i=e[0];return e=vi.bind(null,e[1]),Th().memoizedState=e,[i,e]},useMutableSource:function(){},useSyncExternalStore:function(e,i,d){var j=M$1,_e=Th();if(I){if(d===void 0)throw Error(p(407));d=d()}else{if(d=i(),Q===null)throw Error(p(349));Hh&30||di(j,i,d)}_e.memoizedState=d;var nt={value:d,getSnapshot:i};return _e.queue=nt,mi(ai.bind(null,j,nt,e),[e]),j.flags|=2048,bi(9,ci.bind(null,j,nt,d,i),void 0,null),d},useId:function(){var e=Th(),i=Q.identifierPrefix;if(I){var d=sg,j=rg;d=(j&~(1<<32-oc(j)-1)).toString(32)+d,i=":"+i+"R"+d,d=Kh++,0<d&&(i+="H"+d.toString(32)),i+=":"}else d=Lh++,i=":"+i+"r"+d.toString(32)+":";return e.memoizedState=i},unstable_isNewReconciler:!1},Ph={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Wh,useRef:ji,useState:function(){return Wh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return ui(i,N.memoizedState,e)},useTransition:function(){var e=Wh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1},Qh={readContext:eh,useCallback:si,useContext:eh,useEffect:$h,useImperativeHandle:qi,useInsertionEffect:ni,useLayoutEffect:oi,useMemo:ti,useReducer:Xh,useRef:ji,useState:function(){return Xh(Vh)},useDebugValue:ri,useDeferredValue:function(e){var i=Uh();return N===null?i.memoizedState=e:ui(i,N.memoizedState,e)},useTransition:function(){var e=Xh(Vh)[0],i=Uh().memoizedState;return[e,i]},useMutableSource:Yh,useSyncExternalStore:Zh,useId:wi,unstable_isNewReconciler:!1};function Ci(e,i){if(e&&e.defaultProps){i=A({},i),e=e.defaultProps;for(var d in e)i[d]===void 0&&(i[d]=e[d]);return i}return i}function Di(e,i,d,j){i=e.memoizedState,d=d(j,i),d=d==null?i:A({},i,d),e.memoizedState=d,e.lanes===0&&(e.updateQueue.baseState=d)}var Ei={isMounted:function(e){return(e=e._reactInternals)?Vb(e)===e:!1},enqueueSetState:function(e,i,d){e=e._reactInternals;var j=R(),_e=yi(e),nt=mh(j,_e);nt.payload=i,d!=null&&(nt.callback=d),i=nh(e,nt,_e),i!==null&&(gi(i,e,_e,j),oh(i,e,_e))},enqueueReplaceState:function(e,i,d){e=e._reactInternals;var j=R(),_e=yi(e),nt=mh(j,_e);nt.tag=1,nt.payload=i,d!=null&&(nt.callback=d),i=nh(e,nt,_e),i!==null&&(gi(i,e,_e,j),oh(i,e,_e))},enqueueForceUpdate:function(e,i){e=e._reactInternals;var d=R(),j=yi(e),_e=mh(d,j);_e.tag=2,i!=null&&(_e.callback=i),i=nh(e,_e,j),i!==null&&(gi(i,e,j,d),oh(i,e,j))}};function Fi(e,i,d,j,_e,nt,ct){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(j,nt,ct):i.prototype&&i.prototype.isPureReactComponent?!Ie(d,j)||!Ie(_e,nt):!0}function Gi(e,i,d){var j=!1,_e=Vf,nt=i.contextType;return typeof nt=="object"&&nt!==null?nt=eh(nt):(_e=Zf(i)?Xf:H.current,j=i.contextTypes,nt=(j=j!=null)?Yf(e,_e):Vf),i=new i(d,nt),e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ei,e.stateNode=i,i._reactInternals=e,j&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=_e,e.__reactInternalMemoizedMaskedChildContext=nt),i}function Hi(e,i,d,j){e=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(d,j),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(d,j),i.state!==e&&Ei.enqueueReplaceState(i,i.state,null)}function Ii(e,i,d,j){var _e=e.stateNode;_e.props=d,_e.state=e.memoizedState,_e.refs={},kh(e);var nt=i.contextType;typeof nt=="object"&&nt!==null?_e.context=eh(nt):(nt=Zf(i)?Xf:H.current,_e.context=Yf(e,nt)),_e.state=e.memoizedState,nt=i.getDerivedStateFromProps,typeof nt=="function"&&(Di(e,i,nt,d),_e.state=e.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof _e.getSnapshotBeforeUpdate=="function"||typeof _e.UNSAFE_componentWillMount!="function"&&typeof _e.componentWillMount!="function"||(i=_e.state,typeof _e.componentWillMount=="function"&&_e.componentWillMount(),typeof _e.UNSAFE_componentWillMount=="function"&&_e.UNSAFE_componentWillMount(),i!==_e.state&&Ei.enqueueReplaceState(_e,_e.state,null),qh(e,d,_e,j),_e.state=e.memoizedState),typeof _e.componentDidMount=="function"&&(e.flags|=4194308)}function Ji(e,i){try{var d="",j=i;do d+=Pa(j),j=j.return;while(j);var _e=d}catch(nt){_e=`
Error generating stack: `+nt.message+`
`+nt.stack}return{value:e,source:i,stack:_e,digest:null}}function Ki(e,i,d){return{value:e,source:null,stack:d??null,digest:i??null}}function Li(e,i){try{console.error(i.value)}catch(d){setTimeout(function(){throw d})}}var Mi=typeof WeakMap=="function"?WeakMap:Map;function Ni(e,i,d){d=mh(-1,d),d.tag=3,d.payload={element:null};var j=i.value;return d.callback=function(){Oi||(Oi=!0,Pi=j),Li(e,i)},d}function Qi(e,i,d){d=mh(-1,d),d.tag=3;var j=e.type.getDerivedStateFromError;if(typeof j=="function"){var _e=i.value;d.payload=function(){return j(_e)},d.callback=function(){Li(e,i)}}var nt=e.stateNode;return nt!==null&&typeof nt.componentDidCatch=="function"&&(d.callback=function(){Li(e,i),typeof j!="function"&&(Ri===null?Ri=new Set([this]):Ri.add(this));var ct=i.stack;this.componentDidCatch(i.value,{componentStack:ct!==null?ct:""})}),d}function Si(e,i,d){var j=e.pingCache;if(j===null){j=e.pingCache=new Mi;var _e=new Set;j.set(i,_e)}else _e=j.get(i),_e===void 0&&(_e=new Set,j.set(i,_e));_e.has(d)||(_e.add(d),e=Ti.bind(null,e,i,d),i.then(e,e))}function Ui(e){do{var i;if((i=e.tag===13)&&(i=e.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return e;e=e.return}while(e!==null);return null}function Vi(e,i,d,j,_e){return e.mode&1?(e.flags|=65536,e.lanes=_e,e):(e===i?e.flags|=65536:(e.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(i=mh(-1,1),i.tag=2,nh(d,i,1))),d.lanes|=1),e)}var Wi=ua.ReactCurrentOwner,dh=!1;function Xi(e,i,d,j){i.child=e===null?Vg(i,null,d,j):Ug(i,e.child,d,j)}function Yi(e,i,d,j,_e){d=d.render;var nt=i.ref;return ch(i,_e),j=Nh(e,i,d,j,nt,_e),d=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_e,Zi(e,i,_e)):(I&&d&&vg(i),i.flags|=1,Xi(e,i,j,_e),i.child)}function $i(e,i,d,j,_e){if(e===null){var nt=d.type;return typeof nt=="function"&&!aj(nt)&&nt.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(i.tag=15,i.type=nt,bj(e,i,nt,j,_e)):(e=Rg(d.type,null,j,i,i.mode,_e),e.ref=i.ref,e.return=i,i.child=e)}if(nt=e.child,!(e.lanes&_e)){var ct=nt.memoizedProps;if(d=d.compare,d=d!==null?d:Ie,d(ct,j)&&e.ref===i.ref)return Zi(e,i,_e)}return i.flags|=1,e=Pg(nt,j),e.ref=i.ref,e.return=i,i.child=e}function bj(e,i,d,j,_e){if(e!==null){var nt=e.memoizedProps;if(Ie(nt,j)&&e.ref===i.ref)if(dh=!1,i.pendingProps=j=nt,(e.lanes&_e)!==0)e.flags&131072&&(dh=!0);else return i.lanes=e.lanes,Zi(e,i,_e)}return cj(e,i,d,j,_e)}function dj(e,i,d){var j=i.pendingProps,_e=j.children,nt=e!==null?e.memoizedState:null;if(j.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(ej,fj),fj|=d;else{if(!(d&1073741824))return e=nt!==null?nt.baseLanes|d:d,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:e,cachePool:null,transitions:null},i.updateQueue=null,G(ej,fj),fj|=e,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},j=nt!==null?nt.baseLanes:d,G(ej,fj),fj|=j}else nt!==null?(j=nt.baseLanes|d,i.memoizedState=null):j=d,G(ej,fj),fj|=j;return Xi(e,i,_e,d),i.child}function gj(e,i){var d=i.ref;(e===null&&d!==null||e!==null&&e.ref!==d)&&(i.flags|=512,i.flags|=2097152)}function cj(e,i,d,j,_e){var nt=Zf(d)?Xf:H.current;return nt=Yf(i,nt),ch(i,_e),d=Nh(e,i,d,j,nt,_e),j=Sh(),e!==null&&!dh?(i.updateQueue=e.updateQueue,i.flags&=-2053,e.lanes&=~_e,Zi(e,i,_e)):(I&&j&&vg(i),i.flags|=1,Xi(e,i,d,_e),i.child)}function hj(e,i,d,j,_e){if(Zf(d)){var nt=!0;cg(i)}else nt=!1;if(ch(i,_e),i.stateNode===null)ij(e,i),Gi(i,d,j),Ii(i,d,j,_e),j=!0;else if(e===null){var ct=i.stateNode,c=i.memoizedProps;ct.props=c;var pt=ct.context,gt=d.contextType;typeof gt=="object"&&gt!==null?gt=eh(gt):(gt=Zf(d)?Xf:H.current,gt=Yf(i,gt));var St=d.getDerivedStateFromProps,kt=typeof St=="function"||typeof ct.getSnapshotBeforeUpdate=="function";kt||typeof ct.UNSAFE_componentWillReceiveProps!="function"&&typeof ct.componentWillReceiveProps!="function"||(c!==j||pt!==gt)&&Hi(i,ct,j,gt),jh=!1;var At=i.memoizedState;ct.state=At,qh(i,j,ct,_e),pt=i.memoizedState,c!==j||At!==pt||Wf.current||jh?(typeof St=="function"&&(Di(i,d,St,j),pt=i.memoizedState),(c=jh||Fi(i,d,c,j,At,pt,gt))?(kt||typeof ct.UNSAFE_componentWillMount!="function"&&typeof ct.componentWillMount!="function"||(typeof ct.componentWillMount=="function"&&ct.componentWillMount(),typeof ct.UNSAFE_componentWillMount=="function"&&ct.UNSAFE_componentWillMount()),typeof ct.componentDidMount=="function"&&(i.flags|=4194308)):(typeof ct.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=j,i.memoizedState=pt),ct.props=j,ct.state=pt,ct.context=gt,j=c):(typeof ct.componentDidMount=="function"&&(i.flags|=4194308),j=!1)}else{ct=i.stateNode,lh(e,i),c=i.memoizedProps,gt=i.type===i.elementType?c:Ci(i.type,c),ct.props=gt,kt=i.pendingProps,At=ct.context,pt=d.contextType,typeof pt=="object"&&pt!==null?pt=eh(pt):(pt=Zf(d)?Xf:H.current,pt=Yf(i,pt));var Nt=d.getDerivedStateFromProps;(St=typeof Nt=="function"||typeof ct.getSnapshotBeforeUpdate=="function")||typeof ct.UNSAFE_componentWillReceiveProps!="function"&&typeof ct.componentWillReceiveProps!="function"||(c!==kt||At!==pt)&&Hi(i,ct,j,pt),jh=!1,At=i.memoizedState,ct.state=At,qh(i,j,ct,_e);var Vt=i.memoizedState;c!==kt||At!==Vt||Wf.current||jh?(typeof Nt=="function"&&(Di(i,d,Nt,j),Vt=i.memoizedState),(gt=jh||Fi(i,d,gt,j,At,Vt,pt)||!1)?(St||typeof ct.UNSAFE_componentWillUpdate!="function"&&typeof ct.componentWillUpdate!="function"||(typeof ct.componentWillUpdate=="function"&&ct.componentWillUpdate(j,Vt,pt),typeof ct.UNSAFE_componentWillUpdate=="function"&&ct.UNSAFE_componentWillUpdate(j,Vt,pt)),typeof ct.componentDidUpdate=="function"&&(i.flags|=4),typeof ct.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof ct.componentDidUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=4),typeof ct.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=1024),i.memoizedProps=j,i.memoizedState=Vt),ct.props=j,ct.state=Vt,ct.context=pt,j=gt):(typeof ct.componentDidUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=4),typeof ct.getSnapshotBeforeUpdate!="function"||c===e.memoizedProps&&At===e.memoizedState||(i.flags|=1024),j=!1)}return jj(e,i,d,j,nt,_e)}function jj(e,i,d,j,_e,nt){gj(e,i);var ct=(i.flags&128)!==0;if(!j&&!ct)return _e&&dg(i,d,!1),Zi(e,i,nt);j=i.stateNode,Wi.current=i;var c=ct&&typeof d.getDerivedStateFromError!="function"?null:j.render();return i.flags|=1,e!==null&&ct?(i.child=Ug(i,e.child,null,nt),i.child=Ug(i,null,c,nt)):Xi(e,i,c,nt),i.memoizedState=j.state,_e&&dg(i,d,!0),i.child}function kj(e){var i=e.stateNode;i.pendingContext?ag(e,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(e,i.context,!1),yh(e,i.containerInfo)}function lj(e,i,d,j,_e){return Ig(),Jg(_e),i.flags|=256,Xi(e,i,d,j),i.child}var mj={dehydrated:null,treeContext:null,retryLane:0};function nj(e){return{baseLanes:e,cachePool:null,transitions:null}}function oj(e,i,d){var j=i.pendingProps,_e=L.current,nt=!1,ct=(i.flags&128)!==0,c;if((c=ct)||(c=e!==null&&e.memoizedState===null?!1:(_e&2)!==0),c?(nt=!0,i.flags&=-129):(e===null||e.memoizedState!==null)&&(_e|=1),G(L,_e&1),e===null)return Eg(i),e=i.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(i.mode&1?e.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(ct=j.children,e=j.fallback,nt?(j=i.mode,nt=i.child,ct={mode:"hidden",children:ct},!(j&1)&&nt!==null?(nt.childLanes=0,nt.pendingProps=ct):nt=pj(ct,j,0,null),e=Tg(e,j,d,null),nt.return=i,e.return=i,nt.sibling=e,i.child=nt,i.child.memoizedState=nj(d),i.memoizedState=mj,e):qj(i,ct));if(_e=e.memoizedState,_e!==null&&(c=_e.dehydrated,c!==null))return rj(e,i,ct,j,c,_e,d);if(nt){nt=j.fallback,ct=i.mode,_e=e.child,c=_e.sibling;var pt={mode:"hidden",children:j.children};return!(ct&1)&&i.child!==_e?(j=i.child,j.childLanes=0,j.pendingProps=pt,i.deletions=null):(j=Pg(_e,pt),j.subtreeFlags=_e.subtreeFlags&14680064),c!==null?nt=Pg(c,nt):(nt=Tg(nt,ct,d,null),nt.flags|=2),nt.return=i,j.return=i,j.sibling=nt,i.child=j,j=nt,nt=i.child,ct=e.child.memoizedState,ct=ct===null?nj(d):{baseLanes:ct.baseLanes|d,cachePool:null,transitions:ct.transitions},nt.memoizedState=ct,nt.childLanes=e.childLanes&~d,i.memoizedState=mj,j}return nt=e.child,e=nt.sibling,j=Pg(nt,{mode:"visible",children:j.children}),!(i.mode&1)&&(j.lanes=d),j.return=i,j.sibling=null,e!==null&&(d=i.deletions,d===null?(i.deletions=[e],i.flags|=16):d.push(e)),i.child=j,i.memoizedState=null,j}function qj(e,i){return i=pj({mode:"visible",children:i},e.mode,0,null),i.return=e,e.child=i}function sj(e,i,d,j){return j!==null&&Jg(j),Ug(i,e.child,null,d),e=qj(i,i.pendingProps.children),e.flags|=2,i.memoizedState=null,e}function rj(e,i,d,j,_e,nt,ct){if(d)return i.flags&256?(i.flags&=-257,j=Ki(Error(p(422))),sj(e,i,ct,j)):i.memoizedState!==null?(i.child=e.child,i.flags|=128,null):(nt=j.fallback,_e=i.mode,j=pj({mode:"visible",children:j.children},_e,0,null),nt=Tg(nt,_e,ct,null),nt.flags|=2,j.return=i,nt.return=i,j.sibling=nt,i.child=j,i.mode&1&&Ug(i,e.child,null,ct),i.child.memoizedState=nj(ct),i.memoizedState=mj,nt);if(!(i.mode&1))return sj(e,i,ct,null);if(_e.data==="$!"){if(j=_e.nextSibling&&_e.nextSibling.dataset,j)var c=j.dgst;return j=c,nt=Error(p(419)),j=Ki(nt,j,void 0),sj(e,i,ct,j)}if(c=(ct&e.childLanes)!==0,dh||c){if(j=Q,j!==null){switch(ct&-ct){case 4:_e=2;break;case 16:_e=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_e=32;break;case 536870912:_e=268435456;break;default:_e=0}_e=_e&(j.suspendedLanes|ct)?0:_e,_e!==0&&_e!==nt.retryLane&&(nt.retryLane=_e,ih(e,_e),gi(j,e,_e,-1))}return tj(),j=Ki(Error(p(421))),sj(e,i,ct,j)}return _e.data==="$?"?(i.flags|=128,i.child=e.child,i=uj.bind(null,e),_e._reactRetry=i,null):(e=nt.treeContext,yg=Lf(_e.nextSibling),xg=i,I=!0,zg=null,e!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=e.id,sg=e.overflow,qg=i),i=qj(i,j.children),i.flags|=4096,i)}function vj(e,i,d){e.lanes|=i;var j=e.alternate;j!==null&&(j.lanes|=i),bh(e.return,i,d)}function wj(e,i,d,j,_e){var nt=e.memoizedState;nt===null?e.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:j,tail:d,tailMode:_e}:(nt.isBackwards=i,nt.rendering=null,nt.renderingStartTime=0,nt.last=j,nt.tail=d,nt.tailMode=_e)}function xj(e,i,d){var j=i.pendingProps,_e=j.revealOrder,nt=j.tail;if(Xi(e,i,j.children,d),j=L.current,j&2)j=j&1|2,i.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=i.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&vj(e,d,i);else if(e.tag===19)vj(e,d,i);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break e;for(;e.sibling===null;){if(e.return===null||e.return===i)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}j&=1}if(G(L,j),!(i.mode&1))i.memoizedState=null;else switch(_e){case"forwards":for(d=i.child,_e=null;d!==null;)e=d.alternate,e!==null&&Ch(e)===null&&(_e=d),d=d.sibling;d=_e,d===null?(_e=i.child,i.child=null):(_e=d.sibling,d.sibling=null),wj(i,!1,_e,d,nt);break;case"backwards":for(d=null,_e=i.child,i.child=null;_e!==null;){if(e=_e.alternate,e!==null&&Ch(e)===null){i.child=_e;break}e=_e.sibling,_e.sibling=d,d=_e,_e=e}wj(i,!0,d,null,nt);break;case"together":wj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function ij(e,i){!(i.mode&1)&&e!==null&&(e.alternate=null,i.alternate=null,i.flags|=2)}function Zi(e,i,d){if(e!==null&&(i.dependencies=e.dependencies),rh|=i.lanes,!(d&i.childLanes))return null;if(e!==null&&i.child!==e.child)throw Error(p(153));if(i.child!==null){for(e=i.child,d=Pg(e,e.pendingProps),i.child=d,d.return=i;e.sibling!==null;)e=e.sibling,d=d.sibling=Pg(e,e.pendingProps),d.return=i;d.sibling=null}return i.child}function yj(e,i,d){switch(i.tag){case 3:kj(i),Ig();break;case 5:Ah(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:yh(i,i.stateNode.containerInfo);break;case 10:var j=i.type._context,_e=i.memoizedProps.value;G(Wg,j._currentValue),j._currentValue=_e;break;case 13:if(j=i.memoizedState,j!==null)return j.dehydrated!==null?(G(L,L.current&1),i.flags|=128,null):d&i.child.childLanes?oj(e,i,d):(G(L,L.current&1),e=Zi(e,i,d),e!==null?e.sibling:null);G(L,L.current&1);break;case 19:if(j=(d&i.childLanes)!==0,e.flags&128){if(j)return xj(e,i,d);i.flags|=128}if(_e=i.memoizedState,_e!==null&&(_e.rendering=null,_e.tail=null,_e.lastEffect=null),G(L,L.current),j)break;return null;case 22:case 23:return i.lanes=0,dj(e,i,d)}return Zi(e,i,d)}var zj,Aj,Bj,Cj;zj=function(e,i){for(var d=i.child;d!==null;){if(d.tag===5||d.tag===6)e.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===i)break;for(;d.sibling===null;){if(d.return===null||d.return===i)return;d=d.return}d.sibling.return=d.return,d=d.sibling}};Aj=function(){};Bj=function(e,i,d,j){var _e=e.memoizedProps;if(_e!==j){e=i.stateNode,xh(uh.current);var nt=null;switch(d){case"input":_e=Ya(e,_e),j=Ya(e,j),nt=[];break;case"select":_e=A({},_e,{value:void 0}),j=A({},j,{value:void 0}),nt=[];break;case"textarea":_e=gb(e,_e),j=gb(e,j),nt=[];break;default:typeof _e.onClick!="function"&&typeof j.onClick=="function"&&(e.onclick=Bf)}ub(d,j);var ct;d=null;for(gt in _e)if(!j.hasOwnProperty(gt)&&_e.hasOwnProperty(gt)&&_e[gt]!=null)if(gt==="style"){var c=_e[gt];for(ct in c)c.hasOwnProperty(ct)&&(d||(d={}),d[ct]="")}else gt!=="dangerouslySetInnerHTML"&&gt!=="children"&&gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&gt!=="autoFocus"&&(ea.hasOwnProperty(gt)?nt||(nt=[]):(nt=nt||[]).push(gt,null));for(gt in j){var pt=j[gt];if(c=_e!=null?_e[gt]:void 0,j.hasOwnProperty(gt)&&pt!==c&&(pt!=null||c!=null))if(gt==="style")if(c){for(ct in c)!c.hasOwnProperty(ct)||pt&&pt.hasOwnProperty(ct)||(d||(d={}),d[ct]="");for(ct in pt)pt.hasOwnProperty(ct)&&c[ct]!==pt[ct]&&(d||(d={}),d[ct]=pt[ct])}else d||(nt||(nt=[]),nt.push(gt,d)),d=pt;else gt==="dangerouslySetInnerHTML"?(pt=pt?pt.__html:void 0,c=c?c.__html:void 0,pt!=null&&c!==pt&&(nt=nt||[]).push(gt,pt)):gt==="children"?typeof pt!="string"&&typeof pt!="number"||(nt=nt||[]).push(gt,""+pt):gt!=="suppressContentEditableWarning"&&gt!=="suppressHydrationWarning"&&(ea.hasOwnProperty(gt)?(pt!=null&&gt==="onScroll"&&D("scroll",e),nt||c===pt||(nt=[])):(nt=nt||[]).push(gt,pt))}d&&(nt=nt||[]).push("style",d);var gt=nt;(i.updateQueue=gt)&&(i.flags|=4)}};Cj=function(e,i,d,j){d!==j&&(i.flags|=4)};function Dj(e,i){if(!I)switch(e.tailMode){case"hidden":i=e.tail;for(var d=null;i!==null;)i.alternate!==null&&(d=i),i=i.sibling;d===null?e.tail=null:d.sibling=null;break;case"collapsed":d=e.tail;for(var j=null;d!==null;)d.alternate!==null&&(j=d),d=d.sibling;j===null?i||e.tail===null?e.tail=null:e.tail.sibling=null:j.sibling=null}}function S(e){var i=e.alternate!==null&&e.alternate.child===e.child,d=0,j=0;if(i)for(var _e=e.child;_e!==null;)d|=_e.lanes|_e.childLanes,j|=_e.subtreeFlags&14680064,j|=_e.flags&14680064,_e.return=e,_e=_e.sibling;else for(_e=e.child;_e!==null;)d|=_e.lanes|_e.childLanes,j|=_e.subtreeFlags,j|=_e.flags,_e.return=e,_e=_e.sibling;return e.subtreeFlags|=j,e.childLanes=d,i}function Ej(e,i,d){var j=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return j=i.stateNode,zh(),E(Wf),E(H),Eh(),j.pendingContext&&(j.context=j.pendingContext,j.pendingContext=null),(e===null||e.child===null)&&(Gg(i)?i.flags|=4:e===null||e.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Fj(zg),zg=null))),Aj(e,i),S(i),null;case 5:Bh(i);var _e=xh(wh.current);if(d=i.type,e!==null&&i.stateNode!=null)Bj(e,i,d,j,_e),e.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!j){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(e=xh(uh.current),Gg(i)){j=i.stateNode,d=i.type;var nt=i.memoizedProps;switch(j[Of]=i,j[Pf]=nt,e=(i.mode&1)!==0,d){case"dialog":D("cancel",j),D("close",j);break;case"iframe":case"object":case"embed":D("load",j);break;case"video":case"audio":for(_e=0;_e<lf.length;_e++)D(lf[_e],j);break;case"source":D("error",j);break;case"img":case"image":case"link":D("error",j),D("load",j);break;case"details":D("toggle",j);break;case"input":Za(j,nt),D("invalid",j);break;case"select":j._wrapperState={wasMultiple:!!nt.multiple},D("invalid",j);break;case"textarea":hb(j,nt),D("invalid",j)}ub(d,nt),_e=null;for(var ct in nt)if(nt.hasOwnProperty(ct)){var c=nt[ct];ct==="children"?typeof c=="string"?j.textContent!==c&&(nt.suppressHydrationWarning!==!0&&Af(j.textContent,c,e),_e=["children",c]):typeof c=="number"&&j.textContent!==""+c&&(nt.suppressHydrationWarning!==!0&&Af(j.textContent,c,e),_e=["children",""+c]):ea.hasOwnProperty(ct)&&c!=null&&ct==="onScroll"&&D("scroll",j)}switch(d){case"input":Va(j),db(j,nt,!0);break;case"textarea":Va(j),jb(j);break;case"select":case"option":break;default:typeof nt.onClick=="function"&&(j.onclick=Bf)}j=_e,i.updateQueue=j,j!==null&&(i.flags|=4)}else{ct=_e.nodeType===9?_e:_e.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=kb(d)),e==="http://www.w3.org/1999/xhtml"?d==="script"?(e=ct.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof j.is=="string"?e=ct.createElement(d,{is:j.is}):(e=ct.createElement(d),d==="select"&&(ct=e,j.multiple?ct.multiple=!0:j.size&&(ct.size=j.size))):e=ct.createElementNS(e,d),e[Of]=i,e[Pf]=j,zj(e,i,!1,!1),i.stateNode=e;e:{switch(ct=vb(d,j),d){case"dialog":D("cancel",e),D("close",e),_e=j;break;case"iframe":case"object":case"embed":D("load",e),_e=j;break;case"video":case"audio":for(_e=0;_e<lf.length;_e++)D(lf[_e],e);_e=j;break;case"source":D("error",e),_e=j;break;case"img":case"image":case"link":D("error",e),D("load",e),_e=j;break;case"details":D("toggle",e),_e=j;break;case"input":Za(e,j),_e=Ya(e,j),D("invalid",e);break;case"option":_e=j;break;case"select":e._wrapperState={wasMultiple:!!j.multiple},_e=A({},j,{value:void 0}),D("invalid",e);break;case"textarea":hb(e,j),_e=gb(e,j),D("invalid",e);break;default:_e=j}ub(d,_e),c=_e;for(nt in c)if(c.hasOwnProperty(nt)){var pt=c[nt];nt==="style"?sb(e,pt):nt==="dangerouslySetInnerHTML"?(pt=pt?pt.__html:void 0,pt!=null&&nb(e,pt)):nt==="children"?typeof pt=="string"?(d!=="textarea"||pt!=="")&&ob(e,pt):typeof pt=="number"&&ob(e,""+pt):nt!=="suppressContentEditableWarning"&&nt!=="suppressHydrationWarning"&&nt!=="autoFocus"&&(ea.hasOwnProperty(nt)?pt!=null&&nt==="onScroll"&&D("scroll",e):pt!=null&&ta(e,nt,pt,ct))}switch(d){case"input":Va(e),db(e,j,!1);break;case"textarea":Va(e),jb(e);break;case"option":j.value!=null&&e.setAttribute("value",""+Sa(j.value));break;case"select":e.multiple=!!j.multiple,nt=j.value,nt!=null?fb(e,!!j.multiple,nt,!1):j.defaultValue!=null&&fb(e,!!j.multiple,j.defaultValue,!0);break;default:typeof _e.onClick=="function"&&(e.onclick=Bf)}switch(d){case"button":case"input":case"select":case"textarea":j=!!j.autoFocus;break e;case"img":j=!0;break e;default:j=!1}}j&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(e&&i.stateNode!=null)Cj(e,i,e.memoizedProps,j);else{if(typeof j!="string"&&i.stateNode===null)throw Error(p(166));if(d=xh(wh.current),xh(uh.current),Gg(i)){if(j=i.stateNode,d=i.memoizedProps,j[Of]=i,(nt=j.nodeValue!==d)&&(e=xg,e!==null))switch(e.tag){case 3:Af(j.nodeValue,d,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Af(j.nodeValue,d,(e.mode&1)!==0)}nt&&(i.flags|=4)}else j=(d.nodeType===9?d:d.ownerDocument).createTextNode(j),j[Of]=i,i.stateNode=j}return S(i),null;case 13:if(E(L),j=i.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,nt=!1;else if(nt=Gg(i),j!==null&&j.dehydrated!==null){if(e===null){if(!nt)throw Error(p(318));if(nt=i.memoizedState,nt=nt!==null?nt.dehydrated:null,!nt)throw Error(p(317));nt[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),nt=!1}else zg!==null&&(Fj(zg),zg=null),nt=!0;if(!nt)return i.flags&65536?i:null}return i.flags&128?(i.lanes=d,i):(j=j!==null,j!==(e!==null&&e.memoizedState!==null)&&j&&(i.child.flags|=8192,i.mode&1&&(e===null||L.current&1?T===0&&(T=3):tj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return zh(),Aj(e,i),e===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return ah(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E(L),nt=i.memoizedState,nt===null)return S(i),null;if(j=(i.flags&128)!==0,ct=nt.rendering,ct===null)if(j)Dj(nt,!1);else{if(T!==0||e!==null&&e.flags&128)for(e=i.child;e!==null;){if(ct=Ch(e),ct!==null){for(i.flags|=128,Dj(nt,!1),j=ct.updateQueue,j!==null&&(i.updateQueue=j,i.flags|=4),i.subtreeFlags=0,j=d,d=i.child;d!==null;)nt=d,e=j,nt.flags&=14680066,ct=nt.alternate,ct===null?(nt.childLanes=0,nt.lanes=e,nt.child=null,nt.subtreeFlags=0,nt.memoizedProps=null,nt.memoizedState=null,nt.updateQueue=null,nt.dependencies=null,nt.stateNode=null):(nt.childLanes=ct.childLanes,nt.lanes=ct.lanes,nt.child=ct.child,nt.subtreeFlags=0,nt.deletions=null,nt.memoizedProps=ct.memoizedProps,nt.memoizedState=ct.memoizedState,nt.updateQueue=ct.updateQueue,nt.type=ct.type,e=ct.dependencies,nt.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),d=d.sibling;return G(L,L.current&1|2),i.child}e=e.sibling}nt.tail!==null&&B()>Gj&&(i.flags|=128,j=!0,Dj(nt,!1),i.lanes=4194304)}else{if(!j)if(e=Ch(ct),e!==null){if(i.flags|=128,j=!0,d=e.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),Dj(nt,!0),nt.tail===null&&nt.tailMode==="hidden"&&!ct.alternate&&!I)return S(i),null}else 2*B()-nt.renderingStartTime>Gj&&d!==1073741824&&(i.flags|=128,j=!0,Dj(nt,!1),i.lanes=4194304);nt.isBackwards?(ct.sibling=i.child,i.child=ct):(d=nt.last,d!==null?d.sibling=ct:i.child=ct,nt.last=ct)}return nt.tail!==null?(i=nt.tail,nt.rendering=i,nt.tail=i.sibling,nt.renderingStartTime=B(),i.sibling=null,d=L.current,G(L,j?d&1|2:d&1),i):(S(i),null);case 22:case 23:return Hj(),j=i.memoizedState!==null,e!==null&&e.memoizedState!==null!==j&&(i.flags|=8192),j&&i.mode&1?fj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Ij(e,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 3:return zh(),E(Wf),E(H),Eh(),e=i.flags,e&65536&&!(e&128)?(i.flags=e&-65537|128,i):null;case 5:return Bh(i),null;case 13:if(E(L),e=i.memoizedState,e!==null&&e.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return e=i.flags,e&65536?(i.flags=e&-65537|128,i):null;case 19:return E(L),null;case 4:return zh(),null;case 10:return ah(i.type._context),null;case 22:case 23:return Hj(),null;case 24:return null;default:return null}}var Jj=!1,U=!1,Kj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Lj(e,i){var d=e.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(j){W(e,i,j)}else d.current=null}function Mj(e,i,d){try{d()}catch(j){W(e,i,j)}}var Nj=!1;function Oj(e,i){if(Cf=dd,e=Me(),Ne(e)){if("selectionStart"in e)var d={start:e.selectionStart,end:e.selectionEnd};else e:{d=(d=e.ownerDocument)&&d.defaultView||window;var j=d.getSelection&&d.getSelection();if(j&&j.rangeCount!==0){d=j.anchorNode;var _e=j.anchorOffset,nt=j.focusNode;j=j.focusOffset;try{d.nodeType,nt.nodeType}catch{d=null;break e}var ct=0,c=-1,pt=-1,gt=0,St=0,kt=e,At=null;t:for(;;){for(var Nt;kt!==d||_e!==0&&kt.nodeType!==3||(c=ct+_e),kt!==nt||j!==0&&kt.nodeType!==3||(pt=ct+j),kt.nodeType===3&&(ct+=kt.nodeValue.length),(Nt=kt.firstChild)!==null;)At=kt,kt=Nt;for(;;){if(kt===e)break t;if(At===d&&++gt===_e&&(c=ct),At===nt&&++St===j&&(pt=ct),(Nt=kt.nextSibling)!==null)break;kt=At,At=kt.parentNode}kt=Nt}d=c===-1||pt===-1?null:{start:c,end:pt}}else d=null}d=d||{start:0,end:0}}else d=null;for(Df={focusedElem:e,selectionRange:d},dd=!1,V=i;V!==null;)if(i=V,e=i.child,(i.subtreeFlags&1028)!==0&&e!==null)e.return=i,V=e;else for(;V!==null;){i=V;try{var Vt=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Vt!==null){var zt=Vt.memoizedProps,Jt=Vt.memoizedState,Dt=i.stateNode,It=Dt.getSnapshotBeforeUpdate(i.elementType===i.type?zt:Ci(i.type,zt),Jt);Dt.__reactInternalSnapshotBeforeUpdate=It}break;case 3:var Mt=i.stateNode.containerInfo;Mt.nodeType===1?Mt.textContent="":Mt.nodeType===9&&Mt.documentElement&&Mt.removeChild(Mt.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Ht){W(i,i.return,Ht)}if(e=i.sibling,e!==null){e.return=i.return,V=e;break}V=i.return}return Vt=Nj,Nj=!1,Vt}function Pj(e,i,d){var j=i.updateQueue;if(j=j!==null?j.lastEffect:null,j!==null){var _e=j=j.next;do{if((_e.tag&e)===e){var nt=_e.destroy;_e.destroy=void 0,nt!==void 0&&Mj(i,d,nt)}_e=_e.next}while(_e!==j)}}function Qj(e,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var d=i=i.next;do{if((d.tag&e)===e){var j=d.create;d.destroy=j()}d=d.next}while(d!==i)}}function Rj(e){var i=e.ref;if(i!==null){var d=e.stateNode;switch(e.tag){case 5:e=d;break;default:e=d}typeof i=="function"?i(e):i.current=e}}function Sj(e){var i=e.alternate;i!==null&&(e.alternate=null,Sj(i)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(i=e.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function Tj(e){return e.tag===5||e.tag===3||e.tag===4}function Uj(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||Tj(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function Vj(e,i,d){var j=e.tag;if(j===5||j===6)e=e.stateNode,i?d.nodeType===8?d.parentNode.insertBefore(e,i):d.insertBefore(e,i):(d.nodeType===8?(i=d.parentNode,i.insertBefore(e,d)):(i=d,i.appendChild(e)),d=d._reactRootContainer,d!=null||i.onclick!==null||(i.onclick=Bf));else if(j!==4&&(e=e.child,e!==null))for(Vj(e,i,d),e=e.sibling;e!==null;)Vj(e,i,d),e=e.sibling}function Wj(e,i,d){var j=e.tag;if(j===5||j===6)e=e.stateNode,i?d.insertBefore(e,i):d.appendChild(e);else if(j!==4&&(e=e.child,e!==null))for(Wj(e,i,d),e=e.sibling;e!==null;)Wj(e,i,d),e=e.sibling}var X$1=null,Xj=!1;function Yj(e,i,d){for(d=d.child;d!==null;)Zj(e,i,d),d=d.sibling}function Zj(e,i,d){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,d)}catch{}switch(d.tag){case 5:U||Lj(d,i);case 6:var j=X$1,_e=Xj;X$1=null,Yj(e,i,d),X$1=j,Xj=_e,X$1!==null&&(Xj?(e=X$1,d=d.stateNode,e.nodeType===8?e.parentNode.removeChild(d):e.removeChild(d)):X$1.removeChild(d.stateNode));break;case 18:X$1!==null&&(Xj?(e=X$1,d=d.stateNode,e.nodeType===8?Kf(e.parentNode,d):e.nodeType===1&&Kf(e,d),bd(e)):Kf(X$1,d.stateNode));break;case 4:j=X$1,_e=Xj,X$1=d.stateNode.containerInfo,Xj=!0,Yj(e,i,d),X$1=j,Xj=_e;break;case 0:case 11:case 14:case 15:if(!U&&(j=d.updateQueue,j!==null&&(j=j.lastEffect,j!==null))){_e=j=j.next;do{var nt=_e,ct=nt.destroy;nt=nt.tag,ct!==void 0&&(nt&2||nt&4)&&Mj(d,i,ct),_e=_e.next}while(_e!==j)}Yj(e,i,d);break;case 1:if(!U&&(Lj(d,i),j=d.stateNode,typeof j.componentWillUnmount=="function"))try{j.props=d.memoizedProps,j.state=d.memoizedState,j.componentWillUnmount()}catch(c){W(d,i,c)}Yj(e,i,d);break;case 21:Yj(e,i,d);break;case 22:d.mode&1?(U=(j=U)||d.memoizedState!==null,Yj(e,i,d),U=j):Yj(e,i,d);break;default:Yj(e,i,d)}}function ak(e){var i=e.updateQueue;if(i!==null){e.updateQueue=null;var d=e.stateNode;d===null&&(d=e.stateNode=new Kj),i.forEach(function(j){var _e=bk.bind(null,e,j);d.has(j)||(d.add(j),j.then(_e,_e))})}}function ck(e,i){var d=i.deletions;if(d!==null)for(var j=0;j<d.length;j++){var _e=d[j];try{var nt=e,ct=i,c=ct;e:for(;c!==null;){switch(c.tag){case 5:X$1=c.stateNode,Xj=!1;break e;case 3:X$1=c.stateNode.containerInfo,Xj=!0;break e;case 4:X$1=c.stateNode.containerInfo,Xj=!0;break e}c=c.return}if(X$1===null)throw Error(p(160));Zj(nt,ct,_e),X$1=null,Xj=!1;var pt=_e.alternate;pt!==null&&(pt.return=null),_e.return=null}catch(gt){W(_e,i,gt)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)dk(i,e),i=i.sibling}function dk(e,i){var d=e.alternate,j=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(ck(i,e),ek(e),j&4){try{Pj(3,e,e.return),Qj(3,e)}catch(zt){W(e,e.return,zt)}try{Pj(5,e,e.return)}catch(zt){W(e,e.return,zt)}}break;case 1:ck(i,e),ek(e),j&512&&d!==null&&Lj(d,d.return);break;case 5:if(ck(i,e),ek(e),j&512&&d!==null&&Lj(d,d.return),e.flags&32){var _e=e.stateNode;try{ob(_e,"")}catch(zt){W(e,e.return,zt)}}if(j&4&&(_e=e.stateNode,_e!=null)){var nt=e.memoizedProps,ct=d!==null?d.memoizedProps:nt,c=e.type,pt=e.updateQueue;if(e.updateQueue=null,pt!==null)try{c==="input"&&nt.type==="radio"&&nt.name!=null&&ab(_e,nt),vb(c,ct);var gt=vb(c,nt);for(ct=0;ct<pt.length;ct+=2){var St=pt[ct],kt=pt[ct+1];St==="style"?sb(_e,kt):St==="dangerouslySetInnerHTML"?nb(_e,kt):St==="children"?ob(_e,kt):ta(_e,St,kt,gt)}switch(c){case"input":bb(_e,nt);break;case"textarea":ib(_e,nt);break;case"select":var At=_e._wrapperState.wasMultiple;_e._wrapperState.wasMultiple=!!nt.multiple;var Nt=nt.value;Nt!=null?fb(_e,!!nt.multiple,Nt,!1):At!==!!nt.multiple&&(nt.defaultValue!=null?fb(_e,!!nt.multiple,nt.defaultValue,!0):fb(_e,!!nt.multiple,nt.multiple?[]:"",!1))}_e[Pf]=nt}catch(zt){W(e,e.return,zt)}}break;case 6:if(ck(i,e),ek(e),j&4){if(e.stateNode===null)throw Error(p(162));_e=e.stateNode,nt=e.memoizedProps;try{_e.nodeValue=nt}catch(zt){W(e,e.return,zt)}}break;case 3:if(ck(i,e),ek(e),j&4&&d!==null&&d.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(zt){W(e,e.return,zt)}break;case 4:ck(i,e),ek(e);break;case 13:ck(i,e),ek(e),_e=e.child,_e.flags&8192&&(nt=_e.memoizedState!==null,_e.stateNode.isHidden=nt,!nt||_e.alternate!==null&&_e.alternate.memoizedState!==null||(fk=B())),j&4&&ak(e);break;case 22:if(St=d!==null&&d.memoizedState!==null,e.mode&1?(U=(gt=U)||St,ck(i,e),U=gt):ck(i,e),ek(e),j&8192){if(gt=e.memoizedState!==null,(e.stateNode.isHidden=gt)&&!St&&e.mode&1)for(V=e,St=e.child;St!==null;){for(kt=V=St;V!==null;){switch(At=V,Nt=At.child,At.tag){case 0:case 11:case 14:case 15:Pj(4,At,At.return);break;case 1:Lj(At,At.return);var Vt=At.stateNode;if(typeof Vt.componentWillUnmount=="function"){j=At,d=At.return;try{i=j,Vt.props=i.memoizedProps,Vt.state=i.memoizedState,Vt.componentWillUnmount()}catch(zt){W(j,d,zt)}}break;case 5:Lj(At,At.return);break;case 22:if(At.memoizedState!==null){gk(kt);continue}}Nt!==null?(Nt.return=At,V=Nt):gk(kt)}St=St.sibling}e:for(St=null,kt=e;;){if(kt.tag===5){if(St===null){St=kt;try{_e=kt.stateNode,gt?(nt=_e.style,typeof nt.setProperty=="function"?nt.setProperty("display","none","important"):nt.display="none"):(c=kt.stateNode,pt=kt.memoizedProps.style,ct=pt!=null&&pt.hasOwnProperty("display")?pt.display:null,c.style.display=rb("display",ct))}catch(zt){W(e,e.return,zt)}}}else if(kt.tag===6){if(St===null)try{kt.stateNode.nodeValue=gt?"":kt.memoizedProps}catch(zt){W(e,e.return,zt)}}else if((kt.tag!==22&&kt.tag!==23||kt.memoizedState===null||kt===e)&&kt.child!==null){kt.child.return=kt,kt=kt.child;continue}if(kt===e)break e;for(;kt.sibling===null;){if(kt.return===null||kt.return===e)break e;St===kt&&(St=null),kt=kt.return}St===kt&&(St=null),kt.sibling.return=kt.return,kt=kt.sibling}}break;case 19:ck(i,e),ek(e),j&4&&ak(e);break;case 21:break;default:ck(i,e),ek(e)}}function ek(e){var i=e.flags;if(i&2){try{e:{for(var d=e.return;d!==null;){if(Tj(d)){var j=d;break e}d=d.return}throw Error(p(160))}switch(j.tag){case 5:var _e=j.stateNode;j.flags&32&&(ob(_e,""),j.flags&=-33);var nt=Uj(e);Wj(e,nt,_e);break;case 3:case 4:var ct=j.stateNode.containerInfo,c=Uj(e);Vj(e,c,ct);break;default:throw Error(p(161))}}catch(pt){W(e,e.return,pt)}e.flags&=-3}i&4096&&(e.flags&=-4097)}function hk(e,i,d){V=e,ik(e)}function ik(e,i,d){for(var j=(e.mode&1)!==0;V!==null;){var _e=V,nt=_e.child;if(_e.tag===22&&j){var ct=_e.memoizedState!==null||Jj;if(!ct){var c=_e.alternate,pt=c!==null&&c.memoizedState!==null||U;c=Jj;var gt=U;if(Jj=ct,(U=pt)&&!gt)for(V=_e;V!==null;)ct=V,pt=ct.child,ct.tag===22&&ct.memoizedState!==null?jk(_e):pt!==null?(pt.return=ct,V=pt):jk(_e);for(;nt!==null;)V=nt,ik(nt),nt=nt.sibling;V=_e,Jj=c,U=gt}kk(e)}else _e.subtreeFlags&8772&&nt!==null?(nt.return=_e,V=nt):kk(e)}}function kk(e){for(;V!==null;){var i=V;if(i.flags&8772){var d=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Qj(5,i);break;case 1:var j=i.stateNode;if(i.flags&4&&!U)if(d===null)j.componentDidMount();else{var _e=i.elementType===i.type?d.memoizedProps:Ci(i.type,d.memoizedProps);j.componentDidUpdate(_e,d.memoizedState,j.__reactInternalSnapshotBeforeUpdate)}var nt=i.updateQueue;nt!==null&&sh(i,nt,j);break;case 3:var ct=i.updateQueue;if(ct!==null){if(d=null,i.child!==null)switch(i.child.tag){case 5:d=i.child.stateNode;break;case 1:d=i.child.stateNode}sh(i,ct,d)}break;case 5:var c=i.stateNode;if(d===null&&i.flags&4){d=c;var pt=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":pt.autoFocus&&d.focus();break;case"img":pt.src&&(d.src=pt.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var gt=i.alternate;if(gt!==null){var St=gt.memoizedState;if(St!==null){var kt=St.dehydrated;kt!==null&&bd(kt)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Rj(i)}catch(At){W(i,i.return,At)}}if(i===e){V=null;break}if(d=i.sibling,d!==null){d.return=i.return,V=d;break}V=i.return}}function gk(e){for(;V!==null;){var i=V;if(i===e){V=null;break}var d=i.sibling;if(d!==null){d.return=i.return,V=d;break}V=i.return}}function jk(e){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var d=i.return;try{Qj(4,i)}catch(pt){W(i,d,pt)}break;case 1:var j=i.stateNode;if(typeof j.componentDidMount=="function"){var _e=i.return;try{j.componentDidMount()}catch(pt){W(i,_e,pt)}}var nt=i.return;try{Rj(i)}catch(pt){W(i,nt,pt)}break;case 5:var ct=i.return;try{Rj(i)}catch(pt){W(i,ct,pt)}}}catch(pt){W(i,i.return,pt)}if(i===e){V=null;break}var c=i.sibling;if(c!==null){c.return=i.return,V=c;break}V=i.return}}var lk=Math.ceil,mk=ua.ReactCurrentDispatcher,nk=ua.ReactCurrentOwner,ok=ua.ReactCurrentBatchConfig,K=0,Q=null,Y=null,Z=0,fj=0,ej=Uf(0),T=0,pk=null,rh=0,qk=0,rk=0,sk=null,tk=null,fk=0,Gj=1/0,uk=null,Oi=!1,Pi=null,Ri=null,vk=!1,wk=null,xk=0,yk=0,zk=null,Ak=-1,Bk=0;function R(){return K&6?B():Ak!==-1?Ak:Ak=B()}function yi(e){return e.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Bk===0&&(Bk=yc()),Bk):(e=C,e!==0||(e=window.event,e=e===void 0?16:jd(e.type)),e):1}function gi(e,i,d,j){if(50<yk)throw yk=0,zk=null,Error(p(185));Ac(e,d,j),(!(K&2)||e!==Q)&&(e===Q&&(!(K&2)&&(qk|=d),T===4&&Ck(e,Z)),Dk(e,j),d===1&&K===0&&!(i.mode&1)&&(Gj=B()+500,fg&&jg()))}function Dk(e,i){var d=e.callbackNode;wc(e,i);var j=uc(e,e===Q?Z:0);if(j===0)d!==null&&bc(d),e.callbackNode=null,e.callbackPriority=0;else if(i=j&-j,e.callbackPriority!==i){if(d!=null&&bc(d),i===1)e.tag===0?ig(Ek.bind(null,e)):hg(Ek.bind(null,e)),Jf(function(){!(K&6)&&jg()}),d=null;else{switch(Dc(j)){case 1:d=fc;break;case 4:d=gc;break;case 16:d=hc;break;case 536870912:d=jc;break;default:d=hc}d=Fk(d,Gk.bind(null,e))}e.callbackPriority=i,e.callbackNode=d}}function Gk(e,i){if(Ak=-1,Bk=0,K&6)throw Error(p(327));var d=e.callbackNode;if(Hk()&&e.callbackNode!==d)return null;var j=uc(e,e===Q?Z:0);if(j===0)return null;if(j&30||j&e.expiredLanes||i)i=Ik(e,j);else{i=j;var _e=K;K|=2;var nt=Jk();(Q!==e||Z!==i)&&(uk=null,Gj=B()+500,Kk(e,i));do try{Lk();break}catch(c){Mk(e,c)}while(!0);$g(),mk.current=nt,K=_e,Y!==null?i=0:(Q=null,Z=0,i=T)}if(i!==0){if(i===2&&(_e=xc(e),_e!==0&&(j=_e,i=Nk(e,_e))),i===1)throw d=pk,Kk(e,0),Ck(e,j),Dk(e,B()),d;if(i===6)Ck(e,j);else{if(_e=e.current.alternate,!(j&30)&&!Ok(_e)&&(i=Ik(e,j),i===2&&(nt=xc(e),nt!==0&&(j=nt,i=Nk(e,nt))),i===1))throw d=pk,Kk(e,0),Ck(e,j),Dk(e,B()),d;switch(e.finishedWork=_e,e.finishedLanes=j,i){case 0:case 1:throw Error(p(345));case 2:Pk(e,tk,uk);break;case 3:if(Ck(e,j),(j&130023424)===j&&(i=fk+500-B(),10<i)){if(uc(e,0)!==0)break;if(_e=e.suspendedLanes,(_e&j)!==j){R(),e.pingedLanes|=e.suspendedLanes&_e;break}e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),i);break}Pk(e,tk,uk);break;case 4:if(Ck(e,j),(j&4194240)===j)break;for(i=e.eventTimes,_e=-1;0<j;){var ct=31-oc(j);nt=1<<ct,ct=i[ct],ct>_e&&(_e=ct),j&=~nt}if(j=_e,j=B()-j,j=(120>j?120:480>j?480:1080>j?1080:1920>j?1920:3e3>j?3e3:4320>j?4320:1960*lk(j/1960))-j,10<j){e.timeoutHandle=Ff(Pk.bind(null,e,tk,uk),j);break}Pk(e,tk,uk);break;case 5:Pk(e,tk,uk);break;default:throw Error(p(329))}}}return Dk(e,B()),e.callbackNode===d?Gk.bind(null,e):null}function Nk(e,i){var d=sk;return e.current.memoizedState.isDehydrated&&(Kk(e,i).flags|=256),e=Ik(e,i),e!==2&&(i=tk,tk=d,i!==null&&Fj(i)),e}function Fj(e){tk===null?tk=e:tk.push.apply(tk,e)}function Ok(e){for(var i=e;;){if(i.flags&16384){var d=i.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var j=0;j<d.length;j++){var _e=d[j],nt=_e.getSnapshot;_e=_e.value;try{if(!He(nt(),_e))return!1}catch{return!1}}}if(d=i.child,i.subtreeFlags&16384&&d!==null)d.return=i,i=d;else{if(i===e)break;for(;i.sibling===null;){if(i.return===null||i.return===e)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Ck(e,i){for(i&=~rk,i&=~qk,e.suspendedLanes|=i,e.pingedLanes&=~i,e=e.expirationTimes;0<i;){var d=31-oc(i),j=1<<d;e[d]=-1,i&=~j}}function Ek(e){if(K&6)throw Error(p(327));Hk();var i=uc(e,0);if(!(i&1))return Dk(e,B()),null;var d=Ik(e,i);if(e.tag!==0&&d===2){var j=xc(e);j!==0&&(i=j,d=Nk(e,j))}if(d===1)throw d=pk,Kk(e,0),Ck(e,i),Dk(e,B()),d;if(d===6)throw Error(p(345));return e.finishedWork=e.current.alternate,e.finishedLanes=i,Pk(e,tk,uk),Dk(e,B()),null}function Qk(e,i){var d=K;K|=1;try{return e(i)}finally{K=d,K===0&&(Gj=B()+500,fg&&jg())}}function Rk(e){wk!==null&&wk.tag===0&&!(K&6)&&Hk();var i=K;K|=1;var d=ok.transition,j=C;try{if(ok.transition=null,C=1,e)return e()}finally{C=j,ok.transition=d,K=i,!(K&6)&&jg()}}function Hj(){fj=ej.current,E(ej)}function Kk(e,i){e.finishedWork=null,e.finishedLanes=0;var d=e.timeoutHandle;if(d!==-1&&(e.timeoutHandle=-1,Gf(d)),Y!==null)for(d=Y.return;d!==null;){var j=d;switch(wg(j),j.tag){case 1:j=j.type.childContextTypes,j!=null&&$f();break;case 3:zh(),E(Wf),E(H),Eh();break;case 5:Bh(j);break;case 4:zh();break;case 13:E(L);break;case 19:E(L);break;case 10:ah(j.type._context);break;case 22:case 23:Hj()}d=d.return}if(Q=e,Y=e=Pg(e.current,null),Z=fj=i,T=0,pk=null,rk=qk=rh=0,tk=sk=null,fh!==null){for(i=0;i<fh.length;i++)if(d=fh[i],j=d.interleaved,j!==null){d.interleaved=null;var _e=j.next,nt=d.pending;if(nt!==null){var ct=nt.next;nt.next=_e,j.next=ct}d.pending=j}fh=null}return e}function Mk(e,i){do{var d=Y;try{if($g(),Fh.current=Rh,Ih){for(var j=M$1.memoizedState;j!==null;){var _e=j.queue;_e!==null&&(_e.pending=null),j=j.next}Ih=!1}if(Hh=0,O=N=M$1=null,Jh=!1,Kh=0,nk.current=null,d===null||d.return===null){T=1,pk=i,Y=null;break}e:{var nt=e,ct=d.return,c=d,pt=i;if(i=Z,c.flags|=32768,pt!==null&&typeof pt=="object"&&typeof pt.then=="function"){var gt=pt,St=c,kt=St.tag;if(!(St.mode&1)&&(kt===0||kt===11||kt===15)){var At=St.alternate;At?(St.updateQueue=At.updateQueue,St.memoizedState=At.memoizedState,St.lanes=At.lanes):(St.updateQueue=null,St.memoizedState=null)}var Nt=Ui(ct);if(Nt!==null){Nt.flags&=-257,Vi(Nt,ct,c,nt,i),Nt.mode&1&&Si(nt,gt,i),i=Nt,pt=gt;var Vt=i.updateQueue;if(Vt===null){var zt=new Set;zt.add(pt),i.updateQueue=zt}else Vt.add(pt);break e}else{if(!(i&1)){Si(nt,gt,i),tj();break e}pt=Error(p(426))}}else if(I&&c.mode&1){var Jt=Ui(ct);if(Jt!==null){!(Jt.flags&65536)&&(Jt.flags|=256),Vi(Jt,ct,c,nt,i),Jg(Ji(pt,c));break e}}nt=pt=Ji(pt,c),T!==4&&(T=2),sk===null?sk=[nt]:sk.push(nt),nt=ct;do{switch(nt.tag){case 3:nt.flags|=65536,i&=-i,nt.lanes|=i;var Dt=Ni(nt,pt,i);ph(nt,Dt);break e;case 1:c=pt;var It=nt.type,Mt=nt.stateNode;if(!(nt.flags&128)&&(typeof It.getDerivedStateFromError=="function"||Mt!==null&&typeof Mt.componentDidCatch=="function"&&(Ri===null||!Ri.has(Mt)))){nt.flags|=65536,i&=-i,nt.lanes|=i;var Ht=Qi(nt,c,i);ph(nt,Ht);break e}}nt=nt.return}while(nt!==null)}Sk(d)}catch(tr){i=tr,Y===d&&d!==null&&(Y=d=d.return);continue}break}while(!0)}function Jk(){var e=mk.current;return mk.current=Rh,e===null?Rh:e}function tj(){(T===0||T===3||T===2)&&(T=4),Q===null||!(rh&268435455)&&!(qk&268435455)||Ck(Q,Z)}function Ik(e,i){var d=K;K|=2;var j=Jk();(Q!==e||Z!==i)&&(uk=null,Kk(e,i));do try{Tk();break}catch(_e){Mk(e,_e)}while(!0);if($g(),K=d,mk.current=j,Y!==null)throw Error(p(261));return Q=null,Z=0,T}function Tk(){for(;Y!==null;)Uk(Y)}function Lk(){for(;Y!==null&&!cc();)Uk(Y)}function Uk(e){var i=Vk(e.alternate,e,fj);e.memoizedProps=e.pendingProps,i===null?Sk(e):Y=i,nk.current=null}function Sk(e){var i=e;do{var d=i.alternate;if(e=i.return,i.flags&32768){if(d=Ij(d,i),d!==null){d.flags&=32767,Y=d;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{T=6,Y=null;return}}else if(d=Ej(d,i,fj),d!==null){Y=d;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=e}while(i!==null);T===0&&(T=5)}function Pk(e,i,d){var j=C,_e=ok.transition;try{ok.transition=null,C=1,Wk(e,i,d,j)}finally{ok.transition=_e,C=j}return null}function Wk(e,i,d,j){do Hk();while(wk!==null);if(K&6)throw Error(p(327));d=e.finishedWork;var _e=e.finishedLanes;if(d===null)return null;if(e.finishedWork=null,e.finishedLanes=0,d===e.current)throw Error(p(177));e.callbackNode=null,e.callbackPriority=0;var nt=d.lanes|d.childLanes;if(Bc(e,nt),e===Q&&(Y=Q=null,Z=0),!(d.subtreeFlags&2064)&&!(d.flags&2064)||vk||(vk=!0,Fk(hc,function(){return Hk(),null})),nt=(d.flags&15990)!==0,d.subtreeFlags&15990||nt){nt=ok.transition,ok.transition=null;var ct=C;C=1;var c=K;K|=4,nk.current=null,Oj(e,d),dk(d,e),Oe(Df),dd=!!Cf,Df=Cf=null,e.current=d,hk(d),dc(),K=c,C=ct,ok.transition=nt}else e.current=d;if(vk&&(vk=!1,wk=e,xk=_e),nt=e.pendingLanes,nt===0&&(Ri=null),mc(d.stateNode),Dk(e,B()),i!==null)for(j=e.onRecoverableError,d=0;d<i.length;d++)_e=i[d],j(_e.value,{componentStack:_e.stack,digest:_e.digest});if(Oi)throw Oi=!1,e=Pi,Pi=null,e;return xk&1&&e.tag!==0&&Hk(),nt=e.pendingLanes,nt&1?e===zk?yk++:(yk=0,zk=e):yk=0,jg(),null}function Hk(){if(wk!==null){var e=Dc(xk),i=ok.transition,d=C;try{if(ok.transition=null,C=16>e?16:e,wk===null)var j=!1;else{if(e=wk,wk=null,xk=0,K&6)throw Error(p(331));var _e=K;for(K|=4,V=e.current;V!==null;){var nt=V,ct=nt.child;if(V.flags&16){var c=nt.deletions;if(c!==null){for(var pt=0;pt<c.length;pt++){var gt=c[pt];for(V=gt;V!==null;){var St=V;switch(St.tag){case 0:case 11:case 15:Pj(8,St,nt)}var kt=St.child;if(kt!==null)kt.return=St,V=kt;else for(;V!==null;){St=V;var At=St.sibling,Nt=St.return;if(Sj(St),St===gt){V=null;break}if(At!==null){At.return=Nt,V=At;break}V=Nt}}}var Vt=nt.alternate;if(Vt!==null){var zt=Vt.child;if(zt!==null){Vt.child=null;do{var Jt=zt.sibling;zt.sibling=null,zt=Jt}while(zt!==null)}}V=nt}}if(nt.subtreeFlags&2064&&ct!==null)ct.return=nt,V=ct;else e:for(;V!==null;){if(nt=V,nt.flags&2048)switch(nt.tag){case 0:case 11:case 15:Pj(9,nt,nt.return)}var Dt=nt.sibling;if(Dt!==null){Dt.return=nt.return,V=Dt;break e}V=nt.return}}var It=e.current;for(V=It;V!==null;){ct=V;var Mt=ct.child;if(ct.subtreeFlags&2064&&Mt!==null)Mt.return=ct,V=Mt;else e:for(ct=It;V!==null;){if(c=V,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:Qj(9,c)}}catch(tr){W(c,c.return,tr)}if(c===ct){V=null;break e}var Ht=c.sibling;if(Ht!==null){Ht.return=c.return,V=Ht;break e}V=c.return}}if(K=_e,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,e)}catch{}j=!0}return j}finally{C=d,ok.transition=i}}return!1}function Xk(e,i,d){i=Ji(d,i),i=Ni(e,i,1),e=nh(e,i,1),i=R(),e!==null&&(Ac(e,1,i),Dk(e,i))}function W(e,i,d){if(e.tag===3)Xk(e,e,d);else for(;i!==null;){if(i.tag===3){Xk(i,e,d);break}else if(i.tag===1){var j=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof j.componentDidCatch=="function"&&(Ri===null||!Ri.has(j))){e=Ji(d,e),e=Qi(i,e,1),i=nh(i,e,1),e=R(),i!==null&&(Ac(i,1,e),Dk(i,e));break}}i=i.return}}function Ti(e,i,d){var j=e.pingCache;j!==null&&j.delete(i),i=R(),e.pingedLanes|=e.suspendedLanes&d,Q===e&&(Z&d)===d&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-fk?Kk(e,0):rk|=d),Dk(e,i)}function Yk(e,i){i===0&&(e.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var d=R();e=ih(e,i),e!==null&&(Ac(e,i,d),Dk(e,d))}function uj(e){var i=e.memoizedState,d=0;i!==null&&(d=i.retryLane),Yk(e,d)}function bk(e,i){var d=0;switch(e.tag){case 13:var j=e.stateNode,_e=e.memoizedState;_e!==null&&(d=_e.retryLane);break;case 19:j=e.stateNode;break;default:throw Error(p(314))}j!==null&&j.delete(i),Yk(e,d)}var Vk;Vk=function(e,i,d){if(e!==null)if(e.memoizedProps!==i.pendingProps||Wf.current)dh=!0;else{if(!(e.lanes&d)&&!(i.flags&128))return dh=!1,yj(e,i,d);dh=!!(e.flags&131072)}else dh=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var j=i.type;ij(e,i),e=i.pendingProps;var _e=Yf(i,H.current);ch(i,d),_e=Nh(null,i,j,e,_e,d);var nt=Sh();return i.flags|=1,typeof _e=="object"&&_e!==null&&typeof _e.render=="function"&&_e.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(j)?(nt=!0,cg(i)):nt=!1,i.memoizedState=_e.state!==null&&_e.state!==void 0?_e.state:null,kh(i),_e.updater=Ei,i.stateNode=_e,_e._reactInternals=i,Ii(i,j,e,d),i=jj(null,i,j,!0,nt,d)):(i.tag=0,I&&nt&&vg(i),Xi(null,i,_e,d),i=i.child),i;case 16:j=i.elementType;e:{switch(ij(e,i),e=i.pendingProps,_e=j._init,j=_e(j._payload),i.type=j,_e=i.tag=Zk(j),e=Ci(j,e),_e){case 0:i=cj(null,i,j,e,d);break e;case 1:i=hj(null,i,j,e,d);break e;case 11:i=Yi(null,i,j,e,d);break e;case 14:i=$i(null,i,j,Ci(j.type,e),d);break e}throw Error(p(306,j,""))}return i;case 0:return j=i.type,_e=i.pendingProps,_e=i.elementType===j?_e:Ci(j,_e),cj(e,i,j,_e,d);case 1:return j=i.type,_e=i.pendingProps,_e=i.elementType===j?_e:Ci(j,_e),hj(e,i,j,_e,d);case 3:e:{if(kj(i),e===null)throw Error(p(387));j=i.pendingProps,nt=i.memoizedState,_e=nt.element,lh(e,i),qh(i,j,null,d);var ct=i.memoizedState;if(j=ct.element,nt.isDehydrated)if(nt={element:j,isDehydrated:!1,cache:ct.cache,pendingSuspenseBoundaries:ct.pendingSuspenseBoundaries,transitions:ct.transitions},i.updateQueue.baseState=nt,i.memoizedState=nt,i.flags&256){_e=Ji(Error(p(423)),i),i=lj(e,i,j,d,_e);break e}else if(j!==_e){_e=Ji(Error(p(424)),i),i=lj(e,i,j,d,_e);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,d=Vg(i,null,j,d),i.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(Ig(),j===_e){i=Zi(e,i,d);break e}Xi(e,i,j,d)}i=i.child}return i;case 5:return Ah(i),e===null&&Eg(i),j=i.type,_e=i.pendingProps,nt=e!==null?e.memoizedProps:null,ct=_e.children,Ef(j,_e)?ct=null:nt!==null&&Ef(j,nt)&&(i.flags|=32),gj(e,i),Xi(e,i,ct,d),i.child;case 6:return e===null&&Eg(i),null;case 13:return oj(e,i,d);case 4:return yh(i,i.stateNode.containerInfo),j=i.pendingProps,e===null?i.child=Ug(i,null,j,d):Xi(e,i,j,d),i.child;case 11:return j=i.type,_e=i.pendingProps,_e=i.elementType===j?_e:Ci(j,_e),Yi(e,i,j,_e,d);case 7:return Xi(e,i,i.pendingProps,d),i.child;case 8:return Xi(e,i,i.pendingProps.children,d),i.child;case 12:return Xi(e,i,i.pendingProps.children,d),i.child;case 10:e:{if(j=i.type._context,_e=i.pendingProps,nt=i.memoizedProps,ct=_e.value,G(Wg,j._currentValue),j._currentValue=ct,nt!==null)if(He(nt.value,ct)){if(nt.children===_e.children&&!Wf.current){i=Zi(e,i,d);break e}}else for(nt=i.child,nt!==null&&(nt.return=i);nt!==null;){var c=nt.dependencies;if(c!==null){ct=nt.child;for(var pt=c.firstContext;pt!==null;){if(pt.context===j){if(nt.tag===1){pt=mh(-1,d&-d),pt.tag=2;var gt=nt.updateQueue;if(gt!==null){gt=gt.shared;var St=gt.pending;St===null?pt.next=pt:(pt.next=St.next,St.next=pt),gt.pending=pt}}nt.lanes|=d,pt=nt.alternate,pt!==null&&(pt.lanes|=d),bh(nt.return,d,i),c.lanes|=d;break}pt=pt.next}}else if(nt.tag===10)ct=nt.type===i.type?null:nt.child;else if(nt.tag===18){if(ct=nt.return,ct===null)throw Error(p(341));ct.lanes|=d,c=ct.alternate,c!==null&&(c.lanes|=d),bh(ct,d,i),ct=nt.sibling}else ct=nt.child;if(ct!==null)ct.return=nt;else for(ct=nt;ct!==null;){if(ct===i){ct=null;break}if(nt=ct.sibling,nt!==null){nt.return=ct.return,ct=nt;break}ct=ct.return}nt=ct}Xi(e,i,_e.children,d),i=i.child}return i;case 9:return _e=i.type,j=i.pendingProps.children,ch(i,d),_e=eh(_e),j=j(_e),i.flags|=1,Xi(e,i,j,d),i.child;case 14:return j=i.type,_e=Ci(j,i.pendingProps),_e=Ci(j.type,_e),$i(e,i,j,_e,d);case 15:return bj(e,i,i.type,i.pendingProps,d);case 17:return j=i.type,_e=i.pendingProps,_e=i.elementType===j?_e:Ci(j,_e),ij(e,i),i.tag=1,Zf(j)?(e=!0,cg(i)):e=!1,ch(i,d),Gi(i,j,_e),Ii(i,j,_e,d),jj(null,i,j,!0,e,d);case 19:return xj(e,i,d);case 22:return dj(e,i,d)}throw Error(p(156,i.tag))};function Fk(e,i){return ac(e,i)}function $k(e,i,d,j){this.tag=e,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=j,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(e,i,d,j){return new $k(e,i,d,j)}function aj(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Zk(e){if(typeof e=="function")return aj(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Da)return 11;if(e===Ga)return 14}return 2}function Pg(e,i){var d=e.alternate;return d===null?(d=Bg(e.tag,i,e.key,e.mode),d.elementType=e.elementType,d.type=e.type,d.stateNode=e.stateNode,d.alternate=e,e.alternate=d):(d.pendingProps=i,d.type=e.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=e.flags&14680064,d.childLanes=e.childLanes,d.lanes=e.lanes,d.child=e.child,d.memoizedProps=e.memoizedProps,d.memoizedState=e.memoizedState,d.updateQueue=e.updateQueue,i=e.dependencies,d.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},d.sibling=e.sibling,d.index=e.index,d.ref=e.ref,d}function Rg(e,i,d,j,_e,nt){var ct=2;if(j=e,typeof e=="function")aj(e)&&(ct=1);else if(typeof e=="string")ct=5;else e:switch(e){case ya:return Tg(d.children,_e,nt,i);case za:ct=8,_e|=8;break;case Aa:return e=Bg(12,d,i,_e|2),e.elementType=Aa,e.lanes=nt,e;case Ea:return e=Bg(13,d,i,_e),e.elementType=Ea,e.lanes=nt,e;case Fa:return e=Bg(19,d,i,_e),e.elementType=Fa,e.lanes=nt,e;case Ia:return pj(d,_e,nt,i);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Ba:ct=10;break e;case Ca:ct=9;break e;case Da:ct=11;break e;case Ga:ct=14;break e;case Ha:ct=16,j=null;break e}throw Error(p(130,e==null?e:typeof e,""))}return i=Bg(ct,d,i,_e),i.elementType=e,i.type=j,i.lanes=nt,i}function Tg(e,i,d,j){return e=Bg(7,e,j,i),e.lanes=d,e}function pj(e,i,d,j){return e=Bg(22,e,j,i),e.elementType=Ia,e.lanes=d,e.stateNode={isHidden:!1},e}function Qg(e,i,d){return e=Bg(6,e,null,i),e.lanes=d,e}function Sg(e,i,d){return i=Bg(4,e.children!==null?e.children:[],e.key,i),i.lanes=d,i.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},i}function al(e,i,d,j,_e){this.tag=i,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=j,this.onRecoverableError=_e,this.mutableSourceEagerHydrationData=null}function bl(e,i,d,j,_e,nt,ct,c,pt){return e=new al(e,i,d,c,pt),i===1?(i=1,nt===!0&&(i|=8)):i=0,nt=Bg(3,null,null,i),e.current=nt,nt.stateNode=e,nt.memoizedState={element:j,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},kh(nt),e}function cl(e,i,d){var j=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:j==null?null:""+j,children:e,containerInfo:i,implementation:d}}function dl(e){if(!e)return Vf;e=e._reactInternals;e:{if(Vb(e)!==e||e.tag!==1)throw Error(p(170));var i=e;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(e.tag===1){var d=e.type;if(Zf(d))return bg(e,d,i)}return i}function el(e,i,d,j,_e,nt,ct,c,pt){return e=bl(d,j,!0,e,_e,nt,ct,c,pt),e.context=dl(null),d=e.current,j=R(),_e=yi(d),nt=mh(j,_e),nt.callback=i??null,nh(d,nt,_e),e.current.lanes=_e,Ac(e,_e,j),Dk(e,j),e}function fl(e,i,d,j){var _e=i.current,nt=R(),ct=yi(_e);return d=dl(d),i.context===null?i.context=d:i.pendingContext=d,i=mh(nt,ct),i.payload={element:e},j=j===void 0?null:j,j!==null&&(i.callback=j),e=nh(_e,i,ct),e!==null&&(gi(e,_e,ct,nt),oh(e,_e,ct)),ct}function gl(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function hl(e,i){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var d=e.retryLane;e.retryLane=d!==0&&d<i?d:i}}function il(e,i){hl(e,i),(e=e.alternate)&&hl(e,i)}function jl(){return null}var kl=typeof reportError=="function"?reportError:function(e){console.error(e)};function ll(e){this._internalRoot=e}ml.prototype.render=ll.prototype.render=function(e){var i=this._internalRoot;if(i===null)throw Error(p(409));fl(e,i,null,null)};ml.prototype.unmount=ll.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var i=e.containerInfo;Rk(function(){fl(null,e,null,null)}),i[uf]=null}};function ml(e){this._internalRoot=e}ml.prototype.unstable_scheduleHydration=function(e){if(e){var i=Hc();e={blockedOn:null,target:e,priority:i};for(var d=0;d<Qc.length&&i!==0&&i<Qc[d].priority;d++);Qc.splice(d,0,e),d===0&&Vc(e)}};function nl(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function pl(){}function ql(e,i,d,j,_e){if(_e){if(typeof j=="function"){var nt=j;j=function(){var gt=gl(ct);nt.call(gt)}}var ct=el(i,j,e,0,null,!1,!1,"",pl);return e._reactRootContainer=ct,e[uf]=ct.current,sf(e.nodeType===8?e.parentNode:e),Rk(),ct}for(;_e=e.lastChild;)e.removeChild(_e);if(typeof j=="function"){var c=j;j=function(){var gt=gl(pt);c.call(gt)}}var pt=bl(e,0,!1,null,null,!1,!1,"",pl);return e._reactRootContainer=pt,e[uf]=pt.current,sf(e.nodeType===8?e.parentNode:e),Rk(function(){fl(i,pt,d,j)}),pt}function rl(e,i,d,j,_e){var nt=d._reactRootContainer;if(nt){var ct=nt;if(typeof _e=="function"){var c=_e;_e=function(){var pt=gl(ct);c.call(pt)}}fl(i,ct,e,_e)}else ct=ql(d,i,e,_e,j);return gl(ct)}Ec=function(e){switch(e.tag){case 3:var i=e.stateNode;if(i.current.memoizedState.isDehydrated){var d=tc(i.pendingLanes);d!==0&&(Cc(i,d|1),Dk(i,B()),!(K&6)&&(Gj=B()+500,jg()))}break;case 13:Rk(function(){var j=ih(e,1);if(j!==null){var _e=R();gi(j,e,1,_e)}}),il(e,1)}};Fc=function(e){if(e.tag===13){var i=ih(e,134217728);if(i!==null){var d=R();gi(i,e,134217728,d)}il(e,134217728)}};Gc=function(e){if(e.tag===13){var i=yi(e),d=ih(e,i);if(d!==null){var j=R();gi(d,e,i,j)}il(e,i)}};Hc=function(){return C};Ic=function(e,i){var d=C;try{return C=e,i()}finally{C=d}};yb=function(e,i,d){switch(i){case"input":if(bb(e,d),i=d.name,d.type==="radio"&&i!=null){for(d=e;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<d.length;i++){var j=d[i];if(j!==e&&j.form===e.form){var _e=Db(j);if(!_e)throw Error(p(90));Wa(j),bb(j,_e)}}}break;case"textarea":ib(e,d);break;case"select":i=d.value,i!=null&&fb(e,!!d.multiple,i,!1)}};Gb=Qk;Hb=Rk;var sl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Qk]},tl={findFiberByHostInstance:Wc,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ul={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Zb(e),e===null?null:e.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||jl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var vl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!vl.isDisabled&&vl.supportsFiber)try{kc=vl.inject(ul),lc=vl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=sl;reactDom_production_min.createPortal=function(e,i){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!nl(i))throw Error(p(200));return cl(e,i,null,d)};reactDom_production_min.createRoot=function(e,i){if(!nl(e))throw Error(p(299));var d=!1,j="",_e=kl;return i!=null&&(i.unstable_strictMode===!0&&(d=!0),i.identifierPrefix!==void 0&&(j=i.identifierPrefix),i.onRecoverableError!==void 0&&(_e=i.onRecoverableError)),i=bl(e,1,!1,null,null,d,!1,j,_e),e[uf]=i.current,sf(e.nodeType===8?e.parentNode:e),new ll(i)};reactDom_production_min.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var i=e._reactInternals;if(i===void 0)throw typeof e.render=="function"?Error(p(188)):(e=Object.keys(e).join(","),Error(p(268,e)));return e=Zb(i),e=e===null?null:e.stateNode,e};reactDom_production_min.flushSync=function(e){return Rk(e)};reactDom_production_min.hydrate=function(e,i,d){if(!ol(i))throw Error(p(200));return rl(null,e,i,!0,d)};reactDom_production_min.hydrateRoot=function(e,i,d){if(!nl(e))throw Error(p(405));var j=d!=null&&d.hydratedSources||null,_e=!1,nt="",ct=kl;if(d!=null&&(d.unstable_strictMode===!0&&(_e=!0),d.identifierPrefix!==void 0&&(nt=d.identifierPrefix),d.onRecoverableError!==void 0&&(ct=d.onRecoverableError)),i=el(i,null,e,1,d??null,_e,!1,nt,ct),e[uf]=i.current,sf(e),j)for(e=0;e<j.length;e++)d=j[e],_e=d._getVersion,_e=_e(d._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[d,_e]:i.mutableSourceEagerHydrationData.push(d,_e);return new ml(i)};reactDom_production_min.render=function(e,i,d){if(!ol(i))throw Error(p(200));return rl(null,e,i,!1,d)};reactDom_production_min.unmountComponentAtNode=function(e){if(!ol(e))throw Error(p(40));return e._reactRootContainer?(Rk(function(){rl(null,null,e,!1,function(){e._reactRootContainer=null,e[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Qk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(e,i,d,j){if(!ol(d))throw Error(p(200));if(e==null||e._reactInternals===void 0)throw Error(p(38));return rl(e,i,d,!1,j)};reactDom_production_min.version="18.3.1-next-f1338f8080-20240426";function checkDCE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(checkDCE)}catch(e){console.error(e)}}checkDCE(),reactDom.exports=reactDom_production_min;var reactDomExports=reactDom.exports;const vt=getDefaultExportFromCjs(reactDomExports);var m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const scriptRel="modulepreload",assetsURL=function(e){return"/"+e},seen={},__vitePreload=function(i,d,j){let _e=Promise.resolve();if(d&&d.length>0){document.getElementsByTagName("link");const ct=document.querySelector("meta[property=csp-nonce]"),c=(ct==null?void 0:ct.nonce)||(ct==null?void 0:ct.getAttribute("nonce"));_e=Promise.allSettled(d.map(pt=>{if(pt=assetsURL(pt),pt in seen)return;seen[pt]=!0;const gt=pt.endsWith(".css"),St=gt?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${pt}"]${St}`))return;const kt=document.createElement("link");if(kt.rel=gt?"stylesheet":scriptRel,gt||(kt.as="script"),kt.crossOrigin="",kt.href=pt,c&&kt.setAttribute("nonce",c),document.head.appendChild(kt),gt)return new Promise((At,Nt)=>{kt.addEventListener("load",At),kt.addEventListener("error",()=>Nt(new Error(`Unable to preload CSS for ${pt}`)))})}))}function nt(ct){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=ct,window.dispatchEvent(c),!c.defaultPrevented)throw ct}return _e.then(ct=>{for(const c of ct||[])c.status==="rejected"&&nt(c.reason);return i().catch(nt)})};/**
 * @remix-run/router v1.23.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var j in d)Object.prototype.hasOwnProperty.call(d,j)&&(e[j]=d[j])}return e},_extends$2.apply(this,arguments)}var Action;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(e){e===void 0&&(e={});function i(j,_e){let{pathname:nt,search:ct,hash:c}=j.location;return createLocation("",{pathname:nt,search:ct,hash:c},_e.state&&_e.state.usr||null,_e.state&&_e.state.key||"default")}function d(j,_e){return typeof _e=="string"?_e:createPath(_e)}return getUrlBasedHistory(i,d,null,e)}function invariant$1(e,i){if(e===!1||e===null||typeof e>"u")throw new Error(i)}function warning(e,i){if(!e){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(e,i){return{usr:e.state,key:e.key,idx:i}}function createLocation(e,i,d,j){return d===void 0&&(d=null),_extends$2({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof i=="string"?parsePath(i):i,{state:d,key:i&&i.key||j||createKey()})}function createPath(e){let{pathname:i="/",search:d="",hash:j=""}=e;return d&&d!=="?"&&(i+=d.charAt(0)==="?"?d:"?"+d),j&&j!=="#"&&(i+=j.charAt(0)==="#"?j:"#"+j),i}function parsePath(e){let i={};if(e){let d=e.indexOf("#");d>=0&&(i.hash=e.substr(d),e=e.substr(0,d));let j=e.indexOf("?");j>=0&&(i.search=e.substr(j),e=e.substr(0,j)),e&&(i.pathname=e)}return i}function getUrlBasedHistory(e,i,d,j){j===void 0&&(j={});let{window:_e=document.defaultView,v5Compat:nt=!1}=j,ct=_e.history,c=Action.Pop,pt=null,gt=St();gt==null&&(gt=0,ct.replaceState(_extends$2({},ct.state,{idx:gt}),""));function St(){return(ct.state||{idx:null}).idx}function kt(){c=Action.Pop;let Jt=St(),Dt=Jt==null?null:Jt-gt;gt=Jt,pt&&pt({action:c,location:zt.location,delta:Dt})}function At(Jt,Dt){c=Action.Push;let It=createLocation(zt.location,Jt,Dt);gt=St()+1;let Mt=getHistoryState(It,gt),Ht=zt.createHref(It);try{ct.pushState(Mt,"",Ht)}catch(tr){if(tr instanceof DOMException&&tr.name==="DataCloneError")throw tr;_e.location.assign(Ht)}nt&&pt&&pt({action:c,location:zt.location,delta:1})}function Nt(Jt,Dt){c=Action.Replace;let It=createLocation(zt.location,Jt,Dt);gt=St();let Mt=getHistoryState(It,gt),Ht=zt.createHref(It);ct.replaceState(Mt,"",Ht),nt&&pt&&pt({action:c,location:zt.location,delta:0})}function Vt(Jt){let Dt=_e.location.origin!=="null"?_e.location.origin:_e.location.href,It=typeof Jt=="string"?Jt:createPath(Jt);return It=It.replace(/ $/,"%20"),invariant$1(Dt,"No window.location.(origin|href) available to create URL for href: "+It),new URL(It,Dt)}let zt={get action(){return c},get location(){return e(_e,ct)},listen(Jt){if(pt)throw new Error("A history only accepts one active listener");return _e.addEventListener(PopStateEventType,kt),pt=Jt,()=>{_e.removeEventListener(PopStateEventType,kt),pt=null}},createHref(Jt){return i(_e,Jt)},createURL:Vt,encodeLocation(Jt){let Dt=Vt(Jt);return{pathname:Dt.pathname,search:Dt.search,hash:Dt.hash}},push:At,replace:Nt,go(Jt){return ct.go(Jt)}};return zt}var ResultType;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(ResultType||(ResultType={}));function matchRoutes(e,i,d){return d===void 0&&(d="/"),matchRoutesImpl(e,i,d)}function matchRoutesImpl(e,i,d,j){let _e=typeof i=="string"?parsePath(i):i,nt=stripBasename(_e.pathname||"/",d);if(nt==null)return null;let ct=flattenRoutes(e);rankRouteBranches(ct);let c=null;for(let pt=0;c==null&&pt<ct.length;++pt){let gt=decodePath(nt);c=matchRouteBranch(ct[pt],gt)}return c}function flattenRoutes(e,i,d,j){i===void 0&&(i=[]),d===void 0&&(d=[]),j===void 0&&(j="");let _e=(nt,ct,c)=>{let pt={relativePath:c===void 0?nt.path||"":c,caseSensitive:nt.caseSensitive===!0,childrenIndex:ct,route:nt};pt.relativePath.startsWith("/")&&(invariant$1(pt.relativePath.startsWith(j),'Absolute route path "'+pt.relativePath+'" nested under path '+('"'+j+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),pt.relativePath=pt.relativePath.slice(j.length));let gt=joinPaths([j,pt.relativePath]),St=d.concat(pt);nt.children&&nt.children.length>0&&(invariant$1(nt.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+gt+'".')),flattenRoutes(nt.children,i,St,gt)),!(nt.path==null&&!nt.index)&&i.push({path:gt,score:computeScore(gt,nt.index),routesMeta:St})};return e.forEach((nt,ct)=>{var c;if(nt.path===""||!((c=nt.path)!=null&&c.includes("?")))_e(nt,ct);else for(let pt of explodeOptionalSegments(nt.path))_e(nt,ct,pt)}),i}function explodeOptionalSegments(e){let i=e.split("/");if(i.length===0)return[];let[d,...j]=i,_e=d.endsWith("?"),nt=d.replace(/\?$/,"");if(j.length===0)return _e?[nt,""]:[nt];let ct=explodeOptionalSegments(j.join("/")),c=[];return c.push(...ct.map(pt=>pt===""?nt:[nt,pt].join("/"))),_e&&c.push(...ct),c.map(pt=>e.startsWith("/")&&pt===""?"/":pt)}function rankRouteBranches(e){e.sort((i,d)=>i.score!==d.score?d.score-i.score:compareIndexes(i.routesMeta.map(j=>j.childrenIndex),d.routesMeta.map(j=>j.childrenIndex)))}const paramRe=/^:[\w-]+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=e=>e==="*";function computeScore(e,i){let d=e.split("/"),j=d.length;return d.some(isSplat)&&(j+=splatPenalty),i&&(j+=indexRouteValue),d.filter(_e=>!isSplat(_e)).reduce((_e,nt)=>_e+(paramRe.test(nt)?dynamicSegmentValue:nt===""?emptySegmentValue:staticSegmentValue),j)}function compareIndexes(e,i){return e.length===i.length&&e.slice(0,-1).every((j,_e)=>j===i[_e])?e[e.length-1]-i[i.length-1]:0}function matchRouteBranch(e,i,d){let{routesMeta:j}=e,_e={},nt="/",ct=[];for(let c=0;c<j.length;++c){let pt=j[c],gt=c===j.length-1,St=nt==="/"?i:i.slice(nt.length)||"/",kt=matchPath({path:pt.relativePath,caseSensitive:pt.caseSensitive,end:gt},St),At=pt.route;if(!kt)return null;Object.assign(_e,kt.params),ct.push({params:_e,pathname:joinPaths([nt,kt.pathname]),pathnameBase:normalizePathname(joinPaths([nt,kt.pathnameBase])),route:At}),kt.pathnameBase!=="/"&&(nt=joinPaths([nt,kt.pathnameBase]))}return ct}function matchPath(e,i){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[d,j]=compilePath(e.path,e.caseSensitive,e.end),_e=i.match(d);if(!_e)return null;let nt=_e[0],ct=nt.replace(/(.)\/+$/,"$1"),c=_e.slice(1);return{params:j.reduce((gt,St,kt)=>{let{paramName:At,isOptional:Nt}=St;if(At==="*"){let zt=c[kt]||"";ct=nt.slice(0,nt.length-zt.length).replace(/(.)\/+$/,"$1")}const Vt=c[kt];return Nt&&!Vt?gt[At]=void 0:gt[At]=(Vt||"").replace(/%2F/g,"/"),gt},{}),pathname:nt,pathnameBase:ct,pattern:e}}function compilePath(e,i,d){i===void 0&&(i=!1),d===void 0&&(d=!0),warning(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let j=[],_e="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(ct,c,pt)=>(j.push({paramName:c,isOptional:pt!=null}),pt?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(j.push({paramName:"*"}),_e+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):d?_e+="\\/*$":e!==""&&e!=="/"&&(_e+="(?:(?=\\/|$))"),[new RegExp(_e,i?void 0:"i"),j]}function decodePath(e){try{return e.split("/").map(i=>decodeURIComponent(i).replace(/\//g,"%2F")).join("/")}catch(i){return warning(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),e}}function stripBasename(e,i){if(i==="/")return e;if(!e.toLowerCase().startsWith(i.toLowerCase()))return null;let d=i.endsWith("/")?i.length-1:i.length,j=e.charAt(d);return j&&j!=="/"?null:e.slice(d)||"/"}const ABSOLUTE_URL_REGEX$1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,isAbsoluteUrl=e=>ABSOLUTE_URL_REGEX$1.test(e);function resolvePath(e,i){i===void 0&&(i="/");let{pathname:d,search:j="",hash:_e=""}=typeof e=="string"?parsePath(e):e,nt;if(d)if(isAbsoluteUrl(d))nt=d;else{if(d.includes("//")){let ct=d;d=d.replace(/\/\/+/g,"/"),warning(!1,"Pathnames cannot have embedded double slashes - normalizing "+(ct+" -> "+d))}d.startsWith("/")?nt=resolvePathname(d.substring(1),"/"):nt=resolvePathname(d,i)}else nt=i;return{pathname:nt,search:normalizeSearch(j),hash:normalizeHash(_e)}}function resolvePathname(e,i){let d=i.replace(/\/+$/,"").split("/");return e.split("/").forEach(_e=>{_e===".."?d.length>1&&d.pop():_e!=="."&&d.push(_e)}),d.length>1?d.join("/"):"/"}function getInvalidPathError(e,i,d,j){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(j)+"].  Please separate it out to the ")+("`to."+d+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(e){return e.filter((i,d)=>d===0||i.route.path&&i.route.path.length>0)}function getResolveToMatches(e,i){let d=getPathContributingMatches(e);return i?d.map((j,_e)=>_e===d.length-1?j.pathname:j.pathnameBase):d.map(j=>j.pathnameBase)}function resolveTo(e,i,d,j){j===void 0&&(j=!1);let _e;typeof e=="string"?_e=parsePath(e):(_e=_extends$2({},e),invariant$1(!_e.pathname||!_e.pathname.includes("?"),getInvalidPathError("?","pathname","search",_e)),invariant$1(!_e.pathname||!_e.pathname.includes("#"),getInvalidPathError("#","pathname","hash",_e)),invariant$1(!_e.search||!_e.search.includes("#"),getInvalidPathError("#","search","hash",_e)));let nt=e===""||_e.pathname==="",ct=nt?"/":_e.pathname,c;if(ct==null)c=d;else{let kt=i.length-1;if(!j&&ct.startsWith("..")){let At=ct.split("/");for(;At[0]==="..";)At.shift(),kt-=1;_e.pathname=At.join("/")}c=kt>=0?i[kt]:"/"}let pt=resolvePath(_e,c),gt=ct&&ct!=="/"&&ct.endsWith("/"),St=(nt||ct===".")&&d.endsWith("/");return!pt.pathname.endsWith("/")&&(gt||St)&&(pt.pathname+="/"),pt}const joinPaths=e=>e.join("/").replace(/\/\/+/g,"/"),normalizePathname=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,normalizeHash=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function isRouteErrorResponse(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const validMutationMethodsArr=["post","put","patch","delete"];new Set(validMutationMethodsArr);const validRequestMethodsArr=["get",...validMutationMethodsArr];new Set(validRequestMethodsArr);/**
 * React Router v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var j in d)Object.prototype.hasOwnProperty.call(d,j)&&(e[j]=d[j])}return e},_extends$1.apply(this,arguments)}const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[],isDataRoute:!1}),RouteErrorContext=reactExports.createContext(null);function useHref(e,i){let{relative:d}=i===void 0?{}:i;useInRouterContext()||invariant$1(!1);let{basename:j,navigator:_e}=reactExports.useContext(NavigationContext),{hash:nt,pathname:ct,search:c}=useResolvedPath(e,{relative:d}),pt=ct;return j!=="/"&&(pt=ct==="/"?j:joinPaths([j,ct])),_e.createHref({pathname:pt,search:c,hash:nt})}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant$1(!1),reactExports.useContext(LocationContext).location}function useIsomorphicLayoutEffect$1(e){reactExports.useContext(NavigationContext).static||reactExports.useLayoutEffect(e)}function useNavigate(){let{isDataRoute:e}=reactExports.useContext(RouteContext);return e?useNavigateStable():useNavigateUnstable()}function useNavigateUnstable(){useInRouterContext()||invariant$1(!1);let e=reactExports.useContext(DataRouterContext),{basename:i,future:d,navigator:j}=reactExports.useContext(NavigationContext),{matches:_e}=reactExports.useContext(RouteContext),{pathname:nt}=useLocation(),ct=JSON.stringify(getResolveToMatches(_e,d.v7_relativeSplatPath)),c=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{c.current=!0}),reactExports.useCallback(function(gt,St){if(St===void 0&&(St={}),!c.current)return;if(typeof gt=="number"){j.go(gt);return}let kt=resolveTo(gt,JSON.parse(ct),nt,St.relative==="path");e==null&&i!=="/"&&(kt.pathname=kt.pathname==="/"?i:joinPaths([i,kt.pathname])),(St.replace?j.replace:j.push)(kt,St.state,St)},[i,j,ct,nt,e])}function useParams(){let{matches:e}=reactExports.useContext(RouteContext),i=e[e.length-1];return i?i.params:{}}function useResolvedPath(e,i){let{relative:d}=i===void 0?{}:i,{future:j}=reactExports.useContext(NavigationContext),{matches:_e}=reactExports.useContext(RouteContext),{pathname:nt}=useLocation(),ct=JSON.stringify(getResolveToMatches(_e,j.v7_relativeSplatPath));return reactExports.useMemo(()=>resolveTo(e,JSON.parse(ct),nt,d==="path"),[e,ct,nt,d])}function useRoutes(e,i){return useRoutesImpl(e,i)}function useRoutesImpl(e,i,d,j){useInRouterContext()||invariant$1(!1);let{navigator:_e}=reactExports.useContext(NavigationContext),{matches:nt}=reactExports.useContext(RouteContext),ct=nt[nt.length-1],c=ct?ct.params:{};ct&&ct.pathname;let pt=ct?ct.pathnameBase:"/";ct&&ct.route;let gt=useLocation(),St;if(i){var kt;let Jt=typeof i=="string"?parsePath(i):i;pt==="/"||(kt=Jt.pathname)!=null&&kt.startsWith(pt)||invariant$1(!1),St=Jt}else St=gt;let At=St.pathname||"/",Nt=At;if(pt!=="/"){let Jt=pt.replace(/^\//,"").split("/");Nt="/"+At.replace(/^\//,"").split("/").slice(Jt.length).join("/")}let Vt=matchRoutes(e,{pathname:Nt}),zt=_renderMatches(Vt&&Vt.map(Jt=>Object.assign({},Jt,{params:Object.assign({},c,Jt.params),pathname:joinPaths([pt,_e.encodeLocation?_e.encodeLocation(Jt.pathname).pathname:Jt.pathname]),pathnameBase:Jt.pathnameBase==="/"?pt:joinPaths([pt,_e.encodeLocation?_e.encodeLocation(Jt.pathnameBase).pathname:Jt.pathnameBase])})),nt,d,j);return i&&zt?reactExports.createElement(LocationContext.Provider,{value:{location:_extends$1({pathname:"/",search:"",hash:"",state:null,key:"default"},St),navigationType:Action.Pop}},zt):zt}function DefaultErrorComponent(){let e=useRouteError(),i=isRouteErrorResponse(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),d=e instanceof Error?e.stack:null,_e={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},i),d?reactExports.createElement("pre",{style:_e},d):null,null)}const defaultErrorElement=reactExports.createElement(DefaultErrorComponent,null);class RenderErrorBoundary extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,d){return d.location!==i.location||d.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:d.error,location:d.location,revalidation:i.revalidation||d.revalidation}}componentDidCatch(i,d){console.error("React Router caught the following error during render",i,d)}render(){return this.state.error!==void 0?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(e){let{routeContext:i,match:d,children:j}=e,_e=reactExports.useContext(DataRouterContext);return _e&&_e.static&&_e.staticContext&&(d.route.errorElement||d.route.ErrorBoundary)&&(_e.staticContext._deepestRenderedBoundaryId=d.route.id),reactExports.createElement(RouteContext.Provider,{value:i},j)}function _renderMatches(e,i,d,j){var _e;if(i===void 0&&(i=[]),d===void 0&&(d=null),j===void 0&&(j=null),e==null){var nt;if(!d)return null;if(d.errors)e=d.matches;else if((nt=j)!=null&&nt.v7_partialHydration&&i.length===0&&!d.initialized&&d.matches.length>0)e=d.matches;else return null}let ct=e,c=(_e=d)==null?void 0:_e.errors;if(c!=null){let St=ct.findIndex(kt=>kt.route.id&&(c==null?void 0:c[kt.route.id])!==void 0);St>=0||invariant$1(!1),ct=ct.slice(0,Math.min(ct.length,St+1))}let pt=!1,gt=-1;if(d&&j&&j.v7_partialHydration)for(let St=0;St<ct.length;St++){let kt=ct[St];if((kt.route.HydrateFallback||kt.route.hydrateFallbackElement)&&(gt=St),kt.route.id){let{loaderData:At,errors:Nt}=d,Vt=kt.route.loader&&At[kt.route.id]===void 0&&(!Nt||Nt[kt.route.id]===void 0);if(kt.route.lazy||Vt){pt=!0,gt>=0?ct=ct.slice(0,gt+1):ct=[ct[0]];break}}}return ct.reduceRight((St,kt,At)=>{let Nt,Vt=!1,zt=null,Jt=null;d&&(Nt=c&&kt.route.id?c[kt.route.id]:void 0,zt=kt.route.errorElement||defaultErrorElement,pt&&(gt<0&&At===0?(warningOnce("route-fallback"),Vt=!0,Jt=null):gt===At&&(Vt=!0,Jt=kt.route.hydrateFallbackElement||null)));let Dt=i.concat(ct.slice(0,At+1)),It=()=>{let Mt;return Nt?Mt=zt:Vt?Mt=Jt:kt.route.Component?Mt=reactExports.createElement(kt.route.Component,null):kt.route.element?Mt=kt.route.element:Mt=St,reactExports.createElement(RenderedRoute,{match:kt,routeContext:{outlet:St,matches:Dt,isDataRoute:d!=null},children:Mt})};return d&&(kt.route.ErrorBoundary||kt.route.errorElement||At===0)?reactExports.createElement(RenderErrorBoundary,{location:d.location,revalidation:d.revalidation,component:zt,error:Nt,children:It(),routeContext:{outlet:null,matches:Dt,isDataRoute:!0}}):It()},null)}var DataRouterHook$1=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(DataRouterHook$1||{}),DataRouterStateHook$1=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(DataRouterStateHook$1||{});function useDataRouterContext$1(e){let i=reactExports.useContext(DataRouterContext);return i||invariant$1(!1),i}function useDataRouterState(e){let i=reactExports.useContext(DataRouterStateContext);return i||invariant$1(!1),i}function useRouteContext(e){let i=reactExports.useContext(RouteContext);return i||invariant$1(!1),i}function useCurrentRouteId(e){let i=useRouteContext(),d=i.matches[i.matches.length-1];return d.route.id||invariant$1(!1),d.route.id}function useRouteError(){var e;let i=reactExports.useContext(RouteErrorContext),d=useDataRouterState(),j=useCurrentRouteId();return i!==void 0?i:(e=d.errors)==null?void 0:e[j]}function useNavigateStable(){let{router:e}=useDataRouterContext$1(DataRouterHook$1.UseNavigateStable),i=useCurrentRouteId(DataRouterStateHook$1.UseNavigateStable),d=reactExports.useRef(!1);return useIsomorphicLayoutEffect$1(()=>{d.current=!0}),reactExports.useCallback(function(_e,nt){nt===void 0&&(nt={}),d.current&&(typeof _e=="number"?e.navigate(_e):e.navigate(_e,_extends$1({fromRouteId:i},nt)))},[e,i])}const alreadyWarned$1={};function warningOnce(e,i,d){alreadyWarned$1[e]||(alreadyWarned$1[e]=!0)}function logV6DeprecationWarnings(e,i){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function Route(e){invariant$1(!1)}function Router(e){let{basename:i="/",children:d=null,location:j,navigationType:_e=Action.Pop,navigator:nt,static:ct=!1,future:c}=e;useInRouterContext()&&invariant$1(!1);let pt=i.replace(/^\/*/,"/"),gt=reactExports.useMemo(()=>({basename:pt,navigator:nt,static:ct,future:_extends$1({v7_relativeSplatPath:!1},c)}),[pt,c,nt,ct]);typeof j=="string"&&(j=parsePath(j));let{pathname:St="/",search:kt="",hash:At="",state:Nt=null,key:Vt="default"}=j,zt=reactExports.useMemo(()=>{let Jt=stripBasename(St,pt);return Jt==null?null:{location:{pathname:Jt,search:kt,hash:At,state:Nt,key:Vt},navigationType:_e}},[pt,St,kt,At,Nt,Vt,_e]);return zt==null?null:reactExports.createElement(NavigationContext.Provider,{value:gt},reactExports.createElement(LocationContext.Provider,{children:d,value:zt}))}function Routes(e){let{children:i,location:d}=e;return useRoutes(createRoutesFromChildren(i),d)}new Promise(()=>{});function createRoutesFromChildren(e,i){i===void 0&&(i=[]);let d=[];return reactExports.Children.forEach(e,(j,_e)=>{if(!reactExports.isValidElement(j))return;let nt=[...i,_e];if(j.type===reactExports.Fragment){d.push.apply(d,createRoutesFromChildren(j.props.children,nt));return}j.type!==Route&&invariant$1(!1),!j.props.index||!j.props.children||invariant$1(!1);let ct={id:j.props.id||nt.join("-"),caseSensitive:j.props.caseSensitive,element:j.props.element,Component:j.props.Component,index:j.props.index,path:j.props.path,loader:j.props.loader,action:j.props.action,errorElement:j.props.errorElement,ErrorBoundary:j.props.ErrorBoundary,hasErrorBoundary:j.props.ErrorBoundary!=null||j.props.errorElement!=null,shouldRevalidate:j.props.shouldRevalidate,handle:j.props.handle,lazy:j.props.lazy};j.props.children&&(ct.children=createRoutesFromChildren(j.props.children,nt)),d.push(ct)}),d}/**
 * React Router DOM v6.30.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends(){return _extends=Object.assign?Object.assign.bind():function(e){for(var i=1;i<arguments.length;i++){var d=arguments[i];for(var j in d)Object.prototype.hasOwnProperty.call(d,j)&&(e[j]=d[j])}return e},_extends.apply(this,arguments)}function _objectWithoutPropertiesLoose$1(e,i){if(e==null)return{};var d={},j=Object.keys(e),_e,nt;for(nt=0;nt<j.length;nt++)_e=j[nt],!(i.indexOf(_e)>=0)&&(d[_e]=e[_e]);return d}function isModifiedEvent(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function shouldProcessLinkClick(e,i){return e.button===0&&(!i||i==="_self")&&!isModifiedEvent(e)}const _excluded$2=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],_excluded2=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],REACT_ROUTER_VERSION="6";try{window.__reactRouterVersion=REACT_ROUTER_VERSION}catch{}const ViewTransitionContext=reactExports.createContext({isTransitioning:!1}),START_TRANSITION="startTransition",startTransitionImpl=React$1[START_TRANSITION];function BrowserRouter(e){let{basename:i,children:d,future:j,window:_e}=e,nt=reactExports.useRef();nt.current==null&&(nt.current=createBrowserHistory({window:_e,v5Compat:!0}));let ct=nt.current,[c,pt]=reactExports.useState({action:ct.action,location:ct.location}),{v7_startTransition:gt}=j||{},St=reactExports.useCallback(kt=>{gt&&startTransitionImpl?startTransitionImpl(()=>pt(kt)):pt(kt)},[pt,gt]);return reactExports.useLayoutEffect(()=>ct.listen(St),[ct,St]),reactExports.useEffect(()=>logV6DeprecationWarnings(j),[j]),reactExports.createElement(Router,{basename:i,children:d,location:c.location,navigationType:c.action,navigator:ct,future:j})}const isBrowser$1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",ABSOLUTE_URL_REGEX=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Link=reactExports.forwardRef(function(i,d){let{onClick:j,relative:_e,reloadDocument:nt,replace:ct,state:c,target:pt,to:gt,preventScrollReset:St,viewTransition:kt}=i,At=_objectWithoutPropertiesLoose$1(i,_excluded$2),{basename:Nt}=reactExports.useContext(NavigationContext),Vt,zt=!1;if(typeof gt=="string"&&ABSOLUTE_URL_REGEX.test(gt)&&(Vt=gt,isBrowser$1))try{let Mt=new URL(window.location.href),Ht=gt.startsWith("//")?new URL(Mt.protocol+gt):new URL(gt),tr=stripBasename(Ht.pathname,Nt);Ht.origin===Mt.origin&&tr!=null?gt=tr+Ht.search+Ht.hash:zt=!0}catch{}let Jt=useHref(gt,{relative:_e}),Dt=useLinkClickHandler(gt,{replace:ct,state:c,target:pt,preventScrollReset:St,relative:_e,viewTransition:kt});function It(Mt){j&&j(Mt),Mt.defaultPrevented||Dt(Mt)}return reactExports.createElement("a",_extends({},At,{href:Vt||Jt,onClick:zt||nt?j:It,ref:d,target:pt}))}),NavLink=reactExports.forwardRef(function(i,d){let{"aria-current":j="page",caseSensitive:_e=!1,className:nt="",end:ct=!1,style:c,to:pt,viewTransition:gt,children:St}=i,kt=_objectWithoutPropertiesLoose$1(i,_excluded2),At=useResolvedPath(pt,{relative:kt.relative}),Nt=useLocation(),Vt=reactExports.useContext(DataRouterStateContext),{navigator:zt,basename:Jt}=reactExports.useContext(NavigationContext),Dt=Vt!=null&&useViewTransitionState(At)&&gt===!0,It=zt.encodeLocation?zt.encodeLocation(At).pathname:At.pathname,Mt=Nt.pathname,Ht=Vt&&Vt.navigation&&Vt.navigation.location?Vt.navigation.location.pathname:null;_e||(Mt=Mt.toLowerCase(),Ht=Ht?Ht.toLowerCase():null,It=It.toLowerCase()),Ht&&Jt&&(Ht=stripBasename(Ht,Jt)||Ht);const tr=It!=="/"&&It.endsWith("/")?It.length-1:It.length;let er=Mt===It||!ct&&Mt.startsWith(It)&&Mt.charAt(tr)==="/",dr=Ht!=null&&(Ht===It||!ct&&Ht.startsWith(It)&&Ht.charAt(It.length)==="/"),mr={isActive:er,isPending:dr,isTransitioning:Dt},Ur=er?j:void 0,Dr;typeof nt=="function"?Dr=nt(mr):Dr=[nt,er?"active":null,dr?"pending":null,Dt?"transitioning":null].filter(Boolean).join(" ");let Yr=typeof c=="function"?c(mr):c;return reactExports.createElement(Link,_extends({},kt,{"aria-current":Ur,className:Dr,ref:d,style:Yr,to:pt,viewTransition:gt}),typeof St=="function"?St(mr):St)});var DataRouterHook;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));function useDataRouterContext(e){let i=reactExports.useContext(DataRouterContext);return i||invariant$1(!1),i}function useLinkClickHandler(e,i){let{target:d,replace:j,state:_e,preventScrollReset:nt,relative:ct,viewTransition:c}=i===void 0?{}:i,pt=useNavigate(),gt=useLocation(),St=useResolvedPath(e,{relative:ct});return reactExports.useCallback(kt=>{if(shouldProcessLinkClick(kt,d)){kt.preventDefault();let At=j!==void 0?j:createPath(gt)===createPath(St);pt(e,{replace:At,state:_e,preventScrollReset:nt,relative:ct,viewTransition:c})}},[gt,pt,St,j,_e,d,e,nt,ct,c])}function useViewTransitionState(e,i){i===void 0&&(i={});let d=reactExports.useContext(ViewTransitionContext);d==null&&invariant$1(!1);let{basename:j}=useDataRouterContext(DataRouterHook.useViewTransitionState),_e=useResolvedPath(e,{relative:i.relative});if(!d.isTransitioning)return!1;let nt=stripBasename(d.currentLocation.pathname,j)||d.currentLocation.pathname,ct=stripBasename(d.nextLocation.pathname,j)||d.nextLocation.pathname;return matchPath(_e.pathname,ct)!=null||matchPath(_e.pathname,nt)!=null}var jt=e=>{switch(e){case"success":return ee;case"info":return ae;case"warning":return oe;case"error":return se;default:return null}},te=Array(12).fill(0),Yt=({visible:e,className:i})=>React.createElement("div",{className:["sonner-loading-wrapper",i].filter(Boolean).join(" "),"data-visible":e},React.createElement("div",{className:"sonner-spinner"},te.map((d,j)=>React.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${j}`})))),ee=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),oe=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),ae=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),se=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},React.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),Ot=React.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),Ft=()=>{let[e,i]=React.useState(document.hidden);return React.useEffect(()=>{let d=()=>{i(document.hidden)};return document.addEventListener("visibilitychange",d),()=>window.removeEventListener("visibilitychange",d)},[]),e},bt=1,yt=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let i=this.subscribers.indexOf(e);this.subscribers.splice(i,1)}),this.publish=e=>{this.subscribers.forEach(i=>i(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var i;let{message:d,...j}=e,_e=typeof(e==null?void 0:e.id)=="number"||((i=e.id)==null?void 0:i.length)>0?e.id:bt++,nt=this.toasts.find(c=>c.id===_e),ct=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(_e)&&this.dismissedToasts.delete(_e),nt?this.toasts=this.toasts.map(c=>c.id===_e?(this.publish({...c,...e,id:_e,title:d}),{...c,...e,id:_e,dismissible:ct,title:d}):c):this.addToast({title:d,...j,dismissible:ct,id:_e}),_e},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(i=>{this.subscribers.forEach(d=>d({id:i.id,dismiss:!0}))}),this.subscribers.forEach(i=>i({id:e,dismiss:!0})),e),this.message=(e,i)=>this.create({...i,message:e}),this.error=(e,i)=>this.create({...i,message:e,type:"error"}),this.success=(e,i)=>this.create({...i,type:"success",message:e}),this.info=(e,i)=>this.create({...i,type:"info",message:e}),this.warning=(e,i)=>this.create({...i,type:"warning",message:e}),this.loading=(e,i)=>this.create({...i,type:"loading",message:e}),this.promise=(e,i)=>{if(!i)return;let d;i.loading!==void 0&&(d=this.create({...i,promise:e,type:"loading",message:i.loading,description:typeof i.description!="function"?i.description:void 0}));let j=e instanceof Promise?e:e(),_e=d!==void 0,nt,ct=j.then(async pt=>{if(nt=["resolve",pt],React.isValidElement(pt))_e=!1,this.create({id:d,type:"default",message:pt});else if(ie(pt)&&!pt.ok){_e=!1;let gt=typeof i.error=="function"?await i.error(`HTTP error! status: ${pt.status}`):i.error,St=typeof i.description=="function"?await i.description(`HTTP error! status: ${pt.status}`):i.description;this.create({id:d,type:"error",message:gt,description:St})}else if(i.success!==void 0){_e=!1;let gt=typeof i.success=="function"?await i.success(pt):i.success,St=typeof i.description=="function"?await i.description(pt):i.description;this.create({id:d,type:"success",message:gt,description:St})}}).catch(async pt=>{if(nt=["reject",pt],i.error!==void 0){_e=!1;let gt=typeof i.error=="function"?await i.error(pt):i.error,St=typeof i.description=="function"?await i.description(pt):i.description;this.create({id:d,type:"error",message:gt,description:St})}}).finally(()=>{var pt;_e&&(this.dismiss(d),d=void 0),(pt=i.finally)==null||pt.call(i)}),c=()=>new Promise((pt,gt)=>ct.then(()=>nt[0]==="reject"?gt(nt[1]):pt(nt[1])).catch(gt));return typeof d!="string"&&typeof d!="number"?{unwrap:c}:Object.assign(d,{unwrap:c})},this.custom=(e,i)=>{let d=(i==null?void 0:i.id)||bt++;return this.create({jsx:e(d),id:d,...i}),d},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},v$1=new yt,ne=(e,i)=>{let d=(i==null?void 0:i.id)||bt++;return v$1.addToast({title:e,...i,id:d}),d},ie=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",le=ne,ce=()=>v$1.toasts,de=()=>v$1.getActiveToasts();Object.assign(le,{success:v$1.success,info:v$1.info,warning:v$1.warning,error:v$1.error,custom:v$1.custom,message:v$1.message,promise:v$1.promise,dismiss:v$1.dismiss,loading:v$1.loading},{getHistory:ce,getToasts:de});function wt(e,{insertAt:i}={}){if(typeof document>"u")return;let d=document.head||document.getElementsByTagName("head")[0],j=document.createElement("style");j.type="text/css",i==="top"&&d.firstChild?d.insertBefore(j,d.firstChild):d.appendChild(j),j.styleSheet?j.styleSheet.cssText=e:j.appendChild(document.createTextNode(e))}wt(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function tt(e){return e.label!==void 0}var pe=3,me="32px",ge="16px",Wt=4e3,he=356,be=14,ye=20,we=200;function M(...e){return e.filter(Boolean).join(" ")}function xe(e){let[i,d]=e.split("-"),j=[];return i&&j.push(i),d&&j.push(d),j}var ve=e=>{var i,d,j,_e,nt,ct,c,pt,gt,St,kt;let{invert:At,toast:Nt,unstyled:Vt,interacting:zt,setHeights:Jt,visibleToasts:Dt,heights:It,index:Mt,toasts:Ht,expanded:tr,removeToast:er,defaultRichColors:dr,closeButton:mr,style:Ur,cancelButtonStyle:Dr,actionButtonStyle:Yr,className:es="",descriptionClassName:ms="",duration:Ms,position:Kr,gap:xr,loadingIcon:jr,expandByDefault:rr,classNames:ar,icons:$r,closeButtonAriaLabel:Ar="Close toast",pauseWhenPageIsHidden:Xr}=e,[us,Wr]=React.useState(null),[Vs,yn]=React.useState(null),[_n,zo]=React.useState(!1),[Cn,On]=React.useState(!1),[qr,Zs]=React.useState(!1),[Os,Us]=React.useState(!1),[Nn,cn]=React.useState(!1),[Bn,Pn]=React.useState(0),[Ro,Ho]=React.useState(0),Zn=React.useRef(Nt.duration||Ms||Wt),Qo=React.useRef(null),Wo=React.useRef(null),uo=Mt===0,eo=Mt+1<=Dt,to=Nt.type,Io=Nt.dismissible!==!1,ou=Nt.className||"",Dl=Nt.descriptionClassName||"",Jl=React.useMemo(()=>It.findIndex(oo=>oo.toastId===Nt.id)||0,[It,Nt.id]),Ju=React.useMemo(()=>{var oo;return(oo=Nt.closeButton)!=null?oo:mr},[Nt.closeButton,mr]),zu=React.useMemo(()=>Nt.duration||Ms||Wt,[Nt.duration,Ms]),vu=React.useRef(0),Vo=React.useRef(0),Gl=React.useRef(0),fu=React.useRef(null),[ju,au]=Kr.split("-"),pu=React.useMemo(()=>It.reduce((oo,Uo,Lo)=>Lo>=Jl?oo:oo+Uo.height,0),[It,Jl]),Il=Ft(),Ou=Nt.invert||At,Zu=to==="loading";Vo.current=React.useMemo(()=>Jl*xr+pu,[Jl,pu]),React.useEffect(()=>{Zn.current=zu},[zu]),React.useEffect(()=>{zo(!0)},[]),React.useEffect(()=>{let oo=Wo.current;if(oo){let Uo=oo.getBoundingClientRect().height;return Ho(Uo),Jt(Lo=>[{toastId:Nt.id,height:Uo,position:Nt.position},...Lo]),()=>Jt(Lo=>Lo.filter(lu=>lu.toastId!==Nt.id))}},[Jt,Nt.id]),React.useLayoutEffect(()=>{if(!_n)return;let oo=Wo.current,Uo=oo.style.height;oo.style.height="auto";let Lo=oo.getBoundingClientRect().height;oo.style.height=Uo,Ho(Lo),Jt(lu=>lu.find(ps=>ps.toastId===Nt.id)?lu.map(ps=>ps.toastId===Nt.id?{...ps,height:Lo}:ps):[{toastId:Nt.id,height:Lo,position:Nt.position},...lu])},[_n,Nt.title,Nt.description,Jt,Nt.id]);let _o=React.useCallback(()=>{On(!0),Pn(Vo.current),Jt(oo=>oo.filter(Uo=>Uo.toastId!==Nt.id)),setTimeout(()=>{er(Nt)},we)},[Nt,er,Jt,Vo]);React.useEffect(()=>{if(Nt.promise&&to==="loading"||Nt.duration===1/0||Nt.type==="loading")return;let oo;return tr||zt||Xr&&Il?(()=>{if(Gl.current<vu.current){let Uo=new Date().getTime()-vu.current;Zn.current=Zn.current-Uo}Gl.current=new Date().getTime()})():Zn.current!==1/0&&(vu.current=new Date().getTime(),oo=setTimeout(()=>{var Uo;(Uo=Nt.onAutoClose)==null||Uo.call(Nt,Nt),_o()},Zn.current)),()=>clearTimeout(oo)},[tr,zt,Nt,to,Xr,Il,_o]),React.useEffect(()=>{Nt.delete&&_o()},[_o,Nt.delete]);function Ol(){var oo,Uo,Lo;return $r!=null&&$r.loading?React.createElement("div",{className:M(ar==null?void 0:ar.loader,(oo=Nt==null?void 0:Nt.classNames)==null?void 0:oo.loader,"sonner-loader"),"data-visible":to==="loading"},$r.loading):jr?React.createElement("div",{className:M(ar==null?void 0:ar.loader,(Uo=Nt==null?void 0:Nt.classNames)==null?void 0:Uo.loader,"sonner-loader"),"data-visible":to==="loading"},jr):React.createElement(Yt,{className:M(ar==null?void 0:ar.loader,(Lo=Nt==null?void 0:Nt.classNames)==null?void 0:Lo.loader),visible:to==="loading"})}return React.createElement("li",{tabIndex:0,ref:Wo,className:M(es,ou,ar==null?void 0:ar.toast,(i=Nt==null?void 0:Nt.classNames)==null?void 0:i.toast,ar==null?void 0:ar.default,ar==null?void 0:ar[to],(d=Nt==null?void 0:Nt.classNames)==null?void 0:d[to]),"data-sonner-toast":"","data-rich-colors":(j=Nt.richColors)!=null?j:dr,"data-styled":!(Nt.jsx||Nt.unstyled||Vt),"data-mounted":_n,"data-promise":!!Nt.promise,"data-swiped":Nn,"data-removed":Cn,"data-visible":eo,"data-y-position":ju,"data-x-position":au,"data-index":Mt,"data-front":uo,"data-swiping":qr,"data-dismissible":Io,"data-type":to,"data-invert":Ou,"data-swipe-out":Os,"data-swipe-direction":Vs,"data-expanded":!!(tr||rr&&_n),style:{"--index":Mt,"--toasts-before":Mt,"--z-index":Ht.length-Mt,"--offset":`${Cn?Bn:Vo.current}px`,"--initial-height":rr?"auto":`${Ro}px`,...Ur,...Nt.style},onDragEnd:()=>{Zs(!1),Wr(null),fu.current=null},onPointerDown:oo=>{Zu||!Io||(Qo.current=new Date,Pn(Vo.current),oo.target.setPointerCapture(oo.pointerId),oo.target.tagName!=="BUTTON"&&(Zs(!0),fu.current={x:oo.clientX,y:oo.clientY}))},onPointerUp:()=>{var oo,Uo,Lo,lu;if(Os||!Io)return;fu.current=null;let ps=Number(((oo=Wo.current)==null?void 0:oo.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Wl=Number(((Uo=Wo.current)==null?void 0:Uo.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),Bu=new Date().getTime()-((Lo=Qo.current)==null?void 0:Lo.getTime()),qo=us==="x"?ps:Wl,wn=Math.abs(qo)/Bu;if(Math.abs(qo)>=ye||wn>.11){Pn(Vo.current),(lu=Nt.onDismiss)==null||lu.call(Nt,Nt),yn(us==="x"?ps>0?"right":"left":Wl>0?"down":"up"),_o(),Us(!0),cn(!1);return}Zs(!1),Wr(null)},onPointerMove:oo=>{var Uo,Lo,lu,ps;if(!fu.current||!Io||((Uo=window.getSelection())==null?void 0:Uo.toString().length)>0)return;let Wl=oo.clientY-fu.current.y,Bu=oo.clientX-fu.current.x,qo=(Lo=e.swipeDirections)!=null?Lo:xe(Kr);!us&&(Math.abs(Bu)>1||Math.abs(Wl)>1)&&Wr(Math.abs(Bu)>Math.abs(Wl)?"x":"y");let wn={x:0,y:0};us==="y"?(qo.includes("top")||qo.includes("bottom"))&&(qo.includes("top")&&Wl<0||qo.includes("bottom")&&Wl>0)&&(wn.y=Wl):us==="x"&&(qo.includes("left")||qo.includes("right"))&&(qo.includes("left")&&Bu<0||qo.includes("right")&&Bu>0)&&(wn.x=Bu),(Math.abs(wn.x)>0||Math.abs(wn.y)>0)&&cn(!0),(lu=Wo.current)==null||lu.style.setProperty("--swipe-amount-x",`${wn.x}px`),(ps=Wo.current)==null||ps.style.setProperty("--swipe-amount-y",`${wn.y}px`)}},Ju&&!Nt.jsx?React.createElement("button",{"aria-label":Ar,"data-disabled":Zu,"data-close-button":!0,onClick:Zu||!Io?()=>{}:()=>{var oo;_o(),(oo=Nt.onDismiss)==null||oo.call(Nt,Nt)},className:M(ar==null?void 0:ar.closeButton,(_e=Nt==null?void 0:Nt.classNames)==null?void 0:_e.closeButton)},(nt=$r==null?void 0:$r.close)!=null?nt:Ot):null,Nt.jsx||reactExports.isValidElement(Nt.title)?Nt.jsx?Nt.jsx:typeof Nt.title=="function"?Nt.title():Nt.title:React.createElement(React.Fragment,null,to||Nt.icon||Nt.promise?React.createElement("div",{"data-icon":"",className:M(ar==null?void 0:ar.icon,(ct=Nt==null?void 0:Nt.classNames)==null?void 0:ct.icon)},Nt.promise||Nt.type==="loading"&&!Nt.icon?Nt.icon||Ol():null,Nt.type!=="loading"?Nt.icon||($r==null?void 0:$r[to])||jt(to):null):null,React.createElement("div",{"data-content":"",className:M(ar==null?void 0:ar.content,(c=Nt==null?void 0:Nt.classNames)==null?void 0:c.content)},React.createElement("div",{"data-title":"",className:M(ar==null?void 0:ar.title,(pt=Nt==null?void 0:Nt.classNames)==null?void 0:pt.title)},typeof Nt.title=="function"?Nt.title():Nt.title),Nt.description?React.createElement("div",{"data-description":"",className:M(ms,Dl,ar==null?void 0:ar.description,(gt=Nt==null?void 0:Nt.classNames)==null?void 0:gt.description)},typeof Nt.description=="function"?Nt.description():Nt.description):null),reactExports.isValidElement(Nt.cancel)?Nt.cancel:Nt.cancel&&tt(Nt.cancel)?React.createElement("button",{"data-button":!0,"data-cancel":!0,style:Nt.cancelButtonStyle||Dr,onClick:oo=>{var Uo,Lo;tt(Nt.cancel)&&Io&&((Lo=(Uo=Nt.cancel).onClick)==null||Lo.call(Uo,oo),_o())},className:M(ar==null?void 0:ar.cancelButton,(St=Nt==null?void 0:Nt.classNames)==null?void 0:St.cancelButton)},Nt.cancel.label):null,reactExports.isValidElement(Nt.action)?Nt.action:Nt.action&&tt(Nt.action)?React.createElement("button",{"data-button":!0,"data-action":!0,style:Nt.actionButtonStyle||Yr,onClick:oo=>{var Uo,Lo;tt(Nt.action)&&((Lo=(Uo=Nt.action).onClick)==null||Lo.call(Uo,oo),!oo.defaultPrevented&&_o())},className:M(ar==null?void 0:ar.actionButton,(kt=Nt==null?void 0:Nt.classNames)==null?void 0:kt.actionButton)},Nt.action.label):null))};function _t(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function Te(e,i){let d={};return[e,i].forEach((j,_e)=>{let nt=_e===1,ct=nt?"--mobile-offset":"--offset",c=nt?ge:me;function pt(gt){["top","right","bottom","left"].forEach(St=>{d[`${ct}-${St}`]=typeof gt=="number"?`${gt}px`:gt})}typeof j=="number"||typeof j=="string"?pt(j):typeof j=="object"?["top","right","bottom","left"].forEach(gt=>{j[gt]===void 0?d[`${ct}-${gt}`]=c:d[`${ct}-${gt}`]=typeof j[gt]=="number"?`${j[gt]}px`:j[gt]}):pt(c)}),d}var $e=reactExports.forwardRef(function(e,i){let{invert:d,position:j="bottom-right",hotkey:_e=["altKey","KeyT"],expand:nt,closeButton:ct,className:c,offset:pt,mobileOffset:gt,theme:St="light",richColors:kt,duration:At,style:Nt,visibleToasts:Vt=pe,toastOptions:zt,dir:Jt=_t(),gap:Dt=be,loadingIcon:It,icons:Mt,containerAriaLabel:Ht="Notifications",pauseWhenPageIsHidden:tr}=e,[er,dr]=React.useState([]),mr=React.useMemo(()=>Array.from(new Set([j].concat(er.filter(Xr=>Xr.position).map(Xr=>Xr.position)))),[er,j]),[Ur,Dr]=React.useState([]),[Yr,es]=React.useState(!1),[ms,Ms]=React.useState(!1),[Kr,xr]=React.useState(St!=="system"?St:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),jr=React.useRef(null),rr=_e.join("+").replace(/Key/g,"").replace(/Digit/g,""),ar=React.useRef(null),$r=React.useRef(!1),Ar=React.useCallback(Xr=>{dr(us=>{var Wr;return(Wr=us.find(Vs=>Vs.id===Xr.id))!=null&&Wr.delete||v$1.dismiss(Xr.id),us.filter(({id:Vs})=>Vs!==Xr.id)})},[]);return React.useEffect(()=>v$1.subscribe(Xr=>{if(Xr.dismiss){dr(us=>us.map(Wr=>Wr.id===Xr.id?{...Wr,delete:!0}:Wr));return}setTimeout(()=>{vt.flushSync(()=>{dr(us=>{let Wr=us.findIndex(Vs=>Vs.id===Xr.id);return Wr!==-1?[...us.slice(0,Wr),{...us[Wr],...Xr},...us.slice(Wr+1)]:[Xr,...us]})})})}),[]),React.useEffect(()=>{if(St!=="system"){xr(St);return}if(St==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?xr("dark"):xr("light")),typeof window>"u")return;let Xr=window.matchMedia("(prefers-color-scheme: dark)");try{Xr.addEventListener("change",({matches:us})=>{xr(us?"dark":"light")})}catch{Xr.addListener(({matches:Wr})=>{try{xr(Wr?"dark":"light")}catch(Vs){console.error(Vs)}})}},[St]),React.useEffect(()=>{er.length<=1&&es(!1)},[er]),React.useEffect(()=>{let Xr=us=>{var Wr,Vs;_e.every(yn=>us[yn]||us.code===yn)&&(es(!0),(Wr=jr.current)==null||Wr.focus()),us.code==="Escape"&&(document.activeElement===jr.current||(Vs=jr.current)!=null&&Vs.contains(document.activeElement))&&es(!1)};return document.addEventListener("keydown",Xr),()=>document.removeEventListener("keydown",Xr)},[_e]),React.useEffect(()=>{if(jr.current)return()=>{ar.current&&(ar.current.focus({preventScroll:!0}),ar.current=null,$r.current=!1)}},[jr.current]),React.createElement("section",{ref:i,"aria-label":`${Ht} ${rr}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},mr.map((Xr,us)=>{var Wr;let[Vs,yn]=Xr.split("-");return er.length?React.createElement("ol",{key:Xr,dir:Jt==="auto"?_t():Jt,tabIndex:-1,ref:jr,className:c,"data-sonner-toaster":!0,"data-theme":Kr,"data-y-position":Vs,"data-lifted":Yr&&er.length>1&&!nt,"data-x-position":yn,style:{"--front-toast-height":`${((Wr=Ur[0])==null?void 0:Wr.height)||0}px`,"--width":`${he}px`,"--gap":`${Dt}px`,...Nt,...Te(pt,gt)},onBlur:_n=>{$r.current&&!_n.currentTarget.contains(_n.relatedTarget)&&($r.current=!1,ar.current&&(ar.current.focus({preventScroll:!0}),ar.current=null))},onFocus:_n=>{_n.target instanceof HTMLElement&&_n.target.dataset.dismissible==="false"||$r.current||($r.current=!0,ar.current=_n.relatedTarget)},onMouseEnter:()=>es(!0),onMouseMove:()=>es(!0),onMouseLeave:()=>{ms||es(!1)},onDragEnd:()=>es(!1),onPointerDown:_n=>{_n.target instanceof HTMLElement&&_n.target.dataset.dismissible==="false"||Ms(!0)},onPointerUp:()=>Ms(!1)},er.filter(_n=>!_n.position&&us===0||_n.position===Xr).map((_n,zo)=>{var Cn,On;return React.createElement(ve,{key:_n.id,icons:Mt,index:zo,toast:_n,defaultRichColors:kt,duration:(Cn=zt==null?void 0:zt.duration)!=null?Cn:At,className:zt==null?void 0:zt.className,descriptionClassName:zt==null?void 0:zt.descriptionClassName,invert:d,visibleToasts:Vt,closeButton:(On=zt==null?void 0:zt.closeButton)!=null?On:ct,interacting:ms,position:Xr,style:zt==null?void 0:zt.style,unstyled:zt==null?void 0:zt.unstyled,classNames:zt==null?void 0:zt.classNames,cancelButtonStyle:zt==null?void 0:zt.cancelButtonStyle,actionButtonStyle:zt==null?void 0:zt.actionButtonStyle,removeToast:Ar,toasts:er.filter(qr=>qr.position==_n.position),heights:Ur.filter(qr=>qr.position==_n.position),setHeights:Dr,expandByDefault:nt,gap:Dt,loadingIcon:It,expanded:Yr,pauseWhenPageIsHidden:tr,swipeDirections:e.swipeDirections})})):null}))}),Subscribable=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},defaultTimeoutProvider={setTimeout:(e,i)=>setTimeout(e,i),clearTimeout:e=>clearTimeout(e),setInterval:(e,i)=>setInterval(e,i),clearInterval:e=>clearInterval(e)},ry,KS,XA,TimeoutManager=(XA=class{constructor(){wl(this,ry,defaultTimeoutProvider);wl(this,KS,!1)}setTimeoutProvider(e){jo(this,ry,e)}setTimeout(e,i){return qs(this,ry).setTimeout(e,i)}clearTimeout(e){qs(this,ry).clearTimeout(e)}setInterval(e,i){return qs(this,ry).setInterval(e,i)}clearInterval(e){qs(this,ry).clearInterval(e)}},ry=new WeakMap,KS=new WeakMap,XA),timeoutManager=new TimeoutManager;function systemSetTimeoutZero(e){setTimeout(e,0)}var isServer=typeof window>"u"||"Deno"in globalThis;function noop$2(){}function functionalUpdate(e,i){return typeof e=="function"?e(i):e}function isValidTimeout(e){return typeof e=="number"&&e>=0&&e!==1/0}function timeUntilStale(e,i){return Math.max(e+(i||0)-Date.now(),0)}function resolveStaleTime(e,i){return typeof e=="function"?e(i):e}function resolveEnabled(e,i){return typeof e=="function"?e(i):e}function matchQuery(e,i){const{type:d="all",exact:j,fetchStatus:_e,predicate:nt,queryKey:ct,stale:c}=e;if(ct){if(j){if(i.queryHash!==hashQueryKeyByOptions(ct,i.options))return!1}else if(!partialMatchKey(i.queryKey,ct))return!1}if(d!=="all"){const pt=i.isActive();if(d==="active"&&!pt||d==="inactive"&&pt)return!1}return!(typeof c=="boolean"&&i.isStale()!==c||_e&&_e!==i.state.fetchStatus||nt&&!nt(i))}function matchMutation(e,i){const{exact:d,status:j,predicate:_e,mutationKey:nt}=e;if(nt){if(!i.options.mutationKey)return!1;if(d){if(hashKey(i.options.mutationKey)!==hashKey(nt))return!1}else if(!partialMatchKey(i.options.mutationKey,nt))return!1}return!(j&&i.state.status!==j||_e&&!_e(i))}function hashQueryKeyByOptions(e,i){return((i==null?void 0:i.queryKeyHashFn)||hashKey)(e)}function hashKey(e){return JSON.stringify(e,(i,d)=>isPlainObject$1(d)?Object.keys(d).sort().reduce((j,_e)=>(j[_e]=d[_e],j),{}):d)}function partialMatchKey(e,i){return e===i?!0:typeof e!=typeof i?!1:e&&i&&typeof e=="object"&&typeof i=="object"?Object.keys(i).every(d=>partialMatchKey(e[d],i[d])):!1}var hasOwn=Object.prototype.hasOwnProperty;function replaceEqualDeep(e,i){if(e===i)return e;const d=isPlainArray(e)&&isPlainArray(i);if(!d&&!(isPlainObject$1(e)&&isPlainObject$1(i)))return i;const _e=(d?e:Object.keys(e)).length,nt=d?i:Object.keys(i),ct=nt.length,c=d?new Array(ct):{};let pt=0;for(let gt=0;gt<ct;gt++){const St=d?gt:nt[gt],kt=e[St],At=i[St];if(kt===At){c[St]=kt,(d?gt<_e:hasOwn.call(e,St))&&pt++;continue}if(kt===null||At===null||typeof kt!="object"||typeof At!="object"){c[St]=At;continue}const Nt=replaceEqualDeep(kt,At);c[St]=Nt,Nt===kt&&pt++}return _e===ct&&pt===_e?e:c}function isPlainArray(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function isPlainObject$1(e){if(!hasObjectPrototype(e))return!1;const i=e.constructor;if(i===void 0)return!0;const d=i.prototype;return!(!hasObjectPrototype(d)||!d.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function hasObjectPrototype(e){return Object.prototype.toString.call(e)==="[object Object]"}function sleep(e){return new Promise(i=>{timeoutManager.setTimeout(i,e)})}function replaceData(e,i,d){return typeof d.structuralSharing=="function"?d.structuralSharing(e,i):d.structuralSharing!==!1?replaceEqualDeep(e,i):i}function addToEnd(e,i,d=0){const j=[...e,i];return d&&j.length>d?j.slice(1):j}function addToStart(e,i,d=0){const j=[i,...e];return d&&j.length>d?j.slice(0,-1):j}var skipToken=Symbol();function ensureQueryFn(e,i){return!e.queryFn&&(i!=null&&i.initialPromise)?()=>i.initialPromise:!e.queryFn||e.queryFn===skipToken?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var r0,iy,q_,KA,FocusManager=(KA=class extends Subscribable{constructor(){super();wl(this,r0);wl(this,iy);wl(this,q_);jo(this,q_,i=>{if(!isServer&&window.addEventListener){const d=()=>i();return window.addEventListener("visibilitychange",d,!1),()=>{window.removeEventListener("visibilitychange",d)}}})}onSubscribe(){qs(this,iy)||this.setEventListener(qs(this,q_))}onUnsubscribe(){var i;this.hasListeners()||((i=qs(this,iy))==null||i.call(this),jo(this,iy,void 0))}setEventListener(i){var d;jo(this,q_,i),(d=qs(this,iy))==null||d.call(this),jo(this,iy,i(j=>{typeof j=="boolean"?this.setFocused(j):this.onFocus()}))}setFocused(i){qs(this,r0)!==i&&(jo(this,r0,i),this.onFocus())}onFocus(){const i=this.isFocused();this.listeners.forEach(d=>{d(i)})}isFocused(){var i;return typeof qs(this,r0)=="boolean"?qs(this,r0):((i=globalThis.document)==null?void 0:i.visibilityState)!=="hidden"}},r0=new WeakMap,iy=new WeakMap,q_=new WeakMap,KA),focusManager=new FocusManager;function pendingThenable(){let e,i;const d=new Promise((_e,nt)=>{e=_e,i=nt});d.status="pending",d.catch(()=>{});function j(_e){Object.assign(d,_e),delete d.resolve,delete d.reject}return d.resolve=_e=>{j({status:"fulfilled",value:_e}),e(_e)},d.reject=_e=>{j({status:"rejected",reason:_e}),i(_e)},d}var defaultScheduler=systemSetTimeoutZero;function createNotifyManager(){let e=[],i=0,d=c=>{c()},j=c=>{c()},_e=defaultScheduler;const nt=c=>{i?e.push(c):_e(()=>{d(c)})},ct=()=>{const c=e;e=[],c.length&&_e(()=>{j(()=>{c.forEach(pt=>{d(pt)})})})};return{batch:c=>{let pt;i++;try{pt=c()}finally{i--,i||ct()}return pt},batchCalls:c=>(...pt)=>{nt(()=>{c(...pt)})},schedule:nt,setNotifyFunction:c=>{d=c},setBatchNotifyFunction:c=>{j=c},setScheduler:c=>{_e=c}}}var notifyManager=createNotifyManager(),Z_,sy,X_,YA,OnlineManager=(YA=class extends Subscribable{constructor(){super();wl(this,Z_,!0);wl(this,sy);wl(this,X_);jo(this,X_,i=>{if(!isServer&&window.addEventListener){const d=()=>i(!0),j=()=>i(!1);return window.addEventListener("online",d,!1),window.addEventListener("offline",j,!1),()=>{window.removeEventListener("online",d),window.removeEventListener("offline",j)}}})}onSubscribe(){qs(this,sy)||this.setEventListener(qs(this,X_))}onUnsubscribe(){var i;this.hasListeners()||((i=qs(this,sy))==null||i.call(this),jo(this,sy,void 0))}setEventListener(i){var d;jo(this,X_,i),(d=qs(this,sy))==null||d.call(this),jo(this,sy,i(this.setOnline.bind(this)))}setOnline(i){qs(this,Z_)!==i&&(jo(this,Z_,i),this.listeners.forEach(j=>{j(i)}))}isOnline(){return qs(this,Z_)}},Z_=new WeakMap,sy=new WeakMap,X_=new WeakMap,YA),onlineManager=new OnlineManager;function defaultRetryDelay(e){return Math.min(1e3*2**e,3e4)}function canFetch(e){return(e??"online")==="online"?onlineManager.isOnline():!0}var CancelledError=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function createRetryer(e){let i=!1,d=0,j;const _e=pendingThenable(),nt=()=>_e.status!=="pending",ct=zt=>{var Jt;if(!nt()){const Dt=new CancelledError(zt);At(Dt),(Jt=e.onCancel)==null||Jt.call(e,Dt)}},c=()=>{i=!0},pt=()=>{i=!1},gt=()=>focusManager.isFocused()&&(e.networkMode==="always"||onlineManager.isOnline())&&e.canRun(),St=()=>canFetch(e.networkMode)&&e.canRun(),kt=zt=>{nt()||(j==null||j(),_e.resolve(zt))},At=zt=>{nt()||(j==null||j(),_e.reject(zt))},Nt=()=>new Promise(zt=>{var Jt;j=Dt=>{(nt()||gt())&&zt(Dt)},(Jt=e.onPause)==null||Jt.call(e)}).then(()=>{var zt;j=void 0,nt()||(zt=e.onContinue)==null||zt.call(e)}),Vt=()=>{if(nt())return;let zt;const Jt=d===0?e.initialPromise:void 0;try{zt=Jt??e.fn()}catch(Dt){zt=Promise.reject(Dt)}Promise.resolve(zt).then(kt).catch(Dt=>{var er;if(nt())return;const It=e.retry??(isServer?0:3),Mt=e.retryDelay??defaultRetryDelay,Ht=typeof Mt=="function"?Mt(d,Dt):Mt,tr=It===!0||typeof It=="number"&&d<It||typeof It=="function"&&It(d,Dt);if(i||!tr){At(Dt);return}d++,(er=e.onFail)==null||er.call(e,d,Dt),sleep(Ht).then(()=>gt()?void 0:Nt()).then(()=>{i?At(Dt):Vt()})})};return{promise:_e,status:()=>_e.status,cancel:ct,continue:()=>(j==null||j(),_e),cancelRetry:c,continueRetry:pt,canStart:St,start:()=>(St()?Vt():Nt().then(Vt),_e)}}var i0,QA,Removable=(QA=class{constructor(){wl(this,i0)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),isValidTimeout(this.gcTime)&&jo(this,i0,timeoutManager.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(isServer?1/0:5*60*1e3))}clearGcTimeout(){qs(this,i0)&&(timeoutManager.clearTimeout(qs(this,i0)),jo(this,i0,void 0))}},i0=new WeakMap,QA),s0,K_,Xp,n0,Nu,X1,o0,bm,_x,JA,Query=(JA=class extends Removable{constructor(i){super();wl(this,bm);wl(this,s0);wl(this,K_);wl(this,Xp);wl(this,n0);wl(this,Nu);wl(this,X1);wl(this,o0);jo(this,o0,!1),jo(this,X1,i.defaultOptions),this.setOptions(i.options),this.observers=[],jo(this,n0,i.client),jo(this,Xp,qs(this,n0).getQueryCache()),this.queryKey=i.queryKey,this.queryHash=i.queryHash,jo(this,s0,getDefaultState$1(this.options)),this.state=i.state??qs(this,s0),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var i;return(i=qs(this,Nu))==null?void 0:i.promise}setOptions(i){if(this.options={...qs(this,X1),...i},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const d=getDefaultState$1(this.options);d.data!==void 0&&(this.setState(successState(d.data,d.dataUpdatedAt)),jo(this,s0,d))}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&qs(this,Xp).remove(this)}setData(i,d){const j=replaceData(this.state.data,i,this.options);return Qu(this,bm,_x).call(this,{data:j,type:"success",dataUpdatedAt:d==null?void 0:d.updatedAt,manual:d==null?void 0:d.manual}),j}setState(i,d){Qu(this,bm,_x).call(this,{type:"setState",state:i,setStateOptions:d})}cancel(i){var j,_e;const d=(j=qs(this,Nu))==null?void 0:j.promise;return(_e=qs(this,Nu))==null||_e.cancel(i),d?d.then(noop$2).catch(noop$2):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(qs(this,s0))}isActive(){return this.observers.some(i=>resolveEnabled(i.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===skipToken||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(i=>resolveStaleTime(i.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(i=>i.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(i=0){return this.state.data===void 0?!0:i==="static"?!1:this.state.isInvalidated?!0:!timeUntilStale(this.state.dataUpdatedAt,i)}onFocus(){var d;const i=this.observers.find(j=>j.shouldFetchOnWindowFocus());i==null||i.refetch({cancelRefetch:!1}),(d=qs(this,Nu))==null||d.continue()}onOnline(){var d;const i=this.observers.find(j=>j.shouldFetchOnReconnect());i==null||i.refetch({cancelRefetch:!1}),(d=qs(this,Nu))==null||d.continue()}addObserver(i){this.observers.includes(i)||(this.observers.push(i),this.clearGcTimeout(),qs(this,Xp).notify({type:"observerAdded",query:this,observer:i}))}removeObserver(i){this.observers.includes(i)&&(this.observers=this.observers.filter(d=>d!==i),this.observers.length||(qs(this,Nu)&&(qs(this,o0)?qs(this,Nu).cancel({revert:!0}):qs(this,Nu).cancelRetry()),this.scheduleGc()),qs(this,Xp).notify({type:"observerRemoved",query:this,observer:i}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Qu(this,bm,_x).call(this,{type:"invalidate"})}async fetch(i,d){var pt,gt,St,kt,At,Nt,Vt,zt,Jt,Dt,It,Mt;if(this.state.fetchStatus!=="idle"&&((pt=qs(this,Nu))==null?void 0:pt.status())!=="rejected"){if(this.state.data!==void 0&&(d!=null&&d.cancelRefetch))this.cancel({silent:!0});else if(qs(this,Nu))return qs(this,Nu).continueRetry(),qs(this,Nu).promise}if(i&&this.setOptions(i),!this.options.queryFn){const Ht=this.observers.find(tr=>tr.options.queryFn);Ht&&this.setOptions(Ht.options)}const j=new AbortController,_e=Ht=>{Object.defineProperty(Ht,"signal",{enumerable:!0,get:()=>(jo(this,o0,!0),j.signal)})},nt=()=>{const Ht=ensureQueryFn(this.options,d),er=(()=>{const dr={client:qs(this,n0),queryKey:this.queryKey,meta:this.meta};return _e(dr),dr})();return jo(this,o0,!1),this.options.persister?this.options.persister(Ht,er,this):Ht(er)},c=(()=>{const Ht={fetchOptions:d,options:this.options,queryKey:this.queryKey,client:qs(this,n0),state:this.state,fetchFn:nt};return _e(Ht),Ht})();(gt=this.options.behavior)==null||gt.onFetch(c,this),jo(this,K_,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((St=c.fetchOptions)==null?void 0:St.meta))&&Qu(this,bm,_x).call(this,{type:"fetch",meta:(kt=c.fetchOptions)==null?void 0:kt.meta}),jo(this,Nu,createRetryer({initialPromise:d==null?void 0:d.initialPromise,fn:c.fetchFn,onCancel:Ht=>{Ht instanceof CancelledError&&Ht.revert&&this.setState({...qs(this,K_),fetchStatus:"idle"}),j.abort()},onFail:(Ht,tr)=>{Qu(this,bm,_x).call(this,{type:"failed",failureCount:Ht,error:tr})},onPause:()=>{Qu(this,bm,_x).call(this,{type:"pause"})},onContinue:()=>{Qu(this,bm,_x).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0}));try{const Ht=await qs(this,Nu).start();if(Ht===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(Ht),(Nt=(At=qs(this,Xp).config).onSuccess)==null||Nt.call(At,Ht,this),(zt=(Vt=qs(this,Xp).config).onSettled)==null||zt.call(Vt,Ht,this.state.error,this),Ht}catch(Ht){if(Ht instanceof CancelledError){if(Ht.silent)return qs(this,Nu).promise;if(Ht.revert){if(this.state.data===void 0)throw Ht;return this.state.data}}throw Qu(this,bm,_x).call(this,{type:"error",error:Ht}),(Dt=(Jt=qs(this,Xp).config).onError)==null||Dt.call(Jt,Ht,this),(Mt=(It=qs(this,Xp).config).onSettled)==null||Mt.call(It,this.state.data,Ht,this),Ht}finally{this.scheduleGc()}}},s0=new WeakMap,K_=new WeakMap,Xp=new WeakMap,n0=new WeakMap,Nu=new WeakMap,X1=new WeakMap,o0=new WeakMap,bm=new WeakSet,_x=function(i){const d=j=>{switch(i.type){case"failed":return{...j,fetchFailureCount:i.failureCount,fetchFailureReason:i.error};case"pause":return{...j,fetchStatus:"paused"};case"continue":return{...j,fetchStatus:"fetching"};case"fetch":return{...j,...fetchState(j.data,this.options),fetchMeta:i.meta??null};case"success":const _e={...j,...successState(i.data,i.dataUpdatedAt),dataUpdateCount:j.dataUpdateCount+1,...!i.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return jo(this,K_,i.manual?_e:void 0),_e;case"error":const nt=i.error;return{...j,error:nt,errorUpdateCount:j.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:j.fetchFailureCount+1,fetchFailureReason:nt,fetchStatus:"idle",status:"error"};case"invalidate":return{...j,isInvalidated:!0};case"setState":return{...j,...i.state}}};this.state=d(this.state),notifyManager.batch(()=>{this.observers.forEach(j=>{j.onQueryUpdate()}),qs(this,Xp).notify({query:this,type:"updated",action:i})})},JA);function fetchState(e,i){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:canFetch(i.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function successState(e,i){return{data:e,dataUpdatedAt:i??Date.now(),error:null,isInvalidated:!1,status:"success"}}function getDefaultState$1(e){const i=typeof e.initialData=="function"?e.initialData():e.initialData,d=i!==void 0,j=d?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:i,dataUpdateCount:0,dataUpdatedAt:d?j??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:d?"success":"pending",fetchStatus:"idle"}}function infiniteQueryBehavior(e){return{onFetch:(i,d)=>{var St,kt,At,Nt,Vt;const j=i.options,_e=(At=(kt=(St=i.fetchOptions)==null?void 0:St.meta)==null?void 0:kt.fetchMore)==null?void 0:At.direction,nt=((Nt=i.state.data)==null?void 0:Nt.pages)||[],ct=((Vt=i.state.data)==null?void 0:Vt.pageParams)||[];let c={pages:[],pageParams:[]},pt=0;const gt=async()=>{let zt=!1;const Jt=Mt=>{Object.defineProperty(Mt,"signal",{enumerable:!0,get:()=>(i.signal.aborted?zt=!0:i.signal.addEventListener("abort",()=>{zt=!0}),i.signal)})},Dt=ensureQueryFn(i.options,i.fetchOptions),It=async(Mt,Ht,tr)=>{if(zt)return Promise.reject();if(Ht==null&&Mt.pages.length)return Promise.resolve(Mt);const dr=(()=>{const Yr={client:i.client,queryKey:i.queryKey,pageParam:Ht,direction:tr?"backward":"forward",meta:i.options.meta};return Jt(Yr),Yr})(),mr=await Dt(dr),{maxPages:Ur}=i.options,Dr=tr?addToStart:addToEnd;return{pages:Dr(Mt.pages,mr,Ur),pageParams:Dr(Mt.pageParams,Ht,Ur)}};if(_e&&nt.length){const Mt=_e==="backward",Ht=Mt?getPreviousPageParam:getNextPageParam,tr={pages:nt,pageParams:ct},er=Ht(j,tr);c=await It(tr,er,Mt)}else{const Mt=e??nt.length;do{const Ht=pt===0?ct[0]??j.initialPageParam:getNextPageParam(j,c);if(pt>0&&Ht==null)break;c=await It(c,Ht),pt++}while(pt<Mt)}return c};i.options.persister?i.fetchFn=()=>{var zt,Jt;return(Jt=(zt=i.options).persister)==null?void 0:Jt.call(zt,gt,{client:i.client,queryKey:i.queryKey,meta:i.options.meta,signal:i.signal},d)}:i.fetchFn=gt}}}function getNextPageParam(e,{pages:i,pageParams:d}){const j=i.length-1;return i.length>0?e.getNextPageParam(i[j],i,d[j],d):void 0}function getPreviousPageParam(e,{pages:i,pageParams:d}){var j;return i.length>0?(j=e.getPreviousPageParam)==null?void 0:j.call(e,i[0],i,d[0],d):void 0}var K1,Hm,lp,a0,Wm,ty,_j,Mutation=(_j=class extends Removable{constructor(i){super();wl(this,Wm);wl(this,K1);wl(this,Hm);wl(this,lp);wl(this,a0);jo(this,K1,i.client),this.mutationId=i.mutationId,jo(this,lp,i.mutationCache),jo(this,Hm,[]),this.state=i.state||getDefaultState(),this.setOptions(i.options),this.scheduleGc()}setOptions(i){this.options=i,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(i){qs(this,Hm).includes(i)||(qs(this,Hm).push(i),this.clearGcTimeout(),qs(this,lp).notify({type:"observerAdded",mutation:this,observer:i}))}removeObserver(i){jo(this,Hm,qs(this,Hm).filter(d=>d!==i)),this.scheduleGc(),qs(this,lp).notify({type:"observerRemoved",mutation:this,observer:i})}optionalRemove(){qs(this,Hm).length||(this.state.status==="pending"?this.scheduleGc():qs(this,lp).remove(this))}continue(){var i;return((i=qs(this,a0))==null?void 0:i.continue())??this.execute(this.state.variables)}async execute(i){var ct,c,pt,gt,St,kt,At,Nt,Vt,zt,Jt,Dt,It,Mt,Ht,tr,er,dr,mr,Ur;const d=()=>{Qu(this,Wm,ty).call(this,{type:"continue"})},j={client:qs(this,K1),meta:this.options.meta,mutationKey:this.options.mutationKey};jo(this,a0,createRetryer({fn:()=>this.options.mutationFn?this.options.mutationFn(i,j):Promise.reject(new Error("No mutationFn found")),onFail:(Dr,Yr)=>{Qu(this,Wm,ty).call(this,{type:"failed",failureCount:Dr,error:Yr})},onPause:()=>{Qu(this,Wm,ty).call(this,{type:"pause"})},onContinue:d,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>qs(this,lp).canRun(this)}));const _e=this.state.status==="pending",nt=!qs(this,a0).canStart();try{if(_e)d();else{Qu(this,Wm,ty).call(this,{type:"pending",variables:i,isPaused:nt}),await((c=(ct=qs(this,lp).config).onMutate)==null?void 0:c.call(ct,i,this,j));const Yr=await((gt=(pt=this.options).onMutate)==null?void 0:gt.call(pt,i,j));Yr!==this.state.context&&Qu(this,Wm,ty).call(this,{type:"pending",context:Yr,variables:i,isPaused:nt})}const Dr=await qs(this,a0).start();return await((kt=(St=qs(this,lp).config).onSuccess)==null?void 0:kt.call(St,Dr,i,this.state.context,this,j)),await((Nt=(At=this.options).onSuccess)==null?void 0:Nt.call(At,Dr,i,this.state.context,j)),await((zt=(Vt=qs(this,lp).config).onSettled)==null?void 0:zt.call(Vt,Dr,null,this.state.variables,this.state.context,this,j)),await((Dt=(Jt=this.options).onSettled)==null?void 0:Dt.call(Jt,Dr,null,i,this.state.context,j)),Qu(this,Wm,ty).call(this,{type:"success",data:Dr}),Dr}catch(Dr){try{throw await((Mt=(It=qs(this,lp).config).onError)==null?void 0:Mt.call(It,Dr,i,this.state.context,this,j)),await((tr=(Ht=this.options).onError)==null?void 0:tr.call(Ht,Dr,i,this.state.context,j)),await((dr=(er=qs(this,lp).config).onSettled)==null?void 0:dr.call(er,void 0,Dr,this.state.variables,this.state.context,this,j)),await((Ur=(mr=this.options).onSettled)==null?void 0:Ur.call(mr,void 0,Dr,i,this.state.context,j)),Dr}finally{Qu(this,Wm,ty).call(this,{type:"error",error:Dr})}}finally{qs(this,lp).runNext(this)}}},K1=new WeakMap,Hm=new WeakMap,lp=new WeakMap,a0=new WeakMap,Wm=new WeakSet,ty=function(i){const d=j=>{switch(i.type){case"failed":return{...j,failureCount:i.failureCount,failureReason:i.error};case"pause":return{...j,isPaused:!0};case"continue":return{...j,isPaused:!1};case"pending":return{...j,context:i.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:i.isPaused,status:"pending",variables:i.variables,submittedAt:Date.now()};case"success":return{...j,data:i.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...j,data:void 0,error:i.error,failureCount:j.failureCount+1,failureReason:i.error,isPaused:!1,status:"error"}}};this.state=d(this.state),notifyManager.batch(()=>{qs(this,Hm).forEach(j=>{j.onMutationUpdate(i)}),qs(this,lp).notify({mutation:this,type:"updated",action:i})})},_j);function getDefaultState(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var vx,wm,Y1,$j,MutationCache=($j=class extends Subscribable{constructor(i={}){super();wl(this,vx);wl(this,wm);wl(this,Y1);this.config=i,jo(this,vx,new Set),jo(this,wm,new Map),jo(this,Y1,0)}build(i,d,j){const _e=new Mutation({client:i,mutationCache:this,mutationId:++XE(this,Y1)._,options:i.defaultMutationOptions(d),state:j});return this.add(_e),_e}add(i){qs(this,vx).add(i);const d=scopeFor(i);if(typeof d=="string"){const j=qs(this,wm).get(d);j?j.push(i):qs(this,wm).set(d,[i])}this.notify({type:"added",mutation:i})}remove(i){if(qs(this,vx).delete(i)){const d=scopeFor(i);if(typeof d=="string"){const j=qs(this,wm).get(d);if(j)if(j.length>1){const _e=j.indexOf(i);_e!==-1&&j.splice(_e,1)}else j[0]===i&&qs(this,wm).delete(d)}}this.notify({type:"removed",mutation:i})}canRun(i){const d=scopeFor(i);if(typeof d=="string"){const j=qs(this,wm).get(d),_e=j==null?void 0:j.find(nt=>nt.state.status==="pending");return!_e||_e===i}else return!0}runNext(i){var j;const d=scopeFor(i);if(typeof d=="string"){const _e=(j=qs(this,wm).get(d))==null?void 0:j.find(nt=>nt!==i&&nt.state.isPaused);return(_e==null?void 0:_e.continue())??Promise.resolve()}else return Promise.resolve()}clear(){notifyManager.batch(()=>{qs(this,vx).forEach(i=>{this.notify({type:"removed",mutation:i})}),qs(this,vx).clear(),qs(this,wm).clear()})}getAll(){return Array.from(qs(this,vx))}find(i){const d={exact:!0,...i};return this.getAll().find(j=>matchMutation(d,j))}findAll(i={}){return this.getAll().filter(d=>matchMutation(i,d))}notify(i){notifyManager.batch(()=>{this.listeners.forEach(d=>{d(i)})})}resumePausedMutations(){const i=this.getAll().filter(d=>d.state.isPaused);return notifyManager.batch(()=>Promise.all(i.map(d=>d.continue().catch(noop$2))))}},vx=new WeakMap,wm=new WeakMap,Y1=new WeakMap,$j);function scopeFor(e){var i;return(i=e.options.scope)==null?void 0:i.id}var qm,eP,QueryCache=(eP=class extends Subscribable{constructor(i={}){super();wl(this,qm);this.config=i,jo(this,qm,new Map)}build(i,d,j){const _e=d.queryKey,nt=d.queryHash??hashQueryKeyByOptions(_e,d);let ct=this.get(nt);return ct||(ct=new Query({client:i,queryKey:_e,queryHash:nt,options:i.defaultQueryOptions(d),state:j,defaultOptions:i.getQueryDefaults(_e)}),this.add(ct)),ct}add(i){qs(this,qm).has(i.queryHash)||(qs(this,qm).set(i.queryHash,i),this.notify({type:"added",query:i}))}remove(i){const d=qs(this,qm).get(i.queryHash);d&&(i.destroy(),d===i&&qs(this,qm).delete(i.queryHash),this.notify({type:"removed",query:i}))}clear(){notifyManager.batch(()=>{this.getAll().forEach(i=>{this.remove(i)})})}get(i){return qs(this,qm).get(i)}getAll(){return[...qs(this,qm).values()]}find(i){const d={exact:!0,...i};return this.getAll().find(j=>matchQuery(d,j))}findAll(i={}){const d=this.getAll();return Object.keys(i).length>0?d.filter(j=>matchQuery(i,j)):d}notify(i){notifyManager.batch(()=>{this.listeners.forEach(d=>{d(i)})})}onFocus(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onFocus()})})}onOnline(){notifyManager.batch(()=>{this.getAll().forEach(i=>{i.onOnline()})})}},qm=new WeakMap,eP),gu,ny,oy,Y_,Q_,ay,J_,ev,tP,QueryClient=(tP=class{constructor(e={}){wl(this,gu);wl(this,ny);wl(this,oy);wl(this,Y_);wl(this,Q_);wl(this,ay);wl(this,J_);wl(this,ev);jo(this,gu,e.queryCache||new QueryCache),jo(this,ny,e.mutationCache||new MutationCache),jo(this,oy,e.defaultOptions||{}),jo(this,Y_,new Map),jo(this,Q_,new Map),jo(this,ay,0)}mount(){XE(this,ay)._++,qs(this,ay)===1&&(jo(this,J_,focusManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),qs(this,gu).onFocus())})),jo(this,ev,onlineManager.subscribe(async e=>{e&&(await this.resumePausedMutations(),qs(this,gu).onOnline())})))}unmount(){var e,i;XE(this,ay)._--,qs(this,ay)===0&&((e=qs(this,J_))==null||e.call(this),jo(this,J_,void 0),(i=qs(this,ev))==null||i.call(this),jo(this,ev,void 0))}isFetching(e){return qs(this,gu).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return qs(this,ny).findAll({...e,status:"pending"}).length}getQueryData(e){var d;const i=this.defaultQueryOptions({queryKey:e});return(d=qs(this,gu).get(i.queryHash))==null?void 0:d.state.data}ensureQueryData(e){const i=this.defaultQueryOptions(e),d=qs(this,gu).build(this,i),j=d.state.data;return j===void 0?this.fetchQuery(e):(e.revalidateIfStale&&d.isStaleByTime(resolveStaleTime(i.staleTime,d))&&this.prefetchQuery(i),Promise.resolve(j))}getQueriesData(e){return qs(this,gu).findAll(e).map(({queryKey:i,state:d})=>{const j=d.data;return[i,j]})}setQueryData(e,i,d){const j=this.defaultQueryOptions({queryKey:e}),_e=qs(this,gu).get(j.queryHash),nt=_e==null?void 0:_e.state.data,ct=functionalUpdate(i,nt);if(ct!==void 0)return qs(this,gu).build(this,j).setData(ct,{...d,manual:!0})}setQueriesData(e,i,d){return notifyManager.batch(()=>qs(this,gu).findAll(e).map(({queryKey:j})=>[j,this.setQueryData(j,i,d)]))}getQueryState(e){var d;const i=this.defaultQueryOptions({queryKey:e});return(d=qs(this,gu).get(i.queryHash))==null?void 0:d.state}removeQueries(e){const i=qs(this,gu);notifyManager.batch(()=>{i.findAll(e).forEach(d=>{i.remove(d)})})}resetQueries(e,i){const d=qs(this,gu);return notifyManager.batch(()=>(d.findAll(e).forEach(j=>{j.reset()}),this.refetchQueries({type:"active",...e},i)))}cancelQueries(e,i={}){const d={revert:!0,...i},j=notifyManager.batch(()=>qs(this,gu).findAll(e).map(_e=>_e.cancel(d)));return Promise.all(j).then(noop$2).catch(noop$2)}invalidateQueries(e,i={}){return notifyManager.batch(()=>(qs(this,gu).findAll(e).forEach(d=>{d.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},i)))}refetchQueries(e,i={}){const d={...i,cancelRefetch:i.cancelRefetch??!0},j=notifyManager.batch(()=>qs(this,gu).findAll(e).filter(_e=>!_e.isDisabled()&&!_e.isStatic()).map(_e=>{let nt=_e.fetch(void 0,d);return d.throwOnError||(nt=nt.catch(noop$2)),_e.state.fetchStatus==="paused"?Promise.resolve():nt}));return Promise.all(j).then(noop$2)}fetchQuery(e){const i=this.defaultQueryOptions(e);i.retry===void 0&&(i.retry=!1);const d=qs(this,gu).build(this,i);return d.isStaleByTime(resolveStaleTime(i.staleTime,d))?d.fetch(i):Promise.resolve(d.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(noop$2).catch(noop$2)}fetchInfiniteQuery(e){return e.behavior=infiniteQueryBehavior(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(noop$2).catch(noop$2)}ensureInfiniteQueryData(e){return e.behavior=infiniteQueryBehavior(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return onlineManager.isOnline()?qs(this,ny).resumePausedMutations():Promise.resolve()}getQueryCache(){return qs(this,gu)}getMutationCache(){return qs(this,ny)}getDefaultOptions(){return qs(this,oy)}setDefaultOptions(e){jo(this,oy,e)}setQueryDefaults(e,i){qs(this,Y_).set(hashKey(e),{queryKey:e,defaultOptions:i})}getQueryDefaults(e){const i=[...qs(this,Y_).values()],d={};return i.forEach(j=>{partialMatchKey(e,j.queryKey)&&Object.assign(d,j.defaultOptions)}),d}setMutationDefaults(e,i){qs(this,Q_).set(hashKey(e),{mutationKey:e,defaultOptions:i})}getMutationDefaults(e){const i=[...qs(this,Q_).values()],d={};return i.forEach(j=>{partialMatchKey(e,j.mutationKey)&&Object.assign(d,j.defaultOptions)}),d}defaultQueryOptions(e){if(e._defaulted)return e;const i={...qs(this,oy).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return i.queryHash||(i.queryHash=hashQueryKeyByOptions(i.queryKey,i)),i.refetchOnReconnect===void 0&&(i.refetchOnReconnect=i.networkMode!=="always"),i.throwOnError===void 0&&(i.throwOnError=!!i.suspense),!i.networkMode&&i.persister&&(i.networkMode="offlineFirst"),i.queryFn===skipToken&&(i.enabled=!1),i}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...qs(this,oy).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){qs(this,gu).clear(),qs(this,ny).clear()}},gu=new WeakMap,ny=new WeakMap,oy=new WeakMap,Y_=new WeakMap,Q_=new WeakMap,ay=new WeakMap,J_=new WeakMap,ev=new WeakMap,tP),QueryClientContext=reactExports.createContext(void 0),QueryClientProvider=({client:e,children:i})=>(reactExports.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),jsxRuntimeExports.jsx(QueryClientContext.Provider,{value:e,children:i}));class ErrorBoundary extends reactExports.Component{constructor(){super(...arguments);ZA(this,"state",{hasError:!1})}static getDerivedStateFromError(d){return{hasError:!0,error:d}}componentDidCatch(d,j){console.error(" ErrorBoundary caught error:",d,j),console.error(" Error stack:",d.stack),console.error(" Component stack:",j.componentStack)}render(){return this.state.hasError?this.props.fallback||jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white p-4",children:jsxRuntimeExports.jsx("div",{className:"text-center max-w-md",children:jsxRuntimeExports.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Redirecting to home..."})]})})}):this.props.children}}const LayoutGroupContext=reactExports.createContext({});function useConstant(e){const i=reactExports.useRef(null);return i.current===null&&(i.current=e()),i.current}const isBrowser=typeof window<"u",useIsomorphicLayoutEffect=isBrowser?reactExports.useLayoutEffect:reactExports.useEffect,PresenceContext=reactExports.createContext(null);function addUniqueItem(e,i){e.indexOf(i)===-1&&e.push(i)}function removeItem(e,i){const d=e.indexOf(i);d>-1&&e.splice(d,1)}const clamp=(e,i,d)=>d>i?i:d<e?e:d;let invariant=()=>{};const MotionGlobalConfig={},isNumericalString=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function isObject$1(e){return typeof e=="object"&&e!==null}const isZeroValueString=e=>/^0[^.\s]+$/u.test(e);function memo(e){let i;return()=>(i===void 0&&(i=e()),i)}const noop$1=e=>e,combineFunctions=(e,i)=>d=>i(e(d)),pipe=(...e)=>e.reduce(combineFunctions),progress=(e,i,d)=>{const j=i-e;return j===0?1:(d-e)/j};class SubscriptionManager{constructor(){this.subscriptions=[]}add(i){return addUniqueItem(this.subscriptions,i),()=>removeItem(this.subscriptions,i)}notify(i,d,j){const _e=this.subscriptions.length;if(_e)if(_e===1)this.subscriptions[0](i,d,j);else for(let nt=0;nt<_e;nt++){const ct=this.subscriptions[nt];ct&&ct(i,d,j)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const secondsToMilliseconds=e=>e*1e3,millisecondsToSeconds=e=>e/1e3;function velocityPerSecond(e,i){return i?e*(1e3/i):0}const calcBezier=(e,i,d)=>(((1-3*d+3*i)*e+(3*d-6*i))*e+3*i)*e,subdivisionPrecision=1e-7,subdivisionMaxIterations=12;function binarySubdivide(e,i,d,j,_e){let nt,ct,c=0;do ct=i+(d-i)/2,nt=calcBezier(ct,j,_e)-e,nt>0?d=ct:i=ct;while(Math.abs(nt)>subdivisionPrecision&&++c<subdivisionMaxIterations);return ct}function cubicBezier(e,i,d,j){if(e===i&&d===j)return noop$1;const _e=nt=>binarySubdivide(nt,0,1,e,d);return nt=>nt===0||nt===1?nt:calcBezier(_e(nt),i,j)}const mirrorEasing=e=>i=>i<=.5?e(2*i)/2:(2-e(2*(1-i)))/2,reverseEasing=e=>i=>1-e(1-i),backOut=cubicBezier(.33,1.53,.69,.99),backIn=reverseEasing(backOut),backInOut=mirrorEasing(backIn),anticipate=e=>(e*=2)<1?.5*backIn(e):.5*(2-Math.pow(2,-10*(e-1))),circIn=e=>1-Math.sin(Math.acos(e)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circIn),easeIn=cubicBezier(.42,0,1,1),easeOut=cubicBezier(0,0,.58,1),easeInOut=cubicBezier(.42,0,.58,1),isEasingArray=e=>Array.isArray(e)&&typeof e[0]!="number",isBezierDefinition=e=>Array.isArray(e)&&typeof e[0]=="number",easingLookup={linear:noop$1,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate},isValidEasing=e=>typeof e=="string",easingDefinitionToFunction=e=>{if(isBezierDefinition(e)){invariant(e.length===4);const[i,d,j,_e]=e;return cubicBezier(i,d,j,_e)}else if(isValidEasing(e))return easingLookup[e];return e},stepsOrder=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function createRenderStep(e,i){let d=new Set,j=new Set,_e=!1,nt=!1;const ct=new WeakSet;let c={delta:0,timestamp:0,isProcessing:!1};function pt(St){ct.has(St)&&(gt.schedule(St),e()),St(c)}const gt={schedule:(St,kt=!1,At=!1)=>{const Vt=At&&_e?d:j;return kt&&ct.add(St),Vt.has(St)||Vt.add(St),St},cancel:St=>{j.delete(St),ct.delete(St)},process:St=>{if(c=St,_e){nt=!0;return}_e=!0,[d,j]=[j,d],d.forEach(pt),d.clear(),_e=!1,nt&&(nt=!1,gt.process(St))}};return gt}const maxElapsed=40;function createRenderBatcher(e,i){let d=!1,j=!0;const _e={delta:0,timestamp:0,isProcessing:!1},nt=()=>d=!0,ct=stepsOrder.reduce((Mt,Ht)=>(Mt[Ht]=createRenderStep(nt),Mt),{}),{setup:c,read:pt,resolveKeyframes:gt,preUpdate:St,update:kt,preRender:At,render:Nt,postRender:Vt}=ct,zt=()=>{const Mt=MotionGlobalConfig.useManualTiming?_e.timestamp:performance.now();d=!1,MotionGlobalConfig.useManualTiming||(_e.delta=j?1e3/60:Math.max(Math.min(Mt-_e.timestamp,maxElapsed),1)),_e.timestamp=Mt,_e.isProcessing=!0,c.process(_e),pt.process(_e),gt.process(_e),St.process(_e),kt.process(_e),At.process(_e),Nt.process(_e),Vt.process(_e),_e.isProcessing=!1,d&&i&&(j=!1,e(zt))},Jt=()=>{d=!0,j=!0,_e.isProcessing||e(zt)};return{schedule:stepsOrder.reduce((Mt,Ht)=>{const tr=ct[Ht];return Mt[Ht]=(er,dr=!1,mr=!1)=>(d||Jt(),tr.schedule(er,dr,mr)),Mt},{}),cancel:Mt=>{for(let Ht=0;Ht<stepsOrder.length;Ht++)ct[stepsOrder[Ht]].cancel(Mt)},state:_e,steps:ct}}const{schedule:frame,cancel:cancelFrame,state:frameData,steps:frameSteps}=createRenderBatcher(typeof requestAnimationFrame<"u"?requestAnimationFrame:noop$1,!0);let now;function clearTime(){now=void 0}const time={now:()=>(now===void 0&&time.set(frameData.isProcessing||MotionGlobalConfig.useManualTiming?frameData.timestamp:performance.now()),now),set:e=>{now=e,queueMicrotask(clearTime)}},checkStringStartsWith=e=>i=>typeof i=="string"&&i.startsWith(e),isCSSVariableName=checkStringStartsWith("--"),startsAsVariableToken=checkStringStartsWith("var(--"),isCSSVariableToken=e=>startsAsVariableToken(e)?singleCssVariableRegex.test(e.split("/*")[0].trim()):!1,singleCssVariableRegex=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,number={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},alpha={...number,transform:e=>clamp(0,1,e)},scale={...number,default:1},sanitize=e=>Math.round(e*1e5)/1e5,floatRegex=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function isNullish(e){return e==null}const singleColorRegex=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,isColorString=(e,i)=>d=>!!(typeof d=="string"&&singleColorRegex.test(d)&&d.startsWith(e)||i&&!isNullish(d)&&Object.prototype.hasOwnProperty.call(d,i)),splitColor=(e,i,d)=>j=>{if(typeof j!="string")return j;const[_e,nt,ct,c]=j.match(floatRegex);return{[e]:parseFloat(_e),[i]:parseFloat(nt),[d]:parseFloat(ct),alpha:c!==void 0?parseFloat(c):1}},clampRgbUnit=e=>clamp(0,255,e),rgbUnit={...number,transform:e=>Math.round(clampRgbUnit(e))},rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:e,green:i,blue:d,alpha:j=1})=>"rgba("+rgbUnit.transform(e)+", "+rgbUnit.transform(i)+", "+rgbUnit.transform(d)+", "+sanitize(alpha.transform(j))+")"};function parseHex(e){let i="",d="",j="",_e="";return e.length>5?(i=e.substring(1,3),d=e.substring(3,5),j=e.substring(5,7),_e=e.substring(7,9)):(i=e.substring(1,2),d=e.substring(2,3),j=e.substring(3,4),_e=e.substring(4,5),i+=i,d+=d,j+=j,_e+=_e),{red:parseInt(i,16),green:parseInt(d,16),blue:parseInt(j,16),alpha:_e?parseInt(_e,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},createUnitType=e=>({test:i=>typeof i=="string"&&i.endsWith(e)&&i.split(" ").length===1,parse:parseFloat,transform:i=>`${i}${e}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),vh=createUnitType("vh"),vw=createUnitType("vw"),progressPercentage={...percent,parse:e=>percent.parse(e)/100,transform:e=>percent.transform(e*100)},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:e,saturation:i,lightness:d,alpha:j=1})=>"hsla("+Math.round(e)+", "+percent.transform(sanitize(i))+", "+percent.transform(sanitize(d))+", "+sanitize(alpha.transform(j))+")"},color={test:e=>rgba.test(e)||hex.test(e)||hsla.test(e),parse:e=>rgba.test(e)?rgba.parse(e):hsla.test(e)?hsla.parse(e):hex.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?rgba.transform(e):hsla.transform(e),getAnimatableNone:e=>{const i=color.parse(e);return i.alpha=0,color.transform(i)}},colorRegex=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function test$1(e){var i,d;return isNaN(e)&&typeof e=="string"&&(((i=e.match(floatRegex))==null?void 0:i.length)||0)+(((d=e.match(colorRegex))==null?void 0:d.length)||0)>0}const NUMBER_TOKEN="number",COLOR_TOKEN="color",VAR_TOKEN="var",VAR_FUNCTION_TOKEN="var(",SPLIT_TOKEN="${}",complexRegex=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function analyseComplexValue(e){const i=e.toString(),d=[],j={color:[],number:[],var:[]},_e=[];let nt=0;const c=i.replace(complexRegex,pt=>(color.test(pt)?(j.color.push(nt),_e.push(COLOR_TOKEN),d.push(color.parse(pt))):pt.startsWith(VAR_FUNCTION_TOKEN)?(j.var.push(nt),_e.push(VAR_TOKEN),d.push(pt)):(j.number.push(nt),_e.push(NUMBER_TOKEN),d.push(parseFloat(pt))),++nt,SPLIT_TOKEN)).split(SPLIT_TOKEN);return{values:d,split:c,indexes:j,types:_e}}function parseComplexValue(e){return analyseComplexValue(e).values}function createTransformer(e){const{split:i,types:d}=analyseComplexValue(e),j=i.length;return _e=>{let nt="";for(let ct=0;ct<j;ct++)if(nt+=i[ct],_e[ct]!==void 0){const c=d[ct];c===NUMBER_TOKEN?nt+=sanitize(_e[ct]):c===COLOR_TOKEN?nt+=color.transform(_e[ct]):nt+=_e[ct]}return nt}}const convertNumbersToZero=e=>typeof e=="number"?0:color.test(e)?color.getAnimatableNone(e):e;function getAnimatableNone$1(e){const i=parseComplexValue(e);return createTransformer(e)(i.map(convertNumbersToZero))}const complex={test:test$1,parse:parseComplexValue,createTransformer,getAnimatableNone:getAnimatableNone$1};function hueToRgb(e,i,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?e+(i-e)*6*d:d<1/2?i:d<2/3?e+(i-e)*(2/3-d)*6:e}function hslaToRgba({hue:e,saturation:i,lightness:d,alpha:j}){e/=360,i/=100,d/=100;let _e=0,nt=0,ct=0;if(!i)_e=nt=ct=d;else{const c=d<.5?d*(1+i):d+i-d*i,pt=2*d-c;_e=hueToRgb(pt,c,e+1/3),nt=hueToRgb(pt,c,e),ct=hueToRgb(pt,c,e-1/3)}return{red:Math.round(_e*255),green:Math.round(nt*255),blue:Math.round(ct*255),alpha:j}}function mixImmediate(e,i){return d=>d>0?i:e}const mixNumber$1=(e,i,d)=>e+(i-e)*d,mixLinearColor=(e,i,d)=>{const j=e*e,_e=d*(i*i-j)+j;return _e<0?0:Math.sqrt(_e)},colorTypes=[hex,rgba,hsla],getColorType=e=>colorTypes.find(i=>i.test(e));function asRGBA(e){const i=getColorType(e);if(!i)return!1;let d=i.parse(e);return i===hsla&&(d=hslaToRgba(d)),d}const mixColor=(e,i)=>{const d=asRGBA(e),j=asRGBA(i);if(!d||!j)return mixImmediate(e,i);const _e={...d};return nt=>(_e.red=mixLinearColor(d.red,j.red,nt),_e.green=mixLinearColor(d.green,j.green,nt),_e.blue=mixLinearColor(d.blue,j.blue,nt),_e.alpha=mixNumber$1(d.alpha,j.alpha,nt),rgba.transform(_e))},invisibleValues=new Set(["none","hidden"]);function mixVisibility(e,i){return invisibleValues.has(e)?d=>d<=0?e:i:d=>d>=1?i:e}function mixNumber(e,i){return d=>mixNumber$1(e,i,d)}function getMixer(e){return typeof e=="number"?mixNumber:typeof e=="string"?isCSSVariableToken(e)?mixImmediate:color.test(e)?mixColor:mixComplex:Array.isArray(e)?mixArray:typeof e=="object"?color.test(e)?mixColor:mixObject:mixImmediate}function mixArray(e,i){const d=[...e],j=d.length,_e=e.map((nt,ct)=>getMixer(nt)(nt,i[ct]));return nt=>{for(let ct=0;ct<j;ct++)d[ct]=_e[ct](nt);return d}}function mixObject(e,i){const d={...e,...i},j={};for(const _e in d)e[_e]!==void 0&&i[_e]!==void 0&&(j[_e]=getMixer(e[_e])(e[_e],i[_e]));return _e=>{for(const nt in j)d[nt]=j[nt](_e);return d}}function matchOrder(e,i){const d=[],j={color:0,var:0,number:0};for(let _e=0;_e<i.values.length;_e++){const nt=i.types[_e],ct=e.indexes[nt][j[nt]],c=e.values[ct]??0;d[_e]=c,j[nt]++}return d}const mixComplex=(e,i)=>{const d=complex.createTransformer(i),j=analyseComplexValue(e),_e=analyseComplexValue(i);return j.indexes.var.length===_e.indexes.var.length&&j.indexes.color.length===_e.indexes.color.length&&j.indexes.number.length>=_e.indexes.number.length?invisibleValues.has(e)&&!_e.values.length||invisibleValues.has(i)&&!j.values.length?mixVisibility(e,i):pipe(mixArray(matchOrder(j,_e),_e.values),d):mixImmediate(e,i)};function mix(e,i,d){return typeof e=="number"&&typeof i=="number"&&typeof d=="number"?mixNumber$1(e,i,d):getMixer(e)(e,i)}const frameloopDriver=e=>{const i=({timestamp:d})=>e(d);return{start:(d=!0)=>frame.update(i,d),stop:()=>cancelFrame(i),now:()=>frameData.isProcessing?frameData.timestamp:time.now()}},generateLinearEasing=(e,i,d=10)=>{let j="";const _e=Math.max(Math.round(i/d),2);for(let nt=0;nt<_e;nt++)j+=Math.round(e(nt/(_e-1))*1e4)/1e4+", ";return`linear(${j.substring(0,j.length-2)})`},maxGeneratorDuration=2e4;function calcGeneratorDuration(e){let i=0;const d=50;let j=e.next(i);for(;!j.done&&i<maxGeneratorDuration;)i+=d,j=e.next(i);return i>=maxGeneratorDuration?1/0:i}function createGeneratorEasing(e,i=100,d){const j=d({...e,keyframes:[0,i]}),_e=Math.min(calcGeneratorDuration(j),maxGeneratorDuration);return{type:"keyframes",ease:nt=>j.next(_e*nt).value/i,duration:millisecondsToSeconds(_e)}}const velocitySampleDuration=5;function calcGeneratorVelocity(e,i,d){const j=Math.max(i-velocitySampleDuration,0);return velocityPerSecond(d-e(j),i-j)}const springDefaults={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},safeMin=.001;function findSpring({duration:e=springDefaults.duration,bounce:i=springDefaults.bounce,velocity:d=springDefaults.velocity,mass:j=springDefaults.mass}){let _e,nt,ct=1-i;ct=clamp(springDefaults.minDamping,springDefaults.maxDamping,ct),e=clamp(springDefaults.minDuration,springDefaults.maxDuration,millisecondsToSeconds(e)),ct<1?(_e=gt=>{const St=gt*ct,kt=St*e,At=St-d,Nt=calcAngularFreq(gt,ct),Vt=Math.exp(-kt);return safeMin-At/Nt*Vt},nt=gt=>{const kt=gt*ct*e,At=kt*d+d,Nt=Math.pow(ct,2)*Math.pow(gt,2)*e,Vt=Math.exp(-kt),zt=calcAngularFreq(Math.pow(gt,2),ct);return(-_e(gt)+safeMin>0?-1:1)*((At-Nt)*Vt)/zt}):(_e=gt=>{const St=Math.exp(-gt*e),kt=(gt-d)*e+1;return-safeMin+St*kt},nt=gt=>{const St=Math.exp(-gt*e),kt=(d-gt)*(e*e);return St*kt});const c=5/e,pt=approximateRoot(_e,nt,c);if(e=secondsToMilliseconds(e),isNaN(pt))return{stiffness:springDefaults.stiffness,damping:springDefaults.damping,duration:e};{const gt=Math.pow(pt,2)*j;return{stiffness:gt,damping:ct*2*Math.sqrt(j*gt),duration:e}}}const rootIterations=12;function approximateRoot(e,i,d){let j=d;for(let _e=1;_e<rootIterations;_e++)j=j-e(j)/i(j);return j}function calcAngularFreq(e,i){return e*Math.sqrt(1-i*i)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(e,i){return i.some(d=>e[d]!==void 0)}function getSpringOptions(e){let i={velocity:springDefaults.velocity,stiffness:springDefaults.stiffness,damping:springDefaults.damping,mass:springDefaults.mass,isResolvedFromDuration:!1,...e};if(!isSpringType(e,physicsKeys)&&isSpringType(e,durationKeys))if(e.visualDuration){const d=e.visualDuration,j=2*Math.PI/(d*1.2),_e=j*j,nt=2*clamp(.05,1,1-(e.bounce||0))*Math.sqrt(_e);i={...i,mass:springDefaults.mass,stiffness:_e,damping:nt}}else{const d=findSpring(e);i={...i,...d,mass:springDefaults.mass},i.isResolvedFromDuration=!0}return i}function spring(e=springDefaults.visualDuration,i=springDefaults.bounce){const d=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:i}:e;let{restSpeed:j,restDelta:_e}=d;const nt=d.keyframes[0],ct=d.keyframes[d.keyframes.length-1],c={done:!1,value:nt},{stiffness:pt,damping:gt,mass:St,duration:kt,velocity:At,isResolvedFromDuration:Nt}=getSpringOptions({...d,velocity:-millisecondsToSeconds(d.velocity||0)}),Vt=At||0,zt=gt/(2*Math.sqrt(pt*St)),Jt=ct-nt,Dt=millisecondsToSeconds(Math.sqrt(pt/St)),It=Math.abs(Jt)<5;j||(j=It?springDefaults.restSpeed.granular:springDefaults.restSpeed.default),_e||(_e=It?springDefaults.restDelta.granular:springDefaults.restDelta.default);let Mt;if(zt<1){const tr=calcAngularFreq(Dt,zt);Mt=er=>{const dr=Math.exp(-zt*Dt*er);return ct-dr*((Vt+zt*Dt*Jt)/tr*Math.sin(tr*er)+Jt*Math.cos(tr*er))}}else if(zt===1)Mt=tr=>ct-Math.exp(-Dt*tr)*(Jt+(Vt+Dt*Jt)*tr);else{const tr=Dt*Math.sqrt(zt*zt-1);Mt=er=>{const dr=Math.exp(-zt*Dt*er),mr=Math.min(tr*er,300);return ct-dr*((Vt+zt*Dt*Jt)*Math.sinh(mr)+tr*Jt*Math.cosh(mr))/tr}}const Ht={calculatedDuration:Nt&&kt||null,next:tr=>{const er=Mt(tr);if(Nt)c.done=tr>=kt;else{let dr=tr===0?Vt:0;zt<1&&(dr=tr===0?secondsToMilliseconds(Vt):calcGeneratorVelocity(Mt,tr,er));const mr=Math.abs(dr)<=j,Ur=Math.abs(ct-er)<=_e;c.done=mr&&Ur}return c.value=c.done?ct:er,c},toString:()=>{const tr=Math.min(calcGeneratorDuration(Ht),maxGeneratorDuration),er=generateLinearEasing(dr=>Ht.next(tr*dr).value,tr,30);return tr+"ms "+er},toTransition:()=>{}};return Ht}spring.applyToOptions=e=>{const i=createGeneratorEasing(e,100,spring);return e.ease=i.ease,e.duration=secondsToMilliseconds(i.duration),e.type="keyframes",e};function inertia({keyframes:e,velocity:i=0,power:d=.8,timeConstant:j=325,bounceDamping:_e=10,bounceStiffness:nt=500,modifyTarget:ct,min:c,max:pt,restDelta:gt=.5,restSpeed:St}){const kt=e[0],At={done:!1,value:kt},Nt=mr=>c!==void 0&&mr<c||pt!==void 0&&mr>pt,Vt=mr=>c===void 0?pt:pt===void 0||Math.abs(c-mr)<Math.abs(pt-mr)?c:pt;let zt=d*i;const Jt=kt+zt,Dt=ct===void 0?Jt:ct(Jt);Dt!==Jt&&(zt=Dt-kt);const It=mr=>-zt*Math.exp(-mr/j),Mt=mr=>Dt+It(mr),Ht=mr=>{const Ur=It(mr),Dr=Mt(mr);At.done=Math.abs(Ur)<=gt,At.value=At.done?Dt:Dr};let tr,er;const dr=mr=>{Nt(At.value)&&(tr=mr,er=spring({keyframes:[At.value,Vt(At.value)],velocity:calcGeneratorVelocity(Mt,mr,At.value),damping:_e,stiffness:nt,restDelta:gt,restSpeed:St}))};return dr(0),{calculatedDuration:null,next:mr=>{let Ur=!1;return!er&&tr===void 0&&(Ur=!0,Ht(mr),dr(mr)),tr!==void 0&&mr>=tr?er.next(mr-tr):(!Ur&&Ht(mr),At)}}}function createMixers(e,i,d){const j=[],_e=d||MotionGlobalConfig.mix||mix,nt=e.length-1;for(let ct=0;ct<nt;ct++){let c=_e(e[ct],e[ct+1]);if(i){const pt=Array.isArray(i)?i[ct]||noop$1:i;c=pipe(pt,c)}j.push(c)}return j}function interpolate(e,i,{clamp:d=!0,ease:j,mixer:_e}={}){const nt=e.length;if(invariant(nt===i.length),nt===1)return()=>i[0];if(nt===2&&i[0]===i[1])return()=>i[1];const ct=e[0]===e[1];e[0]>e[nt-1]&&(e=[...e].reverse(),i=[...i].reverse());const c=createMixers(i,j,_e),pt=c.length,gt=St=>{if(ct&&St<e[0])return i[0];let kt=0;if(pt>1)for(;kt<e.length-2&&!(St<e[kt+1]);kt++);const At=progress(e[kt],e[kt+1],St);return c[kt](At)};return d?St=>gt(clamp(e[0],e[nt-1],St)):gt}function fillOffset(e,i){const d=e[e.length-1];for(let j=1;j<=i;j++){const _e=progress(0,i,j);e.push(mixNumber$1(d,1,_e))}}function defaultOffset(e){const i=[0];return fillOffset(i,e.length-1),i}function convertOffsetToTimes(e,i){return e.map(d=>d*i)}function defaultEasing(e,i){return e.map(()=>i||easeInOut).splice(0,e.length-1)}function keyframes({duration:e=300,keyframes:i,times:d,ease:j="easeInOut"}){const _e=isEasingArray(j)?j.map(easingDefinitionToFunction):easingDefinitionToFunction(j),nt={done:!1,value:i[0]},ct=convertOffsetToTimes(d&&d.length===i.length?d:defaultOffset(i),e),c=interpolate(ct,i,{ease:Array.isArray(_e)?_e:defaultEasing(i,_e)});return{calculatedDuration:e,next:pt=>(nt.value=c(pt),nt.done=pt>=e,nt)}}const isNotNull$1=e=>e!==null;function getFinalKeyframe$1(e,{repeat:i,repeatType:d="loop"},j,_e=1){const nt=e.filter(isNotNull$1),c=_e<0||i&&d!=="loop"&&i%2===1?0:nt.length-1;return!c||j===void 0?nt[c]:j}const transitionTypeMap={decay:inertia,inertia,tween:keyframes,keyframes,spring};function replaceTransitionType(e){typeof e.type=="string"&&(e.type=transitionTypeMap[e.type])}class WithPromise{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(i=>{this.resolve=i})}notifyFinished(){this.resolve()}then(i,d){return this.finished.then(i,d)}}const percentToProgress=e=>e/100;class JSAnimation extends WithPromise{constructor(i){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var j,_e;const{motionValue:d}=this.options;d&&d.updatedAt!==time.now()&&this.tick(time.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(_e=(j=this.options).onStop)==null||_e.call(j))},this.options=i,this.initAnimation(),this.play(),i.autoplay===!1&&this.pause()}initAnimation(){const{options:i}=this;replaceTransitionType(i);const{type:d=keyframes,repeat:j=0,repeatDelay:_e=0,repeatType:nt,velocity:ct=0}=i;let{keyframes:c}=i;const pt=d||keyframes;pt!==keyframes&&typeof c[0]!="number"&&(this.mixKeyframes=pipe(percentToProgress,mix(c[0],c[1])),c=[0,100]);const gt=pt({...i,keyframes:c});nt==="mirror"&&(this.mirroredGenerator=pt({...i,keyframes:[...c].reverse(),velocity:-ct})),gt.calculatedDuration===null&&(gt.calculatedDuration=calcGeneratorDuration(gt));const{calculatedDuration:St}=gt;this.calculatedDuration=St,this.resolvedDuration=St+_e,this.totalDuration=this.resolvedDuration*(j+1)-_e,this.generator=gt}updateTime(i){const d=Math.round(i-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=d}tick(i,d=!1){const{generator:j,totalDuration:_e,mixKeyframes:nt,mirroredGenerator:ct,resolvedDuration:c,calculatedDuration:pt}=this;if(this.startTime===null)return j.next(0);const{delay:gt=0,keyframes:St,repeat:kt,repeatType:At,repeatDelay:Nt,type:Vt,onUpdate:zt,finalKeyframe:Jt}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,i):this.speed<0&&(this.startTime=Math.min(i-_e/this.speed,this.startTime)),d?this.currentTime=i:this.updateTime(i);const Dt=this.currentTime-gt*(this.playbackSpeed>=0?1:-1),It=this.playbackSpeed>=0?Dt<0:Dt>_e;this.currentTime=Math.max(Dt,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=_e);let Mt=this.currentTime,Ht=j;if(kt){const mr=Math.min(this.currentTime,_e)/c;let Ur=Math.floor(mr),Dr=mr%1;!Dr&&mr>=1&&(Dr=1),Dr===1&&Ur--,Ur=Math.min(Ur,kt+1),!!(Ur%2)&&(At==="reverse"?(Dr=1-Dr,Nt&&(Dr-=Nt/c)):At==="mirror"&&(Ht=ct)),Mt=clamp(0,1,Dr)*c}const tr=It?{done:!1,value:St[0]}:Ht.next(Mt);nt&&(tr.value=nt(tr.value));let{done:er}=tr;!It&&pt!==null&&(er=this.playbackSpeed>=0?this.currentTime>=_e:this.currentTime<=0);const dr=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&er);return dr&&Vt!==inertia&&(tr.value=getFinalKeyframe$1(St,this.options,Jt,this.speed)),zt&&zt(tr.value),dr&&this.finish(),tr}then(i,d){return this.finished.then(i,d)}get duration(){return millisecondsToSeconds(this.calculatedDuration)}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(this.currentTime)}set time(i){var d;i=secondsToMilliseconds(i),this.currentTime=i,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=i:this.driver&&(this.startTime=this.driver.now()-i/this.playbackSpeed),(d=this.driver)==null||d.start(!1)}get speed(){return this.playbackSpeed}set speed(i){this.updateTime(time.now());const d=this.playbackSpeed!==i;this.playbackSpeed=i,d&&(this.time=millisecondsToSeconds(this.currentTime))}play(){var _e,nt;if(this.isStopped)return;const{driver:i=frameloopDriver,startTime:d}=this.options;this.driver||(this.driver=i(ct=>this.tick(ct))),(nt=(_e=this.options).onPlay)==null||nt.call(_e);const j=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=j):this.holdTime!==null?this.startTime=j-this.holdTime:this.startTime||(this.startTime=d??j),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(time.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var i,d;this.notifyFinished(),this.teardown(),this.state="finished",(d=(i=this.options).onComplete)==null||d.call(i)}cancel(){var i,d;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(d=(i=this.options).onCancel)==null||d.call(i)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(i){return this.startTime=0,this.tick(i,!0)}attachTimeline(i){var d;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(d=this.driver)==null||d.stop(),i.observe(this)}}function fillWildcards(e){for(let i=1;i<e.length;i++)e[i]??(e[i]=e[i-1])}const radToDeg=e=>e*180/Math.PI,rotate=e=>{const i=radToDeg(Math.atan2(e[1],e[0]));return rebaseAngle(i)},matrix2dParsers={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate,rotateZ:rotate,skewX:e=>radToDeg(Math.atan(e[1])),skewY:e=>radToDeg(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},rebaseAngle=e=>(e=e%360,e<0&&(e+=360),e),rotateZ=rotate,scaleX=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),scaleY=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),matrix3dParsers={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX,scaleY,scale:e=>(scaleX(e)+scaleY(e))/2,rotateX:e=>rebaseAngle(radToDeg(Math.atan2(e[6],e[5]))),rotateY:e=>rebaseAngle(radToDeg(Math.atan2(-e[2],e[0]))),rotateZ,rotate:rotateZ,skewX:e=>radToDeg(Math.atan(e[4])),skewY:e=>radToDeg(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function defaultTransformValue(e){return e.includes("scale")?1:0}function parseValueFromTransform(e,i){if(!e||e==="none")return defaultTransformValue(i);const d=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let j,_e;if(d)j=matrix3dParsers,_e=d;else{const c=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);j=matrix2dParsers,_e=c}if(!_e)return defaultTransformValue(i);const nt=j[i],ct=_e[1].split(",").map(convertTransformToNumber);return typeof nt=="function"?nt(ct):ct[nt]}const readTransformValue=(e,i)=>{const{transform:d="none"}=getComputedStyle(e);return parseValueFromTransform(d,i)};function convertTransformToNumber(e){return parseFloat(e.trim())}const transformPropOrder=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],transformProps=new Set(transformPropOrder),isNumOrPxType=e=>e===number||e===px,transformKeys=new Set(["x","y","z"]),nonTranslationalTransformKeys=transformPropOrder.filter(e=>!transformKeys.has(e));function removeNonTranslationalTransform(e){const i=[];return nonTranslationalTransformKeys.forEach(d=>{const j=e.getValue(d);j!==void 0&&(i.push([d,j.get()]),j.set(d.startsWith("scale")?1:0))}),i}const positionalValues={width:({x:e},{paddingLeft:i="0",paddingRight:d="0"})=>e.max-e.min-parseFloat(i)-parseFloat(d),height:({y:e},{paddingTop:i="0",paddingBottom:d="0"})=>e.max-e.min-parseFloat(i)-parseFloat(d),top:(e,{top:i})=>parseFloat(i),left:(e,{left:i})=>parseFloat(i),bottom:({y:e},{top:i})=>parseFloat(i)+(e.max-e.min),right:({x:e},{left:i})=>parseFloat(i)+(e.max-e.min),x:(e,{transform:i})=>parseValueFromTransform(i,"x"),y:(e,{transform:i})=>parseValueFromTransform(i,"y")};positionalValues.translateX=positionalValues.x;positionalValues.translateY=positionalValues.y;const toResolve=new Set;let isScheduled=!1,anyNeedsMeasurement=!1,isForced=!1;function measureAllKeyframes(){if(anyNeedsMeasurement){const e=Array.from(toResolve).filter(j=>j.needsMeasurement),i=new Set(e.map(j=>j.element)),d=new Map;i.forEach(j=>{const _e=removeNonTranslationalTransform(j);_e.length&&(d.set(j,_e),j.render())}),e.forEach(j=>j.measureInitialState()),i.forEach(j=>{j.render();const _e=d.get(j);_e&&_e.forEach(([nt,ct])=>{var c;(c=j.getValue(nt))==null||c.set(ct)})}),e.forEach(j=>j.measureEndState()),e.forEach(j=>{j.suspendedScrollY!==void 0&&window.scrollTo(0,j.suspendedScrollY)})}anyNeedsMeasurement=!1,isScheduled=!1,toResolve.forEach(e=>e.complete(isForced)),toResolve.clear()}function readAllKeyframes(){toResolve.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(anyNeedsMeasurement=!0)})}function flushKeyframeResolvers(){isForced=!0,readAllKeyframes(),measureAllKeyframes(),isForced=!1}class KeyframeResolver{constructor(i,d,j,_e,nt,ct=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...i],this.onComplete=d,this.name=j,this.motionValue=_e,this.element=nt,this.isAsync=ct}scheduleResolve(){this.state="scheduled",this.isAsync?(toResolve.add(this),isScheduled||(isScheduled=!0,frame.read(readAllKeyframes),frame.resolveKeyframes(measureAllKeyframes))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:i,name:d,element:j,motionValue:_e}=this;if(i[0]===null){const nt=_e==null?void 0:_e.get(),ct=i[i.length-1];if(nt!==void 0)i[0]=nt;else if(j&&d){const c=j.readValue(d,ct);c!=null&&(i[0]=c)}i[0]===void 0&&(i[0]=ct),_e&&nt===void 0&&_e.set(i[0])}fillWildcards(i)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(i=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,i),toResolve.delete(this)}cancel(){this.state==="scheduled"&&(toResolve.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const isCSSVar=e=>e.startsWith("--");function setStyle(e,i,d){isCSSVar(i)?e.style.setProperty(i,d):e.style[i]=d}const supportsScrollTimeline=memo(()=>window.ScrollTimeline!==void 0),supportsFlags={};function memoSupports(e,i){const d=memo(e);return()=>supportsFlags[i]??d()}const supportsLinearEasing=memoSupports(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),cubicBezierAsString=([e,i,d,j])=>`cubic-bezier(${e}, ${i}, ${d}, ${j})`,supportedWaapiEasing={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:cubicBezierAsString([0,.65,.55,1]),circOut:cubicBezierAsString([.55,0,1,.45]),backIn:cubicBezierAsString([.31,.01,.66,-.59]),backOut:cubicBezierAsString([.33,1.53,.69,.99])};function mapEasingToNativeEasing(e,i){if(e)return typeof e=="function"?supportsLinearEasing()?generateLinearEasing(e,i):"ease-out":isBezierDefinition(e)?cubicBezierAsString(e):Array.isArray(e)?e.map(d=>mapEasingToNativeEasing(d,i)||supportedWaapiEasing.easeOut):supportedWaapiEasing[e]}function startWaapiAnimation(e,i,d,{delay:j=0,duration:_e=300,repeat:nt=0,repeatType:ct="loop",ease:c="easeOut",times:pt}={},gt=void 0){const St={[i]:d};pt&&(St.offset=pt);const kt=mapEasingToNativeEasing(c,_e);Array.isArray(kt)&&(St.easing=kt);const At={delay:j,duration:_e,easing:Array.isArray(kt)?"linear":kt,fill:"both",iterations:nt+1,direction:ct==="reverse"?"alternate":"normal"};return gt&&(At.pseudoElement=gt),e.animate(St,At)}function isGenerator(e){return typeof e=="function"&&"applyToOptions"in e}function applyGeneratorOptions({type:e,...i}){return isGenerator(e)&&supportsLinearEasing()?e.applyToOptions(i):(i.duration??(i.duration=300),i.ease??(i.ease="easeOut"),i)}class NativeAnimation extends WithPromise{constructor(i){if(super(),this.finishedTime=null,this.isStopped=!1,!i)return;const{element:d,name:j,keyframes:_e,pseudoElement:nt,allowFlatten:ct=!1,finalKeyframe:c,onComplete:pt}=i;this.isPseudoElement=!!nt,this.allowFlatten=ct,this.options=i,invariant(typeof i.type!="string");const gt=applyGeneratorOptions(i);this.animation=startWaapiAnimation(d,j,_e,gt,nt),gt.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!nt){const St=getFinalKeyframe$1(_e,this.options,c,this.speed);this.updateMotionValue?this.updateMotionValue(St):setStyle(d,j,St),this.animation.cancel()}pt==null||pt(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var i,d;(d=(i=this.animation).finish)==null||d.call(i)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:i}=this;i==="idle"||i==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var i,d;this.isPseudoElement||(d=(i=this.animation).commitStyles)==null||d.call(i)}get duration(){var d,j;const i=((j=(d=this.animation.effect)==null?void 0:d.getComputedTiming)==null?void 0:j.call(d).duration)||0;return millisecondsToSeconds(Number(i))}get iterationDuration(){const{delay:i=0}=this.options||{};return this.duration+millisecondsToSeconds(i)}get time(){return millisecondsToSeconds(Number(this.animation.currentTime)||0)}set time(i){this.finishedTime=null,this.animation.currentTime=secondsToMilliseconds(i)}get speed(){return this.animation.playbackRate}set speed(i){i<0&&(this.finishedTime=null),this.animation.playbackRate=i}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(i){this.animation.startTime=i}attachTimeline({timeline:i,observe:d}){var j;return this.allowFlatten&&((j=this.animation.effect)==null||j.updateTiming({easing:"linear"})),this.animation.onfinish=null,i&&supportsScrollTimeline()?(this.animation.timeline=i,noop$1):d(this)}}const unsupportedEasingFunctions={anticipate,backInOut,circInOut};function isUnsupportedEase(e){return e in unsupportedEasingFunctions}function replaceStringEasing(e){typeof e.ease=="string"&&isUnsupportedEase(e.ease)&&(e.ease=unsupportedEasingFunctions[e.ease])}const sampleDelta=10;class NativeAnimationExtended extends NativeAnimation{constructor(i){replaceStringEasing(i),replaceTransitionType(i),super(i),i.startTime&&(this.startTime=i.startTime),this.options=i}updateMotionValue(i){const{motionValue:d,onUpdate:j,onComplete:_e,element:nt,...ct}=this.options;if(!d)return;if(i!==void 0){d.set(i);return}const c=new JSAnimation({...ct,autoplay:!1}),pt=secondsToMilliseconds(this.finishedTime??this.time);d.setWithVelocity(c.sample(pt-sampleDelta).value,c.sample(pt).value,sampleDelta),c.stop()}}const isAnimatable=(e,i)=>i==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(complex.test(e)||e==="0")&&!e.startsWith("url("));function hasKeyframesChanged(e){const i=e[0];if(e.length===1)return!0;for(let d=0;d<e.length;d++)if(e[d]!==i)return!0}function canAnimate(e,i,d,j){const _e=e[0];if(_e===null)return!1;if(i==="display"||i==="visibility")return!0;const nt=e[e.length-1],ct=isAnimatable(_e,i),c=isAnimatable(nt,i);return!ct||!c?!1:hasKeyframesChanged(e)||(d==="spring"||isGenerator(d))&&j}function makeAnimationInstant(e){e.duration=0,e.type="keyframes"}const acceleratedValues=new Set(["opacity","clipPath","filter","transform"]),supportsWaapi=memo(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function supportsBrowserAnimation(e){var St;const{motionValue:i,name:d,repeatDelay:j,repeatType:_e,damping:nt,type:ct}=e;if(!(((St=i==null?void 0:i.owner)==null?void 0:St.current)instanceof HTMLElement))return!1;const{onUpdate:pt,transformTemplate:gt}=i.owner.getProps();return supportsWaapi()&&d&&acceleratedValues.has(d)&&(d!=="transform"||!gt)&&!pt&&!j&&_e!=="mirror"&&nt!==0&&ct!=="inertia"}const MAX_RESOLVE_DELAY=40;class AsyncMotionValueAnimation extends WithPromise{constructor({autoplay:i=!0,delay:d=0,type:j="keyframes",repeat:_e=0,repeatDelay:nt=0,repeatType:ct="loop",keyframes:c,name:pt,motionValue:gt,element:St,...kt}){var Vt;super(),this.stop=()=>{var zt,Jt;this._animation&&(this._animation.stop(),(zt=this.stopTimeline)==null||zt.call(this)),(Jt=this.keyframeResolver)==null||Jt.cancel()},this.createdAt=time.now();const At={autoplay:i,delay:d,type:j,repeat:_e,repeatDelay:nt,repeatType:ct,name:pt,motionValue:gt,element:St,...kt},Nt=(St==null?void 0:St.KeyframeResolver)||KeyframeResolver;this.keyframeResolver=new Nt(c,(zt,Jt,Dt)=>this.onKeyframesResolved(zt,Jt,At,!Dt),pt,gt,St),(Vt=this.keyframeResolver)==null||Vt.scheduleResolve()}onKeyframesResolved(i,d,j,_e){this.keyframeResolver=void 0;const{name:nt,type:ct,velocity:c,delay:pt,isHandoff:gt,onUpdate:St}=j;this.resolvedAt=time.now(),canAnimate(i,nt,ct,c)||((MotionGlobalConfig.instantAnimations||!pt)&&(St==null||St(getFinalKeyframe$1(i,j,d))),i[0]=i[i.length-1],makeAnimationInstant(j),j.repeat=0);const At={startTime:_e?this.resolvedAt?this.resolvedAt-this.createdAt>MAX_RESOLVE_DELAY?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:d,...j,keyframes:i},Nt=!gt&&supportsBrowserAnimation(At)?new NativeAnimationExtended({...At,element:At.motionValue.owner.current}):new JSAnimation(At);Nt.finished.then(()=>this.notifyFinished()).catch(noop$1),this.pendingTimeline&&(this.stopTimeline=Nt.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Nt}get finished(){return this._animation?this.animation.finished:this._finished}then(i,d){return this.finished.finally(i).then(()=>{})}get animation(){var i;return this._animation||((i=this.keyframeResolver)==null||i.resume(),flushKeyframeResolvers()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(i){this.animation.time=i}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(i){this.animation.speed=i}get startTime(){return this.animation.startTime}attachTimeline(i){return this._animation?this.stopTimeline=this.animation.attachTimeline(i):this.pendingTimeline=i,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var i;this._animation&&this.animation.cancel(),(i=this.keyframeResolver)==null||i.cancel()}}const splitCSSVariableRegex=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function parseCSSVariable(e){const i=splitCSSVariableRegex.exec(e);if(!i)return[,];const[,d,j,_e]=i;return[`--${d??j}`,_e]}function getVariableValue(e,i,d=1){const[j,_e]=parseCSSVariable(e);if(!j)return;const nt=window.getComputedStyle(i).getPropertyValue(j);if(nt){const ct=nt.trim();return isNumericalString(ct)?parseFloat(ct):ct}return isCSSVariableToken(_e)?getVariableValue(_e,i,d+1):_e}function getValueTransition(e,i){return(e==null?void 0:e[i])??(e==null?void 0:e.default)??e}const positionalKeys=new Set(["width","height","top","left","right","bottom",...transformPropOrder]),auto={test:e=>e==="auto",parse:e=>e},testValueType=e=>i=>i.test(e),dimensionValueTypes=[number,px,percent,degrees,vw,vh,auto],findDimensionValueType=e=>dimensionValueTypes.find(testValueType(e));function isNone(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||isZeroValueString(e):!0}const maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(e){const[i,d]=e.slice(0,-1).split("(");if(i==="drop-shadow")return e;const[j]=d.match(floatRegex)||[];if(!j)return e;const _e=d.replace(j,"");let nt=maxDefaults.has(i)?1:0;return j!==d&&(nt*=100),i+"("+nt+_e+")"}const functionRegex=/\b([a-z-]*)\(.*?\)/gu,filter={...complex,getAnimatableNone:e=>{const i=e.match(functionRegex);return i?i.map(applyDefaultFilter).join(" "):e}},int={...number,transform:Math.round},transformValueTypes={rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px},numberValueTypes={borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,backgroundPositionX:px,backgroundPositionY:px,...transformValueTypes,zIndex:int,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},defaultValueTypes={...numberValueTypes,color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,filter,WebkitFilter:filter},getDefaultValueType=e=>defaultValueTypes[e];function getAnimatableNone(e,i){let d=getDefaultValueType(e);return d!==filter&&(d=complex),d.getAnimatableNone?d.getAnimatableNone(i):void 0}const invalidTemplates=new Set(["auto","none","0"]);function makeNoneKeyframesAnimatable(e,i,d){let j=0,_e;for(;j<e.length&&!_e;){const nt=e[j];typeof nt=="string"&&!invalidTemplates.has(nt)&&analyseComplexValue(nt).values.length&&(_e=e[j]),j++}if(_e&&d)for(const nt of i)e[nt]=getAnimatableNone(d,_e)}class DOMKeyframesResolver extends KeyframeResolver{constructor(i,d,j,_e,nt){super(i,d,j,_e,nt,!0)}readKeyframes(){const{unresolvedKeyframes:i,element:d,name:j}=this;if(!d||!d.current)return;super.readKeyframes();for(let pt=0;pt<i.length;pt++){let gt=i[pt];if(typeof gt=="string"&&(gt=gt.trim(),isCSSVariableToken(gt))){const St=getVariableValue(gt,d.current);St!==void 0&&(i[pt]=St),pt===i.length-1&&(this.finalKeyframe=gt)}}if(this.resolveNoneKeyframes(),!positionalKeys.has(j)||i.length!==2)return;const[_e,nt]=i,ct=findDimensionValueType(_e),c=findDimensionValueType(nt);if(ct!==c)if(isNumOrPxType(ct)&&isNumOrPxType(c))for(let pt=0;pt<i.length;pt++){const gt=i[pt];typeof gt=="string"&&(i[pt]=parseFloat(gt))}else positionalValues[j]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:i,name:d}=this,j=[];for(let _e=0;_e<i.length;_e++)(i[_e]===null||isNone(i[_e]))&&j.push(_e);j.length&&makeNoneKeyframesAnimatable(i,j,d)}measureInitialState(){const{element:i,unresolvedKeyframes:d,name:j}=this;if(!i||!i.current)return;j==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=positionalValues[j](i.measureViewportBox(),window.getComputedStyle(i.current)),d[0]=this.measuredOrigin;const _e=d[d.length-1];_e!==void 0&&i.getValue(j,_e).jump(_e,!1)}measureEndState(){var c;const{element:i,name:d,unresolvedKeyframes:j}=this;if(!i||!i.current)return;const _e=i.getValue(d);_e&&_e.jump(this.measuredOrigin,!1);const nt=j.length-1,ct=j[nt];j[nt]=positionalValues[d](i.measureViewportBox(),window.getComputedStyle(i.current)),ct!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=ct),(c=this.removedTransforms)!=null&&c.length&&this.removedTransforms.forEach(([pt,gt])=>{i.getValue(pt).set(gt)}),this.resolveNoneKeyframes()}}function resolveElements(e,i,d){if(e instanceof EventTarget)return[e];if(typeof e=="string"){let j=document;const _e=(d==null?void 0:d[e])??j.querySelectorAll(e);return _e?Array.from(_e):[]}return Array.from(e)}const getValueAsType=(e,i)=>i&&typeof e=="number"?i.transform(e):e;function isHTMLElement(e){return isObject$1(e)&&"offsetHeight"in e}const MAX_VELOCITY_DELTA=30,isFloat=e=>!isNaN(parseFloat(e));class MotionValue{constructor(i,d={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=j=>{var nt;const _e=time.now();if(this.updatedAt!==_e&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(j),this.current!==this.prev&&((nt=this.events.change)==null||nt.notify(this.current),this.dependents))for(const ct of this.dependents)ct.dirty()},this.hasAnimated=!1,this.setCurrent(i),this.owner=d.owner}setCurrent(i){this.current=i,this.updatedAt=time.now(),this.canTrackVelocity===null&&i!==void 0&&(this.canTrackVelocity=isFloat(this.current))}setPrevFrameValue(i=this.current){this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt}onChange(i){return this.on("change",i)}on(i,d){this.events[i]||(this.events[i]=new SubscriptionManager);const j=this.events[i].add(d);return i==="change"?()=>{j(),frame.read(()=>{this.events.change.getSize()||this.stop()})}:j}clearListeners(){for(const i in this.events)this.events[i].clear()}attach(i,d){this.passiveEffect=i,this.stopPassiveEffect=d}set(i){this.passiveEffect?this.passiveEffect(i,this.updateAndNotify):this.updateAndNotify(i)}setWithVelocity(i,d,j){this.set(d),this.prev=void 0,this.prevFrameValue=i,this.prevUpdatedAt=this.updatedAt-j}jump(i,d=!0){this.updateAndNotify(i),this.prev=i,this.prevUpdatedAt=this.prevFrameValue=void 0,d&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var i;(i=this.events.change)==null||i.notify(this.current)}addDependent(i){this.dependents||(this.dependents=new Set),this.dependents.add(i)}removeDependent(i){this.dependents&&this.dependents.delete(i)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const i=time.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||i-this.updatedAt>MAX_VELOCITY_DELTA)return 0;const d=Math.min(this.updatedAt-this.prevUpdatedAt,MAX_VELOCITY_DELTA);return velocityPerSecond(parseFloat(this.current)-parseFloat(this.prevFrameValue),d)}start(i){return this.stop(),new Promise(d=>{this.hasAnimated=!0,this.animation=i(d),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var i,d;(i=this.dependents)==null||i.clear(),(d=this.events.destroy)==null||d.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function motionValue(e,i){return new MotionValue(e,i)}const{schedule:microtask}=createRenderBatcher(queueMicrotask,!1),isDragging={x:!1,y:!1};function isDragActive(){return isDragging.x||isDragging.y}function setDragLock(e){return e==="x"||e==="y"?isDragging[e]?null:(isDragging[e]=!0,()=>{isDragging[e]=!1}):isDragging.x||isDragging.y?null:(isDragging.x=isDragging.y=!0,()=>{isDragging.x=isDragging.y=!1})}function setupGesture(e,i){const d=resolveElements(e),j=new AbortController,_e={passive:!0,...i,signal:j.signal};return[d,_e,()=>j.abort()]}function isValidHover(e){return!(e.pointerType==="touch"||isDragActive())}function hover(e,i,d={}){const[j,_e,nt]=setupGesture(e,d),ct=c=>{if(!isValidHover(c))return;const{target:pt}=c,gt=i(pt,c);if(typeof gt!="function"||!pt)return;const St=kt=>{isValidHover(kt)&&(gt(kt),pt.removeEventListener("pointerleave",St))};pt.addEventListener("pointerleave",St,_e)};return j.forEach(c=>{c.addEventListener("pointerenter",ct,_e)}),nt}const isNodeOrChild=(e,i)=>i?e===i?!0:isNodeOrChild(e,i.parentElement):!1,isPrimaryPointer=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,focusableElements=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function isElementKeyboardAccessible(e){return focusableElements.has(e.tagName)||e.tabIndex!==-1}const isPressing=new WeakSet;function filterEvents(e){return i=>{i.key==="Enter"&&e(i)}}function firePointerEvent(e,i){e.dispatchEvent(new PointerEvent("pointer"+i,{isPrimary:!0,bubbles:!0}))}const enableKeyboardPress=(e,i)=>{const d=e.currentTarget;if(!d)return;const j=filterEvents(()=>{if(isPressing.has(d))return;firePointerEvent(d,"down");const _e=filterEvents(()=>{firePointerEvent(d,"up")}),nt=()=>firePointerEvent(d,"cancel");d.addEventListener("keyup",_e,i),d.addEventListener("blur",nt,i)});d.addEventListener("keydown",j,i),d.addEventListener("blur",()=>d.removeEventListener("keydown",j),i)};function isValidPressEvent(e){return isPrimaryPointer(e)&&!isDragActive()}function press(e,i,d={}){const[j,_e,nt]=setupGesture(e,d),ct=c=>{const pt=c.currentTarget;if(!isValidPressEvent(c))return;isPressing.add(pt);const gt=i(pt,c),St=(Nt,Vt)=>{window.removeEventListener("pointerup",kt),window.removeEventListener("pointercancel",At),isPressing.has(pt)&&isPressing.delete(pt),isValidPressEvent(Nt)&&typeof gt=="function"&&gt(Nt,{success:Vt})},kt=Nt=>{St(Nt,pt===window||pt===document||d.useGlobalTarget||isNodeOrChild(pt,Nt.target))},At=Nt=>{St(Nt,!1)};window.addEventListener("pointerup",kt,_e),window.addEventListener("pointercancel",At,_e)};return j.forEach(c=>{(d.useGlobalTarget?window:c).addEventListener("pointerdown",ct,_e),isHTMLElement(c)&&(c.addEventListener("focus",gt=>enableKeyboardPress(gt,_e)),!isElementKeyboardAccessible(c)&&!c.hasAttribute("tabindex")&&(c.tabIndex=0))}),nt}function isSVGElement(e){return isObject$1(e)&&"ownerSVGElement"in e}function isSVGSVGElement(e){return isSVGElement(e)&&e.tagName==="svg"}const isMotionValue=e=>!!(e&&e.getVelocity),valueTypes=[...dimensionValueTypes,color,complex],findValueType=e=>valueTypes.find(testValueType(e)),MotionConfigContext=reactExports.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});function usePresence(e=!0){const i=reactExports.useContext(PresenceContext);if(i===null)return[!0,null];const{isPresent:d,onExitComplete:j,register:_e}=i,nt=reactExports.useId();reactExports.useEffect(()=>{if(e)return _e(nt)},[e]);const ct=reactExports.useCallback(()=>e&&j&&j(nt),[nt,j,e]);return!d&&j?[!1,ct]:[!0]}const LazyContext=reactExports.createContext({strict:!1}),featureProps={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},featureDefinitions={};for(const e in featureProps)featureDefinitions[e]={isEnabled:i=>featureProps[e].some(d=>!!i[d])};function loadFeatures(e){for(const i in e)featureDefinitions[i]={...featureDefinitions[i],...e[i]}}const validMotionProps=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function isValidMotionProp(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||validMotionProps.has(e)}let shouldForward=e=>!isValidMotionProp(e);function loadExternalIsValidProp(e){typeof e=="function"&&(shouldForward=i=>i.startsWith("on")?!isValidMotionProp(i):e(i))}try{loadExternalIsValidProp(require("@emotion/is-prop-valid").default)}catch{}function filterProps(e,i,d){const j={};for(const _e in e)_e==="values"&&typeof e.values=="object"||(shouldForward(_e)||d===!0&&isValidMotionProp(_e)||!i&&!isValidMotionProp(_e)||e.draggable&&_e.startsWith("onDrag"))&&(j[_e]=e[_e]);return j}const MotionContext=reactExports.createContext({});function isAnimationControls(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function isVariantLabel(e){return typeof e=="string"||Array.isArray(e)}const variantPriorityOrder=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],variantProps=["initial",...variantPriorityOrder];function isControllingVariants(e){return isAnimationControls(e.animate)||variantProps.some(i=>isVariantLabel(e[i]))}function isVariantNode(e){return!!(isControllingVariants(e)||e.variants)}function getCurrentTreeVariants(e,i){if(isControllingVariants(e)){const{initial:d,animate:j}=e;return{initial:d===!1||isVariantLabel(d)?d:void 0,animate:isVariantLabel(j)?j:void 0}}return e.inherit!==!1?i:{}}function useCreateMotionContext(e){const{initial:i,animate:d}=getCurrentTreeVariants(e,reactExports.useContext(MotionContext));return reactExports.useMemo(()=>({initial:i,animate:d}),[variantLabelsAsDependency(i),variantLabelsAsDependency(d)])}function variantLabelsAsDependency(e){return Array.isArray(e)?e.join(" "):e}function pixelsToPercent(e,i){return i.max===i.min?0:e/(i.max-i.min)*100}const correctBorderRadius={correct:(e,i)=>{if(!i.target)return e;if(typeof e=="string")if(px.test(e))e=parseFloat(e);else return e;const d=pixelsToPercent(e,i.target.x),j=pixelsToPercent(e,i.target.y);return`${d}% ${j}%`}},correctBoxShadow={correct:(e,{treeScale:i,projectionDelta:d})=>{const j=e,_e=complex.parse(e);if(_e.length>5)return j;const nt=complex.createTransformer(e),ct=typeof _e[0]!="number"?1:0,c=d.x.scale*i.x,pt=d.y.scale*i.y;_e[0+ct]/=c,_e[1+ct]/=pt;const gt=mixNumber$1(c,pt,.5);return typeof _e[2+ct]=="number"&&(_e[2+ct]/=gt),typeof _e[3+ct]=="number"&&(_e[3+ct]/=gt),nt(_e)}},scaleCorrectors={borderRadius:{...correctBorderRadius,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:correctBorderRadius,borderTopRightRadius:correctBorderRadius,borderBottomLeftRadius:correctBorderRadius,borderBottomRightRadius:correctBorderRadius,boxShadow:correctBoxShadow};function isForcedMotionValue(e,{layout:i,layoutId:d}){return transformProps.has(e)||e.startsWith("origin")||(i||d!==void 0)&&(!!scaleCorrectors[e]||e==="opacity")}const translateAlias={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},numTransforms=transformPropOrder.length;function buildTransform(e,i,d){let j="",_e=!0;for(let nt=0;nt<numTransforms;nt++){const ct=transformPropOrder[nt],c=e[ct];if(c===void 0)continue;let pt=!0;if(typeof c=="number"?pt=c===(ct.startsWith("scale")?1:0):pt=parseFloat(c)===0,!pt||d){const gt=getValueAsType(c,numberValueTypes[ct]);if(!pt){_e=!1;const St=translateAlias[ct]||ct;j+=`${St}(${gt}) `}d&&(i[ct]=gt)}}return j=j.trim(),d?j=d(i,_e?"":j):_e&&(j="none"),j}function buildHTMLStyles(e,i,d){const{style:j,vars:_e,transformOrigin:nt}=e;let ct=!1,c=!1;for(const pt in i){const gt=i[pt];if(transformProps.has(pt)){ct=!0;continue}else if(isCSSVariableName(pt)){_e[pt]=gt;continue}else{const St=getValueAsType(gt,numberValueTypes[pt]);pt.startsWith("origin")?(c=!0,nt[pt]=St):j[pt]=St}}if(i.transform||(ct||d?j.transform=buildTransform(i,e.transform,d):j.transform&&(j.transform="none")),c){const{originX:pt="50%",originY:gt="50%",originZ:St=0}=nt;j.transformOrigin=`${pt} ${gt} ${St}`}}const createHtmlRenderState=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function copyRawValuesOnly(e,i,d){for(const j in i)!isMotionValue(i[j])&&!isForcedMotionValue(j,d)&&(e[j]=i[j])}function useInitialMotionValues({transformTemplate:e},i){return reactExports.useMemo(()=>{const d=createHtmlRenderState();return buildHTMLStyles(d,i,e),Object.assign({},d.vars,d.style)},[i])}function useStyle(e,i){const d=e.style||{},j={};return copyRawValuesOnly(j,d,e),Object.assign(j,useInitialMotionValues(e,i)),j}function useHTMLProps(e,i){const d={},j=useStyle(e,i);return e.drag&&e.dragListener!==!1&&(d.draggable=!1,j.userSelect=j.WebkitUserSelect=j.WebkitTouchCallout="none",j.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(d.tabIndex=0),d.style=j,d}const dashKeys={offset:"stroke-dashoffset",array:"stroke-dasharray"},camelKeys={offset:"strokeDashoffset",array:"strokeDasharray"};function buildSVGPath(e,i,d=1,j=0,_e=!0){e.pathLength=1;const nt=_e?dashKeys:camelKeys;e[nt.offset]=px.transform(-j);const ct=px.transform(i),c=px.transform(d);e[nt.array]=`${ct} ${c}`}function buildSVGAttrs(e,{attrX:i,attrY:d,attrScale:j,pathLength:_e,pathSpacing:nt=1,pathOffset:ct=0,...c},pt,gt,St){if(buildHTMLStyles(e,c,gt),pt){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:kt,style:At}=e;kt.transform&&(At.transform=kt.transform,delete kt.transform),(At.transform||kt.transformOrigin)&&(At.transformOrigin=kt.transformOrigin??"50% 50%",delete kt.transformOrigin),At.transform&&(At.transformBox=(St==null?void 0:St.transformBox)??"fill-box",delete kt.transformBox),i!==void 0&&(kt.x=i),d!==void 0&&(kt.y=d),j!==void 0&&(kt.scale=j),_e!==void 0&&buildSVGPath(kt,_e,nt,ct,!1)}const createSvgRenderState=()=>({...createHtmlRenderState(),attrs:{}}),isSVGTag=e=>typeof e=="string"&&e.toLowerCase()==="svg";function useSVGProps(e,i,d,j){const _e=reactExports.useMemo(()=>{const nt=createSvgRenderState();return buildSVGAttrs(nt,i,isSVGTag(j),e.transformTemplate,e.style),{...nt.attrs,style:{...nt.style}}},[i]);if(e.style){const nt={};copyRawValuesOnly(nt,e.style,e),_e.style={...nt,..._e.style}}return _e}const lowercaseSVGElements=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function isSVGComponent(e){return typeof e!="string"||e.includes("-")?!1:!!(lowercaseSVGElements.indexOf(e)>-1||/[A-Z]/u.test(e))}function useRender(e,i,d,{latestValues:j},_e,nt=!1){const c=(isSVGComponent(e)?useSVGProps:useHTMLProps)(i,j,_e,e),pt=filterProps(i,typeof e=="string",nt),gt=e!==reactExports.Fragment?{...pt,...c,ref:d}:{},{children:St}=i,kt=reactExports.useMemo(()=>isMotionValue(St)?St.get():St,[St]);return reactExports.createElement(e,{...gt,children:kt})}function getValueState(e){const i=[{},{}];return e==null||e.values.forEach((d,j)=>{i[0][j]=d.get(),i[1][j]=d.getVelocity()}),i}function resolveVariantFromProps(e,i,d,j){if(typeof i=="function"){const[_e,nt]=getValueState(j);i=i(d!==void 0?d:e.custom,_e,nt)}if(typeof i=="string"&&(i=e.variants&&e.variants[i]),typeof i=="function"){const[_e,nt]=getValueState(j);i=i(d!==void 0?d:e.custom,_e,nt)}return i}function resolveMotionValue(e){return isMotionValue(e)?e.get():e}function makeState({scrapeMotionValuesFromProps:e,createRenderState:i},d,j,_e){return{latestValues:makeLatestValues(d,j,_e,e),renderState:i()}}function makeLatestValues(e,i,d,j){const _e={},nt=j(e,{});for(const At in nt)_e[At]=resolveMotionValue(nt[At]);let{initial:ct,animate:c}=e;const pt=isControllingVariants(e),gt=isVariantNode(e);i&&gt&&!pt&&e.inherit!==!1&&(ct===void 0&&(ct=i.initial),c===void 0&&(c=i.animate));let St=d?d.initial===!1:!1;St=St||ct===!1;const kt=St?c:ct;if(kt&&typeof kt!="boolean"&&!isAnimationControls(kt)){const At=Array.isArray(kt)?kt:[kt];for(let Nt=0;Nt<At.length;Nt++){const Vt=resolveVariantFromProps(e,At[Nt]);if(Vt){const{transitionEnd:zt,transition:Jt,...Dt}=Vt;for(const It in Dt){let Mt=Dt[It];if(Array.isArray(Mt)){const Ht=St?Mt.length-1:0;Mt=Mt[Ht]}Mt!==null&&(_e[It]=Mt)}for(const It in zt)_e[It]=zt[It]}}}return _e}const makeUseVisualState=e=>(i,d)=>{const j=reactExports.useContext(MotionContext),_e=reactExports.useContext(PresenceContext),nt=()=>makeState(e,i,j,_e);return d?nt():useConstant(nt)};function scrapeMotionValuesFromProps$1(e,i,d){var nt;const{style:j}=e,_e={};for(const ct in j)(isMotionValue(j[ct])||i.style&&isMotionValue(i.style[ct])||isForcedMotionValue(ct,e)||((nt=d==null?void 0:d.getValue(ct))==null?void 0:nt.liveStyle)!==void 0)&&(_e[ct]=j[ct]);return _e}const useHTMLVisualState=makeUseVisualState({scrapeMotionValuesFromProps:scrapeMotionValuesFromProps$1,createRenderState:createHtmlRenderState});function scrapeMotionValuesFromProps(e,i,d){const j=scrapeMotionValuesFromProps$1(e,i,d);for(const _e in e)if(isMotionValue(e[_e])||isMotionValue(i[_e])){const nt=transformPropOrder.indexOf(_e)!==-1?"attr"+_e.charAt(0).toUpperCase()+_e.substring(1):_e;j[nt]=e[_e]}return j}const useSVGVisualState=makeUseVisualState({scrapeMotionValuesFromProps,createRenderState:createSvgRenderState}),motionComponentSymbol=Symbol.for("motionComponentSymbol");function isRefObject(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function useMotionRef(e,i,d){return reactExports.useCallback(j=>{j&&e.onMount&&e.onMount(j),i&&(j?i.mount(j):i.unmount()),d&&(typeof d=="function"?d(j):isRefObject(d)&&(d.current=j))},[i])}const camelToDash=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),optimizedAppearDataId="framerAppearId",optimizedAppearDataAttribute="data-"+camelToDash(optimizedAppearDataId),SwitchLayoutGroupContext=reactExports.createContext({});function useVisualElement(e,i,d,j,_e){var zt,Jt;const{visualElement:nt}=reactExports.useContext(MotionContext),ct=reactExports.useContext(LazyContext),c=reactExports.useContext(PresenceContext),pt=reactExports.useContext(MotionConfigContext).reducedMotion,gt=reactExports.useRef(null);j=j||ct.renderer,!gt.current&&j&&(gt.current=j(e,{visualState:i,parent:nt,props:d,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:pt}));const St=gt.current,kt=reactExports.useContext(SwitchLayoutGroupContext);St&&!St.projection&&_e&&(St.type==="html"||St.type==="svg")&&createProjectionNode$1(gt.current,d,_e,kt);const At=reactExports.useRef(!1);reactExports.useInsertionEffect(()=>{St&&At.current&&St.update(d,c)});const Nt=d[optimizedAppearDataAttribute],Vt=reactExports.useRef(!!Nt&&!((zt=window.MotionHandoffIsComplete)!=null&&zt.call(window,Nt))&&((Jt=window.MotionHasOptimisedAnimation)==null?void 0:Jt.call(window,Nt)));return useIsomorphicLayoutEffect(()=>{St&&(At.current=!0,window.MotionIsMounted=!0,St.updateFeatures(),St.scheduleRenderMicrotask(),Vt.current&&St.animationState&&St.animationState.animateChanges())}),reactExports.useEffect(()=>{St&&(!Vt.current&&St.animationState&&St.animationState.animateChanges(),Vt.current&&(queueMicrotask(()=>{var Dt;(Dt=window.MotionHandoffMarkAsComplete)==null||Dt.call(window,Nt)}),Vt.current=!1),St.enteringChildren=void 0)}),St}function createProjectionNode$1(e,i,d,j){const{layoutId:_e,layout:nt,drag:ct,dragConstraints:c,layoutScroll:pt,layoutRoot:gt,layoutCrossfade:St}=i;e.projection=new d(e.latestValues,i["data-framer-portal-id"]?void 0:getClosestProjectingNode(e.parent)),e.projection.setOptions({layoutId:_e,layout:nt,alwaysMeasureLayout:!!ct||c&&isRefObject(c),visualElement:e,animationType:typeof nt=="string"?nt:"both",initialPromotionConfig:j,crossfade:St,layoutScroll:pt,layoutRoot:gt})}function getClosestProjectingNode(e){if(e)return e.options.allowProjection!==!1?e.projection:getClosestProjectingNode(e.parent)}function createMotionComponent(e,{forwardMotionProps:i=!1}={},d,j){d&&loadFeatures(d);const _e=isSVGComponent(e)?useSVGVisualState:useHTMLVisualState;function nt(c,pt){let gt;const St={...reactExports.useContext(MotionConfigContext),...c,layoutId:useLayoutId(c)},{isStatic:kt}=St,At=useCreateMotionContext(c),Nt=_e(c,kt);if(!kt&&isBrowser){useStrictMode();const Vt=getProjectionFunctionality(St);gt=Vt.MeasureLayout,At.visualElement=useVisualElement(e,Nt,St,j,Vt.ProjectionNode)}return jsxRuntimeExports.jsxs(MotionContext.Provider,{value:At,children:[gt&&At.visualElement?jsxRuntimeExports.jsx(gt,{visualElement:At.visualElement,...St}):null,useRender(e,c,useMotionRef(Nt,At.visualElement,pt),Nt,kt,i)]})}nt.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const ct=reactExports.forwardRef(nt);return ct[motionComponentSymbol]=e,ct}function useLayoutId({layoutId:e}){const i=reactExports.useContext(LayoutGroupContext).id;return i&&e!==void 0?i+"-"+e:e}function useStrictMode(e,i){reactExports.useContext(LazyContext).strict}function getProjectionFunctionality(e){const{drag:i,layout:d}=featureDefinitions;if(!i&&!d)return{};const j={...i,...d};return{MeasureLayout:i!=null&&i.isEnabled(e)||d!=null&&d.isEnabled(e)?j.MeasureLayout:void 0,ProjectionNode:j.ProjectionNode}}function createMotionProxy(e,i){if(typeof Proxy>"u")return createMotionComponent;const d=new Map,j=(nt,ct)=>createMotionComponent(nt,ct,e,i),_e=(nt,ct)=>j(nt,ct);return new Proxy(_e,{get:(nt,ct)=>ct==="create"?j:(d.has(ct)||d.set(ct,createMotionComponent(ct,void 0,e,i)),d.get(ct))})}function convertBoundingBoxToBox({top:e,left:i,right:d,bottom:j}){return{x:{min:i,max:d},y:{min:e,max:j}}}function convertBoxToBoundingBox({x:e,y:i}){return{top:i.min,right:e.max,bottom:i.max,left:e.min}}function transformBoxPoints(e,i){if(!i)return e;const d=i({x:e.left,y:e.top}),j=i({x:e.right,y:e.bottom});return{top:d.y,left:d.x,bottom:j.y,right:j.x}}function isIdentityScale(e){return e===void 0||e===1}function hasScale({scale:e,scaleX:i,scaleY:d}){return!isIdentityScale(e)||!isIdentityScale(i)||!isIdentityScale(d)}function hasTransform(e){return hasScale(e)||has2DTranslate(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function has2DTranslate(e){return is2DTranslate(e.x)||is2DTranslate(e.y)}function is2DTranslate(e){return e&&e!=="0%"}function scalePoint(e,i,d){const j=e-d,_e=i*j;return d+_e}function applyPointDelta(e,i,d,j,_e){return _e!==void 0&&(e=scalePoint(e,_e,j)),scalePoint(e,d,j)+i}function applyAxisDelta(e,i=0,d=1,j,_e){e.min=applyPointDelta(e.min,i,d,j,_e),e.max=applyPointDelta(e.max,i,d,j,_e)}function applyBoxDelta(e,{x:i,y:d}){applyAxisDelta(e.x,i.translate,i.scale,i.originPoint),applyAxisDelta(e.y,d.translate,d.scale,d.originPoint)}const TREE_SCALE_SNAP_MIN=.999999999999,TREE_SCALE_SNAP_MAX=1.0000000000001;function applyTreeDeltas(e,i,d,j=!1){const _e=d.length;if(!_e)return;i.x=i.y=1;let nt,ct;for(let c=0;c<_e;c++){nt=d[c],ct=nt.projectionDelta;const{visualElement:pt}=nt.options;pt&&pt.props.style&&pt.props.style.display==="contents"||(j&&nt.options.layoutScroll&&nt.scroll&&nt!==nt.root&&transformBox(e,{x:-nt.scroll.offset.x,y:-nt.scroll.offset.y}),ct&&(i.x*=ct.x.scale,i.y*=ct.y.scale,applyBoxDelta(e,ct)),j&&hasTransform(nt.latestValues)&&transformBox(e,nt.latestValues))}i.x<TREE_SCALE_SNAP_MAX&&i.x>TREE_SCALE_SNAP_MIN&&(i.x=1),i.y<TREE_SCALE_SNAP_MAX&&i.y>TREE_SCALE_SNAP_MIN&&(i.y=1)}function translateAxis(e,i){e.min=e.min+i,e.max=e.max+i}function transformAxis(e,i,d,j,_e=.5){const nt=mixNumber$1(e.min,e.max,_e);applyAxisDelta(e,i,d,nt,j)}function transformBox(e,i){transformAxis(e.x,i.x,i.scaleX,i.scale,i.originX),transformAxis(e.y,i.y,i.scaleY,i.scale,i.originY)}function measureViewportBox(e,i){return convertBoundingBoxToBox(transformBoxPoints(e.getBoundingClientRect(),i))}function measurePageBox(e,i,d){const j=measureViewportBox(e,d),{scroll:_e}=i;return _e&&(translateAxis(j.x,_e.offset.x),translateAxis(j.y,_e.offset.y)),j}const createAxisDelta=()=>({translate:0,scale:1,origin:0,originPoint:0}),createDelta=()=>({x:createAxisDelta(),y:createAxisDelta()}),createAxis=()=>({min:0,max:0}),createBox=()=>({x:createAxis(),y:createAxis()}),prefersReducedMotion={current:null},hasReducedMotionListener={current:!1};function initPrefersReducedMotion(){if(hasReducedMotionListener.current=!0,!!isBrowser)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),i=()=>prefersReducedMotion.current=e.matches;e.addEventListener("change",i),i()}else prefersReducedMotion.current=!1}const visualElementStore=new WeakMap;function updateMotionValuesFromProps(e,i,d){for(const j in i){const _e=i[j],nt=d[j];if(isMotionValue(_e))e.addValue(j,_e);else if(isMotionValue(nt))e.addValue(j,motionValue(_e,{owner:e}));else if(nt!==_e)if(e.hasValue(j)){const ct=e.getValue(j);ct.liveStyle===!0?ct.jump(_e):ct.hasAnimated||ct.set(_e)}else{const ct=e.getStaticValue(j);e.addValue(j,motionValue(ct!==void 0?ct:_e,{owner:e}))}}for(const j in d)i[j]===void 0&&e.removeValue(j);return i}const propEventHandlers=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class VisualElement{scrapeMotionValuesFromProps(i,d,j){return{}}constructor({parent:i,props:d,presenceContext:j,reducedMotionConfig:_e,blockInitialAnimation:nt,visualState:ct},c={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=KeyframeResolver,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const At=time.now();this.renderScheduledAt<At&&(this.renderScheduledAt=At,frame.render(this.render,!1,!0))};const{latestValues:pt,renderState:gt}=ct;this.latestValues=pt,this.baseTarget={...pt},this.initialValues=d.initial?{...pt}:{},this.renderState=gt,this.parent=i,this.props=d,this.presenceContext=j,this.depth=i?i.depth+1:0,this.reducedMotionConfig=_e,this.options=c,this.blockInitialAnimation=!!nt,this.isControllingVariants=isControllingVariants(d),this.isVariantNode=isVariantNode(d),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(i&&i.current);const{willChange:St,...kt}=this.scrapeMotionValuesFromProps(d,{},this);for(const At in kt){const Nt=kt[At];pt[At]!==void 0&&isMotionValue(Nt)&&Nt.set(pt[At])}}mount(i){var d;this.current=i,visualElementStore.set(i,this),this.projection&&!this.projection.instance&&this.projection.mount(i),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((j,_e)=>this.bindToMotionValue(_e,j)),hasReducedMotionListener.current||initPrefersReducedMotion(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:prefersReducedMotion.current,(d=this.parent)==null||d.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var i;this.projection&&this.projection.unmount(),cancelFrame(this.notifyUpdate),cancelFrame(this.render),this.valueSubscriptions.forEach(d=>d()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(i=this.parent)==null||i.removeChild(this);for(const d in this.events)this.events[d].clear();for(const d in this.features){const j=this.features[d];j&&(j.unmount(),j.isMounted=!1)}this.current=null}addChild(i){this.children.add(i),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(i)}removeChild(i){this.children.delete(i),this.enteringChildren&&this.enteringChildren.delete(i)}bindToMotionValue(i,d){this.valueSubscriptions.has(i)&&this.valueSubscriptions.get(i)();const j=transformProps.has(i);j&&this.onBindTransform&&this.onBindTransform();const _e=d.on("change",ct=>{this.latestValues[i]=ct,this.props.onUpdate&&frame.preRender(this.notifyUpdate),j&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let nt;window.MotionCheckAppearSync&&(nt=window.MotionCheckAppearSync(this,i,d)),this.valueSubscriptions.set(i,()=>{_e(),nt&&nt(),d.owner&&d.stop()})}sortNodePosition(i){return!this.current||!this.sortInstanceNodePosition||this.type!==i.type?0:this.sortInstanceNodePosition(this.current,i.current)}updateFeatures(){let i="animation";for(i in featureDefinitions){const d=featureDefinitions[i];if(!d)continue;const{isEnabled:j,Feature:_e}=d;if(!this.features[i]&&_e&&j(this.props)&&(this.features[i]=new _e(this)),this.features[i]){const nt=this.features[i];nt.isMounted?nt.update():(nt.mount(),nt.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):createBox()}getStaticValue(i){return this.latestValues[i]}setStaticValue(i,d){this.latestValues[i]=d}update(i,d){(i.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=i,this.prevPresenceContext=this.presenceContext,this.presenceContext=d;for(let j=0;j<propEventHandlers.length;j++){const _e=propEventHandlers[j];this.propEventSubscriptions[_e]&&(this.propEventSubscriptions[_e](),delete this.propEventSubscriptions[_e]);const nt="on"+_e,ct=i[nt];ct&&(this.propEventSubscriptions[_e]=this.on(_e,ct))}this.prevMotionValues=updateMotionValuesFromProps(this,this.scrapeMotionValuesFromProps(i,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(i){return this.props.variants?this.props.variants[i]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(i){const d=this.getClosestVariantNode();if(d)return d.variantChildren&&d.variantChildren.add(i),()=>d.variantChildren.delete(i)}addValue(i,d){const j=this.values.get(i);d!==j&&(j&&this.removeValue(i),this.bindToMotionValue(i,d),this.values.set(i,d),this.latestValues[i]=d.get())}removeValue(i){this.values.delete(i);const d=this.valueSubscriptions.get(i);d&&(d(),this.valueSubscriptions.delete(i)),delete this.latestValues[i],this.removeValueFromRenderState(i,this.renderState)}hasValue(i){return this.values.has(i)}getValue(i,d){if(this.props.values&&this.props.values[i])return this.props.values[i];let j=this.values.get(i);return j===void 0&&d!==void 0&&(j=motionValue(d===null?void 0:d,{owner:this}),this.addValue(i,j)),j}readValue(i,d){let j=this.latestValues[i]!==void 0||!this.current?this.latestValues[i]:this.getBaseTargetFromProps(this.props,i)??this.readValueFromInstance(this.current,i,this.options);return j!=null&&(typeof j=="string"&&(isNumericalString(j)||isZeroValueString(j))?j=parseFloat(j):!findValueType(j)&&complex.test(d)&&(j=getAnimatableNone(i,d)),this.setBaseTarget(i,isMotionValue(j)?j.get():j)),isMotionValue(j)?j.get():j}setBaseTarget(i,d){this.baseTarget[i]=d}getBaseTarget(i){var nt;const{initial:d}=this.props;let j;if(typeof d=="string"||typeof d=="object"){const ct=resolveVariantFromProps(this.props,d,(nt=this.presenceContext)==null?void 0:nt.custom);ct&&(j=ct[i])}if(d&&j!==void 0)return j;const _e=this.getBaseTargetFromProps(this.props,i);return _e!==void 0&&!isMotionValue(_e)?_e:this.initialValues[i]!==void 0&&j===void 0?void 0:this.baseTarget[i]}on(i,d){return this.events[i]||(this.events[i]=new SubscriptionManager),this.events[i].add(d)}notify(i,...d){this.events[i]&&this.events[i].notify(...d)}scheduleRenderMicrotask(){microtask.render(this.render)}}class DOMVisualElement extends VisualElement{constructor(){super(...arguments),this.KeyframeResolver=DOMKeyframesResolver}sortInstanceNodePosition(i,d){return i.compareDocumentPosition(d)&2?1:-1}getBaseTargetFromProps(i,d){return i.style?i.style[d]:void 0}removeValueFromRenderState(i,{vars:d,style:j}){delete d[i],delete j[i]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:i}=this.props;isMotionValue(i)&&(this.childSubscription=i.on("change",d=>{this.current&&(this.current.textContent=`${d}`)}))}}function renderHTML(e,{style:i,vars:d},j,_e){const nt=e.style;let ct;for(ct in i)nt[ct]=i[ct];_e==null||_e.applyProjectionStyles(nt,j);for(ct in d)nt.setProperty(ct,d[ct])}function getComputedStyle$1(e){return window.getComputedStyle(e)}class HTMLVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="html",this.renderInstance=renderHTML}readValueFromInstance(i,d){var j;if(transformProps.has(d))return(j=this.projection)!=null&&j.isProjecting?defaultTransformValue(d):readTransformValue(i,d);{const _e=getComputedStyle$1(i),nt=(isCSSVariableName(d)?_e.getPropertyValue(d):_e[d])||0;return typeof nt=="string"?nt.trim():nt}}measureInstanceViewportBox(i,{transformPagePoint:d}){return measureViewportBox(i,d)}build(i,d,j){buildHTMLStyles(i,d,j.transformTemplate)}scrapeMotionValuesFromProps(i,d,j){return scrapeMotionValuesFromProps$1(i,d,j)}}const camelCaseAttributes=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function renderSVG(e,i,d,j){renderHTML(e,i,void 0,j);for(const _e in i.attrs)e.setAttribute(camelCaseAttributes.has(_e)?_e:camelToDash(_e),i.attrs[_e])}class SVGVisualElement extends DOMVisualElement{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=createBox}getBaseTargetFromProps(i,d){return i[d]}readValueFromInstance(i,d){if(transformProps.has(d)){const j=getDefaultValueType(d);return j&&j.default||0}return d=camelCaseAttributes.has(d)?d:camelToDash(d),i.getAttribute(d)}scrapeMotionValuesFromProps(i,d,j){return scrapeMotionValuesFromProps(i,d,j)}build(i,d,j){buildSVGAttrs(i,d,this.isSVGTag,j.transformTemplate,j.style)}renderInstance(i,d,j,_e){renderSVG(i,d,j,_e)}mount(i){this.isSVGTag=isSVGTag(i.tagName),super.mount(i)}}const createDomVisualElement=(e,i)=>isSVGComponent(e)?new SVGVisualElement(i):new HTMLVisualElement(i,{allowProjection:e!==reactExports.Fragment});function resolveVariant(e,i,d){const j=e.getProps();return resolveVariantFromProps(j,i,d!==void 0?d:j.custom,e)}const isKeyframesTarget=e=>Array.isArray(e);function setMotionValue(e,i,d){e.hasValue(i)?e.getValue(i).set(d):e.addValue(i,motionValue(d))}function resolveFinalValueInKeyframes(e){return isKeyframesTarget(e)?e[e.length-1]||0:e}function setTarget(e,i){const d=resolveVariant(e,i);let{transitionEnd:j={},transition:_e={},...nt}=d||{};nt={...nt,...j};for(const ct in nt){const c=resolveFinalValueInKeyframes(nt[ct]);setMotionValue(e,ct,c)}}function isWillChangeMotionValue(e){return!!(isMotionValue(e)&&e.add)}function addValueToWillChange(e,i){const d=e.getValue("willChange");if(isWillChangeMotionValue(d))return d.add(i);if(!d&&MotionGlobalConfig.WillChange){const j=new MotionGlobalConfig.WillChange("auto");e.addValue("willChange",j),j.add(i)}}function getOptimisedAppearId(e){return e.props[optimizedAppearDataAttribute]}const isNotNull=e=>e!==null;function getFinalKeyframe(e,{repeat:i,repeatType:d="loop"},j){const _e=e.filter(isNotNull),nt=i&&d!=="loop"&&i%2===1?0:_e.length-1;return _e[nt]}const underDampedSpring={type:"spring",stiffness:500,damping:25,restSpeed:10},criticallyDampedSpring=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),keyframesTransition={type:"keyframes",duration:.8},ease={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},getDefaultTransition=(e,{keyframes:i})=>i.length>2?keyframesTransition:transformProps.has(e)?e.startsWith("scale")?criticallyDampedSpring(i[1]):underDampedSpring:ease;function isTransitionDefined({when:e,delay:i,delayChildren:d,staggerChildren:j,staggerDirection:_e,repeat:nt,repeatType:ct,repeatDelay:c,from:pt,elapsed:gt,...St}){return!!Object.keys(St).length}const animateMotionValue=(e,i,d,j={},_e,nt)=>ct=>{const c=getValueTransition(j,e)||{},pt=c.delay||j.delay||0;let{elapsed:gt=0}=j;gt=gt-secondsToMilliseconds(pt);const St={keyframes:Array.isArray(d)?d:[null,d],ease:"easeOut",velocity:i.getVelocity(),...c,delay:-gt,onUpdate:At=>{i.set(At),c.onUpdate&&c.onUpdate(At)},onComplete:()=>{ct(),c.onComplete&&c.onComplete()},name:e,motionValue:i,element:nt?void 0:_e};isTransitionDefined(c)||Object.assign(St,getDefaultTransition(e,St)),St.duration&&(St.duration=secondsToMilliseconds(St.duration)),St.repeatDelay&&(St.repeatDelay=secondsToMilliseconds(St.repeatDelay)),St.from!==void 0&&(St.keyframes[0]=St.from);let kt=!1;if((St.type===!1||St.duration===0&&!St.repeatDelay)&&(makeAnimationInstant(St),St.delay===0&&(kt=!0)),(MotionGlobalConfig.instantAnimations||MotionGlobalConfig.skipAnimations)&&(kt=!0,makeAnimationInstant(St),St.delay=0),St.allowFlatten=!c.type&&!c.ease,kt&&!nt&&i.get()!==void 0){const At=getFinalKeyframe(St.keyframes,c);if(At!==void 0){frame.update(()=>{St.onUpdate(At),St.onComplete()});return}}return c.isSync?new JSAnimation(St):new AsyncMotionValueAnimation(St)};function shouldBlockAnimation({protectedKeys:e,needsAnimating:i},d){const j=e.hasOwnProperty(d)&&i[d]!==!0;return i[d]=!1,j}function animateTarget(e,i,{delay:d=0,transitionOverride:j,type:_e}={}){let{transition:nt=e.getDefaultTransition(),transitionEnd:ct,...c}=i;j&&(nt=j);const pt=[],gt=_e&&e.animationState&&e.animationState.getState()[_e];for(const St in c){const kt=e.getValue(St,e.latestValues[St]??null),At=c[St];if(At===void 0||gt&&shouldBlockAnimation(gt,St))continue;const Nt={delay:d,...getValueTransition(nt||{},St)},Vt=kt.get();if(Vt!==void 0&&!kt.isAnimating&&!Array.isArray(At)&&At===Vt&&!Nt.velocity)continue;let zt=!1;if(window.MotionHandoffAnimation){const Dt=getOptimisedAppearId(e);if(Dt){const It=window.MotionHandoffAnimation(Dt,St,frame);It!==null&&(Nt.startTime=It,zt=!0)}}addValueToWillChange(e,St),kt.start(animateMotionValue(St,kt,At,e.shouldReduceMotion&&positionalKeys.has(St)?{type:!1}:Nt,e,zt));const Jt=kt.animation;Jt&&pt.push(Jt)}return ct&&Promise.all(pt).then(()=>{frame.update(()=>{ct&&setTarget(e,ct)})}),pt}function calcChildStagger(e,i,d,j=0,_e=1){const nt=Array.from(e).sort((gt,St)=>gt.sortNodePosition(St)).indexOf(i),ct=e.size,c=(ct-1)*j;return typeof d=="function"?d(nt,ct):_e===1?nt*j:c-nt*j}function animateVariant(e,i,d={}){var pt;const j=resolveVariant(e,i,d.type==="exit"?(pt=e.presenceContext)==null?void 0:pt.custom:void 0);let{transition:_e=e.getDefaultTransition()||{}}=j||{};d.transitionOverride&&(_e=d.transitionOverride);const nt=j?()=>Promise.all(animateTarget(e,j,d)):()=>Promise.resolve(),ct=e.variantChildren&&e.variantChildren.size?(gt=0)=>{const{delayChildren:St=0,staggerChildren:kt,staggerDirection:At}=_e;return animateChildren(e,i,gt,St,kt,At,d)}:()=>Promise.resolve(),{when:c}=_e;if(c){const[gt,St]=c==="beforeChildren"?[nt,ct]:[ct,nt];return gt().then(()=>St())}else return Promise.all([nt(),ct(d.delay)])}function animateChildren(e,i,d=0,j=0,_e=0,nt=1,ct){const c=[];for(const pt of e.variantChildren)pt.notify("AnimationStart",i),c.push(animateVariant(pt,i,{...ct,delay:d+(typeof j=="function"?0:j)+calcChildStagger(e.variantChildren,pt,j,_e,nt)}).then(()=>pt.notify("AnimationComplete",i)));return Promise.all(c)}function animateVisualElement(e,i,d={}){e.notify("AnimationStart",i);let j;if(Array.isArray(i)){const _e=i.map(nt=>animateVariant(e,nt,d));j=Promise.all(_e)}else if(typeof i=="string")j=animateVariant(e,i,d);else{const _e=typeof i=="function"?resolveVariant(e,i,d.custom):i;j=Promise.all(animateTarget(e,_e,d))}return j.then(()=>{e.notify("AnimationComplete",i)})}function shallowCompare(e,i){if(!Array.isArray(i))return!1;const d=i.length;if(d!==e.length)return!1;for(let j=0;j<d;j++)if(i[j]!==e[j])return!1;return!0}const numVariantProps=variantProps.length;function getVariantContext(e){if(!e)return;if(!e.isControllingVariants){const d=e.parent?getVariantContext(e.parent)||{}:{};return e.props.initial!==void 0&&(d.initial=e.props.initial),d}const i={};for(let d=0;d<numVariantProps;d++){const j=variantProps[d],_e=e.props[j];(isVariantLabel(_e)||_e===!1)&&(i[j]=_e)}return i}const reversePriorityOrder=[...variantPriorityOrder].reverse(),numAnimationTypes=variantPriorityOrder.length;function animateList(e){return i=>Promise.all(i.map(({animation:d,options:j})=>animateVisualElement(e,d,j)))}function createAnimationState(e){let i=animateList(e),d=createState(),j=!0;const _e=pt=>(gt,St)=>{var At;const kt=resolveVariant(e,St,pt==="exit"?(At=e.presenceContext)==null?void 0:At.custom:void 0);if(kt){const{transition:Nt,transitionEnd:Vt,...zt}=kt;gt={...gt,...zt,...Vt}}return gt};function nt(pt){i=pt(e)}function ct(pt){const{props:gt}=e,St=getVariantContext(e.parent)||{},kt=[],At=new Set;let Nt={},Vt=1/0;for(let Jt=0;Jt<numAnimationTypes;Jt++){const Dt=reversePriorityOrder[Jt],It=d[Dt],Mt=gt[Dt]!==void 0?gt[Dt]:St[Dt],Ht=isVariantLabel(Mt),tr=Dt===pt?It.isActive:null;tr===!1&&(Vt=Jt);let er=Mt===St[Dt]&&Mt!==gt[Dt]&&Ht;if(er&&j&&e.manuallyAnimateOnMount&&(er=!1),It.protectedKeys={...Nt},!It.isActive&&tr===null||!Mt&&!It.prevProp||isAnimationControls(Mt)||typeof Mt=="boolean")continue;const dr=checkVariantsDidChange(It.prevProp,Mt);let mr=dr||Dt===pt&&It.isActive&&!er&&Ht||Jt>Vt&&Ht,Ur=!1;const Dr=Array.isArray(Mt)?Mt:[Mt];let Yr=Dr.reduce(_e(Dt),{});tr===!1&&(Yr={});const{prevResolvedValues:es={}}=It,ms={...es,...Yr},Ms=jr=>{mr=!0,At.has(jr)&&(Ur=!0,At.delete(jr)),It.needsAnimating[jr]=!0;const rr=e.getValue(jr);rr&&(rr.liveStyle=!1)};for(const jr in ms){const rr=Yr[jr],ar=es[jr];if(Nt.hasOwnProperty(jr))continue;let $r=!1;isKeyframesTarget(rr)&&isKeyframesTarget(ar)?$r=!shallowCompare(rr,ar):$r=rr!==ar,$r?rr!=null?Ms(jr):At.add(jr):rr!==void 0&&At.has(jr)?Ms(jr):It.protectedKeys[jr]=!0}It.prevProp=Mt,It.prevResolvedValues=Yr,It.isActive&&(Nt={...Nt,...Yr}),j&&e.blockInitialAnimation&&(mr=!1);const Kr=er&&dr;mr&&(!Kr||Ur)&&kt.push(...Dr.map(jr=>{const rr={type:Dt};if(typeof jr=="string"&&j&&!Kr&&e.manuallyAnimateOnMount&&e.parent){const{parent:ar}=e,$r=resolveVariant(ar,jr);if(ar.enteringChildren&&$r){const{delayChildren:Ar}=$r.transition||{};rr.delay=calcChildStagger(ar.enteringChildren,e,Ar)}}return{animation:jr,options:rr}}))}if(At.size){const Jt={};if(typeof gt.initial!="boolean"){const Dt=resolveVariant(e,Array.isArray(gt.initial)?gt.initial[0]:gt.initial);Dt&&Dt.transition&&(Jt.transition=Dt.transition)}At.forEach(Dt=>{const It=e.getBaseTarget(Dt),Mt=e.getValue(Dt);Mt&&(Mt.liveStyle=!0),Jt[Dt]=It??null}),kt.push({animation:Jt})}let zt=!!kt.length;return j&&(gt.initial===!1||gt.initial===gt.animate)&&!e.manuallyAnimateOnMount&&(zt=!1),j=!1,zt?i(kt):Promise.resolve()}function c(pt,gt){var kt;if(d[pt].isActive===gt)return Promise.resolve();(kt=e.variantChildren)==null||kt.forEach(At=>{var Nt;return(Nt=At.animationState)==null?void 0:Nt.setActive(pt,gt)}),d[pt].isActive=gt;const St=ct(pt);for(const At in d)d[At].protectedKeys={};return St}return{animateChanges:ct,setActive:c,setAnimateFunction:nt,getState:()=>d,reset:()=>{d=createState()}}}function checkVariantsDidChange(e,i){return typeof i=="string"?i!==e:Array.isArray(i)?!shallowCompare(i,e):!1}function createTypeState(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function createState(){return{animate:createTypeState(!0),whileInView:createTypeState(),whileHover:createTypeState(),whileTap:createTypeState(),whileDrag:createTypeState(),whileFocus:createTypeState(),exit:createTypeState()}}class Feature{constructor(i){this.isMounted=!1,this.node=i}update(){}}class AnimationFeature extends Feature{constructor(i){super(i),i.animationState||(i.animationState=createAnimationState(i))}updateAnimationControlsSubscription(){const{animate:i}=this.node.getProps();isAnimationControls(i)&&(this.unmountControls=i.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:i}=this.node.getProps(),{animate:d}=this.node.prevProps||{};i!==d&&this.updateAnimationControlsSubscription()}unmount(){var i;this.node.animationState.reset(),(i=this.unmountControls)==null||i.call(this)}}let id$1=0;class ExitAnimationFeature extends Feature{constructor(){super(...arguments),this.id=id$1++}update(){if(!this.node.presenceContext)return;const{isPresent:i,onExitComplete:d}=this.node.presenceContext,{isPresent:j}=this.node.prevPresenceContext||{};if(!this.node.animationState||i===j)return;const _e=this.node.animationState.setActive("exit",!i);d&&!i&&_e.then(()=>{d(this.id)})}mount(){const{register:i,onExitComplete:d}=this.node.presenceContext||{};d&&d(this.id),i&&(this.unmount=i(this.id))}unmount(){}}const animations={animation:{Feature:AnimationFeature},exit:{Feature:ExitAnimationFeature}};function addDomEvent(e,i,d,j={passive:!0}){return e.addEventListener(i,d,j),()=>e.removeEventListener(i,d)}function extractEventInfo(e){return{point:{x:e.pageX,y:e.pageY}}}const addPointerInfo=e=>i=>isPrimaryPointer(i)&&e(i,extractEventInfo(i));function addPointerEvent(e,i,d,j){return addDomEvent(e,i,addPointerInfo(d),j)}const SCALE_PRECISION=1e-4,SCALE_MIN=1-SCALE_PRECISION,SCALE_MAX=1+SCALE_PRECISION,TRANSLATE_PRECISION=.01,TRANSLATE_MIN=0-TRANSLATE_PRECISION,TRANSLATE_MAX=0+TRANSLATE_PRECISION;function calcLength(e){return e.max-e.min}function isNear(e,i,d){return Math.abs(e-i)<=d}function calcAxisDelta(e,i,d,j=.5){e.origin=j,e.originPoint=mixNumber$1(i.min,i.max,e.origin),e.scale=calcLength(d)/calcLength(i),e.translate=mixNumber$1(d.min,d.max,e.origin)-e.originPoint,(e.scale>=SCALE_MIN&&e.scale<=SCALE_MAX||isNaN(e.scale))&&(e.scale=1),(e.translate>=TRANSLATE_MIN&&e.translate<=TRANSLATE_MAX||isNaN(e.translate))&&(e.translate=0)}function calcBoxDelta(e,i,d,j){calcAxisDelta(e.x,i.x,d.x,j?j.originX:void 0),calcAxisDelta(e.y,i.y,d.y,j?j.originY:void 0)}function calcRelativeAxis(e,i,d){e.min=d.min+i.min,e.max=e.min+calcLength(i)}function calcRelativeBox(e,i,d){calcRelativeAxis(e.x,i.x,d.x),calcRelativeAxis(e.y,i.y,d.y)}function calcRelativeAxisPosition(e,i,d){e.min=i.min-d.min,e.max=e.min+calcLength(i)}function calcRelativePosition(e,i,d){calcRelativeAxisPosition(e.x,i.x,d.x),calcRelativeAxisPosition(e.y,i.y,d.y)}function eachAxis(e){return[e("x"),e("y")]}const getContextWindow=({current:e})=>e?e.ownerDocument.defaultView:null,distance=(e,i)=>Math.abs(e-i);function distance2D(e,i){const d=distance(e.x,i.x),j=distance(e.y,i.y);return Math.sqrt(d**2+j**2)}class PanSession{constructor(i,d,{transformPagePoint:j,contextWindow:_e=window,dragSnapToOrigin:nt=!1,distanceThreshold:ct=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const At=getPanInfo(this.lastMoveEventInfo,this.history),Nt=this.startEvent!==null,Vt=distance2D(At.offset,{x:0,y:0})>=this.distanceThreshold;if(!Nt&&!Vt)return;const{point:zt}=At,{timestamp:Jt}=frameData;this.history.push({...zt,timestamp:Jt});const{onStart:Dt,onMove:It}=this.handlers;Nt||(Dt&&Dt(this.lastMoveEvent,At),this.startEvent=this.lastMoveEvent),It&&It(this.lastMoveEvent,At)},this.handlePointerMove=(At,Nt)=>{this.lastMoveEvent=At,this.lastMoveEventInfo=transformPoint(Nt,this.transformPagePoint),frame.update(this.updatePoint,!0)},this.handlePointerUp=(At,Nt)=>{this.end();const{onEnd:Vt,onSessionEnd:zt,resumeAnimation:Jt}=this.handlers;if(this.dragSnapToOrigin&&Jt&&Jt(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Dt=getPanInfo(At.type==="pointercancel"?this.lastMoveEventInfo:transformPoint(Nt,this.transformPagePoint),this.history);this.startEvent&&Vt&&Vt(At,Dt),zt&&zt(At,Dt)},!isPrimaryPointer(i))return;this.dragSnapToOrigin=nt,this.handlers=d,this.transformPagePoint=j,this.distanceThreshold=ct,this.contextWindow=_e||window;const c=extractEventInfo(i),pt=transformPoint(c,this.transformPagePoint),{point:gt}=pt,{timestamp:St}=frameData;this.history=[{...gt,timestamp:St}];const{onSessionStart:kt}=d;kt&&kt(i,getPanInfo(pt,this.history)),this.removeListeners=pipe(addPointerEvent(this.contextWindow,"pointermove",this.handlePointerMove),addPointerEvent(this.contextWindow,"pointerup",this.handlePointerUp),addPointerEvent(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(i){this.handlers=i}end(){this.removeListeners&&this.removeListeners(),cancelFrame(this.updatePoint)}}function transformPoint(e,i){return i?{point:i(e.point)}:e}function subtractPoint(e,i){return{x:e.x-i.x,y:e.y-i.y}}function getPanInfo({point:e},i){return{point:e,delta:subtractPoint(e,lastDevicePoint(i)),offset:subtractPoint(e,startDevicePoint(i)),velocity:getVelocity(i,.1)}}function startDevicePoint(e){return e[0]}function lastDevicePoint(e){return e[e.length-1]}function getVelocity(e,i){if(e.length<2)return{x:0,y:0};let d=e.length-1,j=null;const _e=lastDevicePoint(e);for(;d>=0&&(j=e[d],!(_e.timestamp-j.timestamp>secondsToMilliseconds(i)));)d--;if(!j)return{x:0,y:0};const nt=millisecondsToSeconds(_e.timestamp-j.timestamp);if(nt===0)return{x:0,y:0};const ct={x:(_e.x-j.x)/nt,y:(_e.y-j.y)/nt};return ct.x===1/0&&(ct.x=0),ct.y===1/0&&(ct.y=0),ct}function applyConstraints(e,{min:i,max:d},j){return i!==void 0&&e<i?e=j?mixNumber$1(i,e,j.min):Math.max(e,i):d!==void 0&&e>d&&(e=j?mixNumber$1(d,e,j.max):Math.min(e,d)),e}function calcRelativeAxisConstraints(e,i,d){return{min:i!==void 0?e.min+i:void 0,max:d!==void 0?e.max+d-(e.max-e.min):void 0}}function calcRelativeConstraints(e,{top:i,left:d,bottom:j,right:_e}){return{x:calcRelativeAxisConstraints(e.x,d,_e),y:calcRelativeAxisConstraints(e.y,i,j)}}function calcViewportAxisConstraints(e,i){let d=i.min-e.min,j=i.max-e.max;return i.max-i.min<e.max-e.min&&([d,j]=[j,d]),{min:d,max:j}}function calcViewportConstraints(e,i){return{x:calcViewportAxisConstraints(e.x,i.x),y:calcViewportAxisConstraints(e.y,i.y)}}function calcOrigin(e,i){let d=.5;const j=calcLength(e),_e=calcLength(i);return _e>j?d=progress(i.min,i.max-j,e.min):j>_e&&(d=progress(e.min,e.max-_e,i.min)),clamp(0,1,d)}function rebaseAxisConstraints(e,i){const d={};return i.min!==void 0&&(d.min=i.min-e.min),i.max!==void 0&&(d.max=i.max-e.min),d}const defaultElastic=.35;function resolveDragElastic(e=defaultElastic){return e===!1?e=0:e===!0&&(e=defaultElastic),{x:resolveAxisElastic(e,"left","right"),y:resolveAxisElastic(e,"top","bottom")}}function resolveAxisElastic(e,i,d){return{min:resolvePointElastic(e,i),max:resolvePointElastic(e,d)}}function resolvePointElastic(e,i){return typeof e=="number"?e:e[i]||0}const elementDragControls=new WeakMap;class VisualElementDragControls{constructor(i){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=createBox(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=i}start(i,{snapToCursor:d=!1,distanceThreshold:j}={}){const{presenceContext:_e}=this.visualElement;if(_e&&_e.isPresent===!1)return;const nt=kt=>{const{dragSnapToOrigin:At}=this.getProps();At?this.pauseAnimation():this.stopAnimation(),d&&this.snapToCursor(extractEventInfo(kt).point)},ct=(kt,At)=>{const{drag:Nt,dragPropagation:Vt,onDragStart:zt}=this.getProps();if(Nt&&!Vt&&(this.openDragLock&&this.openDragLock(),this.openDragLock=setDragLock(Nt),!this.openDragLock))return;this.latestPointerEvent=kt,this.latestPanInfo=At,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),eachAxis(Dt=>{let It=this.getAxisMotionValue(Dt).get()||0;if(percent.test(It)){const{projection:Mt}=this.visualElement;if(Mt&&Mt.layout){const Ht=Mt.layout.layoutBox[Dt];Ht&&(It=calcLength(Ht)*(parseFloat(It)/100))}}this.originPoint[Dt]=It}),zt&&frame.postRender(()=>zt(kt,At)),addValueToWillChange(this.visualElement,"transform");const{animationState:Jt}=this.visualElement;Jt&&Jt.setActive("whileDrag",!0)},c=(kt,At)=>{this.latestPointerEvent=kt,this.latestPanInfo=At;const{dragPropagation:Nt,dragDirectionLock:Vt,onDirectionLock:zt,onDrag:Jt}=this.getProps();if(!Nt&&!this.openDragLock)return;const{offset:Dt}=At;if(Vt&&this.currentDirection===null){this.currentDirection=getCurrentDirection(Dt),this.currentDirection!==null&&zt&&zt(this.currentDirection);return}this.updateAxis("x",At.point,Dt),this.updateAxis("y",At.point,Dt),this.visualElement.render(),Jt&&Jt(kt,At)},pt=(kt,At)=>{this.latestPointerEvent=kt,this.latestPanInfo=At,this.stop(kt,At),this.latestPointerEvent=null,this.latestPanInfo=null},gt=()=>eachAxis(kt=>{var At;return this.getAnimationState(kt)==="paused"&&((At=this.getAxisMotionValue(kt).animation)==null?void 0:At.play())}),{dragSnapToOrigin:St}=this.getProps();this.panSession=new PanSession(i,{onSessionStart:nt,onStart:ct,onMove:c,onSessionEnd:pt,resumeAnimation:gt},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:St,distanceThreshold:j,contextWindow:getContextWindow(this.visualElement)})}stop(i,d){const j=i||this.latestPointerEvent,_e=d||this.latestPanInfo,nt=this.isDragging;if(this.cancel(),!nt||!_e||!j)return;const{velocity:ct}=_e;this.startAnimation(ct);const{onDragEnd:c}=this.getProps();c&&frame.postRender(()=>c(j,_e))}cancel(){this.isDragging=!1;const{projection:i,animationState:d}=this.visualElement;i&&(i.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:j}=this.getProps();!j&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),d&&d.setActive("whileDrag",!1)}updateAxis(i,d,j){const{drag:_e}=this.getProps();if(!j||!shouldDrag(i,_e,this.currentDirection))return;const nt=this.getAxisMotionValue(i);let ct=this.originPoint[i]+j[i];this.constraints&&this.constraints[i]&&(ct=applyConstraints(ct,this.constraints[i],this.elastic[i])),nt.set(ct)}resolveConstraints(){var nt;const{dragConstraints:i,dragElastic:d}=this.getProps(),j=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(nt=this.visualElement.projection)==null?void 0:nt.layout,_e=this.constraints;i&&isRefObject(i)?this.constraints||(this.constraints=this.resolveRefConstraints()):i&&j?this.constraints=calcRelativeConstraints(j.layoutBox,i):this.constraints=!1,this.elastic=resolveDragElastic(d),_e!==this.constraints&&j&&this.constraints&&!this.hasMutatedConstraints&&eachAxis(ct=>{this.constraints!==!1&&this.getAxisMotionValue(ct)&&(this.constraints[ct]=rebaseAxisConstraints(j.layoutBox[ct],this.constraints[ct]))})}resolveRefConstraints(){const{dragConstraints:i,onMeasureDragConstraints:d}=this.getProps();if(!i||!isRefObject(i))return!1;const j=i.current,{projection:_e}=this.visualElement;if(!_e||!_e.layout)return!1;const nt=measurePageBox(j,_e.root,this.visualElement.getTransformPagePoint());let ct=calcViewportConstraints(_e.layout.layoutBox,nt);if(d){const c=d(convertBoxToBoundingBox(ct));this.hasMutatedConstraints=!!c,c&&(ct=convertBoundingBoxToBox(c))}return ct}startAnimation(i){const{drag:d,dragMomentum:j,dragElastic:_e,dragTransition:nt,dragSnapToOrigin:ct,onDragTransitionEnd:c}=this.getProps(),pt=this.constraints||{},gt=eachAxis(St=>{if(!shouldDrag(St,d,this.currentDirection))return;let kt=pt&&pt[St]||{};ct&&(kt={min:0,max:0});const At=_e?200:1e6,Nt=_e?40:1e7,Vt={type:"inertia",velocity:j?i[St]:0,bounceStiffness:At,bounceDamping:Nt,timeConstant:750,restDelta:1,restSpeed:10,...nt,...kt};return this.startAxisValueAnimation(St,Vt)});return Promise.all(gt).then(c)}startAxisValueAnimation(i,d){const j=this.getAxisMotionValue(i);return addValueToWillChange(this.visualElement,i),j.start(animateMotionValue(i,j,0,d,this.visualElement,!1))}stopAnimation(){eachAxis(i=>this.getAxisMotionValue(i).stop())}pauseAnimation(){eachAxis(i=>{var d;return(d=this.getAxisMotionValue(i).animation)==null?void 0:d.pause()})}getAnimationState(i){var d;return(d=this.getAxisMotionValue(i).animation)==null?void 0:d.state}getAxisMotionValue(i){const d=`_drag${i.toUpperCase()}`,j=this.visualElement.getProps(),_e=j[d];return _e||this.visualElement.getValue(i,(j.initial?j.initial[i]:void 0)||0)}snapToCursor(i){eachAxis(d=>{const{drag:j}=this.getProps();if(!shouldDrag(d,j,this.currentDirection))return;const{projection:_e}=this.visualElement,nt=this.getAxisMotionValue(d);if(_e&&_e.layout){const{min:ct,max:c}=_e.layout.layoutBox[d];nt.set(i[d]-mixNumber$1(ct,c,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:i,dragConstraints:d}=this.getProps(),{projection:j}=this.visualElement;if(!isRefObject(d)||!j||!this.constraints)return;this.stopAnimation();const _e={x:0,y:0};eachAxis(ct=>{const c=this.getAxisMotionValue(ct);if(c&&this.constraints!==!1){const pt=c.get();_e[ct]=calcOrigin({min:pt,max:pt},this.constraints[ct])}});const{transformTemplate:nt}=this.visualElement.getProps();this.visualElement.current.style.transform=nt?nt({},""):"none",j.root&&j.root.updateScroll(),j.updateLayout(),this.resolveConstraints(),eachAxis(ct=>{if(!shouldDrag(ct,i,null))return;const c=this.getAxisMotionValue(ct),{min:pt,max:gt}=this.constraints[ct];c.set(mixNumber$1(pt,gt,_e[ct]))})}addListeners(){if(!this.visualElement.current)return;elementDragControls.set(this.visualElement,this);const i=this.visualElement.current,d=addPointerEvent(i,"pointerdown",pt=>{const{drag:gt,dragListener:St=!0}=this.getProps();gt&&St&&this.start(pt)}),j=()=>{const{dragConstraints:pt}=this.getProps();isRefObject(pt)&&pt.current&&(this.constraints=this.resolveRefConstraints())},{projection:_e}=this.visualElement,nt=_e.addEventListener("measure",j);_e&&!_e.layout&&(_e.root&&_e.root.updateScroll(),_e.updateLayout()),frame.read(j);const ct=addDomEvent(window,"resize",()=>this.scalePositionWithinConstraints()),c=_e.addEventListener("didUpdate",({delta:pt,hasLayoutChanged:gt})=>{this.isDragging&&gt&&(eachAxis(St=>{const kt=this.getAxisMotionValue(St);kt&&(this.originPoint[St]+=pt[St].translate,kt.set(kt.get()+pt[St].translate))}),this.visualElement.render())});return()=>{ct(),d(),nt(),c&&c()}}getProps(){const i=this.visualElement.getProps(),{drag:d=!1,dragDirectionLock:j=!1,dragPropagation:_e=!1,dragConstraints:nt=!1,dragElastic:ct=defaultElastic,dragMomentum:c=!0}=i;return{...i,drag:d,dragDirectionLock:j,dragPropagation:_e,dragConstraints:nt,dragElastic:ct,dragMomentum:c}}}function shouldDrag(e,i,d){return(i===!0||i===e)&&(d===null||d===e)}function getCurrentDirection(e,i=10){let d=null;return Math.abs(e.y)>i?d="y":Math.abs(e.x)>i&&(d="x"),d}class DragGesture extends Feature{constructor(i){super(i),this.removeGroupControls=noop$1,this.removeListeners=noop$1,this.controls=new VisualElementDragControls(i)}mount(){const{dragControls:i}=this.node.getProps();i&&(this.removeGroupControls=i.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||noop$1}unmount(){this.removeGroupControls(),this.removeListeners()}}const asyncHandler=e=>(i,d)=>{e&&frame.postRender(()=>e(i,d))};class PanGesture extends Feature{constructor(){super(...arguments),this.removePointerDownListener=noop$1}onPointerDown(i){this.session=new PanSession(i,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:getContextWindow(this.node)})}createPanHandlers(){const{onPanSessionStart:i,onPanStart:d,onPan:j,onPanEnd:_e}=this.node.getProps();return{onSessionStart:asyncHandler(i),onStart:asyncHandler(d),onMove:j,onEnd:(nt,ct)=>{delete this.session,_e&&frame.postRender(()=>_e(nt,ct))}}}mount(){this.removePointerDownListener=addPointerEvent(this.node.current,"pointerdown",i=>this.onPointerDown(i))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const globalProjectionState={hasAnimatedSinceResize:!0,hasEverUpdated:!1};let hasTakenAnySnapshot=!1;class MeasureLayoutWithContext extends reactExports.Component{componentDidMount(){const{visualElement:i,layoutGroup:d,switchLayoutGroup:j,layoutId:_e}=this.props,{projection:nt}=i;nt&&(d.group&&d.group.add(nt),j&&j.register&&_e&&j.register(nt),hasTakenAnySnapshot&&nt.root.didUpdate(),nt.addEventListener("animationComplete",()=>{this.safeToRemove()}),nt.setOptions({...nt.options,onExitComplete:()=>this.safeToRemove()})),globalProjectionState.hasEverUpdated=!0}getSnapshotBeforeUpdate(i){const{layoutDependency:d,visualElement:j,drag:_e,isPresent:nt}=this.props,{projection:ct}=j;return ct&&(ct.isPresent=nt,hasTakenAnySnapshot=!0,_e||i.layoutDependency!==d||d===void 0||i.isPresent!==nt?ct.willUpdate():this.safeToRemove(),i.isPresent!==nt&&(nt?ct.promote():ct.relegate()||frame.postRender(()=>{const c=ct.getStack();(!c||!c.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:i}=this.props.visualElement;i&&(i.root.didUpdate(),microtask.postRender(()=>{!i.currentAnimation&&i.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:i,layoutGroup:d,switchLayoutGroup:j}=this.props,{projection:_e}=i;hasTakenAnySnapshot=!0,_e&&(_e.scheduleCheckAfterUnmount(),d&&d.group&&d.group.remove(_e),j&&j.deregister&&j.deregister(_e))}safeToRemove(){const{safeToRemove:i}=this.props;i&&i()}render(){return null}}function MeasureLayout(e){const[i,d]=usePresence(),j=reactExports.useContext(LayoutGroupContext);return jsxRuntimeExports.jsx(MeasureLayoutWithContext,{...e,layoutGroup:j,switchLayoutGroup:reactExports.useContext(SwitchLayoutGroupContext),isPresent:i,safeToRemove:d})}function animateSingleValue(e,i,d){const j=isMotionValue(e)?e:motionValue(e);return j.start(animateMotionValue("",j,i,d)),j.animation}const compareByDepth=(e,i)=>e.depth-i.depth;class FlatTree{constructor(){this.children=[],this.isDirty=!1}add(i){addUniqueItem(this.children,i),this.isDirty=!0}remove(i){removeItem(this.children,i),this.isDirty=!0}forEach(i){this.isDirty&&this.children.sort(compareByDepth),this.isDirty=!1,this.children.forEach(i)}}function delay(e,i){const d=time.now(),j=({timestamp:_e})=>{const nt=_e-d;nt>=i&&(cancelFrame(j),e(nt-i))};return frame.setup(j,!0),()=>cancelFrame(j)}const borders=["TopLeft","TopRight","BottomLeft","BottomRight"],numBorders=borders.length,asNumber=e=>typeof e=="string"?parseFloat(e):e,isPx=e=>typeof e=="number"||px.test(e);function mixValues(e,i,d,j,_e,nt){_e?(e.opacity=mixNumber$1(0,d.opacity??1,easeCrossfadeIn(j)),e.opacityExit=mixNumber$1(i.opacity??1,0,easeCrossfadeOut(j))):nt&&(e.opacity=mixNumber$1(i.opacity??1,d.opacity??1,j));for(let ct=0;ct<numBorders;ct++){const c=`border${borders[ct]}Radius`;let pt=getRadius(i,c),gt=getRadius(d,c);if(pt===void 0&&gt===void 0)continue;pt||(pt=0),gt||(gt=0),pt===0||gt===0||isPx(pt)===isPx(gt)?(e[c]=Math.max(mixNumber$1(asNumber(pt),asNumber(gt),j),0),(percent.test(gt)||percent.test(pt))&&(e[c]+="%")):e[c]=gt}(i.rotate||d.rotate)&&(e.rotate=mixNumber$1(i.rotate||0,d.rotate||0,j))}function getRadius(e,i){return e[i]!==void 0?e[i]:e.borderRadius}const easeCrossfadeIn=compress(0,.5,circOut),easeCrossfadeOut=compress(.5,.95,noop$1);function compress(e,i,d){return j=>j<e?0:j>i?1:d(progress(e,i,j))}function copyAxisInto(e,i){e.min=i.min,e.max=i.max}function copyBoxInto(e,i){copyAxisInto(e.x,i.x),copyAxisInto(e.y,i.y)}function copyAxisDeltaInto(e,i){e.translate=i.translate,e.scale=i.scale,e.originPoint=i.originPoint,e.origin=i.origin}function removePointDelta(e,i,d,j,_e){return e-=i,e=scalePoint(e,1/d,j),_e!==void 0&&(e=scalePoint(e,1/_e,j)),e}function removeAxisDelta(e,i=0,d=1,j=.5,_e,nt=e,ct=e){if(percent.test(i)&&(i=parseFloat(i),i=mixNumber$1(ct.min,ct.max,i/100)-ct.min),typeof i!="number")return;let c=mixNumber$1(nt.min,nt.max,j);e===nt&&(c-=i),e.min=removePointDelta(e.min,i,d,c,_e),e.max=removePointDelta(e.max,i,d,c,_e)}function removeAxisTransforms(e,i,[d,j,_e],nt,ct){removeAxisDelta(e,i[d],i[j],i[_e],i.scale,nt,ct)}const xKeys=["x","scaleX","originX"],yKeys=["y","scaleY","originY"];function removeBoxTransforms(e,i,d,j){removeAxisTransforms(e.x,i,xKeys,d?d.x:void 0,j?j.x:void 0),removeAxisTransforms(e.y,i,yKeys,d?d.y:void 0,j?j.y:void 0)}function isAxisDeltaZero(e){return e.translate===0&&e.scale===1}function isDeltaZero(e){return isAxisDeltaZero(e.x)&&isAxisDeltaZero(e.y)}function axisEquals(e,i){return e.min===i.min&&e.max===i.max}function boxEquals(e,i){return axisEquals(e.x,i.x)&&axisEquals(e.y,i.y)}function axisEqualsRounded(e,i){return Math.round(e.min)===Math.round(i.min)&&Math.round(e.max)===Math.round(i.max)}function boxEqualsRounded(e,i){return axisEqualsRounded(e.x,i.x)&&axisEqualsRounded(e.y,i.y)}function aspectRatio(e){return calcLength(e.x)/calcLength(e.y)}function axisDeltaEquals(e,i){return e.translate===i.translate&&e.scale===i.scale&&e.originPoint===i.originPoint}class NodeStack{constructor(){this.members=[]}add(i){addUniqueItem(this.members,i),i.scheduleRender()}remove(i){if(removeItem(this.members,i),i===this.prevLead&&(this.prevLead=void 0),i===this.lead){const d=this.members[this.members.length-1];d&&this.promote(d)}}relegate(i){const d=this.members.findIndex(_e=>i===_e);if(d===0)return!1;let j;for(let _e=d;_e>=0;_e--){const nt=this.members[_e];if(nt.isPresent!==!1){j=nt;break}}return j?(this.promote(j),!0):!1}promote(i,d){const j=this.lead;if(i!==j&&(this.prevLead=j,this.lead=i,i.show(),j)){j.instance&&j.scheduleRender(),i.scheduleRender(),i.resumeFrom=j,d&&(i.resumeFrom.preserveOpacity=!0),j.snapshot&&(i.snapshot=j.snapshot,i.snapshot.latestValues=j.animationValues||j.latestValues),i.root&&i.root.isUpdating&&(i.isLayoutDirty=!0);const{crossfade:_e}=i.options;_e===!1&&j.hide()}}exitAnimationComplete(){this.members.forEach(i=>{const{options:d,resumingFrom:j}=i;d.onExitComplete&&d.onExitComplete(),j&&j.options.onExitComplete&&j.options.onExitComplete()})}scheduleRender(){this.members.forEach(i=>{i.instance&&i.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function buildProjectionTransform(e,i,d){let j="";const _e=e.x.translate/i.x,nt=e.y.translate/i.y,ct=(d==null?void 0:d.z)||0;if((_e||nt||ct)&&(j=`translate3d(${_e}px, ${nt}px, ${ct}px) `),(i.x!==1||i.y!==1)&&(j+=`scale(${1/i.x}, ${1/i.y}) `),d){const{transformPerspective:gt,rotate:St,rotateX:kt,rotateY:At,skewX:Nt,skewY:Vt}=d;gt&&(j=`perspective(${gt}px) ${j}`),St&&(j+=`rotate(${St}deg) `),kt&&(j+=`rotateX(${kt}deg) `),At&&(j+=`rotateY(${At}deg) `),Nt&&(j+=`skewX(${Nt}deg) `),Vt&&(j+=`skewY(${Vt}deg) `)}const c=e.x.scale*i.x,pt=e.y.scale*i.y;return(c!==1||pt!==1)&&(j+=`scale(${c}, ${pt})`),j||"none"}const transformAxes=["","X","Y","Z"],animationTarget=1e3;let id=0;function resetDistortingTransform(e,i,d,j){const{latestValues:_e}=i;_e[e]&&(d[e]=_e[e],i.setStaticValue(e,0),j&&(j[e]=0))}function cancelTreeOptimisedTransformAnimations(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:i}=e.options;if(!i)return;const d=getOptimisedAppearId(i);if(window.MotionHasOptimisedAnimation(d,"transform")){const{layout:_e,layoutId:nt}=e.options;window.MotionCancelOptimisedAnimation(d,"transform",frame,!(_e||nt))}const{parent:j}=e;j&&!j.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(j)}function createProjectionNode({attachResizeListener:e,defaultParent:i,measureScroll:d,checkIsScrollRoot:j,resetTransform:_e}){return class{constructor(ct={},c=i==null?void 0:i()){this.id=id++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.layoutVersion=0,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(propagateDirtyNodes),this.nodes.forEach(resolveTargetDelta),this.nodes.forEach(calcProjection),this.nodes.forEach(cleanDirtyNodes)},this.resolvedRelativeTargetAt=0,this.linkedParentVersion=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=ct,this.root=c?c.root||c:this,this.path=c?[...c.path,c]:[],this.parent=c,this.depth=c?c.depth+1:0;for(let pt=0;pt<this.path.length;pt++)this.path[pt].shouldResetTransform=!0;this.root===this&&(this.nodes=new FlatTree)}addEventListener(ct,c){return this.eventHandlers.has(ct)||this.eventHandlers.set(ct,new SubscriptionManager),this.eventHandlers.get(ct).add(c)}notifyListeners(ct,...c){const pt=this.eventHandlers.get(ct);pt&&pt.notify(...c)}hasListeners(ct){return this.eventHandlers.has(ct)}mount(ct){if(this.instance)return;this.isSVG=isSVGElement(ct)&&!isSVGSVGElement(ct),this.instance=ct;const{layoutId:c,layout:pt,visualElement:gt}=this.options;if(gt&&!gt.current&&gt.mount(ct),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(pt||c)&&(this.isLayoutDirty=!0),e){let St,kt=0;const At=()=>this.root.updateBlockedByResize=!1;frame.read(()=>{kt=window.innerWidth}),e(ct,()=>{const Nt=window.innerWidth;Nt!==kt&&(kt=Nt,this.root.updateBlockedByResize=!0,St&&St(),St=delay(At,250),globalProjectionState.hasAnimatedSinceResize&&(globalProjectionState.hasAnimatedSinceResize=!1,this.nodes.forEach(finishAnimation)))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&gt&&(c||pt)&&this.addEventListener("didUpdate",({delta:St,hasLayoutChanged:kt,hasRelativeLayoutChanged:At,layout:Nt})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Vt=this.options.transition||gt.getDefaultTransition()||defaultLayoutTransition,{onLayoutAnimationStart:zt,onLayoutAnimationComplete:Jt}=gt.getProps(),Dt=!this.targetLayout||!boxEqualsRounded(this.targetLayout,Nt),It=!kt&&At;if(this.options.layoutRoot||this.resumeFrom||It||kt&&(Dt||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Mt={...getValueTransition(Vt,"layout"),onPlay:zt,onComplete:Jt};(gt.shouldReduceMotion||this.options.layoutRoot)&&(Mt.delay=0,Mt.type=!1),this.startAnimation(Mt),this.setAnimationOrigin(St,It)}else kt||finishAnimation(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Nt})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const ct=this.getStack();ct&&ct.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),cancelFrame(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(resetSkewAndRotation),this.animationId++)}getTransformTemplate(){const{visualElement:ct}=this.options;return ct&&ct.getProps().transformTemplate}willUpdate(ct=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&cancelTreeOptimisedTransformAnimations(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let St=0;St<this.path.length;St++){const kt=this.path[St];kt.shouldResetTransform=!0,kt.updateScroll("snapshot"),kt.options.layoutRoot&&kt.willUpdate(!1)}const{layoutId:c,layout:pt}=this.options;if(c===void 0&&!pt)return;const gt=this.getTransformTemplate();this.prevTransformTemplateValue=gt?gt(this.latestValues,""):void 0,this.updateSnapshot(),ct&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(clearMeasurements);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(clearIsLayoutDirty);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(resetTransformStyle),this.nodes.forEach(updateLayout),this.nodes.forEach(notifyLayoutUpdate)):this.nodes.forEach(clearIsLayoutDirty),this.clearAllSnapshots();const c=time.now();frameData.delta=clamp(0,1e3/60,c-frameData.timestamp),frameData.timestamp=c,frameData.isProcessing=!0,frameSteps.update.process(frameData),frameSteps.preRender.process(frameData),frameSteps.render.process(frameData),frameData.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,microtask.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(clearSnapshot),this.sharedNodes.forEach(removeLeadSnapshots)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,frame.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){frame.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!calcLength(this.snapshot.measuredBox.x)&&!calcLength(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let pt=0;pt<this.path.length;pt++)this.path[pt].updateScroll();const ct=this.layout;this.layout=this.measure(!1),this.layoutVersion++,this.layoutCorrected=createBox(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:c}=this.options;c&&c.notify("LayoutMeasure",this.layout.layoutBox,ct?ct.layoutBox:void 0)}updateScroll(ct="measure"){let c=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===ct&&(c=!1),c&&this.instance){const pt=j(this.instance);this.scroll={animationId:this.root.animationId,phase:ct,isRoot:pt,offset:d(this.instance),wasRoot:this.scroll?this.scroll.isRoot:pt}}}resetTransform(){if(!_e)return;const ct=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,c=this.projectionDelta&&!isDeltaZero(this.projectionDelta),pt=this.getTransformTemplate(),gt=pt?pt(this.latestValues,""):void 0,St=gt!==this.prevTransformTemplateValue;ct&&this.instance&&(c||hasTransform(this.latestValues)||St)&&(_e(this.instance,gt),this.shouldResetTransform=!1,this.scheduleRender())}measure(ct=!0){const c=this.measurePageBox();let pt=this.removeElementScroll(c);return ct&&(pt=this.removeTransform(pt)),roundBox(pt),{animationId:this.root.animationId,measuredBox:c,layoutBox:pt,latestValues:{},source:this.id}}measurePageBox(){var gt;const{visualElement:ct}=this.options;if(!ct)return createBox();const c=ct.measureViewportBox();if(!(((gt=this.scroll)==null?void 0:gt.wasRoot)||this.path.some(checkNodeWasScrollRoot))){const{scroll:St}=this.root;St&&(translateAxis(c.x,St.offset.x),translateAxis(c.y,St.offset.y))}return c}removeElementScroll(ct){var pt;const c=createBox();if(copyBoxInto(c,ct),(pt=this.scroll)!=null&&pt.wasRoot)return c;for(let gt=0;gt<this.path.length;gt++){const St=this.path[gt],{scroll:kt,options:At}=St;St!==this.root&&kt&&At.layoutScroll&&(kt.wasRoot&&copyBoxInto(c,ct),translateAxis(c.x,kt.offset.x),translateAxis(c.y,kt.offset.y))}return c}applyTransform(ct,c=!1){const pt=createBox();copyBoxInto(pt,ct);for(let gt=0;gt<this.path.length;gt++){const St=this.path[gt];!c&&St.options.layoutScroll&&St.scroll&&St!==St.root&&transformBox(pt,{x:-St.scroll.offset.x,y:-St.scroll.offset.y}),hasTransform(St.latestValues)&&transformBox(pt,St.latestValues)}return hasTransform(this.latestValues)&&transformBox(pt,this.latestValues),pt}removeTransform(ct){const c=createBox();copyBoxInto(c,ct);for(let pt=0;pt<this.path.length;pt++){const gt=this.path[pt];if(!gt.instance||!hasTransform(gt.latestValues))continue;hasScale(gt.latestValues)&&gt.updateSnapshot();const St=createBox(),kt=gt.measurePageBox();copyBoxInto(St,kt),removeBoxTransforms(c,gt.latestValues,gt.snapshot?gt.snapshot.layoutBox:void 0,St)}return hasTransform(this.latestValues)&&removeBoxTransforms(c,this.latestValues),c}setTargetDelta(ct){this.targetDelta=ct,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(ct){this.options={...this.options,...ct,crossfade:ct.crossfade!==void 0?ct.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==frameData.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(ct=!1){var Nt;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const pt=!!this.resumingFrom||this!==c;if(!(ct||pt&&this.isSharedProjectionDirty||this.isProjectionDirty||(Nt=this.parent)!=null&&Nt.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:St,layoutId:kt}=this.options;if(!this.layout||!(St||kt))return;this.resolvedRelativeTargetAt=frameData.timestamp;const At=this.getClosestProjectingParent();At&&this.linkedParentVersion!==At.layoutVersion&&!At.options.layoutRoot&&this.removeRelativeTarget(),!this.targetDelta&&!this.relativeTarget&&(At&&At.layout?this.createRelativeTarget(At,this.layout.layoutBox,At.layout.layoutBox):this.removeRelativeTarget()),!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=createBox(),this.targetWithTransforms=createBox()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),calcRelativeBox(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):copyBoxInto(this.target,this.layout.layoutBox),applyBoxDelta(this.target,this.targetDelta)):copyBoxInto(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget&&(this.attemptToResolveRelativeTarget=!1,At&&!!At.resumingFrom==!!this.resumingFrom&&!At.options.layoutScroll&&At.target&&this.animationProgress!==1?this.createRelativeTarget(At,this.target,At.target):this.relativeParent=this.relativeTarget=void 0))}getClosestProjectingParent(){if(!(!this.parent||hasScale(this.parent.latestValues)||has2DTranslate(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}createRelativeTarget(ct,c,pt){this.relativeParent=ct,this.linkedParentVersion=ct.layoutVersion,this.forceRelativeParentToResolveTarget(),this.relativeTarget=createBox(),this.relativeTargetOrigin=createBox(),calcRelativePosition(this.relativeTargetOrigin,c,pt),copyBoxInto(this.relativeTarget,this.relativeTargetOrigin)}removeRelativeTarget(){this.relativeParent=this.relativeTarget=void 0}calcProjection(){var Vt;const ct=this.getLead(),c=!!this.resumingFrom||this!==ct;let pt=!0;if((this.isProjectionDirty||(Vt=this.parent)!=null&&Vt.isProjectionDirty)&&(pt=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(pt=!1),this.resolvedRelativeTargetAt===frameData.timestamp&&(pt=!1),pt)return;const{layout:gt,layoutId:St}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(gt||St))return;copyBoxInto(this.layoutCorrected,this.layout.layoutBox);const kt=this.treeScale.x,At=this.treeScale.y;applyTreeDeltas(this.layoutCorrected,this.treeScale,this.path,c),ct.layout&&!ct.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(ct.target=ct.layout.layoutBox,ct.targetWithTransforms=createBox());const{target:Nt}=ct;if(!Nt){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(copyAxisDeltaInto(this.prevProjectionDelta.x,this.projectionDelta.x),copyAxisDeltaInto(this.prevProjectionDelta.y,this.projectionDelta.y)),calcBoxDelta(this.projectionDelta,this.layoutCorrected,Nt,this.latestValues),(this.treeScale.x!==kt||this.treeScale.y!==At||!axisDeltaEquals(this.projectionDelta.x,this.prevProjectionDelta.x)||!axisDeltaEquals(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Nt))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(ct=!0){var c;if((c=this.options.visualElement)==null||c.scheduleRender(),ct){const pt=this.getStack();pt&&pt.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=createDelta(),this.projectionDelta=createDelta(),this.projectionDeltaWithTransform=createDelta()}setAnimationOrigin(ct,c=!1){const pt=this.snapshot,gt=pt?pt.latestValues:{},St={...this.latestValues},kt=createDelta();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!c;const At=createBox(),Nt=pt?pt.source:void 0,Vt=this.layout?this.layout.source:void 0,zt=Nt!==Vt,Jt=this.getStack(),Dt=!Jt||Jt.members.length<=1,It=!!(zt&&!Dt&&this.options.crossfade===!0&&!this.path.some(hasOpacityCrossfade));this.animationProgress=0;let Mt;this.mixTargetDelta=Ht=>{const tr=Ht/1e3;mixAxisDelta(kt.x,ct.x,tr),mixAxisDelta(kt.y,ct.y,tr),this.setTargetDelta(kt),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(calcRelativePosition(At,this.layout.layoutBox,this.relativeParent.layout.layoutBox),mixBox(this.relativeTarget,this.relativeTargetOrigin,At,tr),Mt&&boxEquals(this.relativeTarget,Mt)&&(this.isProjectionDirty=!1),Mt||(Mt=createBox()),copyBoxInto(Mt,this.relativeTarget)),zt&&(this.animationValues=St,mixValues(St,gt,this.latestValues,tr,It,Dt)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=tr},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(ct){var c,pt,gt;this.notifyListeners("animationStart"),(c=this.currentAnimation)==null||c.stop(),(gt=(pt=this.resumingFrom)==null?void 0:pt.currentAnimation)==null||gt.stop(),this.pendingAnimation&&(cancelFrame(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=frame.update(()=>{globalProjectionState.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=motionValue(0)),this.currentAnimation=animateSingleValue(this.motionValue,[0,1e3],{...ct,velocity:0,isSync:!0,onUpdate:St=>{this.mixTargetDelta(St),ct.onUpdate&&ct.onUpdate(St)},onStop:()=>{},onComplete:()=>{ct.onComplete&&ct.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const ct=this.getStack();ct&&ct.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(animationTarget),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const ct=this.getLead();let{targetWithTransforms:c,target:pt,layout:gt,latestValues:St}=ct;if(!(!c||!pt||!gt)){if(this!==ct&&this.layout&&gt&&shouldAnimatePositionOnly(this.options.animationType,this.layout.layoutBox,gt.layoutBox)){pt=this.target||createBox();const kt=calcLength(this.layout.layoutBox.x);pt.x.min=ct.target.x.min,pt.x.max=pt.x.min+kt;const At=calcLength(this.layout.layoutBox.y);pt.y.min=ct.target.y.min,pt.y.max=pt.y.min+At}copyBoxInto(c,pt),transformBox(c,St),calcBoxDelta(this.projectionDeltaWithTransform,this.layoutCorrected,c,St)}}registerSharedNode(ct,c){this.sharedNodes.has(ct)||this.sharedNodes.set(ct,new NodeStack),this.sharedNodes.get(ct).add(c);const gt=c.options.initialPromotionConfig;c.promote({transition:gt?gt.transition:void 0,preserveFollowOpacity:gt&&gt.shouldPreserveFollowOpacity?gt.shouldPreserveFollowOpacity(c):void 0})}isLead(){const ct=this.getStack();return ct?ct.lead===this:!0}getLead(){var c;const{layoutId:ct}=this.options;return ct?((c=this.getStack())==null?void 0:c.lead)||this:this}getPrevLead(){var c;const{layoutId:ct}=this.options;return ct?(c=this.getStack())==null?void 0:c.prevLead:void 0}getStack(){const{layoutId:ct}=this.options;if(ct)return this.root.sharedNodes.get(ct)}promote({needsReset:ct,transition:c,preserveFollowOpacity:pt}={}){const gt=this.getStack();gt&&gt.promote(this,pt),ct&&(this.projectionDelta=void 0,this.needsReset=!0),c&&this.setOptions({transition:c})}relegate(){const ct=this.getStack();return ct?ct.relegate(this):!1}resetSkewAndRotation(){const{visualElement:ct}=this.options;if(!ct)return;let c=!1;const{latestValues:pt}=ct;if((pt.z||pt.rotate||pt.rotateX||pt.rotateY||pt.rotateZ||pt.skewX||pt.skewY)&&(c=!0),!c)return;const gt={};pt.z&&resetDistortingTransform("z",ct,gt,this.animationValues);for(let St=0;St<transformAxes.length;St++)resetDistortingTransform(`rotate${transformAxes[St]}`,ct,gt,this.animationValues),resetDistortingTransform(`skew${transformAxes[St]}`,ct,gt,this.animationValues);ct.render();for(const St in gt)ct.setStaticValue(St,gt[St]),this.animationValues&&(this.animationValues[St]=gt[St]);ct.scheduleRender()}applyProjectionStyles(ct,c){if(!this.instance||this.isSVG)return;if(!this.isVisible){ct.visibility="hidden";return}const pt=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,ct.visibility="",ct.opacity="",ct.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||"",ct.transform=pt?pt(this.latestValues,""):"none";return}const gt=this.getLead();if(!this.projectionDelta||!this.layout||!gt.target){this.options.layoutId&&(ct.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,ct.pointerEvents=resolveMotionValue(c==null?void 0:c.pointerEvents)||""),this.hasProjected&&!hasTransform(this.latestValues)&&(ct.transform=pt?pt({},""):"none",this.hasProjected=!1);return}ct.visibility="";const St=gt.animationValues||gt.latestValues;this.applyTransformsToTarget();let kt=buildProjectionTransform(this.projectionDeltaWithTransform,this.treeScale,St);pt&&(kt=pt(St,kt)),ct.transform=kt;const{x:At,y:Nt}=this.projectionDelta;ct.transformOrigin=`${At.origin*100}% ${Nt.origin*100}% 0`,gt.animationValues?ct.opacity=gt===this?St.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:St.opacityExit:ct.opacity=gt===this?St.opacity!==void 0?St.opacity:"":St.opacityExit!==void 0?St.opacityExit:0;for(const Vt in scaleCorrectors){if(St[Vt]===void 0)continue;const{correct:zt,applyTo:Jt,isCSSVariable:Dt}=scaleCorrectors[Vt],It=kt==="none"?St[Vt]:zt(St[Vt],gt);if(Jt){const Mt=Jt.length;for(let Ht=0;Ht<Mt;Ht++)ct[Jt[Ht]]=It}else Dt?this.options.visualElement.renderState.vars[Vt]=It:ct[Vt]=It}this.options.layoutId&&(ct.pointerEvents=gt===this?resolveMotionValue(c==null?void 0:c.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(ct=>{var c;return(c=ct.currentAnimation)==null?void 0:c.stop()}),this.root.nodes.forEach(clearMeasurements),this.root.sharedNodes.clear()}}}function updateLayout(e){e.updateLayout()}function notifyLayoutUpdate(e){var d;const i=((d=e.resumeFrom)==null?void 0:d.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&i&&e.hasListeners("didUpdate")){const{layoutBox:j,measuredBox:_e}=e.layout,{animationType:nt}=e.options,ct=i.source!==e.layout.source;nt==="size"?eachAxis(kt=>{const At=ct?i.measuredBox[kt]:i.layoutBox[kt],Nt=calcLength(At);At.min=j[kt].min,At.max=At.min+Nt}):shouldAnimatePositionOnly(nt,i.layoutBox,j)&&eachAxis(kt=>{const At=ct?i.measuredBox[kt]:i.layoutBox[kt],Nt=calcLength(j[kt]);At.max=At.min+Nt,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[kt].max=e.relativeTarget[kt].min+Nt)});const c=createDelta();calcBoxDelta(c,j,i.layoutBox);const pt=createDelta();ct?calcBoxDelta(pt,e.applyTransform(_e,!0),i.measuredBox):calcBoxDelta(pt,j,i.layoutBox);const gt=!isDeltaZero(c);let St=!1;if(!e.resumeFrom){const kt=e.getClosestProjectingParent();if(kt&&!kt.resumeFrom){const{snapshot:At,layout:Nt}=kt;if(At&&Nt){const Vt=createBox();calcRelativePosition(Vt,i.layoutBox,At.layoutBox);const zt=createBox();calcRelativePosition(zt,j,Nt.layoutBox),boxEqualsRounded(Vt,zt)||(St=!0),kt.options.layoutRoot&&(e.relativeTarget=zt,e.relativeTargetOrigin=Vt,e.relativeParent=kt)}}}e.notifyListeners("didUpdate",{layout:j,snapshot:i,delta:pt,layoutDelta:c,hasLayoutChanged:gt,hasRelativeLayoutChanged:St})}else if(e.isLead()){const{onExitComplete:j}=e.options;j&&j()}e.options.transition=void 0}function propagateDirtyNodes(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function cleanDirtyNodes(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function clearSnapshot(e){e.clearSnapshot()}function clearMeasurements(e){e.clearMeasurements()}function clearIsLayoutDirty(e){e.isLayoutDirty=!1}function resetTransformStyle(e){const{visualElement:i}=e.options;i&&i.getProps().onBeforeLayoutMeasure&&i.notify("BeforeLayoutMeasure"),e.resetTransform()}function finishAnimation(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function resolveTargetDelta(e){e.resolveTargetDelta()}function calcProjection(e){e.calcProjection()}function resetSkewAndRotation(e){e.resetSkewAndRotation()}function removeLeadSnapshots(e){e.removeLeadSnapshot()}function mixAxisDelta(e,i,d){e.translate=mixNumber$1(i.translate,0,d),e.scale=mixNumber$1(i.scale,1,d),e.origin=i.origin,e.originPoint=i.originPoint}function mixAxis(e,i,d,j){e.min=mixNumber$1(i.min,d.min,j),e.max=mixNumber$1(i.max,d.max,j)}function mixBox(e,i,d,j){mixAxis(e.x,i.x,d.x,j),mixAxis(e.y,i.y,d.y,j)}function hasOpacityCrossfade(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const defaultLayoutTransition={duration:.45,ease:[.4,0,.1,1]},userAgentContains=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),roundPoint=userAgentContains("applewebkit/")&&!userAgentContains("chrome/")?Math.round:noop$1;function roundAxis(e){e.min=roundPoint(e.min),e.max=roundPoint(e.max)}function roundBox(e){roundAxis(e.x),roundAxis(e.y)}function shouldAnimatePositionOnly(e,i,d){return e==="position"||e==="preserve-aspect"&&!isNear(aspectRatio(i),aspectRatio(d),.2)}function checkNodeWasScrollRoot(e){var i;return e!==e.root&&((i=e.scroll)==null?void 0:i.wasRoot)}const DocumentProjectionNode=createProjectionNode({attachResizeListener:(e,i)=>addDomEvent(e,"resize",i),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),rootProjectionNode={current:void 0},HTMLProjectionNode=createProjectionNode({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!rootProjectionNode.current){const e=new DocumentProjectionNode({});e.mount(window),e.setOptions({layoutScroll:!0}),rootProjectionNode.current=e}return rootProjectionNode.current},resetTransform:(e,i)=>{e.style.transform=i!==void 0?i:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),drag={pan:{Feature:PanGesture},drag:{Feature:DragGesture,ProjectionNode:HTMLProjectionNode,MeasureLayout}};function handleHoverEvent(e,i,d){const{props:j}=e;e.animationState&&j.whileHover&&e.animationState.setActive("whileHover",d==="Start");const _e="onHover"+d,nt=j[_e];nt&&frame.postRender(()=>nt(i,extractEventInfo(i)))}class HoverGesture extends Feature{mount(){const{current:i}=this.node;i&&(this.unmount=hover(i,(d,j)=>(handleHoverEvent(this.node,j,"Start"),_e=>handleHoverEvent(this.node,_e,"End"))))}unmount(){}}class FocusGesture extends Feature{constructor(){super(...arguments),this.isActive=!1}onFocus(){let i=!1;try{i=this.node.current.matches(":focus-visible")}catch{i=!0}!i||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=pipe(addDomEvent(this.node.current,"focus",()=>this.onFocus()),addDomEvent(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function handlePressEvent(e,i,d){const{props:j}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&j.whileTap&&e.animationState.setActive("whileTap",d==="Start");const _e="onTap"+(d==="End"?"":d),nt=j[_e];nt&&frame.postRender(()=>nt(i,extractEventInfo(i)))}class PressGesture extends Feature{mount(){const{current:i}=this.node;i&&(this.unmount=press(i,(d,j)=>(handlePressEvent(this.node,j,"Start"),(_e,{success:nt})=>handlePressEvent(this.node,_e,nt?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const observerCallbacks=new WeakMap,observers=new WeakMap,fireObserverCallback=e=>{const i=observerCallbacks.get(e.target);i&&i(e)},fireAllObserverCallbacks=e=>{e.forEach(fireObserverCallback)};function initIntersectionObserver({root:e,...i}){const d=e||document;observers.has(d)||observers.set(d,{});const j=observers.get(d),_e=JSON.stringify(i);return j[_e]||(j[_e]=new IntersectionObserver(fireAllObserverCallbacks,{root:e,...i})),j[_e]}function observeIntersection(e,i,d){const j=initIntersectionObserver(i);return observerCallbacks.set(e,d),j.observe(e),()=>{observerCallbacks.delete(e),j.unobserve(e)}}const thresholdNames={some:0,all:1};class InViewFeature extends Feature{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:i={}}=this.node.getProps(),{root:d,margin:j,amount:_e="some",once:nt}=i,ct={root:d?d.current:void 0,rootMargin:j,threshold:typeof _e=="number"?_e:thresholdNames[_e]},c=pt=>{const{isIntersecting:gt}=pt;if(this.isInView===gt||(this.isInView=gt,nt&&!gt&&this.hasEnteredView))return;gt&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",gt);const{onViewportEnter:St,onViewportLeave:kt}=this.node.getProps(),At=gt?St:kt;At&&At(pt)};return observeIntersection(this.node.current,ct,c)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:i,prevProps:d}=this.node;["amount","margin","root"].some(hasViewportOptionChanged(i,d))&&this.startObserver()}unmount(){}}function hasViewportOptionChanged({viewport:e={}},{viewport:i={}}={}){return d=>e[d]!==i[d]}const gestureAnimations={inView:{Feature:InViewFeature},tap:{Feature:PressGesture},focus:{Feature:FocusGesture},hover:{Feature:HoverGesture}},layout={layout:{ProjectionNode:HTMLProjectionNode,MeasureLayout}},featureBundle={...animations,...gestureAnimations,...drag,...layout},motion=createMotionProxy(featureBundle,createDomVisualElement),atas="/assets/atas%20(2)-DcjxWp4T.png",bawah="/assets/bawah%20(2)-DMBmOxUu.png",SplashScreen=()=>{console.log(" SplashScreen component rendering");const e=useNavigate();reactExports.useEffect(()=>{localStorage.removeItem("redirectAfterLogin");const j=setTimeout(()=>{e("/login")},3e3);return()=>clearTimeout(j)},[e]);const i={opacity:[0,1,0],scale:[.5,1.2,.5],transition:{duration:2,repeat:1/0,repeatType:"reverse",ease:"easeInOut"}},d={y:[0,-10,0],transition:{duration:2,repeat:1/0,repeatType:"loop",ease:"easeInOut"}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen w-full flex flex-col items-center justify-center bg-[#3AC36C] relative overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:atas,alt:"",className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-40 h-28 z-20",style:{filter:"brightness(0) invert(1)"}}),jsxRuntimeExports.jsx("img",{src:bawah,alt:"",className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-40 h-28 z-20",style:{filter:"brightness(0) invert(1)"}}),jsxRuntimeExports.jsx("div",{className:"relative z-30 flex flex-col items-center",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs(motion.div,{className:"absolute inset-0 pointer-events-none",animate:i,children:[jsxRuntimeExports.jsx("div",{className:"absolute top-2 left-2 w-1 h-1 bg-white rounded-full opacity-30"}),jsxRuntimeExports.jsx("div",{className:"absolute top-4 right-3 w-1 h-1 bg-white rounded-full opacity-20"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-3 left-4 w-1 h-1 bg-white rounded-full opacity-25"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-2 right-2 w-1 h-1 bg-white rounded-full opacity-15"}),jsxRuntimeExports.jsx("div",{className:"absolute top-1/2 left-1 w-1 h-1 bg-white rounded-full opacity-10"}),jsxRuntimeExports.jsx("div",{className:"absolute top-1/3 right-1 w-1 h-1 bg-white rounded-full opacity-20"})]}),jsxRuntimeExports.jsx(motion.img,{src:"/logo-white.png",alt:"FuelFriendly Logo",className:"w-48 h-32 relative z-10",style:{transform:"rotate(360deg)"},animate:d})]})})]})},AppContext=reactExports.createContext(null),useAppContext=()=>{const e=reactExports.useContext(AppContext);if(!e)throw new Error("useAppContext must be used within an AppProvider");return e},Button=reactExports.forwardRef(({variant:e="primary",size:i="md",isLoading:d=!1,children:j,className:_e="",disabled:nt,...ct},c)=>{const pt="inline-flex items-center justify-center rounded-full font-semibold transition-all duration-200 ease-out transform focus:outline-none focus:ring-2 focus:ring-offset-2 select-none ios-button active:scale-95 hover:shadow-lg active:shadow-md",gt=Nt=>{var Vt;!nt&&!d&&navigator.vibrate&&navigator.vibrate(20),(Vt=ct.onClick)==null||Vt.call(ct,Nt)},St={primary:"bg-[#3AC36C] text-white hover:bg-[#2ea85a] hover:scale-105 focus:ring-[#3AC36C]/50 disabled:opacity-50 shadow-md hover:shadow-xl transition-shadow",secondary:"bg-gray-200 text-gray-800 hover:bg-gray-300 hover:scale-105 focus:ring-gray-300 disabled:opacity-50 shadow-sm hover:shadow-lg",outline:"border-2 border-[#3AC36C] bg-transparent text-[#3AC36C] hover:bg-[#3AC36C] hover:text-white hover:scale-105 focus:ring-[#3AC36C]/50 disabled:opacity-50 shadow-sm hover:shadow-md",ghost:"bg-transparent text-[#3AC36C] hover:bg-[#3AC36C]/10 hover:scale-105 focus:ring-[#3AC36C]/50 disabled:opacity-50",link:"bg-transparent text-[#3AC36C] underline hover:text-[#2ea85a] hover:scale-105 focus:ring-[#3AC36C]/50 disabled:opacity-50"},kt={sm:"text-sm py-2 px-4",md:"text-base py-3 px-6",lg:"text-lg py-4 px-8"},At=nt||d;return jsxRuntimeExports.jsxs("button",{ref:c,className:`${pt} ${St[e]} ${kt[i]} ${_e} ${At?"cursor-not-allowed":"cursor-pointer"}`,disabled:At,onClick:gt,...ct,children:[d&&jsxRuntimeExports.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),j]})});Button.displayName="Button";const LoginScreen=()=>{const e=useNavigate(),{loginWithGoogle:i}=useAppContext(),[d,j]=reactExports.useState(!1);reactExports.useEffect(()=>(document.body.classList.add("login-screen"),()=>{document.body.classList.remove("login-screen")}),[]);const _e=async()=>{try{j(!0),await i();const nt=localStorage.getItem("redirectAfterLogin"),ct=sessionStorage.getItem("pendingCheckout");if(ct&&nt==="/payment"){localStorage.removeItem("redirectAfterLogin"),sessionStorage.removeItem("pendingCheckout");const c=JSON.parse(ct);e("/payment",{state:c})}else nt?(localStorage.removeItem("redirectAfterLogin"),e(nt)):e("/home")}catch(nt){console.error("Google login error:",nt)}finally{j(!1)}};return jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center relative overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:"/Rectangle 3364.svg",alt:"",className:"absolute top-0 left-0 w-full h-auto object-cover"}),jsxRuntimeExports.jsx("img",{src:"/Rectangle 3365.png",alt:"",className:"absolute bottom-0 right-0 w-full h-auto object-cover"}),jsxRuntimeExports.jsx("img",{src:"/hexagon.png",alt:"",className:"absolute bottom-0 left-1/2 transform -translate-x-1/2 w-80 h-56 z-20"}),jsxRuntimeExports.jsx("div",{className:"w-full max-w-md mx-auto px-4 py-6 relative z-10 -mt-16",children:jsxRuntimeExports.jsxs("div",{className:"w-full space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center text-center space-y-2",children:jsxRuntimeExports.jsx("img",{src:"/logo terbaru.png",alt:"Logo",className:"w-64 h-auto aspect-square object-contain"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx(Button,{onClick:()=>e("/login-form"),variant:"primary",className:"w-full py-4 text-lg font-semibold",children:"Log In"}),jsxRuntimeExports.jsx(Button,{onClick:()=>e("/register"),variant:"secondary",className:"w-full py-4 text-lg font-semibold",children:"Sign up"}),jsxRuntimeExports.jsxs("div",{className:"relative my-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center",children:jsxRuntimeExports.jsx("div",{className:"w-full border-t border-gray-300"})}),jsxRuntimeExports.jsx("div",{className:"relative flex justify-center text-sm",children:jsxRuntimeExports.jsx("span",{className:"px-4 bg-white text-gray-500 font-medium",children:"Or"})})]}),jsxRuntimeExports.jsxs(Button,{onClick:_e,variant:"outline",className:"w-full py-4 text-lg font-semibold flex items-center justify-center gap-2",disabled:d,children:[jsxRuntimeExports.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),jsxRuntimeExports.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),jsxRuntimeExports.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),jsxRuntimeExports.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),d?"Connecting...":"Continue with Google"]})]})]})})]})};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const toKebabCase=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),mergeClasses=(...e)=>e.filter((i,d,j)=>!!i&&i.trim()!==""&&j.indexOf(i)===d).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var defaultAttributes={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Icon=reactExports.forwardRef(({color:e="currentColor",size:i=24,strokeWidth:d=2,absoluteStrokeWidth:j,className:_e="",children:nt,iconNode:ct,...c},pt)=>reactExports.createElement("svg",{ref:pt,...defaultAttributes,width:i,height:i,stroke:e,strokeWidth:j?Number(d)*24/Number(i):d,className:mergeClasses("lucide",_e),...c},[...ct.map(([gt,St])=>reactExports.createElement(gt,St)),...Array.isArray(nt)?nt:[nt]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const createLucideIcon=(e,i)=>{const d=reactExports.forwardRef(({className:j,..._e},nt)=>reactExports.createElement(Icon,{ref:nt,iconNode:i,className:mergeClasses(`lucide-${toKebabCase(e)}`,j),..._e}));return d.displayName=`${e}`,d};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ArrowLeft=createLucideIcon("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Bell=createLucideIcon("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Calculator=createLucideIcon("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Camera=createLucideIcon("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Check=createLucideIcon("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronDown=createLucideIcon("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronLeft=createLucideIcon("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ChevronRight=createLucideIcon("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleAlert=createLucideIcon("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleCheckBig=createLucideIcon("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleHelp=createLucideIcon("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CircleX=createLucideIcon("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Clock=createLucideIcon("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CreditCard=createLucideIcon("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DollarSign=createLucideIcon("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Download=createLucideIcon("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EllipsisVertical=createLucideIcon("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EyeOff=createLucideIcon("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eye=createLucideIcon("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FileText=createLucideIcon("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Fuel=createLucideIcon("Fuel",[["line",{x1:"3",x2:"15",y1:"22",y2:"22",key:"xegly4"}],["line",{x1:"4",x2:"14",y1:"9",y2:"9",key:"xcnuvu"}],["path",{d:"M14 22V4a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v18",key:"16j0yd"}],["path",{d:"M14 13h2a2 2 0 0 1 2 2v2a2 2 0 0 0 2 2a2 2 0 0 0 2-2V9.83a2 2 0 0 0-.59-1.42L18 5",key:"7cu91f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Image$1=createLucideIcon("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Info=createLucideIcon("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lock=createLucideIcon("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LogOut=createLucideIcon("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mail=createLucideIcon("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MapPin=createLucideIcon("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageCircle=createLucideIcon("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MessageSquare=createLucideIcon("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mic=createLucideIcon("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Minus=createLucideIcon("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Moon=createLucideIcon("Moon",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z",key:"a7tn18"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Navigation=createLucideIcon("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Phone=createLucideIcon("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Plus=createLucideIcon("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Printer=createLucideIcon("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Search=createLucideIcon("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Send=createLucideIcon("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Settings=createLucideIcon("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Shield=createLucideIcon("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ShoppingBag=createLucideIcon("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SlidersHorizontal=createLucideIcon("SlidersHorizontal",[["line",{x1:"21",x2:"14",y1:"4",y2:"4",key:"obuewd"}],["line",{x1:"10",x2:"3",y1:"4",y2:"4",key:"1q6298"}],["line",{x1:"21",x2:"12",y1:"12",y2:"12",key:"1iu8h1"}],["line",{x1:"8",x2:"3",y1:"12",y2:"12",key:"ntss68"}],["line",{x1:"21",x2:"16",y1:"20",y2:"20",key:"14d8ph"}],["line",{x1:"12",x2:"3",y1:"20",y2:"20",key:"m0wm8r"}],["line",{x1:"14",x2:"14",y1:"2",y2:"6",key:"14e1ph"}],["line",{x1:"8",x2:"8",y1:"10",y2:"14",key:"1i6ji0"}],["line",{x1:"16",x2:"16",y1:"18",y2:"22",key:"1lctlv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SquarePen=createLucideIcon("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Star=createLucideIcon("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sun=createLucideIcon("Sun",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"M12 20v2",key:"1lh1kg"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"m17.66 17.66 1.41 1.41",key:"ptbguv"}],["path",{d:"M2 12h2",key:"1t8f8n"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m6.34 17.66-1.41 1.41",key:"1m8zz5"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Trash2=createLucideIcon("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TrendingUp=createLucideIcon("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TriangleAlert=createLucideIcon("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Truck=createLucideIcon("Truck",[["path",{d:"M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2",key:"wrbu53"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["path",{d:"M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14",key:"lysw3i"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Upload=createLucideIcon("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const User=createLucideIcon("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=createLucideIcon("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zap=createLucideIcon("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),LoginFormScreen=()=>{const e=useNavigate(),{login:i,loginWithGoogle:d}=useAppContext(),[j,_e]=reactExports.useState(!1),[nt,ct]=reactExports.useState(""),[c,pt]=reactExports.useState(""),[gt,St]=reactExports.useState(!1),[kt,At]=reactExports.useState("");reactExports.useEffect(()=>(document.body.classList.add("login-screen"),()=>{document.body.classList.remove("login-screen")}),[]);const Nt=async zt=>{zt.preventDefault(),At(""),St(!0);try{await i(nt,c);const Jt=localStorage.getItem("redirectAfterLogin"),Dt=sessionStorage.getItem("pendingCheckout");if(Dt&&Jt==="/payment"){localStorage.removeItem("redirectAfterLogin"),sessionStorage.removeItem("pendingCheckout");const It=JSON.parse(Dt);e("/payment",{state:It})}else Jt?(localStorage.removeItem("redirectAfterLogin"),e(Jt)):e("/home")}catch(Jt){At(Jt.message||"Invalid email or password")}finally{St(!1)}},Vt=async()=>{try{St(!0),await d();const zt=localStorage.getItem("redirectAfterLogin");zt?(localStorage.removeItem("redirectAfterLogin"),e(zt)):e("/home")}catch(zt){At((zt==null?void 0:zt.message)||"Google login failed.")}finally{St(!1)}};return jsxRuntimeExports.jsxs("div",{className:"relative w-full max-w-[402px] mx-auto min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("div",{className:"px-4 pt-6 pb-8",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-8",children:jsxRuntimeExports.jsx("img",{src:"/logo terbaru.png",alt:"FuelFriendly",className:"w-[150px] h-auto aspect-square object-contain"})}),jsxRuntimeExports.jsx("div",{className:"text-center mb-6",children:jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-[#3F4249]",children:"Sign In"})}),kt&&jsxRuntimeExports.jsx("div",{className:"w-full bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:kt})}),jsxRuntimeExports.jsxs("form",{onSubmit:Nt,className:"space-y-4",autoComplete:"off",children:[jsxRuntimeExports.jsx("div",{className:"w-full h-10 rounded-[30px] border border-black/50 px-4 flex items-center justify-center text-[#3F4249] bg-white text-sm font-bold",children:"Customer"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Email or phone number",value:nt,onChange:zt=>ct(zt.target.value),className:"w-full py-4 px-6 rounded-full border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] placeholder-gray-400 text-base transition-all duration-200",required:!0,autoComplete:"off",autoCorrect:"off",spellCheck:"false"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:j?"text":"password",placeholder:"Password",value:c,onChange:zt=>pt(zt.target.value),className:"w-full py-4 px-6 pr-14 rounded-full border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] placeholder-gray-400 text-base transition-all duration-200",required:!0,autoComplete:"new-password"}),jsxRuntimeExports.jsx("button",{type:"button",className:"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 p-1",onClick:()=>_e(!j),children:j?jsxRuntimeExports.jsx(EyeOff,{size:20}):jsxRuntimeExports.jsx(Eye,{size:20})})]}),jsxRuntimeExports.jsx("div",{className:"text-right",children:jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>e("/forgot-password"),className:"text-[#FF6B6B] text-sm hover:underline",children:"Forgotten Password"})}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg mt-6",isLoading:gt,disabled:gt,children:gt?"Logging in...":"Log In"}),jsxRuntimeExports.jsxs("div",{className:"relative my-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center",children:jsxRuntimeExports.jsx("div",{className:"w-full border-t border-gray-300"})}),jsxRuntimeExports.jsx("div",{className:"relative flex justify-center text-sm",children:jsxRuntimeExports.jsx("span",{className:"px-4 bg-white text-gray-500 font-medium",children:"Or"})})]}),jsxRuntimeExports.jsxs(Button,{type:"button",variant:"outline",size:"md",className:"w-full py-4 rounded-full flex items-center justify-center gap-3 shadow-md",onClick:Vt,disabled:gt,isLoading:gt,children:[jsxRuntimeExports.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),jsxRuntimeExports.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),jsxRuntimeExports.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),jsxRuntimeExports.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),gt?"Connecting...":"Continue with Google"]})]})]}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-1/2 -translate-x-1/2 w-32 h-1 bg-[#101010] rounded-full mb-2"})]})},AnimatedPage=({children:e})=>jsxRuntimeExports.jsx("div",{children:e});var lottie$1={exports:{}};(function(module,exports$1){typeof document<"u"&&typeof navigator<"u"&&function(e,i){module.exports=i()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(i){_useWebWorker=!!i},getWebWorker=function(){return _useWebWorker},setLocationHref=function(i){locationHref=i},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,i){var d,j=e.length,_e;for(d=0;d<j;d+=1){_e=e[d].prototype;for(var nt in _e)Object.prototype.hasOwnProperty.call(_e,nt)&&(i.prototype[nt]=_e[nt])}}function getDescriptor(e,i){return Object.getOwnPropertyDescriptor(e,i)}function createProxyFunction(e){function i(){}return i.prototype=e,i}var audioControllerFactory=function(){function e(i){this.audios=[],this.audioFactory=i,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(d){this.audios.push(d)},pause:function(){var d,j=this.audios.length;for(d=0;d<j;d+=1)this.audios[d].pause()},resume:function(){var d,j=this.audios.length;for(d=0;d<j;d+=1)this.audios[d].resume()},setRate:function(d){var j,_e=this.audios.length;for(j=0;j<_e;j+=1)this.audios[j].setRate(d)},createAudio:function(d){return this.audioFactory?this.audioFactory(d):window.Howl?new window.Howl({src:[d]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(d){this.audioFactory=d},setVolume:function(d){this._volume=d,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var d,j=this.audios.length;for(d=0;d<j;d+=1)this.audios[d].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(d,j){var _e=0,nt=[],ct;switch(d){case"int16":case"uint8c":ct=1;break;default:ct=1.1;break}for(_e=0;_e<j;_e+=1)nt.push(ct);return nt}function i(d,j){return d==="float32"?new Float32Array(j):d==="int16"?new Int16Array(j):d==="uint8c"?new Uint8ClampedArray(j):e(d,j)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?i:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return _typeof$6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],i,d=e.length;for(i=0;i<d;i+=1)BMMath[e[i]]=Math[e[i]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var i=_typeof$6(e);if(i==="object"&&e.length){var d=createSizedArray(e.length),j,_e=e.length;for(j=0;j<_e;j+=1)d[j]=Math.abs(e[j]);return d}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,i,d,j){this.type=e,this.currentTime=i,this.totalTime=d,this.direction=j<0?-1:1}function BMCompleteEvent(e,i){this.type=e,this.direction=i<0?-1:1}function BMCompleteLoopEvent(e,i,d,j){this.type=e,this.currentLoop=d,this.totalLoops=i,this.direction=j<0?-1:1}function BMSegmentStartEvent(e,i,d){this.type=e,this.firstFrame=i,this.totalFrames=d}function BMDestroyEvent(e,i){this.type=e,this.target=i}function BMRenderFrameErrorEvent(e,i){this.type="renderFrameError",this.nativeError=e,this.currentTime=i}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,i,d){var j,_e,nt,ct,c,pt,gt,St;switch(ct=Math.floor(e*6),c=e*6-ct,pt=d*(1-i),gt=d*(1-c*i),St=d*(1-(1-c)*i),ct%6){case 0:j=d,_e=St,nt=pt;break;case 1:j=gt,_e=d,nt=pt;break;case 2:j=pt,_e=d,nt=St;break;case 3:j=pt,_e=gt,nt=d;break;case 4:j=St,_e=pt,nt=d;break;case 5:j=d,_e=pt,nt=gt;break}return[j,_e,nt]}function RGBtoHSV(e,i,d){var j=Math.max(e,i,d),_e=Math.min(e,i,d),nt=j-_e,ct,c=j===0?0:nt/j,pt=j/255;switch(j){case _e:ct=0;break;case e:ct=i-d+nt*(i<d?6:0),ct/=6*nt;break;case i:ct=d-e+nt*2,ct/=6*nt;break;case d:ct=e-i+nt*4,ct/=6*nt;break}return[ct,c,pt]}function addSaturationToRGB(e,i){var d=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return d[1]+=i,d[1]>1?d[1]=1:d[1]<=0&&(d[1]=0),HSVtoRGB(d[0],d[1],d[2])}function addBrightnessToRGB(e,i){var d=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return d[2]+=i,d[2]>1?d[2]=1:d[2]<0&&(d[2]=0),HSVtoRGB(d[0],d[1],d[2])}function addHueToRGB(e,i){var d=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return d[0]+=i/360,d[0]>1?d[0]-=1:d[0]<0&&(d[0]+=1),HSVtoRGB(d[0],d[1],d[2])}var rgbToHex=function(){var e=[],i,d;for(i=0;i<256;i+=1)d=i.toString(16),e[i]=d.length===1?"0"+d:d;return function(j,_e,nt){return j<0&&(j=0),_e<0&&(_e=0),nt<0&&(nt=0),"#"+e[j]+e[_e]+e[nt]}}(),setSubframeEnabled=function(i){subframeEnabled=!!i},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(i){expressionsPlugin=i},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(i){expressionsInterfaces=i},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(i){defaultCurveSegments=i},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(i){idPrefix$1=i};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return _typeof$5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$5(e)}var dataManager=function(){var e=1,i=[],d,j,_e={onmessage:function(){},postMessage:function(Nt){d({data:Nt})}},nt={postMessage:function(Nt){_e.onmessage({data:Nt})}};function ct(At){if(window.Worker&&window.Blob&&getWebWorker()){var Nt=new Blob(["var _workerSelf = self; self.onmessage = ",At.toString()],{type:"text/javascript"}),Vt=URL.createObjectURL(Nt);return new Worker(Vt)}return d=At,_e}function c(){j||(j=ct(function(Nt){function Vt(){function Jt(Kr,xr){var jr,rr,ar=Kr.length,$r,Ar,Xr,us;for(rr=0;rr<ar;rr+=1)if(jr=Kr[rr],"ks"in jr&&!jr.completed){if(jr.completed=!0,jr.hasMask){var Wr=jr.masksProperties;for(Ar=Wr.length,$r=0;$r<Ar;$r+=1)if(Wr[$r].pt.k.i)tr(Wr[$r].pt.k);else for(us=Wr[$r].pt.k.length,Xr=0;Xr<us;Xr+=1)Wr[$r].pt.k[Xr].s&&tr(Wr[$r].pt.k[Xr].s[0]),Wr[$r].pt.k[Xr].e&&tr(Wr[$r].pt.k[Xr].e[0])}jr.ty===0?(jr.layers=Mt(jr.refId,xr),Jt(jr.layers,xr)):jr.ty===4?Ht(jr.shapes):jr.ty===5&&ms(jr)}}function Dt(Kr,xr){if(Kr){var jr=0,rr=Kr.length;for(jr=0;jr<rr;jr+=1)Kr[jr].t===1&&(Kr[jr].data.layers=Mt(Kr[jr].data.refId,xr),Jt(Kr[jr].data.layers,xr))}}function It(Kr,xr){for(var jr=0,rr=xr.length;jr<rr;){if(xr[jr].id===Kr)return xr[jr];jr+=1}return null}function Mt(Kr,xr){var jr=It(Kr,xr);return jr?jr.layers.__used?JSON.parse(JSON.stringify(jr.layers)):(jr.layers.__used=!0,jr.layers):null}function Ht(Kr){var xr,jr=Kr.length,rr,ar;for(xr=jr-1;xr>=0;xr-=1)if(Kr[xr].ty==="sh")if(Kr[xr].ks.k.i)tr(Kr[xr].ks.k);else for(ar=Kr[xr].ks.k.length,rr=0;rr<ar;rr+=1)Kr[xr].ks.k[rr].s&&tr(Kr[xr].ks.k[rr].s[0]),Kr[xr].ks.k[rr].e&&tr(Kr[xr].ks.k[rr].e[0]);else Kr[xr].ty==="gr"&&Ht(Kr[xr].it)}function tr(Kr){var xr,jr=Kr.i.length;for(xr=0;xr<jr;xr+=1)Kr.i[xr][0]+=Kr.v[xr][0],Kr.i[xr][1]+=Kr.v[xr][1],Kr.o[xr][0]+=Kr.v[xr][0],Kr.o[xr][1]+=Kr.v[xr][1]}function er(Kr,xr){var jr=xr?xr.split("."):[100,100,100];return Kr[0]>jr[0]?!0:jr[0]>Kr[0]?!1:Kr[1]>jr[1]?!0:jr[1]>Kr[1]?!1:Kr[2]>jr[2]?!0:jr[2]>Kr[2]?!1:null}var dr=function(){var Kr=[4,4,14];function xr(rr){var ar=rr.t.d;rr.t.d={k:[{s:ar,t:0}]}}function jr(rr){var ar,$r=rr.length;for(ar=0;ar<$r;ar+=1)rr[ar].ty===5&&xr(rr[ar])}return function(rr){if(er(Kr,rr.v)&&(jr(rr.layers),rr.assets)){var ar,$r=rr.assets.length;for(ar=0;ar<$r;ar+=1)rr.assets[ar].layers&&jr(rr.assets[ar].layers)}}}(),mr=function(){var Kr=[4,7,99];return function(xr){if(xr.chars&&!er(Kr,xr.v)){var jr,rr=xr.chars.length;for(jr=0;jr<rr;jr+=1){var ar=xr.chars[jr];ar.data&&ar.data.shapes&&(Ht(ar.data.shapes),ar.data.ip=0,ar.data.op=99999,ar.data.st=0,ar.data.sr=1,ar.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},xr.chars[jr].t||(ar.data.shapes.push({ty:"no"}),ar.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),Ur=function(){var Kr=[5,7,15];function xr(rr){var ar=rr.t.p;typeof ar.a=="number"&&(ar.a={a:0,k:ar.a}),typeof ar.p=="number"&&(ar.p={a:0,k:ar.p}),typeof ar.r=="number"&&(ar.r={a:0,k:ar.r})}function jr(rr){var ar,$r=rr.length;for(ar=0;ar<$r;ar+=1)rr[ar].ty===5&&xr(rr[ar])}return function(rr){if(er(Kr,rr.v)&&(jr(rr.layers),rr.assets)){var ar,$r=rr.assets.length;for(ar=0;ar<$r;ar+=1)rr.assets[ar].layers&&jr(rr.assets[ar].layers)}}}(),Dr=function(){var Kr=[4,1,9];function xr(rr){var ar,$r=rr.length,Ar,Xr;for(ar=0;ar<$r;ar+=1)if(rr[ar].ty==="gr")xr(rr[ar].it);else if(rr[ar].ty==="fl"||rr[ar].ty==="st")if(rr[ar].c.k&&rr[ar].c.k[0].i)for(Xr=rr[ar].c.k.length,Ar=0;Ar<Xr;Ar+=1)rr[ar].c.k[Ar].s&&(rr[ar].c.k[Ar].s[0]/=255,rr[ar].c.k[Ar].s[1]/=255,rr[ar].c.k[Ar].s[2]/=255,rr[ar].c.k[Ar].s[3]/=255),rr[ar].c.k[Ar].e&&(rr[ar].c.k[Ar].e[0]/=255,rr[ar].c.k[Ar].e[1]/=255,rr[ar].c.k[Ar].e[2]/=255,rr[ar].c.k[Ar].e[3]/=255);else rr[ar].c.k[0]/=255,rr[ar].c.k[1]/=255,rr[ar].c.k[2]/=255,rr[ar].c.k[3]/=255}function jr(rr){var ar,$r=rr.length;for(ar=0;ar<$r;ar+=1)rr[ar].ty===4&&xr(rr[ar].shapes)}return function(rr){if(er(Kr,rr.v)&&(jr(rr.layers),rr.assets)){var ar,$r=rr.assets.length;for(ar=0;ar<$r;ar+=1)rr.assets[ar].layers&&jr(rr.assets[ar].layers)}}}(),Yr=function(){var Kr=[4,4,18];function xr(rr){var ar,$r=rr.length,Ar,Xr;for(ar=$r-1;ar>=0;ar-=1)if(rr[ar].ty==="sh")if(rr[ar].ks.k.i)rr[ar].ks.k.c=rr[ar].closed;else for(Xr=rr[ar].ks.k.length,Ar=0;Ar<Xr;Ar+=1)rr[ar].ks.k[Ar].s&&(rr[ar].ks.k[Ar].s[0].c=rr[ar].closed),rr[ar].ks.k[Ar].e&&(rr[ar].ks.k[Ar].e[0].c=rr[ar].closed);else rr[ar].ty==="gr"&&xr(rr[ar].it)}function jr(rr){var ar,$r,Ar=rr.length,Xr,us,Wr,Vs;for($r=0;$r<Ar;$r+=1){if(ar=rr[$r],ar.hasMask){var yn=ar.masksProperties;for(us=yn.length,Xr=0;Xr<us;Xr+=1)if(yn[Xr].pt.k.i)yn[Xr].pt.k.c=yn[Xr].cl;else for(Vs=yn[Xr].pt.k.length,Wr=0;Wr<Vs;Wr+=1)yn[Xr].pt.k[Wr].s&&(yn[Xr].pt.k[Wr].s[0].c=yn[Xr].cl),yn[Xr].pt.k[Wr].e&&(yn[Xr].pt.k[Wr].e[0].c=yn[Xr].cl)}ar.ty===4&&xr(ar.shapes)}}return function(rr){if(er(Kr,rr.v)&&(jr(rr.layers),rr.assets)){var ar,$r=rr.assets.length;for(ar=0;ar<$r;ar+=1)rr.assets[ar].layers&&jr(rr.assets[ar].layers)}}}();function es(Kr){Kr.__complete||(Dr(Kr),dr(Kr),mr(Kr),Ur(Kr),Yr(Kr),Jt(Kr.layers,Kr.assets),Dt(Kr.chars,Kr.assets),Kr.__complete=!0)}function ms(Kr){Kr.t.a.length===0&&"m"in Kr.t.p}var Ms={};return Ms.completeData=es,Ms.checkColors=Dr,Ms.checkChars=mr,Ms.checkPathProperties=Ur,Ms.checkShapes=Yr,Ms.completeLayers=Jt,Ms}if(nt.dataManager||(nt.dataManager=Vt()),nt.assetLoader||(nt.assetLoader=function(){function Jt(It){var Mt=It.getResponseHeader("content-type");return Mt&&It.responseType==="json"&&Mt.indexOf("json")!==-1||It.response&&_typeof$5(It.response)==="object"?It.response:It.response&&typeof It.response=="string"?JSON.parse(It.response):It.responseText?JSON.parse(It.responseText):null}function Dt(It,Mt,Ht,tr){var er,dr=new XMLHttpRequest;try{dr.responseType="json"}catch{}dr.onreadystatechange=function(){if(dr.readyState===4)if(dr.status===200)er=Jt(dr),Ht(er);else try{er=Jt(dr),Ht(er)}catch(mr){tr&&tr(mr)}};try{dr.open(["G","E","T"].join(""),It,!0)}catch{dr.open(["G","E","T"].join(""),Mt+"/"+It,!0)}dr.send()}return{load:Dt}}()),Nt.data.type==="loadAnimation")nt.assetLoader.load(Nt.data.path,Nt.data.fullPath,function(Jt){nt.dataManager.completeData(Jt),nt.postMessage({id:Nt.data.id,payload:Jt,status:"success"})},function(){nt.postMessage({id:Nt.data.id,status:"error"})});else if(Nt.data.type==="complete"){var zt=Nt.data.animation;nt.dataManager.completeData(zt),nt.postMessage({id:Nt.data.id,payload:zt,status:"success"})}else Nt.data.type==="loadData"&&nt.assetLoader.load(Nt.data.path,Nt.data.fullPath,function(Jt){nt.postMessage({id:Nt.data.id,payload:Jt,status:"success"})},function(){nt.postMessage({id:Nt.data.id,status:"error"})})}),j.onmessage=function(At){var Nt=At.data,Vt=Nt.id,zt=i[Vt];i[Vt]=null,Nt.status==="success"?zt.onComplete(Nt.payload):zt.onError&&zt.onError()})}function pt(At,Nt){e+=1;var Vt="processId_"+e;return i[Vt]={onComplete:At,onError:Nt},Vt}function gt(At,Nt,Vt){c();var zt=pt(Nt,Vt);j.postMessage({type:"loadAnimation",path:At,fullPath:window.location.origin+window.location.pathname,id:zt})}function St(At,Nt,Vt){c();var zt=pt(Nt,Vt);j.postMessage({type:"loadData",path:At,fullPath:window.location.origin+window.location.pathname,id:zt})}function kt(At,Nt,Vt){c();var zt=pt(Nt,Vt);j.postMessage({type:"complete",animation:At,id:zt})}return{loadAnimation:gt,loadData:St,completeAnimation:kt}}(),ImagePreloader=function(){var e=function(){var Dt=createTag("canvas");Dt.width=1,Dt.height=1;var It=Dt.getContext("2d");return It.fillStyle="rgba(0,0,0,0)",It.fillRect(0,0,1,1),Dt}();function i(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function d(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function j(Dt,It,Mt){var Ht="";if(Dt.e)Ht=Dt.p;else if(It){var tr=Dt.p;tr.indexOf("images/")!==-1&&(tr=tr.split("/")[1]),Ht=It+tr}else Ht=Mt,Ht+=Dt.u?Dt.u:"",Ht+=Dt.p;return Ht}function _e(Dt){var It=0,Mt=setInterval((function(){var Ht=Dt.getBBox();(Ht.width||It>500)&&(this._imageLoaded(),clearInterval(Mt)),It+=1}).bind(this),50)}function nt(Dt){var It=j(Dt,this.assetsPath,this.path),Mt=createNS("image");isSafari?this.testImageLoaded(Mt):Mt.addEventListener("load",this._imageLoaded,!1),Mt.addEventListener("error",(function(){Ht.img=e,this._imageLoaded()}).bind(this),!1),Mt.setAttributeNS("http://www.w3.org/1999/xlink","href",It),this._elementHelper.append?this._elementHelper.append(Mt):this._elementHelper.appendChild(Mt);var Ht={img:Mt,assetData:Dt};return Ht}function ct(Dt){var It=j(Dt,this.assetsPath,this.path),Mt=createTag("img");Mt.crossOrigin="anonymous",Mt.addEventListener("load",this._imageLoaded,!1),Mt.addEventListener("error",(function(){Ht.img=e,this._imageLoaded()}).bind(this),!1),Mt.src=It;var Ht={img:Mt,assetData:Dt};return Ht}function c(Dt){var It={assetData:Dt},Mt=j(Dt,this.assetsPath,this.path);return dataManager.loadData(Mt,(function(Ht){It.img=Ht,this._footageLoaded()}).bind(this),(function(){It.img={},this._footageLoaded()}).bind(this)),It}function pt(Dt,It){this.imagesLoadedCb=It;var Mt,Ht=Dt.length;for(Mt=0;Mt<Ht;Mt+=1)Dt[Mt].layers||(!Dt[Mt].t||Dt[Mt].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(Dt[Mt]))):Dt[Mt].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(Dt[Mt]))))}function gt(Dt){this.path=Dt||""}function St(Dt){this.assetsPath=Dt||""}function kt(Dt){for(var It=0,Mt=this.images.length;It<Mt;){if(this.images[It].assetData===Dt)return this.images[It].img;It+=1}return null}function At(){this.imagesLoadedCb=null,this.images.length=0}function Nt(){return this.totalImages===this.loadedAssets}function Vt(){return this.totalFootages===this.loadedFootagesCount}function zt(Dt,It){Dt==="svg"?(this._elementHelper=It,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function Jt(){this._imageLoaded=i.bind(this),this._footageLoaded=d.bind(this),this.testImageLoaded=_e.bind(this),this.createFootageData=c.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return Jt.prototype={loadAssets:pt,setAssetsPath:St,setPath:gt,loadedImages:Nt,loadedFootages:Vt,destroy:At,getAsset:kt,createImgData:ct,createImageData:nt,imageLoaded:i,footageLoaded:d,setCacheType:zt},Jt}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(i,d){if(this._cbs[i])for(var j=this._cbs[i],_e=0;_e<j.length;_e+=1)j[_e](d)},addEventListener:function(i,d){return this._cbs[i]||(this._cbs[i]=[]),this._cbs[i].push(d),(function(){this.removeEventListener(i,d)}).bind(this)},removeEventListener:function(i,d){if(!d)this._cbs[i]=null;else if(this._cbs[i]){for(var j=0,_e=this._cbs[i].length;j<_e;)this._cbs[i][j]===d&&(this._cbs[i].splice(j,1),j-=1,_e-=1),j+=1;this._cbs[i].length||(this._cbs[i]=null)}}};var markerParser=function(){function e(i){for(var d=i.split(`\r
`),j={},_e,nt=0,ct=0;ct<d.length;ct+=1)_e=d[ct].split(":"),_e.length===2&&(j[_e[0]]=_e[1].trim(),nt+=1);if(nt===0)throw new Error;return j}return function(i){for(var d=[],j=0;j<i.length;j+=1){var _e=i[j],nt={time:_e.tm,duration:_e.dr};try{nt.payload=JSON.parse(i[j].cm)}catch{try{nt.payload=e(i[j].cm)}catch{nt.payload={name:i[j].cm}}}d.push(nt)}return d}}(),ProjectInterface=function(){function e(i){this.compositions.push(i)}return function(){function i(d){for(var j=0,_e=this.compositions.length;j<_e;){if(this.compositions[j].data&&this.compositions[j].data.nm===d)return this.compositions[j].prepareFrame&&this.compositions[j].data.xt&&this.compositions[j].prepareFrame(this.currentFrame),this.compositions[j].compInterface;j+=1}return null}return i.compositions=[],i.currentFrame=0,i.registerComposition=e,i}}(),renderers={},registerRenderer=function(i,d){renderers[i]=d};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return _typeof$4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var i="svg";e.animType?i=e.animType:e.renderer&&(i=e.renderer);var d=getRenderer(i);this.renderer=new d(this,e.rendererSettings),this.imagePreloader.setCacheType(i,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=i,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,i){i&&_typeof$4(i)!=="object"&&(i=JSON.parse(i));var d={wrapper:e,animationData:i},j=e.attributes;d.path=j.getNamedItem("data-animation-path")?j.getNamedItem("data-animation-path").value:j.getNamedItem("data-bm-path")?j.getNamedItem("data-bm-path").value:j.getNamedItem("bm-path")?j.getNamedItem("bm-path").value:"",d.animType=j.getNamedItem("data-anim-type")?j.getNamedItem("data-anim-type").value:j.getNamedItem("data-bm-type")?j.getNamedItem("data-bm-type").value:j.getNamedItem("bm-type")?j.getNamedItem("bm-type").value:j.getNamedItem("data-bm-renderer")?j.getNamedItem("data-bm-renderer").value:j.getNamedItem("bm-renderer")?j.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var _e=j.getNamedItem("data-anim-loop")?j.getNamedItem("data-anim-loop").value:j.getNamedItem("data-bm-loop")?j.getNamedItem("data-bm-loop").value:j.getNamedItem("bm-loop")?j.getNamedItem("bm-loop").value:"";_e==="false"?d.loop=!1:_e==="true"?d.loop=!0:_e!==""&&(d.loop=parseInt(_e,10));var nt=j.getNamedItem("data-anim-autoplay")?j.getNamedItem("data-anim-autoplay").value:j.getNamedItem("data-bm-autoplay")?j.getNamedItem("data-bm-autoplay").value:j.getNamedItem("bm-autoplay")?j.getNamedItem("bm-autoplay").value:!0;d.autoplay=nt!=="false",d.name=j.getNamedItem("data-name")?j.getNamedItem("data-name").value:j.getNamedItem("data-bm-name")?j.getNamedItem("data-bm-name").value:j.getNamedItem("bm-name")?j.getNamedItem("bm-name").value:"";var ct=j.getNamedItem("data-anim-prerender")?j.getNamedItem("data-anim-prerender").value:j.getNamedItem("data-bm-prerender")?j.getNamedItem("data-bm-prerender").value:j.getNamedItem("bm-prerender")?j.getNamedItem("bm-prerender").value:"";ct==="false"&&(d.prerender=!1),d.path?this.setParams(d):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var i=this.animationData.layers,d,j=i.length,_e=e.layers,nt,ct=_e.length;for(nt=0;nt<ct;nt+=1)for(d=0;d<j;){if(i[d].id===_e[nt].id){i[d]=_e[nt];break}d+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(j=e.assets.length,d=0;d<j;d+=1)this.animationData.assets.push(e.assets[d]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var i=getExpressionsPlugin();i&&i.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var i=e.shift();this.timeCompleted=i.time*this.frameRate;var d=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(d,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(i){this.triggerConfigError(i)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,i){var d=typeof e=="number"?e:void 0,j=typeof i=="number"?i:void 0;this.renderer.updateContainerSize(d,j)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var i,d=0;d<this.markers.length;d+=1)if(i=this.markers[d],i.payload&&i.payload.name===e)return i;return null},AnimationItem.prototype.goToAndStop=function(e,i,d){if(!(d&&this.name!==d)){var j=Number(e);if(isNaN(j)){var _e=this.getMarkerData(e);_e&&this.goToAndStop(_e.time,!0)}else i?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,i,d){if(!(d&&this.name!==d)){var j=Number(e);if(isNaN(j)){var _e=this.getMarkerData(e);_e&&(_e.duration?this.playSegments([_e.time,_e.time+_e.duration],!0):this.goToAndStop(_e.time,!0))}else this.goToAndStop(j,i,d);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var i=this.currentRawFrame+e*this.frameModifier,d=!1;i>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(i>this.totalFrames?i%this.totalFrames:0)||(d=!0,i=this.totalFrames-1):i>=this.totalFrames?(this.playCount+=1,this.checkSegments(i%this.totalFrames)||(this.setCurrentRawFrameValue(i%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(i):i<0?this.checkSegments(i%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+i%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(d=!0,i=0)):this.setCurrentRawFrameValue(i),d&&(this.setCurrentRawFrameValue(i),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,i){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-i)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+i)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,i){var d=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?d=e:this.currentRawFrame+this.firstFrame>i&&(d=i-e)),this.firstFrame=e,this.totalFrames=i-e,this.timeCompleted=this.totalFrames,d!==-1&&this.goToAndStop(d,!0)},AnimationItem.prototype.playSegments=function(e,i){if(i&&(this.segments.length=0),_typeof$4(e[0])==="object"){var d,j=e.length;for(d=0;d<j;d+=1)this.segments.push(e[d])}else this.segments.push(e);this.segments.length&&i&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,i){i&&this.name!==i||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var i="";if(e.e)i=e.p;else if(this.assetsPath){var d=e.p;d.indexOf("images/")!==-1&&(d=d.split("/")[1]),i=this.assetsPath+d}else i=this.path,i+=e.u?e.u:"",i+=e.p;return i},AnimationItem.prototype.getAssetData=function(e){for(var i=0,d=this.assets.length;i<d;){if(e===this.assets[i].id)return this.assets[i];i+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,i,d){try{var j=this.renderer.getElementByPath(e);j.updateDocumentData(i,d)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var i=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)},AnimationItem.prototype.triggerConfigError=function(e){var i=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",i),this.onError&&this.onError.call(this,i)};var animationManager=function(){var e={},i=[],d=0,j=0,_e=0,nt=!0,ct=!1;function c(xr){for(var jr=0,rr=xr.target;jr<j;)i[jr].animation===rr&&(i.splice(jr,1),jr-=1,j-=1,rr.isPaused||kt()),jr+=1}function pt(xr,jr){if(!xr)return null;for(var rr=0;rr<j;){if(i[rr].elem===xr&&i[rr].elem!==null)return i[rr].animation;rr+=1}var ar=new AnimationItem;return At(ar,xr),ar.setData(xr,jr),ar}function gt(){var xr,jr=i.length,rr=[];for(xr=0;xr<jr;xr+=1)rr.push(i[xr].animation);return rr}function St(){_e+=1,Dr()}function kt(){_e-=1}function At(xr,jr){xr.addEventListener("destroy",c),xr.addEventListener("_active",St),xr.addEventListener("_idle",kt),i.push({elem:jr,animation:xr}),j+=1}function Nt(xr){var jr=new AnimationItem;return At(jr,null),jr.setParams(xr),jr}function Vt(xr,jr){var rr;for(rr=0;rr<j;rr+=1)i[rr].animation.setSpeed(xr,jr)}function zt(xr,jr){var rr;for(rr=0;rr<j;rr+=1)i[rr].animation.setDirection(xr,jr)}function Jt(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.play(xr)}function Dt(xr){var jr=xr-d,rr;for(rr=0;rr<j;rr+=1)i[rr].animation.advanceTime(jr);d=xr,_e&&!ct?window.requestAnimationFrame(Dt):nt=!0}function It(xr){d=xr,window.requestAnimationFrame(Dt)}function Mt(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.pause(xr)}function Ht(xr,jr,rr){var ar;for(ar=0;ar<j;ar+=1)i[ar].animation.goToAndStop(xr,jr,rr)}function tr(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.stop(xr)}function er(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.togglePause(xr)}function dr(xr){var jr;for(jr=j-1;jr>=0;jr-=1)i[jr].animation.destroy(xr)}function mr(xr,jr,rr){var ar=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),$r,Ar=ar.length;for($r=0;$r<Ar;$r+=1)rr&&ar[$r].setAttribute("data-bm-type",rr),pt(ar[$r],xr);if(jr&&Ar===0){rr||(rr="svg");var Xr=document.getElementsByTagName("body")[0];Xr.innerText="";var us=createTag("div");us.style.width="100%",us.style.height="100%",us.setAttribute("data-bm-type",rr),Xr.appendChild(us),pt(us,xr)}}function Ur(){var xr;for(xr=0;xr<j;xr+=1)i[xr].animation.resize()}function Dr(){!ct&&_e&&nt&&(window.requestAnimationFrame(It),nt=!1)}function Yr(){ct=!0}function es(){ct=!1,Dr()}function ms(xr,jr){var rr;for(rr=0;rr<j;rr+=1)i[rr].animation.setVolume(xr,jr)}function Ms(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.mute(xr)}function Kr(xr){var jr;for(jr=0;jr<j;jr+=1)i[jr].animation.unmute(xr)}return e.registerAnimation=pt,e.loadAnimation=Nt,e.setSpeed=Vt,e.setDirection=zt,e.play=Jt,e.pause=Mt,e.stop=tr,e.togglePause=er,e.searchAnimations=mr,e.resize=Ur,e.goToAndStop=Ht,e.destroy=dr,e.freeze=Yr,e.unfreeze=es,e.setVolume=ms,e.mute=Ms,e.unmute=Kr,e.getRegisteredAnimations=gt,e}(),BezierFactory=function(){var e={};e.getBezierEasing=d;var i={};function d(It,Mt,Ht,tr,er){var dr=er||("bez_"+It+"_"+Mt+"_"+Ht+"_"+tr).replace(/\./g,"p");if(i[dr])return i[dr];var mr=new Dt([It,Mt,Ht,tr]);return i[dr]=mr,mr}var j=4,_e=.001,nt=1e-7,ct=10,c=11,pt=1/(c-1),gt=typeof Float32Array=="function";function St(It,Mt){return 1-3*Mt+3*It}function kt(It,Mt){return 3*Mt-6*It}function At(It){return 3*It}function Nt(It,Mt,Ht){return((St(Mt,Ht)*It+kt(Mt,Ht))*It+At(Mt))*It}function Vt(It,Mt,Ht){return 3*St(Mt,Ht)*It*It+2*kt(Mt,Ht)*It+At(Mt)}function zt(It,Mt,Ht,tr,er){var dr,mr,Ur=0;do mr=Mt+(Ht-Mt)/2,dr=Nt(mr,tr,er)-It,dr>0?Ht=mr:Mt=mr;while(Math.abs(dr)>nt&&++Ur<ct);return mr}function Jt(It,Mt,Ht,tr){for(var er=0;er<j;++er){var dr=Vt(Mt,Ht,tr);if(dr===0)return Mt;var mr=Nt(Mt,Ht,tr)-It;Mt-=mr/dr}return Mt}function Dt(It){this._p=It,this._mSampleValues=gt?new Float32Array(c):new Array(c),this._precomputed=!1,this.get=this.get.bind(this)}return Dt.prototype={get:function(Mt){var Ht=this._p[0],tr=this._p[1],er=this._p[2],dr=this._p[3];return this._precomputed||this._precompute(),Ht===tr&&er===dr?Mt:Mt===0?0:Mt===1?1:Nt(this._getTForX(Mt),tr,dr)},_precompute:function(){var Mt=this._p[0],Ht=this._p[1],tr=this._p[2],er=this._p[3];this._precomputed=!0,(Mt!==Ht||tr!==er)&&this._calcSampleValues()},_calcSampleValues:function(){for(var Mt=this._p[0],Ht=this._p[2],tr=0;tr<c;++tr)this._mSampleValues[tr]=Nt(tr*pt,Mt,Ht)},_getTForX:function(Mt){for(var Ht=this._p[0],tr=this._p[2],er=this._mSampleValues,dr=0,mr=1,Ur=c-1;mr!==Ur&&er[mr]<=Mt;++mr)dr+=pt;--mr;var Dr=(Mt-er[mr])/(er[mr+1]-er[mr]),Yr=dr+Dr*pt,es=Vt(Yr,Ht,tr);return es>=_e?Jt(Mt,Yr,Ht,tr):es===0?Yr:zt(Mt,dr,dr+pt,Ht,tr)}},e}(),pooling=function(){function e(i){return i.concat(createSizedArray(i.length))}return{double:e}}(),poolFactory=function(){return function(e,i,d){var j=0,_e=e,nt=createSizedArray(_e),ct={newElement:c,release:pt};function c(){var gt;return j?(j-=1,gt=nt[j]):gt=i(),gt}function pt(gt){j===_e&&(nt=pooling.double(nt),_e*=2),d&&d(gt),nt[j]=gt,j+=1}return ct}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function i(d){var j,_e=d.lengths.length;for(j=0;j<_e;j+=1)bezierLengthPool.release(d.lengths[j]);d.lengths.length=0}return poolFactory(8,e,i)}();function bezFunction(){var e=Math;function i(At,Nt,Vt,zt,Jt,Dt){var It=At*zt+Nt*Jt+Vt*Dt-Jt*zt-Dt*At-Vt*Nt;return It>-.001&&It<.001}function d(At,Nt,Vt,zt,Jt,Dt,It,Mt,Ht){if(Vt===0&&Dt===0&&Ht===0)return i(At,Nt,zt,Jt,It,Mt);var tr=e.sqrt(e.pow(zt-At,2)+e.pow(Jt-Nt,2)+e.pow(Dt-Vt,2)),er=e.sqrt(e.pow(It-At,2)+e.pow(Mt-Nt,2)+e.pow(Ht-Vt,2)),dr=e.sqrt(e.pow(It-zt,2)+e.pow(Mt-Jt,2)+e.pow(Ht-Dt,2)),mr;return tr>er?tr>dr?mr=tr-er-dr:mr=dr-er-tr:dr>er?mr=dr-er-tr:mr=er-tr-dr,mr>-1e-4&&mr<1e-4}var j=function(){return function(At,Nt,Vt,zt){var Jt=getDefaultCurveSegments(),Dt,It,Mt,Ht,tr,er=0,dr,mr=[],Ur=[],Dr=bezierLengthPool.newElement();for(Mt=Vt.length,Dt=0;Dt<Jt;Dt+=1){for(tr=Dt/(Jt-1),dr=0,It=0;It<Mt;It+=1)Ht=bmPow(1-tr,3)*At[It]+3*bmPow(1-tr,2)*tr*Vt[It]+3*(1-tr)*bmPow(tr,2)*zt[It]+bmPow(tr,3)*Nt[It],mr[It]=Ht,Ur[It]!==null&&(dr+=bmPow(mr[It]-Ur[It],2)),Ur[It]=mr[It];dr&&(dr=bmSqrt(dr),er+=dr),Dr.percents[Dt]=tr,Dr.lengths[Dt]=er}return Dr.addedLength=er,Dr}}();function _e(At){var Nt=segmentsLengthPool.newElement(),Vt=At.c,zt=At.v,Jt=At.o,Dt=At.i,It,Mt=At._length,Ht=Nt.lengths,tr=0;for(It=0;It<Mt-1;It+=1)Ht[It]=j(zt[It],zt[It+1],Jt[It],Dt[It+1]),tr+=Ht[It].addedLength;return Vt&&Mt&&(Ht[It]=j(zt[It],zt[0],Jt[It],Dt[0]),tr+=Ht[It].addedLength),Nt.totalLength=tr,Nt}function nt(At){this.segmentLength=0,this.points=new Array(At)}function ct(At,Nt){this.partialLength=At,this.point=Nt}var c=function(){var At={};return function(Nt,Vt,zt,Jt){var Dt=(Nt[0]+"_"+Nt[1]+"_"+Vt[0]+"_"+Vt[1]+"_"+zt[0]+"_"+zt[1]+"_"+Jt[0]+"_"+Jt[1]).replace(/\./g,"p");if(!At[Dt]){var It=getDefaultCurveSegments(),Mt,Ht,tr,er,dr,mr=0,Ur,Dr,Yr=null;Nt.length===2&&(Nt[0]!==Vt[0]||Nt[1]!==Vt[1])&&i(Nt[0],Nt[1],Vt[0],Vt[1],Nt[0]+zt[0],Nt[1]+zt[1])&&i(Nt[0],Nt[1],Vt[0],Vt[1],Vt[0]+Jt[0],Vt[1]+Jt[1])&&(It=2);var es=new nt(It);for(tr=zt.length,Mt=0;Mt<It;Mt+=1){for(Dr=createSizedArray(tr),dr=Mt/(It-1),Ur=0,Ht=0;Ht<tr;Ht+=1)er=bmPow(1-dr,3)*Nt[Ht]+3*bmPow(1-dr,2)*dr*(Nt[Ht]+zt[Ht])+3*(1-dr)*bmPow(dr,2)*(Vt[Ht]+Jt[Ht])+bmPow(dr,3)*Vt[Ht],Dr[Ht]=er,Yr!==null&&(Ur+=bmPow(Dr[Ht]-Yr[Ht],2));Ur=bmSqrt(Ur),mr+=Ur,es.points[Mt]=new ct(Ur,Dr),Yr=Dr}es.segmentLength=mr,At[Dt]=es}return At[Dt]}}();function pt(At,Nt){var Vt=Nt.percents,zt=Nt.lengths,Jt=Vt.length,Dt=bmFloor((Jt-1)*At),It=At*Nt.addedLength,Mt=0;if(Dt===Jt-1||Dt===0||It===zt[Dt])return Vt[Dt];for(var Ht=zt[Dt]>It?-1:1,tr=!0;tr;)if(zt[Dt]<=It&&zt[Dt+1]>It?(Mt=(It-zt[Dt])/(zt[Dt+1]-zt[Dt]),tr=!1):Dt+=Ht,Dt<0||Dt>=Jt-1){if(Dt===Jt-1)return Vt[Dt];tr=!1}return Vt[Dt]+(Vt[Dt+1]-Vt[Dt])*Mt}function gt(At,Nt,Vt,zt,Jt,Dt){var It=pt(Jt,Dt),Mt=1-It,Ht=e.round((Mt*Mt*Mt*At[0]+(It*Mt*Mt+Mt*It*Mt+Mt*Mt*It)*Vt[0]+(It*It*Mt+Mt*It*It+It*Mt*It)*zt[0]+It*It*It*Nt[0])*1e3)/1e3,tr=e.round((Mt*Mt*Mt*At[1]+(It*Mt*Mt+Mt*It*Mt+Mt*Mt*It)*Vt[1]+(It*It*Mt+Mt*It*It+It*Mt*It)*zt[1]+It*It*It*Nt[1])*1e3)/1e3;return[Ht,tr]}var St=createTypedArray("float32",8);function kt(At,Nt,Vt,zt,Jt,Dt,It){Jt<0?Jt=0:Jt>1&&(Jt=1);var Mt=pt(Jt,It);Dt=Dt>1?1:Dt;var Ht=pt(Dt,It),tr,er=At.length,dr=1-Mt,mr=1-Ht,Ur=dr*dr*dr,Dr=Mt*dr*dr*3,Yr=Mt*Mt*dr*3,es=Mt*Mt*Mt,ms=dr*dr*mr,Ms=Mt*dr*mr+dr*Mt*mr+dr*dr*Ht,Kr=Mt*Mt*mr+dr*Mt*Ht+Mt*dr*Ht,xr=Mt*Mt*Ht,jr=dr*mr*mr,rr=Mt*mr*mr+dr*Ht*mr+dr*mr*Ht,ar=Mt*Ht*mr+dr*Ht*Ht+Mt*mr*Ht,$r=Mt*Ht*Ht,Ar=mr*mr*mr,Xr=Ht*mr*mr+mr*Ht*mr+mr*mr*Ht,us=Ht*Ht*mr+mr*Ht*Ht+Ht*mr*Ht,Wr=Ht*Ht*Ht;for(tr=0;tr<er;tr+=1)St[tr*4]=e.round((Ur*At[tr]+Dr*Vt[tr]+Yr*zt[tr]+es*Nt[tr])*1e3)/1e3,St[tr*4+1]=e.round((ms*At[tr]+Ms*Vt[tr]+Kr*zt[tr]+xr*Nt[tr])*1e3)/1e3,St[tr*4+2]=e.round((jr*At[tr]+rr*Vt[tr]+ar*zt[tr]+$r*Nt[tr])*1e3)/1e3,St[tr*4+3]=e.round((Ar*At[tr]+Xr*Vt[tr]+us*zt[tr]+Wr*Nt[tr])*1e3)/1e3;return St}return{getSegmentsLength:_e,getNewSegment:kt,getPointInSegment:gt,buildBezierData:c,pointOnLine2D:i,pointOnLine3D:d}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,i){var d=this.offsetTime,j;this.propType==="multidimensional"&&(j=createTypedArray("float32",this.pv.length));for(var _e=i.lastIndex,nt=_e,ct=this.keyframes.length-1,c=!0,pt,gt,St;c;){if(pt=this.keyframes[nt],gt=this.keyframes[nt+1],nt===ct-1&&e>=gt.t-d){pt.h&&(pt=gt),_e=0;break}if(gt.t-d>e){_e=nt;break}nt<ct-1?nt+=1:(_e=0,c=!1)}St=this.keyframesMetadata[nt]||{};var kt,At,Nt,Vt,zt,Jt,Dt=gt.t-d,It=pt.t-d,Mt;if(pt.to){St.bezierData||(St.bezierData=bez.buildBezierData(pt.s,gt.s||pt.e,pt.to,pt.ti));var Ht=St.bezierData;if(e>=Dt||e<It){var tr=e>=Dt?Ht.points.length-1:0;for(At=Ht.points[tr].point.length,kt=0;kt<At;kt+=1)j[kt]=Ht.points[tr].point[kt]}else{St.__fnct?Jt=St.__fnct:(Jt=BezierFactory.getBezierEasing(pt.o.x,pt.o.y,pt.i.x,pt.i.y,pt.n).get,St.__fnct=Jt),Nt=Jt((e-It)/(Dt-It));var er=Ht.segmentLength*Nt,dr,mr=i.lastFrame<e&&i._lastKeyframeIndex===nt?i._lastAddedLength:0;for(zt=i.lastFrame<e&&i._lastKeyframeIndex===nt?i._lastPoint:0,c=!0,Vt=Ht.points.length;c;){if(mr+=Ht.points[zt].partialLength,er===0||Nt===0||zt===Ht.points.length-1){for(At=Ht.points[zt].point.length,kt=0;kt<At;kt+=1)j[kt]=Ht.points[zt].point[kt];break}else if(er>=mr&&er<mr+Ht.points[zt+1].partialLength){for(dr=(er-mr)/Ht.points[zt+1].partialLength,At=Ht.points[zt].point.length,kt=0;kt<At;kt+=1)j[kt]=Ht.points[zt].point[kt]+(Ht.points[zt+1].point[kt]-Ht.points[zt].point[kt])*dr;break}zt<Vt-1?zt+=1:c=!1}i._lastPoint=zt,i._lastAddedLength=mr-Ht.points[zt].partialLength,i._lastKeyframeIndex=nt}}else{var Ur,Dr,Yr,es,ms;if(ct=pt.s.length,Mt=gt.s||pt.e,this.sh&&pt.h!==1)if(e>=Dt)j[0]=Mt[0],j[1]=Mt[1],j[2]=Mt[2];else if(e<=It)j[0]=pt.s[0],j[1]=pt.s[1],j[2]=pt.s[2];else{var Ms=createQuaternion(pt.s),Kr=createQuaternion(Mt),xr=(e-It)/(Dt-It);quaternionToEuler(j,slerp(Ms,Kr,xr))}else for(nt=0;nt<ct;nt+=1)pt.h!==1&&(e>=Dt?Nt=1:e<It?Nt=0:(pt.o.x.constructor===Array?(St.__fnct||(St.__fnct=[]),St.__fnct[nt]?Jt=St.__fnct[nt]:(Ur=pt.o.x[nt]===void 0?pt.o.x[0]:pt.o.x[nt],Dr=pt.o.y[nt]===void 0?pt.o.y[0]:pt.o.y[nt],Yr=pt.i.x[nt]===void 0?pt.i.x[0]:pt.i.x[nt],es=pt.i.y[nt]===void 0?pt.i.y[0]:pt.i.y[nt],Jt=BezierFactory.getBezierEasing(Ur,Dr,Yr,es).get,St.__fnct[nt]=Jt)):St.__fnct?Jt=St.__fnct:(Ur=pt.o.x,Dr=pt.o.y,Yr=pt.i.x,es=pt.i.y,Jt=BezierFactory.getBezierEasing(Ur,Dr,Yr,es).get,pt.keyframeMetadata=Jt),Nt=Jt((e-It)/(Dt-It)))),Mt=gt.s||pt.e,ms=pt.h===1?pt.s[nt]:pt.s[nt]+(Mt[nt]-pt.s[nt])*Nt,this.propType==="multidimensional"?j[nt]=ms:j=ms}return i.lastIndex=_e,j}function slerp(e,i,d){var j=[],_e=e[0],nt=e[1],ct=e[2],c=e[3],pt=i[0],gt=i[1],St=i[2],kt=i[3],At,Nt,Vt,zt,Jt;return Nt=_e*pt+nt*gt+ct*St+c*kt,Nt<0&&(Nt=-Nt,pt=-pt,gt=-gt,St=-St,kt=-kt),1-Nt>1e-6?(At=Math.acos(Nt),Vt=Math.sin(At),zt=Math.sin((1-d)*At)/Vt,Jt=Math.sin(d*At)/Vt):(zt=1-d,Jt=d),j[0]=zt*_e+Jt*pt,j[1]=zt*nt+Jt*gt,j[2]=zt*ct+Jt*St,j[3]=zt*c+Jt*kt,j}function quaternionToEuler(e,i){var d=i[0],j=i[1],_e=i[2],nt=i[3],ct=Math.atan2(2*j*nt-2*d*_e,1-2*j*j-2*_e*_e),c=Math.asin(2*d*j+2*_e*nt),pt=Math.atan2(2*d*nt-2*j*_e,1-2*d*d-2*_e*_e);e[0]=ct/degToRads,e[1]=c/degToRads,e[2]=pt/degToRads}function createQuaternion(e){var i=e[0]*degToRads,d=e[1]*degToRads,j=e[2]*degToRads,_e=Math.cos(i/2),nt=Math.cos(d/2),ct=Math.cos(j/2),c=Math.sin(i/2),pt=Math.sin(d/2),gt=Math.sin(j/2),St=_e*nt*ct-c*pt*gt,kt=c*pt*ct+_e*nt*gt,At=c*nt*ct+_e*pt*gt,Nt=_e*pt*ct-c*nt*gt;return[kt,At,Nt,St]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,i=this.keyframes[0].t-this.offsetTime,d=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=d&&e>=d||this._caching.lastFrame<i&&e<i))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var j=this.interpolateValue(e,this._caching);this.pv=j}return this._caching.lastFrame=e,this.pv}function setVValue(e){var i;if(this.propType==="unidimensional")i=e*this.mult,mathAbs(this.v-i)>1e-5&&(this.v=i,this._mdf=!0);else for(var d=0,j=this.v.length;d<j;)i=e[d]*this.mult,mathAbs(this.v[d]-i)>1e-5&&(this.v[d]=i,this._mdf=!0),d+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,i=this.effectsSequence.length,d=this.kf?this.pv:this.data.k;for(e=0;e<i;e+=1)d=this.effectsSequence[e](d);this.setVValue(d),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,i,d,j){this.propType="unidimensional",this.mult=d||1,this.data=i,this.v=d?i.k*d:i.k,this.pv=i.k,this._mdf=!1,this.elem=e,this.container=j,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,i,d,j){this.propType="multidimensional",this.mult=d||1,this.data=i,this._mdf=!1,this.elem=e,this.container=j,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var _e,nt=i.k.length;for(this.v=createTypedArray("float32",nt),this.pv=createTypedArray("float32",nt),this.vel=createTypedArray("float32",nt),_e=0;_e<nt;_e+=1)this.v[_e]=i.k[_e]*this.mult,this.pv[_e]=i.k[_e];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,i,d,j){this.propType="unidimensional",this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=i,this.mult=d||1,this.elem=e,this.container=j,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,i,d,j){this.propType="multidimensional";var _e,nt=i.k.length,ct,c,pt,gt;for(_e=0;_e<nt-1;_e+=1)i.k[_e].to&&i.k[_e].s&&i.k[_e+1]&&i.k[_e+1].s&&(ct=i.k[_e].s,c=i.k[_e+1].s,pt=i.k[_e].to,gt=i.k[_e].ti,(ct.length===2&&!(ct[0]===c[0]&&ct[1]===c[1])&&bez.pointOnLine2D(ct[0],ct[1],c[0],c[1],ct[0]+pt[0],ct[1]+pt[1])&&bez.pointOnLine2D(ct[0],ct[1],c[0],c[1],c[0]+gt[0],c[1]+gt[1])||ct.length===3&&!(ct[0]===c[0]&&ct[1]===c[1]&&ct[2]===c[2])&&bez.pointOnLine3D(ct[0],ct[1],ct[2],c[0],c[1],c[2],ct[0]+pt[0],ct[1]+pt[1],ct[2]+pt[2])&&bez.pointOnLine3D(ct[0],ct[1],ct[2],c[0],c[1],c[2],c[0]+gt[0],c[1]+gt[1],c[2]+gt[2]))&&(i.k[_e].to=null,i.k[_e].ti=null),ct[0]===c[0]&&ct[1]===c[1]&&pt[0]===0&&pt[1]===0&&gt[0]===0&&gt[1]===0&&(ct.length===2||ct[2]===c[2]&&pt[2]===0&&gt[2]===0)&&(i.k[_e].to=null,i.k[_e].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=i,this.keyframes=i.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=d||1,this.elem=e,this.container=j,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var St=i.k[0].s.length;for(this.v=createTypedArray("float32",St),this.pv=createTypedArray("float32",St),_e=0;_e<St;_e+=1)this.v[_e]=initFrame,this.pv[_e]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",St)},this.addEffect=addEffect}var PropertyFactory=function(){function e(d,j,_e,nt,ct){j.sid&&(j=d.globalData.slotManager.getProp(j));var c;if(!j.k.length)c=new ValueProperty(d,j,nt,ct);else if(typeof j.k[0]=="number")c=new MultiDimensionalProperty(d,j,nt,ct);else switch(_e){case 0:c=new KeyframedValueProperty(d,j,nt,ct);break;case 1:c=new KeyframedMultidimensionalProperty(d,j,nt,ct);break}return c.effectsSequence.length&&ct.addDynamicProperty(c),c}var i={getProp:e};return i}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&(this.dynamicProperties.push(i),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var i,d=this.dynamicProperties.length;for(i=0;i<d;i+=1)this.dynamicProperties[i].getValue(),this.dynamicProperties[i]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(i){this.container=i,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,i){this.c=e,this.setLength(i);for(var d=0;d<i;)this.v[d]=pointPool.newElement(),this.o[d]=pointPool.newElement(),this.i[d]=pointPool.newElement(),d+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,i,d,j,_e){var nt;switch(this._length=Math.max(this._length,j+1),this._length>=this._maxLength&&this.doubleArrayLength(),d){case"v":nt=this.v;break;case"i":nt=this.i;break;case"o":nt=this.o;break;default:nt=[];break}(!nt[j]||nt[j]&&!_e)&&(nt[j]=pointPool.newElement()),nt[j][0]=e,nt[j][1]=i},ShapePath.prototype.setTripleAt=function(e,i,d,j,_e,nt,ct,c){this.setXYAt(e,i,"v",ct,c),this.setXYAt(d,j,"o",ct,c),this.setXYAt(_e,nt,"i",ct,c)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var i=this.v,d=this.o,j=this.i,_e=0;this.c&&(e.setTripleAt(i[0][0],i[0][1],j[0][0],j[0][1],d[0][0],d[0][1],0,!1),_e=1);var nt=this._length-1,ct=this._length,c;for(c=_e;c<ct;c+=1)e.setTripleAt(i[nt][0],i[nt][1],j[nt][0],j[nt][1],d[nt][0],d[nt][1],c,!1),nt-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function i(_e){var nt=_e._length,ct;for(ct=0;ct<nt;ct+=1)pointPool.release(_e.v[ct]),pointPool.release(_e.i[ct]),pointPool.release(_e.o[ct]),_e.v[ct]=null,_e.i[ct]=null,_e.o[ct]=null;_e._length=0,_e.c=!1}function d(_e){var nt=j.newElement(),ct,c=_e._length===void 0?_e.v.length:_e._length;for(nt.setLength(c),nt.c=_e.c,ct=0;ct<c;ct+=1)nt.setTripleAt(_e.v[ct][0],_e.v[ct][1],_e.o[ct][0],_e.o[ct][1],_e.i[ct][0],_e.i[ct][1],ct);return nt}var j=poolFactory(4,e,i);return j.clone=d,j}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:_e,release:nt},i=0,d=4,j=createSizedArray(d);function _e(){var ct;return i?(i-=1,ct=j[i]):ct=new ShapeCollection,ct}function nt(ct){var c,pt=ct._length;for(c=0;c<pt;c+=1)shapePool.release(ct.shapes[c]);ct._length=0,i===d&&(j=pooling.double(j),d*=2),j[i]=ct,i+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function i(Dt,It,Mt){var Ht=Mt.lastIndex,tr,er,dr,mr,Ur,Dr,Yr,es,ms,Ms=this.keyframes;if(Dt<Ms[0].t-this.offsetTime)tr=Ms[0].s[0],dr=!0,Ht=0;else if(Dt>=Ms[Ms.length-1].t-this.offsetTime)tr=Ms[Ms.length-1].s?Ms[Ms.length-1].s[0]:Ms[Ms.length-2].e[0],dr=!0;else{for(var Kr=Ht,xr=Ms.length-1,jr=!0,rr,ar,$r;jr&&(rr=Ms[Kr],ar=Ms[Kr+1],!(ar.t-this.offsetTime>Dt));)Kr<xr-1?Kr+=1:jr=!1;if($r=this.keyframesMetadata[Kr]||{},dr=rr.h===1,Ht=Kr,!dr){if(Dt>=ar.t-this.offsetTime)es=1;else if(Dt<rr.t-this.offsetTime)es=0;else{var Ar;$r.__fnct?Ar=$r.__fnct:(Ar=BezierFactory.getBezierEasing(rr.o.x,rr.o.y,rr.i.x,rr.i.y).get,$r.__fnct=Ar),es=Ar((Dt-(rr.t-this.offsetTime))/(ar.t-this.offsetTime-(rr.t-this.offsetTime)))}er=ar.s?ar.s[0]:rr.e[0]}tr=rr.s[0]}for(Dr=It._length,Yr=tr.i[0].length,Mt.lastIndex=Ht,mr=0;mr<Dr;mr+=1)for(Ur=0;Ur<Yr;Ur+=1)ms=dr?tr.i[mr][Ur]:tr.i[mr][Ur]+(er.i[mr][Ur]-tr.i[mr][Ur])*es,It.i[mr][Ur]=ms,ms=dr?tr.o[mr][Ur]:tr.o[mr][Ur]+(er.o[mr][Ur]-tr.o[mr][Ur])*es,It.o[mr][Ur]=ms,ms=dr?tr.v[mr][Ur]:tr.v[mr][Ur]+(er.v[mr][Ur]-tr.v[mr][Ur])*es,It.v[mr][Ur]=ms}function d(){var Dt=this.comp.renderedFrame-this.offsetTime,It=this.keyframes[0].t-this.offsetTime,Mt=this.keyframes[this.keyframes.length-1].t-this.offsetTime,Ht=this._caching.lastFrame;return Ht!==e&&(Ht<It&&Dt<It||Ht>Mt&&Dt>Mt)||(this._caching.lastIndex=Ht<Dt?this._caching.lastIndex:0,this.interpolateShape(Dt,this.pv,this._caching)),this._caching.lastFrame=Dt,this.pv}function j(){this.paths=this.localShapeCollection}function _e(Dt,It){if(Dt._length!==It._length||Dt.c!==It.c)return!1;var Mt,Ht=Dt._length;for(Mt=0;Mt<Ht;Mt+=1)if(Dt.v[Mt][0]!==It.v[Mt][0]||Dt.v[Mt][1]!==It.v[Mt][1]||Dt.o[Mt][0]!==It.o[Mt][0]||Dt.o[Mt][1]!==It.o[Mt][1]||Dt.i[Mt][0]!==It.i[Mt][0]||Dt.i[Mt][1]!==It.i[Mt][1])return!1;return!0}function nt(Dt){_e(this.v,Dt)||(this.v=shapePool.clone(Dt),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function ct(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var Dt;this.kf?Dt=this.pv:this.data.ks?Dt=this.data.ks.k:Dt=this.data.pt.k;var It,Mt=this.effectsSequence.length;for(It=0;It<Mt;It+=1)Dt=this.effectsSequence[It](Dt);this.setVValue(Dt),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function c(Dt,It,Mt){this.propType="shape",this.comp=Dt.comp,this.container=Dt,this.elem=Dt,this.data=It,this.k=!1,this.kf=!1,this._mdf=!1;var Ht=Mt===3?It.pt.k:It.ks.k;this.v=shapePool.clone(Ht),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=j,this.effectsSequence=[]}function pt(Dt){this.effectsSequence.push(Dt),this.container.addDynamicProperty(this)}c.prototype.interpolateShape=i,c.prototype.getValue=ct,c.prototype.setVValue=nt,c.prototype.addEffect=pt;function gt(Dt,It,Mt){this.propType="shape",this.comp=Dt.comp,this.elem=Dt,this.container=Dt,this.offsetTime=Dt.data.st,this.keyframes=Mt===3?It.pt.k:It.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var Ht=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,Ht),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=j,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[d.bind(this)]}gt.prototype.getValue=ct,gt.prototype.interpolateShape=i,gt.prototype.setVValue=nt,gt.prototype.addEffect=pt;var St=function(){var Dt=roundCorner;function It(Mt,Ht){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=Ht.d,this.elem=Mt,this.comp=Mt.comp,this.frameId=-1,this.initDynamicPropertyContainer(Mt),this.p=PropertyFactory.getProp(Mt,Ht.p,1,0,this),this.s=PropertyFactory.getProp(Mt,Ht.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return It.prototype={reset:j,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var Ht=this.p.v[0],tr=this.p.v[1],er=this.s.v[0]/2,dr=this.s.v[1]/2,mr=this.d!==3,Ur=this.v;Ur.v[0][0]=Ht,Ur.v[0][1]=tr-dr,Ur.v[1][0]=mr?Ht+er:Ht-er,Ur.v[1][1]=tr,Ur.v[2][0]=Ht,Ur.v[2][1]=tr+dr,Ur.v[3][0]=mr?Ht-er:Ht+er,Ur.v[3][1]=tr,Ur.i[0][0]=mr?Ht-er*Dt:Ht+er*Dt,Ur.i[0][1]=tr-dr,Ur.i[1][0]=mr?Ht+er:Ht-er,Ur.i[1][1]=tr-dr*Dt,Ur.i[2][0]=mr?Ht+er*Dt:Ht-er*Dt,Ur.i[2][1]=tr+dr,Ur.i[3][0]=mr?Ht-er:Ht+er,Ur.i[3][1]=tr+dr*Dt,Ur.o[0][0]=mr?Ht+er*Dt:Ht-er*Dt,Ur.o[0][1]=tr-dr,Ur.o[1][0]=mr?Ht+er:Ht-er,Ur.o[1][1]=tr+dr*Dt,Ur.o[2][0]=mr?Ht-er*Dt:Ht+er*Dt,Ur.o[2][1]=tr+dr,Ur.o[3][0]=mr?Ht-er:Ht+er,Ur.o[3][1]=tr-dr*Dt}},extendPrototype([DynamicPropertyContainer],It),It}(),kt=function(){function Dt(It,Mt){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=It,this.comp=It.comp,this.data=Mt,this.frameId=-1,this.d=Mt.d,this.initDynamicPropertyContainer(It),Mt.sy===1?(this.ir=PropertyFactory.getProp(It,Mt.ir,0,0,this),this.is=PropertyFactory.getProp(It,Mt.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(It,Mt.pt,0,0,this),this.p=PropertyFactory.getProp(It,Mt.p,1,0,this),this.r=PropertyFactory.getProp(It,Mt.r,0,degToRads,this),this.or=PropertyFactory.getProp(It,Mt.or,0,0,this),this.os=PropertyFactory.getProp(It,Mt.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return Dt.prototype={reset:j,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var Mt=Math.floor(this.pt.v)*2,Ht=Math.PI*2/Mt,tr=!0,er=this.or.v,dr=this.ir.v,mr=this.os.v,Ur=this.is.v,Dr=2*Math.PI*er/(Mt*2),Yr=2*Math.PI*dr/(Mt*2),es,ms,Ms,Kr,xr=-Math.PI/2;xr+=this.r.v;var jr=this.data.d===3?-1:1;for(this.v._length=0,es=0;es<Mt;es+=1){ms=tr?er:dr,Ms=tr?mr:Ur,Kr=tr?Dr:Yr;var rr=ms*Math.cos(xr),ar=ms*Math.sin(xr),$r=rr===0&&ar===0?0:ar/Math.sqrt(rr*rr+ar*ar),Ar=rr===0&&ar===0?0:-rr/Math.sqrt(rr*rr+ar*ar);rr+=+this.p.v[0],ar+=+this.p.v[1],this.v.setTripleAt(rr,ar,rr-$r*Kr*Ms*jr,ar-Ar*Kr*Ms*jr,rr+$r*Kr*Ms*jr,ar+Ar*Kr*Ms*jr,es,!0),tr=!tr,xr+=Ht*jr}},convertPolygonToPath:function(){var Mt=Math.floor(this.pt.v),Ht=Math.PI*2/Mt,tr=this.or.v,er=this.os.v,dr=2*Math.PI*tr/(Mt*4),mr,Ur=-Math.PI*.5,Dr=this.data.d===3?-1:1;for(Ur+=this.r.v,this.v._length=0,mr=0;mr<Mt;mr+=1){var Yr=tr*Math.cos(Ur),es=tr*Math.sin(Ur),ms=Yr===0&&es===0?0:es/Math.sqrt(Yr*Yr+es*es),Ms=Yr===0&&es===0?0:-Yr/Math.sqrt(Yr*Yr+es*es);Yr+=+this.p.v[0],es+=+this.p.v[1],this.v.setTripleAt(Yr,es,Yr-ms*dr*er*Dr,es-Ms*dr*er*Dr,Yr+ms*dr*er*Dr,es+Ms*dr*er*Dr,mr,!0),Ur+=Ht*Dr}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],Dt),Dt}(),At=function(){function Dt(It,Mt){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=It,this.comp=It.comp,this.frameId=-1,this.d=Mt.d,this.initDynamicPropertyContainer(It),this.p=PropertyFactory.getProp(It,Mt.p,1,0,this),this.s=PropertyFactory.getProp(It,Mt.s,1,0,this),this.r=PropertyFactory.getProp(It,Mt.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return Dt.prototype={convertRectToPath:function(){var Mt=this.p.v[0],Ht=this.p.v[1],tr=this.s.v[0]/2,er=this.s.v[1]/2,dr=bmMin(tr,er,this.r.v),mr=dr*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(Mt+tr,Ht-er+dr,Mt+tr,Ht-er+dr,Mt+tr,Ht-er+mr,0,!0),this.v.setTripleAt(Mt+tr,Ht+er-dr,Mt+tr,Ht+er-mr,Mt+tr,Ht+er-dr,1,!0),dr!==0?(this.v.setTripleAt(Mt+tr-dr,Ht+er,Mt+tr-dr,Ht+er,Mt+tr-mr,Ht+er,2,!0),this.v.setTripleAt(Mt-tr+dr,Ht+er,Mt-tr+mr,Ht+er,Mt-tr+dr,Ht+er,3,!0),this.v.setTripleAt(Mt-tr,Ht+er-dr,Mt-tr,Ht+er-dr,Mt-tr,Ht+er-mr,4,!0),this.v.setTripleAt(Mt-tr,Ht-er+dr,Mt-tr,Ht-er+mr,Mt-tr,Ht-er+dr,5,!0),this.v.setTripleAt(Mt-tr+dr,Ht-er,Mt-tr+dr,Ht-er,Mt-tr+mr,Ht-er,6,!0),this.v.setTripleAt(Mt+tr-dr,Ht-er,Mt+tr-mr,Ht-er,Mt+tr-dr,Ht-er,7,!0)):(this.v.setTripleAt(Mt-tr,Ht+er,Mt-tr+mr,Ht+er,Mt-tr,Ht+er,2),this.v.setTripleAt(Mt-tr,Ht-er,Mt-tr,Ht-er+mr,Mt-tr,Ht-er,3))):(this.v.setTripleAt(Mt+tr,Ht-er+dr,Mt+tr,Ht-er+mr,Mt+tr,Ht-er+dr,0,!0),dr!==0?(this.v.setTripleAt(Mt+tr-dr,Ht-er,Mt+tr-dr,Ht-er,Mt+tr-mr,Ht-er,1,!0),this.v.setTripleAt(Mt-tr+dr,Ht-er,Mt-tr+mr,Ht-er,Mt-tr+dr,Ht-er,2,!0),this.v.setTripleAt(Mt-tr,Ht-er+dr,Mt-tr,Ht-er+dr,Mt-tr,Ht-er+mr,3,!0),this.v.setTripleAt(Mt-tr,Ht+er-dr,Mt-tr,Ht+er-mr,Mt-tr,Ht+er-dr,4,!0),this.v.setTripleAt(Mt-tr+dr,Ht+er,Mt-tr+dr,Ht+er,Mt-tr+mr,Ht+er,5,!0),this.v.setTripleAt(Mt+tr-dr,Ht+er,Mt+tr-mr,Ht+er,Mt+tr-dr,Ht+er,6,!0),this.v.setTripleAt(Mt+tr,Ht+er-dr,Mt+tr,Ht+er-dr,Mt+tr,Ht+er-mr,7,!0)):(this.v.setTripleAt(Mt-tr,Ht-er,Mt-tr+mr,Ht-er,Mt-tr,Ht-er,1,!0),this.v.setTripleAt(Mt-tr,Ht+er,Mt-tr,Ht+er-mr,Mt-tr,Ht+er,2,!0),this.v.setTripleAt(Mt+tr,Ht+er,Mt+tr-mr,Ht+er,Mt+tr,Ht+er,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:j},extendPrototype([DynamicPropertyContainer],Dt),Dt}();function Nt(Dt,It,Mt){var Ht;if(Mt===3||Mt===4){var tr=Mt===3?It.pt:It.ks,er=tr.k;er.length?Ht=new gt(Dt,It,Mt):Ht=new c(Dt,It,Mt)}else Mt===5?Ht=new At(Dt,It):Mt===6?Ht=new St(Dt,It):Mt===7&&(Ht=new kt(Dt,It));return Ht.k&&Dt.addDynamicProperty(Ht),Ht}function Vt(){return c}function zt(){return gt}var Jt={};return Jt.getShapeProp=Nt,Jt.getConstructorFunction=Vt,Jt.getKeyframedConstructorFunction=zt,Jt}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,i=Math.sin,d=Math.tan,j=Math.round;function _e(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function nt(rr){if(rr===0)return this;var ar=e(rr),$r=i(rr);return this._t(ar,-$r,0,0,$r,ar,0,0,0,0,1,0,0,0,0,1)}function ct(rr){if(rr===0)return this;var ar=e(rr),$r=i(rr);return this._t(1,0,0,0,0,ar,-$r,0,0,$r,ar,0,0,0,0,1)}function c(rr){if(rr===0)return this;var ar=e(rr),$r=i(rr);return this._t(ar,0,$r,0,0,1,0,0,-$r,0,ar,0,0,0,0,1)}function pt(rr){if(rr===0)return this;var ar=e(rr),$r=i(rr);return this._t(ar,-$r,0,0,$r,ar,0,0,0,0,1,0,0,0,0,1)}function gt(rr,ar){return this._t(1,ar,rr,1,0,0)}function St(rr,ar){return this.shear(d(rr),d(ar))}function kt(rr,ar){var $r=e(ar),Ar=i(ar);return this._t($r,Ar,0,0,-Ar,$r,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,d(rr),1,0,0,0,0,1,0,0,0,0,1)._t($r,-Ar,0,0,Ar,$r,0,0,0,0,1,0,0,0,0,1)}function At(rr,ar,$r){return!$r&&$r!==0&&($r=1),rr===1&&ar===1&&$r===1?this:this._t(rr,0,0,0,0,ar,0,0,0,0,$r,0,0,0,0,1)}function Nt(rr,ar,$r,Ar,Xr,us,Wr,Vs,yn,_n,zo,Cn,On,qr,Zs,Os){return this.props[0]=rr,this.props[1]=ar,this.props[2]=$r,this.props[3]=Ar,this.props[4]=Xr,this.props[5]=us,this.props[6]=Wr,this.props[7]=Vs,this.props[8]=yn,this.props[9]=_n,this.props[10]=zo,this.props[11]=Cn,this.props[12]=On,this.props[13]=qr,this.props[14]=Zs,this.props[15]=Os,this}function Vt(rr,ar,$r){return $r=$r||0,rr!==0||ar!==0||$r!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,rr,ar,$r,1):this}function zt(rr,ar,$r,Ar,Xr,us,Wr,Vs,yn,_n,zo,Cn,On,qr,Zs,Os){var Us=this.props;if(rr===1&&ar===0&&$r===0&&Ar===0&&Xr===0&&us===1&&Wr===0&&Vs===0&&yn===0&&_n===0&&zo===1&&Cn===0)return Us[12]=Us[12]*rr+Us[15]*On,Us[13]=Us[13]*us+Us[15]*qr,Us[14]=Us[14]*zo+Us[15]*Zs,Us[15]*=Os,this._identityCalculated=!1,this;var Nn=Us[0],cn=Us[1],Bn=Us[2],Pn=Us[3],Ro=Us[4],Ho=Us[5],Zn=Us[6],Qo=Us[7],Wo=Us[8],uo=Us[9],eo=Us[10],to=Us[11],Io=Us[12],ou=Us[13],Dl=Us[14],Jl=Us[15];return Us[0]=Nn*rr+cn*Xr+Bn*yn+Pn*On,Us[1]=Nn*ar+cn*us+Bn*_n+Pn*qr,Us[2]=Nn*$r+cn*Wr+Bn*zo+Pn*Zs,Us[3]=Nn*Ar+cn*Vs+Bn*Cn+Pn*Os,Us[4]=Ro*rr+Ho*Xr+Zn*yn+Qo*On,Us[5]=Ro*ar+Ho*us+Zn*_n+Qo*qr,Us[6]=Ro*$r+Ho*Wr+Zn*zo+Qo*Zs,Us[7]=Ro*Ar+Ho*Vs+Zn*Cn+Qo*Os,Us[8]=Wo*rr+uo*Xr+eo*yn+to*On,Us[9]=Wo*ar+uo*us+eo*_n+to*qr,Us[10]=Wo*$r+uo*Wr+eo*zo+to*Zs,Us[11]=Wo*Ar+uo*Vs+eo*Cn+to*Os,Us[12]=Io*rr+ou*Xr+Dl*yn+Jl*On,Us[13]=Io*ar+ou*us+Dl*_n+Jl*qr,Us[14]=Io*$r+ou*Wr+Dl*zo+Jl*Zs,Us[15]=Io*Ar+ou*Vs+Dl*Cn+Jl*Os,this._identityCalculated=!1,this}function Jt(rr){var ar=rr.props;return this.transform(ar[0],ar[1],ar[2],ar[3],ar[4],ar[5],ar[6],ar[7],ar[8],ar[9],ar[10],ar[11],ar[12],ar[13],ar[14],ar[15])}function Dt(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function It(rr){for(var ar=0;ar<16;){if(rr.props[ar]!==this.props[ar])return!1;ar+=1}return!0}function Mt(rr){var ar;for(ar=0;ar<16;ar+=1)rr.props[ar]=this.props[ar];return rr}function Ht(rr){var ar;for(ar=0;ar<16;ar+=1)this.props[ar]=rr[ar]}function tr(rr,ar,$r){return{x:rr*this.props[0]+ar*this.props[4]+$r*this.props[8]+this.props[12],y:rr*this.props[1]+ar*this.props[5]+$r*this.props[9]+this.props[13],z:rr*this.props[2]+ar*this.props[6]+$r*this.props[10]+this.props[14]}}function er(rr,ar,$r){return rr*this.props[0]+ar*this.props[4]+$r*this.props[8]+this.props[12]}function dr(rr,ar,$r){return rr*this.props[1]+ar*this.props[5]+$r*this.props[9]+this.props[13]}function mr(rr,ar,$r){return rr*this.props[2]+ar*this.props[6]+$r*this.props[10]+this.props[14]}function Ur(){var rr=this.props[0]*this.props[5]-this.props[1]*this.props[4],ar=this.props[5]/rr,$r=-this.props[1]/rr,Ar=-this.props[4]/rr,Xr=this.props[0]/rr,us=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/rr,Wr=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/rr,Vs=new Matrix;return Vs.props[0]=ar,Vs.props[1]=$r,Vs.props[4]=Ar,Vs.props[5]=Xr,Vs.props[12]=us,Vs.props[13]=Wr,Vs}function Dr(rr){var ar=this.getInverseMatrix();return ar.applyToPointArray(rr[0],rr[1],rr[2]||0)}function Yr(rr){var ar,$r=rr.length,Ar=[];for(ar=0;ar<$r;ar+=1)Ar[ar]=Dr(rr[ar]);return Ar}function es(rr,ar,$r){var Ar=createTypedArray("float32",6);if(this.isIdentity())Ar[0]=rr[0],Ar[1]=rr[1],Ar[2]=ar[0],Ar[3]=ar[1],Ar[4]=$r[0],Ar[5]=$r[1];else{var Xr=this.props[0],us=this.props[1],Wr=this.props[4],Vs=this.props[5],yn=this.props[12],_n=this.props[13];Ar[0]=rr[0]*Xr+rr[1]*Wr+yn,Ar[1]=rr[0]*us+rr[1]*Vs+_n,Ar[2]=ar[0]*Xr+ar[1]*Wr+yn,Ar[3]=ar[0]*us+ar[1]*Vs+_n,Ar[4]=$r[0]*Xr+$r[1]*Wr+yn,Ar[5]=$r[0]*us+$r[1]*Vs+_n}return Ar}function ms(rr,ar,$r){var Ar;return this.isIdentity()?Ar=[rr,ar,$r]:Ar=[rr*this.props[0]+ar*this.props[4]+$r*this.props[8]+this.props[12],rr*this.props[1]+ar*this.props[5]+$r*this.props[9]+this.props[13],rr*this.props[2]+ar*this.props[6]+$r*this.props[10]+this.props[14]],Ar}function Ms(rr,ar){if(this.isIdentity())return rr+","+ar;var $r=this.props;return Math.round((rr*$r[0]+ar*$r[4]+$r[12])*100)/100+","+Math.round((rr*$r[1]+ar*$r[5]+$r[13])*100)/100}function Kr(){for(var rr=0,ar=this.props,$r="matrix3d(",Ar=1e4;rr<16;)$r+=j(ar[rr]*Ar)/Ar,$r+=rr===15?")":",",rr+=1;return $r}function xr(rr){var ar=1e4;return rr<1e-6&&rr>0||rr>-1e-6&&rr<0?j(rr*ar)/ar:rr}function jr(){var rr=this.props,ar=xr(rr[0]),$r=xr(rr[1]),Ar=xr(rr[4]),Xr=xr(rr[5]),us=xr(rr[12]),Wr=xr(rr[13]);return"matrix("+ar+","+$r+","+Ar+","+Xr+","+us+","+Wr+")"}return function(){this.reset=_e,this.rotate=nt,this.rotateX=ct,this.rotateY=c,this.rotateZ=pt,this.skew=St,this.skewFromAxis=kt,this.shear=gt,this.scale=At,this.setTransform=Nt,this.translate=Vt,this.transform=zt,this.multiply=Jt,this.applyToPoint=tr,this.applyToX=er,this.applyToY=dr,this.applyToZ=mr,this.applyToPointArray=ms,this.applyToTriplePoints=es,this.applyToPointStringified=Ms,this.toCSS=Kr,this.to2dCSS=jr,this.clone=Mt,this.cloneFromProps=Ht,this.equals=It,this.inversePoints=Yr,this.inversePoint=Dr,this.getInverseMatrix=Ur,this._t=this.transform,this.isIdentity=Dt,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return _typeof$3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,i){e==="expressions"&&setExpressionsPlugin(i)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.13.0";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var i=queryString.split("&"),d=0;d<i.length;d+=1){var j=i[d].split("=");if(decodeURIComponent(j[0])==e)return decodeURIComponent(j[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports$1)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},i={};e.registerModifier=d,e.getModifier=j;function d(_e,nt){i[_e]||(i[_e]=nt)}function j(_e,nt,ct){return new i[_e](nt,ct)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var i={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(i),this.addShapeToModifier(i),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,i){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,i){this.s=PropertyFactory.getProp(e,i.s,0,.01,this),this.e=PropertyFactory.getProp(e,i.e,0,.01,this),this.o=PropertyFactory.getProp(e,i.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=i.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,i,d,j,_e){var nt=[];i<=1?nt.push({s:e,e:i}):e>=1?nt.push({s:e-1,e:i-1}):(nt.push({s:e,e:1}),nt.push({s:0,e:i-1}));var ct=[],c,pt=nt.length,gt;for(c=0;c<pt;c+=1)if(gt=nt[c],!(gt.e*_e<j||gt.s*_e>j+d)){var St,kt;gt.s*_e<=j?St=0:St=(gt.s*_e-j)/d,gt.e*_e>=j+d?kt=1:kt=(gt.e*_e-j)/d,ct.push([St,kt])}return ct.length||ct.push([0,0]),ct},TrimModifier.prototype.releasePathsData=function(e){var i,d=e.length;for(i=0;i<d;i+=1)segmentsLengthPool.release(e[i]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var i,d;if(this._mdf||e){var j=this.o.v%360/360;if(j<0&&(j+=1),this.s.v>1?i=1+j:this.s.v<0?i=0+j:i=this.s.v+j,this.e.v>1?d=1+j:this.e.v<0?d=0+j:d=this.e.v+j,i>d){var _e=i;i=d,d=_e}i=Math.round(i*1e4)*1e-4,d=Math.round(d*1e4)*1e-4,this.sValue=i,this.eValue=d}else i=this.sValue,d=this.eValue;var nt,ct,c=this.shapes.length,pt,gt,St,kt,At,Nt=0;if(d===i)for(ct=0;ct<c;ct+=1)this.shapes[ct].localShapeCollection.releaseShapes(),this.shapes[ct].shape._mdf=!0,this.shapes[ct].shape.paths=this.shapes[ct].localShapeCollection,this._mdf&&(this.shapes[ct].pathsData.length=0);else if(d===1&&i===0||d===0&&i===1){if(this._mdf)for(ct=0;ct<c;ct+=1)this.shapes[ct].pathsData.length=0,this.shapes[ct].shape._mdf=!0}else{var Vt=[],zt,Jt;for(ct=0;ct<c;ct+=1)if(zt=this.shapes[ct],!zt.shape._mdf&&!this._mdf&&!e&&this.m!==2)zt.shape.paths=zt.localShapeCollection;else{if(nt=zt.shape.paths,gt=nt._length,At=0,!zt.shape._mdf&&zt.pathsData.length)At=zt.totalShapeLength;else{for(St=this.releasePathsData(zt.pathsData),pt=0;pt<gt;pt+=1)kt=bez.getSegmentsLength(nt.shapes[pt]),St.push(kt),At+=kt.totalLength;zt.totalShapeLength=At,zt.pathsData=St}Nt+=At,zt.shape._mdf=!0}var Dt=i,It=d,Mt=0,Ht;for(ct=c-1;ct>=0;ct-=1)if(zt=this.shapes[ct],zt.shape._mdf){for(Jt=zt.localShapeCollection,Jt.releaseShapes(),this.m===2&&c>1?(Ht=this.calculateShapeEdges(i,d,zt.totalShapeLength,Mt,Nt),Mt+=zt.totalShapeLength):Ht=[[Dt,It]],gt=Ht.length,pt=0;pt<gt;pt+=1){Dt=Ht[pt][0],It=Ht[pt][1],Vt.length=0,It<=1?Vt.push({s:zt.totalShapeLength*Dt,e:zt.totalShapeLength*It}):Dt>=1?Vt.push({s:zt.totalShapeLength*(Dt-1),e:zt.totalShapeLength*(It-1)}):(Vt.push({s:zt.totalShapeLength*Dt,e:zt.totalShapeLength}),Vt.push({s:0,e:zt.totalShapeLength*(It-1)}));var tr=this.addShapes(zt,Vt[0]);if(Vt[0].s!==Vt[0].e){if(Vt.length>1){var er=zt.shape.paths.shapes[zt.shape.paths._length-1];if(er.c){var dr=tr.pop();this.addPaths(tr,Jt),tr=this.addShapes(zt,Vt[1],dr)}else this.addPaths(tr,Jt),tr=this.addShapes(zt,Vt[1])}this.addPaths(tr,Jt)}}zt.shape.paths=Jt}}},TrimModifier.prototype.addPaths=function(e,i){var d,j=e.length;for(d=0;d<j;d+=1)i.addShape(e[d])},TrimModifier.prototype.addSegment=function(e,i,d,j,_e,nt,ct){_e.setXYAt(i[0],i[1],"o",nt),_e.setXYAt(d[0],d[1],"i",nt+1),ct&&_e.setXYAt(e[0],e[1],"v",nt),_e.setXYAt(j[0],j[1],"v",nt+1)},TrimModifier.prototype.addSegmentFromArray=function(e,i,d,j){i.setXYAt(e[1],e[5],"o",d),i.setXYAt(e[2],e[6],"i",d+1),j&&i.setXYAt(e[0],e[4],"v",d),i.setXYAt(e[3],e[7],"v",d+1)},TrimModifier.prototype.addShapes=function(e,i,d){var j=e.pathsData,_e=e.shape.paths.shapes,nt,ct=e.shape.paths._length,c,pt,gt=0,St,kt,At,Nt,Vt=[],zt,Jt=!0;for(d?(kt=d._length,zt=d._length):(d=shapePool.newElement(),kt=0,zt=0),Vt.push(d),nt=0;nt<ct;nt+=1){for(At=j[nt].lengths,d.c=_e[nt].c,pt=_e[nt].c?At.length:At.length+1,c=1;c<pt;c+=1)if(St=At[c-1],gt+St.addedLength<i.s)gt+=St.addedLength,d.c=!1;else if(gt>i.e){d.c=!1;break}else i.s<=gt&&i.e>=gt+St.addedLength?(this.addSegment(_e[nt].v[c-1],_e[nt].o[c-1],_e[nt].i[c],_e[nt].v[c],d,kt,Jt),Jt=!1):(Nt=bez.getNewSegment(_e[nt].v[c-1],_e[nt].v[c],_e[nt].o[c-1],_e[nt].i[c],(i.s-gt)/St.addedLength,(i.e-gt)/St.addedLength,At[c-1]),this.addSegmentFromArray(Nt,d,kt,Jt),Jt=!1,d.c=!1),gt+=St.addedLength,kt+=1;if(_e[nt].c&&At.length){if(St=At[c-1],gt<=i.e){var Dt=At[c-1].addedLength;i.s<=gt&&i.e>=gt+Dt?(this.addSegment(_e[nt].v[c-1],_e[nt].o[c-1],_e[nt].i[0],_e[nt].v[0],d,kt,Jt),Jt=!1):(Nt=bez.getNewSegment(_e[nt].v[c-1],_e[nt].v[0],_e[nt].o[c-1],_e[nt].i[0],(i.s-gt)/Dt,(i.e-gt)/Dt,At[c-1]),this.addSegmentFromArray(Nt,d,kt,Jt),Jt=!1,d.c=!1)}else d.c=!1;gt+=St.addedLength,kt+=1}if(d._length&&(d.setXYAt(d.v[zt][0],d.v[zt][1],"i",zt),d.setXYAt(d.v[d._length-1][0],d.v[d._length-1][1],"o",d._length-1)),gt>i.e)break;nt<ct-1&&(d=shapePool.newElement(),Jt=!0,Vt.push(d),kt=0)}return Vt};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,i){var d=i/100,j=[0,0],_e=e._length,nt=0;for(nt=0;nt<_e;nt+=1)j[0]+=e.v[nt][0],j[1]+=e.v[nt][1];j[0]/=_e,j[1]/=_e;var ct=shapePool.newElement();ct.c=e.c;var c,pt,gt,St,kt,At;for(nt=0;nt<_e;nt+=1)c=e.v[nt][0]+(j[0]-e.v[nt][0])*d,pt=e.v[nt][1]+(j[1]-e.v[nt][1])*d,gt=e.o[nt][0]+(j[0]-e.o[nt][0])*-d,St=e.o[nt][1]+(j[1]-e.o[nt][1])*-d,kt=e.i[nt][0]+(j[0]-e.i[nt][0])*-d,At=e.i[nt][1]+(j[1]-e.i[nt][1])*-d,ct.setTripleAt(c,pt,gt,St,kt,At,nt);return ct},PuckerAndBloatModifier.prototype.processShapes=function(e){var i,d,j=this.shapes.length,_e,nt,ct=this.amount.v;if(ct!==0){var c,pt;for(d=0;d<j;d+=1){if(c=this.shapes[d],pt=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(pt.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,nt=c.shape.paths._length,_e=0;_e<nt;_e+=1)pt.addShape(this.processPath(i[_e],ct));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function i(pt){var gt=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||gt,this.a&&pt.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&pt.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&pt.skewFromAxis(-this.sk.v,this.sa.v),this.r?pt.rotate(-this.r.v):pt.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?pt.translate(this.px.v,this.py.v,-this.pz.v):pt.translate(this.px.v,this.py.v,0):pt.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function d(pt){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||pt){var gt;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var St,kt;if(gt=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(St=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/gt,0),kt=this.p.getValueAtTime(this.p.keyframes[0].t/gt,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(St=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/gt,0),kt=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/gt,0)):(St=this.p.pv,kt=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/gt,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){St=[],kt=[];var At=this.px,Nt=this.py;At._caching.lastFrame+At.offsetTime<=At.keyframes[0].t?(St[0]=At.getValueAtTime((At.keyframes[0].t+.01)/gt,0),St[1]=Nt.getValueAtTime((Nt.keyframes[0].t+.01)/gt,0),kt[0]=At.getValueAtTime(At.keyframes[0].t/gt,0),kt[1]=Nt.getValueAtTime(Nt.keyframes[0].t/gt,0)):At._caching.lastFrame+At.offsetTime>=At.keyframes[At.keyframes.length-1].t?(St[0]=At.getValueAtTime(At.keyframes[At.keyframes.length-1].t/gt,0),St[1]=Nt.getValueAtTime(Nt.keyframes[Nt.keyframes.length-1].t/gt,0),kt[0]=At.getValueAtTime((At.keyframes[At.keyframes.length-1].t-.01)/gt,0),kt[1]=Nt.getValueAtTime((Nt.keyframes[Nt.keyframes.length-1].t-.01)/gt,0)):(St=[At.pv,Nt.pv],kt[0]=At.getValueAtTime((At._caching.lastFrame+At.offsetTime-.01)/gt,At.offsetTime),kt[1]=Nt.getValueAtTime((Nt._caching.lastFrame+Nt.offsetTime-.01)/gt,Nt.offsetTime))}else kt=e,St=kt;this.v.rotate(-Math.atan2(St[1]-kt[1],St[0]-kt[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function j(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function _e(){}function nt(pt){this._addDynamicProperty(pt),this.elem.addDynamicProperty(pt),this._isDirty=!0}function ct(pt,gt,St){if(this.elem=pt,this.frameId=-1,this.propType="transform",this.data=gt,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(St||pt),gt.p&&gt.p.s?(this.px=PropertyFactory.getProp(pt,gt.p.x,0,0,this),this.py=PropertyFactory.getProp(pt,gt.p.y,0,0,this),gt.p.z&&(this.pz=PropertyFactory.getProp(pt,gt.p.z,0,0,this))):this.p=PropertyFactory.getProp(pt,gt.p||{k:[0,0,0]},1,0,this),gt.rx){if(this.rx=PropertyFactory.getProp(pt,gt.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(pt,gt.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(pt,gt.rz,0,degToRads,this),gt.or.k[0].ti){var kt,At=gt.or.k.length;for(kt=0;kt<At;kt+=1)gt.or.k[kt].to=null,gt.or.k[kt].ti=null}this.or=PropertyFactory.getProp(pt,gt.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(pt,gt.r||{k:0},0,degToRads,this);gt.sk&&(this.sk=PropertyFactory.getProp(pt,gt.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(pt,gt.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(pt,gt.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(pt,gt.s||{k:[100,100,100]},1,.01,this),gt.o?this.o=PropertyFactory.getProp(pt,gt.o,0,.01,pt):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}ct.prototype={applyToMatrix:i,getValue:d,precalculateMatrix:j,autoOrient:_e},extendPrototype([DynamicPropertyContainer],ct),ct.prototype.addDynamicProperty=nt,ct.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function c(pt,gt,St){return new ct(pt,gt,St)}return{getTransformProperty:c}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,i.c,0,null,this),this.o=PropertyFactory.getProp(e,i.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,i.tr,this),this.so=PropertyFactory.getProp(e,i.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,i.tr.eo,0,.01,this),this.data=i,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,i,d,j,_e,nt){var ct=nt?-1:1,c=j.s.v[0]+(1-j.s.v[0])*(1-_e),pt=j.s.v[1]+(1-j.s.v[1])*(1-_e);e.translate(j.p.v[0]*ct*_e,j.p.v[1]*ct*_e,j.p.v[2]),i.translate(-j.a.v[0],-j.a.v[1],j.a.v[2]),i.rotate(-j.r.v*ct*_e),i.translate(j.a.v[0],j.a.v[1],j.a.v[2]),d.translate(-j.a.v[0],-j.a.v[1],j.a.v[2]),d.scale(nt?1/c:c,nt?1/pt:pt),d.translate(j.a.v[0],j.a.v[1],j.a.v[2])},RepeaterModifier.prototype.init=function(e,i,d,j){for(this.elem=e,this.arr=i,this.pos=d,this.elemsData=j,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,i[d]);d>0;)d-=1,this._elements.unshift(i[d]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var i,d=e.length;for(i=0;i<d;i+=1)e[i]._processed=!1,e[i].ty==="gr"&&this.resetElements(e[i].it)},RepeaterModifier.prototype.cloneElements=function(e){var i=JSON.parse(JSON.stringify(e));return this.resetElements(i),i},RepeaterModifier.prototype.changeGroupRender=function(e,i){var d,j=e.length;for(d=0;d<j;d+=1)e[d]._render=i,e[d].ty==="gr"&&this.changeGroupRender(e[d].it,i)},RepeaterModifier.prototype.processShapes=function(e){var i,d,j,_e,nt,ct=!1;if(this._mdf||e){var c=Math.ceil(this.c.v);if(this._groups.length<c){for(;this._groups.length<c;){var pt={it:this.cloneElements(this._elements),ty:"gr"};pt.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,pt),this._groups.splice(0,0,pt),this._currentCopies+=1}this.elem.reloadShapes(),ct=!0}nt=0;var gt;for(j=0;j<=this._groups.length-1;j+=1){if(gt=nt<c,this._groups[j]._render=gt,this.changeGroupRender(this._groups[j].it,gt),!gt){var St=this.elemsData[j].it,kt=St[St.length-1];kt.transform.op.v!==0?(kt.transform.op._mdf=!0,kt.transform.op.v=0):kt.transform.op._mdf=!1}nt+=1}this._currentCopies=c;var At=this.o.v,Nt=At%1,Vt=At>0?Math.floor(At):Math.ceil(At),zt=this.pMatrix.props,Jt=this.rMatrix.props,Dt=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var It=0;if(At>0){for(;It<Vt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),It+=1;Nt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,Nt,!1),It+=Nt)}else if(At<0){for(;It>Vt;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),It-=1;Nt&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-Nt,!0),It-=Nt)}j=this.data.m===1?0:this._currentCopies-1,_e=this.data.m===1?1:-1,nt=this._currentCopies;for(var Mt,Ht;nt;){if(i=this.elemsData[j].it,d=i[i.length-1].transform.mProps.v.props,Ht=d.length,i[i.length-1].transform.mProps._mdf=!0,i[i.length-1].transform.op._mdf=!0,i[i.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(j/(this._currentCopies-1)),It!==0){for((j!==0&&_e===1||j!==this._currentCopies-1&&_e===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(Jt[0],Jt[1],Jt[2],Jt[3],Jt[4],Jt[5],Jt[6],Jt[7],Jt[8],Jt[9],Jt[10],Jt[11],Jt[12],Jt[13],Jt[14],Jt[15]),this.matrix.transform(Dt[0],Dt[1],Dt[2],Dt[3],Dt[4],Dt[5],Dt[6],Dt[7],Dt[8],Dt[9],Dt[10],Dt[11],Dt[12],Dt[13],Dt[14],Dt[15]),this.matrix.transform(zt[0],zt[1],zt[2],zt[3],zt[4],zt[5],zt[6],zt[7],zt[8],zt[9],zt[10],zt[11],zt[12],zt[13],zt[14],zt[15]),Mt=0;Mt<Ht;Mt+=1)d[Mt]=this.matrix.props[Mt];this.matrix.reset()}else for(this.matrix.reset(),Mt=0;Mt<Ht;Mt+=1)d[Mt]=this.matrix.props[Mt];It+=1,nt-=1,j+=_e}}else for(nt=this._currentCopies,j=0,_e=1;nt;)i=this.elemsData[j].it,d=i[i.length-1].transform.mProps.v.props,i[i.length-1].transform.mProps._mdf=!1,i[i.length-1].transform.op._mdf=!1,nt-=1,j+=_e;return ct},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,i.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,i){var d=shapePool.newElement();d.c=e.c;var j,_e=e._length,nt,ct,c,pt,gt,St,kt=0,At,Nt,Vt,zt,Jt,Dt;for(j=0;j<_e;j+=1)nt=e.v[j],c=e.o[j],ct=e.i[j],nt[0]===c[0]&&nt[1]===c[1]&&nt[0]===ct[0]&&nt[1]===ct[1]?(j===0||j===_e-1)&&!e.c?(d.setTripleAt(nt[0],nt[1],c[0],c[1],ct[0],ct[1],kt),kt+=1):(j===0?pt=e.v[_e-1]:pt=e.v[j-1],gt=Math.sqrt(Math.pow(nt[0]-pt[0],2)+Math.pow(nt[1]-pt[1],2)),St=gt?Math.min(gt/2,i)/gt:0,Jt=nt[0]+(pt[0]-nt[0])*St,At=Jt,Dt=nt[1]-(nt[1]-pt[1])*St,Nt=Dt,Vt=At-(At-nt[0])*roundCorner,zt=Nt-(Nt-nt[1])*roundCorner,d.setTripleAt(At,Nt,Vt,zt,Jt,Dt,kt),kt+=1,j===_e-1?pt=e.v[0]:pt=e.v[j+1],gt=Math.sqrt(Math.pow(nt[0]-pt[0],2)+Math.pow(nt[1]-pt[1],2)),St=gt?Math.min(gt/2,i)/gt:0,Vt=nt[0]+(pt[0]-nt[0])*St,At=Vt,zt=nt[1]+(pt[1]-nt[1])*St,Nt=zt,Jt=At-(At-nt[0])*roundCorner,Dt=Nt-(Nt-nt[1])*roundCorner,d.setTripleAt(At,Nt,Vt,zt,Jt,Dt,kt),kt+=1):(d.setTripleAt(e.v[j][0],e.v[j][1],e.o[j][0],e.o[j][1],e.i[j][0],e.i[j][1],kt),kt+=1);return d},RoundCornersModifier.prototype.processShapes=function(e){var i,d,j=this.shapes.length,_e,nt,ct=this.rd.v;if(ct!==0){var c,pt;for(d=0;d<j;d+=1){if(c=this.shapes[d],pt=c.localShapeCollection,!(!c.shape._mdf&&!this._mdf&&!e))for(pt.releaseShapes(),c.shape._mdf=!0,i=c.shape.paths.shapes,nt=c.shape.paths._length,_e=0;_e<nt;_e+=1)pt.addShape(this.processPath(i[_e],ct));c.shape.paths=c.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,i){return Math.abs(e-i)*1e5<=Math.min(Math.abs(e),Math.abs(i))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,i,d){return e*(1-d)+i*d}function lerpPoint(e,i,d){return[lerp(e[0],i[0],d),lerp(e[1],i[1],d)]}function quadRoots(e,i,d){if(e===0)return[];var j=i*i-4*e*d;if(j<0)return[];var _e=-i/(2*e);if(j===0)return[_e];var nt=Math.sqrt(j)/(2*e);return[_e-nt,_e+nt]}function polynomialCoefficients(e,i,d,j){return[-e+3*i-3*d+j,3*e-6*i+3*d,-3*e+3*i,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,i,d,j,_e){_e&&pointEqual(e,i)&&(i=lerpPoint(e,j,1/3)),_e&&pointEqual(d,j)&&(d=lerpPoint(e,j,2/3));var nt=polynomialCoefficients(e[0],i[0],d[0],j[0]),ct=polynomialCoefficients(e[1],i[1],d[1],j[1]);this.a=[nt[0],ct[0]],this.b=[nt[1],ct[1]],this.c=[nt[2],ct[2]],this.d=[nt[3],ct[3]],this.points=[e,i,d,j]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var i=this.derivative(e);return Math.atan2(i[1],i[0])},PolynomialBezier.prototype.normalAngle=function(e){var i=this.derivative(e);return Math.atan2(i[0],i[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var i=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,d=i*i-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(d<0)return[];var j=Math.sqrt(d);return floatZero(j)?j>0&&j<1?[i]:[]:[i-j,i+j].filter(function(_e){return _e>0&&_e<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var i=lerpPoint(this.points[0],this.points[1],e),d=lerpPoint(this.points[1],this.points[2],e),j=lerpPoint(this.points[2],this.points[3],e),_e=lerpPoint(i,d,e),nt=lerpPoint(d,j,e),ct=lerpPoint(_e,nt,e);return[new PolynomialBezier(this.points[0],i,_e,ct,!0),new PolynomialBezier(ct,nt,j,this.points[3],!0)]};function extrema(e,i){var d=e.points[0][i],j=e.points[e.points.length-1][i];if(d>j){var _e=j;j=d,d=_e}for(var nt=quadRoots(3*e.a[i],2*e.b[i],e.c[i]),ct=0;ct<nt.length;ct+=1)if(nt[ct]>0&&nt[ct]<1){var c=e.point(nt[ct])[i];c<d?d=c:c>j&&(j=c)}return{min:d,max:j}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,i,d){var j=e.boundingBox();return{cx:j.cx,cy:j.cy,width:j.width,height:j.height,bez:e,t:(i+d)/2,t1:i,t2:d}}function splitData(e){var i=e.bez.split(.5);return[intersectData(i[0],e.t1,e.t),intersectData(i[1],e.t,e.t2)]}function boxIntersect(e,i){return Math.abs(e.cx-i.cx)*2<e.width+i.width&&Math.abs(e.cy-i.cy)*2<e.height+i.height}function intersectsImpl(e,i,d,j,_e,nt){if(boxIntersect(e,i)){if(d>=nt||e.width<=j&&e.height<=j&&i.width<=j&&i.height<=j){_e.push([e.t,i.t]);return}var ct=splitData(e),c=splitData(i);intersectsImpl(ct[0],c[0],d+1,j,_e,nt),intersectsImpl(ct[0],c[1],d+1,j,_e,nt),intersectsImpl(ct[1],c[0],d+1,j,_e,nt),intersectsImpl(ct[1],c[1],d+1,j,_e,nt)}}PolynomialBezier.prototype.intersections=function(e,i,d){i===void 0&&(i=2),d===void 0&&(d=7);var j=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,i,j,d),j},PolynomialBezier.shapeSegment=function(e,i){var d=(i+1)%e.length();return new PolynomialBezier(e.v[i],e.o[i],e.i[d],e.v[d],!0)},PolynomialBezier.shapeSegmentInverted=function(e,i){var d=(i+1)%e.length();return new PolynomialBezier(e.v[d],e.i[d],e.o[i],e.v[i],!0)};function crossProduct(e,i){return[e[1]*i[2]-e[2]*i[1],e[2]*i[0]-e[0]*i[2],e[0]*i[1]-e[1]*i[0]]}function lineIntersection(e,i,d,j){var _e=[e[0],e[1],1],nt=[i[0],i[1],1],ct=[d[0],d[1],1],c=[j[0],j[1],1],pt=crossProduct(crossProduct(_e,nt),crossProduct(ct,c));return floatZero(pt[2])?null:[pt[0]/pt[2],pt[1]/pt[2]]}function polarOffset(e,i,d){return[e[0]+Math.cos(i)*d,e[1]-Math.sin(i)*d]}function pointDistance(e,i){return Math.hypot(e[0]-i[0],e[1]-i[1])}function pointEqual(e,i){return floatEqual(e[0],i[0])&&floatEqual(e[1],i[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,i.s,0,null,this),this.frequency=PropertyFactory.getProp(e,i.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,i.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,i,d,j,_e,nt,ct){var c=d-Math.PI/2,pt=d+Math.PI/2,gt=i[0]+Math.cos(d)*j*_e,St=i[1]-Math.sin(d)*j*_e;e.setTripleAt(gt,St,gt+Math.cos(c)*nt,St-Math.sin(c)*nt,gt+Math.cos(pt)*ct,St-Math.sin(pt)*ct,e.length())}function getPerpendicularVector(e,i){var d=[i[0]-e[0],i[1]-e[1]],j=-Math.PI*.5,_e=[Math.cos(j)*d[0]-Math.sin(j)*d[1],Math.sin(j)*d[0]+Math.cos(j)*d[1]];return _e}function getProjectingAngle(e,i){var d=i===0?e.length()-1:i-1,j=(i+1)%e.length(),_e=e.v[d],nt=e.v[j],ct=getPerpendicularVector(_e,nt);return Math.atan2(0,1)-Math.atan2(ct[1],ct[0])}function zigZagCorner(e,i,d,j,_e,nt,ct){var c=getProjectingAngle(i,d),pt=i.v[d%i._length],gt=i.v[d===0?i._length-1:d-1],St=i.v[(d+1)%i._length],kt=nt===2?Math.sqrt(Math.pow(pt[0]-gt[0],2)+Math.pow(pt[1]-gt[1],2)):0,At=nt===2?Math.sqrt(Math.pow(pt[0]-St[0],2)+Math.pow(pt[1]-St[1],2)):0;setPoint(e,i.v[d%i._length],c,ct,j,At/((_e+1)*2),kt/((_e+1)*2))}function zigZagSegment(e,i,d,j,_e,nt){for(var ct=0;ct<j;ct+=1){var c=(ct+1)/(j+1),pt=_e===2?Math.sqrt(Math.pow(i.points[3][0]-i.points[0][0],2)+Math.pow(i.points[3][1]-i.points[0][1],2)):0,gt=i.normalAngle(c),St=i.point(c);setPoint(e,St,gt,nt,d,pt/((j+1)*2),pt/((j+1)*2)),nt=-nt}return nt}ZigZagModifier.prototype.processPath=function(e,i,d,j){var _e=e._length,nt=shapePool.newElement();if(nt.c=e.c,e.c||(_e-=1),_e===0)return nt;var ct=-1,c=PolynomialBezier.shapeSegment(e,0);zigZagCorner(nt,e,0,i,d,j,ct);for(var pt=0;pt<_e;pt+=1)ct=zigZagSegment(nt,c,i,d,j,-ct),pt===_e-1&&!e.c?c=null:c=PolynomialBezier.shapeSegment(e,(pt+1)%_e),zigZagCorner(nt,e,pt+1,i,d,j,ct);return nt},ZigZagModifier.prototype.processShapes=function(e){var i,d,j=this.shapes.length,_e,nt,ct=this.amplitude.v,c=Math.max(0,Math.round(this.frequency.v)),pt=this.pointsType.v;if(ct!==0){var gt,St;for(d=0;d<j;d+=1){if(gt=this.shapes[d],St=gt.localShapeCollection,!(!gt.shape._mdf&&!this._mdf&&!e))for(St.releaseShapes(),gt.shape._mdf=!0,i=gt.shape.paths.shapes,nt=gt.shape.paths._length,_e=0;_e<nt;_e+=1)St.addShape(this.processPath(i[_e],ct,c,pt));gt.shape.paths=gt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,i,d){var j=Math.atan2(i[0]-e[0],i[1]-e[1]);return[polarOffset(e,j,d),polarOffset(i,j,d)]}function offsetSegment(e,i){var d,j,_e,nt,ct,c,pt;pt=linearOffset(e.points[0],e.points[1],i),d=pt[0],j=pt[1],pt=linearOffset(e.points[1],e.points[2],i),_e=pt[0],nt=pt[1],pt=linearOffset(e.points[2],e.points[3],i),ct=pt[0],c=pt[1];var gt=lineIntersection(d,j,_e,nt);gt===null&&(gt=j);var St=lineIntersection(ct,c,_e,nt);return St===null&&(St=ct),new PolynomialBezier(d,gt,St,c)}function joinLines(e,i,d,j,_e){var nt=i.points[3],ct=d.points[0];if(j===3||pointEqual(nt,ct))return nt;if(j===2){var c=-i.tangentAngle(1),pt=-d.tangentAngle(0)+Math.PI,gt=lineIntersection(nt,polarOffset(nt,c+Math.PI/2,100),ct,polarOffset(ct,c+Math.PI/2,100)),St=gt?pointDistance(gt,nt):pointDistance(nt,ct)/2,kt=polarOffset(nt,c,2*St*roundCorner);return e.setXYAt(kt[0],kt[1],"o",e.length()-1),kt=polarOffset(ct,pt,2*St*roundCorner),e.setTripleAt(ct[0],ct[1],ct[0],ct[1],kt[0],kt[1],e.length()),ct}var At=pointEqual(nt,i.points[2])?i.points[0]:i.points[2],Nt=pointEqual(ct,d.points[1])?d.points[3]:d.points[1],Vt=lineIntersection(At,nt,ct,Nt);return Vt&&pointDistance(Vt,nt)<_e?(e.setTripleAt(Vt[0],Vt[1],Vt[0],Vt[1],Vt[0],Vt[1],e.length()),Vt):nt}function getIntersection(e,i){var d=e.intersections(i);return d.length&&floatEqual(d[0][0],1)&&d.shift(),d.length?d[0]:null}function pruneSegmentIntersection(e,i){var d=e.slice(),j=i.slice(),_e=getIntersection(e[e.length-1],i[0]);return _e&&(d[e.length-1]=e[e.length-1].split(_e[0])[0],j[0]=i[0].split(_e[1])[1]),e.length>1&&i.length>1&&(_e=getIntersection(e[0],i[i.length-1]),_e)?[[e[0].split(_e[0])[0]],[i[i.length-1].split(_e[1])[1]]]:[d,j]}function pruneIntersections(e){for(var i,d=1;d<e.length;d+=1)i=pruneSegmentIntersection(e[d-1],e[d]),e[d-1]=i[0],e[d]=i[1];return e.length>1&&(i=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=i[0],e[0]=i[1]),e}function offsetSegmentSplit(e,i){var d=e.inflectionPoints(),j,_e,nt,ct;if(d.length===0)return[offsetSegment(e,i)];if(d.length===1||floatEqual(d[1],1))return nt=e.split(d[0]),j=nt[0],_e=nt[1],[offsetSegment(j,i),offsetSegment(_e,i)];nt=e.split(d[0]),j=nt[0];var c=(d[1]-d[0])/(1-d[0]);return nt=nt[1].split(c),ct=nt[0],_e=nt[1],[offsetSegment(j,i),offsetSegment(ct,i),offsetSegment(_e,i)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,i){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,i.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,i.ml,0,null,this),this.lineJoin=i.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,i,d,j){var _e=shapePool.newElement();_e.c=e.c;var nt=e.length();e.c||(nt-=1);var ct,c,pt,gt=[];for(ct=0;ct<nt;ct+=1)pt=PolynomialBezier.shapeSegment(e,ct),gt.push(offsetSegmentSplit(pt,i));if(!e.c)for(ct=nt-1;ct>=0;ct-=1)pt=PolynomialBezier.shapeSegmentInverted(e,ct),gt.push(offsetSegmentSplit(pt,i));gt=pruneIntersections(gt);var St=null,kt=null;for(ct=0;ct<gt.length;ct+=1){var At=gt[ct];for(kt&&(St=joinLines(_e,kt,At[0],d,j)),kt=At[At.length-1],c=0;c<At.length;c+=1)pt=At[c],St&&pointEqual(pt.points[0],St)?_e.setXYAt(pt.points[1][0],pt.points[1][1],"o",_e.length()-1):_e.setTripleAt(pt.points[0][0],pt.points[0][1],pt.points[1][0],pt.points[1][1],pt.points[0][0],pt.points[0][1],_e.length()),_e.setTripleAt(pt.points[3][0],pt.points[3][1],pt.points[3][0],pt.points[3][1],pt.points[2][0],pt.points[2][1],_e.length()),St=pt.points[3]}return gt.length&&joinLines(_e,kt,gt[0][0],d,j),_e},OffsetPathModifier.prototype.processShapes=function(e){var i,d,j=this.shapes.length,_e,nt,ct=this.amount.v,c=this.miterLimit.v,pt=this.lineJoin;if(ct!==0){var gt,St;for(d=0;d<j;d+=1){if(gt=this.shapes[d],St=gt.localShapeCollection,!(!gt.shape._mdf&&!this._mdf&&!e))for(St.releaseShapes(),gt.shape._mdf=!0,i=gt.shape.paths.shapes,nt=gt.shape.paths._length,_e=0;_e<nt;_e+=1)St.addShape(this.processPath(i[_e],ct,pt,c));gt.shape.paths=gt.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var i=e.fStyle?e.fStyle.split(" "):[],d="normal",j="normal",_e=i.length,nt,ct=0;ct<_e;ct+=1)switch(nt=i[ct].toLowerCase(),nt){case"italic":j="italic";break;case"bold":d="700";break;case"black":d="900";break;case"medium":d="500";break;case"regular":case"normal":d="400";break;case"light":case"thin":d="200";break}return{style:j,weight:e.fWeight||d}}var FontManager=function(){var e=5e3,i={w:0,size:0,shapes:[],data:{shapes:[]}},d=[];d=d.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var j=127988,_e=917631,nt=917601,ct=917626,c=65039,pt=8205,gt=127462,St=127487,kt=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function At(xr){var jr=xr.split(","),rr,ar=jr.length,$r=[];for(rr=0;rr<ar;rr+=1)jr[rr]!=="sans-serif"&&jr[rr]!=="monospace"&&$r.push(jr[rr]);return $r.join(",")}function Nt(xr,jr){var rr=createTag("span");rr.setAttribute("aria-hidden",!0),rr.style.fontFamily=jr;var ar=createTag("span");ar.innerText="giItT1WQy@!-/#",rr.style.position="absolute",rr.style.left="-10000px",rr.style.top="-10000px",rr.style.fontSize="300px",rr.style.fontVariant="normal",rr.style.fontStyle="normal",rr.style.fontWeight="normal",rr.style.letterSpacing="0",rr.appendChild(ar),document.body.appendChild(rr);var $r=ar.offsetWidth;return ar.style.fontFamily=At(xr)+", "+jr,{node:ar,w:$r,parent:rr}}function Vt(){var xr,jr=this.fonts.length,rr,ar,$r=jr;for(xr=0;xr<jr;xr+=1)this.fonts[xr].loaded?$r-=1:this.fonts[xr].fOrigin==="n"||this.fonts[xr].origin===0?this.fonts[xr].loaded=!0:(rr=this.fonts[xr].monoCase.node,ar=this.fonts[xr].monoCase.w,rr.offsetWidth!==ar?($r-=1,this.fonts[xr].loaded=!0):(rr=this.fonts[xr].sansCase.node,ar=this.fonts[xr].sansCase.w,rr.offsetWidth!==ar&&($r-=1,this.fonts[xr].loaded=!0)),this.fonts[xr].loaded&&(this.fonts[xr].sansCase.parent.parentNode.removeChild(this.fonts[xr].sansCase.parent),this.fonts[xr].monoCase.parent.parentNode.removeChild(this.fonts[xr].monoCase.parent)));$r!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function zt(xr,jr){var rr=document.body&&jr?"svg":"canvas",ar,$r=getFontProperties(xr);if(rr==="svg"){var Ar=createNS("text");Ar.style.fontSize="100px",Ar.setAttribute("font-family",xr.fFamily),Ar.setAttribute("font-style",$r.style),Ar.setAttribute("font-weight",$r.weight),Ar.textContent="1",xr.fClass?(Ar.style.fontFamily="inherit",Ar.setAttribute("class",xr.fClass)):Ar.style.fontFamily=xr.fFamily,jr.appendChild(Ar),ar=Ar}else{var Xr=new OffscreenCanvas(500,500).getContext("2d");Xr.font=$r.style+" "+$r.weight+" 100px "+xr.fFamily,ar=Xr}function us(Wr){return rr==="svg"?(ar.textContent=Wr,ar.getComputedTextLength()):ar.measureText(Wr).width}return{measureText:us}}function Jt(xr,jr){if(!xr){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=xr.list;return}if(!document.body){this.isLoaded=!0,xr.list.forEach(function(zo){zo.helper=zt(zo),zo.cache={}}),this.fonts=xr.list;return}var rr=xr.list,ar,$r=rr.length,Ar=$r;for(ar=0;ar<$r;ar+=1){var Xr=!0,us,Wr;if(rr[ar].loaded=!1,rr[ar].monoCase=Nt(rr[ar].fFamily,"monospace"),rr[ar].sansCase=Nt(rr[ar].fFamily,"sans-serif"),!rr[ar].fPath)rr[ar].loaded=!0,Ar-=1;else if(rr[ar].fOrigin==="p"||rr[ar].origin===3){if(us=document.querySelectorAll('style[f-forigin="p"][f-family="'+rr[ar].fFamily+'"], style[f-origin="3"][f-family="'+rr[ar].fFamily+'"]'),us.length>0&&(Xr=!1),Xr){var Vs=createTag("style");Vs.setAttribute("f-forigin",rr[ar].fOrigin),Vs.setAttribute("f-origin",rr[ar].origin),Vs.setAttribute("f-family",rr[ar].fFamily),Vs.type="text/css",Vs.innerText="@font-face {font-family: "+rr[ar].fFamily+"; font-style: normal; src: url('"+rr[ar].fPath+"');}",jr.appendChild(Vs)}}else if(rr[ar].fOrigin==="g"||rr[ar].origin===1){for(us=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),Wr=0;Wr<us.length;Wr+=1)us[Wr].href.indexOf(rr[ar].fPath)!==-1&&(Xr=!1);if(Xr){var yn=createTag("link");yn.setAttribute("f-forigin",rr[ar].fOrigin),yn.setAttribute("f-origin",rr[ar].origin),yn.type="text/css",yn.rel="stylesheet",yn.href=rr[ar].fPath,document.body.appendChild(yn)}}else if(rr[ar].fOrigin==="t"||rr[ar].origin===2){for(us=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),Wr=0;Wr<us.length;Wr+=1)rr[ar].fPath===us[Wr].src&&(Xr=!1);if(Xr){var _n=createTag("link");_n.setAttribute("f-forigin",rr[ar].fOrigin),_n.setAttribute("f-origin",rr[ar].origin),_n.setAttribute("rel","stylesheet"),_n.setAttribute("href",rr[ar].fPath),jr.appendChild(_n)}}rr[ar].helper=zt(rr[ar],jr),rr[ar].cache={},this.fonts.push(rr[ar])}Ar===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function Dt(xr){if(xr){this.chars||(this.chars=[]);var jr,rr=xr.length,ar,$r=this.chars.length,Ar;for(jr=0;jr<rr;jr+=1){for(ar=0,Ar=!1;ar<$r;)this.chars[ar].style===xr[jr].style&&this.chars[ar].fFamily===xr[jr].fFamily&&this.chars[ar].ch===xr[jr].ch&&(Ar=!0),ar+=1;Ar||(this.chars.push(xr[jr]),$r+=1)}}}function It(xr,jr,rr){for(var ar=0,$r=this.chars.length;ar<$r;){if(this.chars[ar].ch===xr&&this.chars[ar].style===jr&&this.chars[ar].fFamily===rr)return this.chars[ar];ar+=1}return(typeof xr=="string"&&xr.charCodeAt(0)!==13||!xr)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",xr,jr,rr)),i}function Mt(xr,jr,rr){var ar=this.getFontByName(jr),$r=xr;if(!ar.cache[$r]){var Ar=ar.helper;if(xr===" "){var Xr=Ar.measureText("|"+xr+"|"),us=Ar.measureText("||");ar.cache[$r]=(Xr-us)/100}else ar.cache[$r]=Ar.measureText(xr)/100}return ar.cache[$r]*rr}function Ht(xr){for(var jr=0,rr=this.fonts.length;jr<rr;){if(this.fonts[jr].fName===xr)return this.fonts[jr];jr+=1}return this.fonts[0]}function tr(xr){var jr=0,rr=xr.charCodeAt(0);if(rr>=55296&&rr<=56319){var ar=xr.charCodeAt(1);ar>=56320&&ar<=57343&&(jr=(rr-55296)*1024+ar-56320+65536)}return jr}function er(xr,jr){var rr=xr.toString(16)+jr.toString(16);return kt.indexOf(rr)!==-1}function dr(xr){return xr===pt}function mr(xr){return xr===c}function Ur(xr){var jr=tr(xr);return jr>=gt&&jr<=St}function Dr(xr){return Ur(xr.substr(0,2))&&Ur(xr.substr(2,2))}function Yr(xr){return d.indexOf(xr)!==-1}function es(xr,jr){var rr=tr(xr.substr(jr,2));if(rr!==j)return!1;var ar=0;for(jr+=2;ar<5;){if(rr=tr(xr.substr(jr,2)),rr<nt||rr>ct)return!1;ar+=1,jr+=2}return tr(xr.substr(jr,2))===_e}function ms(){this.isLoaded=!0}var Ms=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};Ms.isModifier=er,Ms.isZeroWidthJoiner=dr,Ms.isFlagEmoji=Dr,Ms.isRegionalCode=Ur,Ms.isCombinedCharacter=Yr,Ms.isRegionalFlag=es,Ms.isVariationSelector=mr,Ms.BLACK_FLAG_CODE_POINT=j;var Kr={addChars:Dt,addFonts:Jt,getCharData:It,getFontByName:Ht,measureText:Mt,checkLoadedFonts:Vt,setIsLoaded:ms};return Ms.prototype=Kr,Ms}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(i){this.renderableComponents.indexOf(i)===-1&&this.renderableComponents.push(i)},removeRenderableComponent:function(i){this.renderableComponents.indexOf(i)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(i),1)},prepareRenderableFrame:function(i){this.checkLayerLimits(i)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(i){this.data.ip-this.data.st<=i&&this.data.op-this.data.st>i?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var i,d=this.renderableComponents.length;for(i=0;i<d;i+=1)this.renderableComponents[i].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(i){return e[i]||""}}();function SliderEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,0,0,d)}function AngleEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,0,0,d)}function ColorEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,1,0,d)}function PointEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,1,0,d)}function LayerIndexEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,0,0,d)}function MaskIndexEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,0,0,d)}function CheckboxEffect(e,i,d){this.p=PropertyFactory.getProp(i,e.v,0,0,d)}function NoValueEffect(){this.p={}}function EffectsManager(e,i){var d=e.ef||[];this.effectElements=[];var j,_e=d.length,nt;for(j=0;j<_e;j+=1)nt=new GroupEffect(d[j],i),this.effectElements.push(nt)}function GroupEffect(e,i){this.init(e,i)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,i){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(i);var d,j=this.data.ef.length,_e,nt=this.data.ef;for(d=0;d<j;d+=1){switch(_e=null,nt[d].ty){case 0:_e=new SliderEffect(nt[d],i,this);break;case 1:_e=new AngleEffect(nt[d],i,this);break;case 2:_e=new ColorEffect(nt[d],i,this);break;case 3:_e=new PointEffect(nt[d],i,this);break;case 4:case 7:_e=new CheckboxEffect(nt[d],i,this);break;case 10:_e=new LayerIndexEffect(nt[d],i,this);break;case 11:_e=new MaskIndexEffect(nt[d],i,this);break;case 5:_e=new EffectsManager(nt[d],i);break;default:_e=new NoValueEffect(nt[d]);break}_e&&this.effectElements.push(_e)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var i=0,d=this.data.masksProperties.length;i<d;){if(this.data.masksProperties[i].mode!=="n"&&this.data.masksProperties[i].cl!==!1)return!0;i+=1}return!1},initExpressions:function(){var i=getExpressionInterfaces();if(i){var d=i("layer"),j=i("effects"),_e=i("shape"),nt=i("text"),ct=i("comp");this.layerInterface=d(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var c=j.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(c),this.data.ty===0||this.data.xt?this.compInterface=ct(this):this.data.ty===4?(this.layerInterface.shapeInterface=_e(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=nt(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var i=getBlendMode(this.data.bm),d=this.baseElement||this.layerElement;d.style["mix-blend-mode"]=i},initBaseData:function(i,d,j){this.globalData=d,this.comp=j,this.data=i,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(i,d){var j,_e=this.dynamicProperties.length;for(j=0;j<_e;j+=1)(d||this._isParent&&this.dynamicProperties[j].propType==="transform")&&(this.dynamicProperties[j].getValue(),this.dynamicProperties[j]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(i){this.dynamicProperties.indexOf(i)===-1&&this.dynamicProperties.push(i)}};function FootageElement(e,i,d){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.footageData=i.imageLoader.getAsset(this.assetData),this.initBaseData(e,i,d)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var i=e("footage");this.layerInterface=i(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,i,d){this.initFrame(),this.initRenderable(),this.assetData=i.getAssetData(e.refId),this.initBaseData(e,i,d),this._isPlaying=!1,this._canPlay=!1;var j=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(j),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var i=this.tm.v;this._currentTime=i}this._volume=this.lv.v[0];var d=this._volume*this._volumeMultiplier;this._previousVolume!==d&&(this._previousVolume=d,this.audio.volume(d))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var i,d=this.layers.length,j;for(this.completeLayers=!0,i=d-1;i>=0;i-=1)this.elements[i]||(j=this.layers[i],j.ip-j.st<=e-this.layers[i].st&&j.op-j.st>e-this.layers[i].st&&this.buildItem(i)),this.completeLayers=this.elements[i]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var i,d=e.length,j,_e=this.layers.length;for(i=0;i<d;i+=1)for(j=0;j<_e;){if(this.layers[j].id===e[i].id){this.layers[j]=e[i];break}j+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,i,d){for(var j=this.elements,_e=this.layers,nt=0,ct=_e.length;nt<ct;)_e[nt].ind==i&&(!j[nt]||j[nt]===!0?(this.buildItem(nt),this.addPendingElement(e)):(d.push(j[nt]),j[nt].setAsParent(),_e[nt].parent!==void 0?this.buildElementParenting(e,_e[nt].parent,d):e.setHierarchy(d))),nt+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var i,d=e.length;for(i=0;i<d;i+=1)if(e[i].xt){var j=this.createComp(e[i]);j.initExpressions(),this.globalData.projectInterface.registerComposition(j)}},BaseRenderer.prototype.getElementById=function(e){var i,d=this.elements.length;for(i=0;i<d;i+=1)if(this.elements[i].data.ind===e)return this.elements[i];return null},BaseRenderer.prototype.getElementByPath=function(e){var i=e.shift(),d;if(typeof i=="number")d=this.elements[i];else{var j,_e=this.elements.length;for(j=0;j<_e;j+=1)if(this.elements[j].data.nm===i){d=this.elements[j];break}}return e.length===0?d:d.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,i){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,i),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var i=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:i,localMat:i,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var i,d=this.finalTransform.mat,j=0,_e=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;j<_e;){if(this.hierarchy[j].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}j+=1}if(this.finalTransform._matMdf)for(i=this.finalTransform.mProp.v.props,d.cloneFromProps(i),j=0;j<_e;j+=1)d.multiply(this.hierarchy[j].finalTransform.mProp.v)}(!this.localTransforms||this.finalTransform._matMdf)&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var i=0,d=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;i<d;)this.localTransforms[i]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[i]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),i+=1;if(this.finalTransform._localMatMdf){var j=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(j),i=1;i<d;i+=1){var _e=this.localTransforms[i].matrix;j.multiply(_e)}j.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var nt=this.finalTransform.localOpacity;for(i=0;i<d;i+=1)nt*=this.localTransforms[i].opacity*.01;this.finalTransform.localOpacity=nt}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var i=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(i.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var d=0,j=i.length;for(d=0;d<j;d+=1)this.localTransforms.push(i[d])}}},globalToLocal:function(i){var d=[];d.push(this.finalTransform);for(var j=!0,_e=this.comp;j;)_e.finalTransform?(_e.data.hasMask&&d.splice(0,0,_e.finalTransform),_e=_e.comp):j=!1;var nt,ct=d.length,c;for(nt=0;nt<ct;nt+=1)c=d[nt].mat.applyToPointArray(0,0,0),i=[i[0]-c[0],i[1]-c[1],0];return i},mHelper:new Matrix};function MaskElement(e,i,d){this.data=e,this.element=i,this.globalData=d,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var j=this.globalData.defs,_e,nt=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(nt),this.solidPath="";var ct,c=this.masksProperties,pt=0,gt=[],St,kt,At=createElementID(),Nt,Vt,zt,Jt,Dt="clipPath",It="clip-path";for(_e=0;_e<nt;_e+=1)if((c[_e].mode!=="a"&&c[_e].mode!=="n"||c[_e].inv||c[_e].o.k!==100||c[_e].o.x)&&(Dt="mask",It="mask"),(c[_e].mode==="s"||c[_e].mode==="i")&&pt===0?(Nt=createNS("rect"),Nt.setAttribute("fill","#ffffff"),Nt.setAttribute("width",this.element.comp.data.w||0),Nt.setAttribute("height",this.element.comp.data.h||0),gt.push(Nt)):Nt=null,ct=createNS("path"),c[_e].mode==="n")this.viewData[_e]={op:PropertyFactory.getProp(this.element,c[_e].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_e],3),elem:ct,lastPath:""},j.appendChild(ct);else{pt+=1,ct.setAttribute("fill",c[_e].mode==="s"?"#000000":"#ffffff"),ct.setAttribute("clip-rule","nonzero");var Mt;if(c[_e].x.k!==0?(Dt="mask",It="mask",Jt=PropertyFactory.getProp(this.element,c[_e].x,0,null,this.element),Mt=createElementID(),Vt=createNS("filter"),Vt.setAttribute("id",Mt),zt=createNS("feMorphology"),zt.setAttribute("operator","erode"),zt.setAttribute("in","SourceGraphic"),zt.setAttribute("radius","0"),Vt.appendChild(zt),j.appendChild(Vt),ct.setAttribute("stroke",c[_e].mode==="s"?"#000000":"#ffffff")):(zt=null,Jt=null),this.storedData[_e]={elem:ct,x:Jt,expan:zt,lastPath:"",lastOperator:"",filterId:Mt,lastRadius:0},c[_e].mode==="i"){kt=gt.length;var Ht=createNS("g");for(St=0;St<kt;St+=1)Ht.appendChild(gt[St]);var tr=createNS("mask");tr.setAttribute("mask-type","alpha"),tr.setAttribute("id",At+"_"+pt),tr.appendChild(ct),j.appendChild(tr),Ht.setAttribute("mask","url("+getLocationHref()+"#"+At+"_"+pt+")"),gt.length=0,gt.push(Ht)}else gt.push(ct);c[_e].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[_e]={elem:ct,lastPath:"",op:PropertyFactory.getProp(this.element,c[_e].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,c[_e],3),invRect:Nt},this.viewData[_e].prop.k||this.drawPath(c[_e],this.viewData[_e].prop.v,this.viewData[_e])}for(this.maskElement=createNS(Dt),nt=gt.length,_e=0;_e<nt;_e+=1)this.maskElement.appendChild(gt[_e]);pt>0&&(this.maskElement.setAttribute("id",At),this.element.maskedElement.setAttribute(It,"url("+getLocationHref()+"#"+At+")"),j.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var i=this.element.finalTransform.mat,d,j=this.masksProperties.length;for(d=0;d<j;d+=1)if((this.viewData[d].prop._mdf||e)&&this.drawPath(this.masksProperties[d],this.viewData[d].prop.v,this.viewData[d]),(this.viewData[d].op._mdf||e)&&this.viewData[d].elem.setAttribute("fill-opacity",this.viewData[d].op.v),this.masksProperties[d].mode!=="n"&&(this.viewData[d].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[d].invRect.setAttribute("transform",i.getInverseMatrix().to2dCSS()),this.storedData[d].x&&(this.storedData[d].x._mdf||e))){var _e=this.storedData[d].expan;this.storedData[d].x.v<0?(this.storedData[d].lastOperator!=="erode"&&(this.storedData[d].lastOperator="erode",this.storedData[d].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[d].filterId+")")),_e.setAttribute("radius",-this.storedData[d].x.v)):(this.storedData[d].lastOperator!=="dilate"&&(this.storedData[d].lastOperator="dilate",this.storedData[d].elem.setAttribute("filter",null)),this.storedData[d].elem.setAttribute("stroke-width",this.storedData[d].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,i,d){var j=" M"+i.v[0][0]+","+i.v[0][1],_e,nt;for(nt=i._length,_e=1;_e<nt;_e+=1)j+=" C"+i.o[_e-1][0]+","+i.o[_e-1][1]+" "+i.i[_e][0]+","+i.i[_e][1]+" "+i.v[_e][0]+","+i.v[_e][1];if(i.c&&nt>1&&(j+=" C"+i.o[_e-1][0]+","+i.o[_e-1][1]+" "+i.i[0][0]+","+i.i[0][1]+" "+i.v[0][0]+","+i.v[0][1]),d.lastPath!==j){var ct="";d.elem&&(i.c&&(ct=e.inv?this.solidPath+j:j),d.elem.setAttribute("d",ct)),d.lastPath=j}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=i,e.createAlphaToLuminanceFilter=d;function i(j,_e){var nt=createNS("filter");return nt.setAttribute("id",j),_e!==!0&&(nt.setAttribute("filterUnits","objectBoundingBox"),nt.setAttribute("x","0%"),nt.setAttribute("y","0%"),nt.setAttribute("width","100%"),nt.setAttribute("height","100%")),nt}function d(){var j=createNS("feColorMatrix");return j.setAttribute("type","matrix"),j.setAttribute("color-interpolation-filters","sRGB"),j.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),j}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var i,d="SourceGraphic",j=e.data.ef?e.data.ef.length:0,_e=createElementID(),nt=filtersFactory.createFilter(_e,!0),ct=0;this.filters=[];var c;for(i=0;i<j;i+=1){c=null;var pt=e.data.ef[i].ty;if(registeredEffects$1[pt]){var gt=registeredEffects$1[pt].effect;c=new gt(nt,e.effectsManager.effectElements[i],e,idPrefix+ct,d),d=idPrefix+ct,registeredEffects$1[pt].countsAsEffect&&(ct+=1)}c&&this.filters.push(c)}ct&&(e.globalData.defs.appendChild(nt),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+_e+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var i,d=this.filters.length;for(i=0;i<d;i+=1)this.filters[i].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var i,d=this.filters.length,j=[];for(i=0;i<d;i+=1)this.filters[i].type===e&&j.push(this.filters[i]);return j};function registerEffect$1(e,i,d){registeredEffects$1[e]={effect:i,countsAsEffect:d}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var i=null;if(this.data.td){this.matteMasks={};var d=createNS("g");d.setAttribute("id",this.layerId),d.appendChild(this.layerElement),i=d,this.globalData.defs.appendChild(d)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),i=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var j=createNS("clipPath"),_e=createNS("path");_e.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var nt=createElementID();if(j.setAttribute("id",nt),j.appendChild(_e),this.globalData.defs.appendChild(j),this.checkMasks()){var ct=createNS("g");ct.setAttribute("clip-path","url("+getLocationHref()+"#"+nt+")"),ct.appendChild(this.layerElement),this.transformedElement=ct,i?i.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+nt+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(i){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[i]){var d=this.layerId+"_"+i,j,_e,nt,ct;if(i===1||i===3){var c=createNS("mask");c.setAttribute("id",d),c.setAttribute("mask-type",i===3?"luminance":"alpha"),nt=createNS("use"),nt.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),c.appendChild(nt),this.globalData.defs.appendChild(c),!featureSupport.maskType&&i===1&&(c.setAttribute("mask-type","luminance"),j=createElementID(),_e=filtersFactory.createFilter(j),this.globalData.defs.appendChild(_e),_e.appendChild(filtersFactory.createAlphaToLuminanceFilter()),ct=createNS("g"),ct.appendChild(nt),c.appendChild(ct),ct.setAttribute("filter","url("+getLocationHref()+"#"+j+")"))}else if(i===2){var pt=createNS("mask");pt.setAttribute("id",d),pt.setAttribute("mask-type","alpha");var gt=createNS("g");pt.appendChild(gt),j=createElementID(),_e=filtersFactory.createFilter(j);var St=createNS("feComponentTransfer");St.setAttribute("in","SourceGraphic"),_e.appendChild(St);var kt=createNS("feFuncA");kt.setAttribute("type","table"),kt.setAttribute("tableValues","1.0 0.0"),St.appendChild(kt),this.globalData.defs.appendChild(_e);var At=createNS("rect");At.setAttribute("width",this.comp.data.w),At.setAttribute("height",this.comp.data.h),At.setAttribute("x","0"),At.setAttribute("y","0"),At.setAttribute("fill","#ffffff"),At.setAttribute("opacity","0"),gt.setAttribute("filter","url("+getLocationHref()+"#"+j+")"),gt.appendChild(At),nt=createNS("use"),nt.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),gt.appendChild(nt),featureSupport.maskType||(pt.setAttribute("mask-type","luminance"),_e.appendChild(filtersFactory.createAlphaToLuminanceFilter()),ct=createNS("g"),gt.appendChild(At),ct.appendChild(this.layerElement),gt.appendChild(ct)),this.globalData.defs.appendChild(pt)}this.matteMasks[i]=d}return this.matteMasks[i]},setMatte:function(i){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+i+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(i){this.hierarchy=i},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(d,j,_e){this.initFrame(),this.initBaseData(d,j,_e),this.initTransform(d,j,_e),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var d=this.baseElement||this.layerElement;d.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var d=this.baseElement||this.layerElement;d.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(d){this._mdf=!1,this.prepareRenderableFrame(d),this.prepareProperties(d,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,i,d){this.assetData=i.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=i.slotManager.getProp(this.assetData)),this.initElement(e,i,d),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,i){this.elem=e,this.pos=i}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(i){var d,j=this.shapeModifiers.length;for(d=0;d<j;d+=1)this.shapeModifiers[d].addShape(i)},isShapeInAnimatedModifiers:function(i){for(var d=0,j=this.shapeModifiers.length;d<j;)if(this.shapeModifiers[d].isAnimatedWithShape(i))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var i,d=this.shapes.length;for(i=0;i<d;i+=1)this.shapes[i].sh.reset();d=this.shapeModifiers.length;var j;for(i=d-1;i>=0&&(j=this.shapeModifiers[i].processShapes(this._isFirstFrame),!j);i-=1);}},searchProcessedElement:function(i){for(var d=this.processedElements,j=0,_e=d.length;j<_e;){if(d[j].elem===i)return d[j].pos;j+=1}return 0},addProcessedElement:function(i,d){for(var j=this.processedElements,_e=j.length;_e;)if(_e-=1,j[_e].elem===i){j[_e].pos=d;return}j.push(new ProcessedElement(i,d))},prepareFrame:function(i){this.prepareRenderableFrame(i),this.prepareProperties(i,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,i,d){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=d,this.lvl=i,this._isAnimated=!!d.k;for(var j=0,_e=e.length;j<_e;){if(e[j].mProps.dynamicProperties.length){this._isAnimated=!0;break}j+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,i){this.data=e,this.type=e.ty,this.d="",this.lvl=i,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,i,d,j){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(i.length),this.renderer=d,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",i.length?i.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(j);var _e,nt=i.length||0,ct;for(_e=0;_e<nt;_e+=1)ct=PropertyFactory.getProp(e,i[_e].v,0,0,this),this.k=ct.k||this.k,this.dataProps[_e]={n:i[_e].n,p:ct};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var i=0,d=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),i=0;i<d;i+=1)this.dataProps[i].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[i].p.v:this.dashArray[i]=this.dataProps[i].p.v:this.dashoffset[0]=this.dataProps[i].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,i,d){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=d,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,i,d){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.c=PropertyFactory.getProp(e,i.c,1,255,this),this.style=d}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,i,d){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=d}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,i,d){this.data=i,this.c=createTypedArray("uint8c",i.p*4);var j=i.k.k[0].s?i.k.k[0].s.length-i.p*4:i.k.k.length-i.p*4;this.o=createTypedArray("float32",j),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=j,this.initDynamicPropertyContainer(d),this.prop=PropertyFactory.getProp(e,i.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,i){for(var d=0,j=this.o.length/2,_e;d<j;){if(_e=Math.abs(e[d*4]-e[i*4+d*2]),_e>.01)return!1;d+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,i=this.data.k.k.length;e<i;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var i,d=this.data.p*4,j,_e;for(i=0;i<d;i+=1)j=i%4===0?100:255,_e=Math.round(this.prop.v[i]*j),this.c[i]!==_e&&(this.c[i]=_e,this._cmdf=!e);if(this.o.length)for(d=this.prop.v.length,i=this.data.p*4;i<d;i+=1)j=i%2===0?100:1,_e=i%2===0?Math.round(this.prop.v[i]*100):this.prop.v[i],this.o[i-this.data.p*4]!==_e&&(this.o[i-this.data.p*4]=_e,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,i,d){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,i,d)}SVGGradientFillStyleData.prototype.initGradientData=function(e,i,d){this.o=PropertyFactory.getProp(e,i.o,0,.01,this),this.s=PropertyFactory.getProp(e,i.s,1,null,this),this.e=PropertyFactory.getProp(e,i.e,1,null,this),this.h=PropertyFactory.getProp(e,i.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,i.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,i.g,this),this.style=d,this.stops=[],this.setGradientData(d.pElem,i),this.setGradientOpacity(i,d),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,i){var d=createElementID(),j=createNS(i.t===1?"linearGradient":"radialGradient");j.setAttribute("id",d),j.setAttribute("spreadMethod","pad"),j.setAttribute("gradientUnits","userSpaceOnUse");var _e=[],nt,ct,c;for(c=i.g.p*4,ct=0;ct<c;ct+=4)nt=createNS("stop"),j.appendChild(nt),_e.push(nt);e.setAttribute(i.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+d+")"),this.gf=j,this.cst=_e},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,i){if(this.g._hasOpacity&&!this.g._collapsable){var d,j,_e,nt=createNS("mask"),ct=createNS("path");nt.appendChild(ct);var c=createElementID(),pt=createElementID();nt.setAttribute("id",pt);var gt=createNS(e.t===1?"linearGradient":"radialGradient");gt.setAttribute("id",c),gt.setAttribute("spreadMethod","pad"),gt.setAttribute("gradientUnits","userSpaceOnUse"),_e=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var St=this.stops;for(j=e.g.p*4;j<_e;j+=2)d=createNS("stop"),d.setAttribute("stop-color","rgb(255,255,255)"),gt.appendChild(d),St.push(d);ct.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+c+")"),e.ty==="gs"&&(ct.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),ct.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&ct.setAttribute("stroke-miterlimit",e.ml)),this.of=gt,this.ms=nt,this.ost=St,this.maskId=pt,i.msElem=ct}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,i,d){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,i.w,0,null,this),this.d=new DashProperty(e,i.d||{},"svg",this),this.initGradientData(e,i,d),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,i,d){this.transform={mProps:e,op:i,container:d},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(i,d,j,_e){if(d===0)return"";var nt=i.o,ct=i.i,c=i.v,pt,gt=" M"+_e.applyToPointStringified(c[0][0],c[0][1]);for(pt=1;pt<d;pt+=1)gt+=" C"+_e.applyToPointStringified(nt[pt-1][0],nt[pt-1][1])+" "+_e.applyToPointStringified(ct[pt][0],ct[pt][1])+" "+_e.applyToPointStringified(c[pt][0],c[pt][1]);return j&&d&&(gt+=" C"+_e.applyToPointStringified(nt[pt-1][0],nt[pt-1][1])+" "+_e.applyToPointStringified(ct[0][0],ct[0][1])+" "+_e.applyToPointStringified(c[0][0],c[0][1]),gt+="z"),gt},SVGElementsRenderer=function(){var e=new Matrix,i=new Matrix,d={createRenderFunction:j};function j(kt){switch(kt.ty){case"fl":return c;case"gf":return gt;case"gs":return pt;case"st":return St;case"sh":case"el":case"rc":case"sr":return ct;case"tr":return _e;case"no":return nt;default:return null}}function _e(kt,At,Nt){(Nt||At.transform.op._mdf)&&At.transform.container.setAttribute("opacity",At.transform.op.v),(Nt||At.transform.mProps._mdf)&&At.transform.container.setAttribute("transform",At.transform.mProps.v.to2dCSS())}function nt(){}function ct(kt,At,Nt){var Vt,zt,Jt,Dt,It,Mt,Ht=At.styles.length,tr=At.lvl,er,dr,mr,Ur;for(Mt=0;Mt<Ht;Mt+=1){if(Dt=At.sh._mdf||Nt,At.styles[Mt].lvl<tr){for(dr=i.reset(),mr=tr-At.styles[Mt].lvl,Ur=At.transformers.length-1;!Dt&&mr>0;)Dt=At.transformers[Ur].mProps._mdf||Dt,mr-=1,Ur-=1;if(Dt)for(mr=tr-At.styles[Mt].lvl,Ur=At.transformers.length-1;mr>0;)dr.multiply(At.transformers[Ur].mProps.v),mr-=1,Ur-=1}else dr=e;if(er=At.sh.paths,zt=er._length,Dt){for(Jt="",Vt=0;Vt<zt;Vt+=1)It=er.shapes[Vt],It&&It._length&&(Jt+=buildShapeString(It,It._length,It.c,dr));At.caches[Mt]=Jt}else Jt=At.caches[Mt];At.styles[Mt].d+=kt.hd===!0?"":Jt,At.styles[Mt]._mdf=Dt||At.styles[Mt]._mdf}}function c(kt,At,Nt){var Vt=At.style;(At.c._mdf||Nt)&&Vt.pElem.setAttribute("fill","rgb("+bmFloor(At.c.v[0])+","+bmFloor(At.c.v[1])+","+bmFloor(At.c.v[2])+")"),(At.o._mdf||Nt)&&Vt.pElem.setAttribute("fill-opacity",At.o.v)}function pt(kt,At,Nt){gt(kt,At,Nt),St(kt,At,Nt)}function gt(kt,At,Nt){var Vt=At.gf,zt=At.g._hasOpacity,Jt=At.s.v,Dt=At.e.v;if(At.o._mdf||Nt){var It=kt.ty==="gf"?"fill-opacity":"stroke-opacity";At.style.pElem.setAttribute(It,At.o.v)}if(At.s._mdf||Nt){var Mt=kt.t===1?"x1":"cx",Ht=Mt==="x1"?"y1":"cy";Vt.setAttribute(Mt,Jt[0]),Vt.setAttribute(Ht,Jt[1]),zt&&!At.g._collapsable&&(At.of.setAttribute(Mt,Jt[0]),At.of.setAttribute(Ht,Jt[1]))}var tr,er,dr,mr;if(At.g._cmdf||Nt){tr=At.cst;var Ur=At.g.c;for(dr=tr.length,er=0;er<dr;er+=1)mr=tr[er],mr.setAttribute("offset",Ur[er*4]+"%"),mr.setAttribute("stop-color","rgb("+Ur[er*4+1]+","+Ur[er*4+2]+","+Ur[er*4+3]+")")}if(zt&&(At.g._omdf||Nt)){var Dr=At.g.o;for(At.g._collapsable?tr=At.cst:tr=At.ost,dr=tr.length,er=0;er<dr;er+=1)mr=tr[er],At.g._collapsable||mr.setAttribute("offset",Dr[er*2]+"%"),mr.setAttribute("stop-opacity",Dr[er*2+1])}if(kt.t===1)(At.e._mdf||Nt)&&(Vt.setAttribute("x2",Dt[0]),Vt.setAttribute("y2",Dt[1]),zt&&!At.g._collapsable&&(At.of.setAttribute("x2",Dt[0]),At.of.setAttribute("y2",Dt[1])));else{var Yr;if((At.s._mdf||At.e._mdf||Nt)&&(Yr=Math.sqrt(Math.pow(Jt[0]-Dt[0],2)+Math.pow(Jt[1]-Dt[1],2)),Vt.setAttribute("r",Yr),zt&&!At.g._collapsable&&At.of.setAttribute("r",Yr)),At.s._mdf||At.e._mdf||At.h._mdf||At.a._mdf||Nt){Yr||(Yr=Math.sqrt(Math.pow(Jt[0]-Dt[0],2)+Math.pow(Jt[1]-Dt[1],2)));var es=Math.atan2(Dt[1]-Jt[1],Dt[0]-Jt[0]),ms=At.h.v;ms>=1?ms=.99:ms<=-1&&(ms=-.99);var Ms=Yr*ms,Kr=Math.cos(es+At.a.v)*Ms+Jt[0],xr=Math.sin(es+At.a.v)*Ms+Jt[1];Vt.setAttribute("fx",Kr),Vt.setAttribute("fy",xr),zt&&!At.g._collapsable&&(At.of.setAttribute("fx",Kr),At.of.setAttribute("fy",xr))}}}function St(kt,At,Nt){var Vt=At.style,zt=At.d;zt&&(zt._mdf||Nt)&&zt.dashStr&&(Vt.pElem.setAttribute("stroke-dasharray",zt.dashStr),Vt.pElem.setAttribute("stroke-dashoffset",zt.dashoffset[0])),At.c&&(At.c._mdf||Nt)&&Vt.pElem.setAttribute("stroke","rgb("+bmFloor(At.c.v[0])+","+bmFloor(At.c.v[1])+","+bmFloor(At.c.v[2])+")"),(At.o._mdf||Nt)&&Vt.pElem.setAttribute("stroke-opacity",At.o.v),(At.w._mdf||Nt)&&(Vt.pElem.setAttribute("stroke-width",At.w.v),Vt.msElem&&Vt.msElem.setAttribute("stroke-width",At.w.v))}return d}();function SVGShapeElement(e,i,d){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,i,d),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,i=this.shapes.length,d,j,_e=this.stylesList.length,nt,ct=[],c=!1;for(j=0;j<_e;j+=1){for(nt=this.stylesList[j],c=!1,ct.length=0,e=0;e<i;e+=1)d=this.shapes[e],d.styles.indexOf(nt)!==-1&&(ct.push(d),c=d._isAnimated||c);ct.length>1&&c&&this.setShapesAsAnimated(ct)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var i,d=e.length;for(i=0;i<d;i+=1)e[i].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,i){var d,j=new SVGStyleData(e,i),_e=j.pElem;if(e.ty==="st")d=new SVGStrokeStyleData(this,e,j);else if(e.ty==="fl")d=new SVGFillStyleData(this,e,j);else if(e.ty==="gf"||e.ty==="gs"){var nt=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;d=new nt(this,e,j),this.globalData.defs.appendChild(d.gf),d.maskId&&(this.globalData.defs.appendChild(d.ms),this.globalData.defs.appendChild(d.of),_e.setAttribute("mask","url("+getLocationHref()+"#"+d.maskId+")"))}else e.ty==="no"&&(d=new SVGNoStyleData(this,e,j));return(e.ty==="st"||e.ty==="gs")&&(_e.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),_e.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),_e.setAttribute("fill-opacity","0"),e.lj===1&&_e.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&_e.setAttribute("fill-rule","evenodd"),e.ln&&_e.setAttribute("id",e.ln),e.cl&&_e.setAttribute("class",e.cl),e.bm&&(_e.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(j),this.addToAnimatedContents(e,d),d},SVGShapeElement.prototype.createGroupElement=function(e){var i=new ShapeGroupData;return e.ln&&i.gr.setAttribute("id",e.ln),e.cl&&i.gr.setAttribute("class",e.cl),e.bm&&(i.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),i},SVGShapeElement.prototype.createTransformElement=function(e,i){var d=TransformPropertyFactory.getTransformProperty(this,e,this),j=new SVGTransformData(d,d.o,i);return this.addToAnimatedContents(e,j),j},SVGShapeElement.prototype.createShapeElement=function(e,i,d){var j=4;e.ty==="rc"?j=5:e.ty==="el"?j=6:e.ty==="sr"&&(j=7);var _e=ShapePropertyFactory.getShapeProp(this,e,j,this),nt=new SVGShapeData(i,d,_e);return this.shapes.push(nt),this.addShapeToModifiers(nt),this.addToAnimatedContents(e,nt),nt},SVGShapeElement.prototype.addToAnimatedContents=function(e,i){for(var d=0,j=this.animatedContents.length;d<j;){if(this.animatedContents[d].element===i)return;d+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:i,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var i=e.styles,d,j=this.stylesList.length;for(d=0;d<j;d+=1)i.indexOf(this.stylesList[d])===-1&&!this.stylesList[d].closed&&i.push(this.stylesList[d])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,i,d,j,_e,nt,ct){var c=[].concat(nt),pt,gt=e.length-1,St,kt,At=[],Nt=[],Vt,zt,Jt;for(pt=gt;pt>=0;pt-=1){if(Jt=this.searchProcessedElement(e[pt]),Jt?i[pt]=d[Jt-1]:e[pt]._render=ct,e[pt].ty==="fl"||e[pt].ty==="st"||e[pt].ty==="gf"||e[pt].ty==="gs"||e[pt].ty==="no")Jt?i[pt].style.closed=e[pt].hd:i[pt]=this.createStyleElement(e[pt],_e),e[pt]._render&&i[pt].style.pElem.parentNode!==j&&j.appendChild(i[pt].style.pElem),At.push(i[pt].style);else if(e[pt].ty==="gr"){if(!Jt)i[pt]=this.createGroupElement(e[pt]);else for(kt=i[pt].it.length,St=0;St<kt;St+=1)i[pt].prevViewData[St]=i[pt].it[St];this.searchShapes(e[pt].it,i[pt].it,i[pt].prevViewData,i[pt].gr,_e+1,c,ct),e[pt]._render&&i[pt].gr.parentNode!==j&&j.appendChild(i[pt].gr)}else e[pt].ty==="tr"?(Jt||(i[pt]=this.createTransformElement(e[pt],j)),Vt=i[pt].transform,c.push(Vt)):e[pt].ty==="sh"||e[pt].ty==="rc"||e[pt].ty==="el"||e[pt].ty==="sr"?(Jt||(i[pt]=this.createShapeElement(e[pt],c,_e)),this.setElementStyles(i[pt])):e[pt].ty==="tm"||e[pt].ty==="rd"||e[pt].ty==="ms"||e[pt].ty==="pb"||e[pt].ty==="zz"||e[pt].ty==="op"?(Jt?(zt=i[pt],zt.closed=!1):(zt=ShapeModifiers.getModifier(e[pt].ty),zt.init(this,e[pt]),i[pt]=zt,this.shapeModifiers.push(zt)),Nt.push(zt)):e[pt].ty==="rp"&&(Jt?(zt=i[pt],zt.closed=!0):(zt=ShapeModifiers.getModifier(e[pt].ty),i[pt]=zt,zt.init(this,e,pt,i),this.shapeModifiers.push(zt),ct=!1),Nt.push(zt));this.addProcessedElement(e[pt],pt+1)}for(gt=At.length,pt=0;pt<gt;pt+=1)At[pt].closed=!0;for(gt=Nt.length,pt=0;pt<gt;pt+=1)Nt[pt].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<i;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,i=this.animatedContents.length,d;for(e=0;e<i;e+=1)d=this.animatedContents[e],(this._isFirstFrame||d.element._isAnimated)&&d.data!==!0&&d.fn(d.data,d.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,i,d,j,_e,nt){this.o=e,this.sw=i,this.sc=d,this.fc=j,this.m=_e,this.p=nt,this._mdf={o:!0,sw:!!i,sc:!!d,fc:!!j,m:!0,p:!0}}LetterProps.prototype.update=function(e,i,d,j,_e,nt){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var ct=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,ct=!0),this.sw!==i&&(this.sw=i,this._mdf.sw=!0,ct=!0),this.sc!==d&&(this.sc=d,this._mdf.sc=!0,ct=!0),this.fc!==j&&(this.fc=j,this._mdf.fc=!0,ct=!0),this.m!==_e&&(this.m=_e,this._mdf.m=!0,ct=!0),nt.length&&(this.p[0]!==nt[0]||this.p[1]!==nt[1]||this.p[4]!==nt[4]||this.p[5]!==nt[5]||this.p[12]!==nt[12]||this.p[13]!==nt[13])&&(this.p=nt,this._mdf.p=!0,ct=!0),ct};function TextProperty(e,i){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,i.d&&i.d.sid&&(i.d=e.globalData.slotManager.getProp(i.d)),this.data=i,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,i){for(var d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e[d]=i[d]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var i=this.currentData,d=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var j,_e=this.effectsSequence.length,nt=e||this.data.d.k[this.keysIndex].s;for(j=0;j<_e;j+=1)d!==this.keysIndex?nt=this.effectsSequence[j](nt,nt.t):nt=this.effectsSequence[j](this.currentData,nt.t);i!==nt&&this.setCurrentData(nt),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,i=this.elem.comp.renderedFrame,d=0,j=e.length;d<=j-1&&!(d===j-1||e[d+1].t>i);)d+=1;return this.keysIndex!==d&&(this.keysIndex=d),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var i=[],d=0,j=e.length,_e,nt,ct=!1,c=!1,pt="";d<j;)ct=c,c=!1,_e=e.charCodeAt(d),pt=e.charAt(d),FontManager.isCombinedCharacter(_e)?ct=!0:_e>=55296&&_e<=56319?FontManager.isRegionalFlag(e,d)?pt=e.substr(d,14):(nt=e.charCodeAt(d+1),nt>=56320&&nt<=57343&&(FontManager.isModifier(_e,nt)?(pt=e.substr(d,2),ct=!0):FontManager.isFlagEmoji(e.substr(d,4))?pt=e.substr(d,4):pt=e.substr(d,2))):_e>56319?(nt=e.charCodeAt(d+1),FontManager.isVariationSelector(_e)&&(ct=!0)):FontManager.isZeroWidthJoiner(_e)&&(ct=!0,c=!0),ct?(i[i.length-1]+=pt,ct=!1):i.push(pt),d+=pt.length;return i},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var i=this.elem.globalData.fontManager,d=this.data,j=[],_e,nt,ct,c=0,pt,gt=d.m.g,St=0,kt=0,At=0,Nt=[],Vt=0,zt=0,Jt,Dt,It=i.getFontByName(e.f),Mt,Ht=0,tr=getFontProperties(It);e.fWeight=tr.weight,e.fStyle=tr.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),nt=e.finalText.length,e.finalLineHeight=e.lh;var er=e.tr/1e3*e.finalSize,dr;if(e.sz)for(var mr=!0,Ur=e.sz[0],Dr=e.sz[1],Yr,es;mr;){es=this.buildFinalText(e.t),Yr=0,Vt=0,nt=es.length,er=e.tr/1e3*e.finalSize;var ms=-1;for(_e=0;_e<nt;_e+=1)dr=es[_e].charCodeAt(0),ct=!1,es[_e]===" "?ms=_e:(dr===13||dr===3)&&(Vt=0,ct=!0,Yr+=e.finalLineHeight||e.finalSize*1.2),i.chars?(Mt=i.getCharData(es[_e],It.fStyle,It.fFamily),Ht=ct?0:Mt.w*e.finalSize/100):Ht=i.measureText(es[_e],e.f,e.finalSize),Vt+Ht>Ur&&es[_e]!==" "?(ms===-1?nt+=1:_e=ms,Yr+=e.finalLineHeight||e.finalSize*1.2,es.splice(_e,ms===_e?1:0,"\r"),ms=-1,Vt=0):(Vt+=Ht,Vt+=er);Yr+=It.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&Dr<Yr?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=es,nt=e.finalText.length,mr=!1)}Vt=-er,Ht=0;var Ms=0,Kr;for(_e=0;_e<nt;_e+=1)if(ct=!1,Kr=e.finalText[_e],dr=Kr.charCodeAt(0),dr===13||dr===3?(Ms=0,Nt.push(Vt),zt=Vt>zt?Vt:zt,Vt=-2*er,pt="",ct=!0,At+=1):pt=Kr,i.chars?(Mt=i.getCharData(Kr,It.fStyle,i.getFontByName(e.f).fFamily),Ht=ct?0:Mt.w*e.finalSize/100):Ht=i.measureText(pt,e.f,e.finalSize),Kr===" "?Ms+=Ht+er:(Vt+=Ht+er+Ms,Ms=0),j.push({l:Ht,an:Ht,add:St,n:ct,anIndexes:[],val:pt,line:At,animatorJustifyOffset:0}),gt==2){if(St+=Ht,pt===""||pt===" "||_e===nt-1){for((pt===""||pt===" ")&&(St-=Ht);kt<=_e;)j[kt].an=St,j[kt].ind=c,j[kt].extra=Ht,kt+=1;c+=1,St=0}}else if(gt==3){if(St+=Ht,pt===""||_e===nt-1){for(pt===""&&(St-=Ht);kt<=_e;)j[kt].an=St,j[kt].ind=c,j[kt].extra=Ht,kt+=1;St=0,c+=1}}else j[c].ind=c,j[c].extra=0,c+=1;if(e.l=j,zt=Vt>zt?Vt:zt,Nt.push(Vt),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=zt,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=Nt;var xr=d.a,jr,rr;Dt=xr.length;var ar,$r,Ar=[];for(Jt=0;Jt<Dt;Jt+=1){for(jr=xr[Jt],jr.a.sc&&(e.strokeColorAnim=!0),jr.a.sw&&(e.strokeWidthAnim=!0),(jr.a.fc||jr.a.fh||jr.a.fs||jr.a.fb)&&(e.fillColorAnim=!0),$r=0,ar=jr.s.b,_e=0;_e<nt;_e+=1)rr=j[_e],rr.anIndexes[Jt]=$r,(ar==1&&rr.val!==""||ar==2&&rr.val!==""&&rr.val!==" "||ar==3&&(rr.n||rr.val==" "||_e==nt-1)||ar==4&&(rr.n||_e==nt-1))&&(jr.s.rn===1&&Ar.push($r),$r+=1);d.a[Jt].s.totalChars=$r;var Xr=-1,us;if(jr.s.rn===1)for(_e=0;_e<nt;_e+=1)rr=j[_e],Xr!=rr.anIndexes[Jt]&&(Xr=rr.anIndexes[Jt],us=Ar.splice(Math.floor(Math.random()*Ar.length),1)[0]),rr.anIndexes[Jt]=us}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=It.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,i){i=i===void 0?this.keysIndex:i;var d=this.copyData({},this.data.d.k[i].s);d=this.copyData(d,e),this.data.d.k[i].s=d,this.recalculate(i),this.setCurrentData(d),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var i=this.data.d.k[e].s;i.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(i)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,i=Math.min,d=Math.floor;function j(nt,ct){this._currentTextLength=-1,this.k=!1,this.data=ct,this.elem=nt,this.comp=nt.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(nt),this.s=PropertyFactory.getProp(nt,ct.s||{k:0},0,0,this),"e"in ct?this.e=PropertyFactory.getProp(nt,ct.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(nt,ct.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(nt,ct.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(nt,ct.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(nt,ct.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(nt,ct.a,0,.01,this),this.dynamicProperties.length||this.getValue()}j.prototype={getMult:function(ct){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var c=0,pt=0,gt=1,St=1;this.ne.v>0?c=this.ne.v/100:pt=-this.ne.v/100,this.xe.v>0?gt=1-this.xe.v/100:St=1+this.xe.v/100;var kt=BezierFactory.getBezierEasing(c,pt,gt,St).get,At=0,Nt=this.finalS,Vt=this.finalE,zt=this.data.sh;if(zt===2)Vt===Nt?At=ct>=Vt?1:0:At=e(0,i(.5/(Vt-Nt)+(ct-Nt)/(Vt-Nt),1)),At=kt(At);else if(zt===3)Vt===Nt?At=ct>=Vt?0:1:At=1-e(0,i(.5/(Vt-Nt)+(ct-Nt)/(Vt-Nt),1)),At=kt(At);else if(zt===4)Vt===Nt?At=0:(At=e(0,i(.5/(Vt-Nt)+(ct-Nt)/(Vt-Nt),1)),At<.5?At*=2:At=1-2*(At-.5)),At=kt(At);else if(zt===5){if(Vt===Nt)At=0;else{var Jt=Vt-Nt;ct=i(e(0,ct+.5-Nt),Vt-Nt);var Dt=-Jt/2+ct,It=Jt/2;At=Math.sqrt(1-Dt*Dt/(It*It))}At=kt(At)}else zt===6?(Vt===Nt?At=0:(ct=i(e(0,ct+.5-Nt),Vt-Nt),At=(1+Math.cos(Math.PI+Math.PI*2*ct/(Vt-Nt)))/2),At=kt(At)):(ct>=d(Nt)&&(ct-Nt<0?At=e(0,i(i(Vt,1)-(Nt-ct),1)):At=e(0,i(Vt-ct,1))),At=kt(At));if(this.sm.v!==100){var Mt=this.sm.v*.01;Mt===0&&(Mt=1e-8);var Ht=.5-Mt*.5;At<Ht?At=0:(At=(At-Ht)/Mt,At>1&&(At=1))}return At*this.a.v},getValue:function(ct){this.iterateDynamicProperties(),this._mdf=ct||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,ct&&this.data.r===2&&(this.e.v=this._currentTextLength);var c=this.data.r===2?1:100/this.data.totalChars,pt=this.o.v/c,gt=this.s.v/c+pt,St=this.e.v/c+pt;if(gt>St){var kt=gt;gt=St,St=kt}this.finalS=gt,this.finalE=St}},extendPrototype([DynamicPropertyContainer],j);function _e(nt,ct,c){return new j(nt,ct)}return{getTextSelectorProp:_e}}();function TextAnimatorDataProperty(e,i,d){var j={propType:!1},_e=PropertyFactory.getProp,nt=i.a;this.a={r:nt.r?_e(e,nt.r,0,degToRads,d):j,rx:nt.rx?_e(e,nt.rx,0,degToRads,d):j,ry:nt.ry?_e(e,nt.ry,0,degToRads,d):j,sk:nt.sk?_e(e,nt.sk,0,degToRads,d):j,sa:nt.sa?_e(e,nt.sa,0,degToRads,d):j,s:nt.s?_e(e,nt.s,1,.01,d):j,a:nt.a?_e(e,nt.a,1,0,d):j,o:nt.o?_e(e,nt.o,0,.01,d):j,p:nt.p?_e(e,nt.p,1,0,d):j,sw:nt.sw?_e(e,nt.sw,0,0,d):j,sc:nt.sc?_e(e,nt.sc,1,0,d):j,fc:nt.fc?_e(e,nt.fc,1,0,d):j,fh:nt.fh?_e(e,nt.fh,0,0,d):j,fs:nt.fs?_e(e,nt.fs,0,.01,d):j,fb:nt.fb?_e(e,nt.fb,0,.01,d):j,t:nt.t?_e(e,nt.t,0,0,d):j},this.s=TextSelectorProp.getTextSelectorProp(e,i.s,d),this.s.t=i.s.t}function TextAnimatorProperty(e,i,d){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=i,this._elem=d,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(d)}TextAnimatorProperty.prototype.searchProperties=function(){var e,i=this._textData.a.length,d,j=PropertyFactory.getProp;for(e=0;e<i;e+=1)d=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,d,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:j(this._elem,this._textData.p.a,0,0,this),f:j(this._elem,this._textData.p.f,0,0,this),l:j(this._elem,this._textData.p.l,0,0,this),r:j(this._elem,this._textData.p.r,0,0,this),p:j(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=j(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,i){if(this.lettersChangedFlag=i,!(!this._mdf&&!this._isFirstFrame&&!i&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var d=this._moreOptions.alignment.v,j=this._animatorsData,_e=this._textData,nt=this.mHelper,ct=this._renderType,c=this.renderedLetters.length,pt,gt,St,kt,At=e.l,Nt,Vt,zt,Jt,Dt,It,Mt,Ht,tr,er,dr,mr,Ur,Dr,Yr;if(this._hasMaskedPath){if(Yr=this._pathData.m,!this._pathData.n||this._pathData._mdf){var es=Yr.v;this._pathData.r.v&&(es=es.reverse()),Nt={tLength:0,segments:[]},kt=es._length-1;var ms;for(mr=0,St=0;St<kt;St+=1)ms=bez.buildBezierData(es.v[St],es.v[St+1],[es.o[St][0]-es.v[St][0],es.o[St][1]-es.v[St][1]],[es.i[St+1][0]-es.v[St+1][0],es.i[St+1][1]-es.v[St+1][1]]),Nt.tLength+=ms.segmentLength,Nt.segments.push(ms),mr+=ms.segmentLength;St=kt,Yr.v.c&&(ms=bez.buildBezierData(es.v[St],es.v[0],[es.o[St][0]-es.v[St][0],es.o[St][1]-es.v[St][1]],[es.i[0][0]-es.v[0][0],es.i[0][1]-es.v[0][1]]),Nt.tLength+=ms.segmentLength,Nt.segments.push(ms),mr+=ms.segmentLength),this._pathData.pi=Nt}if(Nt=this._pathData.pi,Vt=this._pathData.f.v,Mt=0,It=1,Jt=0,Dt=!0,er=Nt.segments,Vt<0&&Yr.v.c)for(Nt.tLength<Math.abs(Vt)&&(Vt=-Math.abs(Vt)%Nt.tLength),Mt=er.length-1,tr=er[Mt].points,It=tr.length-1;Vt<0;)Vt+=tr[It].partialLength,It-=1,It<0&&(Mt-=1,tr=er[Mt].points,It=tr.length-1);tr=er[Mt].points,Ht=tr[It-1],zt=tr[It],dr=zt.partialLength}kt=At.length,pt=0,gt=0;var Ms=e.finalSize*1.2*.714,Kr=!0,xr,jr,rr,ar,$r;ar=j.length;var Ar,Xr=-1,us,Wr,Vs,yn=Vt,_n=Mt,zo=It,Cn=-1,On,qr,Zs,Os,Us,Nn,cn,Bn,Pn="",Ro=this.defaultPropsArray,Ho;if(e.j===2||e.j===1){var Zn=0,Qo=0,Wo=e.j===2?-.5:-1,uo=0,eo=!0;for(St=0;St<kt;St+=1)if(At[St].n){for(Zn&&(Zn+=Qo);uo<St;)At[uo].animatorJustifyOffset=Zn,uo+=1;Zn=0,eo=!0}else{for(rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.t.propType&&(eo&&e.j===2&&(Qo+=xr.t.v*Wo),jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),Ar.length?Zn+=xr.t.v*Ar[0]*Wo:Zn+=xr.t.v*Ar*Wo);eo=!1}for(Zn&&(Zn+=Qo);uo<St;)At[uo].animatorJustifyOffset=Zn,uo+=1}for(St=0;St<kt;St+=1){if(nt.reset(),On=1,At[St].n)pt=0,gt+=e.yOffset,gt+=Kr?1:0,Vt=yn,Kr=!1,this._hasMaskedPath&&(Mt=_n,It=zo,tr=er[Mt].points,Ht=tr[It-1],zt=tr[It],dr=zt.partialLength,Jt=0),Pn="",Bn="",Nn="",Ho="",Ro=this.defaultPropsArray;else{if(this._hasMaskedPath){if(Cn!==At[St].line){switch(e.j){case 1:Vt+=mr-e.lineWidths[At[St].line];break;case 2:Vt+=(mr-e.lineWidths[At[St].line])/2;break}Cn=At[St].line}Xr!==At[St].ind&&(At[Xr]&&(Vt+=At[Xr].extra),Vt+=At[St].an/2,Xr=At[St].ind),Vt+=d[0]*At[St].an*.005;var to=0;for(rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.p.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),Ar.length?to+=xr.p.v[0]*Ar[0]:to+=xr.p.v[0]*Ar),xr.a.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),Ar.length?to+=xr.a.v[0]*Ar[0]:to+=xr.a.v[0]*Ar);for(Dt=!0,this._pathData.a.v&&(Vt=At[0].an*.5+(mr-this._pathData.f.v-At[0].an*.5-At[At.length-1].an*.5)*Xr/(kt-1),Vt+=this._pathData.f.v);Dt;)Jt+dr>=Vt+to||!tr?(Ur=(Vt+to-Jt)/zt.partialLength,Wr=Ht.point[0]+(zt.point[0]-Ht.point[0])*Ur,Vs=Ht.point[1]+(zt.point[1]-Ht.point[1])*Ur,nt.translate(-d[0]*At[St].an*.005,-(d[1]*Ms)*.01),Dt=!1):tr&&(Jt+=zt.partialLength,It+=1,It>=tr.length&&(It=0,Mt+=1,er[Mt]?tr=er[Mt].points:Yr.v.c?(It=0,Mt=0,tr=er[Mt].points):(Jt-=zt.partialLength,tr=null)),tr&&(Ht=zt,zt=tr[It],dr=zt.partialLength));us=At[St].an/2-At[St].add,nt.translate(-us,0,0)}else us=At[St].an/2-At[St].add,nt.translate(-us,0,0),nt.translate(-d[0]*At[St].an*.005,-d[1]*Ms*.01,0);for(rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.t.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),(pt!==0||e.j!==0)&&(this._hasMaskedPath?Ar.length?Vt+=xr.t.v*Ar[0]:Vt+=xr.t.v*Ar:Ar.length?pt+=xr.t.v*Ar[0]:pt+=xr.t.v*Ar));for(e.strokeWidthAnim&&(Zs=e.sw||0),e.strokeColorAnim&&(e.sc?qr=[e.sc[0],e.sc[1],e.sc[2]]:qr=[0,0,0]),e.fillColorAnim&&e.fc&&(Os=[e.fc[0],e.fc[1],e.fc[2]]),rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.a.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),Ar.length?nt.translate(-xr.a.v[0]*Ar[0],-xr.a.v[1]*Ar[1],xr.a.v[2]*Ar[2]):nt.translate(-xr.a.v[0]*Ar,-xr.a.v[1]*Ar,xr.a.v[2]*Ar));for(rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.s.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),Ar.length?nt.scale(1+(xr.s.v[0]-1)*Ar[0],1+(xr.s.v[1]-1)*Ar[1],1):nt.scale(1+(xr.s.v[0]-1)*Ar,1+(xr.s.v[1]-1)*Ar,1));for(rr=0;rr<ar;rr+=1){if(xr=j[rr].a,jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),xr.sk.propType&&(Ar.length?nt.skewFromAxis(-xr.sk.v*Ar[0],xr.sa.v*Ar[1]):nt.skewFromAxis(-xr.sk.v*Ar,xr.sa.v*Ar)),xr.r.propType&&(Ar.length?nt.rotateZ(-xr.r.v*Ar[2]):nt.rotateZ(-xr.r.v*Ar)),xr.ry.propType&&(Ar.length?nt.rotateY(xr.ry.v*Ar[1]):nt.rotateY(xr.ry.v*Ar)),xr.rx.propType&&(Ar.length?nt.rotateX(xr.rx.v*Ar[0]):nt.rotateX(xr.rx.v*Ar)),xr.o.propType&&(Ar.length?On+=(xr.o.v*Ar[0]-On)*Ar[0]:On+=(xr.o.v*Ar-On)*Ar),e.strokeWidthAnim&&xr.sw.propType&&(Ar.length?Zs+=xr.sw.v*Ar[0]:Zs+=xr.sw.v*Ar),e.strokeColorAnim&&xr.sc.propType)for(Us=0;Us<3;Us+=1)Ar.length?qr[Us]+=(xr.sc.v[Us]-qr[Us])*Ar[0]:qr[Us]+=(xr.sc.v[Us]-qr[Us])*Ar;if(e.fillColorAnim&&e.fc){if(xr.fc.propType)for(Us=0;Us<3;Us+=1)Ar.length?Os[Us]+=(xr.fc.v[Us]-Os[Us])*Ar[0]:Os[Us]+=(xr.fc.v[Us]-Os[Us])*Ar;xr.fh.propType&&(Ar.length?Os=addHueToRGB(Os,xr.fh.v*Ar[0]):Os=addHueToRGB(Os,xr.fh.v*Ar)),xr.fs.propType&&(Ar.length?Os=addSaturationToRGB(Os,xr.fs.v*Ar[0]):Os=addSaturationToRGB(Os,xr.fs.v*Ar)),xr.fb.propType&&(Ar.length?Os=addBrightnessToRGB(Os,xr.fb.v*Ar[0]):Os=addBrightnessToRGB(Os,xr.fb.v*Ar))}}for(rr=0;rr<ar;rr+=1)xr=j[rr].a,xr.p.propType&&(jr=j[rr].s,Ar=jr.getMult(At[St].anIndexes[rr],_e.a[rr].s.totalChars),this._hasMaskedPath?Ar.length?nt.translate(0,xr.p.v[1]*Ar[0],-xr.p.v[2]*Ar[1]):nt.translate(0,xr.p.v[1]*Ar,-xr.p.v[2]*Ar):Ar.length?nt.translate(xr.p.v[0]*Ar[0],xr.p.v[1]*Ar[1],-xr.p.v[2]*Ar[2]):nt.translate(xr.p.v[0]*Ar,xr.p.v[1]*Ar,-xr.p.v[2]*Ar));if(e.strokeWidthAnim&&(Nn=Zs<0?0:Zs),e.strokeColorAnim&&(cn="rgb("+Math.round(qr[0]*255)+","+Math.round(qr[1]*255)+","+Math.round(qr[2]*255)+")"),e.fillColorAnim&&e.fc&&(Bn="rgb("+Math.round(Os[0]*255)+","+Math.round(Os[1]*255)+","+Math.round(Os[2]*255)+")"),this._hasMaskedPath){if(nt.translate(0,-e.ls),nt.translate(0,d[1]*Ms*.01+gt,0),this._pathData.p.v){Dr=(zt.point[1]-Ht.point[1])/(zt.point[0]-Ht.point[0]);var Io=Math.atan(Dr)*180/Math.PI;zt.point[0]<Ht.point[0]&&(Io+=180),nt.rotate(-Io*Math.PI/180)}nt.translate(Wr,Vs,0),Vt-=d[0]*At[St].an*.005,At[St+1]&&Xr!==At[St+1].ind&&(Vt+=At[St].an/2,Vt+=e.tr*.001*e.finalSize)}else{switch(nt.translate(pt,gt,0),e.ps&&nt.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:nt.translate(At[St].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[At[St].line]),0,0);break;case 2:nt.translate(At[St].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[At[St].line])/2,0,0);break}nt.translate(0,-e.ls),nt.translate(us,0,0),nt.translate(d[0]*At[St].an*.005,d[1]*Ms*.01,0),pt+=At[St].l+e.tr*.001*e.finalSize}ct==="html"?Pn=nt.toCSS():ct==="svg"?Pn=nt.to2dCSS():Ro=[nt.props[0],nt.props[1],nt.props[2],nt.props[3],nt.props[4],nt.props[5],nt.props[6],nt.props[7],nt.props[8],nt.props[9],nt.props[10],nt.props[11],nt.props[12],nt.props[13],nt.props[14],nt.props[15]],Ho=On}c<=St?($r=new LetterProps(Ho,Nn,cn,Bn,Pn,Ro),this.renderedLetters.push($r),c+=1,this.lettersChangedFlag=!0):($r=this.renderedLetters[St],this.lettersChangedFlag=$r.update(Ho,Nn,cn,Bn,Pn,Ro)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,i,d){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,i,d),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,i,d),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,i){var d,j=i.length,_e,nt="";for(d=0;d<j;d+=1)i[d].ty==="sh"&&(_e=i[d].ks.k,nt+=buildShapeString(_e,_e.i.length,!0,e));return nt},ITextElement.prototype.updateDocumentData=function(e,i){this.textProperty.updateDocumentData(e,i)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,i,d,j,_e){switch(e.ps&&i.translate(e.ps[0],e.ps[1]+e.ascent,0),i.translate(0,-e.ls,0),e.j){case 1:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[d]),0,0);break;case 2:i.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[d])/2,0,0);break}i.translate(j,_e,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,i,d){this.textSpans=[],this.renderType="svg",this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var i=0,d=e.length,j=[],_e="";i<d;)e[i]==="\r"||e[i]===""?(j.push(_e),_e=""):_e+=e[i],i+=1;return j.push(_e),j},SVGTextLottieElement.prototype.buildShapeData=function(e,i){if(e.shapes&&e.shapes.length){var d=e.shapes[0];if(d.it){var j=d.it[d.it.length-1];j.s&&(j.s.k[0]=i,j.s.k[1]=i)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,i,d=this.textProperty.currentData;this.renderedLetters=createSizedArray(d?d.l.length:0),d.fc?this.layerElement.setAttribute("fill",this.buildColor(d.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),d.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(d.sc)),this.layerElement.setAttribute("stroke-width",d.sw)),this.layerElement.setAttribute("font-size",d.finalSize);var j=this.globalData.fontManager.getFontByName(d.f);if(j.fClass)this.layerElement.setAttribute("class",j.fClass);else{this.layerElement.setAttribute("font-family",j.fFamily);var _e=d.fWeight,nt=d.fStyle;this.layerElement.setAttribute("font-style",nt),this.layerElement.setAttribute("font-weight",_e)}this.layerElement.setAttribute("aria-label",d.t);var ct=d.l||[],c=!!this.globalData.fontManager.chars;i=ct.length;var pt,gt=this.mHelper,St="",kt=this.data.singleShape,At=0,Nt=0,Vt=!0,zt=d.tr*.001*d.finalSize;if(kt&&!c&&!d.sz){var Jt=this.textContainer,Dt="start";switch(d.j){case 1:Dt="end";break;case 2:Dt="middle";break;default:Dt="start";break}Jt.setAttribute("text-anchor",Dt),Jt.setAttribute("letter-spacing",zt);var It=this.buildTextContents(d.finalText);for(i=It.length,Nt=d.ps?d.ps[1]+d.ascent:0,e=0;e<i;e+=1)pt=this.textSpans[e].span||createNS("tspan"),pt.textContent=It[e],pt.setAttribute("x",0),pt.setAttribute("y",Nt),pt.style.display="inherit",Jt.appendChild(pt),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=pt,Nt+=d.finalLineHeight;this.layerElement.appendChild(Jt)}else{var Mt=this.textSpans.length,Ht;for(e=0;e<i;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!c||!kt||e===0){if(pt=Mt>e?this.textSpans[e].span:createNS(c?"g":"text"),Mt<=e){if(pt.setAttribute("stroke-linecap","butt"),pt.setAttribute("stroke-linejoin","round"),pt.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=pt,c){var tr=createNS("g");pt.appendChild(tr),this.textSpans[e].childSpan=tr}this.textSpans[e].span=pt,this.layerElement.appendChild(pt)}pt.style.display="inherit"}if(gt.reset(),kt&&(ct[e].n&&(At=-zt,Nt+=d.yOffset,Nt+=Vt?1:0,Vt=!1),this.applyTextPropertiesToMatrix(d,gt,ct[e].line,At,Nt),At+=ct[e].l||0,At+=zt),c){Ht=this.globalData.fontManager.getCharData(d.finalText[e],j.fStyle,this.globalData.fontManager.getFontByName(d.f).fFamily);var er;if(Ht.t===1)er=new SVGCompElement(Ht.data,this.globalData,this);else{var dr=emptyShapeData;Ht.data&&Ht.data.shapes&&(dr=this.buildShapeData(Ht.data,d.finalSize)),er=new SVGShapeElement(dr,this.globalData,this)}if(this.textSpans[e].glyph){var mr=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(mr.layerElement),mr.destroy()}this.textSpans[e].glyph=er,er._debug=!0,er.prepareFrame(0),er.renderFrame(),this.textSpans[e].childSpan.appendChild(er.layerElement),Ht.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+d.finalSize/100+","+d.finalSize/100+")")}else kt&&pt.setAttribute("transform","translate("+gt.props[12]+","+gt.props[13]+")"),pt.textContent=ct[e].val,pt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}kt&&pt&&pt.setAttribute("d",St)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,i=this.textSpans.length,d;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<i;e+=1)d=this.textSpans[e].glyph,d&&(d.prepareFrame(this.comp.renderedFrame-this.data.st),d._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,i,d=this.textAnimator.renderedLetters,j=this.textProperty.currentData.l;i=j.length;var _e,nt,ct;for(e=0;e<i;e+=1)j[e].n||(_e=d[e],nt=this.textSpans[e].span,ct=this.textSpans[e].glyph,ct&&ct.renderFrame(),_e._mdf.m&&nt.setAttribute("transform",_e.m),_e._mdf.o&&nt.setAttribute("opacity",_e.o),_e._mdf.sw&&nt.setAttribute("stroke-width",_e.sw),_e._mdf.sc&&nt.setAttribute("stroke",_e.sc),_e._mdf.fc&&nt.setAttribute("fill",_e.fc))}};function ISolidElement(e,i,d){this.initElement(e,i,d)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,i,d){this.initFrame(),this.initBaseData(e,i,d),this.initFrame(),this.initTransform(e,i,d),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var i=this.globalData.defs;this.setupGlobalData(e,i),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var d=createNS("clipPath"),j=createNS("rect");j.setAttribute("width",e.w),j.setAttribute("height",e.h),j.setAttribute("x",0),j.setAttribute("y",0);var _e=createElementID();d.setAttribute("id",_e),d.appendChild(j),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+_e+")"),i.appendChild(d),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var i=0,d=this.layers.length;for(i=0;i<d;i+=1)if(this.layers[i].ind===e)return i;return-1},SVGRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){i[e]=!0;var d=this.createItem(this.layers[e]);if(i[e]=d,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(d),d.initExpressions()),this.appendElementInPos(d,e),this.layers[e].tt){var j="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(j===-1)return;if(!this.elements[j]||this.elements[j]===!0)this.buildItem(j),this.addPendingElement(d);else{var _e=i[j],nt=_e.getMatte(this.layers[e].tt);d.setMatte(nt)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var i=0,d=this.elements.length;i<d;){if(this.elements[i]===e){var j="tp"in e.data?this.findIndexByInd(e.data.tp):i-1,_e=this.elements[j],nt=_e.getMatte(this.layers[i].tt);e.setMatte(nt);break}i+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var i,d=this.layers.length;for(this.completeLayers||this.checkLayers(e),i=d-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].prepareFrame(e-this.layers[i].st);if(this.globalData._mdf)for(i=0;i<d;i+=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,i){var d=e.getBaseElement();if(d){for(var j=0,_e;j<i;)this.elements[j]&&this.elements[j]!==!0&&this.elements[j].getBaseElement()&&(_e=this.elements[j].getBaseElement()),j+=1;_e?this.layerElement.insertBefore(d,_e):this.layerElement.appendChild(d)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,i,d){this.initFrame(),this.initBaseData(e,i,d),this.initTransform(e,i,d),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!i.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var i=this.tm.v;i===this.data.op&&(i=this.data.op-1),this.renderedFrame=i}var d,j=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),d=j-1;d>=0;d-=1)(this.completeLayers||this.elements[d])&&(this.elements[d].prepareFrame(this.renderedFrame-this.layers[d].st),this.elements[d]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,i=this.layers.length;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,i,d){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,d),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var d="";if(i&&i.title){var j=createNS("title"),_e=createElementID();j.setAttribute("id",_e),j.textContent=i.title,this.svgElement.appendChild(j),d+=_e}if(i&&i.description){var nt=createNS("desc"),ct=createElementID();nt.setAttribute("id",ct),nt.textContent=i.description,this.svgElement.appendChild(nt),d+=" "+ct}d&&this.svgElement.setAttribute("aria-labelledby",d);var c=createNS("defs");this.svgElement.appendChild(c);var pt=createNS("g");this.svgElement.appendChild(pt),this.layerElement=pt,this.renderConfig={preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",progressiveLoad:i&&i.progressiveLoad||!1,hideOnTransparent:!(i&&i.hideOnTransparent===!1),viewBoxOnly:i&&i.viewBoxOnly||!1,viewBoxSize:i&&i.viewBoxSize||!1,className:i&&i.className||"",id:i&&i.id||"",focusable:i&&i.focusable,filterSize:{width:i&&i.filterSize&&i.filterSize.width||"100%",height:i&&i.filterSize&&i.filterSize.height||"100%",x:i&&i.filterSize&&i.filterSize.x||"0%",y:i&&i.filterSize&&i.filterSize.y||"0%"},width:i&&i.width,height:i&&i.height,runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:c,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(i){var d,j=i.length,_e="_";for(d=0;d<j;d+=1)_e+=i[d].transform.key+"_";var nt=this.sequences[_e];return nt||(nt={transforms:[].concat(i),finalTransform:new Matrix,_mdf:!1},this.sequences[_e]=nt,this.sequenceList.push(nt)),nt},processSequence:function(i,d){for(var j=0,_e=i.transforms.length,nt=d;j<_e&&!d;){if(i.transforms[j].transform.mProps._mdf){nt=!0;break}j+=1}if(nt)for(i.finalTransform.reset(),j=_e-1;j>=0;j-=1)i.finalTransform.multiply(i.transforms[j].transform.mProps.v);i._mdf=nt},processSequences:function(i){var d,j=this.sequenceList.length;for(d=0;d<j;d+=1)this.processSequence(this.sequenceList[d],i)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var i="__lottie_element_luma_buffer",d=null,j=null,_e=null;function nt(){var pt=createNS("svg"),gt=createNS("filter"),St=createNS("feColorMatrix");return gt.setAttribute("id",i),St.setAttribute("type","matrix"),St.setAttribute("color-interpolation-filters","sRGB"),St.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),gt.appendChild(St),pt.appendChild(gt),pt.setAttribute("id",i+"_svg"),featureSupport.svgLumaHidden&&(pt.style.display="none"),pt}function ct(){d||(_e=nt(),document.body.appendChild(_e),d=createTag("canvas"),j=d.getContext("2d"),j.filter="url(#"+i+")",j.fillStyle="rgba(0,0,0,0)",j.fillRect(0,0,1,1))}function c(pt){return d||ct(),d.width=pt.width,d.height=pt.height,j.filter="url(#"+i+")",d}return{load:ct,get:c}};function createCanvas(e,i){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,i);var d=createTag("canvas");return d.width=e,d.height=i,d}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var i,d=e.data.ef?e.data.ef.length:0;this.filters=[];var j;for(i=0;i<d;i+=1){j=null;var _e=e.data.ef[i].ty;if(registeredEffects[_e]){var nt=registeredEffects[_e].effect;j=new nt(e.effectsManager.effectElements[i],e)}j&&this.filters.push(j)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var i,d=this.filters.length;for(i=0;i<d;i+=1)this.filters[i].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var i,d=this.filters.length,j=[];for(i=0;i<d;i+=1)this.filters[i].type===e&&j.push(this.filters[i]);return j};function registerEffect(e,i){registeredEffects[e]={effect:i}}function CVMaskElement(e,i){this.data=e,this.element=i,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var d,j=this.masksProperties.length,_e=!1;for(d=0;d<j;d+=1)this.masksProperties[d].mode!=="n"&&(_e=!0),this.viewData[d]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[d],3);this.hasMasks=_e,_e&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,i=this.element.canvasContext,d,j=this.masksProperties.length,_e,nt,ct;for(i.beginPath(),d=0;d<j;d+=1)if(this.masksProperties[d].mode!=="n"){this.masksProperties[d].inv&&(i.moveTo(0,0),i.lineTo(this.element.globalData.compSize.w,0),i.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),i.lineTo(0,this.element.globalData.compSize.h),i.lineTo(0,0)),ct=this.viewData[d].v,_e=e.applyToPointArray(ct.v[0][0],ct.v[0][1],0),i.moveTo(_e[0],_e[1]);var c,pt=ct._length;for(c=1;c<pt;c+=1)nt=e.applyToTriplePoints(ct.o[c-1],ct.i[c],ct.v[c]),i.bezierCurveTo(nt[0],nt[1],nt[2],nt[3],nt[4],nt[5]);nt=e.applyToTriplePoints(ct.o[c-1],ct.i[0],ct.v[0]),i.bezierCurveTo(nt[0],nt[1],nt[2],nt[3],nt[4],nt[5])}this.element.globalData.renderer.save(!0),i.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var i=this.globalData.canvasContext,d=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(d);var j=assetLoader.createCanvas(i.canvas.width,i.canvas.height);this.buffers.push(j),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var i=this.globalData;if(i.blendMode!==this.data.bm){i.blendMode=this.data.bm;var d=getBlendMode(this.data.bm);i.canvasContext.globalCompositeOperation=d}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(i){i.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var i=this.buffers[0],d=i.getContext("2d");this.clearCanvas(d),d.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var i=this.buffers[1],d=i.getContext("2d");this.clearCanvas(d),d.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var j=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(j.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var _e=assetLoader.getLumaCanvas(this.canvasContext.canvas),nt=_e.getContext("2d");nt.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(_e,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(i,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(i){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!i)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var d=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(d),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(d),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,i,d,j){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var _e=4;i.ty==="rc"?_e=5:i.ty==="el"?_e=6:i.ty==="sr"&&(_e=7),this.sh=ShapePropertyFactory.getShapeProp(e,i,_e,e);var nt,ct=d.length,c;for(nt=0;nt<ct;nt+=1)d[nt].closed||(c={transforms:j.addTransformSequence(d[nt].transforms),trNodes:[]},this.styledShapes.push(c),d[nt].elements.push(c))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,i,d){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,i){var d={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(i),transforms:[],elements:[],closed:e.hd===!0},j={};if(e.ty==="fl"||e.ty==="st"?(j.c=PropertyFactory.getProp(this,e.c,1,255,this),j.c.k||(d.co="rgb("+bmFloor(j.c.v[0])+","+bmFloor(j.c.v[1])+","+bmFloor(j.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(j.s=PropertyFactory.getProp(this,e.s,1,null,this),j.e=PropertyFactory.getProp(this,e.e,1,null,this),j.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),j.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),j.g=new GradientProperty(this,e.g,this)),j.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(d.lc=lineCapEnum[e.lc||2],d.lj=lineJoinEnum[e.lj||2],e.lj==1&&(d.ml=e.ml),j.w=PropertyFactory.getProp(this,e.w,0,null,this),j.w.k||(d.wi=j.w.v),e.d){var _e=new DashProperty(this,e.d,"canvas",this);j.d=_e,j.d.k||(d.da=j.d.dashArray,d.do=j.d.dashoffset[0])}}else d.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(d),j.style=d,j},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var i={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return i},CVShapeElement.prototype.createShapeElement=function(e){var i=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(i),this.addShapeToModifiers(i),i},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,i=this.itemsData.length;for(e=0;e<i;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),i=this.dynamicProperties.length,e=0;e<i;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var i,d=this.stylesList.length;for(i=0;i<d;i+=1)this.stylesList[i].closed||this.stylesList[i].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,i=this.stylesList.length;for(e=0;e<i;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var i,d=e.length;for(i=0;i<d;i+=1)e[i].closed=!0},CVShapeElement.prototype.searchShapes=function(e,i,d,j,_e){var nt,ct=e.length-1,c,pt,gt=[],St=[],kt,At,Nt,Vt=[].concat(_e);for(nt=ct;nt>=0;nt-=1){if(kt=this.searchProcessedElement(e[nt]),kt?i[nt]=d[kt-1]:e[nt]._shouldRender=j,e[nt].ty==="fl"||e[nt].ty==="st"||e[nt].ty==="gf"||e[nt].ty==="gs")kt?i[nt].style.closed=!1:i[nt]=this.createStyleElement(e[nt],Vt),gt.push(i[nt].style);else if(e[nt].ty==="gr"){if(!kt)i[nt]=this.createGroupElement(e[nt]);else for(pt=i[nt].it.length,c=0;c<pt;c+=1)i[nt].prevViewData[c]=i[nt].it[c];this.searchShapes(e[nt].it,i[nt].it,i[nt].prevViewData,j,Vt)}else e[nt].ty==="tr"?(kt||(Nt=this.createTransformElement(e[nt]),i[nt]=Nt),Vt.push(i[nt]),this.addTransformToStyleList(i[nt])):e[nt].ty==="sh"||e[nt].ty==="rc"||e[nt].ty==="el"||e[nt].ty==="sr"?kt||(i[nt]=this.createShapeElement(e[nt])):e[nt].ty==="tm"||e[nt].ty==="rd"||e[nt].ty==="pb"||e[nt].ty==="zz"||e[nt].ty==="op"?(kt?(At=i[nt],At.closed=!1):(At=ShapeModifiers.getModifier(e[nt].ty),At.init(this,e[nt]),i[nt]=At,this.shapeModifiers.push(At)),St.push(At)):e[nt].ty==="rp"&&(kt?(At=i[nt],At.closed=!0):(At=ShapeModifiers.getModifier(e[nt].ty),i[nt]=At,At.init(this,e,nt,i),this.shapeModifiers.push(At),j=!1),St.push(At));this.addProcessedElement(e[nt],nt+1)}for(this.removeTransformFromStyleList(),this.closeStyles(gt),ct=St.length,nt=0;nt<ct;nt+=1)St[nt].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,i){(e._opMdf||i.op._mdf||this._isFirstFrame)&&(i.opacity=e.opacity,i.opacity*=i.op.v,i._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,i=this.stylesList.length,d,j,_e,nt,ct,c,pt=this.globalData.renderer,gt=this.globalData.canvasContext,St,kt;for(e=0;e<i;e+=1)if(kt=this.stylesList[e],St=kt.type,!((St==="st"||St==="gs")&&kt.wi===0||!kt.data._shouldRender||kt.coOp===0||this.globalData.currentGlobalAlpha===0)){for(pt.save(),ct=kt.elements,St==="st"||St==="gs"?(pt.ctxStrokeStyle(St==="st"?kt.co:kt.grd),pt.ctxLineWidth(kt.wi),pt.ctxLineCap(kt.lc),pt.ctxLineJoin(kt.lj),pt.ctxMiterLimit(kt.ml||0)):pt.ctxFillStyle(St==="fl"?kt.co:kt.grd),pt.ctxOpacity(kt.coOp),St!=="st"&&St!=="gs"&&gt.beginPath(),pt.ctxTransform(kt.preTransforms.finalTransform.props),j=ct.length,d=0;d<j;d+=1){for((St==="st"||St==="gs")&&(gt.beginPath(),kt.da&&(gt.setLineDash(kt.da),gt.lineDashOffset=kt.do)),c=ct[d].trNodes,nt=c.length,_e=0;_e<nt;_e+=1)c[_e].t==="m"?gt.moveTo(c[_e].p[0],c[_e].p[1]):c[_e].t==="c"?gt.bezierCurveTo(c[_e].pts[0],c[_e].pts[1],c[_e].pts[2],c[_e].pts[3],c[_e].pts[4],c[_e].pts[5]):gt.closePath();(St==="st"||St==="gs")&&(pt.ctxStroke(),kt.da&&gt.setLineDash(this.dashResetter))}St!=="st"&&St!=="gs"&&this.globalData.renderer.ctxFill(kt.r),pt.restore()}},CVShapeElement.prototype.renderShape=function(e,i,d,j){var _e,nt=i.length-1,ct;for(ct=e,_e=nt;_e>=0;_e-=1)i[_e].ty==="tr"?(ct=d[_e].transform,this.renderShapeTransform(e,ct)):i[_e].ty==="sh"||i[_e].ty==="el"||i[_e].ty==="rc"||i[_e].ty==="sr"?this.renderPath(i[_e],d[_e]):i[_e].ty==="fl"?this.renderFill(i[_e],d[_e],ct):i[_e].ty==="st"?this.renderStroke(i[_e],d[_e],ct):i[_e].ty==="gf"||i[_e].ty==="gs"?this.renderGradientFill(i[_e],d[_e],ct):i[_e].ty==="gr"?this.renderShape(ct,i[_e].it,d[_e].it):i[_e].ty;j&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,i){if(this._isFirstFrame||i._mdf||e.transforms._mdf){var d=e.trNodes,j=i.paths,_e,nt,ct,c=j._length;d.length=0;var pt=e.transforms.finalTransform;for(ct=0;ct<c;ct+=1){var gt=j.shapes[ct];if(gt&&gt.v){for(nt=gt._length,_e=1;_e<nt;_e+=1)_e===1&&d.push({t:"m",p:pt.applyToPointArray(gt.v[0][0],gt.v[0][1],0)}),d.push({t:"c",pts:pt.applyToTriplePoints(gt.o[_e-1],gt.i[_e],gt.v[_e])});nt===1&&d.push({t:"m",p:pt.applyToPointArray(gt.v[0][0],gt.v[0][1],0)}),gt.c&&nt&&(d.push({t:"c",pts:pt.applyToTriplePoints(gt.o[_e-1],gt.i[0],gt.v[0])}),d.push({t:"z"}))}}e.trNodes=d}},CVShapeElement.prototype.renderPath=function(e,i){if(e.hd!==!0&&e._shouldRender){var d,j=i.styledShapes.length;for(d=0;d<j;d+=1)this.renderStyledShape(i.styledShapes[d],i.sh)}},CVShapeElement.prototype.renderFill=function(e,i,d){var j=i.style;(i.c._mdf||this._isFirstFrame)&&(j.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||d._opMdf||this._isFirstFrame)&&(j.coOp=i.o.v*d.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,i,d){var j=i.style,_e;if(!j.grd||i.g._mdf||i.s._mdf||i.e._mdf||e.t!==1&&(i.h._mdf||i.a._mdf)){var nt=this.globalData.canvasContext,ct=i.s.v,c=i.e.v;if(e.t===1)_e=nt.createLinearGradient(ct[0],ct[1],c[0],c[1]);else{var pt=Math.sqrt(Math.pow(ct[0]-c[0],2)+Math.pow(ct[1]-c[1],2)),gt=Math.atan2(c[1]-ct[1],c[0]-ct[0]),St=i.h.v;St>=1?St=.99:St<=-1&&(St=-.99);var kt=pt*St,At=Math.cos(gt+i.a.v)*kt+ct[0],Nt=Math.sin(gt+i.a.v)*kt+ct[1];_e=nt.createRadialGradient(At,Nt,0,ct[0],ct[1],pt)}var Vt,zt=e.g.p,Jt=i.g.c,Dt=1;for(Vt=0;Vt<zt;Vt+=1)i.g._hasOpacity&&i.g._collapsable&&(Dt=i.g.o[Vt*2+1]),_e.addColorStop(Jt[Vt*4]/100,"rgba("+Jt[Vt*4+1]+","+Jt[Vt*4+2]+","+Jt[Vt*4+3]+","+Dt+")");j.grd=_e}j.coOp=i.o.v*d.opacity},CVShapeElement.prototype.renderStroke=function(e,i,d){var j=i.style,_e=i.d;_e&&(_e._mdf||this._isFirstFrame)&&(j.da=_e.dashArray,j.do=_e.dashoffset[0]),(i.c._mdf||this._isFirstFrame)&&(j.co="rgb("+bmFloor(i.c.v[0])+","+bmFloor(i.c.v[1])+","+bmFloor(i.c.v[2])+")"),(i.o._mdf||d._opMdf||this._isFirstFrame)&&(j.coOp=i.o.v*d.opacity),(i.w._mdf||this._isFirstFrame)&&(j.wi=i.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,i,d){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=!1;e.fc?(i=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=i;var d=!1;e.sc&&(d=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var j=this.globalData.fontManager.getFontByName(e.f),_e,nt,ct=e.l,c=this.mHelper;this.stroke=d,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,nt=e.finalText.length;var pt,gt,St,kt,At,Nt,Vt,zt,Jt,Dt,It=this.data.singleShape,Mt=e.tr*.001*e.finalSize,Ht=0,tr=0,er=!0,dr=0;for(_e=0;_e<nt;_e+=1){pt=this.globalData.fontManager.getCharData(e.finalText[_e],j.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),gt=pt&&pt.data||{},c.reset(),It&&ct[_e].n&&(Ht=-Mt,tr+=e.yOffset,tr+=er?1:0,er=!1),At=gt.shapes?gt.shapes[0].it:[],Vt=At.length,c.scale(e.finalSize/100,e.finalSize/100),It&&this.applyTextPropertiesToMatrix(e,c,ct[_e].line,Ht,tr),Jt=createSizedArray(Vt-1);var mr=0;for(Nt=0;Nt<Vt;Nt+=1)if(At[Nt].ty==="sh"){for(kt=At[Nt].ks.k.i.length,zt=At[Nt].ks.k,Dt=[],St=1;St<kt;St+=1)St===1&&Dt.push(c.applyToX(zt.v[0][0],zt.v[0][1],0),c.applyToY(zt.v[0][0],zt.v[0][1],0)),Dt.push(c.applyToX(zt.o[St-1][0],zt.o[St-1][1],0),c.applyToY(zt.o[St-1][0],zt.o[St-1][1],0),c.applyToX(zt.i[St][0],zt.i[St][1],0),c.applyToY(zt.i[St][0],zt.i[St][1],0),c.applyToX(zt.v[St][0],zt.v[St][1],0),c.applyToY(zt.v[St][0],zt.v[St][1],0));Dt.push(c.applyToX(zt.o[St-1][0],zt.o[St-1][1],0),c.applyToY(zt.o[St-1][0],zt.o[St-1][1],0),c.applyToX(zt.i[0][0],zt.i[0][1],0),c.applyToY(zt.i[0][0],zt.i[0][1],0),c.applyToX(zt.v[0][0],zt.v[0][1],0),c.applyToY(zt.v[0][0],zt.v[0][1],0)),Jt[mr]=Dt,mr+=1}It&&(Ht+=ct[_e].l,Ht+=Mt),this.textSpans[dr]?this.textSpans[dr].elem=Jt:this.textSpans[dr]={elem:Jt},dr+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var i,d,j,_e,nt,ct,c=this.textAnimator.renderedLetters,pt=this.textProperty.currentData.l;d=pt.length;var gt,St=null,kt=null,At=null,Nt,Vt,zt=this.globalData.renderer;for(i=0;i<d;i+=1)if(!pt[i].n){if(gt=c[i],gt&&(zt.save(),zt.ctxTransform(gt.p),zt.ctxOpacity(gt.o)),this.fill){for(gt&&gt.fc?St!==gt.fc&&(zt.ctxFillStyle(gt.fc),St=gt.fc):St!==this.values.fill&&(St=this.values.fill,zt.ctxFillStyle(this.values.fill)),Nt=this.textSpans[i].elem,_e=Nt.length,this.globalData.canvasContext.beginPath(),j=0;j<_e;j+=1)for(Vt=Nt[j],ct=Vt.length,this.globalData.canvasContext.moveTo(Vt[0],Vt[1]),nt=2;nt<ct;nt+=6)this.globalData.canvasContext.bezierCurveTo(Vt[nt],Vt[nt+1],Vt[nt+2],Vt[nt+3],Vt[nt+4],Vt[nt+5]);this.globalData.canvasContext.closePath(),zt.ctxFill()}if(this.stroke){for(gt&&gt.sw?At!==gt.sw&&(At=gt.sw,zt.ctxLineWidth(gt.sw)):At!==this.values.sWidth&&(At=this.values.sWidth,zt.ctxLineWidth(this.values.sWidth)),gt&&gt.sc?kt!==gt.sc&&(kt=gt.sc,zt.ctxStrokeStyle(gt.sc)):kt!==this.values.stroke&&(kt=this.values.stroke,zt.ctxStrokeStyle(this.values.stroke)),Nt=this.textSpans[i].elem,_e=Nt.length,this.globalData.canvasContext.beginPath(),j=0;j<_e;j+=1)for(Vt=Nt[j],ct=Vt.length,this.globalData.canvasContext.moveTo(Vt[0],Vt[1]),nt=2;nt<ct;nt+=6)this.globalData.canvasContext.bezierCurveTo(Vt[nt],Vt[nt+1],Vt[nt+2],Vt[nt+3],Vt[nt+4],Vt[nt+5]);this.globalData.canvasContext.closePath(),zt.ctxStroke()}gt&&this.globalData.renderer.restore()}};function CVImageElement(e,i,d){this.assetData=i.getAssetData(e.refId),this.img=i.imageLoader.getAsset(this.assetData),this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var i=e.getContext("2d"),d=this.img.width,j=this.img.height,_e=d/j,nt=this.assetData.w/this.assetData.h,ct,c,pt=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;_e>nt&&pt==="xMidYMid slice"||_e<nt&&pt!=="xMidYMid slice"?(c=j,ct=c*nt):(ct=d,c=ct/nt),i.drawImage(this.img,(d-ct)/2,(j-c)/2,ct,c,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,i,d){this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,i,d,j){this.canvasContext.fillRect(e,i,d,j)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var i=this.animationItem.container.style;i.width="100%",i.height="100%";var d="0px 0px 0px";i.transformOrigin=d,i.mozTransformOrigin=d,i.webkitTransformOrigin=d,i["-webkit-transform"]=d,i.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,i){this.reset();var d,j;e?(d=e,j=i,this.canvasContext.canvas.width=d,this.canvasContext.canvas.height=j):(this.animationItem.wrapper&&this.animationItem.container?(d=this.animationItem.wrapper.offsetWidth,j=this.animationItem.wrapper.offsetHeight):(d=this.canvasContext.canvas.width,j=this.canvasContext.canvas.height),this.canvasContext.canvas.width=d*this.renderConfig.dpr,this.canvasContext.canvas.height=j*this.renderConfig.dpr);var _e,nt;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var ct=this.renderConfig.preserveAspectRatio.split(" "),c=ct[1]||"meet",pt=ct[0]||"xMidYMid",gt=pt.substr(0,4),St=pt.substr(4);_e=d/j,nt=this.transformCanvas.w/this.transformCanvas.h,nt>_e&&c==="meet"||nt<_e&&c==="slice"?(this.transformCanvas.sx=d/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=d/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=j/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=j/(this.transformCanvas.h/this.renderConfig.dpr)),gt==="xMid"&&(nt<_e&&c==="meet"||nt>_e&&c==="slice")?this.transformCanvas.tx=(d-this.transformCanvas.w*(j/this.transformCanvas.h))/2*this.renderConfig.dpr:gt==="xMax"&&(nt<_e&&c==="meet"||nt>_e&&c==="slice")?this.transformCanvas.tx=(d-this.transformCanvas.w*(j/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,St==="YMid"&&(nt>_e&&c==="meet"||nt<_e&&c==="slice")?this.transformCanvas.ty=(j-this.transformCanvas.h*(d/this.transformCanvas.w))/2*this.renderConfig.dpr:St==="YMax"&&(nt>_e&&c==="meet"||nt<_e&&c==="slice")?this.transformCanvas.ty=(j-this.transformCanvas.h*(d/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=d/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=j/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,i=this.layers?this.layers.length:0;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,i){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!i||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||i,this.globalData.projectInterface.currentFrame=e;var d,j=this.layers.length;for(this.completeLayers||this.checkLayers(e),d=j-1;d>=0;d-=1)(this.completeLayers||this.elements[d])&&this.elements[d].prepareFrame(e-this.layers[d].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),d=j-1;d>=0;d-=1)(this.completeLayers||this.elements[d])&&this.elements[d].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var i=this.elements;if(!(i[e]||this.layers[e].ty===99)){var d=this.createItem(this.layers[e],this,this.globalData);i[e]=d,d.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,i=15;for(e=0;e<i;e+=1){var d=new CanvasContext;this.stack[e]=d}this._length=i,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,i=0;for(i=this._length;i<e;i+=1)this.stack[i]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var i=this.stack[this.cArrPos],d=i.transform,j,_e=this.cTr.props;for(j=0;j<16;j+=1)_e[j]=d[j];if(e){this.nativeContext.restore();var nt=this.stack[this.cArrPos+1];this.appliedFillStyle=nt.fillStyle,this.appliedStrokeStyle=nt.strokeStyle,this.appliedLineWidth=nt.lineWidth,this.appliedLineCap=nt.lineCap,this.appliedLineJoin=nt.lineJoin,this.appliedMiterLimit=nt.miterLimit}this.nativeContext.setTransform(d[0],d[1],d[4],d[5],d[12],d[13]),(e||i.opacity!==-1&&this.currentOpacity!==i.opacity)&&(this.nativeContext.globalAlpha=i.opacity,this.currentOpacity=i.opacity),this.currentFillStyle=i.fillStyle,this.currentStrokeStyle=i.strokeStyle,this.currentLineWidth=i.lineWidth,this.currentLineCap=i.lineCap,this.currentLineJoin=i.lineJoin,this.currentMiterLimit=i.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var i=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var d=this.stack[this.cArrPos],j;for(j=0;j<16;j+=1)d.transform[j]=i[j];this.cArrPos+=1;var _e=this.stack[this.cArrPos];_e.opacity=d.opacity,_e.fillStyle=d.fillStyle,_e.strokeStyle=d.strokeStyle,_e.lineWidth=d.lineWidth,_e.lineCap=d.lineCap,_e.lineJoin=d.lineJoin,_e.miterLimit=d.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var i=this.cTr;this.transformMat.multiply(i),i.cloneFromProps(this.transformMat.props);var d=i.props;this.nativeContext.setTransform(d[0],d[1],d[4],d[5],d[12],d[13])},CVContextData.prototype.opacity=function(e){var i=this.stack[this.cArrPos].opacity;i*=e<0?0:e,this.stack[this.cArrPos].opacity!==i&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=i)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,i,d,j){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,i,d,j)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,i,d){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,i,d),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var i,d=this.layers.length;for(i=d-1;i>=0;i-=1)(this.completeLayers||this.elements[i])&&this.elements[i].renderFrame()},CVCompElement.prototype.destroy=function(){var e,i=this.layers.length;for(e=i-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,i){this.animationItem=e,this.renderConfig={clearCanvas:i&&i.clearCanvas!==void 0?i.clearCanvas:!0,context:i&&i.context||null,progressiveLoad:i&&i.progressiveLoad||!1,preserveAspectRatio:i&&i.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:i&&i.contentVisibility||"visible",className:i&&i.className||"",id:i&&i.id||"",runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.renderConfig.dpr=i&&i.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=i&&i.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var i=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var d=this.finalTransform.mat.toCSS();i.transform=d,i.webkitTransform=d}this.finalTransform._opMdf&&(i.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,i,d){this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,i,d){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,i,d),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var i=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",i.w),e.setAttribute("height",i.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,i){var d,j=e.length;for(d=0;d<j;d+=1)i=e[d].mProps.v.applyToPointArray(i[0],i[1],0);return i},HShapeElement.prototype.calculateShapeBoundingBox=function(e,i){var d=e.sh.v,j=e.transformers,_e,nt=d._length,ct,c,pt,gt;if(!(nt<=1)){for(_e=0;_e<nt-1;_e+=1)ct=this.getTransformedPoint(j,d.v[_e]),c=this.getTransformedPoint(j,d.o[_e]),pt=this.getTransformedPoint(j,d.i[_e+1]),gt=this.getTransformedPoint(j,d.v[_e+1]),this.checkBounds(ct,c,pt,gt,i);d.c&&(ct=this.getTransformedPoint(j,d.v[_e]),c=this.getTransformedPoint(j,d.o[_e]),pt=this.getTransformedPoint(j,d.i[0]),gt=this.getTransformedPoint(j,d.v[0]),this.checkBounds(ct,c,pt,gt,i))}},HShapeElement.prototype.checkBounds=function(e,i,d,j,_e){this.getBoundsOfCurve(e,i,d,j);var nt=this.shapeBoundingBox;_e.x=bmMin(nt.left,_e.x),_e.xMax=bmMax(nt.right,_e.xMax),_e.y=bmMin(nt.top,_e.y),_e.yMax=bmMax(nt.bottom,_e.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,i,d,j){for(var _e=[[e[0],j[0]],[e[1],j[1]]],nt,ct,c,pt,gt,St,kt,At=0;At<2;++At)ct=6*e[At]-12*i[At]+6*d[At],nt=-3*e[At]+9*i[At]-9*d[At]+3*j[At],c=3*i[At]-3*e[At],ct|=0,nt|=0,c|=0,nt===0&&ct===0||(nt===0?(pt=-c/ct,pt>0&&pt<1&&_e[At].push(this.calculateF(pt,e,i,d,j,At))):(gt=ct*ct-4*c*nt,gt>=0&&(St=(-ct+bmSqrt(gt))/(2*nt),St>0&&St<1&&_e[At].push(this.calculateF(St,e,i,d,j,At)),kt=(-ct-bmSqrt(gt))/(2*nt),kt>0&&kt<1&&_e[At].push(this.calculateF(kt,e,i,d,j,At)))));this.shapeBoundingBox.left=bmMin.apply(null,_e[0]),this.shapeBoundingBox.top=bmMin.apply(null,_e[1]),this.shapeBoundingBox.right=bmMax.apply(null,_e[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,_e[1])},HShapeElement.prototype.calculateF=function(e,i,d,j,_e,nt){return bmPow(1-e,3)*i[nt]+3*bmPow(1-e,2)*e*d[nt]+3*(1-e)*bmPow(e,2)*j[nt]+bmPow(e,3)*_e[nt]},HShapeElement.prototype.calculateBoundingBox=function(e,i){var d,j=e.length;for(d=0;d<j;d+=1)e[d]&&e[d].sh?this.calculateShapeBoundingBox(e[d],i):e[d]&&e[d].it?this.calculateBoundingBox(e[d].it,i):e[d]&&e[d].style&&e[d].w&&this.expandStrokeBoundingBox(e[d].w,i)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,i){var d=0;if(e.keyframes){for(var j=0;j<e.keyframes.length;j+=1){var _e=e.keyframes[j].s;_e>d&&(d=_e)}d*=e.mult}else d=e.v*e.mult;i.x-=d,i.xMax+=d,i.y-=d,i.yMax+=d},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,i=999999;if(e.x=i,e.xMax=-i,e.y=i,e.yMax=-i,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var d=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),d=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),d=!0),d||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var j=this.shapeCont.style,_e="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";j.transform=_e,j.webkitTransform=_e}}};function HTextElement(e,i,d){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var i=this.innerElem.style,d=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";i.fill=d,i.color=d,e.sc&&(i.stroke=this.buildColor(e.sc),i.strokeWidth=e.sw+"px");var j=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(i.fontSize=e.finalSize+"px",i.lineHeight=e.finalSize+"px",j.fClass)this.innerElem.className=j.fClass;else{i.fontFamily=j.fFamily;var _e=e.fWeight,nt=e.fStyle;i.fontStyle=nt,i.fontWeight=_e}var ct,c,pt=e.l;c=pt.length;var gt,St,kt,At=this.mHelper,Nt,Vt="",zt=0;for(ct=0;ct<c;ct+=1){if(this.globalData.fontManager.chars?(this.textPaths[zt]?gt=this.textPaths[zt]:(gt=createNS("path"),gt.setAttribute("stroke-linecap",lineCapEnum[1]),gt.setAttribute("stroke-linejoin",lineJoinEnum[2]),gt.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[zt]?(St=this.textSpans[zt],kt=St.children[0]):(St=createTag("div"),St.style.lineHeight=0,kt=createNS("svg"),kt.appendChild(gt),styleDiv(St)))):this.isMasked?gt=this.textPaths[zt]?this.textPaths[zt]:createNS("text"):this.textSpans[zt]?(St=this.textSpans[zt],gt=this.textPaths[zt]):(St=createTag("span"),styleDiv(St),gt=createTag("span"),styleDiv(gt),St.appendChild(gt)),this.globalData.fontManager.chars){var Jt=this.globalData.fontManager.getCharData(e.finalText[ct],j.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),Dt;if(Jt?Dt=Jt.data:Dt=null,At.reset(),Dt&&Dt.shapes&&Dt.shapes.length&&(Nt=Dt.shapes[0].it,At.scale(e.finalSize/100,e.finalSize/100),Vt=this.createPathShape(At,Nt),gt.setAttribute("d",Vt)),this.isMasked)this.innerElem.appendChild(gt);else{if(this.innerElem.appendChild(St),Dt&&Dt.shapes){document.body.appendChild(kt);var It=kt.getBBox();kt.setAttribute("width",It.width+2),kt.setAttribute("height",It.height+2),kt.setAttribute("viewBox",It.x-1+" "+(It.y-1)+" "+(It.width+2)+" "+(It.height+2));var Mt=kt.style,Ht="translate("+(It.x-1)+"px,"+(It.y-1)+"px)";Mt.transform=Ht,Mt.webkitTransform=Ht,pt[ct].yOffset=It.y-1}else kt.setAttribute("width",1),kt.setAttribute("height",1);St.appendChild(kt)}}else if(gt.textContent=pt[ct].val,gt.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(gt);else{this.innerElem.appendChild(St);var tr=gt.style,er="translate3d(0,"+-e.finalSize/1.2+"px,0)";tr.transform=er,tr.webkitTransform=er}this.isMasked?this.textSpans[zt]=gt:this.textSpans[zt]=St,this.textSpans[zt].style.display="block",this.textPaths[zt]=gt,zt+=1}for(;zt<this.textSpans.length;)this.textSpans[zt].style.display="none",zt+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var i="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=i,e.webkitTransform=i}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var d,j,_e=0,nt=this.textAnimator.renderedLetters,ct=this.textProperty.currentData.l;j=ct.length;var c,pt,gt;for(d=0;d<j;d+=1)ct[d].n?_e+=1:(pt=this.textSpans[d],gt=this.textPaths[d],c=nt[_e],_e+=1,c._mdf.m&&(this.isMasked?pt.setAttribute("transform",c.m):(pt.style.webkitTransform=c.m,pt.style.transform=c.m)),pt.style.opacity=c.o,c.sw&&c._mdf.sw&&gt.setAttribute("stroke-width",c.sw),c.sc&&c._mdf.sc&&gt.setAttribute("stroke",c.sc),c.fc&&c._mdf.fc&&(gt.setAttribute("fill",c.fc),gt.style.color=c.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var St=this.innerElem.getBBox();this.currentBBox.w!==St.width&&(this.currentBBox.w=St.width,this.svgElement.setAttribute("width",St.width)),this.currentBBox.h!==St.height&&(this.currentBBox.h=St.height,this.svgElement.setAttribute("height",St.height));var kt=1;if(this.currentBBox.w!==St.width+kt*2||this.currentBBox.h!==St.height+kt*2||this.currentBBox.x!==St.x-kt||this.currentBBox.y!==St.y-kt){this.currentBBox.w=St.width+kt*2,this.currentBBox.h=St.height+kt*2,this.currentBBox.x=St.x-kt,this.currentBBox.y=St.y-kt,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var At="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=At,e.webkitTransform=At}}}};function HCameraElement(e,i,d){this.initFrame(),this.initBaseData(e,i,d),this.initHierarchy();var j=PropertyFactory.getProp;if(this.pe=j(this,e.pe,0,0,this),e.ks.p.s?(this.px=j(this,e.ks.p.x,1,0,this),this.py=j(this,e.ks.p.y,1,0,this),this.pz=j(this,e.ks.p.z,1,0,this)):this.p=j(this,e.ks.p,1,0,this),e.ks.a&&(this.a=j(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var _e,nt=e.ks.or.k.length;for(_e=0;_e<nt;_e+=1)e.ks.or.k[_e].to=null,e.ks.or.k[_e].ti=null}this.or=j(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=j(this,e.ks.rx,0,degToRads,this),this.ry=j(this,e.ks.ry,0,degToRads,this),this.rz=j(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,i=this.comp.threeDElements.length,d,j,_e;for(e=0;e<i;e+=1)if(d=this.comp.threeDElements[e],d.type==="3d"){j=d.perspectiveElem.style,_e=d.container.style;var nt=this.pe.v+"px",ct="0px 0px 0px",c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";j.perspective=nt,j.webkitPerspective=nt,_e.transformOrigin=ct,_e.mozTransformOrigin=ct,_e.webkitTransformOrigin=ct,j.transform=c,j.webkitTransform=c}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,i,d;if(this.hierarchy)for(d=this.hierarchy.length,i=0;i<d;i+=1)e=this.hierarchy[i].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(d=this.hierarchy.length-1,i=d;i>=0;i-=1){var j=this.hierarchy[i].finalTransform.mProp;this.mat.translate(-j.p.v[0],-j.p.v[1],j.p.v[2]),this.mat.rotateX(-j.or.v[0]).rotateY(-j.or.v[1]).rotateZ(j.or.v[2]),this.mat.rotateX(-j.rx.v).rotateY(-j.ry.v).rotateZ(j.rz.v),this.mat.scale(1/j.s.v[0],1/j.s.v[1],1/j.s.v[2]),this.mat.translate(j.a.v[0],j.a.v[1],j.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var _e;this.p?_e=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:_e=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var nt=Math.sqrt(Math.pow(_e[0],2)+Math.pow(_e[1],2)+Math.pow(_e[2],2)),ct=[_e[0]/nt,_e[1]/nt,_e[2]/nt],c=Math.sqrt(ct[2]*ct[2]+ct[0]*ct[0]),pt=Math.atan2(ct[1],c),gt=Math.atan2(ct[0],-ct[2]);this.mat.rotateY(gt).rotateX(-pt)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var St=!this._prevMat.equals(this.mat);if((St||this.pe._mdf)&&this.comp.threeDElements){d=this.comp.threeDElements.length;var kt,At,Nt;for(i=0;i<d;i+=1)if(kt=this.comp.threeDElements[i],kt.type==="3d"){if(St){var Vt=this.mat.toCSS();Nt=kt.container.style,Nt.transform=Vt,Nt.webkitTransform=Vt}this.pe._mdf&&(At=kt.perspectiveElem.style,At.perspective=this.pe.v+"px",At.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,i,d){this.assetData=i.getAssetData(e.refId),this.initElement(e,i,d)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),i=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(i),i.crossOrigin="anonymous",i.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,i){var d=e.getBaseElement();if(d){var j=this.layers[i];if(!j.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(d,i);else{for(var _e=0,nt,ct,c;_e<i;)this.elements[_e]&&this.elements[_e]!==!0&&this.elements[_e].getBaseElement&&(ct=this.elements[_e],c=this.layers[_e].ddd?this.getThreeDContainerByPos(_e):ct.getBaseElement(),nt=c||nt),_e+=1;nt?(!j.ddd||!this.supports3d)&&this.layerElement.insertBefore(d,nt):(!j.ddd||!this.supports3d)&&this.layerElement.appendChild(d)}else this.addTo3dContainer(d,i)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var i=0,d=this.threeDElements.length;i<d;){if(this.threeDElements[i].startPos<=e&&this.threeDElements[i].endPos>=e)return this.threeDElements[i].perspectiveElem;i+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,i){var d=createTag("div"),j,_e;styleDiv(d);var nt=createTag("div");if(styleDiv(nt),i==="3d"){j=d.style,j.width=this.globalData.compSize.w+"px",j.height=this.globalData.compSize.h+"px";var ct="50% 50%";j.webkitTransformOrigin=ct,j.mozTransformOrigin=ct,j.transformOrigin=ct,_e=nt.style;var c="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";_e.transform=c,_e.webkitTransform=c}d.appendChild(nt);var pt={container:nt,perspectiveElem:d,startPos:e,endPos:e,type:i};return this.threeDElements.push(pt),pt},HybridRendererBase.prototype.build3dContainers=function(){var e,i=this.layers.length,d,j="";for(e=0;e<i;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(j!=="3d"&&(j="3d",d=this.createThreeDContainer(e,"3d")),d.endPos=Math.max(d.endPos,e)):(j!=="2d"&&(j="2d",d=this.createThreeDContainer(e,"2d")),d.endPos=Math.max(d.endPos,e));for(i=this.threeDElements.length,e=i-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,i){for(var d=0,j=this.threeDElements.length;d<j;){if(i<=this.threeDElements[d].endPos){for(var _e=this.threeDElements[d].startPos,nt;_e<i;)this.elements[_e]&&this.elements[_e].getBaseElement&&(nt=this.elements[_e].getBaseElement()),_e+=1;nt?this.threeDElements[d].container.insertBefore(e,nt):this.threeDElements[d].container.appendChild(e);break}d+=1}},HybridRendererBase.prototype.configAnimation=function(e){var i=createTag("div"),d=this.animationItem.wrapper,j=i.style;j.width=e.w+"px",j.height=e.h+"px",this.resizerElem=i,styleDiv(i),j.transformStyle="flat",j.mozTransformStyle="flat",j.webkitTransformStyle="flat",this.renderConfig.className&&i.setAttribute("class",this.renderConfig.className),d.appendChild(i),j.overflow="hidden";var _e=createNS("svg");_e.setAttribute("width","1"),_e.setAttribute("height","1"),styleDiv(_e),this.resizerElem.appendChild(_e);var nt=createNS("defs");_e.appendChild(nt),this.data=e,this.setupGlobalData(e,_e),this.globalData.defs=nt,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,i=this.layers?this.layers.length:0;for(e=0;e<i;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,i=this.animationItem.wrapper.offsetHeight,d=e/i,j=this.globalData.compSize.w/this.globalData.compSize.h,_e,nt,ct,c;j>d?(_e=e/this.globalData.compSize.w,nt=e/this.globalData.compSize.w,ct=0,c=(i-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(_e=i/this.globalData.compSize.h,nt=i/this.globalData.compSize.h,ct=(e-this.globalData.compSize.w*(i/this.globalData.compSize.h))/2,c=0);var pt=this.resizerElem.style;pt.webkitTransform="matrix3d("+_e+",0,0,0,0,"+nt+",0,0,0,0,1,0,"+ct+","+c+",0,1)",pt.transform=pt.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,i=this.globalData.compSize.h,d,j=this.threeDElements.length;for(d=0;d<j;d+=1){var _e=this.threeDElements[d].perspectiveElem.style;_e.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(i,2))+"px",_e.perspective=_e.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var i,d=e.length,j=createTag("div");for(i=0;i<d;i+=1)if(e[i].xt){var _e=this.createComp(e[i],j,this.globalData.comp,null);_e.initExpressions(),this.globalData.projectInterface.registerComposition(_e)}};function HCompElement(e,i,d){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,i,d),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,i.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,i){for(var d=0,j;d<i;)this.elements[d]&&this.elements[d].getBaseElement&&(j=this.elements[d].getBaseElement()),d+=1;j?this.layerElement.insertBefore(e,j):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,i){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:i&&i.className||"",imagePreserveAspectRatio:i&&i.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(i&&i.hideOnTransparent===!1),filterSize:{width:i&&i.filterSize&&i.filterSize.width||"400%",height:i&&i.filterSize&&i.filterSize.height||"400%",x:i&&i.filterSize&&i.filterSize.x||"-100%",y:i&&i.filterSize&&i.filterSize.y||"-100%"},runExpressions:!i||i.runExpressions===void 0||i.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function i(d){for(var j=0,_e=e.layers.length;j<_e;){if(e.layers[j].nm===d||e.layers[j].ind===d)return e.elements[j].layerInterface;j+=1}return null}return Object.defineProperty(i,"_name",{value:e.data.nm}),i.layer=i,i.pixelAspect=1,i.height=e.data.h||e.globalData.compSize.h,i.width=e.data.w||e.globalData.compSize.w,i.pixelAspect=1,i.frameDuration=1/e.globalData.frameRate,i.displayStartTime=0,i.numLayers=e.layers.length,i}}();function _typeof$2(e){"@babel/helpers - typeof";return _typeof$2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$2(e)}function seedRandom(e,i){var d=this,j=256,_e=6,nt=52,ct="random",c=i.pow(j,_e),pt=i.pow(2,nt),gt=pt*2,St=j-1,kt;function At(Mt,Ht,tr){var er=[];Ht=Ht===!0?{entropy:!0}:Ht||{};var dr=Jt(zt(Ht.entropy?[Mt,It(e)]:Mt===null?Dt():Mt,3),er),mr=new Nt(er),Ur=function(){for(var Yr=mr.g(_e),es=c,ms=0;Yr<pt;)Yr=(Yr+ms)*j,es*=j,ms=mr.g(1);for(;Yr>=gt;)Yr/=2,es/=2,ms>>>=1;return(Yr+ms)/es};return Ur.int32=function(){return mr.g(4)|0},Ur.quick=function(){return mr.g(4)/4294967296},Ur.double=Ur,Jt(It(mr.S),e),(Ht.pass||tr||function(Dr,Yr,es,ms){return ms&&(ms.S&&Vt(ms,mr),Dr.state=function(){return Vt(mr,{})}),es?(i[ct]=Dr,Yr):Dr})(Ur,dr,"global"in Ht?Ht.global:this==i,Ht.state)}i["seed"+ct]=At;function Nt(Mt){var Ht,tr=Mt.length,er=this,dr=0,mr=er.i=er.j=0,Ur=er.S=[];for(tr||(Mt=[tr++]);dr<j;)Ur[dr]=dr++;for(dr=0;dr<j;dr++)Ur[dr]=Ur[mr=St&mr+Mt[dr%tr]+(Ht=Ur[dr])],Ur[mr]=Ht;er.g=function(Dr){for(var Yr,es=0,ms=er.i,Ms=er.j,Kr=er.S;Dr--;)Yr=Kr[ms=St&ms+1],es=es*j+Kr[St&(Kr[ms]=Kr[Ms=St&Ms+Yr])+(Kr[Ms]=Yr)];return er.i=ms,er.j=Ms,es}}function Vt(Mt,Ht){return Ht.i=Mt.i,Ht.j=Mt.j,Ht.S=Mt.S.slice(),Ht}function zt(Mt,Ht){var tr=[],er=_typeof$2(Mt),dr;if(Ht&&er=="object")for(dr in Mt)try{tr.push(zt(Mt[dr],Ht-1))}catch{}return tr.length?tr:er=="string"?Mt:Mt+"\0"}function Jt(Mt,Ht){for(var tr=Mt+"",er,dr=0;dr<tr.length;)Ht[St&dr]=St&(er^=Ht[St&dr]*19)+tr.charCodeAt(dr++);return It(Ht)}function Dt(){try{var Mt=new Uint8Array(j);return(d.crypto||d.msCrypto).getRandomValues(Mt),It(Mt)}catch{var Ht=d.navigator,tr=Ht&&Ht.plugins;return[+new Date,d,tr,d.screen,It(e)]}}function It(Mt){return String.fromCharCode.apply(0,Mt)}Jt(i.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return _typeof$1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,i){return e==="number"||i instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var i=_typeof$1(e);if(i==="number"||e instanceof Number||i==="boolean")return-e;if($bm_isInstanceOfArray(e)){var d,j=e.length,_e=[];for(d=0;d<j;d+=1)_e[d]=-e[d];return _e}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,i){var d=_typeof$1(e),j=_typeof$1(i);if(isNumerable(d,e)&&isNumerable(j,i)||d==="string"||j==="string")return e+i;if($bm_isInstanceOfArray(e)&&isNumerable(j,i))return e=e.slice(0),e[0]+=i,e;if(isNumerable(d,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e+i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _e=0,nt=e.length,ct=i.length,c=[];_e<nt||_e<ct;)(typeof e[_e]=="number"||e[_e]instanceof Number)&&(typeof i[_e]=="number"||i[_e]instanceof Number)?c[_e]=e[_e]+i[_e]:c[_e]=i[_e]===void 0?e[_e]:e[_e]||i[_e],_e+=1;return c}return 0}var add=sum;function sub(e,i){var d=_typeof$1(e),j=_typeof$1(i);if(isNumerable(d,e)&&isNumerable(j,i))return d==="string"&&(e=parseInt(e,10)),j==="string"&&(i=parseInt(i,10)),e-i;if($bm_isInstanceOfArray(e)&&isNumerable(j,i))return e=e.slice(0),e[0]-=i,e;if(isNumerable(d,e)&&$bm_isInstanceOfArray(i))return i=i.slice(0),i[0]=e-i[0],i;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(i)){for(var _e=0,nt=e.length,ct=i.length,c=[];_e<nt||_e<ct;)(typeof e[_e]=="number"||e[_e]instanceof Number)&&(typeof i[_e]=="number"||i[_e]instanceof Number)?c[_e]=e[_e]-i[_e]:c[_e]=i[_e]===void 0?e[_e]:e[_e]||i[_e],_e+=1;return c}return 0}function mul(e,i){var d=_typeof$1(e),j=_typeof$1(i),_e;if(isNumerable(d,e)&&isNumerable(j,i))return e*i;var nt,ct;if($bm_isInstanceOfArray(e)&&isNumerable(j,i)){for(ct=e.length,_e=createTypedArray("float32",ct),nt=0;nt<ct;nt+=1)_e[nt]=e[nt]*i;return _e}if(isNumerable(d,e)&&$bm_isInstanceOfArray(i)){for(ct=i.length,_e=createTypedArray("float32",ct),nt=0;nt<ct;nt+=1)_e[nt]=e*i[nt];return _e}return 0}function div(e,i){var d=_typeof$1(e),j=_typeof$1(i),_e;if(isNumerable(d,e)&&isNumerable(j,i))return e/i;var nt,ct;if($bm_isInstanceOfArray(e)&&isNumerable(j,i)){for(ct=e.length,_e=createTypedArray("float32",ct),nt=0;nt<ct;nt+=1)_e[nt]=e[nt]/i;return _e}if(isNumerable(d,e)&&$bm_isInstanceOfArray(i)){for(ct=i.length,_e=createTypedArray("float32",ct),nt=0;nt<ct;nt+=1)_e[nt]=e/i[nt];return _e}return 0}function mod(e,i){return typeof e=="string"&&(e=parseInt(e,10)),typeof i=="string"&&(i=parseInt(i,10)),e%i}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,i,d){if(i>d){var j=d;d=i,i=j}return Math.min(Math.max(e,i),d)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,i){if(typeof e=="number"||e instanceof Number)return i=i||0,Math.abs(e-i);i||(i=helperLengthArray);var d,j=Math.min(e.length,i.length),_e=0;for(d=0;d<j;d+=1)_e+=Math.pow(i[d]-e[d],2);return Math.sqrt(_e)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var i=e[0],d=e[1],j=e[2],_e=Math.max(i,d,j),nt=Math.min(i,d,j),ct,c,pt=(_e+nt)/2;if(_e===nt)ct=0,c=0;else{var gt=_e-nt;switch(c=pt>.5?gt/(2-_e-nt):gt/(_e+nt),_e){case i:ct=(d-j)/gt+(d<j?6:0);break;case d:ct=(j-i)/gt+2;break;case j:ct=(i-d)/gt+4;break}ct/=6}return[ct,c,pt,e[3]]}function hue2rgb(e,i,d){return d<0&&(d+=1),d>1&&(d-=1),d<1/6?e+(i-e)*6*d:d<1/2?i:d<2/3?e+(i-e)*(2/3-d)*6:e}function hslToRgb(e){var i=e[0],d=e[1],j=e[2],_e,nt,ct;if(d===0)_e=j,ct=j,nt=j;else{var c=j<.5?j*(1+d):j+d-j*d,pt=2*j-c;_e=hue2rgb(pt,c,i+1/3),nt=hue2rgb(pt,c,i),ct=hue2rgb(pt,c,i-1/3)}return[_e,nt,ct,e[3]]}function linear(e,i,d,j,_e){if((j===void 0||_e===void 0)&&(j=i,_e=d,i=0,d=1),d<i){var nt=d;d=i,i=nt}if(e<=i)return j;if(e>=d)return _e;var ct=d===i?0:(e-i)/(d-i);if(!j.length)return j+(_e-j)*ct;var c,pt=j.length,gt=createTypedArray("float32",pt);for(c=0;c<pt;c+=1)gt[c]=j[c]+(_e[c]-j[c])*ct;return gt}function random(e,i){if(i===void 0&&(e===void 0?(e=0,i=1):(i=e,e=void 0)),i.length){var d,j=i.length;e||(e=createTypedArray("float32",j));var _e=createTypedArray("float32",j),nt=BMMath.random();for(d=0;d<j;d+=1)_e[d]=e[d]+nt*(i[d]-e[d]);return _e}e===void 0&&(e=0);var ct=BMMath.random();return e+ct*(i-e)}function createPath(e,i,d,j){var _e,nt=e.length,ct=shapePool.newElement();ct.setPathData(!!j,nt);var c=[0,0],pt,gt;for(_e=0;_e<nt;_e+=1)pt=i&&i[_e]?i[_e]:c,gt=d&&d[_e]?d[_e]:c,ct.setTripleAt(e[_e][0],e[_e][1],gt[0]+e[_e][0],gt[1]+e[_e][1],pt[0]+e[_e][0],pt[1]+e[_e][1],_e,!0);return ct}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty._name=elem.data.nm,thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(i,d){var j,_e,nt=this.pv.length?this.pv.length:1,ct=createTypedArray("float32",nt);i=5;var c=Math.floor(time*i);for(j=0,_e=0;j<c;){for(_e=0;_e<nt;_e+=1)ct[_e]+=-d+d*2*BMMath.random();j+=1}var pt=time*i,gt=pt-Math.floor(pt),St=createTypedArray("float32",nt);if(nt>1){for(_e=0;_e<nt;_e+=1)St[_e]=this.pv[_e]+ct[_e]+(-d+d*2*BMMath.random())*gt;return St}return this.pv+ct[0]+(-d+d*2*BMMath.random())*gt}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,i){return loopIn(e,i,!0)}function loopOutDuration(e,i){return loopOut(e,i,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,i){var d=[i[0]-e[0],i[1]-e[1],i[2]-e[2]],j=Math.atan2(d[0],Math.sqrt(d[1]*d[1]+d[2]*d[2]))/degToRads,_e=-Math.atan2(d[1],d[2])/degToRads;return[_e,j,0]}function easeOut(e,i,d,j,_e){return applyEase(easeOutBez,e,i,d,j,_e)}function easeIn(e,i,d,j,_e){return applyEase(easeInBez,e,i,d,j,_e)}function ease(e,i,d,j,_e){return applyEase(easeInOutBez,e,i,d,j,_e)}function applyEase(e,i,d,j,_e,nt){_e===void 0?(_e=d,nt=j):i=(i-d)/(j-d),i>1?i=1:i<0&&(i=0);var ct=e(i);if($bm_isInstanceOfArray(_e)){var c,pt=_e.length,gt=createTypedArray("float32",pt);for(c=0;c<pt;c+=1)gt[c]=(nt[c]-_e[c])*ct+_e[c];return gt}return(nt-_e)*ct+_e}function nearestKey(e){var i,d=data.k.length,j,_e;if(!data.k.length||typeof data.k[0]=="number")j=0,_e=0;else if(j=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)j=1,_e=data.k[0].t;else{for(i=0;i<d-1;i+=1)if(e===data.k[i].t){j=i+1,_e=data.k[i].t;break}else if(e>data.k[i].t&&e<data.k[i+1].t){e-data.k[i].t>data.k[i+1].t-e?(j=i+2,_e=data.k[i+1].t):(j=i+1,_e=data.k[i].t);break}j===-1&&(j=i+1,_e=data.k[i].t)}var nt={};return nt.index=j,nt.time=_e/elem.comp.globalData.frameRate,nt}function key(e){var i,d,j;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,i={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var _e=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(j=_e.length,d=0;d<j;d+=1)i[d]=_e[d],i.value[d]=_e[d];return i}function framesToTime(e,i){return i||(i=elem.comp.globalData.frameRate),e/i}function timeToFrames(e,i){return!e&&e!==0&&(e=time),i||(i=elem.comp.globalData.frameRate),e*i}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,i){return typeof value=="string"?i===void 0?value.substring(e):value.substring(e,i):""}function substr(e,i){return typeof value=="string"?i===void 0?value.substr(e):value.substr(e,i):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=i,e.resetFrame=ExpressionManager.resetFrame;function i(d){var j=0,_e=[];function nt(){j+=1}function ct(){j-=1,j===0&&pt()}function c(gt){_e.indexOf(gt)===-1&&_e.push(gt)}function pt(){var gt,St=_e.length;for(gt=0;gt<St;gt+=1)_e[gt].release();_e.length=0}d.renderer.compInterface=CompExpressionInterface(d.renderer),d.renderer.globalData.projectInterface.registerComposition(d.renderer),d.renderer.globalData.pushExpression=nt,d.renderer.globalData.popExpression=ct,d.renderer.globalData.registerExpressionProperty=c}return e}(),MaskManagerInterface=function(){function e(d,j){this._mask=d,this._data=j}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var i=function(j){var _e=createSizedArray(j.viewData.length),nt,ct=j.viewData.length;for(nt=0;nt<ct;nt+=1)_e[nt]=new e(j.viewData[nt],j.masksProperties[nt]);var c=function(gt){for(nt=0;nt<ct;){if(j.masksProperties[nt].nm===gt)return _e[nt];nt+=1}return null};return c};return i}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},i={pv:[0,0,0],v:[0,0,0],mult:1};function d(ct,c,pt){Object.defineProperty(ct,"velocity",{get:function(){return c.getVelocityAtTime(c.comp.currentFrame)}}),ct.numKeys=c.keyframes?c.keyframes.length:0,ct.key=function(gt){if(!ct.numKeys)return 0;var St="";"s"in c.keyframes[gt-1]?St=c.keyframes[gt-1].s:"e"in c.keyframes[gt-2]?St=c.keyframes[gt-2].e:St=c.keyframes[gt-2].s;var kt=pt==="unidimensional"?new Number(St):Object.assign({},St);return kt.time=c.keyframes[gt-1].t/c.elem.comp.globalData.frameRate,kt.value=pt==="unidimensional"?St[0]:St,kt},ct.valueAtTime=c.getValueAtTime,ct.speedAtTime=c.getSpeedAtTime,ct.velocityAtTime=c.getVelocityAtTime,ct.propertyGroup=c.propertyGroup}function j(ct){(!ct||!("pv"in ct))&&(ct=e);var c=1/ct.mult,pt=ct.pv*c,gt=new Number(pt);return gt.value=pt,d(gt,ct,"unidimensional"),function(){return ct.k&&ct.getValue(),pt=ct.v*c,gt.value!==pt&&(gt=new Number(pt),gt.value=pt,gt[0]=pt,d(gt,ct,"unidimensional")),gt}}function _e(ct){(!ct||!("pv"in ct))&&(ct=i);var c=1/ct.mult,pt=ct.data&&ct.data.l||ct.pv.length,gt=createTypedArray("float32",pt),St=createTypedArray("float32",pt);return gt.value=St,d(gt,ct,"multidimensional"),function(){ct.k&&ct.getValue();for(var kt=0;kt<pt;kt+=1)St[kt]=ct.v[kt]*c,gt[kt]=St[kt];return gt}}function nt(){return e}return function(ct){return ct?ct.propType==="unidimensional"?j(ct):_e(ct):nt}}(),TransformExpressionInterface=function(){return function(e){function i(ct){switch(ct){case"scale":case"Scale":case"ADBE Scale":case 6:return i.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return i.rotation;case"ADBE Rotate X":return i.xRotation;case"ADBE Rotate Y":return i.yRotation;case"position":case"Position":case"ADBE Position":case 2:return i.position;case"ADBE Position_0":return i.xPosition;case"ADBE Position_1":return i.yPosition;case"ADBE Position_2":return i.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return i.anchorPoint;case"opacity":case"Opacity":case 11:return i.opacity;default:return null}}Object.defineProperty(i,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(i,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(i,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(i,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(i,"scale",{get:ExpressionPropertyInterface(e.s)});var d,j,_e,nt;return e.p?nt=ExpressionPropertyInterface(e.p):(d=ExpressionPropertyInterface(e.px),j=ExpressionPropertyInterface(e.py),e.pz&&(_e=ExpressionPropertyInterface(e.pz))),Object.defineProperty(i,"position",{get:function(){return e.p?nt():[d(),j(),_e?_e():0]}}),Object.defineProperty(i,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(i,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(i,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(i,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(i,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(i,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(i,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(i,"orientation",{get:ExpressionPropertyInterface(e.or)}),i}}(),LayerExpressionInterface=function(){function e(gt){var St=new Matrix;if(gt!==void 0){var kt=this._elem.finalTransform.mProp.getValueAtTime(gt);kt.clone(St)}else{var At=this._elem.finalTransform.mProp;At.applyToMatrix(St)}return St}function i(gt,St){var kt=this.getMatrix(St);return kt.props[12]=0,kt.props[13]=0,kt.props[14]=0,this.applyPoint(kt,gt)}function d(gt,St){var kt=this.getMatrix(St);return this.applyPoint(kt,gt)}function j(gt,St){var kt=this.getMatrix(St);return kt.props[12]=0,kt.props[13]=0,kt.props[14]=0,this.invertPoint(kt,gt)}function _e(gt,St){var kt=this.getMatrix(St);return this.invertPoint(kt,gt)}function nt(gt,St){if(this._elem.hierarchy&&this._elem.hierarchy.length){var kt,At=this._elem.hierarchy.length;for(kt=0;kt<At;kt+=1)this._elem.hierarchy[kt].finalTransform.mProp.applyToMatrix(gt)}return gt.applyToPointArray(St[0],St[1],St[2]||0)}function ct(gt,St){if(this._elem.hierarchy&&this._elem.hierarchy.length){var kt,At=this._elem.hierarchy.length;for(kt=0;kt<At;kt+=1)this._elem.hierarchy[kt].finalTransform.mProp.applyToMatrix(gt)}return gt.inversePoint(St)}function c(gt){var St=new Matrix;if(St.reset(),this._elem.finalTransform.mProp.applyToMatrix(St),this._elem.hierarchy&&this._elem.hierarchy.length){var kt,At=this._elem.hierarchy.length;for(kt=0;kt<At;kt+=1)this._elem.hierarchy[kt].finalTransform.mProp.applyToMatrix(St);return St.inversePoint(gt)}return St.inversePoint(gt)}function pt(){return[1,1,1,1]}return function(gt){var St;function kt(zt){Nt.mask=new MaskManagerInterface(zt,gt)}function At(zt){Nt.effect=zt}function Nt(zt){switch(zt){case"ADBE Root Vectors Group":case"Contents":case 2:return Nt.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return St;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return Nt.effect;case"ADBE Text Properties":return Nt.textInterface;default:return null}}Nt.getMatrix=e,Nt.invertPoint=ct,Nt.applyPoint=nt,Nt.toWorld=d,Nt.toWorldVec=i,Nt.fromWorld=_e,Nt.fromWorldVec=j,Nt.toComp=d,Nt.fromComp=c,Nt.sampleImage=pt,Nt.sourceRectAtTime=gt.sourceRectAtTime.bind(gt),Nt._elem=gt,St=TransformExpressionInterface(gt.finalTransform.mProp);var Vt=getDescriptor(St,"anchorPoint");return Object.defineProperties(Nt,{hasParent:{get:function(){return gt.hierarchy.length}},parent:{get:function(){return gt.hierarchy[0].layerInterface}},rotation:getDescriptor(St,"rotation"),scale:getDescriptor(St,"scale"),position:getDescriptor(St,"position"),opacity:getDescriptor(St,"opacity"),anchorPoint:Vt,anchor_point:Vt,transform:{get:function(){return St}},active:{get:function(){return gt.isInRange}}}),Nt.startTime=gt.data.st,Nt.index=gt.data.ind,Nt.source=gt.data.refId,Nt.height=gt.data.ty===0?gt.data.h:100,Nt.width=gt.data.ty===0?gt.data.w:100,Nt.inPoint=gt.data.ip/gt.comp.globalData.frameRate,Nt.outPoint=gt.data.op/gt.comp.globalData.frameRate,Nt._name=gt.data.nm,Nt.registerMaskInterface=kt,Nt.registerEffectsInterface=At,Nt}}(),propertyGroupFactory=function(){return function(e,i){return function(d){return d=d===void 0?1:d,d<=0?e:i(d-1)}}}(),PropertyInterface=function(){return function(e,i){var d={_name:e};function j(_e){return _e=_e===void 0?1:_e,_e<=0?d:i(_e-1)}return j}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:i};function i(_e,nt){if(_e.effectsManager){var ct=[],c=_e.data.ef,pt,gt=_e.effectsManager.effectElements.length;for(pt=0;pt<gt;pt+=1)ct.push(d(c[pt],_e.effectsManager.effectElements[pt],nt,_e));var St=_e.data.ef||[],kt=function(Nt){for(pt=0,gt=St.length;pt<gt;){if(Nt===St[pt].nm||Nt===St[pt].mn||Nt===St[pt].ix)return ct[pt];pt+=1}return null};return Object.defineProperty(kt,"numProperties",{get:function(){return St.length}}),kt}return null}function d(_e,nt,ct,c){function pt(Nt){for(var Vt=_e.ef,zt=0,Jt=Vt.length;zt<Jt;){if(Nt===Vt[zt].nm||Nt===Vt[zt].mn||Nt===Vt[zt].ix)return Vt[zt].ty===5?St[zt]:St[zt]();zt+=1}throw new Error}var gt=propertyGroupFactory(pt,ct),St=[],kt,At=_e.ef.length;for(kt=0;kt<At;kt+=1)_e.ef[kt].ty===5?St.push(d(_e.ef[kt],nt.effectElements[kt],nt.effectElements[kt].propertyGroup,c)):St.push(j(nt.effectElements[kt],_e.ef[kt].ty,c,gt));return _e.mn==="ADBE Color Control"&&Object.defineProperty(pt,"color",{get:function(){return St[0]()}}),Object.defineProperties(pt,{numProperties:{get:function(){return _e.np}},_name:{value:_e.nm},propertyGroup:{value:gt}}),pt.enabled=_e.en!==0,pt.active=pt.enabled,pt}function j(_e,nt,ct,c){var pt=ExpressionPropertyInterface(_e.p);function gt(){return nt===10?ct.comp.compInterface(_e.p.v):pt()}return _e.p.setGroupProperty&&_e.p.setGroupProperty(PropertyInterface("",c)),gt}return e}(),ShapePathInterface=function(){return function(i,d,j){var _e=d.sh;function nt(c){return c==="Shape"||c==="shape"||c==="Path"||c==="path"||c==="ADBE Vector Shape"||c===2?nt.path:null}var ct=propertyGroupFactory(nt,j);return _e.setGroupProperty(PropertyInterface("Path",ct)),Object.defineProperties(nt,{path:{get:function(){return _e.k&&_e.getValue(),_e}},shape:{get:function(){return _e.k&&_e.getValue(),_e}},_name:{value:i.nm},ix:{value:i.ix},propertyIndex:{value:i.ix},mn:{value:i.mn},propertyGroup:{value:j}}),nt}}(),ShapeExpressionInterface=function(){function e(Vt,zt,Jt){var Dt=[],It,Mt=Vt?Vt.length:0;for(It=0;It<Mt;It+=1)Vt[It].ty==="gr"?Dt.push(d(Vt[It],zt[It],Jt)):Vt[It].ty==="fl"?Dt.push(j(Vt[It],zt[It],Jt)):Vt[It].ty==="st"?Dt.push(ct(Vt[It],zt[It],Jt)):Vt[It].ty==="tm"?Dt.push(c(Vt[It],zt[It],Jt)):Vt[It].ty==="tr"||(Vt[It].ty==="el"?Dt.push(gt(Vt[It],zt[It],Jt)):Vt[It].ty==="sr"?Dt.push(St(Vt[It],zt[It],Jt)):Vt[It].ty==="sh"?Dt.push(ShapePathInterface(Vt[It],zt[It],Jt)):Vt[It].ty==="rc"?Dt.push(kt(Vt[It],zt[It],Jt)):Vt[It].ty==="rd"?Dt.push(At(Vt[It],zt[It],Jt)):Vt[It].ty==="rp"?Dt.push(Nt(Vt[It],zt[It],Jt)):Vt[It].ty==="gf"?Dt.push(_e(Vt[It],zt[It],Jt)):Dt.push(nt(Vt[It],zt[It])));return Dt}function i(Vt,zt,Jt){var Dt,It=function(tr){for(var er=0,dr=Dt.length;er<dr;){if(Dt[er]._name===tr||Dt[er].mn===tr||Dt[er].propertyIndex===tr||Dt[er].ix===tr||Dt[er].ind===tr)return Dt[er];er+=1}return typeof tr=="number"?Dt[tr-1]:null};It.propertyGroup=propertyGroupFactory(It,Jt),Dt=e(Vt.it,zt.it,It.propertyGroup),It.numProperties=Dt.length;var Mt=pt(Vt.it[Vt.it.length-1],zt.it[zt.it.length-1],It.propertyGroup);return It.transform=Mt,It.propertyIndex=Vt.cix,It._name=Vt.nm,It}function d(Vt,zt,Jt){var Dt=function(tr){switch(tr){case"ADBE Vectors Group":case"Contents":case 2:return Dt.content;default:return Dt.transform}};Dt.propertyGroup=propertyGroupFactory(Dt,Jt);var It=i(Vt,zt,Dt.propertyGroup),Mt=pt(Vt.it[Vt.it.length-1],zt.it[zt.it.length-1],Dt.propertyGroup);return Dt.content=It,Dt.transform=Mt,Object.defineProperty(Dt,"_name",{get:function(){return Vt.nm}}),Dt.numProperties=Vt.np,Dt.propertyIndex=Vt.ix,Dt.nm=Vt.nm,Dt.mn=Vt.mn,Dt}function j(Vt,zt,Jt){function Dt(It){return It==="Color"||It==="color"?Dt.color:It==="Opacity"||It==="opacity"?Dt.opacity:null}return Object.defineProperties(Dt,{color:{get:ExpressionPropertyInterface(zt.c)},opacity:{get:ExpressionPropertyInterface(zt.o)},_name:{value:Vt.nm},mn:{value:Vt.mn}}),zt.c.setGroupProperty(PropertyInterface("Color",Jt)),zt.o.setGroupProperty(PropertyInterface("Opacity",Jt)),Dt}function _e(Vt,zt,Jt){function Dt(It){return It==="Start Point"||It==="start point"?Dt.startPoint:It==="End Point"||It==="end point"?Dt.endPoint:It==="Opacity"||It==="opacity"?Dt.opacity:null}return Object.defineProperties(Dt,{startPoint:{get:ExpressionPropertyInterface(zt.s)},endPoint:{get:ExpressionPropertyInterface(zt.e)},opacity:{get:ExpressionPropertyInterface(zt.o)},type:{get:function(){return"a"}},_name:{value:Vt.nm},mn:{value:Vt.mn}}),zt.s.setGroupProperty(PropertyInterface("Start Point",Jt)),zt.e.setGroupProperty(PropertyInterface("End Point",Jt)),zt.o.setGroupProperty(PropertyInterface("Opacity",Jt)),Dt}function nt(){function Vt(){return null}return Vt}function ct(Vt,zt,Jt){var Dt=propertyGroupFactory(dr,Jt),It=propertyGroupFactory(er,Dt);function Mt(mr){Object.defineProperty(er,Vt.d[mr].nm,{get:ExpressionPropertyInterface(zt.d.dataProps[mr].p)})}var Ht,tr=Vt.d?Vt.d.length:0,er={};for(Ht=0;Ht<tr;Ht+=1)Mt(Ht),zt.d.dataProps[Ht].p.setGroupProperty(It);function dr(mr){return mr==="Color"||mr==="color"?dr.color:mr==="Opacity"||mr==="opacity"?dr.opacity:mr==="Stroke Width"||mr==="stroke width"?dr.strokeWidth:null}return Object.defineProperties(dr,{color:{get:ExpressionPropertyInterface(zt.c)},opacity:{get:ExpressionPropertyInterface(zt.o)},strokeWidth:{get:ExpressionPropertyInterface(zt.w)},dash:{get:function(){return er}},_name:{value:Vt.nm},mn:{value:Vt.mn}}),zt.c.setGroupProperty(PropertyInterface("Color",Dt)),zt.o.setGroupProperty(PropertyInterface("Opacity",Dt)),zt.w.setGroupProperty(PropertyInterface("Stroke Width",Dt)),dr}function c(Vt,zt,Jt){function Dt(Mt){return Mt===Vt.e.ix||Mt==="End"||Mt==="end"?Dt.end:Mt===Vt.s.ix?Dt.start:Mt===Vt.o.ix?Dt.offset:null}var It=propertyGroupFactory(Dt,Jt);return Dt.propertyIndex=Vt.ix,zt.s.setGroupProperty(PropertyInterface("Start",It)),zt.e.setGroupProperty(PropertyInterface("End",It)),zt.o.setGroupProperty(PropertyInterface("Offset",It)),Dt.propertyIndex=Vt.ix,Dt.propertyGroup=Jt,Object.defineProperties(Dt,{start:{get:ExpressionPropertyInterface(zt.s)},end:{get:ExpressionPropertyInterface(zt.e)},offset:{get:ExpressionPropertyInterface(zt.o)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}function pt(Vt,zt,Jt){function Dt(Mt){return Vt.a.ix===Mt||Mt==="Anchor Point"?Dt.anchorPoint:Vt.o.ix===Mt||Mt==="Opacity"?Dt.opacity:Vt.p.ix===Mt||Mt==="Position"?Dt.position:Vt.r.ix===Mt||Mt==="Rotation"||Mt==="ADBE Vector Rotation"?Dt.rotation:Vt.s.ix===Mt||Mt==="Scale"?Dt.scale:Vt.sk&&Vt.sk.ix===Mt||Mt==="Skew"?Dt.skew:Vt.sa&&Vt.sa.ix===Mt||Mt==="Skew Axis"?Dt.skewAxis:null}var It=propertyGroupFactory(Dt,Jt);return zt.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",It)),zt.transform.mProps.p.setGroupProperty(PropertyInterface("Position",It)),zt.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",It)),zt.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",It)),zt.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",It)),zt.transform.mProps.sk&&(zt.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",It)),zt.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",It))),zt.transform.op.setGroupProperty(PropertyInterface("Opacity",It)),Object.defineProperties(Dt,{opacity:{get:ExpressionPropertyInterface(zt.transform.mProps.o)},position:{get:ExpressionPropertyInterface(zt.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(zt.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(zt.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(zt.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(zt.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(zt.transform.mProps.sa)},_name:{value:Vt.nm}}),Dt.ty="tr",Dt.mn=Vt.mn,Dt.propertyGroup=Jt,Dt}function gt(Vt,zt,Jt){function Dt(Ht){return Vt.p.ix===Ht?Dt.position:Vt.s.ix===Ht?Dt.size:null}var It=propertyGroupFactory(Dt,Jt);Dt.propertyIndex=Vt.ix;var Mt=zt.sh.ty==="tm"?zt.sh.prop:zt.sh;return Mt.s.setGroupProperty(PropertyInterface("Size",It)),Mt.p.setGroupProperty(PropertyInterface("Position",It)),Object.defineProperties(Dt,{size:{get:ExpressionPropertyInterface(Mt.s)},position:{get:ExpressionPropertyInterface(Mt.p)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}function St(Vt,zt,Jt){function Dt(Ht){return Vt.p.ix===Ht?Dt.position:Vt.r.ix===Ht?Dt.rotation:Vt.pt.ix===Ht?Dt.points:Vt.or.ix===Ht||Ht==="ADBE Vector Star Outer Radius"?Dt.outerRadius:Vt.os.ix===Ht?Dt.outerRoundness:Vt.ir&&(Vt.ir.ix===Ht||Ht==="ADBE Vector Star Inner Radius")?Dt.innerRadius:Vt.is&&Vt.is.ix===Ht?Dt.innerRoundness:null}var It=propertyGroupFactory(Dt,Jt),Mt=zt.sh.ty==="tm"?zt.sh.prop:zt.sh;return Dt.propertyIndex=Vt.ix,Mt.or.setGroupProperty(PropertyInterface("Outer Radius",It)),Mt.os.setGroupProperty(PropertyInterface("Outer Roundness",It)),Mt.pt.setGroupProperty(PropertyInterface("Points",It)),Mt.p.setGroupProperty(PropertyInterface("Position",It)),Mt.r.setGroupProperty(PropertyInterface("Rotation",It)),Vt.ir&&(Mt.ir.setGroupProperty(PropertyInterface("Inner Radius",It)),Mt.is.setGroupProperty(PropertyInterface("Inner Roundness",It))),Object.defineProperties(Dt,{position:{get:ExpressionPropertyInterface(Mt.p)},rotation:{get:ExpressionPropertyInterface(Mt.r)},points:{get:ExpressionPropertyInterface(Mt.pt)},outerRadius:{get:ExpressionPropertyInterface(Mt.or)},outerRoundness:{get:ExpressionPropertyInterface(Mt.os)},innerRadius:{get:ExpressionPropertyInterface(Mt.ir)},innerRoundness:{get:ExpressionPropertyInterface(Mt.is)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}function kt(Vt,zt,Jt){function Dt(Ht){return Vt.p.ix===Ht?Dt.position:Vt.r.ix===Ht?Dt.roundness:Vt.s.ix===Ht||Ht==="Size"||Ht==="ADBE Vector Rect Size"?Dt.size:null}var It=propertyGroupFactory(Dt,Jt),Mt=zt.sh.ty==="tm"?zt.sh.prop:zt.sh;return Dt.propertyIndex=Vt.ix,Mt.p.setGroupProperty(PropertyInterface("Position",It)),Mt.s.setGroupProperty(PropertyInterface("Size",It)),Mt.r.setGroupProperty(PropertyInterface("Rotation",It)),Object.defineProperties(Dt,{position:{get:ExpressionPropertyInterface(Mt.p)},roundness:{get:ExpressionPropertyInterface(Mt.r)},size:{get:ExpressionPropertyInterface(Mt.s)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}function At(Vt,zt,Jt){function Dt(Ht){return Vt.r.ix===Ht||Ht==="Round Corners 1"?Dt.radius:null}var It=propertyGroupFactory(Dt,Jt),Mt=zt;return Dt.propertyIndex=Vt.ix,Mt.rd.setGroupProperty(PropertyInterface("Radius",It)),Object.defineProperties(Dt,{radius:{get:ExpressionPropertyInterface(Mt.rd)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}function Nt(Vt,zt,Jt){function Dt(Ht){return Vt.c.ix===Ht||Ht==="Copies"?Dt.copies:Vt.o.ix===Ht||Ht==="Offset"?Dt.offset:null}var It=propertyGroupFactory(Dt,Jt),Mt=zt;return Dt.propertyIndex=Vt.ix,Mt.c.setGroupProperty(PropertyInterface("Copies",It)),Mt.o.setGroupProperty(PropertyInterface("Offset",It)),Object.defineProperties(Dt,{copies:{get:ExpressionPropertyInterface(Mt.c)},offset:{get:ExpressionPropertyInterface(Mt.o)},_name:{value:Vt.nm}}),Dt.mn=Vt.mn,Dt}return function(Vt,zt,Jt){var Dt;function It(Ht){if(typeof Ht=="number")return Ht=Ht===void 0?1:Ht,Ht===0?Jt:Dt[Ht-1];for(var tr=0,er=Dt.length;tr<er;){if(Dt[tr]._name===Ht)return Dt[tr];tr+=1}return null}function Mt(){return Jt}return It.propertyGroup=propertyGroupFactory(It,Mt),Dt=e(Vt,zt,It.propertyGroup),It.numProperties=Dt.length,It._name="Contents",It}}(),TextExpressionInterface=function(){return function(e){var i;function d(j){switch(j){case"ADBE Text Document":return d.sourceText;default:return null}}return Object.defineProperty(d,"sourceText",{get:function(){e.textProperty.getValue();var _e=e.textProperty.currentData.t;return(!i||_e!==i.value)&&(i=new String(_e),i.value=_e||new String(_e),Object.defineProperty(i,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),i}}),d}}();function _typeof(e){"@babel/helpers - typeof";return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},_typeof(e)}var FootageInterface=function(){var e=function(j){var _e="",nt=j.getFootageData();function ct(){return _e="",nt=j.getFootageData(),c}function c(pt){if(nt[pt])return _e=pt,nt=nt[pt],_typeof(nt)==="object"?c:nt;var gt=pt.indexOf(_e);if(gt!==-1){var St=parseInt(pt.substr(gt+_e.length),10);return nt=nt[St],_typeof(nt)==="object"?c:nt}return""}return ct},i=function(j){function _e(nt){return nt==="Outline"?_e.outlineInterface():null}return _e._name="Outline",_e.outlineInterface=e(j),_e};return function(d){function j(_e){return _e==="Data"?j.dataInterface:null}return j._name="Data",j.dataInterface=i(d),j}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(ct,c,pt){c.x&&(pt.k=!0,pt.x=!0,pt.initiateExpression=ExpressionManager.initiateExpression,pt.effectsSequence.push(pt.initiateExpression(ct,c,pt).bind(pt)))}function i(ct){return ct*=this.elem.globalData.frameRate,ct-=this.offsetTime,ct!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<ct?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(ct,this._cachingAtTime),this._cachingAtTime.lastFrame=ct),this._cachingAtTime.value}function d(ct){var c=-.01,pt=this.getValueAtTime(ct),gt=this.getValueAtTime(ct+c),St=0;if(pt.length){var kt;for(kt=0;kt<pt.length;kt+=1)St+=Math.pow(gt[kt]-pt[kt],2);St=Math.sqrt(St)*100}else St=0;return St}function j(ct){if(this.vel!==void 0)return this.vel;var c=-.001,pt=this.getValueAtTime(ct),gt=this.getValueAtTime(ct+c),St;if(pt.length){St=createTypedArray("float32",pt.length);var kt;for(kt=0;kt<pt.length;kt+=1)St[kt]=(gt[kt]-pt[kt])/c}else St=(gt-pt)/c;return St}function _e(){return this.pv}function nt(ct){this.propertyGroup=ct}return{searchExpressions:e,getSpeedAtTime:d,getVelocityAtTime:j,getValueAtTime:i,getStaticValueAtTime:_e,setGroupProperty:nt}}();function addPropertyDecorator(){function e(At,Nt,Vt){if(!this.k||!this.keyframes)return this.pv;At=At?At.toLowerCase():"";var zt=this.comp.renderedFrame,Jt=this.keyframes,Dt=Jt[Jt.length-1].t;if(zt<=Dt)return this.pv;var It,Mt;Vt?(Nt?It=Math.abs(Dt-this.elem.comp.globalData.frameRate*Nt):It=Math.max(0,Dt-this.elem.data.ip),Mt=Dt-It):((!Nt||Nt>Jt.length-1)&&(Nt=Jt.length-1),Mt=Jt[Jt.length-1-Nt].t,It=Dt-Mt);var Ht,tr,er;if(At==="pingpong"){var dr=Math.floor((zt-Mt)/It);if(dr%2!==0)return this.getValueAtTime((It-(zt-Mt)%It+Mt)/this.comp.globalData.frameRate,0)}else if(At==="offset"){var mr=this.getValueAtTime(Mt/this.comp.globalData.frameRate,0),Ur=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),Dr=this.getValueAtTime(((zt-Mt)%It+Mt)/this.comp.globalData.frameRate,0),Yr=Math.floor((zt-Mt)/It);if(this.pv.length){for(er=new Array(mr.length),tr=er.length,Ht=0;Ht<tr;Ht+=1)er[Ht]=(Ur[Ht]-mr[Ht])*Yr+Dr[Ht];return er}return(Ur-mr)*Yr+Dr}else if(At==="continue"){var es=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),ms=this.getValueAtTime((Dt-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(er=new Array(es.length),tr=er.length,Ht=0;Ht<tr;Ht+=1)er[Ht]=es[Ht]+(es[Ht]-ms[Ht])*((zt-Dt)/this.comp.globalData.frameRate)/5e-4;return er}return es+(es-ms)*((zt-Dt)/.001)}return this.getValueAtTime(((zt-Mt)%It+Mt)/this.comp.globalData.frameRate,0)}function i(At,Nt,Vt){if(!this.k)return this.pv;At=At?At.toLowerCase():"";var zt=this.comp.renderedFrame,Jt=this.keyframes,Dt=Jt[0].t;if(zt>=Dt)return this.pv;var It,Mt;Vt?(Nt?It=Math.abs(this.elem.comp.globalData.frameRate*Nt):It=Math.max(0,this.elem.data.op-Dt),Mt=Dt+It):((!Nt||Nt>Jt.length-1)&&(Nt=Jt.length-1),Mt=Jt[Nt].t,It=Mt-Dt);var Ht,tr,er;if(At==="pingpong"){var dr=Math.floor((Dt-zt)/It);if(dr%2===0)return this.getValueAtTime(((Dt-zt)%It+Dt)/this.comp.globalData.frameRate,0)}else if(At==="offset"){var mr=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),Ur=this.getValueAtTime(Mt/this.comp.globalData.frameRate,0),Dr=this.getValueAtTime((It-(Dt-zt)%It+Dt)/this.comp.globalData.frameRate,0),Yr=Math.floor((Dt-zt)/It)+1;if(this.pv.length){for(er=new Array(mr.length),tr=er.length,Ht=0;Ht<tr;Ht+=1)er[Ht]=Dr[Ht]-(Ur[Ht]-mr[Ht])*Yr;return er}return Dr-(Ur-mr)*Yr}else if(At==="continue"){var es=this.getValueAtTime(Dt/this.comp.globalData.frameRate,0),ms=this.getValueAtTime((Dt+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(er=new Array(es.length),tr=er.length,Ht=0;Ht<tr;Ht+=1)er[Ht]=es[Ht]+(es[Ht]-ms[Ht])*(Dt-zt)/.001;return er}return es+(es-ms)*(Dt-zt)/.001}return this.getValueAtTime((It-((Dt-zt)%It+Dt))/this.comp.globalData.frameRate,0)}function d(At,Nt){if(!this.k)return this.pv;if(At=(At||.4)*.5,Nt=Math.floor(Nt||5),Nt<=1)return this.pv;var Vt=this.comp.renderedFrame/this.comp.globalData.frameRate,zt=Vt-At,Jt=Vt+At,Dt=Nt>1?(Jt-zt)/(Nt-1):1,It=0,Mt=0,Ht;this.pv.length?Ht=createTypedArray("float32",this.pv.length):Ht=0;for(var tr;It<Nt;){if(tr=this.getValueAtTime(zt+It*Dt),this.pv.length)for(Mt=0;Mt<this.pv.length;Mt+=1)Ht[Mt]+=tr[Mt];else Ht+=tr;It+=1}if(this.pv.length)for(Mt=0;Mt<this.pv.length;Mt+=1)Ht[Mt]/=Nt;else Ht/=Nt;return Ht}function j(At){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var Nt=this._transformCachingAtTime.v;if(Nt.cloneFromProps(this.pre.props),this.appliedTransformations<1){var Vt=this.a.getValueAtTime(At);Nt.translate(-Vt[0]*this.a.mult,-Vt[1]*this.a.mult,Vt[2]*this.a.mult)}if(this.appliedTransformations<2){var zt=this.s.getValueAtTime(At);Nt.scale(zt[0]*this.s.mult,zt[1]*this.s.mult,zt[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var Jt=this.sk.getValueAtTime(At),Dt=this.sa.getValueAtTime(At);Nt.skewFromAxis(-Jt*this.sk.mult,Dt*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var It=this.r.getValueAtTime(At);Nt.rotate(-It*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var Mt=this.rz.getValueAtTime(At),Ht=this.ry.getValueAtTime(At),tr=this.rx.getValueAtTime(At),er=this.or.getValueAtTime(At);Nt.rotateZ(-Mt*this.rz.mult).rotateY(Ht*this.ry.mult).rotateX(tr*this.rx.mult).rotateZ(-er[2]*this.or.mult).rotateY(er[1]*this.or.mult).rotateX(er[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var dr=this.px.getValueAtTime(At),mr=this.py.getValueAtTime(At);if(this.data.p.z){var Ur=this.pz.getValueAtTime(At);Nt.translate(dr*this.px.mult,mr*this.py.mult,-Ur*this.pz.mult)}else Nt.translate(dr*this.px.mult,mr*this.py.mult,0)}else{var Dr=this.p.getValueAtTime(At);Nt.translate(Dr[0]*this.p.mult,Dr[1]*this.p.mult,-Dr[2]*this.p.mult)}return Nt}function _e(){return this.v.clone(new Matrix)}var nt=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(At,Nt,Vt){var zt=nt(At,Nt,Vt);return zt.dynamicProperties.length?zt.getValueAtTime=j.bind(zt):zt.getValueAtTime=_e.bind(zt),zt.setGroupProperty=expressionHelpers.setGroupProperty,zt};var ct=PropertyFactory.getProp;PropertyFactory.getProp=function(At,Nt,Vt,zt,Jt){var Dt=ct(At,Nt,Vt,zt,Jt);Dt.kf?Dt.getValueAtTime=expressionHelpers.getValueAtTime.bind(Dt):Dt.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(Dt),Dt.setGroupProperty=expressionHelpers.setGroupProperty,Dt.loopOut=e,Dt.loopIn=i,Dt.smooth=d,Dt.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(Dt),Dt.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(Dt),Dt.numKeys=Nt.a===1?Nt.k.length:0,Dt.propertyIndex=Nt.ix;var It=0;return Vt!==0&&(It=createTypedArray("float32",Nt.a===1?Nt.k[0].s.length:Nt.k.length)),Dt._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:It},expressionHelpers.searchExpressions(At,Nt,Dt),Dt.k&&Jt.addDynamicProperty(Dt),Dt};function c(At){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),At*=this.elem.globalData.frameRate,At-=this.offsetTime,At!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<At?this._caching.lastIndex:0,this._cachingAtTime.lastTime=At,this.interpolateShape(At,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var pt=ShapePropertyFactory.getConstructorFunction(),gt=ShapePropertyFactory.getKeyframedConstructorFunction();function St(){}St.prototype={vertices:function(Nt,Vt){this.k&&this.getValue();var zt=this.v;Vt!==void 0&&(zt=this.getValueAtTime(Vt,0));var Jt,Dt=zt._length,It=zt[Nt],Mt=zt.v,Ht=createSizedArray(Dt);for(Jt=0;Jt<Dt;Jt+=1)Nt==="i"||Nt==="o"?Ht[Jt]=[It[Jt][0]-Mt[Jt][0],It[Jt][1]-Mt[Jt][1]]:Ht[Jt]=[It[Jt][0],It[Jt][1]];return Ht},points:function(Nt){return this.vertices("v",Nt)},inTangents:function(Nt){return this.vertices("i",Nt)},outTangents:function(Nt){return this.vertices("o",Nt)},isClosed:function(){return this.v.c},pointOnPath:function(Nt,Vt){var zt=this.v;Vt!==void 0&&(zt=this.getValueAtTime(Vt,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(zt));for(var Jt=this._segmentsLength,Dt=Jt.lengths,It=Jt.totalLength*Nt,Mt=0,Ht=Dt.length,tr=0,er;Mt<Ht;){if(tr+Dt[Mt].addedLength>It){var dr=Mt,mr=zt.c&&Mt===Ht-1?0:Mt+1,Ur=(It-tr)/Dt[Mt].addedLength;er=bez.getPointInSegment(zt.v[dr],zt.v[mr],zt.o[dr],zt.i[mr],Ur,Dt[Mt]);break}else tr+=Dt[Mt].addedLength;Mt+=1}return er||(er=zt.c?[zt.v[0][0],zt.v[0][1]]:[zt.v[zt._length-1][0],zt.v[zt._length-1][1]]),er},vectorOnPath:function(Nt,Vt,zt){Nt==1?Nt=this.v.c:Nt==0&&(Nt=.999);var Jt=this.pointOnPath(Nt,Vt),Dt=this.pointOnPath(Nt+.001,Vt),It=Dt[0]-Jt[0],Mt=Dt[1]-Jt[1],Ht=Math.sqrt(Math.pow(It,2)+Math.pow(Mt,2));if(Ht===0)return[0,0];var tr=zt==="tangent"?[It/Ht,Mt/Ht]:[-Mt/Ht,It/Ht];return tr},tangentOnPath:function(Nt,Vt){return this.vectorOnPath(Nt,Vt,"tangent")},normalOnPath:function(Nt,Vt){return this.vectorOnPath(Nt,Vt,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([St],pt),extendPrototype([St],gt),gt.prototype.getValueAtTime=c,gt.prototype.initiateExpression=ExpressionManager.initiateExpression;var kt=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(At,Nt,Vt,zt,Jt){var Dt=kt(At,Nt,Vt,zt,Jt);return Dt.propertyIndex=Nt.ix,Dt.lock=!1,Vt===3?expressionHelpers.searchExpressions(At,Nt.pt,Dt):Vt===4&&expressionHelpers.searchExpressions(At,Nt.ks,Dt),Dt.k&&At.addDynamicProperty(Dt),Dt}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(i,d){var j=this.calculateExpression(d);if(i.t!==j){var _e={};return this.copyData(_e,i),_e.t=j.toString(),_e.__complete=!1,_e}return i},TextProperty.prototype.searchProperty=function(){var i=this.searchKeyframes(),d=this.searchExpressions();return this.kf=i||d,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(i,d){var j=createNS("feMerge");j.setAttribute("result",i);var _e,nt;for(nt=0;nt<d.length;nt+=1)_e=createNS("feMergeNode"),_e.setAttribute("in",d[nt]),j.appendChild(_e),j.appendChild(_e);return j}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,i,d,j,_e){this.filterManager=i;var nt=createNS("feColorMatrix");nt.setAttribute("type","matrix"),nt.setAttribute("color-interpolation-filters","linearRGB"),nt.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=nt,nt.setAttribute("result",j+"_tint_1"),e.appendChild(nt),nt=createNS("feColorMatrix"),nt.setAttribute("type","matrix"),nt.setAttribute("color-interpolation-filters","sRGB"),nt.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),nt.setAttribute("result",j+"_tint_2"),e.appendChild(nt),this.matrixFilter=nt;var ct=this.createMergeNode(j,[_e,j+"_tint_1",j+"_tint_2"]);e.appendChild(ct)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,d=this.filterManager.effectElements[1].p.v,j=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+j+" 0"),this.matrixFilter.setAttribute("values",d[0]-i[0]+" 0 0 0 "+i[0]+" "+(d[1]-i[1])+" 0 0 0 "+i[1]+" "+(d[2]-i[2])+" 0 0 0 "+i[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,i,d,j){this.filterManager=i;var _e=createNS("feColorMatrix");_e.setAttribute("type","matrix"),_e.setAttribute("color-interpolation-filters","sRGB"),_e.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),_e.setAttribute("result",j),e.appendChild(_e),this.matrixFilter=_e}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[2].p.v,d=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+i[0]+" 0 0 0 0 "+i[1]+" 0 0 0 0 "+i[2]+" 0 0 0 "+d+" 0")}};function SVGStrokeEffect(e,i,d){this.initialized=!1,this.filterManager=i,this.elem=d,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,i,d,j,_e;for(this.filterManager.effectElements[1].p.v===1?(_e=this.elem.maskManager.masksProperties.length,j=0):(j=this.filterManager.effectElements[0].p.v-1,_e=j+1),d=createNS("g"),d.setAttribute("fill","none"),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-dashoffset",1),j;j<_e;j+=1)i=createNS("path"),d.appendChild(i),this.paths.push({p:i,m:j});if(this.filterManager.effectElements[10].p.v===3){var nt=createNS("mask"),ct=createElementID();nt.setAttribute("id",ct),nt.setAttribute("mask-type","alpha"),nt.appendChild(d),this.elem.globalData.defs.appendChild(nt);var c=createNS("g");for(c.setAttribute("mask","url("+getLocationHref()+"#"+ct+")");e[0];)c.appendChild(e[0]);this.elem.layerElement.appendChild(c),this.masker=nt,d.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(d),this.elem.layerElement.removeAttribute("mask"),d.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=d},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var i,d=this.paths.length,j,_e;for(i=0;i<d;i+=1)if(this.paths[i].m!==-1&&(j=this.elem.maskManager.viewData[this.paths[i].m],_e=this.paths[i].p,(e||this.filterManager._mdf||j.prop._mdf)&&_e.setAttribute("d",j.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||j.prop._mdf)){var nt;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var ct=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,c=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,pt=_e.getTotalLength();nt="0 0 0 "+pt*ct+" ";var gt=pt*(c-ct),St=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,kt=Math.floor(gt/St),At;for(At=0;At<kt;At+=1)nt+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";nt+="0 "+pt*10+" 0 0"}else nt="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;_e.setAttribute("stroke-dasharray",nt)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var Nt=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(Nt[0]*255)+","+bmFloor(Nt[1]*255)+","+bmFloor(Nt[2]*255)+")")}};function SVGTritoneFilter(e,i,d,j){this.filterManager=i;var _e=createNS("feColorMatrix");_e.setAttribute("type","matrix"),_e.setAttribute("color-interpolation-filters","linearRGB"),_e.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(_e);var nt=createNS("feComponentTransfer");nt.setAttribute("color-interpolation-filters","sRGB"),nt.setAttribute("result",j),this.matrixFilter=nt;var ct=createNS("feFuncR");ct.setAttribute("type","table"),nt.appendChild(ct),this.feFuncR=ct;var c=createNS("feFuncG");c.setAttribute("type","table"),nt.appendChild(c),this.feFuncG=c;var pt=createNS("feFuncB");pt.setAttribute("type","table"),nt.appendChild(pt),this.feFuncB=pt,e.appendChild(nt)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=this.filterManager.effectElements[0].p.v,d=this.filterManager.effectElements[1].p.v,j=this.filterManager.effectElements[2].p.v,_e=j[0]+" "+d[0]+" "+i[0],nt=j[1]+" "+d[1]+" "+i[1],ct=j[2]+" "+d[2]+" "+i[2];this.feFuncR.setAttribute("tableValues",_e),this.feFuncG.setAttribute("tableValues",nt),this.feFuncB.setAttribute("tableValues",ct)}};function SVGProLevelsFilter(e,i,d,j){this.filterManager=i;var _e=this.filterManager.effectElements,nt=createNS("feComponentTransfer");(_e[10].p.k||_e[10].p.v!==0||_e[11].p.k||_e[11].p.v!==1||_e[12].p.k||_e[12].p.v!==1||_e[13].p.k||_e[13].p.v!==0||_e[14].p.k||_e[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",nt)),(_e[17].p.k||_e[17].p.v!==0||_e[18].p.k||_e[18].p.v!==1||_e[19].p.k||_e[19].p.v!==1||_e[20].p.k||_e[20].p.v!==0||_e[21].p.k||_e[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",nt)),(_e[24].p.k||_e[24].p.v!==0||_e[25].p.k||_e[25].p.v!==1||_e[26].p.k||_e[26].p.v!==1||_e[27].p.k||_e[27].p.v!==0||_e[28].p.k||_e[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",nt)),(_e[31].p.k||_e[31].p.v!==0||_e[32].p.k||_e[32].p.v!==1||_e[33].p.k||_e[33].p.v!==1||_e[34].p.k||_e[34].p.v!==0||_e[35].p.k||_e[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",nt)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(nt.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(nt)),(_e[3].p.k||_e[3].p.v!==0||_e[4].p.k||_e[4].p.v!==1||_e[5].p.k||_e[5].p.v!==1||_e[6].p.k||_e[6].p.v!==0||_e[7].p.k||_e[7].p.v!==1)&&(nt=createNS("feComponentTransfer"),nt.setAttribute("color-interpolation-filters","sRGB"),nt.setAttribute("result",j),e.appendChild(nt),this.feFuncRComposed=this.createFeFunc("feFuncR",nt),this.feFuncGComposed=this.createFeFunc("feFuncG",nt),this.feFuncBComposed=this.createFeFunc("feFuncB",nt))}SVGProLevelsFilter.prototype.createFeFunc=function(e,i){var d=createNS(e);return d.setAttribute("type","table"),i.appendChild(d),d},SVGProLevelsFilter.prototype.getTableValue=function(e,i,d,j,_e){for(var nt=0,ct=256,c,pt=Math.min(e,i),gt=Math.max(e,i),St=Array.call(null,{length:ct}),kt,At=0,Nt=_e-j,Vt=i-e;nt<=256;)c=nt/256,c<=pt?kt=Vt<0?_e:j:c>=gt?kt=Vt<0?j:_e:kt=j+Nt*Math.pow((c-e)/Vt,1/d),St[At]=kt,At+=1,nt+=256/(ct-1);return St.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i,d=this.filterManager.effectElements;this.feFuncRComposed&&(e||d[3].p._mdf||d[4].p._mdf||d[5].p._mdf||d[6].p._mdf||d[7].p._mdf)&&(i=this.getTableValue(d[3].p.v,d[4].p.v,d[5].p.v,d[6].p.v,d[7].p.v),this.feFuncRComposed.setAttribute("tableValues",i),this.feFuncGComposed.setAttribute("tableValues",i),this.feFuncBComposed.setAttribute("tableValues",i)),this.feFuncR&&(e||d[10].p._mdf||d[11].p._mdf||d[12].p._mdf||d[13].p._mdf||d[14].p._mdf)&&(i=this.getTableValue(d[10].p.v,d[11].p.v,d[12].p.v,d[13].p.v,d[14].p.v),this.feFuncR.setAttribute("tableValues",i)),this.feFuncG&&(e||d[17].p._mdf||d[18].p._mdf||d[19].p._mdf||d[20].p._mdf||d[21].p._mdf)&&(i=this.getTableValue(d[17].p.v,d[18].p.v,d[19].p.v,d[20].p.v,d[21].p.v),this.feFuncG.setAttribute("tableValues",i)),this.feFuncB&&(e||d[24].p._mdf||d[25].p._mdf||d[26].p._mdf||d[27].p._mdf||d[28].p._mdf)&&(i=this.getTableValue(d[24].p.v,d[25].p.v,d[26].p.v,d[27].p.v,d[28].p.v),this.feFuncB.setAttribute("tableValues",i)),this.feFuncA&&(e||d[31].p._mdf||d[32].p._mdf||d[33].p._mdf||d[34].p._mdf||d[35].p._mdf)&&(i=this.getTableValue(d[31].p.v,d[32].p.v,d[33].p.v,d[34].p.v,d[35].p.v),this.feFuncA.setAttribute("tableValues",i))}};function SVGDropShadowEffect(e,i,d,j,_e){var nt=i.container.globalData.renderConfig.filterSize,ct=i.data.fs||nt;e.setAttribute("x",ct.x||nt.x),e.setAttribute("y",ct.y||nt.y),e.setAttribute("width",ct.width||nt.width),e.setAttribute("height",ct.height||nt.height),this.filterManager=i;var c=createNS("feGaussianBlur");c.setAttribute("in","SourceAlpha"),c.setAttribute("result",j+"_drop_shadow_1"),c.setAttribute("stdDeviation","0"),this.feGaussianBlur=c,e.appendChild(c);var pt=createNS("feOffset");pt.setAttribute("dx","25"),pt.setAttribute("dy","0"),pt.setAttribute("in",j+"_drop_shadow_1"),pt.setAttribute("result",j+"_drop_shadow_2"),this.feOffset=pt,e.appendChild(pt);var gt=createNS("feFlood");gt.setAttribute("flood-color","#00ff00"),gt.setAttribute("flood-opacity","1"),gt.setAttribute("result",j+"_drop_shadow_3"),this.feFlood=gt,e.appendChild(gt);var St=createNS("feComposite");St.setAttribute("in",j+"_drop_shadow_3"),St.setAttribute("in2",j+"_drop_shadow_2"),St.setAttribute("operator","in"),St.setAttribute("result",j+"_drop_shadow_4"),e.appendChild(St);var kt=this.createMergeNode(j,[j+"_drop_shadow_4",_e]);e.appendChild(kt)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var i=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var d=this.filterManager.effectElements[3].p.v,j=(this.filterManager.effectElements[2].p.v-90)*degToRads,_e=d*Math.cos(j),nt=d*Math.sin(j);this.feOffset.setAttribute("dx",_e),this.feOffset.setAttribute("dy",nt)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,i,d){this.initialized=!1,this.filterManager=i,this.filterElem=e,this.elem=d,d.matteElement=createNS("g"),d.matteElement.appendChild(d.layerElement),d.matteElement.appendChild(d.transformedElement),d.baseElement=d.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var i=0,d=_svgMatteSymbols.length;i<d;){if(_svgMatteSymbols[i]===e)return _svgMatteSymbols[i];i+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,i){var d=e.layerElement.parentNode;if(d){for(var j=d.children,_e=0,nt=j.length;_e<nt&&j[_e]!==e.layerElement;)_e+=1;var ct;_e<=nt-2&&(ct=j[_e+1]);var c=createNS("use");c.setAttribute("href","#"+i),ct?d.insertBefore(c,ct):d.appendChild(c)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,i){if(!this.findSymbol(i)){var d=createElementID(),j=createNS("mask");j.setAttribute("id",i.layerId),j.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(i);var _e=e.globalData.defs;_e.appendChild(j);var nt=createNS("symbol");nt.setAttribute("id",d),this.replaceInParent(i,d),nt.appendChild(i.layerElement),_e.appendChild(nt);var ct=createNS("use");ct.setAttribute("href","#"+d),j.appendChild(ct),i.data.hd=!1,i.show()}e.setMatte(i.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,i=this.elem.comp.elements,d=0,j=i.length;d<j;)i[d]&&i[d].data.ind===e&&this.setElementAsMask(this.elem,i[d]),d+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,i,d,j){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=i;var _e=createNS("feGaussianBlur");_e.setAttribute("result",j),e.appendChild(_e),this.feGaussianBlur=_e}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var i=.3,d=this.filterManager.effectElements[0].p.v*i,j=this.filterManager.effectElements[1].p.v,_e=j==3?0:d,nt=j==2?0:d;this.feGaussianBlur.setAttribute("stdDeviation",_e+" "+nt);var ct=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",ct)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var i=this.effectsManager.effectElements,d=i[0].p.v,j=i[1].p.v,_e=i[2].p.v===1,nt=i[3].p.v,ct=_e?nt:i[4].p.v,c=i[5].p.v,pt=i[6].p.v,gt=i[7].p.v;this.matrix.reset(),this.matrix.translate(-d[0],-d[1],d[2]),this.matrix.scale(ct*.01,nt*.01,1),this.matrix.rotate(-gt*degToRads),this.matrix.skewFromAxis(-c*degToRads,(pt+90)*degToRads),this.matrix.translate(j[0],j[1],0),this._mdf=!0,this.opacity!==i[8].p.v&&(this.opacity=i[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,i){this.init(i)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _arrayLikeToArray(e,i){(i==null||i>e.length)&&(i=e.length);for(var d=0,j=Array(i);d<i;d++)j[d]=e[d];return j}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _defineProperty(e,i,d){return(i=_toPropertyKey(i))in e?Object.defineProperty(e,i,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[i]=d,e}function _iterableToArrayLimit(e,i){var d=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(d!=null){var j,_e,nt,ct,c=[],pt=!0,gt=!1;try{if(nt=(d=d.call(e)).next,i!==0)for(;!(pt=(j=nt.call(d)).done)&&(c.push(j.value),c.length!==i);pt=!0);}catch(St){gt=!0,_e=St}finally{try{if(!pt&&d.return!=null&&(ct=d.return(),Object(ct)!==ct))return}finally{if(gt)throw _e}}return c}}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ownKeys(e,i){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var j=Object.getOwnPropertySymbols(e);i&&(j=j.filter(function(_e){return Object.getOwnPropertyDescriptor(e,_e).enumerable})),d.push.apply(d,j)}return d}function _objectSpread2(e){for(var i=1;i<arguments.length;i++){var d=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(d),!0).forEach(function(j){_defineProperty(e,j,d[j])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(d)):ownKeys(Object(d)).forEach(function(j){Object.defineProperty(e,j,Object.getOwnPropertyDescriptor(d,j))})}return e}function _objectWithoutProperties(e,i){if(e==null)return{};var d,j,_e=_objectWithoutPropertiesLoose(e,i);if(Object.getOwnPropertySymbols){var nt=Object.getOwnPropertySymbols(e);for(j=0;j<nt.length;j++)d=nt[j],i.includes(d)||{}.propertyIsEnumerable.call(e,d)&&(_e[d]=e[d])}return _e}function _objectWithoutPropertiesLoose(e,i){if(e==null)return{};var d={};for(var j in e)if({}.hasOwnProperty.call(e,j)){if(i.includes(j))continue;d[j]=e[j]}return d}function _slicedToArray(e,i){return _arrayWithHoles(e)||_iterableToArrayLimit(e,i)||_unsupportedIterableToArray(e,i)||_nonIterableRest()}function _toPrimitive(e,i){if(typeof e!="object"||!e)return e;var d=e[Symbol.toPrimitive];if(d!==void 0){var j=d.call(e,i);if(typeof j!="object")return j;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(e)}function _toPropertyKey(e){var i=_toPrimitive(e,"string");return typeof i=="symbol"?i:i+""}function _unsupportedIterableToArray(e,i){if(e){if(typeof e=="string")return _arrayLikeToArray(e,i);var d={}.toString.call(e).slice(8,-1);return d==="Object"&&e.constructor&&(d=e.constructor.name),d==="Map"||d==="Set"?Array.from(e):d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d)?_arrayLikeToArray(e,i):void 0}}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(i,d){var j=i.animationData,_e=i.loop,nt=i.autoplay,ct=i.initialSegment,c=i.onComplete,pt=i.onLoopComplete,gt=i.onEnterFrame,St=i.onSegmentStart,kt=i.onConfigReady,At=i.onDataReady,Nt=i.onDataFailed,Vt=i.onLoadedImages,zt=i.onDOMLoaded,Jt=i.onDestroy;i.lottieRef,i.renderer,i.name,i.assetsPath,i.rendererSettings;var Dt=_objectWithoutProperties(i,_excluded$1),It=reactExports.useState(!1),Mt=_slicedToArray(It,2),Ht=Mt[0],tr=Mt[1],er=reactExports.useRef(),dr=reactExports.useRef(null),mr=function(){var Xr;(Xr=er.current)===null||Xr===void 0||Xr.play()},Ur=function(){var Xr;(Xr=er.current)===null||Xr===void 0||Xr.stop()},Dr=function(){var Xr;(Xr=er.current)===null||Xr===void 0||Xr.pause()},Yr=function(Xr){var us;(us=er.current)===null||us===void 0||us.setSpeed(Xr)},es=function(Xr,us){var Wr;(Wr=er.current)===null||Wr===void 0||Wr.goToAndPlay(Xr,us)},ms=function(Xr,us){var Wr;(Wr=er.current)===null||Wr===void 0||Wr.goToAndStop(Xr,us)},Ms=function(Xr){var us;(us=er.current)===null||us===void 0||us.setDirection(Xr)},Kr=function(Xr,us){var Wr;(Wr=er.current)===null||Wr===void 0||Wr.playSegments(Xr,us)},xr=function(Xr){var us;(us=er.current)===null||us===void 0||us.setSubframe(Xr)},jr=function(Xr){var us;return(us=er.current)===null||us===void 0?void 0:us.getDuration(Xr)},rr=function(){var Xr;(Xr=er.current)===null||Xr===void 0||Xr.destroy(),er.current=void 0},ar=function(){var Xr=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},us;if(dr.current){(us=er.current)===null||us===void 0||us.destroy();var Wr=_objectSpread2(_objectSpread2(_objectSpread2({},i),Xr),{},{container:dr.current});return er.current=lottie.loadAnimation(Wr),tr(!!er.current),function(){var Vs;(Vs=er.current)===null||Vs===void 0||Vs.destroy(),er.current=void 0}}};reactExports.useEffect(function(){var Ar=ar();return function(){return Ar==null?void 0:Ar()}},[j,_e]),reactExports.useEffect(function(){er.current&&(er.current.autoplay=!!nt)},[nt]),reactExports.useEffect(function(){if(er.current){if(!ct){er.current.resetSegments(!0);return}!Array.isArray(ct)||!ct.length||((er.current.currentRawFrame<ct[0]||er.current.currentRawFrame>ct[1])&&(er.current.currentRawFrame=ct[0]),er.current.setSegment(ct[0],ct[1]))}},[ct]),reactExports.useEffect(function(){var Ar=[{name:"complete",handler:c},{name:"loopComplete",handler:pt},{name:"enterFrame",handler:gt},{name:"segmentStart",handler:St},{name:"config_ready",handler:kt},{name:"data_ready",handler:At},{name:"data_failed",handler:Nt},{name:"loaded_images",handler:Vt},{name:"DOMLoaded",handler:zt},{name:"destroy",handler:Jt}],Xr=Ar.filter(function(Wr){return Wr.handler!=null});if(Xr.length){var us=Xr.map(function(Wr){var Vs;return(Vs=er.current)===null||Vs===void 0||Vs.addEventListener(Wr.name,Wr.handler),function(){var yn;(yn=er.current)===null||yn===void 0||yn.removeEventListener(Wr.name,Wr.handler)}});return function(){us.forEach(function(Wr){return Wr()})}}},[c,pt,gt,St,kt,At,Nt,Vt,zt,Jt]);var $r=React.createElement("div",_objectSpread2({style:d,ref:dr},Dt));return{View:$r,play:mr,stop:Ur,pause:Dr,setSpeed:Yr,goToAndStop:ms,goToAndPlay:es,setDirection:Ms,playSegments:Kr,setSubframe:xr,getDuration:jr,destroy:rr,animationContainerRef:dr,animationLoaded:Ht,animationItem:er.current}};function getContainerVisibility(e){var i=e.getBoundingClientRect(),d=i.top,j=i.height,_e=window.innerHeight-d,nt=window.innerHeight+j;return _e/nt}function getContainerCursorPosition(e,i,d){var j=e.getBoundingClientRect(),_e=j.top,nt=j.left,ct=j.width,c=j.height,pt=(i-nt)/ct,gt=(d-_e)/c;return{x:pt,y:gt}}var useInitInteractivity=function e(i){var d=i.wrapperRef,j=i.animationItem,_e=i.mode,nt=i.actions;reactExports.useEffect(function(){var ct=d.current;if(!(!ct||!j||!nt.length)){j.stop();var c=function(){var St=null,kt=function(){var Nt=getContainerVisibility(ct),Vt=nt.find(function(Jt){var Dt=Jt.visibility;return Dt&&Nt>=Dt[0]&&Nt<=Dt[1]});if(Vt){if(Vt.type==="seek"&&Vt.visibility&&Vt.frames.length===2){var zt=Vt.frames[0]+Math.ceil((Nt-Vt.visibility[0])/(Vt.visibility[1]-Vt.visibility[0])*Vt.frames[1]);//! goToAndStop must be relative to the start of the current segment
j.goToAndStop(zt-j.firstFrame-1,!0)}Vt.type==="loop"&&(St===null||St!==Vt.frames||j.isPaused)&&(j.playSegments(Vt.frames,!0),St=Vt.frames),Vt.type==="play"&&j.isPaused&&(j.resetSegments(!0),j.play()),Vt.type==="stop"&&j.goToAndStop(Vt.frames[0]-j.firstFrame-1,!0)}};return document.addEventListener("scroll",kt),function(){document.removeEventListener("scroll",kt)}},pt=function(){var St=function(Vt,zt){var Jt=Vt,Dt=zt;if(Jt!==-1&&Dt!==-1){var It=getContainerCursorPosition(ct,Jt,Dt);Jt=It.x,Dt=It.y}var Mt=nt.find(function(er){var dr=er.position;return dr&&Array.isArray(dr.x)&&Array.isArray(dr.y)?Jt>=dr.x[0]&&Jt<=dr.x[1]&&Dt>=dr.y[0]&&Dt<=dr.y[1]:dr&&!Number.isNaN(dr.x)&&!Number.isNaN(dr.y)?Jt===dr.x&&Dt===dr.y:!1});if(Mt){if(Mt.type==="seek"&&Mt.position&&Array.isArray(Mt.position.x)&&Array.isArray(Mt.position.y)&&Mt.frames.length===2){var Ht=(Jt-Mt.position.x[0])/(Mt.position.x[1]-Mt.position.x[0]),tr=(Dt-Mt.position.y[0])/(Mt.position.y[1]-Mt.position.y[0]);j.playSegments(Mt.frames,!0),j.goToAndStop(Math.ceil((Ht+tr)/2*(Mt.frames[1]-Mt.frames[0])),!0)}Mt.type==="loop"&&j.playSegments(Mt.frames,!0),Mt.type==="play"&&(j.isPaused&&j.resetSegments(!1),j.playSegments(Mt.frames)),Mt.type==="stop"&&j.goToAndStop(Mt.frames[0],!0)}},kt=function(Vt){St(Vt.clientX,Vt.clientY)},At=function(){St(-1,-1)};return ct.addEventListener("mousemove",kt),ct.addEventListener("mouseout",At),function(){ct.removeEventListener("mousemove",kt),ct.removeEventListener("mouseout",At)}};switch(_e){case"scroll":return c();case"cursor":return pt()}}},[_e,j])},useLottieInteractivity=function e(i){var d=i.actions,j=i.mode,_e=i.lottieObj,nt=_e.animationItem,ct=_e.View,c=_e.animationContainerRef;return useInitInteractivity({actions:d,animationItem:nt,mode:j,wrapperRef:c}),ct},_excluded=["style","interactivity"],Lottie=function e(i){var d,j,_e,nt=i.style,ct=i.interactivity,c=_objectWithoutProperties(i,_excluded),pt=useLottie(c,nt),gt=pt.View,St=pt.play,kt=pt.stop,At=pt.pause,Nt=pt.setSpeed,Vt=pt.goToAndStop,zt=pt.goToAndPlay,Jt=pt.setDirection,Dt=pt.playSegments,It=pt.setSubframe,Mt=pt.getDuration,Ht=pt.destroy,tr=pt.animationContainerRef,er=pt.animationLoaded,dr=pt.animationItem;return reactExports.useEffect(function(){i.lottieRef&&(i.lottieRef.current={play:St,stop:kt,pause:At,setSpeed:Nt,goToAndPlay:zt,goToAndStop:Vt,setDirection:Jt,playSegments:Dt,setSubframe:It,getDuration:Mt,destroy:Ht,animationContainerRef:tr,animationLoaded:er,animationItem:dr})},[(d=i.lottieRef)===null||d===void 0?void 0:d.current]),useLottieInteractivity({lottieObj:{View:gt,play:St,stop:kt,pause:At,setSpeed:Nt,goToAndStop:Vt,goToAndPlay:zt,setDirection:Jt,playSegments:Dt,setSubframe:It,getDuration:Mt,destroy:Ht,animationContainerRef:tr,animationLoaded:er,animationItem:dr},actions:(j=ct==null?void 0:ct.actions)!==null&&j!==void 0?j:[],mode:(_e=ct==null?void 0:ct.mode)!==null&&_e!==void 0?_e:"scroll"})};const v="5.8.1",fr=30,ip=0,op=60,w=100,h=100,nm="Loading",ddd=0,assets=[],layers=[{ddd:0,ind:1,ty:4,nm:"loading",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[50,50,0],ix:2},a:{a:0,k:[50,50,0],ix:1},s:{a:0,k:[100,100,100],ix:6}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[34.35,0],[0,34.35]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.196,.718,.408,1],ix:3},o:{a:0,k:100,ix:7},w:{a:0,k:8,ix:4},lc:2,lj:2,ml:4,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:50,s:[360]}],ix:4},o:{a:0,k:100,ix:5},sk:{a:0,k:0,ix:6},sa:{a:0,k:0,ix:7},nm:"Transform"}],nm:"Group 1",np:3,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1},{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,0],[0,0]],o:[[0,0],[0,0]],v:[[34.35,0],[0,-34.35]],c:!1},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"st",c:{a:0,k:[.196,.718,.408,1],ix:3},o:{a:0,k:100,ix:7},w:{a:0,k:8,ix:4},lc:2,lj:2,ml:4,bm:0,nm:"Stroke 1",mn:"ADBE Vector Graphic - Stroke",hd:!1},{ty:"tr",p:{a:0,k:[0,0],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:1,k:[{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:0,s:[0]},{i:{x:[.667],y:[1]},o:{x:[.333],y:[0]},t:50,s:[360]}],ix:4},o:{a:0,k:100,ix:5},sk:{a:0,k:0,ix:6},sa:{a:0,k:0,ix:7},nm:"Transform"}],nm:"Group 2",np:3,cix:2,bm:0,ix:2,mn:"ADBE Vector Group",hd:!1}],ip:0,op:60,st:0,bm:0}],tapAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers},TapEffectButton=({children:e,className:i="",onClick:d,type:j,disabled:_e,hapticFeedback:nt=!0,scaleEffect:ct=!0,rippleColor:c="rgba(58, 195, 108, 0.3)",...pt})=>{const[gt,St]=reactExports.useState(0),[kt,At]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState([]),zt=reactExports.useRef(null),Jt=reactExports.useRef(null);reactExports.useEffect(()=>()=>{zt.current&&(window.clearTimeout(zt.current),zt.current=null)},[]);const Dt=()=>{nt&&window.navigator&&"vibrate"in window.navigator&&window.navigator.vibrate(50)},It=tr=>{if(!Jt.current)return;const er=Jt.current.getBoundingClientRect(),dr=tr.clientX-er.left,mr=tr.clientY-er.top,Ur={id:Date.now(),x:dr,y:mr};Vt(Dr=>[...Dr,Ur]),setTimeout(()=>{Vt(Dr=>Dr.filter(Yr=>Yr.id!==Ur.id))},600)},Mt=tr=>{_e||(St(er=>er+1),At(!0),Dt(),It(tr),zt.current&&window.clearTimeout(zt.current),zt.current=window.setTimeout(()=>{At(!1)},550))},Ht=`
    relative overflow-hidden
    ${ct?"transform transition-all duration-150 ease-out active:scale-95":""}
    ${_e?"opacity-50 cursor-not-allowed":"cursor-pointer"}
  `;return jsxRuntimeExports.jsx("button",{ref:Jt,type:j??"button",className:`${Ht} ${i}`,disabled:_e,onClick:tr=>{Mt(tr),d==null||d(tr)},style:{touchAction:"manipulation",userSelect:"none"},...pt,children:jsxRuntimeExports.jsxs("span",{className:"relative inline-block",children:[kt&&jsxRuntimeExports.jsx("span",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1.9)",zIndex:1,mixBlendMode:"multiply"},children:jsxRuntimeExports.jsx(Lottie,{animationData:tapAnimation,loop:!1,autoplay:!0,style:{width:"100%",height:"100%"}},gt)}),Nt.map(tr=>jsxRuntimeExports.jsx("span",{className:"absolute pointer-events-none",style:{left:tr.x,top:tr.y,width:"20px",height:"20px",transform:"translate(-50%, -50%)",backgroundColor:c,borderRadius:"50%",animation:"ripple 0.6s ease-out"}},tr.id)),e]})})},style=document.createElement("style");style.textContent=`
  @keyframes ripple {
    0% {
      width: 20px;
      height: 20px;
      opacity: 0.6;
    }
    100% {
      width: 100px;
      height: 100px;
      opacity: 0;
    }
  }
`;document.head.querySelector("style[data-ripple-animation]")||(style.setAttribute("data-ripple-animation","true"),document.head.appendChild(style));const PasswordResetSuccess=()=>{const e=useNavigate();return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center p-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/login"),className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:jsxRuntimeExports.jsx(ArrowLeft,{size:24,className:"text-gray-600"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("svg",{width:"64",height:"72",viewBox:"0 0 64 72",fill:"none",className:"text-green-500",children:jsxRuntimeExports.jsx("path",{d:"M32 4L8 16V36C8 52 32 68 32 68C32 68 56 52 56 36V16L32 4Z",fill:"currentColor"})}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:jsxRuntimeExports.jsx(Check,{size:24,className:"text-white",strokeWidth:3})})]})})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 text-center",children:"Password Reset Successfully"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 text-center max-w-sm",children:"Your Password has been changed successfully"}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"w-full max-w-sm bg-green-500 text-white py-4 rounded-full text-base font-semibold shadow-lg transition-all active:scale-95 hover:shadow-xl",children:"Go to Home"}),jsxRuntimeExports.jsx("div",{className:"mt-12 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center mr-4",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-orange-300 rounded-full mb-1"}),jsxRuntimeExports.jsx("div",{className:"w-6 h-12 bg-green-500 rounded-t-lg"}),jsxRuntimeExports.jsx("div",{className:"w-8 h-6 bg-gray-800 rounded-b-lg"})]}),jsxRuntimeExports.jsxs("div",{className:"w-32 h-56 bg-white rounded-3xl border-4 border-gray-300 shadow-lg flex flex-col p-3",children:[jsxRuntimeExports.jsx("div",{className:"w-full h-2 bg-gray-300 rounded-full mb-4"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-3/4 h-1.5 bg-gray-300 rounded"}),jsxRuntimeExports.jsx("div",{className:"w-1/2 h-1.5 bg-gray-300 rounded"}),jsxRuntimeExports.jsx("div",{className:"w-2/3 h-1.5 bg-gray-300 rounded"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Check,{size:20,className:"text-white",strokeWidth:3})})})]})]})})]})]})})};function bind(e,i){return function(){return e.apply(i,arguments)}}const{toString}=Object.prototype,{getPrototypeOf}=Object,{iterator,toStringTag}=Symbol,kindOf=(e=>i=>{const d=toString.call(i);return e[d]||(e[d]=d.slice(8,-1).toLowerCase())})(Object.create(null)),kindOfTest=e=>(e=e.toLowerCase(),i=>kindOf(i)===e),typeOfTest=e=>i=>typeof i===e,{isArray}=Array,isUndefined=typeOfTest("undefined");function isBuffer(e){return e!==null&&!isUndefined(e)&&e.constructor!==null&&!isUndefined(e.constructor)&&isFunction$1(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const isArrayBuffer=kindOfTest("ArrayBuffer");function isArrayBufferView(e){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(e):i=e&&e.buffer&&isArrayBuffer(e.buffer),i}const isString=typeOfTest("string"),isFunction$1=typeOfTest("function"),isNumber=typeOfTest("number"),isObject=e=>e!==null&&typeof e=="object",isBoolean=e=>e===!0||e===!1,isPlainObject=e=>{if(kindOf(e)!=="object")return!1;const i=getPrototypeOf(e);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(toStringTag in e)&&!(iterator in e)},isEmptyObject=e=>{if(!isObject(e)||isBuffer(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},isDate=kindOfTest("Date"),isFile=kindOfTest("File"),isBlob=kindOfTest("Blob"),isFileList=kindOfTest("FileList"),isStream=e=>isObject(e)&&isFunction$1(e.pipe),isFormData=e=>{let i;return e&&(typeof FormData=="function"&&e instanceof FormData||isFunction$1(e.append)&&((i=kindOf(e))==="formdata"||i==="object"&&isFunction$1(e.toString)&&e.toString()==="[object FormData]"))},isURLSearchParams=kindOfTest("URLSearchParams"),[isReadableStream,isRequest,isResponse,isHeaders]=["ReadableStream","Request","Response","Headers"].map(kindOfTest),trim=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function forEach(e,i,{allOwnKeys:d=!1}={}){if(e===null||typeof e>"u")return;let j,_e;if(typeof e!="object"&&(e=[e]),isArray(e))for(j=0,_e=e.length;j<_e;j++)i.call(null,e[j],j,e);else{if(isBuffer(e))return;const nt=d?Object.getOwnPropertyNames(e):Object.keys(e),ct=nt.length;let c;for(j=0;j<ct;j++)c=nt[j],i.call(null,e[c],c,e)}}function findKey(e,i){if(isBuffer(e))return null;i=i.toLowerCase();const d=Object.keys(e);let j=d.length,_e;for(;j-- >0;)if(_e=d[j],i===_e.toLowerCase())return _e;return null}const _global=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,isContextDefined=e=>!isUndefined(e)&&e!==_global;function merge(){const{caseless:e,skipUndefined:i}=isContextDefined(this)&&this||{},d={},j=(_e,nt)=>{const ct=e&&findKey(d,nt)||nt;isPlainObject(d[ct])&&isPlainObject(_e)?d[ct]=merge(d[ct],_e):isPlainObject(_e)?d[ct]=merge({},_e):isArray(_e)?d[ct]=_e.slice():(!i||!isUndefined(_e))&&(d[ct]=_e)};for(let _e=0,nt=arguments.length;_e<nt;_e++)arguments[_e]&&forEach(arguments[_e],j);return d}const extend=(e,i,d,{allOwnKeys:j}={})=>(forEach(i,(_e,nt)=>{d&&isFunction$1(_e)?e[nt]=bind(_e,d):e[nt]=_e},{allOwnKeys:j}),e),stripBOM=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits=(e,i,d,j)=>{e.prototype=Object.create(i.prototype,j),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:i.prototype}),d&&Object.assign(e.prototype,d)},toFlatObject=(e,i,d,j)=>{let _e,nt,ct;const c={};if(i=i||{},e==null)return i;do{for(_e=Object.getOwnPropertyNames(e),nt=_e.length;nt-- >0;)ct=_e[nt],(!j||j(ct,e,i))&&!c[ct]&&(i[ct]=e[ct],c[ct]=!0);e=d!==!1&&getPrototypeOf(e)}while(e&&(!d||d(e,i))&&e!==Object.prototype);return i},endsWith=(e,i,d)=>{e=String(e),(d===void 0||d>e.length)&&(d=e.length),d-=i.length;const j=e.indexOf(i,d);return j!==-1&&j===d},toArray=e=>{if(!e)return null;if(isArray(e))return e;let i=e.length;if(!isNumber(i))return null;const d=new Array(i);for(;i-- >0;)d[i]=e[i];return d},isTypedArray=(e=>i=>e&&i instanceof e)(typeof Uint8Array<"u"&&getPrototypeOf(Uint8Array)),forEachEntry=(e,i)=>{const j=(e&&e[iterator]).call(e);let _e;for(;(_e=j.next())&&!_e.done;){const nt=_e.value;i.call(e,nt[0],nt[1])}},matchAll=(e,i)=>{let d;const j=[];for(;(d=e.exec(i))!==null;)j.push(d);return j},isHTMLForm=kindOfTest("HTMLFormElement"),toCamelCase=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(d,j,_e){return j.toUpperCase()+_e}),hasOwnProperty=(({hasOwnProperty:e})=>(i,d)=>e.call(i,d))(Object.prototype),isRegExp=kindOfTest("RegExp"),reduceDescriptors=(e,i)=>{const d=Object.getOwnPropertyDescriptors(e),j={};forEach(d,(_e,nt)=>{let ct;(ct=i(_e,nt,e))!==!1&&(j[nt]=ct||_e)}),Object.defineProperties(e,j)},freezeMethods=e=>{reduceDescriptors(e,(i,d)=>{if(isFunction$1(e)&&["arguments","caller","callee"].indexOf(d)!==-1)return!1;const j=e[d];if(isFunction$1(j)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+d+"'")})}})},toObjectSet=(e,i)=>{const d={},j=_e=>{_e.forEach(nt=>{d[nt]=!0})};return isArray(e)?j(e):j(String(e).split(i)),d},noop=()=>{},toFiniteNumber=(e,i)=>e!=null&&Number.isFinite(e=+e)?e:i;function isSpecCompliantForm(e){return!!(e&&isFunction$1(e.append)&&e[toStringTag]==="FormData"&&e[iterator])}const toJSONObject=e=>{const i=new Array(10),d=(j,_e)=>{if(isObject(j)){if(i.indexOf(j)>=0)return;if(isBuffer(j))return j;if(!("toJSON"in j)){i[_e]=j;const nt=isArray(j)?[]:{};return forEach(j,(ct,c)=>{const pt=d(ct,_e+1);!isUndefined(pt)&&(nt[c]=pt)}),i[_e]=void 0,nt}}return j};return d(e,0)},isAsyncFn=kindOfTest("AsyncFunction"),isThenable=e=>e&&(isObject(e)||isFunction$1(e))&&isFunction$1(e.then)&&isFunction$1(e.catch),_setImmediate=((e,i)=>e?setImmediate:i?((d,j)=>(_global.addEventListener("message",({source:_e,data:nt})=>{_e===_global&&nt===d&&j.length&&j.shift()()},!1),_e=>{j.push(_e),_global.postMessage(d,"*")}))(`axios@${Math.random()}`,[]):d=>setTimeout(d))(typeof setImmediate=="function",isFunction$1(_global.postMessage)),asap=typeof queueMicrotask<"u"?queueMicrotask.bind(_global):typeof process<"u"&&process.nextTick||_setImmediate,isIterable=e=>e!=null&&isFunction$1(e[iterator]),utils$1={isArray,isArrayBuffer,isBuffer,isFormData,isArrayBufferView,isString,isNumber,isBoolean,isObject,isPlainObject,isEmptyObject,isReadableStream,isRequest,isResponse,isHeaders,isUndefined,isDate,isFile,isBlob,isRegExp,isFunction:isFunction$1,isStream,isURLSearchParams,isTypedArray,isFileList,forEach,merge,extend,trim,stripBOM,inherits,toFlatObject,kindOf,kindOfTest,endsWith,toArray,forEachEntry,matchAll,isHTMLForm,hasOwnProperty,hasOwnProp:hasOwnProperty,reduceDescriptors,freezeMethods,toObjectSet,toCamelCase,noop,toFiniteNumber,findKey,global:_global,isContextDefined,isSpecCompliantForm,toJSONObject,isAsyncFn,isThenable,setImmediate:_setImmediate,asap,isIterable};function AxiosError$1(e,i,d,j,_e){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",i&&(this.code=i),d&&(this.config=d),j&&(this.request=j),_e&&(this.response=_e,this.status=_e.status?_e.status:null)}utils$1.inherits(AxiosError$1,Error,{toJSON:function e(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:utils$1.toJSONObject(this.config),code:this.code,status:this.status}}});const prototype$1=AxiosError$1.prototype,descriptors={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{descriptors[e]={value:e}});Object.defineProperties(AxiosError$1,descriptors);Object.defineProperty(prototype$1,"isAxiosError",{value:!0});AxiosError$1.from=(e,i,d,j,_e,nt)=>{const ct=Object.create(prototype$1);utils$1.toFlatObject(e,ct,function(St){return St!==Error.prototype},gt=>gt!=="isAxiosError");const c=e&&e.message?e.message:"Error",pt=i==null&&e?e.code:i;return AxiosError$1.call(ct,c,pt,d,j,_e),e&&ct.cause==null&&Object.defineProperty(ct,"cause",{value:e,configurable:!0}),ct.name=e&&e.name||"Error",nt&&Object.assign(ct,nt),ct};const httpAdapter=null;function isVisitable(e){return utils$1.isPlainObject(e)||utils$1.isArray(e)}function removeBrackets(e){return utils$1.endsWith(e,"[]")?e.slice(0,-2):e}function renderKey(e,i,d){return e?e.concat(i).map(function(_e,nt){return _e=removeBrackets(_e),!d&&nt?"["+_e+"]":_e}).join(d?".":""):i}function isFlatArray(e){return utils$1.isArray(e)&&!e.some(isVisitable)}const predicates=utils$1.toFlatObject(utils$1,{},null,function e(i){return/^is[A-Z]/.test(i)});function toFormData$1(e,i,d){if(!utils$1.isObject(e))throw new TypeError("target must be an object");i=i||new FormData,d=utils$1.toFlatObject(d,{metaTokens:!0,dots:!1,indexes:!1},!1,function(zt,Jt){return!utils$1.isUndefined(Jt[zt])});const j=d.metaTokens,_e=d.visitor||St,nt=d.dots,ct=d.indexes,pt=(d.Blob||typeof Blob<"u"&&Blob)&&utils$1.isSpecCompliantForm(i);if(!utils$1.isFunction(_e))throw new TypeError("visitor must be a function");function gt(Vt){if(Vt===null)return"";if(utils$1.isDate(Vt))return Vt.toISOString();if(utils$1.isBoolean(Vt))return Vt.toString();if(!pt&&utils$1.isBlob(Vt))throw new AxiosError$1("Blob is not supported. Use a Buffer instead.");return utils$1.isArrayBuffer(Vt)||utils$1.isTypedArray(Vt)?pt&&typeof Blob=="function"?new Blob([Vt]):Buffer.from(Vt):Vt}function St(Vt,zt,Jt){let Dt=Vt;if(Vt&&!Jt&&typeof Vt=="object"){if(utils$1.endsWith(zt,"{}"))zt=j?zt:zt.slice(0,-2),Vt=JSON.stringify(Vt);else if(utils$1.isArray(Vt)&&isFlatArray(Vt)||(utils$1.isFileList(Vt)||utils$1.endsWith(zt,"[]"))&&(Dt=utils$1.toArray(Vt)))return zt=removeBrackets(zt),Dt.forEach(function(Mt,Ht){!(utils$1.isUndefined(Mt)||Mt===null)&&i.append(ct===!0?renderKey([zt],Ht,nt):ct===null?zt:zt+"[]",gt(Mt))}),!1}return isVisitable(Vt)?!0:(i.append(renderKey(Jt,zt,nt),gt(Vt)),!1)}const kt=[],At=Object.assign(predicates,{defaultVisitor:St,convertValue:gt,isVisitable});function Nt(Vt,zt){if(!utils$1.isUndefined(Vt)){if(kt.indexOf(Vt)!==-1)throw Error("Circular reference detected in "+zt.join("."));kt.push(Vt),utils$1.forEach(Vt,function(Dt,It){(!(utils$1.isUndefined(Dt)||Dt===null)&&_e.call(i,Dt,utils$1.isString(It)?It.trim():It,zt,At))===!0&&Nt(Dt,zt?zt.concat(It):[It])}),kt.pop()}}if(!utils$1.isObject(e))throw new TypeError("data must be an object");return Nt(e),i}function encode$2(e){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(j){return i[j]})}function AxiosURLSearchParams(e,i){this._pairs=[],e&&toFormData$1(e,this,i)}const prototype=AxiosURLSearchParams.prototype;prototype.append=function e(i,d){this._pairs.push([i,d])};prototype.toString=function e(i){const d=i?function(j){return i.call(this,j,encode$2)}:encode$2;return this._pairs.map(function(_e){return d(_e[0])+"="+d(_e[1])},"").join("&")};function encode$1(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function buildURL(e,i,d){if(!i)return e;const j=d&&d.encode||encode$1;utils$1.isFunction(d)&&(d={serialize:d});const _e=d&&d.serialize;let nt;if(_e?nt=_e(i,d):nt=utils$1.isURLSearchParams(i)?i.toString():new AxiosURLSearchParams(i,d).toString(j),nt){const ct=e.indexOf("#");ct!==-1&&(e=e.slice(0,ct)),e+=(e.indexOf("?")===-1?"?":"&")+nt}return e}class InterceptorManager{constructor(){this.handlers=[]}use(i,d,j){return this.handlers.push({fulfilled:i,rejected:d,synchronous:j?j.synchronous:!1,runWhen:j?j.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){utils$1.forEach(this.handlers,function(j){j!==null&&i(j)})}}const transitionalDefaults={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},URLSearchParams$1=typeof URLSearchParams<"u"?URLSearchParams:AxiosURLSearchParams,FormData$1=typeof FormData<"u"?FormData:null,Blob$1=typeof Blob<"u"?Blob:null,platform$1={isBrowser:!0,classes:{URLSearchParams:URLSearchParams$1,FormData:FormData$1,Blob:Blob$1},protocols:["http","https","file","blob","url","data"]},hasBrowserEnv=typeof window<"u"&&typeof document<"u",_navigator=typeof navigator=="object"&&navigator||void 0,hasStandardBrowserEnv=hasBrowserEnv&&(!_navigator||["ReactNative","NativeScript","NS"].indexOf(_navigator.product)<0),hasStandardBrowserWebWorkerEnv=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",origin=hasBrowserEnv&&window.location.href||"http://localhost",utils=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv,hasStandardBrowserEnv,hasStandardBrowserWebWorkerEnv,navigator:_navigator,origin},Symbol.toStringTag,{value:"Module"})),platform={...utils,...platform$1};function toURLEncodedForm(e,i){return toFormData$1(e,new platform.classes.URLSearchParams,{visitor:function(d,j,_e,nt){return platform.isNode&&utils$1.isBuffer(d)?(this.append(j,d.toString("base64")),!1):nt.defaultVisitor.apply(this,arguments)},...i})}function parsePropPath(e){return utils$1.matchAll(/\w+|\[(\w*)]/g,e).map(i=>i[0]==="[]"?"":i[1]||i[0])}function arrayToObject(e){const i={},d=Object.keys(e);let j;const _e=d.length;let nt;for(j=0;j<_e;j++)nt=d[j],i[nt]=e[nt];return i}function formDataToJSON(e){function i(d,j,_e,nt){let ct=d[nt++];if(ct==="__proto__")return!0;const c=Number.isFinite(+ct),pt=nt>=d.length;return ct=!ct&&utils$1.isArray(_e)?_e.length:ct,pt?(utils$1.hasOwnProp(_e,ct)?_e[ct]=[_e[ct],j]:_e[ct]=j,!c):((!_e[ct]||!utils$1.isObject(_e[ct]))&&(_e[ct]=[]),i(d,j,_e[ct],nt)&&utils$1.isArray(_e[ct])&&(_e[ct]=arrayToObject(_e[ct])),!c)}if(utils$1.isFormData(e)&&utils$1.isFunction(e.entries)){const d={};return utils$1.forEachEntry(e,(j,_e)=>{i(parsePropPath(j),_e,d,0)}),d}return null}function stringifySafely(e,i,d){if(utils$1.isString(e))try{return(i||JSON.parse)(e),utils$1.trim(e)}catch(j){if(j.name!=="SyntaxError")throw j}return(d||JSON.stringify)(e)}const defaults={transitional:transitionalDefaults,adapter:["xhr","http","fetch"],transformRequest:[function e(i,d){const j=d.getContentType()||"",_e=j.indexOf("application/json")>-1,nt=utils$1.isObject(i);if(nt&&utils$1.isHTMLForm(i)&&(i=new FormData(i)),utils$1.isFormData(i))return _e?JSON.stringify(formDataToJSON(i)):i;if(utils$1.isArrayBuffer(i)||utils$1.isBuffer(i)||utils$1.isStream(i)||utils$1.isFile(i)||utils$1.isBlob(i)||utils$1.isReadableStream(i))return i;if(utils$1.isArrayBufferView(i))return i.buffer;if(utils$1.isURLSearchParams(i))return d.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let c;if(nt){if(j.indexOf("application/x-www-form-urlencoded")>-1)return toURLEncodedForm(i,this.formSerializer).toString();if((c=utils$1.isFileList(i))||j.indexOf("multipart/form-data")>-1){const pt=this.env&&this.env.FormData;return toFormData$1(c?{"files[]":i}:i,pt&&new pt,this.formSerializer)}}return nt||_e?(d.setContentType("application/json",!1),stringifySafely(i)):i}],transformResponse:[function e(i){const d=this.transitional||defaults.transitional,j=d&&d.forcedJSONParsing,_e=this.responseType==="json";if(utils$1.isResponse(i)||utils$1.isReadableStream(i))return i;if(i&&utils$1.isString(i)&&(j&&!this.responseType||_e)){const ct=!(d&&d.silentJSONParsing)&&_e;try{return JSON.parse(i,this.parseReviver)}catch(c){if(ct)throw c.name==="SyntaxError"?AxiosError$1.from(c,AxiosError$1.ERR_BAD_RESPONSE,this,null,this.response):c}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:platform.classes.FormData,Blob:platform.classes.Blob},validateStatus:function e(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};utils$1.forEach(["delete","get","head","post","put","patch"],e=>{defaults.headers[e]={}});const ignoreDuplicateOf=utils$1.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),parseHeaders=e=>{const i={};let d,j,_e;return e&&e.split(`
`).forEach(function(ct){_e=ct.indexOf(":"),d=ct.substring(0,_e).trim().toLowerCase(),j=ct.substring(_e+1).trim(),!(!d||i[d]&&ignoreDuplicateOf[d])&&(d==="set-cookie"?i[d]?i[d].push(j):i[d]=[j]:i[d]=i[d]?i[d]+", "+j:j)}),i},$internals=Symbol("internals");function normalizeHeader(e){return e&&String(e).trim().toLowerCase()}function normalizeValue(e){return e===!1||e==null?e:utils$1.isArray(e)?e.map(normalizeValue):String(e)}function parseTokens(e){const i=Object.create(null),d=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let j;for(;j=d.exec(e);)i[j[1]]=j[2];return i}const isValidHeaderName=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function matchHeaderValue(e,i,d,j,_e){if(utils$1.isFunction(j))return j.call(this,i,d);if(_e&&(i=d),!!utils$1.isString(i)){if(utils$1.isString(j))return i.indexOf(j)!==-1;if(utils$1.isRegExp(j))return j.test(i)}}function formatHeader(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,d,j)=>d.toUpperCase()+j)}function buildAccessors(e,i){const d=utils$1.toCamelCase(" "+i);["get","set","has"].forEach(j=>{Object.defineProperty(e,j+d,{value:function(_e,nt,ct){return this[j].call(this,i,_e,nt,ct)},configurable:!0})})}let AxiosHeaders$1=class{constructor(i){i&&this.set(i)}set(i,d,j){const _e=this;function nt(c,pt,gt){const St=normalizeHeader(pt);if(!St)throw new Error("header name must be a non-empty string");const kt=utils$1.findKey(_e,St);(!kt||_e[kt]===void 0||gt===!0||gt===void 0&&_e[kt]!==!1)&&(_e[kt||pt]=normalizeValue(c))}const ct=(c,pt)=>utils$1.forEach(c,(gt,St)=>nt(gt,St,pt));if(utils$1.isPlainObject(i)||i instanceof this.constructor)ct(i,d);else if(utils$1.isString(i)&&(i=i.trim())&&!isValidHeaderName(i))ct(parseHeaders(i),d);else if(utils$1.isObject(i)&&utils$1.isIterable(i)){let c={},pt,gt;for(const St of i){if(!utils$1.isArray(St))throw TypeError("Object iterator must return a key-value pair");c[gt=St[0]]=(pt=c[gt])?utils$1.isArray(pt)?[...pt,St[1]]:[pt,St[1]]:St[1]}ct(c,d)}else i!=null&&nt(d,i,j);return this}get(i,d){if(i=normalizeHeader(i),i){const j=utils$1.findKey(this,i);if(j){const _e=this[j];if(!d)return _e;if(d===!0)return parseTokens(_e);if(utils$1.isFunction(d))return d.call(this,_e,j);if(utils$1.isRegExp(d))return d.exec(_e);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,d){if(i=normalizeHeader(i),i){const j=utils$1.findKey(this,i);return!!(j&&this[j]!==void 0&&(!d||matchHeaderValue(this,this[j],j,d)))}return!1}delete(i,d){const j=this;let _e=!1;function nt(ct){if(ct=normalizeHeader(ct),ct){const c=utils$1.findKey(j,ct);c&&(!d||matchHeaderValue(j,j[c],c,d))&&(delete j[c],_e=!0)}}return utils$1.isArray(i)?i.forEach(nt):nt(i),_e}clear(i){const d=Object.keys(this);let j=d.length,_e=!1;for(;j--;){const nt=d[j];(!i||matchHeaderValue(this,this[nt],nt,i,!0))&&(delete this[nt],_e=!0)}return _e}normalize(i){const d=this,j={};return utils$1.forEach(this,(_e,nt)=>{const ct=utils$1.findKey(j,nt);if(ct){d[ct]=normalizeValue(_e),delete d[nt];return}const c=i?formatHeader(nt):String(nt).trim();c!==nt&&delete d[nt],d[c]=normalizeValue(_e),j[c]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const d=Object.create(null);return utils$1.forEach(this,(j,_e)=>{j!=null&&j!==!1&&(d[_e]=i&&utils$1.isArray(j)?j.join(", "):j)}),d}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,d])=>i+": "+d).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...d){const j=new this(i);return d.forEach(_e=>j.set(_e)),j}static accessor(i){const j=(this[$internals]=this[$internals]={accessors:{}}).accessors,_e=this.prototype;function nt(ct){const c=normalizeHeader(ct);j[c]||(buildAccessors(_e,ct),j[c]=!0)}return utils$1.isArray(i)?i.forEach(nt):nt(i),this}};AxiosHeaders$1.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);utils$1.reduceDescriptors(AxiosHeaders$1.prototype,({value:e},i)=>{let d=i[0].toUpperCase()+i.slice(1);return{get:()=>e,set(j){this[d]=j}}});utils$1.freezeMethods(AxiosHeaders$1);function transformData(e,i){const d=this||defaults,j=i||d,_e=AxiosHeaders$1.from(j.headers);let nt=j.data;return utils$1.forEach(e,function(c){nt=c.call(d,nt,_e.normalize(),i?i.status:void 0)}),_e.normalize(),nt}function isCancel$1(e){return!!(e&&e.__CANCEL__)}function CanceledError$1(e,i,d){AxiosError$1.call(this,e??"canceled",AxiosError$1.ERR_CANCELED,i,d),this.name="CanceledError"}utils$1.inherits(CanceledError$1,AxiosError$1,{__CANCEL__:!0});function settle(e,i,d){const j=d.config.validateStatus;!d.status||!j||j(d.status)?e(d):i(new AxiosError$1("Request failed with status code "+d.status,[AxiosError$1.ERR_BAD_REQUEST,AxiosError$1.ERR_BAD_RESPONSE][Math.floor(d.status/100)-4],d.config,d.request,d))}function parseProtocol(e){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return i&&i[1]||""}function speedometer(e,i){e=e||10;const d=new Array(e),j=new Array(e);let _e=0,nt=0,ct;return i=i!==void 0?i:1e3,function(pt){const gt=Date.now(),St=j[nt];ct||(ct=gt),d[_e]=pt,j[_e]=gt;let kt=nt,At=0;for(;kt!==_e;)At+=d[kt++],kt=kt%e;if(_e=(_e+1)%e,_e===nt&&(nt=(nt+1)%e),gt-ct<i)return;const Nt=St&&gt-St;return Nt?Math.round(At*1e3/Nt):void 0}}function throttle(e,i){let d=0,j=1e3/i,_e,nt;const ct=(gt,St=Date.now())=>{d=St,_e=null,nt&&(clearTimeout(nt),nt=null),e(...gt)};return[(...gt)=>{const St=Date.now(),kt=St-d;kt>=j?ct(gt,St):(_e=gt,nt||(nt=setTimeout(()=>{nt=null,ct(_e)},j-kt)))},()=>_e&&ct(_e)]}const progressEventReducer=(e,i,d=3)=>{let j=0;const _e=speedometer(50,250);return throttle(nt=>{const ct=nt.loaded,c=nt.lengthComputable?nt.total:void 0,pt=ct-j,gt=_e(pt),St=ct<=c;j=ct;const kt={loaded:ct,total:c,progress:c?ct/c:void 0,bytes:pt,rate:gt||void 0,estimated:gt&&c&&St?(c-ct)/gt:void 0,event:nt,lengthComputable:c!=null,[i?"download":"upload"]:!0};e(kt)},d)},progressEventDecorator=(e,i)=>{const d=e!=null;return[j=>i[0]({lengthComputable:d,total:e,loaded:j}),i[1]]},asyncDecorator=e=>(...i)=>utils$1.asap(()=>e(...i)),isURLSameOrigin=platform.hasStandardBrowserEnv?((e,i)=>d=>(d=new URL(d,platform.origin),e.protocol===d.protocol&&e.host===d.host&&(i||e.port===d.port)))(new URL(platform.origin),platform.navigator&&/(msie|trident)/i.test(platform.navigator.userAgent)):()=>!0,cookies=platform.hasStandardBrowserEnv?{write(e,i,d,j,_e,nt,ct){if(typeof document>"u")return;const c=[`${e}=${encodeURIComponent(i)}`];utils$1.isNumber(d)&&c.push(`expires=${new Date(d).toUTCString()}`),utils$1.isString(j)&&c.push(`path=${j}`),utils$1.isString(_e)&&c.push(`domain=${_e}`),nt===!0&&c.push("secure"),utils$1.isString(ct)&&c.push(`SameSite=${ct}`),document.cookie=c.join("; ")},read(e){if(typeof document>"u")return null;const i=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return i?decodeURIComponent(i[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function isAbsoluteURL(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function combineURLs(e,i){return i?e.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):e}function buildFullPath(e,i,d){let j=!isAbsoluteURL(i);return e&&(j||d==!1)?combineURLs(e,i):i}const headersToObject=e=>e instanceof AxiosHeaders$1?{...e}:e;function mergeConfig$1(e,i){i=i||{};const d={};function j(gt,St,kt,At){return utils$1.isPlainObject(gt)&&utils$1.isPlainObject(St)?utils$1.merge.call({caseless:At},gt,St):utils$1.isPlainObject(St)?utils$1.merge({},St):utils$1.isArray(St)?St.slice():St}function _e(gt,St,kt,At){if(utils$1.isUndefined(St)){if(!utils$1.isUndefined(gt))return j(void 0,gt,kt,At)}else return j(gt,St,kt,At)}function nt(gt,St){if(!utils$1.isUndefined(St))return j(void 0,St)}function ct(gt,St){if(utils$1.isUndefined(St)){if(!utils$1.isUndefined(gt))return j(void 0,gt)}else return j(void 0,St)}function c(gt,St,kt){if(kt in i)return j(gt,St);if(kt in e)return j(void 0,gt)}const pt={url:nt,method:nt,data:nt,baseURL:ct,transformRequest:ct,transformResponse:ct,paramsSerializer:ct,timeout:ct,timeoutMessage:ct,withCredentials:ct,withXSRFToken:ct,adapter:ct,responseType:ct,xsrfCookieName:ct,xsrfHeaderName:ct,onUploadProgress:ct,onDownloadProgress:ct,decompress:ct,maxContentLength:ct,maxBodyLength:ct,beforeRedirect:ct,transport:ct,httpAgent:ct,httpsAgent:ct,cancelToken:ct,socketPath:ct,responseEncoding:ct,validateStatus:c,headers:(gt,St,kt)=>_e(headersToObject(gt),headersToObject(St),kt,!0)};return utils$1.forEach(Object.keys({...e,...i}),function(St){const kt=pt[St]||_e,At=kt(e[St],i[St],St);utils$1.isUndefined(At)&&kt!==c||(d[St]=At)}),d}const resolveConfig=e=>{const i=mergeConfig$1({},e);let{data:d,withXSRFToken:j,xsrfHeaderName:_e,xsrfCookieName:nt,headers:ct,auth:c}=i;if(i.headers=ct=AxiosHeaders$1.from(ct),i.url=buildURL(buildFullPath(i.baseURL,i.url,i.allowAbsoluteUrls),e.params,e.paramsSerializer),c&&ct.set("Authorization","Basic "+btoa((c.username||"")+":"+(c.password?unescape(encodeURIComponent(c.password)):""))),utils$1.isFormData(d)){if(platform.hasStandardBrowserEnv||platform.hasStandardBrowserWebWorkerEnv)ct.setContentType(void 0);else if(utils$1.isFunction(d.getHeaders)){const pt=d.getHeaders(),gt=["content-type","content-length"];Object.entries(pt).forEach(([St,kt])=>{gt.includes(St.toLowerCase())&&ct.set(St,kt)})}}if(platform.hasStandardBrowserEnv&&(j&&utils$1.isFunction(j)&&(j=j(i)),j||j!==!1&&isURLSameOrigin(i.url))){const pt=_e&&nt&&cookies.read(nt);pt&&ct.set(_e,pt)}return i},isXHRAdapterSupported=typeof XMLHttpRequest<"u",xhrAdapter=isXHRAdapterSupported&&function(e){return new Promise(function(d,j){const _e=resolveConfig(e);let nt=_e.data;const ct=AxiosHeaders$1.from(_e.headers).normalize();let{responseType:c,onUploadProgress:pt,onDownloadProgress:gt}=_e,St,kt,At,Nt,Vt;function zt(){Nt&&Nt(),Vt&&Vt(),_e.cancelToken&&_e.cancelToken.unsubscribe(St),_e.signal&&_e.signal.removeEventListener("abort",St)}let Jt=new XMLHttpRequest;Jt.open(_e.method.toUpperCase(),_e.url,!0),Jt.timeout=_e.timeout;function Dt(){if(!Jt)return;const Mt=AxiosHeaders$1.from("getAllResponseHeaders"in Jt&&Jt.getAllResponseHeaders()),tr={data:!c||c==="text"||c==="json"?Jt.responseText:Jt.response,status:Jt.status,statusText:Jt.statusText,headers:Mt,config:e,request:Jt};settle(function(dr){d(dr),zt()},function(dr){j(dr),zt()},tr),Jt=null}"onloadend"in Jt?Jt.onloadend=Dt:Jt.onreadystatechange=function(){!Jt||Jt.readyState!==4||Jt.status===0&&!(Jt.responseURL&&Jt.responseURL.indexOf("file:")===0)||setTimeout(Dt)},Jt.onabort=function(){Jt&&(j(new AxiosError$1("Request aborted",AxiosError$1.ECONNABORTED,e,Jt)),Jt=null)},Jt.onerror=function(Ht){const tr=Ht&&Ht.message?Ht.message:"Network Error",er=new AxiosError$1(tr,AxiosError$1.ERR_NETWORK,e,Jt);er.event=Ht||null,j(er),Jt=null},Jt.ontimeout=function(){let Ht=_e.timeout?"timeout of "+_e.timeout+"ms exceeded":"timeout exceeded";const tr=_e.transitional||transitionalDefaults;_e.timeoutErrorMessage&&(Ht=_e.timeoutErrorMessage),j(new AxiosError$1(Ht,tr.clarifyTimeoutError?AxiosError$1.ETIMEDOUT:AxiosError$1.ECONNABORTED,e,Jt)),Jt=null},nt===void 0&&ct.setContentType(null),"setRequestHeader"in Jt&&utils$1.forEach(ct.toJSON(),function(Ht,tr){Jt.setRequestHeader(tr,Ht)}),utils$1.isUndefined(_e.withCredentials)||(Jt.withCredentials=!!_e.withCredentials),c&&c!=="json"&&(Jt.responseType=_e.responseType),gt&&([At,Vt]=progressEventReducer(gt,!0),Jt.addEventListener("progress",At)),pt&&Jt.upload&&([kt,Nt]=progressEventReducer(pt),Jt.upload.addEventListener("progress",kt),Jt.upload.addEventListener("loadend",Nt)),(_e.cancelToken||_e.signal)&&(St=Mt=>{Jt&&(j(!Mt||Mt.type?new CanceledError$1(null,e,Jt):Mt),Jt.abort(),Jt=null)},_e.cancelToken&&_e.cancelToken.subscribe(St),_e.signal&&(_e.signal.aborted?St():_e.signal.addEventListener("abort",St)));const It=parseProtocol(_e.url);if(It&&platform.protocols.indexOf(It)===-1){j(new AxiosError$1("Unsupported protocol "+It+":",AxiosError$1.ERR_BAD_REQUEST,e));return}Jt.send(nt||null)})},composeSignals=(e,i)=>{const{length:d}=e=e?e.filter(Boolean):[];if(i||d){let j=new AbortController,_e;const nt=function(gt){if(!_e){_e=!0,c();const St=gt instanceof Error?gt:this.reason;j.abort(St instanceof AxiosError$1?St:new CanceledError$1(St instanceof Error?St.message:St))}};let ct=i&&setTimeout(()=>{ct=null,nt(new AxiosError$1(`timeout ${i} of ms exceeded`,AxiosError$1.ETIMEDOUT))},i);const c=()=>{e&&(ct&&clearTimeout(ct),ct=null,e.forEach(gt=>{gt.unsubscribe?gt.unsubscribe(nt):gt.removeEventListener("abort",nt)}),e=null)};e.forEach(gt=>gt.addEventListener("abort",nt));const{signal:pt}=j;return pt.unsubscribe=()=>utils$1.asap(c),pt}},streamChunk=function*(e,i){let d=e.byteLength;if(d<i){yield e;return}let j=0,_e;for(;j<d;)_e=j+i,yield e.slice(j,_e),j=_e},readBytes=async function*(e,i){for await(const d of readStream(e))yield*streamChunk(d,i)},readStream=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const i=e.getReader();try{for(;;){const{done:d,value:j}=await i.read();if(d)break;yield j}}finally{await i.cancel()}},trackStream=(e,i,d,j)=>{const _e=readBytes(e,i);let nt=0,ct,c=pt=>{ct||(ct=!0,j&&j(pt))};return new ReadableStream({async pull(pt){try{const{done:gt,value:St}=await _e.next();if(gt){c(),pt.close();return}let kt=St.byteLength;if(d){let At=nt+=kt;d(At)}pt.enqueue(new Uint8Array(St))}catch(gt){throw c(gt),gt}},cancel(pt){return c(pt),_e.return()}},{highWaterMark:2})},DEFAULT_CHUNK_SIZE=64*1024,{isFunction}=utils$1,globalFetchAPI=(({Request:e,Response:i})=>({Request:e,Response:i}))(utils$1.global),{ReadableStream:ReadableStream$1,TextEncoder}=utils$1.global,test=(e,...i)=>{try{return!!e(...i)}catch{return!1}},factory=e=>{e=utils$1.merge.call({skipUndefined:!0},globalFetchAPI,e);const{fetch:i,Request:d,Response:j}=e,_e=i?isFunction(i):typeof fetch=="function",nt=isFunction(d),ct=isFunction(j);if(!_e)return!1;const c=_e&&isFunction(ReadableStream$1),pt=_e&&(typeof TextEncoder=="function"?(Vt=>zt=>Vt.encode(zt))(new TextEncoder):async Vt=>new Uint8Array(await new d(Vt).arrayBuffer())),gt=nt&&c&&test(()=>{let Vt=!1;const zt=new d(platform.origin,{body:new ReadableStream$1,method:"POST",get duplex(){return Vt=!0,"half"}}).headers.has("Content-Type");return Vt&&!zt}),St=ct&&c&&test(()=>utils$1.isReadableStream(new j("").body)),kt={stream:St&&(Vt=>Vt.body)};_e&&["text","arrayBuffer","blob","formData","stream"].forEach(Vt=>{!kt[Vt]&&(kt[Vt]=(zt,Jt)=>{let Dt=zt&&zt[Vt];if(Dt)return Dt.call(zt);throw new AxiosError$1(`Response type '${Vt}' is not supported`,AxiosError$1.ERR_NOT_SUPPORT,Jt)})});const At=async Vt=>{if(Vt==null)return 0;if(utils$1.isBlob(Vt))return Vt.size;if(utils$1.isSpecCompliantForm(Vt))return(await new d(platform.origin,{method:"POST",body:Vt}).arrayBuffer()).byteLength;if(utils$1.isArrayBufferView(Vt)||utils$1.isArrayBuffer(Vt))return Vt.byteLength;if(utils$1.isURLSearchParams(Vt)&&(Vt=Vt+""),utils$1.isString(Vt))return(await pt(Vt)).byteLength},Nt=async(Vt,zt)=>{const Jt=utils$1.toFiniteNumber(Vt.getContentLength());return Jt??At(zt)};return async Vt=>{let{url:zt,method:Jt,data:Dt,signal:It,cancelToken:Mt,timeout:Ht,onDownloadProgress:tr,onUploadProgress:er,responseType:dr,headers:mr,withCredentials:Ur="same-origin",fetchOptions:Dr}=resolveConfig(Vt),Yr=i||fetch;dr=dr?(dr+"").toLowerCase():"text";let es=composeSignals([It,Mt&&Mt.toAbortSignal()],Ht),ms=null;const Ms=es&&es.unsubscribe&&(()=>{es.unsubscribe()});let Kr;try{if(er&&gt&&Jt!=="get"&&Jt!=="head"&&(Kr=await Nt(mr,Dt))!==0){let Ar=new d(zt,{method:"POST",body:Dt,duplex:"half"}),Xr;if(utils$1.isFormData(Dt)&&(Xr=Ar.headers.get("content-type"))&&mr.setContentType(Xr),Ar.body){const[us,Wr]=progressEventDecorator(Kr,progressEventReducer(asyncDecorator(er)));Dt=trackStream(Ar.body,DEFAULT_CHUNK_SIZE,us,Wr)}}utils$1.isString(Ur)||(Ur=Ur?"include":"omit");const xr=nt&&"credentials"in d.prototype,jr={...Dr,signal:es,method:Jt.toUpperCase(),headers:mr.normalize().toJSON(),body:Dt,duplex:"half",credentials:xr?Ur:void 0};ms=nt&&new d(zt,jr);let rr=await(nt?Yr(ms,Dr):Yr(zt,jr));const ar=St&&(dr==="stream"||dr==="response");if(St&&(tr||ar&&Ms)){const Ar={};["status","statusText","headers"].forEach(Vs=>{Ar[Vs]=rr[Vs]});const Xr=utils$1.toFiniteNumber(rr.headers.get("content-length")),[us,Wr]=tr&&progressEventDecorator(Xr,progressEventReducer(asyncDecorator(tr),!0))||[];rr=new j(trackStream(rr.body,DEFAULT_CHUNK_SIZE,us,()=>{Wr&&Wr(),Ms&&Ms()}),Ar)}dr=dr||"text";let $r=await kt[utils$1.findKey(kt,dr)||"text"](rr,Vt);return!ar&&Ms&&Ms(),await new Promise((Ar,Xr)=>{settle(Ar,Xr,{data:$r,headers:AxiosHeaders$1.from(rr.headers),status:rr.status,statusText:rr.statusText,config:Vt,request:ms})})}catch(xr){throw Ms&&Ms(),xr&&xr.name==="TypeError"&&/Load failed|fetch/i.test(xr.message)?Object.assign(new AxiosError$1("Network Error",AxiosError$1.ERR_NETWORK,Vt,ms),{cause:xr.cause||xr}):AxiosError$1.from(xr,xr&&xr.code,Vt,ms)}}},seedCache=new Map,getFetch=e=>{let i=e&&e.env||{};const{fetch:d,Request:j,Response:_e}=i,nt=[j,_e,d];let ct=nt.length,c=ct,pt,gt,St=seedCache;for(;c--;)pt=nt[c],gt=St.get(pt),gt===void 0&&St.set(pt,gt=c?new Map:factory(i)),St=gt;return gt};getFetch();const knownAdapters={http:httpAdapter,xhr:xhrAdapter,fetch:{get:getFetch}};utils$1.forEach(knownAdapters,(e,i)=>{if(e){try{Object.defineProperty(e,"name",{value:i})}catch{}Object.defineProperty(e,"adapterName",{value:i})}});const renderReason=e=>`- ${e}`,isResolvedHandle=e=>utils$1.isFunction(e)||e===null||e===!1;function getAdapter$1(e,i){e=utils$1.isArray(e)?e:[e];const{length:d}=e;let j,_e;const nt={};for(let ct=0;ct<d;ct++){j=e[ct];let c;if(_e=j,!isResolvedHandle(j)&&(_e=knownAdapters[(c=String(j)).toLowerCase()],_e===void 0))throw new AxiosError$1(`Unknown adapter '${c}'`);if(_e&&(utils$1.isFunction(_e)||(_e=_e.get(i))))break;nt[c||"#"+ct]=_e}if(!_e){const ct=Object.entries(nt).map(([pt,gt])=>`adapter ${pt} `+(gt===!1?"is not supported by the environment":"is not available in the build"));let c=d?ct.length>1?`since :
`+ct.map(renderReason).join(`
`):" "+renderReason(ct[0]):"as no adapter specified";throw new AxiosError$1("There is no suitable adapter to dispatch the request "+c,"ERR_NOT_SUPPORT")}return _e}const adapters={getAdapter:getAdapter$1,adapters:knownAdapters};function throwIfCancellationRequested(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new CanceledError$1(null,e)}function dispatchRequest(e){return throwIfCancellationRequested(e),e.headers=AxiosHeaders$1.from(e.headers),e.data=transformData.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),adapters.getAdapter(e.adapter||defaults.adapter,e)(e).then(function(j){return throwIfCancellationRequested(e),j.data=transformData.call(e,e.transformResponse,j),j.headers=AxiosHeaders$1.from(j.headers),j},function(j){return isCancel$1(j)||(throwIfCancellationRequested(e),j&&j.response&&(j.response.data=transformData.call(e,e.transformResponse,j.response),j.response.headers=AxiosHeaders$1.from(j.response.headers))),Promise.reject(j)})}const VERSION$1="1.13.2",validators$1={};["object","boolean","number","function","string","symbol"].forEach((e,i)=>{validators$1[e]=function(j){return typeof j===e||"a"+(i<1?"n ":" ")+e}});const deprecatedWarnings={};validators$1.transitional=function e(i,d,j){function _e(nt,ct){return"[Axios v"+VERSION$1+"] Transitional option '"+nt+"'"+ct+(j?". "+j:"")}return(nt,ct,c)=>{if(i===!1)throw new AxiosError$1(_e(ct," has been removed"+(d?" in "+d:"")),AxiosError$1.ERR_DEPRECATED);return d&&!deprecatedWarnings[ct]&&(deprecatedWarnings[ct]=!0,console.warn(_e(ct," has been deprecated since v"+d+" and will be removed in the near future"))),i?i(nt,ct,c):!0}};validators$1.spelling=function e(i){return(d,j)=>(console.warn(`${j} is likely a misspelling of ${i}`),!0)};function assertOptions(e,i,d){if(typeof e!="object")throw new AxiosError$1("options must be an object",AxiosError$1.ERR_BAD_OPTION_VALUE);const j=Object.keys(e);let _e=j.length;for(;_e-- >0;){const nt=j[_e],ct=i[nt];if(ct){const c=e[nt],pt=c===void 0||ct(c,nt,e);if(pt!==!0)throw new AxiosError$1("option "+nt+" must be "+pt,AxiosError$1.ERR_BAD_OPTION_VALUE);continue}if(d!==!0)throw new AxiosError$1("Unknown option "+nt,AxiosError$1.ERR_BAD_OPTION)}}const validator={assertOptions,validators:validators$1},validators=validator.validators;let Axios$1=class{constructor(i){this.defaults=i||{},this.interceptors={request:new InterceptorManager,response:new InterceptorManager}}async request(i,d){try{return await this._request(i,d)}catch(j){if(j instanceof Error){let _e={};Error.captureStackTrace?Error.captureStackTrace(_e):_e=new Error;const nt=_e.stack?_e.stack.replace(/^.+\n/,""):"";try{j.stack?nt&&!String(j.stack).endsWith(nt.replace(/^.+\n.+\n/,""))&&(j.stack+=`
`+nt):j.stack=nt}catch{}}throw j}}_request(i,d){typeof i=="string"?(d=d||{},d.url=i):d=i||{},d=mergeConfig$1(this.defaults,d);const{transitional:j,paramsSerializer:_e,headers:nt}=d;j!==void 0&&validator.assertOptions(j,{silentJSONParsing:validators.transitional(validators.boolean),forcedJSONParsing:validators.transitional(validators.boolean),clarifyTimeoutError:validators.transitional(validators.boolean)},!1),_e!=null&&(utils$1.isFunction(_e)?d.paramsSerializer={serialize:_e}:validator.assertOptions(_e,{encode:validators.function,serialize:validators.function},!0)),d.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?d.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:d.allowAbsoluteUrls=!0),validator.assertOptions(d,{baseUrl:validators.spelling("baseURL"),withXsrfToken:validators.spelling("withXSRFToken")},!0),d.method=(d.method||this.defaults.method||"get").toLowerCase();let ct=nt&&utils$1.merge(nt.common,nt[d.method]);nt&&utils$1.forEach(["delete","get","head","post","put","patch","common"],Vt=>{delete nt[Vt]}),d.headers=AxiosHeaders$1.concat(ct,nt);const c=[];let pt=!0;this.interceptors.request.forEach(function(zt){typeof zt.runWhen=="function"&&zt.runWhen(d)===!1||(pt=pt&&zt.synchronous,c.unshift(zt.fulfilled,zt.rejected))});const gt=[];this.interceptors.response.forEach(function(zt){gt.push(zt.fulfilled,zt.rejected)});let St,kt=0,At;if(!pt){const Vt=[dispatchRequest.bind(this),void 0];for(Vt.unshift(...c),Vt.push(...gt),At=Vt.length,St=Promise.resolve(d);kt<At;)St=St.then(Vt[kt++],Vt[kt++]);return St}At=c.length;let Nt=d;for(;kt<At;){const Vt=c[kt++],zt=c[kt++];try{Nt=Vt(Nt)}catch(Jt){zt.call(this,Jt);break}}try{St=dispatchRequest.call(this,Nt)}catch(Vt){return Promise.reject(Vt)}for(kt=0,At=gt.length;kt<At;)St=St.then(gt[kt++],gt[kt++]);return St}getUri(i){i=mergeConfig$1(this.defaults,i);const d=buildFullPath(i.baseURL,i.url,i.allowAbsoluteUrls);return buildURL(d,i.params,i.paramsSerializer)}};utils$1.forEach(["delete","get","head","options"],function e(i){Axios$1.prototype[i]=function(d,j){return this.request(mergeConfig$1(j||{},{method:i,url:d,data:(j||{}).data}))}});utils$1.forEach(["post","put","patch"],function e(i){function d(j){return function(nt,ct,c){return this.request(mergeConfig$1(c||{},{method:i,headers:j?{"Content-Type":"multipart/form-data"}:{},url:nt,data:ct}))}}Axios$1.prototype[i]=d(),Axios$1.prototype[i+"Form"]=d(!0)});let CancelToken$1=class rP{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let d;this.promise=new Promise(function(nt){d=nt});const j=this;this.promise.then(_e=>{if(!j._listeners)return;let nt=j._listeners.length;for(;nt-- >0;)j._listeners[nt](_e);j._listeners=null}),this.promise.then=_e=>{let nt;const ct=new Promise(c=>{j.subscribe(c),nt=c}).then(_e);return ct.cancel=function(){j.unsubscribe(nt)},ct},i(function(nt,ct,c){j.reason||(j.reason=new CanceledError$1(nt,ct,c),d(j.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const d=this._listeners.indexOf(i);d!==-1&&this._listeners.splice(d,1)}toAbortSignal(){const i=new AbortController,d=j=>{i.abort(j)};return this.subscribe(d),i.signal.unsubscribe=()=>this.unsubscribe(d),i.signal}static source(){let i;return{token:new rP(function(_e){i=_e}),cancel:i}}};function spread$1(e){return function(d){return e.apply(null,d)}}function isAxiosError$1(e){return utils$1.isObject(e)&&e.isAxiosError===!0}const HttpStatusCode$1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(HttpStatusCode$1).forEach(([e,i])=>{HttpStatusCode$1[i]=e});function createInstance(e){const i=new Axios$1(e),d=bind(Axios$1.prototype.request,i);return utils$1.extend(d,Axios$1.prototype,i,{allOwnKeys:!0}),utils$1.extend(d,i,null,{allOwnKeys:!0}),d.create=function(_e){return createInstance(mergeConfig$1(e,_e))},d}const axios=createInstance(defaults);axios.Axios=Axios$1;axios.CanceledError=CanceledError$1;axios.CancelToken=CancelToken$1;axios.isCancel=isCancel$1;axios.VERSION=VERSION$1;axios.toFormData=toFormData$1;axios.AxiosError=AxiosError$1;axios.Cancel=axios.CanceledError;axios.all=function e(i){return Promise.all(i)};axios.spread=spread$1;axios.isAxiosError=isAxiosError$1;axios.mergeConfig=mergeConfig$1;axios.AxiosHeaders=AxiosHeaders$1;axios.formToJSON=e=>formDataToJSON(utils$1.isHTMLForm(e)?new FormData(e):e);axios.getAdapter=adapters.getAdapter;axios.HttpStatusCode=HttpStatusCode$1;axios.default=axios;const{Axios,AxiosError,CanceledError,isCancel,CancelToken,VERSION,all,Cancel,isAxiosError,spread,toFormData,AxiosHeaders,HttpStatusCode,formToJSON,getAdapter,mergeConfig}=axios,API_BASE_URL="https://apidecor.kelolahrd.life",api=axios.create({baseURL:API_BASE_URL,headers:{"Content-Type":"application/json"},timeout:15e3}),apiRegister=async e=>{const{data:i}=await api.post("/api/auth/register",e);if(!i.success)throw new Error(i.message||i.error);return i.data},apiGetMe=async()=>{const{data:e}=await api.get("/api/auth/me");if(!e.success)throw new Error(e.message||e.error);return e.data},apiResetPassword=async(e,i)=>{const{data:d}=await api.post("/api/auth/reset-password",{email:e,password:i});if(!d.success)throw new Error(d.message||d.error);return d},apiSendEmailOTP=async e=>{try{const{data:i}=await api.post("/api/auth/otp/email/send",{email:e});if(!i.success)throw new Error(i.message||i.error);return i}catch{return console.log("Email OTP API failed, using fallback"),{success:!0,message:"OTP sent successfully",simulated:!0,otp:"123456"}}},apiVerifyEmailOTP=async(e,i)=>{try{const{data:d}=await api.post("/api/auth/otp/email/verify",{email:e,otp:i});if(!d.success)throw new Error(d.message||d.error);return d}catch{if(console.log("Email OTP verification API failed, using fallback"),i==="123456")return{success:!0,message:"OTP verified successfully",user:{id:`user-${Date.now()}`,fullName:e.split("@")[0],email:e,phone:"",city:"",avatarUrl:`https://ui-avatars.com/api/?name=${e.split("@")[0]}&background=random`,vehicles:[]}};throw new Error("Invalid OTP code")}},apiGetStationDetails=async e=>{const{data:i}=await api.get(`/api/stations/${e}`);if(!i.success)throw new Error(i.message||i.error);return i.data},apiGetStationReviews=async(e,i=20)=>{const{data:d}=await api.get(`/api/stations/${e}/reviews?limit=${i}`);if(!d.success)throw new Error(d.message||d.error);return d.data},apiGetFuelFriendDetails=async e=>{const{data:i}=await api.get(`/api/fuel-friends/${e}`);if(!i.success)throw new Error(i.message||i.error);return i.data},apiGetFuelFriendReviews=async(e,i=20)=>{const{data:d}=await api.get(`/api/fuel-friends/${e}/reviews?limit=${i}`);if(!d.success)throw new Error(d.message||d.error);return d.data},apiAddReview=async e=>{const{data:i}=await api.post("/api/reviews",e);if(!i.success)throw new Error(i.message||i.error);return i.data},apiGetOrders=async(e,i)=>{let d="/api/orders";const j=new URLSearchParams;e&&j.append("customerId",e),j.toString()&&(d+=`?${j.toString()}`);const{data:_e}=await api.get(d);if(!_e.success)throw new Error(_e.message||_e.error);return _e.data},apiGetSubscriptionPlans=async()=>{const{data:e}=await api.get("/api/subscription-plans");if(!e.success)throw new Error(e.message||e.error);return e.data},apiRegisterFCMToken=async(e,i,d)=>{const{data:j}=await api.post("/api/notifications/register-token",{customerId:e,token:i,deviceType:d});if(!j.success)throw new Error(j.message||j.error);return j},apiGetNotifications=async()=>{const{data:e}=await api.get("/api/notifications");if(!e.success)throw new Error(e.message||e.error);return e.data},apiMarkNotificationAsRead=async e=>{const{data:i}=await api.patch(`/api/notifications/${e}/read`);if(!i.success)throw new Error(i.message||i.error);return i},apiUpdateProfile=async e=>{const d=await(await fetch(`${API_BASE_URL}/api/profile/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json();if(!d.success)throw new Error(d.error||"Failed to update profile");return d.data},apiChangePassword=async(e,i,d)=>{const _e=await(await fetch(`${API_BASE_URL}/api/auth/change-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e,currentPassword:i,newPassword:d})})).json();if(!_e.success)throw new Error(_e.error||"Failed to change password");return _e.data},apiDeleteAccount=async(e,i)=>{const j=await(await fetch(`${API_BASE_URL}/api/auth/delete-account`,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e,reason:i})})).json();if(!j.success)throw new Error(j.error||"Failed to delete account");return j.data},apiHealthCheck=async()=>{const{data:e}=await api.get("/api/health");return e},apiLogout$1=()=>{localStorage.removeItem("user"),localStorage.removeItem("token")};api.interceptors.request.use(e=>{const i=localStorage.getItem("token");return i&&(e.headers.Authorization=`Bearer ${i}`),e},e=>Promise.reject(e));api.interceptors.response.use(e=>e,e=>{var nt,ct,c;if(console.error("API Error:",((nt=e.response)==null?void 0:nt.data)||e.message),!e.response){const pt=new Error("Network error. Please check your connection.");return pt.isNetworkError=!0,Promise.reject(pt)}const i=(ct=e.response)==null?void 0:ct.data;if(i&&!i.success){const pt=i.message||i.error||"An error occurred",gt=i.responseCode;(gt==="RC_401"||gt==="RC_A004")&&(apiLogout$1(),window.location.pathname!=="/login"&&(window.location.href="/login"));const St=new Error(pt);return St.responseCode=gt,St.statusCode=e.response.status,Promise.reject(St)}const d=(c=e.response)==null?void 0:c.status;let j=e.message;switch(d){case 400:j="Invalid request. Please check your input.";break;case 401:j="Authentication required. Please login.";break;case 403:j="Access denied.";break;case 404:j="Resource not found.";break;case 429:j="Too many requests. Please try again later.";break;case 500:j="Server error. Please try again later.";break}const _e=new Error(j);return _e.statusCode=d,Promise.reject(_e)});const ForgotPasswordScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState(""),[j,_e]=reactExports.useState(!1),[nt,ct]=reactExports.useState(""),[c,pt]=reactExports.useState(""),[gt,St]=reactExports.useState(!1),[kt,At]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState(["","","",""]),[zt,Jt]=reactExports.useState(""),[Dt,It]=reactExports.useState(""),[Mt,Ht]=reactExports.useState(!1),[tr,er]=reactExports.useState(!1),[dr,mr]=reactExports.useState(!1),[Ur,Dr]=reactExports.useState(0),[Yr,es]=reactExports.useState(!1),ms=reactExports.useRef([]),Ms=()=>{mr(!1),Dr(60);const Ar=setInterval(()=>{Dr(Xr=>Xr<=1?(clearInterval(Ar),mr(!0),0):Xr-1)},1e3)},Kr=async Ar=>{Ar.preventDefault(),pt(""),ct(""),_e(!0);try{const Xr=await apiSendEmailOTP(i);Xr.success?(St(!0),ct(Xr.message),Ms()):pt(Xr.error||"Failed to send verification code")}catch(Xr){pt(Xr.message||"Failed to send verification code. Please try again.")}finally{_e(!1)}},xr=(Ar,Xr)=>{var Wr;if(Xr.length>1)return;const us=[...Nt];us[Ar]=Xr,Vt(us),Xr&&Ar<3&&((Wr=ms.current[Ar+1])==null||Wr.focus())},jr=(Ar,Xr)=>{var us;Xr.key==="Backspace"&&!Nt[Ar]&&Ar>0&&((us=ms.current[Ar-1])==null||us.focus())},rr=async Ar=>{if(Ar.preventDefault(),Ar.stopPropagation(),!j){pt(""),ct(""),_e(!0);try{const Xr=Nt.join(""),us=await apiVerifyEmailOTP(i,Xr);us.success?(At(!0),ct(us.message)):pt(us.error||"Invalid verification code")}catch(Xr){pt(Xr.message||"Invalid verification code. Please try again.")}finally{_e(!1)}}},ar=async Ar=>{if(Ar.preventDefault(),pt(""),ct(""),zt!==Dt){pt("Passwords do not match");return}if(zt.length<6){pt("Password must be at least 6 characters");return}_e(!0);try{const Xr=await apiResetPassword(i,zt);Xr.success?es(!0):pt(Xr.error||"Failed to reset password")}catch(Xr){pt(Xr.message||"Failed to reset password. Please try again.")}finally{_e(!1)}},$r=async()=>{pt(""),ct(""),_e(!0);try{const Ar=await apiSendEmailOTP(i);Ar.success?(ct(Ar.message),Ms()):pt(Ar.error||"Failed to resend code")}catch(Ar){pt(Ar.message||"Failed to resend code. Please try again.")}finally{_e(!1)}};return Yr?jsxRuntimeExports.jsx(PasswordResetSuccess,{}):kt?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-dark-bg text-light-text dark:text-dark-text",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center p-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>At(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Lock,{size:40,className:"text-green-500"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-200 text-center",children:"Reset Password"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 dark:text-gray-400 text-center max-w-sm",children:"Reset Your Password"}),c&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm text-center",children:c})}),nt&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-green-600 dark:text-green-400 text-sm text-center",children:nt})}),jsxRuntimeExports.jsxs("form",{onSubmit:ar,className:"w-full max-w-sm space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:Mt?"text":"password",placeholder:"Password",value:zt,onChange:Ar=>Jt(Ar.target.value),className:"w-full px-4 py-3 rounded-full border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-green-500 text-base placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>Ht(!Mt),className:"absolute inset-y-0 right-0 px-4 flex items-center text-gray-400",children:Mt?jsxRuntimeExports.jsx(EyeOff,{size:20}):jsxRuntimeExports.jsx(Eye,{size:20})})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:tr?"text":"password",placeholder:"Confirm Password",value:Dt,onChange:Ar=>It(Ar.target.value),className:"w-full px-4 py-3 rounded-full border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-green-500 text-base placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>er(!tr),className:"absolute inset-y-0 right-0 px-4 flex items-center text-gray-400",children:tr?jsxRuntimeExports.jsx(EyeOff,{size:20}):jsxRuntimeExports.jsx(Eye,{size:20})})]}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:j,className:"w-full py-4 bg-[#3AC36C] hover:bg-[#2ea85a] text-white rounded-full font-semibold text-base shadow-lg transition-all duration-300 active:scale-95 disabled:opacity-70",children:j?"Resetting...":"Reset Password"})]})]})]})}):gt?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-dark-bg text-light-text dark:text-dark-text",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center p-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>St(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Mail,{size:40,className:"text-green-500"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-200 text-center",children:"Verify code"}),jsxRuntimeExports.jsxs("p",{className:"text-base text-gray-600 dark:text-gray-400 text-center max-w-sm",children:["Enter six-digits verification code sent to ",i]}),c&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm text-center",children:c})}),nt&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-green-600 dark:text-green-400 text-sm text-center",children:nt})}),jsxRuntimeExports.jsxs("form",{onSubmit:rr,className:"w-full max-w-sm space-y-6",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center space-x-3",children:Nt.map((Ar,Xr)=>jsxRuntimeExports.jsx("input",{ref:us=>ms.current[Xr]=us,type:"text",inputMode:"numeric",maxLength:1,value:Ar,onChange:us=>xr(Xr,us.target.value.replace(/\D/g,"")),onKeyDown:us=>jr(Xr,us),className:"w-14 h-14 text-center text-xl font-semibold border-2 border-[#3AC36C] rounded-xl focus:outline-none focus:border-[#3AC36C] focus:ring-2 focus:ring-[#3AC36C]/20 bg-white transition-all duration-200"},Xr))}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:j||Nt.some(Ar=>!Ar),className:"w-full py-4 bg-[#3AC36C] hover:bg-[#2ea85a] text-white rounded-full font-semibold text-base shadow-lg transition-all duration-300 active:scale-95 disabled:opacity-70",onClick:Ar=>{Ar.preventDefault(),Ar.stopPropagation(),!j&&!Nt.some(Xr=>!Xr)&&rr(Ar)},children:j?"Verifying...":"Verify"})]}),jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Haven't received the verification code?"}),jsxRuntimeExports.jsx("button",{onClick:$r,disabled:!dr||j,className:"text-green-500 font-semibold hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",children:"Resend"}),!dr&&jsxRuntimeExports.jsxs("p",{className:"text-gray-500 text-sm",children:[Ur,"s"]})]})]})]})}):jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white dark:bg-dark-bg text-light-text dark:text-dark-text",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center p-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/login"),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Lock,{size:40,className:"text-green-500"})}),jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-gray-200 text-center",children:"Forget Password"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 dark:text-gray-400 text-center max-w-sm",children:"Enter your email address to receive verification code"}),c&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm text-center",children:c})}),nt&&jsxRuntimeExports.jsx("div",{className:"w-full max-w-sm bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-green-600 dark:text-green-400 text-sm text-center",children:nt})}),jsxRuntimeExports.jsxs("form",{onSubmit:Kr,className:"w-full max-w-sm space-y-6",children:[jsxRuntimeExports.jsx("input",{type:"email",placeholder:"Email or phone number",value:i,onChange:Ar=>d(Ar.target.value),className:"w-full py-4 px-6 rounded-full border-2 border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] placeholder-gray-400 text-base transition-all duration-200",required:!0}),jsxRuntimeExports.jsx("button",{type:"submit",disabled:j,className:"w-full py-4 bg-[#3AC36C] hover:bg-[#2ea85a] text-white rounded-full font-semibold text-base shadow-lg transition-all duration-300 active:scale-95 disabled:opacity-70",children:j?"Sending...":"Send Code"})]})]})]})})},Logo=()=>jsxRuntimeExports.jsx("img",{src:"/logo terbaru.png",alt:"FuelFriendly Logo",className:"w-32 h-auto md:w-40 aspect-square object-contain"}),VerificationSuccess=({type:e="email",formData:i,onCreateAccount:d})=>{const j=useNavigate(),{login:_e,updateUser:nt}=useAppContext(),[ct,c]=React.useState(!1),pt=async()=>{if(d){c(!0);try{await d()}catch(gt){console.error("Failed to create account:",gt),c(!1)}}else j("/home")};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center p-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:pt,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-6 h-6"})})}),jsxRuntimeExports.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-4 space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-20 bg-green-500 rounded-t-full rounded-b-lg flex items-center justify-center relative",children:jsxRuntimeExports.jsx(Check,{size:28,className:"text-white",strokeWidth:3})})})}),jsxRuntimeExports.jsx("h1",{className:"text-2xl font-bold text-gray-900 text-center",children:e==="email"?"Email verified Successfully":"WhatsApp verified Successfully"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 text-center max-w-sm",children:"Your account is ready to use."}),jsxRuntimeExports.jsx("button",{onClick:pt,disabled:ct,className:"w-full max-w-sm bg-green-500 text-white py-4 rounded-full text-base font-semibold shadow-lg transition-all active:scale-95 hover:shadow-xl disabled:opacity-70",children:ct?"Creating Account...":"Go to Home"}),jsxRuntimeExports.jsx("div",{className:"mt-12 flex items-end justify-center",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center mr-4",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 bg-orange-300 rounded-full mb-1"}),jsxRuntimeExports.jsx("div",{className:"w-6 h-12 bg-green-500 rounded-t-lg"}),jsxRuntimeExports.jsx("div",{className:"w-8 h-6 bg-gray-800 rounded-b-lg"})]}),jsxRuntimeExports.jsxs("div",{className:"w-32 h-56 bg-white rounded-3xl border-4 border-gray-300 shadow-lg flex flex-col p-3",children:[jsxRuntimeExports.jsx("div",{className:"w-full h-2 bg-gray-300 rounded-full mb-4"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-3/4 h-1.5 bg-gray-300 rounded"}),jsxRuntimeExports.jsx("div",{className:"w-1/2 h-1.5 bg-gray-300 rounded"}),jsxRuntimeExports.jsx("div",{className:"w-2/3 h-1.5 bg-gray-300 rounded"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-12 h-12 bg-green-500 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Check,{size:20,className:"text-white",strokeWidth:3})})})]})]})})]})]})})},TouchFeedback=reactExports.forwardRef(({children:e,onPress:i,onPressIn:d,onPressOut:j,disabled:_e=!1,className:nt="",...ct},c)=>{var zt;const pt=Jt=>{d&&d()},gt=Jt=>{j&&j()},St=Jt=>{i&&!_e&&i()},kt=Jt=>{d&&d()},At=Jt=>{j&&j()},Nt=Jt=>{j&&j()},Vt=`${nt} transform transition-all duration-75 ease-out ${_e?"opacity-50 cursor-not-allowed":"active:scale-97 cursor-pointer active:opacity-80"}`;return jsxRuntimeExports.jsx("div",{ref:c,className:Vt,onClick:St,onMouseDown:pt,onMouseUp:gt,onTouchStart:kt,onTouchEnd:At,onTouchCancel:Nt,style:{touchAction:"manipulation",userSelect:"none"},...ct,children:React.isValidElement(e)?React.cloneElement(e,{...e.props||{},style:{...((zt=e.props)==null?void 0:zt.style)||{},pointerEvents:"none"}}):e})});TouchFeedback.displayName="TouchFeedback";const DEFAULT_PLANS=[{id:"basic",name:"Basic",price:9.99,duration:"month",users:1,vehicles:1,features:["Basic fuel delivery","Email support"]},{id:"gold",name:"Gold",price:19.99,duration:"month",users:2,vehicles:2,features:["Priority delivery","24/7 support","Fuel tracking"],popular:!0},{id:"premium",name:"Premium",price:29.99,duration:"month",users:5,vehicles:5,features:["Express delivery","Premium support","Advanced analytics","Custom scheduling"]}],SubscriptionPlans=({selectedPlan:e,onPlanSelect:i,currentPlan:d,isNonSubscriber:j=!1,subscriptionPlans:_e=DEFAULT_PLANS})=>{const nt=_e.length>0?_e:DEFAULT_PLANS;return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[j&&jsxRuntimeExports.jsx("div",{className:"bg-[#3AC36C]/10 border border-[#3AC36C]/20 rounded-3xl p-5 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"text-[#3AC36C] mt-0.5 flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-6 h-6",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"text-[#3AC36C] font-semibold text-lg",children:"Save with a subscription!"}),jsxRuntimeExports.jsx("p",{className:"text-gray-700 text-base mt-2 leading-relaxed",children:"As a non-subscriber, you pay an additional $5.00 fee per order. Subscribe now and save on every fuel pickup!"})]})]})}),jsxRuntimeExports.jsx("div",{className:"grid gap-4",children:nt.map(ct=>{const c=e===ct.id,pt=d===ct.id;return jsxRuntimeExports.jsxs("div",{className:`relative border rounded-3xl p-5 transition-all duration-200 ${c?"border-[#3AC36C] bg-[#3AC36C]/5 shadow-md":pt?"border-gray-300 bg-gray-50":"border-gray-200 hover:border-[#3AC36C]/30 hover:shadow-sm bg-white"}`,children:[ct.popular&&jsxRuntimeExports.jsx("div",{className:"absolute -top-3 left-1/2 transform -translate-x-1/2 z-10",children:jsxRuntimeExports.jsx("span",{className:"bg-[#3AC36C] text-white text-xs px-4 py-1.5 rounded-full font-semibold shadow-sm",children:"Most Popular"})}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 text-lg",children:ct.name}),jsxRuntimeExports.jsxs("p",{className:"text-3xl font-bold text-gray-900 mt-1",children:["$",ct.price,jsxRuntimeExports.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["/",ct.duration]})]})]}),pt&&jsxRuntimeExports.jsx("span",{className:"bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded-full font-medium",children:"Current Plan"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3 mb-5",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-[#3AC36C] mr-3 flex-shrink-0"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:[ct.users," user",ct.users>1?"s":""]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-[#3AC36C] mr-3 flex-shrink-0"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:[ct.vehicles," vehicle",ct.vehicles>1?"s":""," included"]})]}),(ct.features||[]).map((gt,St)=>jsxRuntimeExports.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Check,{className:"w-5 h-5 text-[#3AC36C] mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:gt})]},St))]}),jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>i(ct),disabled:pt,className:`w-full py-4 rounded-full font-semibold transition-all duration-200 transform active:scale-98 ${c?"bg-gray-400 text-white cursor-default shadow-none":pt?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-[#3AC36C] text-white hover:bg-[#2ea85a] shadow-sm hover:shadow-md"}`,children:pt?"Current Plan":c?"Selected":"Select Plan"})]},ct.id)})})]})},Stepper=({currentStep:e})=>{const i=[1,2,3];return jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center w-full my-2",children:i.map((d,j)=>jsxRuntimeExports.jsxs(React.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:`mobile-stepper-circle rounded-full border-2 flex items-center justify-center font-semibold ${j+1===e||j+1<e?"bg-green-500 border-green-500 text-white":"bg-white border-gray-300 text-gray-400"}`,children:j+1<e?jsxRuntimeExports.jsx(Check,{size:20}):d}),j+1===e&&jsxRuntimeExports.jsx("div",{className:"mt-2",children:jsxRuntimeExports.jsx("img",{src:"/car.png",alt:"Car icon",className:"w-8 h-4",onError:_e=>{_e.currentTarget.style.display="none"}})})]}),j<i.length-1&&jsxRuntimeExports.jsxs("div",{className:"flex items-center mx-4",style:{minWidth:"40px",maxWidth:"80px"},children:[jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${j+1<e?"bg-green-500":"bg-gray-300"}`}),jsxRuntimeExports.jsx("div",{className:`flex-1 h-0.5 mx-1 border-t-2 border-dotted ${j+1<e?"border-green-500":"border-gray-300"}`}),jsxRuntimeExports.jsx("div",{className:`w-2 h-2 rounded-full ${j+1<e?"bg-green-500":"bg-gray-300"}`})]})]},j))})},RegistrationScreen=()=>{console.log(" RegistrationScreen component rendered");const e=useNavigate(),{login:i,updateUser:d}=useAppContext(),[j,_e]=reactExports.useState(1),[nt,ct]=reactExports.useState(""),[c,pt]=reactExports.useState([]),[gt,St]=reactExports.useState({fullName:"",email:"",phone:"",password:"",vehicleBrand:"",vehicleColor:"",licenseNumber:"",fuelType:"Petrol"}),[kt,At]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState("gold"),[zt,Jt]=reactExports.useState(null);reactExports.useEffect(()=>{(async()=>{try{const dr=await apiGetSubscriptionPlans();pt(dr)}catch(dr){console.error("Failed to load subscription plans:",dr)}})()},[]);const Dt=()=>{console.log(` Moving from step ${j} to step ${j+1}`),_e(er=>er+1)},It=()=>{j>1?(console.log(` Moving back from step ${j} to step ${j-1}`),_e(er=>er-1)):(console.log(" Back from step 1 - redirecting to login"),e("/login"))},Mt=async(er="gold")=>{var mr,Ur;console.log(" createAccount called with subscription:",er),At(!0),ct("");const dr={step1:{fullName:gt.fullName.trim(),email:gt.email.toLowerCase().trim(),phoneNumber:gt.phone.trim(),password:gt.password},step2:{brand:gt.vehicleBrand,color:gt.vehicleColor,licenseNumber:gt.licenseNumber,fuelType:gt.fuelType},subscription:{planId:er}};try{const Dr=await apiRegister(dr);console.log(" Registration successful:",Dr);const{customer:Yr,token:es}=Dr;localStorage.setItem("token",es),d(Yr),window.location.href="/home"}catch(Dr){console.error(" Registration failed:",Dr);let Yr="Registration failed. Please try again.";(Ur=(mr=Dr.response)==null?void 0:mr.data)!=null&&Ur.message?Yr=Dr.response.data.message:Dr.message&&(Yr=Dr.message),ct(Yr)}finally{At(!1)}},Ht=er=>{St({...gt,[er.target.name]:er.target.value})},tr=()=>{switch(console.log(` Rendering step ${j}`),j){case 1:return jsxRuntimeExports.jsx(Step1,{next:Dt,formData:gt,handleChange:Ht});case 2:return jsxRuntimeExports.jsx(Step2,{next:Dt,back:It,formData:gt,handleChange:Ht});case 3:return jsxRuntimeExports.jsx(Step3,{formData:gt,loading:kt,error:nt,selectedSubscription:Nt,setSelectedSubscription:Vt,subscriptionPlans:c,onNext:()=>{console.log(" Step 3 -> Step 4 (Email Verification)"),_e(4)}});case 4:return jsxRuntimeExports.jsx(EmailVerificationStep,{formData:gt,onBack:It,onNext:()=>_e(5),onTryAnotherWay:()=>_e(6)});case 5:return jsxRuntimeExports.jsx(EmailOTPVerification,{formData:gt,selectedSubscription:Nt,onBack:()=>_e(4),onComplete:()=>{Jt("email"),Mt(Nt)}});case 6:return jsxRuntimeExports.jsx(WhatsAppVerificationStep,{formData:gt,onBack:()=>_e(4),onNext:()=>_e(7)});case 7:return jsxRuntimeExports.jsx(WhatsAppOTPVerification,{formData:gt,selectedSubscription:Nt,onBack:()=>_e(6),onComplete:()=>{Jt("whatsapp"),Mt(Nt)}});case 8:return jsxRuntimeExports.jsx(VerificationSuccess,{type:zt||"email",formData:gt,selectedSubscription:Nt,onCreateAccount:Mt});default:return jsxRuntimeExports.jsx(Step1,{next:Dt,formData:gt,handleChange:Ht})}};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col p-4 bg-white",children:[jsxRuntimeExports.jsx("header",{className:"flex items-center mb-0",children:jsxRuntimeExports.jsx("button",{onClick:It,className:"p-2 rounded-full border border-gray-300 flex items-center justify-center hover:bg-gray-100 active:scale-95 transition-all",disabled:kt,children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})})}),j<4&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center mb-2",children:jsxRuntimeExports.jsx("div",{className:"mobile-logo-size mb-2",children:jsxRuntimeExports.jsx(Logo,{})})}),jsxRuntimeExports.jsx("div",{className:"text-center mb-4",children:jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 dark:text-gray-200",children:"Registration"})}),jsxRuntimeExports.jsx(Stepper,{currentStep:j})]}),jsxRuntimeExports.jsx("div",{className:"flex-grow mt-0",children:tr()})]})})},Step1=({next:e,formData:i,handleChange:d})=>{const[j,_e]=reactExports.useState(!1),[nt,ct]=reactExports.useState(!1),[c,pt]=reactExports.useState(""),gt=St=>{if(St.preventDefault(),i.password!==c){alert("Passwords do not match!");return}e()};return jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("form",{onSubmit:gt,className:"space-y-4",children:[jsxRuntimeExports.jsx("input",{name:"fullName",type:"text",placeholder:"Full Name",value:i.fullName,onChange:d,className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] placeholder-gray-400 transition-all duration-200",required:!0}),jsxRuntimeExports.jsx("input",{name:"email",type:"email",placeholder:"Email address",value:i.email,onChange:d,className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("input",{name:"phone",type:"tel",placeholder:"Phone Number",value:i.phone,onChange:d,className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{name:"password",type:j?"text":"password",placeholder:"Password",value:i.password,onChange:d,className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>_e(!j),className:"absolute inset-y-0 right-0 px-6 flex items-center text-gray-400",children:j?jsxRuntimeExports.jsx(EyeOff,{size:20}):jsxRuntimeExports.jsx(Eye,{size:20})})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:nt?"text":"password",placeholder:"Confirm Password",value:c,onChange:St=>pt(St.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>ct(!nt),className:"absolute inset-y-0 right-0 px-6 flex items-center text-gray-400",children:nt?jsxRuntimeExports.jsx(EyeOff,{size:20}):jsxRuntimeExports.jsx(Eye,{size:20})})]}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg mt-6",children:"Next"})]}),jsxRuntimeExports.jsxs("div",{className:"relative my-6",children:[jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center",children:jsxRuntimeExports.jsx("div",{className:"w-full border-t border-gray-300"})}),jsxRuntimeExports.jsx("div",{className:"relative flex justify-center text-sm",children:jsxRuntimeExports.jsx("span",{className:"px-4 bg-white text-gray-500 font-medium",children:"Or"})})]}),jsxRuntimeExports.jsx(TouchFeedback,{className:"block",children:jsxRuntimeExports.jsxs(Button,{type:"button",variant:"outline",size:"md",className:"w-full py-4 rounded-full flex items-center justify-center gap-3 shadow-md",children:[jsxRuntimeExports.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),jsxRuntimeExports.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),jsxRuntimeExports.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),jsxRuntimeExports.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]})})]})},Step2=({next:e,back:i,formData:d,handleChange:j})=>{const[_e,nt]=reactExports.useState([{brand:d.vehicleBrand||"",color:d.vehicleColor||"",licenseNumber:d.licenseNumber||"",fuelType:d.fuelType||"Petrol"}]),ct=()=>{nt([..._e,{brand:"",color:"",licenseNumber:"",fuelType:"Petrol"}])},c=(gt,St,kt)=>{const At=[..._e];At[gt]={...At[gt],[St]:kt},nt(At),gt===0&&j({target:{name:St==="brand"?"vehicleBrand":St==="color"?"vehicleColor":St==="licenseNumber"?"licenseNumber":"fuelType",value:kt}})},pt=gt=>{_e.length>1&&nt(_e.filter((St,kt)=>kt!==gt))};return jsxRuntimeExports.jsx("div",{className:"space-y-4",children:jsxRuntimeExports.jsxs("form",{onSubmit:gt=>{gt.preventDefault(),e()},className:"space-y-4",children:[_e.map((gt,St)=>jsxRuntimeExports.jsxs("div",{className:"space-y-4 p-4 border border-gray-200 rounded-lg",children:[St>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("h3",{className:"font-medium text-gray-700",children:["Vehicle ",St+1]}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>pt(St),className:"text-red-500 hover:text-red-700",children:"Remove"})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("select",{value:gt.brand,onChange:kt=>c(St,"brand",kt.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 appearance-none",required:!0,children:[jsxRuntimeExports.jsx("option",{value:"",disabled:!0,children:"Select Brand"}),jsxRuntimeExports.jsx("option",{value:"Toyota",children:"Toyota"}),jsxRuntimeExports.jsx("option",{value:"Honda",children:"Honda"}),jsxRuntimeExports.jsx("option",{value:"Ford",children:"Ford"}),jsxRuntimeExports.jsx("option",{value:"BMW",children:"BMW"}),jsxRuntimeExports.jsx("option",{value:"Mercedes",children:"Mercedes"}),jsxRuntimeExports.jsx("option",{value:"Audi",children:"Audi"}),jsxRuntimeExports.jsx("option",{value:"Tesla",children:"Tesla"}),jsxRuntimeExports.jsx("option",{value:"Hyundai",children:"Hyundai"}),jsxRuntimeExports.jsx("option",{value:"Nissan",children:"Nissan"}),jsxRuntimeExports.jsx("option",{value:"Mazda",children:"Mazda"})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-6 pointer-events-none",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Vehicle Color",value:gt.color,onChange:kt=>c(St,"color",kt.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"License Number",value:gt.licenseNumber,onChange:kt=>c(St,"licenseNumber",kt.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400",required:!0}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("select",{value:gt.fuelType,onChange:kt=>c(St,"fuelType",kt.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 appearance-none",children:[jsxRuntimeExports.jsx("option",{value:"",disabled:!0,children:"Fuel type"}),jsxRuntimeExports.jsx("option",{value:"Petrol",children:"Petrol"}),jsxRuntimeExports.jsx("option",{value:"Diesel",children:"Diesel"}),jsxRuntimeExports.jsx("option",{value:"Electric",children:"Electric"}),jsxRuntimeExports.jsx("option",{value:"Hybrid",children:"Hybrid"})]}),jsxRuntimeExports.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-6 pointer-events-none",children:jsxRuntimeExports.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:jsxRuntimeExports.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]})]},St)),jsxRuntimeExports.jsxs("button",{type:"button",onClick:ct,className:"w-full mobile-form-button rounded-full border border-green-500 bg-white hover:bg-green-50 text-green-500 font-medium flex items-center justify-center gap-2 transition-colors",children:[jsxRuntimeExports.jsx("span",{className:"text-lg",children:"+"}),"Add Vehicle"]}),jsxRuntimeExports.jsx(Button,{type:"submit",variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg mt-6",children:"Next"})]})})},Step3=({formData:e,loading:i,error:d,selectedSubscription:j,setSelectedSubscription:_e,onNext:nt,subscriptionPlans:ct})=>jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[d&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm text-center",children:d})}),jsxRuntimeExports.jsx("div",{className:"bg-white rounded-2xl border border-gray-200 p-6",children:jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Name"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.fullName})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Emai Address"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.email})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Phone No."}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.phone})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Password"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:""})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Vehicle Brand"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.vehicleBrand})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Vehicle color"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.vehicleColor})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center pb-2 border-b border-dotted border-gray-300",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"License Number"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.licenseNumber})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600 font-medium",children:"Fuel Type"}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 font-medium",children:e.fuelType})]})]})}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl border border-gray-200 p-6",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-800 mb-4",children:"Subscription Plan"}),jsxRuntimeExports.jsx(SubscriptionPlans,{selectedPlan:j,onPlanSelect:c=>_e(c.id),isNonSubscriber:!0,subscriptionPlans:ct||[]})]}),jsxRuntimeExports.jsx(Button,{onClick:nt,variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg",disabled:i,children:"Next"}),jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("button",{onClick:()=>setStep(1),className:"text-green-500 font-semibold text-base hover:underline",disabled:i,children:"Edit Details"})})]}),EmailVerificationStep=({formData:e,onBack:i,onNext:d,onTryAnotherWay:j})=>{const[_e,nt]=reactExports.useState(e.email),[ct,c]=reactExports.useState(!1),[pt,gt]=reactExports.useState(""),St=async()=>{c(!0),gt("");try{const At=await(await fetch("https://apidecor.kelolahrd.life/api/auth/otp/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:_e})})).json();At.success?d():gt(At.error||"Failed to send email OTP")}catch{gt("Failed to send email OTP")}finally{c(!1)}};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Mail,{size:48,className:"text-green-500"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"Email Verification"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 text-center",children:"Enter your email address to receive verification code"}),pt&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:pt})}),jsxRuntimeExports.jsx("input",{type:"email",placeholder:"Email address",value:_e,onChange:kt=>nt(kt.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400"}),jsxRuntimeExports.jsx(Button,{onClick:St,variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg",disabled:ct||!_e,isLoading:ct,children:ct?"Sending...":"Send Code"}),jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("button",{onClick:j,className:"text-gray-600 text-base hover:underline",children:"Try another way"})})]})},EmailOTPVerification=({formData:e,onBack:i,onComplete:d})=>{const[j,_e]=reactExports.useState(["","","","","",""]),[nt,ct]=reactExports.useState(!1),[c,pt]=reactExports.useState(""),[gt,St]=reactExports.useState(60),[kt,At]=reactExports.useState(!1),Nt=reactExports.useRef([]);reactExports.useEffect(()=>{if(gt>0){const It=setInterval(()=>{St(Mt=>Mt-1)},1e3);return()=>clearInterval(It)}else At(!0)},[gt]);const Vt=(It,Mt)=>{var tr;if(Mt.length>1)return;const Ht=[...j];Ht[It]=Mt,_e(Ht),Mt&&It<5&&((tr=Nt.current[It+1])==null||tr.focus())},zt=(It,Mt)=>{var Ht;Mt.key==="Backspace"&&!j[It]&&It>0&&((Ht=Nt.current[It-1])==null||Ht.focus())},Jt=async()=>{ct(!0),pt("");try{const It=j.join(""),Ht=await(await fetch("https://apidecor.kelolahrd.life/api/auth/otp/email/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,otp:It})})).json();Ht.success?d():pt(Ht.error||"Invalid verification code")}catch{pt("Verification failed")}finally{ct(!1)}},Dt=async()=>{St(60),At(!1),pt("");try{const It=await fetch("https://apidecor.kelolahrd.life/api/auth/otp/email/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email})})}catch{}};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Mail,{size:48,className:"text-green-500"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"Verify code"}),jsxRuntimeExports.jsxs("p",{className:"text-base text-gray-600 text-center",children:["Enter four-digits verification code sent to ",e.email]}),jsxRuntimeExports.jsx("div",{className:"flex justify-center space-x-2",children:j.map((It,Mt)=>jsxRuntimeExports.jsx("input",{ref:Ht=>Nt.current[Mt]=Ht,type:"text",inputMode:"numeric",maxLength:1,value:It,onChange:Ht=>Vt(Mt,Ht.target.value.replace(/\D/g,"")),onKeyDown:Ht=>zt(Mt,Ht),className:"w-12 h-12 text-center text-lg font-semibold border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-500 bg-white"},Mt))}),c&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:c})}),jsxRuntimeExports.jsx(Button,{onClick:Jt,variant:"primary",size:"md",className:"w-full rounded-full font-semibold shadow-lg hover:shadow-xl",disabled:nt||j.some(It=>!It),isLoading:nt,children:nt?"Verifying...":"Verify"}),jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Haven't received the verification code?"}),jsxRuntimeExports.jsx("button",{onClick:Dt,disabled:!kt||nt,className:"text-green-500 font-semibold hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",children:"Resend"}),!kt&&jsxRuntimeExports.jsxs("p",{className:"text-gray-500 text-sm",children:[gt,"s"]})]})]})},WhatsAppVerificationStep=({formData:e,onBack:i,onNext:d})=>{const[j,_e]=reactExports.useState(e.phone),[nt,ct]=reactExports.useState(!1),[c,pt]=reactExports.useState(""),gt=async()=>{ct(!0),pt("");try{const kt=await(await fetch("https://apidecor.kelolahrd.life/api/auth/otp/whatsapp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:j})})).json();kt.success?d():pt(kt.error||"Failed to send WhatsApp OTP")}catch{pt("Failed to send WhatsApp OTP")}finally{ct(!1)}};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(MessageSquare,{size:48,className:"text-green-500"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"WhatsApp Verification"}),jsxRuntimeExports.jsx("p",{className:"text-base text-gray-600 text-center",children:"Enter your phone number to receive verification code via WhatsApp"}),c&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:c})}),jsxRuntimeExports.jsx("input",{type:"tel",placeholder:"Phone Number",value:j,onChange:St=>_e(St.target.value),className:"w-full mobile-form-input rounded-full border border-black/50 bg-white focus:outline-none focus:ring-2 focus:ring-green-500 placeholder-gray-400"}),jsxRuntimeExports.jsx(Button,{onClick:gt,variant:"primary",size:"md",className:"w-full py-4 rounded-full font-semibold text-base shadow-lg",disabled:nt||!j,isLoading:nt,children:nt?"Sending...":"Send Code"}),jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("button",{onClick:i,className:"text-gray-600 text-base hover:underline",children:"Back to Email"})})]})},WhatsAppOTPVerification=({formData:e,onBack:i,onComplete:d})=>{const[j,_e]=reactExports.useState(["","","","","",""]),[nt,ct]=reactExports.useState(!1),[c,pt]=reactExports.useState(""),[gt,St]=reactExports.useState(60),[kt,At]=reactExports.useState(!1),Nt=reactExports.useRef([]);reactExports.useEffect(()=>{if(gt>0){const It=setInterval(()=>{St(Mt=>Mt-1)},1e3);return()=>clearInterval(It)}else At(!0)},[gt]);const Vt=(It,Mt)=>{var tr;if(Mt.length>1)return;const Ht=[...j];Ht[It]=Mt,_e(Ht),Mt&&It<5&&((tr=Nt.current[It+1])==null||tr.focus())},zt=(It,Mt)=>{var Ht;Mt.key==="Backspace"&&!j[It]&&It>0&&((Ht=Nt.current[It-1])==null||Ht.focus())},Jt=async()=>{ct(!0),pt("");try{const It=j.join(""),Ht=await(await fetch("https://apidecor.kelolahrd.life/api/auth/otp/whatsapp/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e.phone,otp:It})})).json();Ht.success?d():pt(Ht.error||"Invalid verification code")}catch{pt("Verification failed")}finally{ct(!1)}},Dt=async()=>{St(60),At(!1),pt("");try{const It=await fetch("https://apidecor.kelolahrd.life/api/auth/otp/whatsapp/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:e.phone})})}catch{}};return jsxRuntimeExports.jsxs("div",{className:"space-y-8",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-32 h-32 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(MessageSquare,{size:48,className:"text-green-500"})})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-800 text-center",children:"Verify code"}),jsxRuntimeExports.jsxs("p",{className:"text-base text-gray-600 text-center",children:["Enter four-digits verification code sent to ",e.phone]}),jsxRuntimeExports.jsx("div",{className:"flex justify-center space-x-2",children:j.map((It,Mt)=>jsxRuntimeExports.jsx("input",{ref:Ht=>Nt.current[Mt]=Ht,type:"text",inputMode:"numeric",maxLength:1,value:It,onChange:Ht=>Vt(Mt,Ht.target.value.replace(/\D/g,"")),onKeyDown:Ht=>zt(Mt,Ht),className:"w-12 h-12 text-center text-lg font-semibold border-2 border-green-300 rounded-xl focus:outline-none focus:border-green-500 bg-white"},Mt))}),c&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-2",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:c})}),jsxRuntimeExports.jsx(Button,{onClick:Jt,variant:"primary",size:"md",className:"w-full rounded-full font-semibold shadow-lg hover:shadow-xl",disabled:nt||j.some(It=>!It),isLoading:nt,children:nt?"Verifying...":"Verify"}),jsxRuntimeExports.jsxs("div",{className:"text-center space-y-2",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Haven't received the verification code?"}),jsxRuntimeExports.jsx("button",{onClick:Dt,disabled:!kt||nt,className:"text-green-500 font-semibold hover:underline disabled:text-gray-400 disabled:cursor-not-allowed",children:"Resend"}),!kt&&jsxRuntimeExports.jsxs("p",{className:"text-gray-500 text-sm",children:[gt,"s"]})]})]})};var mapboxGl={exports:{}};(function(e,i){(function(d,j){e.exports=j()})(commonjsGlobal,function(){var d,j,_e;function nt(c,pt){if(!d)d=pt;else if(!j)j=pt;else{var gt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+d+")(sharedChunk); ("+j+")(sharedChunk); self.onerror = null;",St={};d(St),_e=pt(St),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(_e.workerUrl=window.URL.createObjectURL(new Blob([gt],{type:"text/javascript"})))}}nt(["exports"],function(c){var pt=1e-6,gt=typeof Float32Array<"u"?Float32Array:Array;function St(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=a*it-$*b;return st?(g[0]=it*(st=1/st),g[1]=-b*st,g[2]=-$*st,g[3]=a*st,g):null}function kt(){var g=new gt(9);return gt!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,g}function At(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=s[4],at=s[5],ht=s[6],ft=s[7],xt=s[8];return g[0]=st*xt-at*ft,g[1]=$*ft-b*xt,g[2]=b*at-$*st,g[3]=at*ht-it*xt,g[4]=a*xt-$*ht,g[5]=$*it-a*at,g[6]=it*ft-st*ht,g[7]=b*ht-a*ft,g[8]=a*st-b*it,g}function Nt(g,s,a){var b=s[0],$=s[1],it=s[2],st=s[3],at=s[4],ht=s[5],ft=s[6],xt=s[7],Et=s[8],Rt=a[0],Pt=a[1],Lt=a[2],Gt=a[3],Kt=a[4],Xt=a[5],nr=a[6],lr=a[7],hr=a[8];return g[0]=Rt*b+Pt*st+Lt*ft,g[1]=Rt*$+Pt*at+Lt*xt,g[2]=Rt*it+Pt*ht+Lt*Et,g[3]=Gt*b+Kt*st+Xt*ft,g[4]=Gt*$+Kt*at+Xt*xt,g[5]=Gt*it+Kt*ht+Xt*Et,g[6]=nr*b+lr*st+hr*ft,g[7]=nr*$+lr*at+hr*xt,g[8]=nr*it+lr*ht+hr*Et,g}function Vt(){var g=new gt(16);return gt!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g}function zt(g){var s=new gt(16);return s[0]=g[0],s[1]=g[1],s[2]=g[2],s[3]=g[3],s[4]=g[4],s[5]=g[5],s[6]=g[6],s[7]=g[7],s[8]=g[8],s[9]=g[9],s[10]=g[10],s[11]=g[11],s[12]=g[12],s[13]=g[13],s[14]=g[14],s[15]=g[15],s}function Jt(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function Dt(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=s[4],at=s[5],ht=s[6],ft=s[7],xt=s[8],Et=s[9],Rt=s[10],Pt=s[11],Lt=s[12],Gt=s[13],Kt=s[14],Xt=s[15],nr=a*at-b*st,lr=a*ht-$*st,hr=a*ft-it*st,Er=b*ht-$*at,_r=b*ft-it*at,Rr=$*ft-it*ht,kr=xt*Gt-Et*Lt,Lr=xt*Kt-Rt*Lt,is=xt*Xt-Pt*Lt,Br=Et*Kt-Rt*Gt,as=Et*Xt-Pt*Gt,ds=Rt*Xt-Pt*Kt,fs=nr*ds-lr*as+hr*Br+Er*is-_r*Lr+Rr*kr;return fs?(g[0]=(at*ds-ht*as+ft*Br)*(fs=1/fs),g[1]=($*as-b*ds-it*Br)*fs,g[2]=(Gt*Rr-Kt*_r+Xt*Er)*fs,g[3]=(Rt*_r-Et*Rr-Pt*Er)*fs,g[4]=(ht*is-st*ds-ft*Lr)*fs,g[5]=(a*ds-$*is+it*Lr)*fs,g[6]=(Kt*hr-Lt*Rr-Xt*lr)*fs,g[7]=(xt*Rr-Rt*hr+Pt*lr)*fs,g[8]=(st*as-at*is+ft*kr)*fs,g[9]=(b*is-a*as-it*kr)*fs,g[10]=(Lt*_r-Gt*hr+Xt*nr)*fs,g[11]=(Et*hr-xt*_r-Pt*nr)*fs,g[12]=(at*Lr-st*Br-ht*kr)*fs,g[13]=(a*Br-b*Lr+$*kr)*fs,g[14]=(Gt*lr-Lt*Er-Kt*nr)*fs,g[15]=(xt*Er-Et*lr+Rt*nr)*fs,g):null}function It(g,s,a){var b=s[0],$=s[1],it=s[2],st=s[3],at=s[4],ht=s[5],ft=s[6],xt=s[7],Et=s[8],Rt=s[9],Pt=s[10],Lt=s[11],Gt=s[12],Kt=s[13],Xt=s[14],nr=s[15],lr=a[0],hr=a[1],Er=a[2],_r=a[3];return g[0]=lr*b+hr*at+Er*Et+_r*Gt,g[1]=lr*$+hr*ht+Er*Rt+_r*Kt,g[2]=lr*it+hr*ft+Er*Pt+_r*Xt,g[3]=lr*st+hr*xt+Er*Lt+_r*nr,g[4]=(lr=a[4])*b+(hr=a[5])*at+(Er=a[6])*Et+(_r=a[7])*Gt,g[5]=lr*$+hr*ht+Er*Rt+_r*Kt,g[6]=lr*it+hr*ft+Er*Pt+_r*Xt,g[7]=lr*st+hr*xt+Er*Lt+_r*nr,g[8]=(lr=a[8])*b+(hr=a[9])*at+(Er=a[10])*Et+(_r=a[11])*Gt,g[9]=lr*$+hr*ht+Er*Rt+_r*Kt,g[10]=lr*it+hr*ft+Er*Pt+_r*Xt,g[11]=lr*st+hr*xt+Er*Lt+_r*nr,g[12]=(lr=a[12])*b+(hr=a[13])*at+(Er=a[14])*Et+(_r=a[15])*Gt,g[13]=lr*$+hr*ht+Er*Rt+_r*Kt,g[14]=lr*it+hr*ft+Er*Pt+_r*Xt,g[15]=lr*st+hr*xt+Er*Lt+_r*nr,g}function Mt(g,s,a){var b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt=a[0],Kt=a[1],Xt=a[2];return s===g?(g[12]=s[0]*Gt+s[4]*Kt+s[8]*Xt+s[12],g[13]=s[1]*Gt+s[5]*Kt+s[9]*Xt+s[13],g[14]=s[2]*Gt+s[6]*Kt+s[10]*Xt+s[14],g[15]=s[3]*Gt+s[7]*Kt+s[11]*Xt+s[15]):($=s[1],it=s[2],st=s[3],at=s[4],ht=s[5],ft=s[6],xt=s[7],Et=s[8],Rt=s[9],Pt=s[10],Lt=s[11],g[0]=b=s[0],g[1]=$,g[2]=it,g[3]=st,g[4]=at,g[5]=ht,g[6]=ft,g[7]=xt,g[8]=Et,g[9]=Rt,g[10]=Pt,g[11]=Lt,g[12]=b*Gt+at*Kt+Et*Xt+s[12],g[13]=$*Gt+ht*Kt+Rt*Xt+s[13],g[14]=it*Gt+ft*Kt+Pt*Xt+s[14],g[15]=st*Gt+xt*Kt+Lt*Xt+s[15]),g}function Ht(g,s,a){var b=a[0],$=a[1],it=a[2];return g[0]=s[0]*b,g[1]=s[1]*b,g[2]=s[2]*b,g[3]=s[3]*b,g[4]=s[4]*$,g[5]=s[5]*$,g[6]=s[6]*$,g[7]=s[7]*$,g[8]=s[8]*it,g[9]=s[9]*it,g[10]=s[10]*it,g[11]=s[11]*it,g[12]=s[12],g[13]=s[13],g[14]=s[14],g[15]=s[15],g}function tr(g,s,a){var b=Math.sin(a),$=Math.cos(a),it=s[4],st=s[5],at=s[6],ht=s[7],ft=s[8],xt=s[9],Et=s[10],Rt=s[11];return s!==g&&(g[0]=s[0],g[1]=s[1],g[2]=s[2],g[3]=s[3],g[12]=s[12],g[13]=s[13],g[14]=s[14],g[15]=s[15]),g[4]=it*$+ft*b,g[5]=st*$+xt*b,g[6]=at*$+Et*b,g[7]=ht*$+Rt*b,g[8]=ft*$-it*b,g[9]=xt*$-st*b,g[10]=Et*$-at*b,g[11]=Rt*$-ht*b,g}function er(g,s,a){var b=Math.sin(a),$=Math.cos(a),it=s[0],st=s[1],at=s[2],ht=s[3],ft=s[8],xt=s[9],Et=s[10],Rt=s[11];return s!==g&&(g[4]=s[4],g[5]=s[5],g[6]=s[6],g[7]=s[7],g[12]=s[12],g[13]=s[13],g[14]=s[14],g[15]=s[15]),g[0]=it*$-ft*b,g[1]=st*$-xt*b,g[2]=at*$-Et*b,g[3]=ht*$-Rt*b,g[8]=it*b+ft*$,g[9]=st*b+xt*$,g[10]=at*b+Et*$,g[11]=ht*b+Rt*$,g}function dr(g,s,a){var b=Math.sin(a),$=Math.cos(a),it=s[0],st=s[1],at=s[2],ht=s[3],ft=s[4],xt=s[5],Et=s[6],Rt=s[7];return s!==g&&(g[8]=s[8],g[9]=s[9],g[10]=s[10],g[11]=s[11],g[12]=s[12],g[13]=s[13],g[14]=s[14],g[15]=s[15]),g[0]=it*$+ft*b,g[1]=st*$+xt*b,g[2]=at*$+Et*b,g[3]=ht*$+Rt*b,g[4]=ft*$-it*b,g[5]=xt*$-st*b,g[6]=Et*$-at*b,g[7]=Rt*$-ht*b,g}function mr(g,s){return g[0]=s[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=s[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=s[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function Ur(g,s,a){var b,$,it,st=a[0],at=a[1],ht=a[2],ft=Math.sqrt(st*st+at*at+ht*ht);return ft<pt?null:(st*=ft=1/ft,at*=ft,ht*=ft,b=Math.sin(s),$=Math.cos(s),g[0]=st*st*(it=1-$)+$,g[1]=at*st*it+ht*b,g[2]=ht*st*it-at*b,g[3]=0,g[4]=st*at*it-ht*b,g[5]=at*at*it+$,g[6]=ht*at*it+st*b,g[7]=0,g[8]=st*ht*it+at*b,g[9]=at*ht*it-st*b,g[10]=ht*ht*it+$,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g)}function Dr(g,s){var a=s[0],b=s[1],$=s[2],it=s[4],st=s[5],at=s[6],ht=s[8],ft=s[9],xt=s[10];return g[0]=Math.sqrt(a*a+b*b+$*$),g[1]=Math.sqrt(it*it+st*st+at*at),g[2]=Math.sqrt(ht*ht+ft*ft+xt*xt),g}function Yr(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=a+a,at=b+b,ht=$+$,ft=a*st,xt=b*st,Et=b*at,Rt=$*st,Pt=$*at,Lt=$*ht,Gt=it*st,Kt=it*at,Xt=it*ht;return g[0]=1-Et-Lt,g[1]=xt+Xt,g[2]=Rt-Kt,g[3]=0,g[4]=xt-Xt,g[5]=1-ft-Lt,g[6]=Pt+Gt,g[7]=0,g[8]=Rt+Kt,g[9]=Pt-Gt,g[10]=1-ft-Et,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}var es=It;function ms(){var g=new gt(3);return gt!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g}function Ms(g){var s=new gt(3);return s[0]=g[0],s[1]=g[1],s[2]=g[2],s}function Kr(g){var s=g[0],a=g[1],b=g[2];return Math.sqrt(s*s+a*a+b*b)}function xr(g,s,a){var b=new gt(3);return b[0]=g,b[1]=s,b[2]=a,b}function jr(g,s,a,b){return g[0]=s,g[1]=a,g[2]=b,g}function rr(g,s,a){return g[0]=s[0]+a[0],g[1]=s[1]+a[1],g[2]=s[2]+a[2],g}function ar(g,s,a){return g[0]=s[0]-a[0],g[1]=s[1]-a[1],g[2]=s[2]-a[2],g}function $r(g,s,a){return g[0]=s[0]*a[0],g[1]=s[1]*a[1],g[2]=s[2]*a[2],g}function Ar(g,s,a){return g[0]=Math.min(s[0],a[0]),g[1]=Math.min(s[1],a[1]),g[2]=Math.min(s[2],a[2]),g}function Xr(g,s,a){return g[0]=Math.max(s[0],a[0]),g[1]=Math.max(s[1],a[1]),g[2]=Math.max(s[2],a[2]),g}function us(g,s,a){return g[0]=s[0]*a,g[1]=s[1]*a,g[2]=s[2]*a,g}function Wr(g,s,a,b){return g[0]=s[0]+a[0]*b,g[1]=s[1]+a[1]*b,g[2]=s[2]+a[2]*b,g}function Vs(g,s){var a=s[0]-g[0],b=s[1]-g[1],$=s[2]-g[2];return Math.sqrt(a*a+b*b+$*$)}function yn(g,s){var a=s[0]-g[0],b=s[1]-g[1],$=s[2]-g[2];return a*a+b*b+$*$}function _n(g){var s=g[0],a=g[1],b=g[2];return s*s+a*a+b*b}function zo(g,s){return g[0]=-s[0],g[1]=-s[1],g[2]=-s[2],g}function Cn(g,s){var a=s[0],b=s[1],$=s[2],it=a*a+b*b+$*$;return it>0&&(it=1/Math.sqrt(it)),g[0]=s[0]*it,g[1]=s[1]*it,g[2]=s[2]*it,g}function On(g,s){return g[0]*s[0]+g[1]*s[1]+g[2]*s[2]}function qr(g,s,a){var b=s[0],$=s[1],it=s[2],st=a[0],at=a[1],ht=a[2];return g[0]=$*ht-it*at,g[1]=it*st-b*ht,g[2]=b*at-$*st,g}function Zs(g,s,a,b){var $=s[0],it=s[1],st=s[2];return g[0]=$+b*(a[0]-$),g[1]=it+b*(a[1]-it),g[2]=st+b*(a[2]-st),g}function Os(g,s,a){var b=s[0],$=s[1],it=s[2],st=a[3]*b+a[7]*$+a[11]*it+a[15];return g[0]=(a[0]*b+a[4]*$+a[8]*it+a[12])/(st=st||1),g[1]=(a[1]*b+a[5]*$+a[9]*it+a[13])/st,g[2]=(a[2]*b+a[6]*$+a[10]*it+a[14])/st,g}function Us(g,s,a){var b=s[0],$=s[1],it=s[2];return g[0]=b*a[0]+$*a[3]+it*a[6],g[1]=b*a[1]+$*a[4]+it*a[7],g[2]=b*a[2]+$*a[5]+it*a[8],g}function Nn(g,s,a){var b=a[0],$=a[1],it=a[2],st=a[3],at=s[0],ht=s[1],ft=s[2],xt=$*ft-it*ht,Et=it*at-b*ft,Rt=b*ht-$*at;return g[0]=at+st*(xt+=xt)+$*(Rt+=Rt)-it*(Et+=Et),g[1]=ht+st*Et+it*xt-b*Rt,g[2]=ft+st*Rt+b*Et-$*xt,g}function cn(g){return g[0]=0,g[1]=0,g[2]=0,g}function Bn(g,s){return g[0]===s[0]&&g[1]===s[1]&&g[2]===s[2]}var Pn=ar,Ro=$r,Ho=Kr;function Zn(){var g=new gt(4);return gt!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0,g[3]=0),g}function Qo(g,s,a){return g[0]=s[0]*a,g[1]=s[1]*a,g[2]=s[2]*a,g[3]=s[3]*a,g}function Wo(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=a*a+b*b+$*$+it*it;return st>0&&(st=1/Math.sqrt(st)),g[0]=a*st,g[1]=b*st,g[2]=$*st,g[3]=it*st,g}function uo(g,s,a){var b=s[0],$=s[1],it=s[2],st=s[3];return g[0]=a[0]*b+a[4]*$+a[8]*it+a[12]*st,g[1]=a[1]*b+a[5]*$+a[9]*it+a[13]*st,g[2]=a[2]*b+a[6]*$+a[10]*it+a[14]*st,g[3]=a[3]*b+a[7]*$+a[11]*it+a[15]*st,g}function eo(){var g=new gt(4);return gt!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g[3]=1,g}function to(g){return g[0]=0,g[1]=0,g[2]=0,g[3]=1,g}function Io(g,s,a){a*=.5;var b=s[0],$=s[1],it=s[2],st=s[3],at=Math.sin(a),ht=Math.cos(a);return g[0]=b*ht+st*at,g[1]=$*ht+it*at,g[2]=it*ht-$*at,g[3]=st*ht-b*at,g}function ou(g,s,a){a*=.5;var b=s[0],$=s[1],it=s[2],st=s[3],at=Math.sin(a),ht=Math.cos(a);return g[0]=b*ht-it*at,g[1]=$*ht+st*at,g[2]=it*ht+b*at,g[3]=st*ht-$*at,g}ms(),Zn();var Dl,Jl,Ju,zu=Wo,vu=(Dl=ms(),Jl=xr(1,0,0),Ju=xr(0,1,0),function(g,s,a){var b=On(s,a);return b<-.999999?(qr(Dl,Jl,s),Ho(Dl)<1e-6&&qr(Dl,Ju,s),Cn(Dl,Dl),function($,it,st){st*=.5;var at=Math.sin(st);$[0]=at*it[0],$[1]=at*it[1],$[2]=at*it[2],$[3]=Math.cos(st)}(g,Dl,Math.PI),g):b>.999999?(g[0]=0,g[1]=0,g[2]=0,g[3]=1,g):(qr(Dl,s,a),g[0]=Dl[0],g[1]=Dl[1],g[2]=Dl[2],g[3]=1+b,zu(g,g))});function Vo(){var g=new gt(2);return gt!=Float32Array&&(g[0]=0,g[1]=0),g}function Gl(g,s){var a=new gt(2);return a[0]=g,a[1]=s,a}function fu(g,s,a){return g[0]=s,g[1]=a,g}function ju(g,s,a){return g[0]=s[0]+a[0],g[1]=s[1]+a[1],g}function au(g,s,a){return g[0]=s[0]-a[0],g[1]=s[1]-a[1],g}function pu(g,s,a){return g[0]=s[0]*a,g[1]=s[1]*a,g}function Il(g){var s=g[0],a=g[1];return Math.sqrt(s*s+a*a)}function Ou(g,s){var a=s[0],b=s[1],$=a*a+b*b;return $>0&&($=1/Math.sqrt($)),g[0]=s[0]*$,g[1]=s[1]*$,g}function Zu(g,s){return g[0]*s[0]+g[1]*s[1]}eo(),eo(),kt();var _o,Ol,oo=au;function Uo(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}Vo();var Lo=function(){if(Ol)return _o;function g(s,a,b,$){this.cx=3*s,this.bx=3*(b-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*($-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=a,this.p2x=b,this.p2y=$}return Ol=1,_o=g,g.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,a){if(a===void 0&&(a=1e-6),s<0)return 0;if(s>1)return 1;for(var b=s,$=0;$<8;$++){var it=this.sampleCurveX(b)-s;if(Math.abs(it)<a)return b;var st=this.sampleCurveDerivativeX(b);if(Math.abs(st)<1e-6)break;b-=it/st}var at=0,ht=1;for(b=s,$=0;$<20&&(it=this.sampleCurveX(b),!(Math.abs(it-s)<a));$++)s>it?at=b:ht=b,b=.5*(ht-at)+at;return b},solve:function(s,a){return this.sampleCurveY(this.solveCurveX(s,a))}},_o}(),lu=Uo(Lo);function ps(g,s){this.x=g,this.y=s}function Wl(g,s){if(Array.isArray(g)){if(!Array.isArray(s)||g.length!==s.length)return!1;for(let a=0;a<g.length;a++)if(!Wl(g[a],s[a]))return!1;return!0}if(typeof g=="object"&&g!==null&&s!==null){if(typeof s!="object"||Object.keys(g).length!==Object.keys(s).length)return!1;for(const a in g)if(!Wl(g[a],s[a]))return!1;return!0}return g===s}ps.prototype={clone(){return new ps(this.x,this.y)},add(g){return this.clone()._add(g)},sub(g){return this.clone()._sub(g)},multByPoint(g){return this.clone()._multByPoint(g)},divByPoint(g){return this.clone()._divByPoint(g)},mult(g){return this.clone()._mult(g)},div(g){return this.clone()._div(g)},rotate(g){return this.clone()._rotate(g)},rotateAround(g,s){return this.clone()._rotateAround(g,s)},matMult(g){return this.clone()._matMult(g)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(g){return this.x===g.x&&this.y===g.y},dist(g){return Math.sqrt(this.distSqr(g))},distSqr(g){const s=g.x-this.x,a=g.y-this.y;return s*s+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(g){return Math.atan2(this.y-g.y,this.x-g.x)},angleWith(g){return this.angleWithSep(g.x,g.y)},angleWithSep(g,s){return Math.atan2(this.x*s-this.y*g,this.x*g+this.y*s)},_matMult(g){const s=g[2]*this.x+g[3]*this.y;return this.x=g[0]*this.x+g[1]*this.y,this.y=s,this},_add(g){return this.x+=g.x,this.y+=g.y,this},_sub(g){return this.x-=g.x,this.y-=g.y,this},_mult(g){return this.x*=g,this.y*=g,this},_div(g){return this.x/=g,this.y/=g,this},_multByPoint(g){return this.x*=g.x,this.y*=g.y,this},_divByPoint(g){return this.x/=g.x,this.y/=g.y,this},_unit(){return this._div(this.mag()),this},_perp(){const g=this.y;return this.y=this.x,this.x=-g,this},_rotate(g){const s=Math.cos(g),a=Math.sin(g),b=a*this.x+s*this.y;return this.x=s*this.x-a*this.y,this.y=b,this},_rotateAround(g,s){const a=Math.cos(g),b=Math.sin(g),$=s.y+b*(this.x-s.x)+a*(this.y-s.y);return this.x=s.x+a*(this.x-s.x)-b*(this.y-s.y),this.y=$,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:ps},ps.convert=function(g){if(g instanceof ps)return g;if(Array.isArray(g))return new ps(+g[0],+g[1]);if(g.x!==void 0&&g.y!==void 0)return new ps(+g.x,+g.y);throw new Error("Expected [x, y] or {x, y} point format")};const Bu=Math.PI/180,qo=180/Math.PI;function wn(g){return g*Bu}function Nl(g){return g*qo}const vp=[[0,0],[1,0],[1,1],[0,1]];function cu(g){if(g<=0)return 0;if(g>=1)return 1;const s=g*g,a=s*g;return 4*(g<.5?a:3*(g-s)+a-.75)}function bp(g,s,a,b){const $=new lu(g,s,a,b);return function(it){return $.solve(it)}}const Hr=bp(.25,.1,.25,1);function Qt(g,s,a){return Math.min(a,Math.max(s,g))}function or(g,s,a){return(a=Qt((a-g)/(s-g),0,1))*a*(3-2*a)}function gr(g,s,a){const b=a-s,$=((g-s)%b+b)%b+s;return $===s?a:$}function Mr(g,s,a){if(!g.length)return a(null,[]);let b=g.length;const $=new Array(g.length);let it=null;g.forEach((st,at)=>{s(st,(ht,ft)=>{ht&&(it=ht),$[at]=ft,--b==0&&a(it,$)})})}let Ir=1;function zr(){return Ir++}function _i(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log2(g)))}function Vr(g,s){g.forEach(a=>{s[a]&&(s[a]=s[a].bind(s))})}function Jr(g,s,a){const b={};for(const $ in g)b[$]=s.call(this,g[$],$,g);return b}function Es(g,s,a){const b={};for(const $ in g)s.call(this,g[$],$,g)&&(b[$]=g[$]);return b}function hs(g){return Array.isArray(g)?g.map(hs):typeof g=="object"&&g?Jr(g,hs):g}function Ws(g,s){for(let a=0;a<g.length;a++)if(s.indexOf(g[a])>=0)return!0;return!1}const an={};function $s(g){an[g]||(typeof console<"u"&&console.warn(g),an[g]=!0)}function In(g,s,a){return(a.y-g.y)*(s.x-g.x)>(s.y-g.y)*(a.x-g.x)}function An(g){let s=0;for(let a,b,$=0,it=g.length,st=it-1;$<it;st=$++)a=g[$],b=g[st],s+=(b.x-a.x)*(a.y+b.y);return s}function Tn([g,s,a]){const b=wn(s+90),$=wn(a);return{x:g*Math.cos(b)*Math.sin($),y:g*Math.sin(b)*Math.sin($),z:g*Math.cos($),azimuthal:s,polar:a}}function Yn(g){return(typeof self<"u"||g!==void 0)&&typeof WorkerGlobalScope<"u"&&(g!==void 0?g:self)instanceof WorkerGlobalScope}function El(g){const s={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,b,$,it)=>{const st=$||it;return s[b]=!st||st.toLowerCase(),""}),s["max-age"]){const a=parseInt(s["max-age"],10);isNaN(a)?delete s["max-age"]:s["max-age"]=a}return s}let Bl=null;function Rl(g,s){return[g[4*s],g[4*s+1],g[4*s+2],g[4*s+3]]}function Hl(g,s,a,b){for(;s<a;){const $=s+a>>1;g[$]<b?s=$+1:a=$}return s}function $a(g,s,a,b){for(;s<a;){const $=s+a>>1;g[$]<=b?s=$+1:a=$}return s}function io(g){return g>0?1/(1.001-g):1+g}function xl(g){return g>0?1-1/(1.001-g):-g}function Do(g,s,a){return(g-s.min)*(a.max-a.min)/(s.max-s.min)+a.min}const Gn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Gn.API_URL)return null;try{const g=new URL(Gn.API_URL);return g.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":g.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Cl(g){return Gn.API_URL_REGEX.test(g)}function xu(g){return Gn.API_SPRITE_REGEX.test(g)}let bu,Vu,Zm,uu,_h,Cu;function Mp(){return bu==null&&(bu=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),bu}const ru={now:()=>uu!==void 0?uu:performance.now(),setNow(g){uu=g},restoreNow(){uu=void 0},frame(g){const s=requestAnimationFrame(g);return{cancel:()=>cancelAnimationFrame(s)}},getImageData(g,s=0){const{width:a,height:b}=g;_h||(_h=document.createElement("canvas"));const $=_h.getContext("2d",{willReadFrequently:!0});if(!$)throw new Error("failed to create canvas 2d context");return(a>_h.width||b>_h.height)&&(_h.width=a,_h.height=b),$.clearRect(-s,-s,a+2*s,b+2*s),$.drawImage(g,0,0,a,b),$.getImageData(-s,-s,a+2*s,b+2*s)},resolveURL:g=>(Vu||(Vu=document.createElement("a")),Vu.href=g,Vu.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Zm==null&&(Zm=window.matchMedia("(prefers-reduced-motion: reduce)")),Zm.matches)},hasCanvasFingerprintNoise(){if(Cu!==void 0)return Cu;if(!Mp())return Cu=!1,!1;const g=new OffscreenCanvas(85,1),s=g.getContext("2d",{willReadFrequently:!0});let a=0;for(let $=0;$<g.width;++$)s.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,s.fillRect($,0,1,1);const b=s.getImageData(0,0,g.width,g.height);a=0;for(let $=0;$<b.data.length;++$)if($%4!=3&&a++!==b.data[$])return Cu=!0,!0;return Cu=!1,!1}};function Xm(g,s){const a=g.indexOf("?");if(a<0)return`${g}?${new URLSearchParams(s).toString()}`;const b=new URLSearchParams(g.slice(a));for(const $ in s)b.set($,s[$]);return`${g.slice(0,a)}?${b.toString()}`}function bx(g,s={persistentParams:[]}){const a=g.indexOf("?");if(a<0)return g;const b=new URLSearchParams,$=new URLSearchParams(g.slice(a));for(const st of s.persistentParams){const at=$.get(st);at&&b.set(st,at)}const it=b.toString();return`${g.slice(0,a)}${it.length>0?`?${it}`:""}`}const l0="mapbox-tiles";let c0=500,u0=50;const ly=["language","worldview","jobid"];let Fp,Uu;function wp(){try{return caches}catch{}}function Ep(){const g=wp();g&&Fp==null&&(Fp=g.open(l0))}let cp=1/0;const Lp={supported:!1,testSupport:function(g){!h0&&Km&&(Ym?Q1(g):Em=g)}};let Em,Km,h0=!1,Ym=!1;const d0=typeof self<"u"?self:{};function Q1(g){const s=g.createTexture();g.bindTexture(g.TEXTURE_2D,s);try{if(g.texImage2D(g.TEXTURE_2D,0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,Km),g.isContextLost())return;Lp.supported=!0}catch{}g.deleteTexture(s),h0=!0}d0.document&&(Km=d0.document.createElement("img"),Km.onload=function(){Em&&Q1(Em),Em=null,Ym=!0},Km.onerror=function(){h0=!0,Em=null},Km.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cy={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(cy);class Xu extends Error{constructor(s,a,b){a===401&&Cl(b)&&(s+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(s),this.status=a,this.url=b}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const f0=Yn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,Qm=function(g,s){if(!(/^file:/.test(a=g.url)||/^file:/.test(f0())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(b,$){const it=new AbortController,st=new Request(b.url,{method:b.method||"GET",body:b.body,credentials:b.credentials,headers:b.headers,referrer:f0(),referrerPolicy:b.referrerPolicy,signal:it.signal});let at=!1,ht=!1;const ft=(xt=st.url).indexOf("sku=")>0&&Cl(xt);var xt;b.type==="json"&&st.headers.set("Accept","application/json");const Et=(Pt,Lt,Gt)=>{if(ht)return;if(Pt&&Pt.message!=="SecurityError"&&$s(Pt.toString()),Lt&&Gt)return Rt(Lt);const Kt=Date.now();fetch(st).then(Xt=>{if(Xt.ok){const nr=ft?Xt.clone():null;return Rt(Xt,nr,Kt)}return $(new Xu(Xt.statusText,Xt.status,b.url))}).catch(Xt=>{Xt.name!=="AbortError"&&$(new Error(`${Xt.message} ${b.url}`))})},Rt=(Pt,Lt,Gt)=>{(b.type==="arrayBuffer"?Pt.arrayBuffer():b.type==="json"?Pt.json():Pt.text()).then(Kt=>{ht||(Lt&&Gt&&function(Xt,nr,lr){if(Ep(),Fp==null)return;const hr=El(nr.headers.get("Cache-Control")||"");if(hr["no-store"])return;const Er={status:nr.status,statusText:nr.statusText,headers:new Headers};nr.headers.forEach((kr,Lr)=>Er.headers.set(Lr,kr)),hr["max-age"]&&Er.headers.set("Expires",new Date(lr+1e3*hr["max-age"]).toUTCString());const _r=Er.headers.get("Expires");if(!_r||new Date(_r).getTime()-lr<42e4)return;let Rr=bx(Xt.url,{persistentParams:ly});if(nr.status===206){const kr=Xt.headers.get("Range");if(!kr)return;Er.status=200,Rr=Xm(Rr,{range:kr})}(function(kr,Lr){if(Uu===void 0)try{new Response(new ReadableStream),Uu=!0}catch{Uu=!1}Uu?Lr(kr.body):kr.blob().then(Lr).catch(is=>$s(is.message))})(nr,kr=>{const Lr=new Response((is=nr.status)!==200&&is!==404&&[101,103,204,205,304].includes(is)?null:kr,Er);var is;Ep(),Fp!=null&&Fp.then(Br=>Br.put(Rr,Lr)).catch(Br=>$s(Br.message))})}(st,Lt,Gt),at=!0,$(null,Kt,Pt.headers))}).catch(Kt=>{ht||$(new Error(Kt.message))})};return ft?function(Pt,Lt){if(Ep(),Fp==null)return Lt(null);Fp.then(Gt=>{let Kt=bx(Pt.url,{persistentParams:ly});const Xt=Pt.headers.get("Range");Xt&&(Kt=Xm(Kt,{range:Xt})),Gt.match(Kt).then(nr=>{const lr=function(hr){if(!hr)return!1;const Er=new Date(hr.headers.get("Expires")||0),_r=El(hr.headers.get("Cache-Control")||"");return Number(Er)>Date.now()&&!_r["no-cache"]}(nr);Gt.delete(Kt).catch(Lt),lr&&Gt.put(Kt,nr.clone()).catch(Lt),Lt(null,nr,lr)}).catch(Lt)}).catch(Lt)}(st,Et):Et(null,null),{cancel:()=>{ht=!0,at||it.abort()}}}(g,s);if(Yn(self)&&self.worker.actor)return self.worker.actor.send("getResource",g,s,void 0,!0)}var a;return function(b,$){const it=new XMLHttpRequest;it.open(b.method||"GET",b.url,!0),b.type==="arrayBuffer"&&(it.responseType="arraybuffer");for(const st in b.headers)it.setRequestHeader(st,b.headers[st]);return b.type==="json"&&(it.responseType="text",it.setRequestHeader("Accept","application/json")),it.withCredentials=b.credentials==="include",it.onerror=()=>{$(new Error(it.statusText))},it.onload=()=>{if((it.status>=200&&it.status<300||it.status===0)&&it.response!==null){let st=it.response;if(b.type==="json")try{st=JSON.parse(it.response)}catch(ht){return $(ht)}const at=new Headers;it.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(ht=>{const ft=ht.split(": "),xt=ft.shift(),Et=ft.join(": ");at.append(xt,Et)}),$(null,st,at)}else $(new Xu(it.statusText,it.status,b.url))},it.send(b.body),{cancel:()=>it.abort()}}(g,s)},Kp=function(g,s){return Qm(Object.assign(g,{type:"arrayBuffer"}),s)};function KE(g){const s=document.createElement("a");return s.href=g,s.protocol===location.protocol&&s.host===location.host}const J1="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let uy,so;uy=[],so=0;const p0=function(g,s){if(Lp.supported&&(g.headers||(g.headers={}),g.headers.accept="image/webp,*/*"),so>=Gn.MAX_PARALLEL_IMAGE_REQUESTS){const it={requestParameters:g,callback:s,cancelled:!1,cancel(){this.cancelled=!0}};return uy.push(it),it}so++;let a=!1;const b=()=>{if(!a)for(a=!0,so--;uy.length&&so<Gn.MAX_PARALLEL_IMAGE_REQUESTS;){const it=uy.shift(),{requestParameters:st,callback:at,cancelled:ht}=it;ht||(it.cancel=p0(st,at).cancel)}},$=Kp(g,(it,st,at)=>{b(),it?s(it):st&&(self.createImageBitmap?function(ht,ft){const xt=new Blob([new Uint8Array(ht)],{type:"image/png"});createImageBitmap(xt).then(Et=>{ft(null,Et)}).catch(Et=>{ft(new Error(`Could not load image because of ${Et.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(st,(ht,ft)=>s(ht,ft,at)):function(ht,ft){const xt=new Image;xt.onload=()=>{ft(null,xt),URL.revokeObjectURL(xt.src),xt.onload=null,requestAnimationFrame(()=>{xt.src=J1})},xt.onerror=()=>ft(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Et=new Blob([new Uint8Array(ht)],{type:"image/png"});xt.src=ht.byteLength?URL.createObjectURL(Et):J1}(st,(ht,ft)=>s(ht,ft,at)))});return{cancel:()=>{$.cancel(),b()}}};var tv,_b,ew,Sm={exports:{}},hy={exports:{}},dy={exports:{}},rv=function(){if(ew)return Sm.exports;ew=1;var g=(tv||(tv=1,hy.exports=function(a,b){var $,it,st,at,ht,ft,xt,Et;for(it=a.length-($=3&a.length),st=b,ht=3432918353,ft=461845907,Et=0;Et<it;)xt=255&a.charCodeAt(Et)|(255&a.charCodeAt(++Et))<<8|(255&a.charCodeAt(++Et))<<16|(255&a.charCodeAt(++Et))<<24,++Et,st=27492+(65535&(at=5*(65535&(st=(st^=xt=(65535&(xt=(xt=(65535&xt)*ht+(((xt>>>16)*ht&65535)<<16)&4294967295)<<15|xt>>>17))*ft+(((xt>>>16)*ft&65535)<<16)&4294967295)<<13|st>>>19))+((5*(st>>>16)&65535)<<16)&4294967295))+((58964+(at>>>16)&65535)<<16);switch(xt=0,$){case 3:xt^=(255&a.charCodeAt(Et+2))<<16;case 2:xt^=(255&a.charCodeAt(Et+1))<<8;case 1:st^=xt=(65535&(xt=(xt=(65535&(xt^=255&a.charCodeAt(Et)))*ht+(((xt>>>16)*ht&65535)<<16)&4294967295)<<15|xt>>>17))*ft+(((xt>>>16)*ft&65535)<<16)&4294967295}return st^=a.length,st=2246822507*(65535&(st^=st>>>16))+((2246822507*(st>>>16)&65535)<<16)&4294967295,st=3266489909*(65535&(st^=st>>>13))+((3266489909*(st>>>16)&65535)<<16)&4294967295,(st^=st>>>16)>>>0}),hy.exports),s=(_b||(_b=1,dy.exports=function(a,b){for(var $,it=a.length,st=b^it,at=0;it>=4;)$=1540483477*(65535&($=255&a.charCodeAt(at)|(255&a.charCodeAt(++at))<<8|(255&a.charCodeAt(++at))<<16|(255&a.charCodeAt(++at))<<24))+((1540483477*($>>>16)&65535)<<16),st=1540483477*(65535&st)+((1540483477*(st>>>16)&65535)<<16)^($=1540483477*(65535&($^=$>>>24))+((1540483477*($>>>16)&65535)<<16)),it-=4,++at;switch(it){case 3:st^=(255&a.charCodeAt(at+2))<<16;case 2:st^=(255&a.charCodeAt(at+1))<<8;case 1:st=1540483477*(65535&(st^=255&a.charCodeAt(at)))+((1540483477*(st>>>16)&65535)<<16)}return st=1540483477*(65535&(st^=st>>>13))+((1540483477*(st>>>16)&65535)<<16),(st^=st>>>15)>>>0}),dy.exports);return Sm.exports=g,Sm.exports.murmur3=g,Sm.exports.murmur2=s,Sm.exports}(),m0=Uo(rv);class Dp{constructor(s,...a){Object.assign(this,a[0]||{}),this.type=s}}class fy extends Dp{constructor(s,a={}){super("error",Object.assign({error:s},a))}}function iv(g,s,a){a[g]&&a[g].indexOf(s)!==-1||(a[g]=a[g]||[],a[g].push(s))}function Tm(g,s,a){if(a&&a[g]){const b=a[g].indexOf(s);b!==-1&&a[g].splice(b,1)}}class Jm{on(s,a){return this._listeners=this._listeners||{},iv(s,a,this._listeners),this}off(s,a){return Tm(s,a,this._listeners),Tm(s,a,this._oneTimeListeners),this}once(s,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},iv(s,a,this._oneTimeListeners),this):new Promise(b=>{this.once(s,b)})}fire(s,a){const b=typeof s=="string"?new Dp(s,a):s,$=b.type;if(this.listens($)){b.target=this;const it=this._listeners&&this._listeners[$]?this._listeners[$].slice():[];for(const ht of it)ht.call(this,b);const st=this._oneTimeListeners&&this._oneTimeListeners[$]?this._oneTimeListeners[$].slice():[];for(const ht of st)Tm($,ht,this._oneTimeListeners),ht.call(this,b);const at=this._eventedParent;if(at){const ht=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(b,ht),at.fire(b)}}else b instanceof fy&&console.error(b.error);return this}listens(s){return!!(this._listeners&&this._listeners[s]&&this._listeners[s].length>0||this._oneTimeListeners&&this._oneTimeListeners[s]&&this._oneTimeListeners[s].length>0||this._eventedParent&&this._eventedParent.listens(s))}setEventedParent(s,a){return this._eventedParent=s,this._eventedParentData=a,this}}class Au{constructor(s){typeof s=="string"?this.name=s:(this.name=s.name,this.iconsetId=s.iconsetId)}static from(s){return new Au(s)}static toString(s){return s.iconsetId?`${s.name}${s.iconsetId}`:s.name}static parse(s){const[a,b]=s.split("");return new Au({name:a,iconsetId:b})}static isEqual(s,a){return s.name===a.name&&s.iconsetId===a.iconsetId}toString(){return Au.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var g0,py={},up=function(){if(g0)return py;g0=1;var g={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(it){return(it=Math.round(it))<0?0:it>255?255:it}function a(it){return s(it[it.length-1]==="%"?parseFloat(it)/100*255:parseInt(it))}function b(it){return(st=it[it.length-1]==="%"?parseFloat(it)/100:parseFloat(it))<0?0:st>1?1:st;var st}function $(it,st,at){return at<0?at+=1:at>1&&(at-=1),6*at<1?it+(st-it)*at*6:2*at<1?st:3*at<2?it+(st-it)*(2/3-at)*6:it}try{py.parseCSSColor=function(it){var st,at=it.replace(/ /g,"").toLowerCase();if(at in g)return g[at].slice();if(at[0]==="#")return at.length===4?(st=parseInt(at.substr(1),16))>=0&&st<=4095?[(3840&st)>>4|(3840&st)>>8,240&st|(240&st)>>4,15&st|(15&st)<<4,1]:null:at.length===7&&(st=parseInt(at.substr(1),16))>=0&&st<=16777215?[(16711680&st)>>16,(65280&st)>>8,255&st,1]:null;var ht=at.indexOf("("),ft=at.indexOf(")");if(ht!==-1&&ft+1===at.length){var xt=at.substr(0,ht),Et=at.substr(ht+1,ft-(ht+1)).split(","),Rt=1;switch(xt){case"rgba":if(Et.length!==4)return null;Rt=b(Et.pop());case"rgb":return Et.length!==3?null:[a(Et[0]),a(Et[1]),a(Et[2]),Rt];case"hsla":if(Et.length!==4)return null;Rt=b(Et.pop());case"hsl":if(Et.length!==3)return null;var Pt=(parseFloat(Et[0])%360+360)%360/360,Lt=b(Et[1]),Gt=b(Et[2]),Kt=Gt<=.5?Gt*(Lt+1):Gt+Lt-Gt*Lt,Xt=2*Gt-Kt;return[s(255*$(Xt,Kt,Pt+1/3)),s(255*$(Xt,Kt,Pt)),s(255*$(Xt,Kt,Pt-1/3)),Rt];default:return null}}return null}}catch{}return py}();class vo{constructor(s,a,b,$=1){this.r=s,this.g=a,this.b=b,this.a=$}static parse(s){if(!s)return;if(s instanceof vo)return s;if(typeof s!="string")return;const a=up.parseCSSColor(s);return a?new vo(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[s,a,b,$]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*s)},${Math.round(255*a)},${Math.round(255*b)},${$})`}toNonPremultipliedRenderColor(s){const{r:a,g:b,b:$,a:it}=this;return new rw(s,a,b,$,it)}toPremultipliedRenderColor(s){const{r:a,g:b,b:$,a:it}=this;return new iw(s,a*it,b*it,$*it,it)}clone(){return new vo(this.r,this.g,this.b,this.a)}}class tw{constructor(s,a,b,$,it,st=!1){if(this.premultiplied=!1,this.premultiplied=st,s){const at=s.image.height,ht=at*at;this.premultiplied?(a=it===0?0:a/it*(at-1),b=it===0?0:b/it*(at-1),$=it===0?0:$/it*(at-1)):(a*=at-1,b*=at-1,$*=at-1);const ft=Math.floor(a),xt=Math.floor(b),Et=Math.floor($),Rt=Math.ceil(a),Pt=Math.ceil(b),Lt=Math.ceil($),Gt=a-ft,Kt=b-xt,Xt=$-Et,nr=s.image.data,lr=4*(ft+xt*ht+Et*at),hr=4*(ft+xt*ht+Lt*at),Er=4*(ft+Pt*ht+Et*at),_r=4*(ft+Pt*ht+Lt*at),Rr=4*(Rt+xt*ht+Et*at),kr=4*(Rt+xt*ht+Lt*at),Lr=4*(Rt+Pt*ht+Et*at),is=4*(Rt+Pt*ht+Lt*at);if(lr<0||is>=nr.length)throw new Error("out of range");this.r=pn(pn(pn(nr[lr],nr[hr],Xt),pn(nr[Er],nr[_r],Xt),Kt),pn(pn(nr[Rr],nr[kr],Xt),pn(nr[Lr],nr[is],Xt),Kt),Gt)/255*(this.premultiplied?it:1),this.g=pn(pn(pn(nr[lr+1],nr[hr+1],Xt),pn(nr[Er+1],nr[_r+1],Xt),Kt),pn(pn(nr[Rr+1],nr[kr+1],Xt),pn(nr[Lr+1],nr[is+1],Xt),Kt),Gt)/255*(this.premultiplied?it:1),this.b=pn(pn(pn(nr[lr+2],nr[hr+2],Xt),pn(nr[Er+2],nr[_r+2],Xt),Kt),pn(pn(nr[Rr+2],nr[kr+2],Xt),pn(nr[Lr+2],nr[is+2],Xt),Kt),Gt)/255*(this.premultiplied?it:1),this.a=it}else this.r=a,this.g=b,this.b=$,this.a=it}toArray(){const{r:s,g:a,b,a:$}=this;return[255*s,255*a,255*b,$]}toHslaArray(){let{r:s,g:a,b,a:$}=this;if(this.premultiplied){if($===0)return[0,0,0,0];const Lt=1/$;s*=Lt,a*=Lt,b*=Lt}const it=Math.min(Math.max(s,0),1),st=Math.min(Math.max(a,0),1),at=Math.min(Math.max(b,0),1),ht=Math.min(it,st,at),ft=Math.max(it,st,at),xt=ft-ht,Et=.5*(ht+ft);if(xt===0)return[0,0,100*Et,$];const Rt=Et>.5?xt/(2-ft-ht):xt/(ft+ht);let Pt;switch(ft){case it:Pt=60*((st-at)/xt+(st<at?6:0));break;case st:Pt=60*((at-it)/xt+2);break;default:Pt=60*((it-st)/xt+4)}return[Pt,100*Rt,100*Et,$]}toArray01(){const{r:s,g:a,b,a:$}=this;return[s,a,b,$]}toArray01Scaled(s){const{r:a,g:b,b:$}=this;return[a*s,b*s,$*s]}toArray01Linear(){const{r:s,g:a,b,a:$}=this;return[Math.pow(s,2.2),Math.pow(a,2.2),Math.pow(b,2.2),$]}}class rw extends tw{constructor(s,a,b,$,it){super(s,a,b,$,it,!1)}}class iw extends tw{constructor(s,a,b,$,it){super(s,a,b,$,it,!0)}}function pn(g,s,a){return g*(1-a)+s*a}function sv(g,s,a){return g.map((b,$)=>pn(b,s[$],a))}vo.black=new vo(0,0,0,1),vo.white=new vo(1,1,1,1),vo.transparent=new vo(0,0,0,0),vo.red=new vo(1,0,0,1),vo.blue=new vo(0,0,1,1);var my=Object.freeze({__proto__:null,array:sv,color:function(g,s,a){return new vo(pn(g.r,s.r,a),pn(g.g,s.g,a),pn(g.b,s.b,a),pn(g.a,s.a,a))},number:pn});class hp extends Error{constructor(s,a){super(a),this.message=a,this.key=s}}class wx{constructor(s,a=[]){this.parent=s,this.bindings={};for(const[b,$]of a)this.bindings[b]=$}concat(s){return new wx(this,s)}get(s){if(this.bindings[s])return this.bindings[s];if(this.parent)return this.parent.get(s);throw new Error(`${s} not found in scope.`)}has(s){return!!this.bindings[s]||!!this.parent&&this.parent.has(s)}}const Sp={kind:"null"},nn={kind:"number"},Kn={kind:"string"},So={kind:"boolean"},$u={kind:"color"},Np={kind:"object"},yo={kind:"value"},x0={kind:"collator"},gy={kind:"formatted"},xy={kind:"resolvedImage"};function wu(g,s){return{kind:"array",itemType:g,N:s}}function Vl(g){if(g.kind==="array"){const s=Vl(g.itemType);return typeof g.N=="number"?`array<${s}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${s}>`}return g.kind}const YE=[Sp,nn,Kn,So,$u,gy,Np,wu(yo),xy];function Rm(g,s){if(s.kind==="error")return null;if(g.kind==="array"){if(s.kind==="array"&&(s.N===0&&s.itemType.kind==="value"||!Rm(g.itemType,s.itemType))&&(typeof g.N!="number"||g.N===s.N))return null}else{if(g.kind===s.kind)return null;if(g.kind==="value"){for(const a of YE)if(!Rm(a,s))return null}}return`Expected ${Vl(g)} but found ${Vl(s)} instead.`}function nv(g,s){return s.some(a=>a.kind===g.kind)}function yy(g,s){return s.some(a=>a==="null"?g===null:a==="array"?Array.isArray(g):a==="object"?g&&!Array.isArray(g)&&typeof g=="object":a===typeof g)}function y0(g,s){return g.kind==="array"&&s.kind==="array"?g.N===s.N&&y0(g.itemType,s.itemType):g.kind===s.kind}class ov{constructor(s,a,b){this.sensitivity=s?a?"variant":"case":a?"accent":"base",this.locale=b,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(s,a){return this.collator.compare(s,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class _0{constructor(s,a,b,$,it){this.text=s.normalize?s.normalize():s,this.image=a,this.scale=b,this.fontStack=$,this.textColor=it}}class Pu{constructor(s){this.sections=s}static fromString(s){return new Pu([new _0(s,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(s=>s.text.length!==0||!!s.image&&s.image.hasPrimary())}static factory(s){return s instanceof Pu?s:Pu.fromString(s)}toString(){return this.sections.length===0?"":this.sections.map(s=>s.text).join("")}serialize(){const s=["format"];for(const a of this.sections){if(a.image){const $=a.image.getPrimary().id.toString();s.push(["image",$]);continue}s.push(a.text);const b={};a.fontStack&&(b["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(b["font-scale"]=a.scale),a.textColor&&(b["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),s.push(b)}return s}}class Yp{constructor(s,a={}){this.id=Au.from(s),this.params=a.params,this.sx=a.sx||1,this.sy=a.sy||1}toString(){return JSON.stringify(this)}static parse(s){let a,b,$,it;try{({id:a,params:b,sx:$,sy:it}=JSON.parse(s)||{})}catch{return null}return a?new Yp(a,{params:b,sx:$,sy:it}):null}scaleSelf(s,a=s){return this.sx*=s,this.sy*=a,this}}class Iu{constructor(s,a,b,$,it=!1){this.primaryId=Au.from(s),this.primaryOptions=a,b&&(this.secondaryId=Au.from(b)),this.secondaryOptions=$,this.available=it}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Yp(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Yp(this.secondaryId,this.secondaryOptions):null}static from(s){return typeof s=="string"?Iu.build({name:s}):s}static build(s,a,b,$){return!s||typeof s=="object"&&!("name"in s)?null:new Iu(s,b,a,$)}}function _g(g,s,a,b){return typeof g=="number"&&g>=0&&g<=255&&typeof s=="number"&&s>=0&&s<=255&&typeof a=="number"&&a>=0&&a<=255?b===void 0||typeof b=="number"&&b>=0&&b<=1?null:`Invalid rgba value [${[g,s,a,b].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof b=="number"?[g,s,a,b]:[g,s,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ex(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof vo||g instanceof ov||g instanceof Pu||g instanceof Iu)return!0;if(Array.isArray(g)){for(const s of g)if(!Ex(s))return!1;return!0}if(typeof g=="object"){for(const s in g)if(!Ex(g[s]))return!1;return!0}return!1}function iu(g){if(g===null)return Sp;if(typeof g=="string")return Kn;if(typeof g=="boolean")return So;if(typeof g=="number")return nn;if(g instanceof vo)return $u;if(g instanceof ov)return x0;if(g instanceof Pu)return gy;if(g instanceof Iu)return xy;if(Array.isArray(g)){const s=g.length;let a;for(const b of g){const $=iu(b);if(a){if(a===$)continue;a=yo;break}a=$}return wu(a||yo,s)}return Np}function dp(g){const s=typeof g;return g===null?"":s==="string"||s==="number"||s==="boolean"?String(g):g instanceof Pu||g instanceof Iu||g instanceof vo?g.toString():JSON.stringify(g)}class Qp{constructor(s,a){this.type=s,this.value=a}static parse(s,a){if(s.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${s.length-1} instead.`);if(!Ex(s[1]))return a.error("invalid value");const b=s[1];let $=iu(b);const it=a.expectedType;return $.kind!=="array"||$.N!==0||!it||it.kind!=="array"||typeof it.N=="number"&&it.N!==0||($=it),new Qp($,b)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof vo?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Pu?this.value.serialize():this.value}}class _c{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}}const av={string:Kn,number:nn,boolean:So,object:Np};class Tp{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");let b,$=1;const it=s[0];if(it==="array"){let at,ht;if(s.length>2){const ft=s[1];if(typeof ft!="string"||!(ft in av)||ft==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);at=av[ft],$++}else at=yo;if(s.length>3){if(s[2]!==null&&(typeof s[2]!="number"||s[2]<0||s[2]!==Math.floor(s[2])))return a.error('The length argument to "array" must be a positive integer literal',2);ht=s[2],$++}b=wu(at,ht)}else b=av[it];const st=[];for(;$<s.length;$++){const at=a.parse(s[$],$,yo);if(!at)return null;st.push(at)}return new Tp(b,st)}evaluate(s){for(let a=0;a<this.args.length;a++){const b=this.args[a].evaluate(s);if(!Rm(this.type,iu(b)))return b;if(a===this.args.length-1)throw new _c(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${Vl(iu(b))} but was expected to be of type ${Vl(this.type)}.`)}return null}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=this.type,a=[s.kind];if(s.kind==="array"){const b=s.itemType;if(b.kind==="string"||b.kind==="number"||b.kind==="boolean"){a.push(b.kind);const $=s.N;(typeof $=="number"||this.args.length>1)&&a.push($)}}return a.concat(this.args.map(b=>b.serialize()))}}class zp{constructor(s){this.type=gy,this.sections=s}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const b=s[1];if(!Array.isArray(b)&&typeof b=="object")return a.error("First argument must be an image or text section.");const $=[];let it=!1;for(let st=1;st<=s.length-1;++st){const at=s[st];if(it&&typeof at=="object"&&!Array.isArray(at)){it=!1;let ht=null;if(at["font-scale"]&&(ht=a.parseObjectValue(at["font-scale"],st,"font-scale",nn),!ht))return null;let ft=null;if(at["text-font"]&&(ft=a.parseObjectValue(at["text-font"],st,"text-font",wu(Kn)),!ft))return null;let xt=null;if(at["text-color"]&&(xt=a.parseObjectValue(at["text-color"],st,"text-color",$u),!xt))return null;const Et=$[$.length-1];Et.scale=ht,Et.font=ft,Et.textColor=xt}else{const ht=a.parse(s[st],st,yo);if(!ht)return null;const ft=ht.type.kind;if(ft!=="string"&&ft!=="value"&&ft!=="null"&&ft!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");it=!0,$.push({content:ht,scale:null,font:null,textColor:null})}}return new zp($)}evaluate(s){return new Pu(this.sections.map(a=>{const b=a.content.evaluate(s);return y0(iu(b),xy)?new _0("",b,null,null,null):new _0(dp(b),null,a.scale?a.scale.evaluate(s):null,a.font?a.font.evaluate(s).join(","):null,a.textColor?a.textColor.evaluate(s):null)}))}eachChild(s){for(const a of this.sections)s(a.content),a.scale&&s(a.scale),a.font&&s(a.font),a.textColor&&s(a.textColor)}outputDefined(){return!1}serialize(){const s=["format"];for(const a of this.sections){s.push(a.content.serialize());const b={};a.scale&&(b["font-scale"]=a.scale.serialize()),a.font&&(b["text-font"]=a.font.serialize()),a.textColor&&(b["text-color"]=a.textColor.serialize()),s.push(b)}return s}}class jn{constructor(s,a,b,$){this._imageWarnHistory={},this.type=xy,this.namePrimary=s,this.nameSecondary=a,b&&(this.paramsPrimary=b.params,this.iconsetIdPrimary=b.iconset?b.iconset.id:void 0),$&&(this.paramsSecondary=$.params,this.iconsetIdSecondary=$.iconset?$.iconset.id:void 0)}static parse(s,a){if(s.length<2)return a.error("Expected two or more arguments.");let b=1;const $=[];function it(){if(b<s.length){const at=a.parse(s[b],b++,Kn);return at?($.push({image:at,options:{}}),!0):(a.error($.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function st(){if(b<s.length){const ht=s[b];if((at=ht)===null||typeof at!="object"||Array.isArray(at))return!0;const ft=ht.params,xt=ht.iconset,Et=a.concat(b);if(!ft&&!xt)return b++,!0;if(ft){if(typeof ft!="object"||ft.constructor!==Object)return Et.error('Image options "params" should be an object'),!1;const Rt={},Pt=Et.concat(void 0,"params");for(const Lt in ft){if(!Lt)return Pt.error("Image parameter name should be non-empty"),!1;const Gt=Pt.concat(void 0,Lt).parse(ft[Lt],void 0,$u,void 0,{typeAnnotation:"coerce"});if(!Gt)return!1;Rt[Lt]=Gt}$[$.length-1].options.params=Rt}if(xt){if(typeof xt!="object"||xt.constructor!==Object)return Et.error('Image options "iconset" should be an object'),!1;if(!xt.id)return Et.error('Image options "iconset" should have an "id" property'),!1;$[$.length-1].options.iconset=xt}return b++,!0}var at;return!0}for(let at=0;at<2;at++)if(!it()||!st())return;return new jn($[0].image,$[1]?$[1].image:void 0,$[0].options,$[1]?$[1].options:void 0)}evaluateParams(s,a){const b={};if(a){for(const $ in a)if(a[$])try{b[$]=a[$].evaluate(s)}catch{continue}if(Object.keys(b).length!==0)return{params:b}}}evaluate(s){const a={name:this.namePrimary.evaluate(s),iconsetId:this.iconsetIdPrimary},b=this.nameSecondary?{name:this.nameSecondary.evaluate(s),iconsetId:this.iconsetIdSecondary}:void 0,$=Iu.build(a,b,this.paramsPrimary?this.evaluateParams(s,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(s,this.paramsSecondary):void 0);if($&&s.availableImages){const it=$.getPrimary().id;if($.available=s.availableImages.some(st=>Au.isEqual(st,it)),$.available){const st=$.getSecondary()?$.getSecondary().id:null;st&&($.available=s.availableImages.some(at=>Au.isEqual(at,st)))}}return $}eachChild(s){if(s(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&s(this.paramsPrimary[a]);if(this.nameSecondary&&(s(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&s(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(s,a){const b={};if(a&&(b.iconset={id:a}),s){b.params={};for(const $ in s)s[$]&&(b.params[$]=s[$].serialize())}return Object.keys(b).length>0?b:void 0}serialize(){const s=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&s.push(a)}if(this.nameSecondary&&(s.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&s.push(a)}return s}}function tn(g){return gn(g)?"string":Sx(g)?"number":b0(g)?"boolean":Array.isArray(g)?"array":g===null?"null":v0(g)?"object":typeof g}function v0(g){return g!=null&&!Array.isArray(g)&&typeof g!="function"&&!(g instanceof String||g instanceof Number||g instanceof Boolean)&&typeof g=="object"}function gn(g){return typeof g=="string"||g instanceof String}function Sx(g){return typeof g=="number"||g instanceof Number}function b0(g){return typeof g=="boolean"||g instanceof Boolean}const mn={"to-boolean":So,"to-color":$u,"to-number":nn,"to-string":Kn};class Op{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expected at least one argument.");const b=s[0],$=[];let it=Sp;if(b==="to-array"){if(!Array.isArray(s[1]))return null;const st=s[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);it=wu(a.expectedType.itemType,st)}else{if(!(st>0&&Ex(s[1][0])))return null;it=wu(iu(s[1][0]),st)}for(let at=0;at<st;at++){const ht=s[1][at];let ft;if(Array.isArray(ht))ft=a.parse(ht,void 0,it.itemType);else{const xt=tn(ht);if(xt!==it.itemType.kind)return a.error(`Expected ${it.itemType.kind} but found ${xt}.`);ft=a.registry.literal.parse(["literal",ht===void 0?null:ht],a)}if(!ft)return null;$.push(ft)}}else{if((b==="to-boolean"||b==="to-string")&&s.length!==2)return a.error("Expected one argument.");it=mn[b];for(let st=1;st<s.length;st++){const at=a.parse(s[st],st,yo);if(!at)return null;$.push(at)}}return new Op(it,$)}evaluate(s){if(this.type.kind==="boolean")return!!this.args[0].evaluate(s);if(this.type.kind==="color"){let a,b;for(const $ of this.args){if(a=$.evaluate(s),b=null,a instanceof vo)return a;if(typeof a=="string"){const it=s.parseColor(a);if(it)return it}else if(Array.isArray(a)&&(b=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:_g(a[0],a[1],a[2],a[3]),!b))return new vo(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new _c(b||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const b of this.args){if(a=b.evaluate(s),a===null)return 0;const $=Number(a);if(!isNaN($))return $}throw new _c(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Pu.fromString(dp(this.args[0].evaluate(s))):this.type.kind==="resolvedImage"?Iu.build(dp(this.args[0].evaluate(s))):this.type.kind==="array"?this.args.map(a=>a.evaluate(s)):dp(this.args[0].evaluate(s))}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){if(this.type.kind==="formatted")return new zp([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new jn(this.args[0]).serialize();const s=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{s.push(a.serialize())}),s}}const lv=["Unknown","Point","LineString","Polygon"];class w0{constructor(s,a,b){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=s,this.options=a,this.iconImageUseTheme=b}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lv[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(s){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:b,y:$}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(b*a-s[0])+this.featureDistanceData.bearing[1]*($*a-s[1])}return 0}parseColor(s){let a=this._parseColorCache[s];return a||(a=this._parseColorCache[s]=vo.parse(s)),a}getConfig(s){return this.options?this.options.get(s):null}}class ku{constructor(s,a,b,$,it){this.name=s,this.type=a,this._evaluate=b,this.args=$,this._overloadIndex=it}evaluate(s){if(!this._evaluate){const a=ku.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(s,this.args)}eachChild(s){this.args.forEach(s)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(s=>s.serialize()))}static parse(s,a){const b=s[0],$=ku.definitions[b];if(!$)return a.error(`Unknown expression "${b}". If you wanted a literal array, use ["literal", [...]].`,0);const it=Array.isArray($)?$[0]:$.type,st=Array.isArray($)?[[$[1],$[2]]]:$.overloads,at=[];let ht=null,ft=-1;for(const[xt,Et]of st){if(Array.isArray(xt)&&xt.length!==s.length-1)continue;at.push(xt),ft++,ht=new F0(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const Rt=[];let Pt=!1;for(let Lt=1;Lt<s.length;Lt++){const Gt=s[Lt],Kt=Array.isArray(xt)?xt[Lt-1]:xt.type,Xt=ht.parse(Gt,1+Rt.length,Kt);if(!Xt){Pt=!0;break}Rt.push(Xt)}if(!Pt)if(Array.isArray(xt)&&xt.length!==Rt.length)ht.error(`Expected ${xt.length} arguments, but found ${Rt.length} instead.`);else{for(let Lt=0;Lt<Rt.length;Lt++){const Gt=Array.isArray(xt)?xt[Lt]:xt.type,Kt=Rt[Lt];ht.concat(Lt+1).checkSubtype(Gt,Kt.type)}if(ht.errors.length===0)return new ku(b,it,Et,Rt,ft)}}if(at.length===1)a.errors.push(...ht.errors);else{const xt=(at.length?at:st.map(([Rt])=>Rt)).map(E0).join(" | "),Et=[];for(let Rt=1;Rt<s.length;Rt++){const Pt=a.parse(s[Rt],1+Et.length);if(!Pt)return null;Et.push(Vl(Pt.type))}a.error(`Expected arguments of type ${xt}, but found (${Et.join(", ")}) instead.`)}return null}static register(s,a){ku.definitions=a;for(const b in a)s[b]=ku}}function E0(g){return Array.isArray(g)?`(${g.map(Vl).join(", ")})`:`(${Vl(g.type)}...)`}class hu{constructor(s,a,b){this.type=x0,this.locale=b,this.caseSensitive=s,this.diacriticSensitive=a}static parse(s,a){if(s.length!==2)return a.error("Expected one argument.");const b=s[1];if(typeof b!="object"||Array.isArray(b))return a.error("Collator options argument must be an object.");const $=b["case-sensitive"]===void 0?a.parse(!1,1,So):a.parseObjectValue(b["case-sensitive"],1,"case-sensitive",So);if(!$)return null;const it=b["diacritic-sensitive"]===void 0?a.parse(!1,1,So):a.parseObjectValue(b["diacritic-sensitive"],1,"diacritic-sensitive",So);if(!it)return null;let st=null;return b.locale&&(st=a.parseObjectValue(b.locale,1,"locale",Kn),!st)?null:new hu($,it,st)}evaluate(s){return new ov(this.caseSensitive.evaluate(s),this.diacriticSensitive.evaluate(s),this.locale?this.locale.evaluate(s):null)}eachChild(s){s(this.caseSensitive),s(this.diacriticSensitive),this.locale&&s(this.locale)}outputDefined(){return!1}serialize(){const s={};return s["case-sensitive"]=this.caseSensitive.serialize(),s["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(s.locale=this.locale.serialize()),["collator",s]}}function S0(g,s,a=0,b=g.length-1,$=cv){for(;b>a;){if(b-a>600){const ht=b-a+1,ft=s-a+1,xt=Math.log(ht),Et=.5*Math.exp(2*xt/3),Rt=.5*Math.sqrt(xt*Et*(ht-Et)/ht)*(ft-ht/2<0?-1:1);S0(g,s,Math.max(a,Math.floor(s-ft*Et/ht+Rt)),Math.min(b,Math.floor(s+(ht-ft)*Et/ht+Rt)),$)}const it=g[s];let st=a,at=b;for(Rp(g,a,s),$(g[b],it)>0&&Rp(g,a,b);st<at;){for(Rp(g,st,at),st++,at--;$(g[st],it)<0;)st++;for(;$(g[at],it)>0;)at--}$(g[a],it)===0?Rp(g,a,at):(at++,Rp(g,at,b)),at<=s&&(a=at+1),s<=at&&(b=at-1)}}function Rp(g,s,a){const b=g[s];g[s]=g[a],g[a]=b}function cv(g,s){return g<s?-1:g>s?1:0}function Cm(g){let s=0;for(let a,b,$=0,it=g.length,st=it-1;$<it;st=$++)a=g[$],b=g[st],s+=(b.x-a.x)*(a.y+b.y);return s}function fp(g,s){g[0]=Math.min(g[0],s[0]),g[1]=Math.min(g[1],s[1]),g[2]=Math.max(g[2],s[0]),g[3]=Math.max(g[3],s[1])}function _y(g,s){return!(g[0]<=s[0]||g[2]>=s[2]||g[1]<=s[1]||g[3]>=s[3])}function QE(g,s,a){const b=g[0]-s[0],$=g[1]-s[1],it=g[0]-a[0],st=g[1]-a[1];return b*st-it*$==0&&b*it<=0&&$*st<=0}function Tx(g,s,a=!1){let b=!1;for(let at=0,ht=s.length;at<ht;at++){const ft=s[at];for(let xt=0,Et=ft.length,Rt=Et-1;xt<Et;Rt=xt++){const Pt=ft[Rt],Lt=ft[xt];if(QE(g,Pt,Lt))return a;(it=Pt)[1]>($=g)[1]!=(st=Lt)[1]>$[1]&&$[0]<(st[0]-it[0])*($[1]-it[1])/(st[1]-it[1])+it[0]&&(b=!b)}}var $,it,st;return b}function vy(g,s,a,b){const $=b[0]-a[0],it=b[1]-a[1],st=(g[0]-a[0])*it-$*(g[1]-a[1]),at=(s[0]-a[0])*it-$*(s[1]-a[1]);return st>0&&at<0||st<0&&at>0}function by(g,s,a,b){return($=[b[0]-a[0],b[1]-a[1]])[0]*(it=[s[0]-g[0],s[1]-g[1]])[1]-$[1]*it[0]!=0&&!(!vy(g,s,a,b)||!vy(a,b,g,s));var $,it}function Jp(g){const s=new ps(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new ps(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const b of g[0])s.x>b.x&&(s.x=b.x),s.y>b.y&&(s.y=b.y),a.x<b.x&&(a.x=b.x),a.y<b.y&&(a.y=b.y);return{min:s,max:a}}const Am=8192;function JE(g,s){const a=(180+g[0])/360,b=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,$=Math.pow(2,s.z);return[Math.round(a*$*Am),Math.round(b*$*Am)]}function uv(g,s){for(let a=0;a<s.length;a++)if(Tx(g,s[a]))return!0;return!1}function e2(g,s,a){for(const b of a)for(let $=0,it=b.length,st=it-1;$<it;st=$++)if(by(g,s,b[st],b[$]))return!0;return!1}function sw(g,s){for(let a=0;a<g.length;++a)if(!Tx(g[a],s))return!1;for(let a=0;a<g.length-1;++a)if(e2(g[a],g[a+1],s))return!1;return!0}function nw(g,s){for(let a=0;a<s.length;a++)if(sw(g,s[a]))return!0;return!1}function hv(g,s,a){const b=[];for(let $=0;$<g.length;$++){const it=[];for(let st=0;st<g[$].length;st++){const at=JE(g[$][st],a);fp(s,at),it.push(at)}b.push(it)}return b}function jm(g,s,a){const b=[];for(let $=0;$<g.length;$++){const it=hv(g[$],s,a);b.push(it)}return b}function ow(g,s,a,b){if(g[0]<a[0]||g[0]>a[2]){const $=.5*b;let it=g[0]-a[0]>$?-b:a[0]-g[0]>$?b:0;it===0&&(it=g[0]-a[2]>$?-b:a[2]-g[0]>$?b:0),g[0]+=it}fp(s,g)}function aw(g,s,a,b){const $=Math.pow(2,b.z)*Am,it=[b.x*Am,b.y*Am],st=[];if(!g)return st;for(const at of g)for(const ht of at){const ft=[ht.x+it[0],ht.y+it[1]];ow(ft,s,a,$),st.push(ft)}return st}function T0(g,s,a,b){const $=Math.pow(2,b.z)*Am,it=[b.x*Am,b.y*Am],st=[];if(!g)return st;for(const ht of g){const ft=[];for(const xt of ht){const Et=[xt.x+it[0],xt.y+it[1]];fp(s,Et),ft.push(Et)}st.push(ft)}if(s[2]-s[0]<=$/2){(at=s)[0]=at[1]=1/0,at[2]=at[3]=-1/0;for(const ht of st)for(const ft of ht)ow(ft,s,a,$)}var at;return st}class Pm{constructor(s,a){this.type=So,this.geojson=s,this.geometries=a}static parse(s,a){if(s.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${s.length-1} instead.`);if(Ex(s[1])){const b=s[1];if(b.type==="FeatureCollection")for(let $=0;$<b.features.length;++$){const it=b.features[$].geometry.type;if(it==="Polygon"||it==="MultiPolygon")return new Pm(b,b.features[$].geometry)}else if(b.type==="Feature"){const $=b.geometry.type;if($==="Polygon"||$==="MultiPolygon")return new Pm(b,b.geometry)}else if(b.type==="Polygon"||b.type==="MultiPolygon")return new Pm(b,b)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(s){if(s.geometry()!=null&&s.canonicalID()!=null){if(s.geometryType()==="Point")return function(a,b){const $=[1/0,1/0,-1/0,-1/0],it=[1/0,1/0,-1/0,-1/0],st=a.canonicalID();if(!st)return!1;if(b.type==="Polygon"){const at=hv(b.coordinates,it,st),ht=aw(a.geometry(),$,it,st);if(!_y($,it))return!1;for(const ft of ht)if(!Tx(ft,at))return!1}if(b.type==="MultiPolygon"){const at=jm(b.coordinates,it,st),ht=aw(a.geometry(),$,it,st);if(!_y($,it))return!1;for(const ft of ht)if(!uv(ft,at))return!1}return!0}(s,this.geometries);if(s.geometryType()==="LineString")return function(a,b){const $=[1/0,1/0,-1/0,-1/0],it=[1/0,1/0,-1/0,-1/0],st=a.canonicalID();if(!st)return!1;if(b.type==="Polygon"){const at=hv(b.coordinates,it,st),ht=T0(a.geometry(),$,it,st);if(!_y($,it))return!1;for(const ft of ht)if(!sw(ft,at))return!1}if(b.type==="MultiPolygon"){const at=jm(b.coordinates,it,st),ht=T0(a.geometry(),$,it,st);if(!_y($,it))return!1;for(const ft of ht)if(!nw(ft,at))return!1}return!0}(s,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const wy={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},pp=1/298.257223563,lw=pp*(2-pp),Rx=Math.PI/180;class Cx{static fromTile(s,a,b){const $=Math.PI*(1-2*(s+.5)/Math.pow(2,a)),it=Math.atan(.5*(Math.exp($)-Math.exp(-$)))/Rx;return new Cx(it,b)}static get units(){return wy}constructor(s,a){if(s===void 0)throw new Error("No latitude given.");if(a&&!wy[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(wy).join(", ")}`);const b=6378.137*Rx*(a?wy[a]:1),$=Math.cos(s*Rx),it=1/(1-lw*(1-$*$)),st=Math.sqrt(it);this.kx=b*st*$,this.ky=b*st*it*(1-lw)}distance(s,a){const b=_d(s[0]-a[0])*this.kx,$=(s[1]-a[1])*this.ky;return Math.sqrt(b*b+$*$)}bearing(s,a){const b=_d(a[0]-s[0])*this.kx;return Math.atan2(b,(a[1]-s[1])*this.ky)/Rx}destination(s,a,b){const $=b*Rx;return this.offset(s,Math.sin($)*a,Math.cos($)*a)}offset(s,a,b){return[s[0]+a/this.kx,s[1]+b/this.ky]}lineDistance(s){let a=0;for(let b=0;b<s.length-1;b++)a+=this.distance(s[b],s[b+1]);return a}area(s){let a=0;for(let b=0;b<s.length;b++){const $=s[b];for(let it=0,st=$.length,at=st-1;it<st;at=it++)a+=_d($[it][0]-$[at][0])*($[it][1]+$[at][1])*(b?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(s,a){let b=0;if(a<=0)return s[0];for(let $=0;$<s.length-1;$++){const it=s[$],st=s[$+1],at=this.distance(it,st);if(b+=at,b>a)return R0(it,st,(a-(b-at))/at)}return s[s.length-1]}pointToSegmentDistance(s,a,b){let[$,it]=a,st=_d(b[0]-$)*this.kx,at=(b[1]-it)*this.ky;if(st!==0||at!==0){const ht=(_d(s[0]-$)*this.kx*st+(s[1]-it)*this.ky*at)/(st*st+at*at);ht>1?($=b[0],it=b[1]):ht>0&&($+=st/this.kx*ht,it+=at/this.ky*ht)}return st=_d(s[0]-$)*this.kx,at=(s[1]-it)*this.ky,Math.sqrt(st*st+at*at)}pointOnLine(s,a){let b=1/0,$=s[0][0],it=s[0][1],st=0,at=0;for(let ht=0;ht<s.length-1;ht++){let ft=s[ht][0],xt=s[ht][1],Et=_d(s[ht+1][0]-ft)*this.kx,Rt=(s[ht+1][1]-xt)*this.ky,Pt=0;Et===0&&Rt===0||(Pt=(_d(a[0]-ft)*this.kx*Et+(a[1]-xt)*this.ky*Rt)/(Et*Et+Rt*Rt),Pt>1?(ft=s[ht+1][0],xt=s[ht+1][1]):Pt>0&&(ft+=Et/this.kx*Pt,xt+=Rt/this.ky*Pt)),Et=_d(a[0]-ft)*this.kx,Rt=(a[1]-xt)*this.ky;const Lt=Et*Et+Rt*Rt;Lt<b&&(b=Lt,$=ft,it=xt,st=ht,at=Pt)}return{point:[$,it],index:st,t:Math.max(0,Math.min(1,at))}}lineSlice(s,a,b){let $=this.pointOnLine(b,s),it=this.pointOnLine(b,a);if($.index>it.index||$.index===it.index&&$.t>it.t){const ft=$;$=it,it=ft}const st=[$.point],at=$.index+1,ht=it.index;!dv(b[at],st[0])&&at<=ht&&st.push(b[at]);for(let ft=at+1;ft<=ht;ft++)st.push(b[ft]);return dv(b[ht],it.point)||st.push(it.point),st}lineSliceAlong(s,a,b){let $=0;const it=[];for(let st=0;st<b.length-1;st++){const at=b[st],ht=b[st+1],ft=this.distance(at,ht);if($+=ft,$>s&&it.length===0&&it.push(R0(at,ht,(s-($-ft))/ft)),$>=a)return it.push(R0(at,ht,(a-($-ft))/ft)),it;$>s&&it.push(ht)}return it}bufferPoint(s,a){const b=a/this.ky,$=a/this.kx;return[s[0]-$,s[1]-b,s[0]+$,s[1]+b]}bufferBBox(s,a){const b=a/this.ky,$=a/this.kx;return[s[0]-$,s[1]-b,s[2]+$,s[3]+b]}insideBBox(s,a){return _d(s[0]-a[0])>=0&&_d(s[0]-a[2])<=0&&s[1]>=a[1]&&s[1]<=a[3]}}function dv(g,s){return g[0]===s[0]&&g[1]===s[1]}function R0(g,s,a){const b=_d(s[0]-g[0]);return[g[0]+b*a,g[1]+(s[1]-g[1])*a]}function _d(g){for(;g<-180;)g+=360;for(;g>180;)g-=360;return g}class C0{constructor(s=[],a=(b,$)=>b<$?-1:b>$?1:0){if(this.data=s,this.length=this.data.length,this.compare=a,this.length>0)for(let b=(this.length>>1)-1;b>=0;b--)this._down(b)}push(s){this.data.push(s),this._up(this.length++)}pop(){if(this.length===0)return;const s=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),s}peek(){return this.data[0]}_up(s){const{data:a,compare:b}=this,$=a[s];for(;s>0;){const it=s-1>>1,st=a[it];if(b($,st)>=0)break;a[s]=st,s=it}a[s]=$}_down(s){const{data:a,compare:b}=this,$=this.length>>1,it=a[s];for(;s<$;){let st=1+(s<<1);const at=st+1;if(at<this.length&&b(a[at],a[st])<0&&(st=at),b(a[st],it)>=0)break;a[s]=a[st],s=st}a[s]=it}}var Ps=8192;function fv(g,s){return s.dist-g.dist}const A0=100,j0=50;function pv(g){const s=[1/0,1/0,-1/0,-1/0];if(s.length!==g.length)return!1;for(let a=0;a<s.length;a++)if(s[a]!==g[a])return!1;return!0}function Ey(g){return g[1]-g[0]+1}function Bp(g,s){const a=g[1]>=g[0]&&g[1]<s;return a||console.warn("Distance Expression: Index is out of range"),a}function mv(g,s){if(g[0]>g[1])return[null,null];const a=Ey(g);if(s){if(a===2)return[g,null];const b=Math.floor(a/2);return[[g[0],g[0]+b],[g[0]+b,g[1]]]}{if(a===1)return[g,null];const b=Math.floor(a/2)-1;return[[g[0],g[0]+b],[g[0]+b+1,g[1]]]}}function ex(g,s){const a=[1/0,1/0,-1/0,-1/0];if(!Bp(s,g.length))return a;for(let b=s[0];b<=s[1];++b)fp(a,g[b]);return a}function tx(g){const s=[1/0,1/0,-1/0,-1/0];for(let a=0;a<g.length;++a)for(let b=0;b<g[a].length;++b)fp(s,g[a][b]);return s}function Im(g,s,a){if(pv(g)||pv(s))return NaN;let b=0,$=0;return g[2]<s[0]&&(b=s[0]-g[2]),g[0]>s[2]&&(b=g[0]-s[2]),g[1]>s[3]&&($=g[1]-s[3]),g[3]<s[1]&&($=s[1]-g[3]),a.distance([0,0],[b,$])}function P0(g){return 360*g-180}function cw(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function I0(g,s){const a=Math.pow(2,s.z),b=(g.y/Ps+s.y)/a;return[P0((g.x/Ps+s.x)/a),cw(b)]}function t2(g,s){const a=[];for(let b=0;b<g.length;++b)a.push(I0(g[b],s));return a}function uw(g,s,a){const b=a.pointOnLine(s,g).point;return a.distance(g,b)}function gv(g,s,a,b,$){const it=a.slice(b[0],b[1]+1);let st=1/0;for(let at=s[0];at<=s[1];++at)if((st=Math.min(st,uw(g[at],it,$)))===0)return 0;return st}function km(g,s,a,b,$){const it=Math.min($.pointToSegmentDistance(g,a,b),$.pointToSegmentDistance(s,a,b)),st=Math.min($.pointToSegmentDistance(a,g,s),$.pointToSegmentDistance(b,g,s));return Math.min(it,st)}function Qn(g,s,a,b,$){if(!Bp(s,g.length)||!Bp(b,a.length))return NaN;let it=1/0;for(let st=s[0];st<s[1];++st)for(let at=b[0];at<b[1];++at){if(by(g[st],g[st+1],a[at],a[at+1]))return 0;it=Math.min(it,km(g[st],g[st+1],a[at],a[at+1],$))}return it}function r2(g,s,a,b,$){if(!Bp(s,g.length)||!Bp(b,a.length))return NaN;let it=1/0;for(let st=s[0];st<=s[1];++st)for(let at=b[0];at<=b[1];++at)if((it=Math.min(it,$.distance(g[st],a[at])))===0)return it;return it}function i2(g,s,a){if(Tx(g,s,!0))return 0;let b=1/0;for(const $ of s){const it=$.length;if(it<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if($[0]!==$[it-1]&&(b=Math.min(b,a.pointToSegmentDistance(g,$[it-1],$[0])))===0||(b=Math.min(b,uw(g,$,a)))===0)return b}return b}function s2(g,s,a,b){if(!Bp(s,g.length))return NaN;for(let it=s[0];it<=s[1];++it)if(Tx(g[it],a,!0))return 0;let $=1/0;for(let it=s[0];it<s[1];++it)for(const st of a)for(let at=0,ht=st.length,ft=ht-1;at<ht;ft=at++){if(by(g[it],g[it+1],st[ft],st[at]))return 0;$=Math.min($,km(g[it],g[it+1],st[ft],st[at],b))}return $}function xv(g,s){for(const a of g)for(let b=0;b<=a.length-1;++b)if(Tx(a[b],s,!0))return!0;return!1}function n2(g,s,a,b=1/0){const $=tx(g),it=tx(s);if(b!==1/0&&Im($,it,a)>=b)return b;if(_y($,it)){if(xv(g,s))return 0}else if(xv(s,g))return 0;let st=b;for(const at of g)for(let ht=0,ft=at.length,xt=ft-1;ht<ft;xt=ht++)for(const Et of s)for(let Rt=0,Pt=Et.length,Lt=Pt-1;Rt<Pt;Lt=Rt++){if(by(at[xt],at[ht],Et[Lt],Et[Rt]))return 0;st=Math.min(st,km(at[xt],at[ht],Et[Lt],Et[Rt],a))}return st}function Jo(g,s,a,b,$,it,st){if(it===null||st===null)return;const at=Im(ex(b,it),ex($,st),a);at<s&&g.push({dist:at,range1:it,range2:st})}function o2(g,s,a,b,$=1/0){let it=Math.min(b.distance(g[0],a[0][0]),$);if(it===0)return it;const st=new C0([{dist:0,range1:[0,g.length-1],range2:[0,0]}],fv),at=s?j0:A0,ht=tx(a);for(;st.length;){const ft=st.pop();if(ft.dist>=it)continue;const xt=ft.range1;if(Ey(xt)<=at){if(!Bp(xt,g.length))return NaN;if(s){const Et=s2(g,xt,a,b);if((it=Math.min(it,Et))===0)return it}else for(let Et=xt[0];Et<=xt[1];++Et){const Rt=i2(g[Et],a,b);if((it=Math.min(it,Rt))===0)return it}}else{const Et=mv(xt,s);if(Et[0]!==null){const Rt=Im(ex(g,Et[0]),ht,b);Rt<it&&st.push({dist:Rt,range1:Et[0],range2:[0,0]})}if(Et[1]!==null){const Rt=Im(ex(g,Et[1]),ht,b);Rt<it&&st.push({dist:Rt,range1:Et[1],range2:[0,0]})}}}return it}function hw(g,s,a,b,$,it=1/0){let st=Math.min(it,$.distance(g[0],a[0]));if(st===0)return st;const at=new C0([{dist:0,range1:[0,g.length-1],range2:[0,a.length-1]}],fv),ht=s?j0:A0,ft=b?j0:A0;for(;at.length;){const xt=at.pop();if(xt.dist>=st)continue;const Et=xt.range1,Rt=xt.range2;if(Ey(Et)<=ht&&Ey(Rt)<=ft){if(!Bp(Et,g.length)||!Bp(Rt,a.length))return NaN;if(s&&b?st=Math.min(st,Qn(g,Et,a,Rt,$)):s||b?s&&!b?st=Math.min(st,gv(a,Rt,g,Et,$)):!s&&b&&(st=Math.min(st,gv(g,Et,a,Rt,$))):st=Math.min(st,r2(g,Et,a,Rt,$)),st===0)return st}else{const Pt=mv(Et,s),Lt=mv(Rt,b);Jo(at,st,$,g,a,Pt[0],Lt[0]),Jo(at,st,$,g,a,Pt[0],Lt[1]),Jo(at,st,$,g,a,Pt[1],Lt[0]),Jo(at,st,$,g,a,Pt[1],Lt[1])}}return st}function yv(g,s,a,b,$=1/0){let it=$;const st=ex(g,[0,g.length-1]);for(const at of a)if(!(it!==1/0&&Im(st,ex(at,[0,at.length-1]),b)>=it)&&(it=Math.min(it,hw(g,s,at,!0,b,it)),it===0))return it;return it}function k0(g,s,a,b,$=1/0){let it=$;const st=ex(g,[0,g.length-1]);for(const at of a){if(it!==1/0&&Im(st,tx(at),b)>=it)continue;const ht=o2(g,s,at,b,it);if(isNaN(ht))return ht;if((it=Math.min(it,ht))===0)return it}return it}function _v(g){return g==="Point"||g==="MultiPoint"||g==="LineString"||g==="MultiLineString"||g==="Polygon"||g==="MultiPolygon"}class rx{constructor(s,a){this.type=nn,this.geojson=s,this.geometries=a}static parse(s,a){if(s.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${s.length-1} instead.`);if(Ex(s[1])){const b=s[1];if(b.type==="FeatureCollection"){for(let $=0;$<b.features.length;++$)if(_v(b.features[$].geometry.type))return new rx(b,b.features[$].geometry)}else if(b.type==="Feature"){if(_v(b.geometry.type))return new rx(b,b.geometry)}else if(_v(b.type))return new rx(b,b)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(s){const a=s.geometry(),b=s.canonicalID();if(a!=null&&b!=null){if(s.geometryType()==="Point")return function($,it,st){const at=[];for(const ft of $)for(const xt of ft)at.push(I0(xt,it));const ht=new Cx(at[0][1],"meters");return st.type==="Point"||st.type==="MultiPoint"||st.type==="LineString"?hw(at,!1,st.type==="Point"?[st.coordinates]:st.coordinates,st.type==="LineString",ht):st.type==="MultiLineString"?yv(at,!1,st.coordinates,ht):st.type==="Polygon"||st.type==="MultiPolygon"?k0(at,!1,st.type==="Polygon"?[st.coordinates]:st.coordinates,ht):null}(a,b,this.geometries);if(s.geometryType()==="LineString")return function($,it,st){const at=[];for(const ft of $){const xt=[];for(const Et of ft)xt.push(I0(Et,it));at.push(xt)}const ht=new Cx(at[0][0][1],"meters");if(st.type==="Point"||st.type==="MultiPoint"||st.type==="LineString")return yv(st.type==="Point"?[st.coordinates]:st.coordinates,st.type==="LineString",at,ht);if(st.type==="MultiLineString"){let ft=1/0;for(let xt=0;xt<st.coordinates.length;xt++){const Et=yv(st.coordinates[xt],!0,at,ht,ft);if(isNaN(Et))return Et;if((ft=Math.min(ft,Et))===0)return ft}return ft}if(st.type==="Polygon"||st.type==="MultiPolygon"){let ft=1/0;for(let xt=0;xt<at.length;xt++){const Et=k0(at[xt],!0,st.type==="Polygon"?[st.coordinates]:st.coordinates,ht,ft);if(isNaN(Et))return Et;if((ft=Math.min(ft,Et))===0)return ft}return ft}return null}(a,b,this.geometries);if(s.geometryType()==="Polygon")return function($,it,st){const at=[];for(const ft of function(xt,Et){const Rt=xt.length;if(Rt<=1)return[xt];const Pt=[];let Lt,Gt;for(let Kt=0;Kt<Rt;Kt++){const Xt=Cm(xt[Kt]);Xt!==0&&(xt[Kt].area=Math.abs(Xt),Gt===void 0&&(Gt=Xt<0),Gt===Xt<0?(Lt&&Pt.push(Lt),Lt=[xt[Kt]]):Lt.push(xt[Kt]))}return Lt&&Pt.push(Lt),Pt}($)){const xt=[];for(let Et=0;Et<ft.length;++Et)xt.push(t2(ft[Et],it));at.push(xt)}const ht=new Cx(at[0][0][0][1],"meters");if(st.type==="Point"||st.type==="MultiPoint"||st.type==="LineString")return k0(st.type==="Point"?[st.coordinates]:st.coordinates,st.type==="LineString",at,ht);if(st.type==="MultiLineString"){let ft=1/0;for(let xt=0;xt<st.coordinates.length;xt++){const Et=k0(st.coordinates[xt],!0,at,ht,ft);if(isNaN(Et))return Et;if((ft=Math.min(ft,Et))===0)return ft}return ft}return st.type==="Polygon"||st.type==="MultiPolygon"?function(ft,xt,Et){let Rt=1/0;for(const Pt of ft)for(const Lt of xt){const Gt=n2(Pt,Lt,Et,Rt);if(isNaN(Gt))return Gt;if((Rt=Math.min(Rt,Gt))===0)return Rt}return Rt}(st.type==="Polygon"?[st.coordinates]:st.coordinates,at,ht):null}(a,b,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ax(g){if(g instanceof ku&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof Pm||g instanceof rx)return!1;if(g instanceof Px)return g.featureConstant;let s=!0;return g.eachChild(a=>{s&&!Ax(a)&&(s=!1)}),s}function Sy(g){if(g instanceof ku&&g.name==="feature-state")return!1;let s=!0;return g.eachChild(a=>{s&&!Sy(a)&&(s=!1)}),s}function jx(g,s){if(g instanceof ku&&s.indexOf(g.name)>=0)return!1;let a=!0;return g.eachChild(b=>{a&&!jx(b,s)&&(a=!1)}),a}function dw(g,s,a){return[g,s,a].filter(Boolean).join("")}function vv(g,s){switch(g){case"string":return dp(s);case"number":return+s;case"boolean":return!!s;case"color":return vo.parse(s);case"formatted":return Pu.fromString(dp(s));case"resolvedImage":return Iu.build(dp(s))}return s}function fw(g,s,a,b){return b!==void 0&&(g=b*Math.round(g/b)),s!==void 0&&g<s&&(g=s),a!==void 0&&g>a&&(g=a),g}class Px{constructor(s,a,b,$=!1){this.type=s,this.key=a,this.scope=b,this.featureConstant=$}static parse(s,a){let b=a.expectedType;if(b==null&&(b=yo),s.length<2||s.length>3)return a.error("Invalid number of arguments for 'config' expression.");const $=a.parse(s[1],1);if(!($ instanceof Qp))return a.error("Key name of 'config' expression must be a string literal.");let it,st=!0;const at=dp($.value);if(s.length>=3){const ht=a.parse(s[2],2);if(!(ht instanceof Qp))return a.error("Scope of 'config' expression must be a string literal.");it=dp(ht.value)}if(a.options){const ht=dw(at,it,a._scope),ft=a.options.get(ht);ft&&(st=Ax(ft.value||ft.default))}return new Px(b,at,it,st)}evaluate(s){const a=dw(this.key,this.scope,s.scope),b=s.getConfig(a);if(!b)return null;const{type:$,value:it,values:st,minValue:at,maxValue:ht,stepValue:ft}=b,xt=b.default.evaluate(s);let Et=xt;if(it){const Rt=s.scope;s.scope=(Rt||"").split("").slice(1).join(""),Et=it.evaluate(s),s.scope=Rt}return $&&(Et=vv($,Et)),Et===void 0||at===void 0&&ht===void 0&&ft===void 0||(typeof Et=="number"?Et=fw(Et,at,ht,ft):Array.isArray(Et)&&(Et=Et.map(Rt=>typeof Rt=="number"?fw(Rt,at,ht,ft):Rt))),it!==void 0&&Et!==void 0&&st&&!st.includes(Et)&&(Et=xt,$&&(Et=vv($,Et))),($&&$!==this.type||Et!==void 0&&!y0(iu(Et),this.type))&&(Et=vv(this.type.kind,Et)),Et}eachChild(){}outputDefined(){return!1}serialize(){const s=["config",this.key];return this.scope&&s.concat(this.scope),s}}class M0{constructor(s,a){this.type=a.type,this.name=s,this.boundExpression=a}static parse(s,a){if(s.length!==2||typeof s[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const b=s[1];return a.scope.has(b)?new M0(b,a.scope.get(b)):a.error(`Unknown variable "${b}". Make sure "${b}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(s){return this.boundExpression.evaluate(s)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class F0{constructor(s,a=[],b,$=new wx,it=[],st,at,ht){this.registry=s,this.path=a,this.key=a.map(ft=>typeof ft=="string"?`['${ft}']`:`[${ft}]`).join(""),this.scope=$,this.errors=it,this.expectedType=b,this._scope=st,this.options=at,this.iconImageUseTheme=ht}parse(s,a,b,$,it={}){return a||b?this.concat(a,null,b,$)._parse(s,it):this._parse(s,it)}parseObjectValue(s,a,b,$,it,st={}){return this.concat(a,b,$,it)._parse(s,st)}_parse(s,a){function b($,it,st){return st==="assert"?new Tp(it,[$]):st==="coerce"?new Op(it,[$]):$}if(s!==null&&typeof s!="string"&&typeof s!="boolean"&&typeof s!="number"||(s=["literal",s]),Array.isArray(s)){if(s.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const $=typeof s[0]=="string"?this.registry[s[0]]:void 0;if($){let it=$.parse(s,this);if(!it)return null;if(this.expectedType){const st=this.expectedType,at=it.type;if(st.kind!=="string"&&st.kind!=="number"&&st.kind!=="boolean"&&st.kind!=="object"&&st.kind!=="array"||at.kind!=="value")if(st.kind!=="color"&&st.kind!=="formatted"&&st.kind!=="resolvedImage"||at.kind!=="value"&&at.kind!=="string"){if(this.checkSubtype(st,at))return null}else it=b(it,st,a.typeAnnotation||"coerce");else it=b(it,st,a.typeAnnotation||"assert")}if(!(it instanceof Qp)&&it.type.kind!=="resolvedImage"&&bv(it)){const st=new w0(this._scope,this.options,this.iconImageUseTheme);try{it=new Qp(it.type,it.evaluate(st))}catch(at){return this.error(at.message),null}}return it}return Op.parse(["to-array",s],this)}return this.error(s===void 0?"'undefined' value invalid. Use null instead.":typeof s=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof s} instead.`)}concat(s,a,b,$){let it=typeof s=="number"?this.path.concat(s):this.path;it=typeof a=="string"?it.concat(a):it;const st=$?this.scope.concat($):this.scope;return new F0(this.registry,it,b||null,st,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(s,...a){const b=`${this.key}${a.map($=>`[${$}]`).join("")}`;this.errors.push(new hp(b,s))}checkSubtype(s,a){const b=Rm(s,a);return b&&this.error(b),b}}function bv(g){if(g instanceof M0)return bv(g.boundExpression);if(g instanceof ku&&g.name==="error"||g instanceof hu||g instanceof Pm||g instanceof rx||g instanceof Px)return!1;const s=g instanceof Op||g instanceof Tp;let a=!0;return g.eachChild(b=>{a=s?a&&bv(b):a&&b instanceof Qp}),!!a&&Ax(g)&&jx(g,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function L0(g,s){const a=g.length-1;let b,$,it=0,st=a,at=0;for(;it<=st;)if(at=Math.floor((it+st)/2),b=g[at],$=g[at+1],b<=s){if(at===a||s<$)return at;it=at+1}else{if(!(b>s))throw new _c("Input is not a number.");st=at-1}return 0}class Ty{constructor(s,a,b){this.type=s,this.input=a,this.labels=[],this.outputs=[];for(const[$,it]of b)this.labels.push($),this.outputs.push(it)}static parse(s,a){if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if((s.length-1)%2!=0)return a.error("Expected an even number of arguments.");const b=a.parse(s[1],1,nn);if(!b)return null;const $=[];let it=null;a.expectedType&&a.expectedType.kind!=="value"&&(it=a.expectedType);for(let st=1;st<s.length;st+=2){const at=st===1?-1/0:s[st],ht=s[st+1],ft=st,xt=st+1;if(typeof at!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ft);if($.length&&$[$.length-1][0]>=at)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ft);const Et=a.parse(ht,xt,it);if(!Et)return null;it=it||Et.type,$.push([at,Et])}return new Ty(it,b,$)}evaluate(s){const a=this.labels,b=this.outputs;if(a.length===1)return b[0].evaluate(s);const $=this.input.evaluate(s);if($<=a[0])return b[0].evaluate(s);const it=a.length;return $>=a[it-1]?b[it-1].evaluate(s):b[L0(a,$)].evaluate(s)}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){const s=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&s.push(this.labels[a]),s.push(this.outputs[a].serialize());return s}}const pw=.95047,mw=1.08883,gw=4/29,Ix=6/29,xw=3*Ix*Ix,a2=Ix*Ix*Ix,l2=Math.PI/180,c2=180/Math.PI;function wv(g){return g>a2?Math.pow(g,1/3):g/xw+gw}function Ev(g){return g>Ix?g*g*g:xw*(g-gw)}function Sv(g){return 255*(g<=.0031308?12.92*g:1.055*Math.pow(g,1/2.4)-.055)}function Tv(g){return(g/=255)<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function yw(g){const s=Tv(g.r),a=Tv(g.g),b=Tv(g.b),$=wv((.4124564*s+.3575761*a+.1804375*b)/pw),it=wv((.2126729*s+.7151522*a+.072175*b)/1);return{l:116*it-16,a:500*($-it),b:200*(it-wv((.0193339*s+.119192*a+.9503041*b)/mw)),alpha:g.a}}function D0(g){let s=(g.l+16)/116,a=isNaN(g.a)?s:s+g.a/500,b=isNaN(g.b)?s:s-g.b/200;return s=1*Ev(s),a=pw*Ev(a),b=mw*Ev(b),new vo(Sv(3.2404542*a-1.5371385*s-.4985314*b),Sv(-.969266*a+1.8760108*s+.041556*b),Sv(.0556434*a-.2040259*s+1.0572252*b),g.alpha)}function N0(g,s,a){const b=s-g;return g+a*(b>180||b<-180?b-360*Math.round(b/360):b)}const kx={forward:yw,reverse:D0,interpolate:function(g,s,a){return{l:pn(g.l,s.l,a),a:pn(g.a,s.a,a),b:pn(g.b,s.b,a),alpha:pn(g.alpha,s.alpha,a)}}},Ry={forward:function(g){const{l:s,a,b}=yw(g),$=Math.atan2(b,a)*c2;return{h:$<0?$+360:$,c:Math.sqrt(a*a+b*b),l:s,alpha:g.a}},reverse:function(g){const s=g.h*l2,a=g.c;return D0({l:g.l,a:Math.cos(s)*a,b:Math.sin(s)*a,alpha:g.alpha})},interpolate:function(g,s,a){return{h:N0(g.h,s.h,a),c:pn(g.c,s.c,a),l:pn(g.l,s.l,a),alpha:pn(g.alpha,s.alpha,a)}}};var _w=Object.freeze({__proto__:null,hcl:Ry,lab:kx});class _f{constructor(s,a,b,$,it){this.type=s,this.operator=a,this.interpolation=b,this.input=$,this.labels=[],this.outputs=[];for(const[st,at]of it)this.labels.push(st),this.outputs.push(at)}static interpolationFactor(s,a,b,$){let it=0;if(s.name==="exponential")it=z0(a,s.base,b,$);else if(s.name==="linear")it=z0(a,1,b,$);else if(s.name==="cubic-bezier"){const st=s.controlPoints;it=new lu(st[0],st[1],st[2],st[3]).solve(z0(a,1,b,$))}return it}static parse(s,a){let[b,$,it,...st]=s;if(!Array.isArray($)||$.length===0)return a.error("Expected an interpolation type expression.",1);if($[0]==="linear")$={name:"linear"};else if($[0]==="exponential"){const ft=$[1];if(typeof ft!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);$={name:"exponential",base:ft}}else{if($[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String($[0])}`,1,0);{const ft=$.slice(1);if(ft.length!==4||ft.some(xt=>typeof xt!="number"||xt<0||xt>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);$={name:"cubic-bezier",controlPoints:ft}}}if(s.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length-1>3&&(s.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(it=a.parse(it,2,nn),!it)return null;const at=[];let ht=null;b==="interpolate-hcl"||b==="interpolate-lab"?ht=$u:a.expectedType&&a.expectedType.kind!=="value"&&(ht=a.expectedType);for(let ft=0;ft<st.length;ft+=2){const xt=st[ft],Et=st[ft+1],Rt=ft+3,Pt=ft+4;if(typeof xt!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Rt);if(at.length&&at[at.length-1][0]>=xt)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Rt);const Lt=a.parse(Et,Pt,ht);if(!Lt)return null;ht=ht||Lt.type,at.push([xt,Lt])}return ht.kind==="number"||ht.kind==="color"||ht.kind==="array"&&ht.itemType.kind==="number"&&typeof ht.N=="number"?new _f(ht,b,$,it,at):a.error(`Type ${Vl(ht)} is not interpolatable.`)}evaluate(s){const a=this.labels,b=this.outputs;if(a.length===1)return b[0].evaluate(s);const $=this.input.evaluate(s);if($<=a[0])return b[0].evaluate(s);const it=a.length;if($>=a[it-1])return b[it-1].evaluate(s);const st=L0(a,$),at=_f.interpolationFactor(this.interpolation,$,a[st],a[st+1]),ht=b[st].evaluate(s),ft=b[st+1].evaluate(s);return this.operator==="interpolate"?my[this.type.kind.toLowerCase()](ht,ft,at):this.operator==="interpolate-hcl"?Ry.reverse(Ry.interpolate(Ry.forward(ht),Ry.forward(ft),at)):kx.reverse(kx.interpolate(kx.forward(ht),kx.forward(ft),at))}eachChild(s){s(this.input);for(const a of this.outputs)s(a)}outputDefined(){return this.outputs.every(s=>s.outputDefined())}serialize(){let s;s=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,s,this.input.serialize()];for(let b=0;b<this.labels.length;b++)a.push(this.labels[b],this.outputs[b].serialize());return a}}function z0(g,s,a,b){const $=b-a,it=g-a;return $===0?0:s===1?it/$:(Math.pow(s,it)-1)/(Math.pow(s,$)-1)}class Cy{constructor(s,a){this.type=s,this.args=a}static parse(s,a){if(s.length<2)return a.error("Expectected at least one argument.");let b=null;const $=a.expectedType;$&&$.kind!=="value"&&(b=$);const it=[];for(const at of s.slice(1)){const ht=a.parse(at,1+it.length,b,void 0,{typeAnnotation:"omit"});if(!ht)return null;b=b||ht.type,it.push(ht)}const st=$&&it.some(at=>Rm($,at.type));return new Cy(st?yo:b,it)}evaluate(s){let a,b=null,$=0;for(const it of this.args){if($++,b=it.evaluate(s),b&&b instanceof Iu&&!b.available&&(a||(a=b),b=null,$===this.args.length))return a;if(b!==null)break}return b}eachChild(s){this.args.forEach(s)}outputDefined(){return this.args.every(s=>s.outputDefined())}serialize(){const s=["coalesce"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class em{constructor(s,a){this.type=a.type,this.bindings=[].concat(s),this.result=a}evaluate(s){return this.result.evaluate(s)}eachChild(s){for(const a of this.bindings)s(a[1]);s(this.result)}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found ${s.length-1} instead.`);const b=[];for(let it=1;it<s.length-1;it+=2){const st=s[it];if(typeof st!="string")return a.error(`Expected string, but found ${typeof st} instead.`,it);if(/[^a-zA-Z0-9_]/.test(st))return a.error("Variable names must contain only alphanumeric characters or '_'.",it);const at=a.parse(s[it+1],it+1);if(!at)return null;b.push([st,at])}const $=a.parse(s[s.length-1],s.length-1,a.expectedType,b);return $?new em(b,$):null}outputDefined(){return this.result.outputDefined()}serialize(){const s=["let"];for(const[a,b]of this.bindings)s.push(a,b.serialize());return s.push(this.result.serialize()),s}}class O0{constructor(s,a,b){this.type=s,this.index=a,this.input=b}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,nn),$=a.parse(s[2],2,wu(a.expectedType||yo));return b&&$?new O0($.type.itemType,b,$):null}evaluate(s){const a=this.index.evaluate(s),b=this.input.evaluate(s);if(a<0)throw new _c("Array index out of bounds: negative index");if(a>=b.length)throw new _c("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new _c("Array index must be an integer. Use at-interpolated for fractional indices");return b[a]}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class B0{constructor(s,a,b){this.type=s,this.index=a,this.input=b}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,nn),$=a.parse(s[2],2,wu(a.expectedType||yo));return b&&$?new B0($.type.itemType,b,$):null}evaluate(s){const a=this.index.evaluate(s),b=this.input.evaluate(s);if(a<0)throw new _c(`Array index out of bounds: ${a} < 0.`);if(a>b.length-1)throw new _c(`Array index out of bounds: ${a} > ${b.length-1}.`);if(a===Math.floor(a))return b[a];const $=Math.floor(a),it=Math.ceil(a),st=b[$],at=b[it];if(typeof st!="number"||typeof at!="number")throw new _c(`Cannot interpolate between non-number values at index ${a}.`);const ht=a-$;return st*(1-ht)+at*ht}eachChild(s){s(this.index),s(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Rv{constructor(s,a){this.type=So,this.needle=s,this.haystack=a}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,yo),$=a.parse(s[2],2,yo);return b&&$?nv(b.type,[So,Kn,nn,Sp,yo])?new Rv(b,$):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vl(b.type)} instead`):null}evaluate(s){const a=this.needle.evaluate(s),b=this.haystack.evaluate(s);if(b==null)return!1;if(!yy(a,["boolean","string","number","null"]))throw new _c(`Expected first argument to be of type boolean, string, number or null, but found ${Vl(iu(a))} instead.`);if(!yy(b,["string","array"]))throw new _c(`Expected second argument to be of type array or string, but found ${Vl(iu(b))} instead.`);return b.indexOf(a)>=0}eachChild(s){s(this.needle),s(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Mx{constructor(s,a,b){this.type=nn,this.needle=s,this.haystack=a,this.fromIndex=b}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,yo),$=a.parse(s[2],2,yo);if(!b||!$)return null;if(!nv(b.type,[So,Kn,nn,Sp,yo]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vl(b.type)} instead`);if(s.length===4){const it=a.parse(s[3],3,nn);return it?new Mx(b,$,it):null}return new Mx(b,$)}evaluate(s){const a=this.needle.evaluate(s),b=this.haystack.evaluate(s);if(!yy(a,["boolean","string","number","null"]))throw new _c(`Expected first argument to be of type boolean, string, number or null, but found ${Vl(iu(a))} instead.`);if(!yy(b,["string","array"]))throw new _c(`Expected second argument to be of type array or string, but found ${Vl(iu(b))} instead.`);if(this.fromIndex){const $=this.fromIndex.evaluate(s);return b.indexOf(a,$)}return b.indexOf(a)}eachChild(s){s(this.needle),s(this.haystack),this.fromIndex&&s(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const s=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),s]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Ay{constructor(s,a,b,$,it,st){this.inputType=s,this.type=a,this.input=b,this.cases=$,this.outputs=it,this.otherwise=st}static parse(s,a){if(s.length<5)return a.error(`Expected at least 4 arguments, but found only ${s.length-1}.`);if(s.length%2!=1)return a.error("Expected an even number of arguments.");let b,$;a.expectedType&&a.expectedType.kind!=="value"&&($=a.expectedType);const it={},st=[];for(let ft=2;ft<s.length-1;ft+=2){let xt=s[ft];const Et=s[ft+1];Array.isArray(xt)||(xt=[xt]);const Rt=a.concat(ft);if(xt.length===0)return Rt.error("Expected at least one branch label.");for(const Lt of xt){if(typeof Lt!="number"&&typeof Lt!="string")return Rt.error("Branch labels must be numbers or strings.");if(typeof Lt=="number"&&Math.abs(Lt)>Number.MAX_SAFE_INTEGER)return Rt.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Lt=="number"&&Math.floor(Lt)!==Lt)return Rt.error("Numeric branch labels must be integer values.");if(b){if(Rt.checkSubtype(b,iu(Lt)))return null}else b=iu(Lt);if(it[String(Lt)]!==void 0)return Rt.error("Branch labels must be unique.");it[String(Lt)]=st.length}const Pt=a.parse(Et,ft,$);if(!Pt)return null;$=$||Pt.type,st.push(Pt)}const at=a.parse(s[1],1,yo);if(!at)return null;const ht=a.parse(s[s.length-1],s.length-1,$);return ht?at.type.kind!=="value"&&a.concat(1).checkSubtype(b,at.type)?null:new Ay(b,$,at,it,st,ht):null}evaluate(s){const a=this.input.evaluate(s);return(y0(iu(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(s)}eachChild(s){s(this.input),this.outputs.forEach(s),s(this.otherwise)}outputDefined(){return this.outputs.every(s=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),b=[],$={};for(const st of a){const at=$[this.cases[st]];at===void 0?($[this.cases[st]]=b.length,b.push([this.cases[st],[st]])):b[at][1].push(st)}const it=st=>this.inputType.kind==="number"?Number(st):st;for(const[st,at]of b)s.push(at.length===1?it(at[0]):at.map(it)),s.push(this.outputs[st].serialize());return s.push(this.otherwise.serialize()),s}}class jy{constructor(s,a,b){this.type=s,this.branches=a,this.otherwise=b}static parse(s,a){if(s.length<4)return a.error(`Expected at least 3 arguments, but found only ${s.length-1}.`);if(s.length%2!=0)return a.error("Expected an odd number of arguments.");let b;a.expectedType&&a.expectedType.kind!=="value"&&(b=a.expectedType);const $=[];for(let st=1;st<s.length-1;st+=2){const at=a.parse(s[st],st,So);if(!at)return null;const ht=a.parse(s[st+1],st+1,b);if(!ht)return null;$.push([at,ht]),b=b||ht.type}const it=a.parse(s[s.length-1],s.length-1,b);return it?new jy(b,$,it):null}evaluate(s){for(const[a,b]of this.branches)if(a.evaluate(s))return b.evaluate(s);return this.otherwise.evaluate(s)}eachChild(s){for(const[a,b]of this.branches)s(a),s(b);s(this.otherwise)}outputDefined(){return this.branches.every(([s,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const s=["case"];return this.eachChild(a=>{s.push(a.serialize())}),s}}class V0{constructor(s,a,b,$){this.type=s,this.input=a,this.beginIndex=b,this.endIndex=$}static parse(s,a){if(s.length<=2||s.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,yo),$=a.parse(s[2],2,nn);if(!b||!$)return null;if(!nv(b.type,[wu(yo),Kn,yo]))return a.error(`Expected first argument to be of type array or string, but found ${Vl(b.type)} instead`);if(s.length===4){const it=a.parse(s[3],3,nn);return it?new V0(b.type,b,$,it):null}return new V0(b.type,b,$)}evaluate(s){const a=this.input.evaluate(s),b=this.beginIndex.evaluate(s);if(!yy(a,["string","array"]))throw new _c(`Expected first argument to be of type array or string, but found ${Vl(iu(a))} instead.`);if(this.endIndex){const $=this.endIndex.evaluate(s);return a.slice(b,$)}return a.slice(b)}eachChild(s){s(this.input),s(this.beginIndex),this.endIndex&&s(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const s=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),s]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Cv{constructor(s,a){this.type=wu(Kn),this.str=s,this.delimiter=a}static parse(s,a){if(s.length!==3)return a.error(`Expected 2 arguments, but found ${s.length-1} instead.`);const b=a.parse(s[1],1,Kn),$=a.parse(s[2],2,Kn);return b&&$?new Cv(b,$):void 0}evaluate(s){const a=this.str.evaluate(s),b=this.delimiter.evaluate(s);return a.split(b)}eachChild(s){s(this.str),s(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Av(g,s){return g==="=="||g==="!="?s.kind==="boolean"||s.kind==="string"||s.kind==="number"||s.kind==="null"||s.kind==="value":s.kind==="string"||s.kind==="number"||s.kind==="value"}function jv(g,s,a,b){return b.compare(s,a)===0}function Fx(g,s,a){const b=g!=="=="&&g!=="!=";return class iP{constructor(it,st,at){this.type=So,this.lhs=it,this.rhs=st,this.collator=at,this.hasUntypedArgument=it.type.kind==="value"||st.type.kind==="value"}static parse(it,st){if(it.length!==3&&it.length!==4)return st.error("Expected two or three arguments.");const at=it[0];let ht=st.parse(it[1],1,yo);if(!ht)return null;if(!Av(at,ht.type))return st.concat(1).error(`"${at}" comparisons are not supported for type '${Vl(ht.type)}'.`);let ft=st.parse(it[2],2,yo);if(!ft)return null;if(!Av(at,ft.type))return st.concat(2).error(`"${at}" comparisons are not supported for type '${Vl(ft.type)}'.`);if(ht.type.kind!==ft.type.kind&&ht.type.kind!=="value"&&ft.type.kind!=="value")return st.error(`Cannot compare types '${Vl(ht.type)}' and '${Vl(ft.type)}'.`);b&&(ht.type.kind==="value"&&ft.type.kind!=="value"?ht=new Tp(ft.type,[ht]):ht.type.kind!=="value"&&ft.type.kind==="value"&&(ft=new Tp(ht.type,[ft])));let xt=null;if(it.length===4){if(ht.type.kind!=="string"&&ft.type.kind!=="string"&&ht.type.kind!=="value"&&ft.type.kind!=="value")return st.error("Cannot use collator to compare non-string types.");if(xt=st.parse(it[3],3,x0),!xt)return null}return new iP(ht,ft,xt)}evaluate(it){const st=this.lhs.evaluate(it),at=this.rhs.evaluate(it);if(b&&this.hasUntypedArgument){const ht=iu(st),ft=iu(at);if(ht.kind!==ft.kind||ht.kind!=="string"&&ht.kind!=="number")throw new _c(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${ht.kind}, ${ft.kind}) instead.`)}if(this.collator&&!b&&this.hasUntypedArgument){const ht=iu(st),ft=iu(at);if(ht.kind!=="string"||ft.kind!=="string")return s(it,st,at)}return this.collator?a(it,st,at,this.collator.evaluate(it)):s(it,st,at)}eachChild(it){it(this.lhs),it(this.rhs),this.collator&&it(this.collator)}outputDefined(){return!0}serialize(){const it=[g];return this.eachChild(st=>{it.push(st.serialize())}),it}}}const u2=Fx("==",function(g,s,a){return s===a},jv),h2=Fx("!=",function(g,s,a){return s!==a},function(g,s,a,b){return!jv(0,s,a,b)}),bw=Fx("<",function(g,s,a){return s<a},function(g,s,a,b){return b.compare(s,a)<0}),ww=Fx(">",function(g,s,a){return s>a},function(g,s,a,b){return b.compare(s,a)>0}),U0=Fx("<=",function(g,s,a){return s<=a},function(g,s,a,b){return b.compare(s,a)<=0}),d2=Fx(">=",function(g,s,a){return s>=a},function(g,s,a,b){return b.compare(s,a)>=0});class $0{constructor(s,a,b,$,it,st){this.type=Kn,this.number=s,this.locale=a,this.currency=b,this.unit=$,this.minFractionDigits=it,this.maxFractionDigits=st}static parse(s,a){if(s.length!==3)return a.error("Expected two arguments.");const b=a.parse(s[1],1,nn);if(!b)return null;const $=s[2];if(typeof $!="object"||Array.isArray($))return a.error("NumberFormat options argument must be an object.");let it=null;if($.locale&&(it=a.parseObjectValue($.locale,2,"locale",Kn),!it))return null;let st=null;if($.currency&&(st=a.parseObjectValue($.currency,2,"currency",Kn),!st))return null;let at=null;if($.unit&&(at=a.parseObjectValue($.unit,2,"unit",Kn),!at))return null;let ht=null;if($["min-fraction-digits"]&&(ht=a.parseObjectValue($["min-fraction-digits"],2,"min-fraction-digits",nn),!ht))return null;let ft=null;return $["max-fraction-digits"]&&(ft=a.parseObjectValue($["max-fraction-digits"],2,"max-fraction-digits",nn),!ft)?null:new $0(b,it,st,at,ht,ft)}evaluate(s){return new Intl.NumberFormat(this.locale?this.locale.evaluate(s):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(s):void 0,unit:this.unit?this.unit.evaluate(s):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(s):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(s):void 0}).format(this.number.evaluate(s))}eachChild(s){s(this.number),this.locale&&s(this.locale),this.currency&&s(this.currency),this.unit&&s(this.unit),this.minFractionDigits&&s(this.minFractionDigits),this.maxFractionDigits&&s(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const s={};return this.locale&&(s.locale=this.locale.serialize()),this.currency&&(s.currency=this.currency.serialize()),this.unit&&(s.unit=this.unit.serialize()),this.minFractionDigits&&(s["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(s["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),s]}}class Pv{constructor(s){this.type=nn,this.input=s}static parse(s,a){if(s.length!==2)return a.error(`Expected 1 argument, but found ${s.length-1} instead.`);const b=a.parse(s[1],1);return b?b.type.kind!=="array"&&b.type.kind!=="string"&&b.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Vl(b.type)} instead.`):new Pv(b):null}evaluate(s){const a=this.input.evaluate(s);if(typeof a=="string"||Array.isArray(a))return a.length;throw new _c(`Expected value to be of type string or array, but found ${Vl(iu(a))} instead.`)}eachChild(s){s(this.input)}outputDefined(){return!1}serialize(){const s=["length"];return this.eachChild(a=>{s.push(a.serialize())}),s}}function Ew(g){return function(){g=1831565813+(g|=0)|0;let s=Math.imul(g^g>>>15,1|g);return s=s+Math.imul(s^s>>>7,61|s)^s,((s^s>>>14)>>>0)/4294967296}}const Lx={"==":u2,"!=":h2,">":ww,"<":bw,">=":d2,"<=":U0,array:Tp,at:O0,"at-interpolated":B0,boolean:Tp,case:jy,coalesce:Cy,collator:hu,format:zp,image:jn,in:Rv,"index-of":Mx,interpolate:_f,"interpolate-hcl":_f,"interpolate-lab":_f,length:Pv,let:em,literal:Qp,match:Ay,number:Tp,"number-format":$0,object:Tp,slice:V0,step:Ty,string:Tp,"to-boolean":Op,"to-color":Op,"to-number":Op,"to-string":Op,var:M0,within:Pm,distance:rx,config:Px,split:Cv};function Iv(g,[s,a,b,$]){s=s.evaluate(g),a=a.evaluate(g),b=b.evaluate(g);const it=$?$.evaluate(g):1,st=_g(s,a,b,it);if(st)throw new _c(st);return new vo(s/255,a/255,b/255,it)}function kv(g,[s,a,b,$]){s=s.evaluate(g),a=a.evaluate(g),b=b.evaluate(g);const it=$?$.evaluate(g):1,st=function(ft,xt,Et,Rt){return typeof ft=="number"&&ft>=0&&ft<=360?typeof xt=="number"&&xt>=0&&xt<=100&&typeof Et=="number"&&Et>=0&&Et<=100?Rt===void 0||typeof Rt=="number"&&Rt>=0&&Rt<=1?null:`Invalid hsla value [${[ft,xt,Et,Rt].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof Rt=="number"?[ft,xt,Et,Rt]:[ft,xt,Et]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof Rt=="number"?[ft,xt,Et,Rt]:[ft,xt,Et]).join(", ")}]: 'h' must be between 0 and 360.`}(s,a,b,it);if(st)throw new _c(st);const at=`hsla(${s}, ${a}%, ${b}%, ${it})`,ht=vo.parse(at);if(!ht)throw new _c(`Failed to parse HSLA color: ${at}`);return ht}function Sw(g,s){return g in s}function Mv(g,s){const a=s[g];return a===void 0?null:a}function Mm(g){return{type:g}}function ix(g){if(g instanceof Px)return new Set([g.key]);let s=new Set;return g.eachChild(a=>{s=new Set([...s,...ix(a)])}),s}function G0(g){if(g instanceof ku&&g.name==="is-active-floor")return!0;let s=!1;return g.eachChild(a=>{!s&&G0(a)&&(s=!0)}),s}function Tw(g){return{result:"success",value:g}}function Fm(g){return{result:"error",value:g}}function Fv(g,s){return!!g&&!!g.parameters&&g.parameters.indexOf(s)>-1}function Py(g){return g["property-type"]==="data-driven"}function Rw(g){return Fv(g.expression,"measure-light")}function Cw(g){return Fv(g.expression,"zoom")}function H0(g){return!!g.expression&&g.expression.interpolated}function W0(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function Aw(g){return g}function jw(g,s){const a=s.type==="color",b=g.stops&&typeof g.stops[0][0]=="object",$=b||!(b||g.property!==void 0),it=g.type||(H0(s)?"exponential":"interval");if(a&&((g=Object.assign({},g)).stops&&(g.stops=g.stops.map(ft=>[ft[0],vo.parse(ft[1])])),g.default=vo.parse(g.default?g.default:s.default)),g.colorSpace&&g.colorSpace!=="rgb"&&!_w[g.colorSpace])throw new Error(`Unknown color space: ${g.colorSpace}`);let st,at,ht;if(it==="exponential")st=Pw;else if(it==="interval")st=p2;else if(it==="categorical"){st=f2,at=Object.create(null);for(const ft of g.stops)at[ft[0]]=ft[1];ht=typeof g.stops[0][0]}else{if(it!=="identity")throw new Error(`Unknown function type "${it}"`);st=Iw}if(b){const ft={},xt=[];for(let Pt=0;Pt<g.stops.length;Pt++){const Lt=g.stops[Pt],Gt=Lt[0].zoom;ft[Gt]===void 0&&(ft[Gt]={zoom:Gt,type:g.type,property:g.property,default:g.default,stops:[]},xt.push(Gt)),ft[Gt].stops.push([Lt[0].value,Lt[1]])}const Et=[];for(const Pt of xt)Et.push([ft[Pt].zoom,jw(ft[Pt],s)]);const Rt={name:"linear"};return{kind:"composite",interpolationType:Rt,interpolationFactor:_f.interpolationFactor.bind(void 0,Rt),zoomStops:Et.map(Pt=>Pt[0]),evaluate:({zoom:Pt},Lt)=>Pw({stops:Et,base:g.base},s,Pt).evaluate(Pt,Lt)}}if($){const ft=it==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:ft,interpolationFactor:_f.interpolationFactor.bind(void 0,ft),zoomStops:g.stops.map(xt=>xt[0]),evaluate:({zoom:xt})=>st(g,s,xt,at,ht)}}return{kind:"source",evaluate(ft,xt){const Et=xt&&xt.properties?xt.properties[g.property]:void 0;return Et===void 0?Vp(g.default,s.default):st(g,s,Et,at,ht)}}}function Vp(g,s,a){return g!==void 0?g:s!==void 0?s:a!==void 0?a:void 0}function f2(g,s,a,b,$){return Vp(typeof a===$?b[a]:void 0,g.default,s.default)}function p2(g,s,a){if(!Sx(a))return Vp(g.default,s.default);const b=g.stops.length;if(b===1||a<=g.stops[0][0])return g.stops[0][1];if(a>=g.stops[b-1][0])return g.stops[b-1][1];const $=L0(g.stops.map(it=>it[0]),a);return g.stops[$][1]}function Pw(g,s,a){const b=g.base!==void 0?g.base:1;if(!Sx(a))return Vp(g.default,s.default);const $=g.stops.length;if($===1||a<=g.stops[0][0])return g.stops[0][1];if(a>=g.stops[$-1][0])return g.stops[$-1][1];const it=L0(g.stops.map(xt=>xt[0]),a),st=function(xt,Et,Rt,Pt){const Lt=Pt-Rt,Gt=xt-Rt;return Lt===0?0:Et===1?Gt/Lt:(Math.pow(Et,Gt)-1)/(Math.pow(Et,Lt)-1)}(a,b,g.stops[it][0],g.stops[it+1][0]),at=g.stops[it][1],ht=g.stops[it+1][1];let ft=my[s.type]||Aw;if(g.colorSpace&&g.colorSpace!=="rgb"){const xt=_w[g.colorSpace];ft=(Et,Rt)=>xt.reverse(xt.interpolate(xt.forward(Et),xt.forward(Rt),st))}return typeof at.evaluate=="function"?{evaluate(...xt){const Et=at.evaluate.apply(void 0,xt),Rt=ht.evaluate.apply(void 0,xt);if(Et!==void 0&&Rt!==void 0)return ft(Et,Rt,st)}}:ft(at,ht,st)}function Iw(g,s,a){return s.type==="color"?a=vo.parse(a):s.type==="formatted"?a=Pu.fromString(a.toString()):s.type==="resolvedImage"?a=Iu.build(a.toString()):tn(a)===s.type||s.type==="enum"&&s.values[a]||(a=void 0),Vp(a,g.default,s.default)}ku.register(Lx,{error:[{kind:"error"},[Kn],(g,[s])=>{throw new _c(s.evaluate(g))}],typeof:[Kn,[yo],(g,[s])=>Vl(iu(s.evaluate(g)))],"to-rgba":[wu(nn,4),[$u],(g,[s])=>s.evaluate(g).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[wu(nn,4),[$u],(g,[s])=>s.evaluate(g).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[$u,[nn,nn,nn],Iv],rgba:[$u,[nn,nn,nn,nn],Iv],hsl:[$u,[nn,nn,nn],kv],hsla:[$u,[nn,nn,nn,nn],kv],has:{type:So,overloads:[[[Kn],(g,[s])=>Sw(s.evaluate(g),g.properties())],[[Kn,Np],(g,[s,a])=>Sw(s.evaluate(g),a.evaluate(g))]]},get:{type:yo,overloads:[[[Kn],(g,[s])=>Mv(s.evaluate(g),g.properties())],[[Kn,Np],(g,[s,a])=>Mv(s.evaluate(g),a.evaluate(g))]]},"feature-state":[yo,[Kn],(g,[s])=>Mv(s.evaluate(g),g.featureState||{})],properties:[Np,[],g=>g.properties()],"geometry-type":[Kn,[],g=>g.geometryType()],worldview:[Kn,[],g=>g.globals.worldview||""],"is-active-floor":[So,Mm(Kn),(g,s)=>{if(!(g.globals.activeFloors&&g.globals.activeFloors.size>0))return!1;const a=g.globals.activeFloors;return s.some(b=>{const $=b.evaluate(g);return a.has($)})}],id:[yo,[],g=>g.id()],zoom:[nn,[],g=>g.globals.zoom],pitch:[nn,[],g=>g.globals.pitch||0],"distance-from-center":[nn,[],g=>g.distanceFromCenter()],"measure-light":[nn,[Kn],(g,[s])=>g.measureLight(s.evaluate(g))],"heatmap-density":[nn,[],g=>g.globals.heatmapDensity||0],"line-progress":[nn,[],g=>g.globals.lineProgress||0],"raster-value":[nn,[],g=>g.globals.rasterValue||0],"raster-particle-speed":[nn,[],g=>g.globals.rasterParticleSpeed||0],"sky-radial-progress":[nn,[],g=>g.globals.skyRadialProgress||0],accumulated:[yo,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[nn,Mm(nn),(g,s)=>{let a=0;for(const b of s)a+=b.evaluate(g);return a}],"*":[nn,Mm(nn),(g,s)=>{let a=1;for(const b of s)a*=b.evaluate(g);return a}],"-":{type:nn,overloads:[[[nn,nn],(g,[s,a])=>s.evaluate(g)-a.evaluate(g)],[[nn],(g,[s])=>-s.evaluate(g)]]},"/":[nn,[nn,nn],(g,[s,a])=>s.evaluate(g)/a.evaluate(g)],"%":[nn,[nn,nn],(g,[s,a])=>s.evaluate(g)%a.evaluate(g)],ln2:[nn,[],()=>Math.LN2],pi:[nn,[],()=>Math.PI],e:[nn,[],()=>Math.E],"^":[nn,[nn,nn],(g,[s,a])=>Math.pow(s.evaluate(g),a.evaluate(g))],sqrt:[nn,[nn],(g,[s])=>Math.sqrt(s.evaluate(g))],log10:[nn,[nn],(g,[s])=>Math.log(s.evaluate(g))/Math.LN10],ln:[nn,[nn],(g,[s])=>Math.log(s.evaluate(g))],log2:[nn,[nn],(g,[s])=>Math.log2(s.evaluate(g))],sin:[nn,[nn],(g,[s])=>Math.sin(s.evaluate(g))],cos:[nn,[nn],(g,[s])=>Math.cos(s.evaluate(g))],tan:[nn,[nn],(g,[s])=>Math.tan(s.evaluate(g))],asin:[nn,[nn],(g,[s])=>Math.asin(s.evaluate(g))],acos:[nn,[nn],(g,[s])=>Math.acos(s.evaluate(g))],atan:[nn,[nn],(g,[s])=>Math.atan(s.evaluate(g))],min:[nn,Mm(nn),(g,s)=>Math.min(...s.map(a=>a.evaluate(g)))],max:[nn,Mm(nn),(g,s)=>Math.max(...s.map(a=>a.evaluate(g)))],abs:[nn,[nn],(g,[s])=>Math.abs(s.evaluate(g))],round:[nn,[nn],(g,[s])=>{const a=s.evaluate(g);return a<0?-Math.round(-a):Math.round(a)}],floor:[nn,[nn],(g,[s])=>Math.floor(s.evaluate(g))],ceil:[nn,[nn],(g,[s])=>Math.ceil(s.evaluate(g))],"filter-==":[So,[Kn,yo],(g,[s,a])=>g.properties()[s.value]===a.value],"filter-id-==":[So,[yo],(g,[s])=>g.id()===s.value],"filter-type-==":[So,[Kn],(g,[s])=>g.geometryType()===s.value],"filter-<":[So,[Kn,yo],(g,[s,a])=>{const b=g.properties()[s.value],$=a.value;return typeof b==typeof $&&b<$}],"filter-id-<":[So,[yo],(g,[s])=>{const a=g.id(),b=s.value;return typeof a==typeof b&&a<b}],"filter->":[So,[Kn,yo],(g,[s,a])=>{const b=g.properties()[s.value],$=a.value;return typeof b==typeof $&&b>$}],"filter-id->":[So,[yo],(g,[s])=>{const a=g.id(),b=s.value;return typeof a==typeof b&&a>b}],"filter-<=":[So,[Kn,yo],(g,[s,a])=>{const b=g.properties()[s.value],$=a.value;return typeof b==typeof $&&b<=$}],"filter-id-<=":[So,[yo],(g,[s])=>{const a=g.id(),b=s.value;return typeof a==typeof b&&a<=b}],"filter->=":[So,[Kn,yo],(g,[s,a])=>{const b=g.properties()[s.value],$=a.value;return typeof b==typeof $&&b>=$}],"filter-id->=":[So,[yo],(g,[s])=>{const a=g.id(),b=s.value;return typeof a==typeof b&&a>=b}],"filter-has":[So,[yo],(g,[s])=>s.value in g.properties()],"filter-has-id":[So,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[So,[wu(Kn)],(g,[s])=>s.value.indexOf(g.geometryType())>=0],"filter-id-in":[So,[wu(yo)],(g,[s])=>s.value.indexOf(g.id())>=0],"filter-in-small":[So,[Kn,wu(yo)],(g,[s,a])=>a.value.indexOf(g.properties()[s.value])>=0],"filter-in-large":[So,[Kn,wu(yo)],(g,[s,a])=>function(b,$,it,st){for(;it<=st;){const at=it+st>>1;if($[at]===b)return!0;$[at]>b?st=at-1:it=at+1}return!1}(g.properties()[s.value],a.value,0,a.value.length-1)],all:{type:So,overloads:[[[So,So],(g,[s,a])=>s.evaluate(g)&&a.evaluate(g)],[Mm(So),(g,s)=>{for(const a of s)if(!a.evaluate(g))return!1;return!0}]]},any:{type:So,overloads:[[[So,So],(g,[s,a])=>s.evaluate(g)||a.evaluate(g)],[Mm(So),(g,s)=>{for(const a of s)if(a.evaluate(g))return!0;return!1}]]},"!":[So,[So],(g,[s])=>!s.evaluate(g)],"is-supported-script":[So,[Kn],(g,[s])=>{const a=g.globals&&g.globals.isSupportedScript;return!a||a(s.evaluate(g))}],upcase:[Kn,[Kn],(g,[s])=>s.evaluate(g).toUpperCase()],downcase:[Kn,[Kn],(g,[s])=>s.evaluate(g).toLowerCase()],concat:[Kn,Mm(yo),(g,s)=>s.map(a=>dp(a.evaluate(g))).join("")],"resolved-locale":[Kn,[x0],(g,[s])=>s.evaluate(g).resolvedLocale()],random:[nn,[nn,nn,yo],(g,s)=>{const[a,b,$]=s.map(st=>st.evaluate(g));if(a>b||a===b)return a;let it;if(typeof $=="string")it=function(st){let at=0;if(st.length===0)return at;for(let ht=0;ht<st.length;ht++)at=(at<<5)-at+st.charCodeAt(ht),at|=0;return at}($);else{if(typeof $!="number")throw new _c(`Invalid seed input: ${$}`);it=$}return a+Ew(it)()*(b-a)}]});class q0{constructor(s,a,b,$,it){this.expression=s,this._warningHistory={},this._scope=b,this._options=$,this._iconImageUseTheme=it,this._evaluator=new w0(b,$,it),this._defaultValue=a?function(st){return st.type==="color"&&(W0(st.default)||Array.isArray(st.default))?new vo(0,0,0,0):st.type==="color"?vo.parse(st.default)||null:st.default===void 0?null:st.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=ix(s),this.isIndoorDependent=G0(s)}evaluateWithoutErrorHandling(s,a,b,$,it,st,at,ht){return this._evaluator.globals=s,this._evaluator.feature=a,this._evaluator.featureState=b,this._evaluator.canonical=$||null,this._evaluator.availableImages=it||null,this._evaluator.formattedSection=st,this._evaluator.featureTileCoord=at||null,this._evaluator.featureDistanceData=ht||null,this.expression.evaluate(this._evaluator)}evaluate(s,a,b,$,it,st,at,ht,ft){this._evaluator||(this._evaluator=new w0(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=s,this._evaluator.feature=a||null,this._evaluator.featureState=b||null,this._evaluator.canonical=$||null,this._evaluator.availableImages=it||null,this._evaluator.formattedSection=st||null,this._evaluator.featureTileCoord=at||null,this._evaluator.featureDistanceData=ht||null,this._evaluator.iconImageUseTheme=ft||null;try{const xt=this.expression.evaluate(this._evaluator);if(xt==null||typeof xt=="number"&&xt!=xt)return this._defaultValue;if(this._enumValues&&!(xt in this._enumValues))throw new _c(`Expected value to be one of ${Object.keys(this._enumValues).map(Et=>JSON.stringify(Et)).join(", ")}, but found ${JSON.stringify(xt)} instead.`);return xt}catch(xt){const Et=xt;return this._warningHistory[Et.message]||(this._warningHistory[Et.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${Et.message}`)),this._defaultValue}}}function Iy(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in Lx}function Lm(g,s,a,b,$){const it=new F0(Lx,[],s?function(at){const ht={color:$u,string:Kn,number:nn,enum:Kn,boolean:So,formatted:gy,resolvedImage:xy};return at.type==="array"?wu(ht[at.value]||yo,at.length):ht[at.type]}(s):void 0,void 0,void 0,a,b,$),st=it.parse(g,void 0,void 0,void 0,s&&s.type==="string"?{typeAnnotation:"coerce"}:void 0);return st?Tw(new q0(st,s,a,b,$)):Fm(it.errors)}class Dx{constructor(s,a,b,$){this.kind=s,this._styleExpression=a,this.isLightConstant=b,this.isLineProgressConstant=$,this.isStateDependent=s!=="constant"&&!Sy(a.expression),this.configDependencies=ix(a.expression),this.isIndoorDependent=G0(a.expression)}evaluateWithoutErrorHandling(s,a,b,$,it,st){return this._styleExpression.evaluateWithoutErrorHandling(s,a,b,$,it,st)}evaluate(s,a,b,$,it,st,at){return this._styleExpression.evaluate(s,a,b,$,it,st,void 0,void 0,at)}}class sx{constructor(s,a,b,$,it,st){this.kind=s,this.zoomStops=b,this._styleExpression=a,this.isStateDependent=s!=="camera"&&!Sy(a.expression),this.isIndoorDependent=G0(a.expression),this.isLightConstant=it,this.isLineProgressConstant=st,this.configDependencies=ix(a.expression),this.interpolationType=$}evaluateWithoutErrorHandling(s,a,b,$,it,st){return this._styleExpression.evaluateWithoutErrorHandling(s,a,b,$,it,st)}evaluate(s,a,b,$,it,st){return this._styleExpression.evaluate(s,a,b,$,it,st)}interpolationFactor(s,a,b){return this.interpolationType?_f.interpolationFactor(this.interpolationType,s,a,b):0}}function Lv(g,s,a,b,$){if((g=Lm(g,s,a,b,$)).result==="error")return g;const it=g.value.expression,st=Ax(it);if(!st&&!Py(s))return Fm([new hp("","data expressions not supported")]);const at=jx(it,["zoom","pitch","distance-from-center"]);if(!at&&!Cw(s))return Fm([new hp("","zoom expressions not supported")]);const ht=jx(it,["measure-light"]);if(!ht&&!Rw(s))return Fm([new hp("","measure-light expression not supported")]);const ft=jx(it,["line-progress"]);if(!ft&&!function(Rt){return Fv(Rt.expression,"line-progress")}(s))return Fm([new hp("","line-progress expression not supported")]);const xt=s.expression&&s.expression.relaxZoomRestriction,Et=Cp(it);return Et||at||xt?Et instanceof hp?Fm([Et]):Et instanceof _f&&!H0(s)?Fm([new hp("",'"interpolate" expressions cannot be used with this property')]):Tw(Et?new sx(st&&ft?"camera":"composite",g.value,Et.labels,Et instanceof _f?Et.interpolation:void 0,ht,ft):new Dx(st&&ft?"constant":"source",g.value,ht,ft)):Fm([new hp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Z0{constructor(s,a){this._parameters=s,this._specification=a,Object.assign(this,jw(this._parameters,this._specification))}static deserialize(s){return new Z0(s._parameters,s._specification)}static serialize(s){return{_parameters:s._parameters,_specification:s._specification}}}function Cp(g){let s=null;if(g instanceof em)s=Cp(g.result);else if(g instanceof Cy){for(const a of g.args)if(s=Cp(a),s)break}else(g instanceof Ty||g instanceof _f)&&g.input instanceof ku&&g.input.name==="zoom"&&(s=g);return s instanceof hp||g.eachChild(a=>{const b=Cp(a);b instanceof hp?s=b:s&&b&&s!==b&&(s=new hp("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),s}var Dv,kw,Mw=function(){if(kw)return Dv;kw=1,Dv=s;var g=3;function s(a,b,$){var it=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var st=new Int32Array(this.arrayBuffer);a=st[0],this.d=(b=st[1])+2*($=st[2]);for(var at=0;at<this.d*this.d;at++){var ht=st[g+at],ft=st[g+at+1];it.push(ht===ft?null:st.subarray(ht,ft))}var xt=st[g+it.length+1];this.keys=st.subarray(st[g+it.length],xt),this.bboxes=st.subarray(xt),this.insert=this._insertReadonly}else{this.d=b+2*$;for(var Et=0;Et<this.d*this.d;Et++)it.push([]);this.keys=[],this.bboxes=[]}this.n=b,this.extent=a,this.padding=$,this.scale=b/a,this.uid=0;var Rt=$/b*a;this.min=-Rt,this.max=a+Rt}return s.prototype.insert=function(a,b,$,it,st){this._forEachCell(b,$,it,st,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(b),this.bboxes.push($),this.bboxes.push(it),this.bboxes.push(st)},s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},s.prototype._insertCell=function(a,b,$,it,st,at){this.cells[st].push(at)},s.prototype.query=function(a,b,$,it,st){var at=this.min,ht=this.max;if(a<=at&&b<=at&&ht<=$&&ht<=it&&!st)return Array.prototype.slice.call(this.keys);var ft=[];return this._forEachCell(a,b,$,it,this._queryCell,ft,{},st),ft},s.prototype._queryCell=function(a,b,$,it,st,at,ht,ft){var xt=this.cells[st];if(xt!==null)for(var Et=this.keys,Rt=this.bboxes,Pt=0;Pt<xt.length;Pt++){var Lt=xt[Pt];if(ht[Lt]===void 0){var Gt=4*Lt;(ft?ft(Rt[Gt+0],Rt[Gt+1],Rt[Gt+2],Rt[Gt+3]):a<=Rt[Gt+2]&&b<=Rt[Gt+3]&&$>=Rt[Gt+0]&&it>=Rt[Gt+1])?(ht[Lt]=!0,at.push(Et[Lt])):ht[Lt]=!1}}},s.prototype._forEachCell=function(a,b,$,it,st,at,ht,ft){for(var xt=this._convertToCellCoord(a),Et=this._convertToCellCoord(b),Rt=this._convertToCellCoord($),Pt=this._convertToCellCoord(it),Lt=xt;Lt<=Rt;Lt++)for(var Gt=Et;Gt<=Pt;Gt++){var Kt=this.d*Gt+Lt;if((!ft||ft(this._convertFromCellCoord(Lt),this._convertFromCellCoord(Gt),this._convertFromCellCoord(Lt+1),this._convertFromCellCoord(Gt+1)))&&st.call(this,a,b,$,it,Kt,at,ht,ft))return}},s.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},s.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,b=g+this.cells.length+1+1,$=0,it=0;it<this.cells.length;it++)$+=this.cells[it].length;var st=new Int32Array(b+$+this.keys.length+this.bboxes.length);st[0]=this.extent,st[1]=this.n,st[2]=this.padding;for(var at=b,ht=0;ht<a.length;ht++){var ft=a[ht];st[g+ht]=at,st.set(ft,at),at+=ft.length}return st[g+a.length]=at,st.set(this.keys,at),st[g+a.length+1]=at+=this.keys.length,st.set(this.bboxes,at),at+=this.bboxes.length,st.buffer},Dv}(),Nx=Uo(Mw);const nx={};function Xs(g,s,a={}){Object.defineProperty(g,"_classRegistryKey",{value:s,writable:!1}),nx[s]={klass:g,omit:a.omit||[]}}Xs(Object,"Object"),Nx.serialize=function(g,s){const a=g.toArrayBuffer();return s&&s.add(a),{buffer:a}},Nx.deserialize=function(g){return new Nx(g.buffer)},Object.defineProperty(Nx,"name",{value:"Grid"}),Xs(Nx,"Grid"),delete ps.prototype.constructor,Xs(vo,"Color"),Xs(Error,"Error"),Xs(Pu,"Formatted"),Xs(_0,"FormattedSection"),Xs(Xu,"AJAXError"),Xs(Iu,"ResolvedImage"),Xs(Z0,"StylePropertyFunction"),Xs(q0,"StyleExpression",{omit:["_evaluator"]}),Xs(Au,"ImageId"),Xs(Yp,"ImageVariant"),Xs(sx,"ZoomDependentExpression"),Xs(Dx,"ZoomConstantExpression"),Xs(ku,"CompoundExpression",{omit:["_evaluate"]});for(const g in Lx)nx[Lx[g]._classRegistryKey]||Xs(Lx[g],`Expression${g}`);function ky(g){return g&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function tm(g,s){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp)return g;if(ky(g)||g instanceof ImageBitmap)return s&&s.add(g),g;if(ArrayBuffer.isView(g))return s&&s.add(g.buffer),g;if(g instanceof ImageData)return s&&s.add(g.data.buffer),g;if(Array.isArray(g)){const a=[];for(const b of g)a.push(tm(b,s));return a}if(g instanceof Map){const a={$name:"Map",entries:[]};for(const[b,$]of g.entries())a.entries.push(tm(b),tm($,s));return a}if(g instanceof Set){const a={$name:"Set"};let b=0;for(const $ of g.values())a[++b]=tm($);return a}if(typeof g=="bigint")return{$name:"BigInt",value:g.toString()};if(typeof g=="object"){const a=g.constructor,b=a._classRegistryKey;if(!b)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const $=a.serialize?a.serialize(g,s):{};if(!a.serialize){for(const it in g)g.hasOwnProperty(it)&&(nx[b].omit.indexOf(it)>=0||($[it]=tm(g[it],s)));g instanceof Error&&($.message=g.message)}if($.$name)throw new Error("$name property is reserved for worker serialization logic.");return b!=="Object"&&($.$name=b),$}throw new Error("can't serialize object of type "+typeof g)}function Dm(g){if(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||ky(g)||g instanceof ImageBitmap||ArrayBuffer.isView(g)||g instanceof ImageData)return g;if(Array.isArray(g))return g.map(Dm);if(typeof g=="object"){const s=g.$name||"Object";if(s==="Map"){const $=g.entries||[],it=new Map;for(let st=0;st<$.length;st+=2)it.set(Dm($[st]),Dm($[st+1]));return it}if(s==="Set"){const $=new Set;for(const it of Object.keys(g))it!=="$name"&&$.add(Dm(g[it]));return $}if(s==="BigInt")return BigInt(g.value);const{klass:a}=nx[s];if(!a)throw new Error(`Can't deserialize unregistered class "${s}".`);if(a.deserialize)return a.deserialize(g);const b=Object.create(a.prototype);for(const $ of Object.keys(g))$!=="$name"&&(b[$]=Dm(g[$]));return b}throw new Error("can't deserialize object of type "+typeof g)}const un={"Latin-1 Supplement":g=>g>=128&&g<=255,Arabic:g=>g>=1536&&g<=1791,"Arabic Supplement":g=>g>=1872&&g<=1919,"Arabic Extended-A":g=>g>=2208&&g<=2303,"Hangul Jamo":g=>g>=4352&&g<=4607,"Unified Canadian Aboriginal Syllabics":g=>g>=5120&&g<=5759,Khmer:g=>g>=6016&&g<=6143,"Unified Canadian Aboriginal Syllabics Extended":g=>g>=6320&&g<=6399,"General Punctuation":g=>g>=8192&&g<=8303,"Letterlike Symbols":g=>g>=8448&&g<=8527,"Number Forms":g=>g>=8528&&g<=8591,"Miscellaneous Technical":g=>g>=8960&&g<=9215,"Control Pictures":g=>g>=9216&&g<=9279,"Optical Character Recognition":g=>g>=9280&&g<=9311,"Enclosed Alphanumerics":g=>g>=9312&&g<=9471,"Geometric Shapes":g=>g>=9632&&g<=9727,"Miscellaneous Symbols":g=>g>=9728&&g<=9983,"Miscellaneous Symbols and Arrows":g=>g>=11008&&g<=11263,"CJK Radicals Supplement":g=>g>=11904&&g<=12031,"Kangxi Radicals":g=>g>=12032&&g<=12255,"Ideographic Description Characters":g=>g>=12272&&g<=12287,"CJK Symbols and Punctuation":g=>g>=12288&&g<=12351,Hiragana:g=>g>=12352&&g<=12447,Katakana:g=>g>=12448&&g<=12543,Bopomofo:g=>g>=12544&&g<=12591,"Hangul Compatibility Jamo":g=>g>=12592&&g<=12687,Kanbun:g=>g>=12688&&g<=12703,"Bopomofo Extended":g=>g>=12704&&g<=12735,"CJK Strokes":g=>g>=12736&&g<=12783,"Katakana Phonetic Extensions":g=>g>=12784&&g<=12799,"Enclosed CJK Letters and Months":g=>g>=12800&&g<=13055,"CJK Compatibility":g=>g>=13056&&g<=13311,"CJK Unified Ideographs Extension A":g=>g>=13312&&g<=19903,"Yijing Hexagram Symbols":g=>g>=19904&&g<=19967,"CJK Unified Ideographs":g=>g>=19968&&g<=40959,"Yi Syllables":g=>g>=40960&&g<=42127,"Yi Radicals":g=>g>=42128&&g<=42191,"Hangul Jamo Extended-A":g=>g>=43360&&g<=43391,"Hangul Syllables":g=>g>=44032&&g<=55215,"Hangul Jamo Extended-B":g=>g>=55216&&g<=55295,"Private Use Area":g=>g>=57344&&g<=63743,"CJK Compatibility Ideographs":g=>g>=63744&&g<=64255,"Arabic Presentation Forms-A":g=>g>=64336&&g<=65023,"Vertical Forms":g=>g>=65040&&g<=65055,"CJK Compatibility Forms":g=>g>=65072&&g<=65103,"Small Form Variants":g=>g>=65104&&g<=65135,"Arabic Presentation Forms-B":g=>g>=65136&&g<=65279,"Halfwidth and Fullwidth Forms":g=>g>=65280&&g<=65519,Osage:g=>g>=66736&&g<=66815,"CJK Unified Ideographs Extension B":g=>g>=131072&&g<=173791};function My(g){for(const s of g)if(X0(s.charCodeAt(0)))return!0;return!1}function Nv(g){for(const s of g)if(!Fw(s.charCodeAt(0)))return!1;return!0}function Fw(g){return!(un.Arabic(g)||un["Arabic Supplement"](g)||un["Arabic Extended-A"](g)||un["Arabic Presentation Forms-A"](g)||un["Arabic Presentation Forms-B"](g))}function X0(g){return!(g!==746&&g!==747&&(g<4352||!(un["Bopomofo Extended"](g)||un.Bopomofo(g)||un["CJK Compatibility Forms"](g)&&!(g>=65097&&g<=65103)||un["CJK Compatibility Ideographs"](g)||un["CJK Compatibility"](g)||un["CJK Radicals Supplement"](g)||un["CJK Strokes"](g)||!(!un["CJK Symbols and Punctuation"](g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||un["CJK Unified Ideographs Extension A"](g)||un["CJK Unified Ideographs"](g)||un["Enclosed CJK Letters and Months"](g)||un["Hangul Compatibility Jamo"](g)||un["Hangul Jamo Extended-A"](g)||un["Hangul Jamo Extended-B"](g)||un["Hangul Jamo"](g)||un["Hangul Syllables"](g)||un.Hiragana(g)||un["Ideographic Description Characters"](g)||un.Kanbun(g)||un["Kangxi Radicals"](g)||un["Katakana Phonetic Extensions"](g)||un.Katakana(g)&&g!==12540||!(!un["Halfwidth and Fullwidth Forms"](g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!un["Small Form Variants"](g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||un["Unified Canadian Aboriginal Syllabics"](g)||un["Unified Canadian Aboriginal Syllabics Extended"](g)||un["Vertical Forms"](g)||un["Yijing Hexagram Symbols"](g)||un["Yi Syllables"](g)||un["Yi Radicals"](g))))}function K0(g){return!(X0(g)||function(s){return!!(un["Latin-1 Supplement"](s)&&(s===167||s===169||s===174||s===177||s===188||s===189||s===190||s===215||s===247)||un["General Punctuation"](s)&&(s===8214||s===8224||s===8225||s===8240||s===8241||s===8251||s===8252||s===8258||s===8263||s===8264||s===8265||s===8273)||un["Letterlike Symbols"](s)||un["Number Forms"](s)||un["Miscellaneous Technical"](s)&&(s>=8960&&s<=8967||s>=8972&&s<=8991||s>=8996&&s<=9e3||s===9003||s>=9085&&s<=9114||s>=9150&&s<=9165||s===9167||s>=9169&&s<=9179||s>=9186&&s<=9215)||un["Control Pictures"](s)&&s!==9251||un["Optical Character Recognition"](s)||un["Enclosed Alphanumerics"](s)||un["Geometric Shapes"](s)||un["Miscellaneous Symbols"](s)&&!(s>=9754&&s<=9759)||un["Miscellaneous Symbols and Arrows"](s)&&(s>=11026&&s<=11055||s>=11088&&s<=11097||s>=11192&&s<=11243)||un["CJK Symbols and Punctuation"](s)||un.Katakana(s)||un["Private Use Area"](s)||un["CJK Compatibility Forms"](s)||un["Small Form Variants"](s)||un["Halfwidth and Fullwidth Forms"](s)||s===8734||s===8756||s===8757||s>=9984&&s<=10087||s>=10102&&s<=10131||s===65532||s===65533)}(g))}function Y0(g){return un.Arabic(g)||un["Arabic Supplement"](g)||un["Arabic Extended-A"](g)||un["Arabic Presentation Forms-A"](g)||un["Arabic Presentation Forms-B"](g)}function zv(g){return g>=1424&&g<=2303||un["Arabic Presentation Forms-A"](g)||un["Arabic Presentation Forms-B"](g)}function rm(g,s){return!(!s&&zv(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||un.Khmer(g))}function m2(g){for(const s of g)if(zv(s.charCodeAt(0)))return!0;return!1}const Ku={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ov=null,Mu=Ku.unavailable,im=null;const Fy=function(g){g&&typeof g=="string"&&g.indexOf("NetworkError")>-1&&(Mu=Ku.error),Ov&&Ov(g)};function Q0(){J0.fire(new Dp("pluginStateChange",{pluginStatus:Mu,pluginURL:im}))}const J0=new Jm,Ly=function(){return Mu},Lw=function(){if(Mu!==Ku.deferred||!im)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Mu=Ku.loading,Q0(),im&&Kp({url:im},g=>{g?Fy(g):(Mu=Ku.loaded,Q0())})},sm={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Mu===Ku.loaded||sm.applyArabicShaping!=null,isLoading:()=>Mu===Ku.loading,setState(g){Mu=g.pluginStatus,im=g.pluginURL},isParsing:()=>Mu===Ku.parsing,isParsed:()=>Mu===Ku.parsed,getPluginURL:()=>im};class $o{constructor(s,a){this.zoom=s,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview,this.activeFloors=a.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(s){return function(a,b){for(const $ of a)if(!rm($.charCodeAt(0),b))return!1;return!0}(s,sm.isLoaded())}}class e_{constructor(s,a,b,$,it){this.property=s,this.value=a,this.expression=function(st,at,ht,ft,xt){if(W0(st))return new Z0(st,at);if(Iy(st)||Array.isArray(st)&&st.length>0){const Et=Lv(st,at,ht,ft,xt);if(Et.result==="error")throw new Error(Et.value.map(Rt=>`${Rt.key}: ${Rt.message}`).join(", "));return Et.value}{let Et=st;return typeof st=="string"&&at.type==="color"&&(Et=vo.parse(st)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>Et}}}(a===void 0?s.specification.default:a,s.specification,b,$,it)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(s,a,b,$){return this.property.possiblyEvaluate(this,s,a,b,$)}}class Bv{constructor(s,a,b,$){this.property=s,this.value=new e_(s,void 0,a,b,$)}transitioned(s,a){return new Nw(this.property,this.value,a,Object.assign({},s.transition,this.transition),s.now)}untransitioned(){return new Nw(this.property,this.value,null,{},0)}}class Dw{constructor(s,a,b,$){this._properties=s,this._values=Object.create(s.defaultTransitionablePropertyValues),this._scope=a,this._options=b,this._iconImageUseTheme=$,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return hs(this._values[s].value.value)}setValue(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Bv(this._values[s].property,this._scope,this._options,this._iconImageUseTheme)),this._values[s].value=new e_(this._values[s].property,a===null?void 0:hs(a),this._scope,this._options,this._iconImageUseTheme),this._values[s].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].value.isIndoorDependent())}setTransitionOrValue(s,a){a&&(this._options=a);const b=this._properties.properties;if(s)for(const $ in s){const it=s[$];if($.endsWith("-transition")){const st=$.slice(0,-11);b[st]&&this.setTransition(st,it)}else b.hasOwnProperty($)&&this.setValue($,it)}}getTransition(s){return hs(this._values[s].transition)}setTransition(s,a){this._values.hasOwnProperty(s)||(this._values[s]=new Bv(this._values[s].property)),this._values[s].transition=hs(a)||void 0}serialize(){const s={};for(const a of Object.keys(this._values)){const b=this.getValue(a);b!==void 0&&(s[a]=b);const $=this.getTransition(a);$!==void 0&&(s[`${a}-transition`]=$)}return s}transitioned(s,a){const b=new zw(this._properties);for(const $ of Object.keys(this._values))b._values[$]=this._values[$].transitioned(s,a._values[$]);return b}untransitioned(){const s=new zw(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].untransitioned();return s}isIndoorDependent(){return this._isIndoorDependent}}class Nw{constructor(s,a,b,$,it){const st=$.delay||0,at=$.duration||0;it=it||0,this.property=s,this.value=a,this.begin=it+st,this.end=this.begin+at,s.specification.transition&&($.delay||$.duration)&&(this.prior=b)}possiblyEvaluate(s,a,b){const $=s.now||0,it=this.value.possiblyEvaluate(s,a,b),st=this.prior;if(st){if($>this.end)return this.prior=null,it;if(this.value.isDataDriven())return this.prior=null,it;if($<this.begin)return st.possiblyEvaluate(s,a,b);{const at=($-this.begin)/(this.end-this.begin);return this.property.interpolate(st.possiblyEvaluate(s,a,b),it,cu(at))}}return it}}class zw{constructor(s){this._properties=s,this._values=Object.create(s.defaultTransitioningPropertyValues)}possiblyEvaluate(s,a,b){const $=new ax(this._properties);for(const it of Object.keys(this._values))$._values[it]=this._values[it].possiblyEvaluate(s,a,b);return $}hasTransition(){for(const s of Object.keys(this._values))if(this._values[s].prior)return!0;return!1}}class Ow{constructor(s,a,b,$){this._properties=s,this._values=Object.create(s.defaultPropertyValues),this._scope=a,this._options=b,this._iconImageUseTheme=$,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(s){return hs(this._values[s].value)}setValue(s,a){this._values[s]=new e_(this._values[s].property,a===null?void 0:hs(a),this._scope,this._options,this._iconImageUseTheme),this._values[s].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[s].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[s].isIndoorDependent())}serialize(){const s={};for(const a of Object.keys(this._values)){const b=this.getValue(a);b!==void 0&&(s[a]=b)}return s}possiblyEvaluate(s,a,b,$){const it=new ax(this._properties);for(const st of Object.keys(this._values))it._values[st]=this._values[st].possiblyEvaluate(s,a,b,$);return it}isIndoorDependent(){return this._isIndoorDependent}}class ox{constructor(s,a,b,$){this.property=s,this.value=a,this.parameters=b,this.iconImageUseTheme=$}isConstant(){return this.value.kind==="constant"}constantOr(s){return this.value.kind==="constant"?this.value.value:s}evaluate(s,a,b,$){return this.property.evaluate(this.value,this.parameters,s,a,b,$,this.iconImageUseTheme)}}class ax{constructor(s){this._properties=s,this._values=Object.create(s.defaultPossiblyEvaluatedValues)}get(s){return this._values[s]}}class As{constructor(s){this.specification=s}possiblyEvaluate(s,a){return s.expression.evaluate(a)}interpolate(s,a,b){const $=my[this.specification.type];return $?$(s,a,b):s}}class Fs{constructor(s,a){this.specification=s,this.overrides=a}possiblyEvaluate(s,a,b,$,it){return s.expression.kind==="constant"||s.expression.kind==="camera"?new ox(this,{kind:"constant",value:s.expression.evaluate(a,null,{},b,$,void 0,it)},a):new ox(this,s.expression,a,it)}interpolate(s,a,b){if(s.value.kind!=="constant"||a.value.kind!=="constant")return s;if(s.value.value===void 0||a.value.value===void 0)return new ox(this,{kind:"constant",value:void 0},s.parameters);const $=my[this.specification.type];return $?new ox(this,{kind:"constant",value:$(s.value.value,a.value.value,b)},s.parameters):s}evaluate(s,a,b,$,it,st,at){return s.kind==="constant"?s.value:s.evaluate(a,b,$,it,st,void 0,at)}}class lx{constructor(s){this.specification=s}possiblyEvaluate(s,a,b,$){return!!s.expression.evaluate(a,null,{},b,$)}interpolate(){return!1}}class Sl{constructor(s){this.properties=s,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new $o(0,{});for(const b in s){const $=s[b];$.specification.overridable&&this.overridableProperties.push(b);const it=this.defaultPropertyValues[b]=new e_($,void 0),st=this.defaultTransitionablePropertyValues[b]=new Bv($);this.defaultTransitioningPropertyValues[b]=st.untransitioned(),this.defaultPossiblyEvaluatedValues[b]=it.possiblyEvaluate(a)}}}Xs(Fs,"DataDrivenProperty"),Xs(As,"DataConstantProperty"),Xs(lx,"ColorRampProperty");var Gr=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Bw(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function t_(g){if(Array.isArray(g))return g.map(t_);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const s={};for(const a in g)s[a]=t_(g[a]);return s}return Bw(g)}function Up(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const s of g.slice(1))if(!Up(s)&&typeof s!="boolean")return!1;return!0;default:return!0}}function r_(g,s="",a=null,b="fill"){if(g==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Up(g)||(g=i_(g));const $=g;let it=!0;try{it=function(xt){if(!zx(xt))return xt;let Et=t_(xt);return Vw(Et),Et=cx(Et),Et}($)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify($,null,2)}
        `)}let st=null,at=null;if(b!=="background"&&b!=="sky"&&b!=="slot"){at=Gr[`filter_${b}`];const xt=Lm(it,at,s,a);if(xt.result==="error")throw new Error(xt.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));st=(Et,Rt,Pt)=>xt.value.evaluate(Et,Rt,{},Pt)}let ht=null,ft=null;if(it!==$){const xt=Lm($,at,s,a);if(xt.result==="error")throw new Error(xt.value.map(Et=>`${Et.key}: ${Et.message}`).join(", "));ht=(Et,Rt,Pt,Lt,Gt)=>xt.value.evaluate(Et,Rt,{},Pt,void 0,void 0,Lt,Gt),ft=!Ax(xt.value.expression)}return{filter:st,dynamicFilter:ht||void 0,needGeometry:Uw(it),needFeature:!!ft}}function cx(g){if(!Array.isArray(g))return g;const s=function(a){if(g2.has(a[0])){for(let b=1;b<a.length;b++)if(zx(a[b]))return!0}return a}(g);return s===!0?s:s.map(a=>cx(a))}function Vw(g){let s=!1;const a=[];if(g[0]==="case"){for(let b=1;b<g.length-1;b+=2)s=s||zx(g[b]),a.push(g[b+1]);a.push(g[g.length-1])}else if(g[0]==="match"){s=s||zx(g[1]);for(let b=2;b<g.length-1;b+=2)a.push(g[b+1]);a.push(g[g.length-1])}else if(g[0]==="step"){s=s||zx(g[1]);for(let b=1;b<g.length-1;b+=2)a.push(g[b+1])}s&&(g.length=0,g.push("any",...a));for(let b=1;b<g.length;b++)Vw(g[b])}function zx(g){if(!Array.isArray(g))return!1;if((s=g[0])==="pitch"||s==="distance-from-center")return!0;var s;for(let a=1;a<g.length;a++)if(zx(g[a]))return!0;return!1}const g2=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function x2(g,s){return g<s?-1:g>s?1:0}function Uw(g){if(!Array.isArray(g))return!1;if(g[0]==="within"||g[0]==="distance")return!0;for(let s=1;s<g.length;s++)if(Uw(g[s]))return!0;return!1}function i_(g){if(!g)return!0;const s=g[0];return g.length<=1?s!=="any":s==="=="?s_(g[1],g[2],"=="):s==="!="?Dy(s_(g[1],g[2],"==")):s==="<"||s===">"||s==="<="||s===">="?s_(g[1],g[2],s):s==="any"?(a=g.slice(1),["any"].concat(a.map(i_))):s==="all"?["all"].concat(g.slice(1).map(i_)):s==="none"?["all"].concat(g.slice(1).map(i_).map(Dy)):s==="in"?n_(g[1],g.slice(2)):s==="!in"?Dy(n_(g[1],g.slice(2))):s==="has"?o_(g[1]):s!=="!has"||Dy(o_(g[1]));var a}function s_(g,s,a){switch(g){case"$type":return[`filter-type-${a}`,s];case"$id":return[`filter-id-${a}`,s];default:return[`filter-${a}`,g,s]}}function n_(g,s){if(s.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",s]];case"$id":return["filter-id-in",["literal",s]];default:return s.length>200&&!s.some(a=>typeof a!=typeof s[0])?["filter-in-large",g,["literal",s.sort(x2)]]:["filter-in-small",g,["literal",s]]}}function o_(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function Dy(g){return["!",g]}const ux="";function Ap(g,s){return s?`${g}${ux}${s}`:g}let $w;const Gw=()=>$w||($w=new Sl({"icon-size":new Fs(Gr.layout_symbol["icon-size"]),"icon-image":new Fs(Gr.layout_symbol["icon-image"]),"icon-rotate":new Fs(Gr.layout_symbol["icon-rotate"]),"icon-offset":new Fs(Gr.layout_symbol["icon-offset"]),"text-size":new Fs(Gr.layout_symbol["text-size"]),"text-rotate":new Fs(Gr.layout_symbol["text-rotate"]),"text-offset":new Fs(Gr.layout_symbol["text-offset"])}));class Hw{constructor(s,a,b,$,it,st){const at=Lm(s,Gr.appearance.condition);if(at.result==="success"&&(this.condition=at.value),this.name=a,b){this.properties=new ax(Gw()),this.unevaluatedLayout=new Ow(Gw(),$,it,st);for(const ht in b)this.unevaluatedLayout.setValue(ht,b[ht])}}isActive(s){return!(this.condition||!s.isHidden||this.name!=="hidden")||this.condition.evaluate(s.globals,s.feature,s.featureState,s.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(s){return this.properties.get(s)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(s){return this.unevaluatedLayout._values[s]}recalculate(s,a,b){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(s,void 0,a,b))}serialize(){const s={};return s.condition=this.condition.expression.serialize(),this.name&&(s.name=this.name),this.unevaluatedLayout&&(s.properties=this.unevaluatedLayout.serialize()),s}hasIconProperties(){const s=this.hasProperty("icon-image"),a=this.hasProperty("icon-size"),b=this.hasProperty("icon-offset"),$=this.hasProperty("icon-rotate");return s||a||b||$}hasTextProperties(){const s=this.hasProperty("text-size"),a=this.hasProperty("text-offset"),b=this.hasProperty("text-rotate");return s||a||b}hasProperty(s){return this.getUnevaluatedProperty(s).value!==void 0}}const Ww="-transition",$p=new Set(["fill","line","background","hillshade","raster"]);class Fu extends Jm{constructor(s,a,b,$,it,st){if(super(),this.id=s.id,this.fqid=Ap(this.id,b),this.type=s.type,this.scope=b,this.lut=$,this.options=it,this.iconImageUseTheme=st,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},s.type!=="custom"){if(this.metadata=s.metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type&&s.type!=="background"&&s.type!=="sky"&&s.type!=="slot"){this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter;const at=Lm(this.filter,Gr[`filter_${s.type}`]);at.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...at.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||at.value.isIndoorDependent)}if(s.slot&&(this.slot=s.slot),s.appearances&&this.setAppearances(s.appearances),a.layout&&(this._unevaluatedLayout=new Ow(a.layout,this.scope,it,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),a.paint){this._transitionablePaint=new Dw(a.paint,this.scope,it);for(const at in s.paint)this.setPaintProperty(at,s.paint[at]);for(const at in s.layout)this.setLayoutProperty(at,s.layout[at]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ax(a.paint)}}}onAdd(s){}onRemove(s){}isDraped(s){return!this.is3D(!0)&&$p.has(this.type)}getLayoutProperty(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)}setLayoutProperty(s,a){if(this.type==="custom"&&s==="visibility")return void(this.visibility=a);const b=this._unevaluatedLayout;b._properties.properties[s]&&(b.setValue(s,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.isIndoorDependent(),s==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(s){this.appearances=[],s.forEach(a=>{this.appearances.push(new Hw(a.condition,a.name,a.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(s){return s.endsWith(Ww)?this._transitionablePaint.getTransition(s.slice(0,-11)):this._transitionablePaint.getValue(s)}isPaintProperty(s){return!!this._transitionablePaint._properties.properties[s]}setPaintProperty(s,a){const b=this._transitionablePaint,$=b._properties.properties;if(s.endsWith(Ww)){const Et=s.slice(0,-11);return $[Et]&&b.setTransition(Et,a||void 0),!1}if(!$[s])return!1;const it=b._values[s],st=it.value.isDataDriven(),at=it.value;b.setValue(s,a),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...b.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||b.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(s);const ht=b._values[s].value,ft=ht.isDataDriven(),xt=s.endsWith("pattern")||s==="line-dasharray";return ft||st||xt||this._handleOverridablePaintPropertyUpdate(s,at,ht)}_handleSpecialPaintPropertyUpdate(s){}getProgramIds(){return null}getDefaultProgramParams(s,a,b){return null}_handleOverridablePaintPropertyUpdate(s,a,b){return!1}isHidden(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"}updateTransitions(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(s,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,a)}serialize(){const s={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(s.appearances=this.appearances.map(a=>a.serialize())),Es(s,(a,b)=>!(a===void 0||b==="layout"&&!Object.keys(a).length||b==="paint"&&!Object.keys(a).length))}is3D(s){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const s in this.paint._values){const a=this.paint.get(s);if(a instanceof ox&&Py(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}for(const s of this.appearances)if(!Sy(s.condition.expression))return!0;return!1}compileFilter(s){this._filterCompiled||(this._featureFilter=r_(this.filter,this.scope,s),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(s){this._stats&&(s.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(s,a,b){return{}}queryRadius(s){}queryIntersectsFeature(s,a,b,$,it,st,at,ht,ft){}}const qw={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ny{constructor(s,a){this._structArray=s,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const y2=new ArrayBuffer(0);class Xo{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(s,a){return s._trim(),a&&s.arrayBuffer&&a.add(s.arrayBuffer),{length:s.length,arrayBuffer:s.arrayBuffer}}static deserialize(s){const a=Object.create(this.prototype);return a.arrayBuffer=s.arrayBuffer,a.length=s.length,s.arrayBuffer?a.capacity=s.arrayBuffer.byteLength/a.bytesPerElement:(a.capacity=0,a.arrayBuffer=y2),a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(s){this.reserve(s),this.length=s}reserve(s){if(s>this.capacity){this._reallocCount++,this.capacity=Math.max(s,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}reserveForAdditional(s){this.reserve(this.length+s)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...s){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...s){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Vn(g,s=1){let a=0,b=0;return{members:g.map($=>{const it=qw[$.type].BYTES_PER_ELEMENT,st=a=Zw(a,Math.max(s,it)),at=$.components||1;return b=Math.max(b,it),a+=it*at,{name:$.name,type:$.type,components:at,offset:st}}),size:Zw(a,Math.max(b,s)),alignment:s}}function Zw(g,s){return Math.ceil(g/s)*s}class Nm extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a){const b=this.length;return this.resize(b+1),this.emplace(b,s,a)}emplace(s,a,b){const $=2*s;return this.int16[$+0]=a,this.int16[$+1]=b,s}}Nm.prototype.bytesPerElement=4,Xs(Nm,"StructArrayLayout2i4");class Ox extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b){const $=this.length;return this.resize($+1),this.emplace($,s,a,b)}emplace(s,a,b,$){const it=3*s;return this.int16[it+0]=a,this.int16[it+1]=b,this.int16[it+2]=$,s}}Ox.prototype.bytesPerElement=6,Xs(Ox,"StructArrayLayout3i6");class Bx extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b,$){const it=this.length;return this.resize(it+1),this.emplace(it,s,a,b,$)}emplace(s,a,b,$,it){const st=4*s;return this.int16[st+0]=a,this.int16[st+1]=b,this.int16[st+2]=$,this.int16[st+3]=it,s}}Bx.prototype.bytesPerElement=8,Xs(Bx,"StructArrayLayout4i8");class om extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.float32[1*s+0]=a,s}}om.prototype.bytesPerElement=4,Xs(om,"StructArrayLayout1f4");class Vv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b){const $=this.length;return this.resize($+1),this.emplace($,s,a,b)}emplace(s,a,b,$){const it=4*s,st=2*s;return this.int16[it+0]=a,this.int16[it+1]=b,this.float32[st+1]=$,s}}Vv.prototype.bytesPerElement=8,Xs(Vv,"StructArrayLayout2i1f8");class Uv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b){const $=this.length;return this.resize($+1),this.emplace($,s,a,b)}emplace(s,a,b,$){const it=4*s;return this.int16[it+0]=a,this.int16[it+1]=b,this.int16[it+2]=$,s}}Uv.prototype.bytesPerElement=8,Xs(Uv,"StructArrayLayout3i8");class $v extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it){const st=this.length;return this.resize(st+1),this.emplace(st,s,a,b,$,it)}emplace(s,a,b,$,it,st){const at=5*s;return this.int16[at+0]=a,this.int16[at+1]=b,this.int16[at+2]=$,this.int16[at+3]=it,this.int16[at+4]=st,s}}$v.prototype.bytesPerElement=10,Xs($v,"StructArrayLayout5i10");class a_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at){const ht=this.length;return this.resize(ht+1),this.emplace(ht,s,a,b,$,it,st,at)}emplace(s,a,b,$,it,st,at,ht){const ft=6*s,xt=12*s,Et=3*s;return this.int16[ft+0]=a,this.int16[ft+1]=b,this.uint8[xt+4]=$,this.uint8[xt+5]=it,this.uint8[xt+6]=st,this.uint8[xt+7]=at,this.float32[Et+2]=ht,s}}a_.prototype.bytesPerElement=12,Xs(a_,"StructArrayLayout2i4ub1f12");class ep extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b){const $=this.length;return this.resize($+1),this.emplace($,s,a,b)}emplace(s,a,b,$){const it=3*s;return this.float32[it+0]=a,this.float32[it+1]=b,this.float32[it+2]=$,s}}ep.prototype.bytesPerElement=12,Xs(ep,"StructArrayLayout3f12");class Gu extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it){const st=this.length;return this.resize(st+1),this.emplace(st,s,a,b,$,it)}emplace(s,a,b,$,it,st){const at=6*s,ht=3*s;return this.uint16[at+0]=a,this.uint16[at+1]=b,this.uint16[at+2]=$,this.uint16[at+3]=it,this.float32[ht+2]=st,s}}Gu.prototype.bytesPerElement=12,Xs(Gu,"StructArrayLayout4ui1f12");class hx extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,b,$){const it=this.length;return this.resize(it+1),this.emplace(it,s,a,b,$)}emplace(s,a,b,$,it){const st=4*s;return this.uint16[st+0]=a,this.uint16[st+1]=b,this.uint16[st+2]=$,this.uint16[st+3]=it,s}}hx.prototype.bytesPerElement=8,Xs(hx,"StructArrayLayout4ui8");class l_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st){const at=this.length;return this.resize(at+1),this.emplace(at,s,a,b,$,it,st)}emplace(s,a,b,$,it,st,at){const ht=6*s;return this.int16[ht+0]=a,this.int16[ht+1]=b,this.int16[ht+2]=$,this.int16[ht+3]=it,this.int16[ht+4]=st,this.int16[ht+5]=at,s}}l_.prototype.bytesPerElement=12,Xs(l_,"StructArrayLayout6i12");class Gv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt){const Pt=this.length;return this.resize(Pt+1),this.emplace(Pt,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt){const Lt=12*s;return this.int16[Lt+0]=a,this.int16[Lt+1]=b,this.int16[Lt+2]=$,this.int16[Lt+3]=it,this.uint16[Lt+4]=st,this.uint16[Lt+5]=at,this.uint16[Lt+6]=ht,this.uint16[Lt+7]=ft,this.int16[Lt+8]=xt,this.int16[Lt+9]=Et,this.int16[Lt+10]=Rt,this.int16[Lt+11]=Pt,s}}Gv.prototype.bytesPerElement=24,Xs(Gv,"StructArrayLayout4i4ui4i24");class Hv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st){const at=this.length;return this.resize(at+1),this.emplace(at,s,a,b,$,it,st)}emplace(s,a,b,$,it,st,at){const ht=10*s,ft=5*s;return this.int16[ht+0]=a,this.int16[ht+1]=b,this.int16[ht+2]=$,this.float32[ft+2]=it,this.float32[ft+3]=st,this.float32[ft+4]=at,s}}Hv.prototype.bytesPerElement=20,Xs(Hv,"StructArrayLayout3i3f20");class zm extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$){const it=this.length;return this.resize(it+1),this.emplace(it,s,a,b,$)}emplace(s,a,b,$,it){const st=4*s;return this.float32[st+0]=a,this.float32[st+1]=b,this.float32[st+2]=$,this.float32[st+3]=it,s}}zm.prototype.bytesPerElement=16,Xs(zm,"StructArrayLayout4f16");class c_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint32[1*s+0]=a,s}}c_.prototype.bytesPerElement=4,Xs(c_,"StructArrayLayout1ul4");class tp extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a){const b=this.length;return this.resize(b+1),this.emplace(b,s,a)}emplace(s,a,b){const $=2*s;return this.uint16[$+0]=a,this.uint16[$+1]=b,s}}tp.prototype.bytesPerElement=4,Xs(tp,"StructArrayLayout2ui4");class u_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt){const Lt=this.length;return this.resize(Lt+1),this.emplace(Lt,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt){const Gt=20*s,Kt=10*s;return this.int16[Gt+0]=a,this.int16[Gt+1]=b,this.int16[Gt+2]=$,this.int16[Gt+3]=it,this.int16[Gt+4]=st,this.float32[Kt+3]=at,this.float32[Kt+4]=ht,this.float32[Kt+5]=ft,this.float32[Kt+6]=xt,this.int16[Gt+14]=Et,this.uint32[Kt+8]=Rt,this.uint16[Gt+18]=Pt,this.uint16[Gt+19]=Lt,s}}u_.prototype.bytesPerElement=40,Xs(u_,"StructArrayLayout5i4f1i1ul2ui40");class h_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at){const ht=this.length;return this.resize(ht+1),this.emplace(ht,s,a,b,$,it,st,at)}emplace(s,a,b,$,it,st,at,ht){const ft=8*s;return this.int16[ft+0]=a,this.int16[ft+1]=b,this.int16[ft+2]=$,this.int16[ft+4]=it,this.int16[ft+5]=st,this.int16[ft+6]=at,this.int16[ft+7]=ht,s}}h_.prototype.bytesPerElement=16,Xs(h_,"StructArrayLayout3i2i2i16");class d_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it){const st=this.length;return this.resize(st+1),this.emplace(st,s,a,b,$,it)}emplace(s,a,b,$,it,st){const at=4*s,ht=8*s;return this.float32[at+0]=a,this.float32[at+1]=b,this.float32[at+2]=$,this.int16[ht+6]=it,this.int16[ht+7]=st,s}}d_.prototype.bytesPerElement=16,Xs(d_,"StructArrayLayout2f1f2i16");class Wv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st){const at=this.length;return this.resize(at+1),this.emplace(at,s,a,b,$,it,st)}emplace(s,a,b,$,it,st,at){const ht=20*s,ft=5*s;return this.uint8[ht+0]=a,this.uint8[ht+1]=b,this.float32[ft+1]=$,this.float32[ft+2]=it,this.float32[ft+3]=st,this.float32[ft+4]=at,s}}Wv.prototype.bytesPerElement=20,Xs(Wv,"StructArrayLayout2ub4f20");class Zl extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,b){const $=this.length;return this.resize($+1),this.emplace($,s,a,b)}emplace(s,a,b,$){const it=3*s;return this.uint16[it+0]=a,this.uint16[it+1]=b,this.uint16[it+2]=$,s}}Zl.prototype.bytesPerElement=6,Xs(Zl,"StructArrayLayout3ui6");class Vx extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er){const _r=this.length;return this.resize(_r+1),this.emplace(_r,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er,_r){const Rr=30*s,kr=15*s,Lr=60*s;return this.int16[Rr+0]=a,this.int16[Rr+1]=b,this.int16[Rr+2]=$,this.float32[kr+2]=it,this.float32[kr+3]=st,this.uint16[Rr+8]=at,this.uint16[Rr+9]=ht,this.uint32[kr+5]=ft,this.uint32[kr+6]=xt,this.uint32[kr+7]=Et,this.uint16[Rr+16]=Rt,this.uint16[Rr+17]=Pt,this.uint16[Rr+18]=Lt,this.float32[kr+10]=Gt,this.float32[kr+11]=Kt,this.uint8[Lr+48]=Xt,this.uint8[Lr+49]=nr,this.uint8[Lr+50]=lr,this.uint32[kr+13]=hr,this.int16[Rr+28]=Er,this.uint8[Lr+58]=_r,s}}Vx.prototype.bytesPerElement=60,Xs(Vx,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er,_r,Rr,kr,Lr,is,Br,as,ds,fs,vs,ws,xs){const ys=this.length;return this.resize(ys+1),this.emplace(ys,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er,_r,Rr,kr,Lr,is,Br,as,ds,fs,vs,ws,xs)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er,_r,Rr,kr,Lr,is,Br,as,ds,fs,vs,ws,xs,ys){const os=20*s,ss=40*s,_s=80*s;return this.float32[os+0]=a,this.float32[os+1]=b,this.int16[ss+4]=$,this.int16[ss+5]=it,this.int16[ss+6]=st,this.int16[ss+7]=at,this.int16[ss+8]=ht,this.int16[ss+9]=ft,this.int16[ss+10]=xt,this.int16[ss+11]=Et,this.int16[ss+12]=Rt,this.uint16[ss+13]=Pt,this.uint16[ss+14]=Lt,this.uint16[ss+15]=Gt,this.uint16[ss+16]=Kt,this.uint16[ss+17]=Xt,this.uint16[ss+18]=nr,this.uint16[ss+19]=lr,this.uint16[ss+20]=hr,this.uint16[ss+21]=Er,this.uint16[ss+22]=_r,this.uint16[ss+23]=Rr,this.uint16[ss+24]=kr,this.uint16[ss+25]=Lr,this.uint16[ss+26]=is,this.uint16[ss+27]=Br,this.uint32[os+14]=as,this.float32[os+15]=ds,this.float32[os+16]=fs,this.float32[os+17]=vs,this.float32[os+18]=ws,this.uint8[_s+76]=xs,this.uint16[ss+39]=ys,s}}qv.prototype.bytesPerElement=80,Xs(qv,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st){const at=this.length;return this.resize(at+1),this.emplace(at,s,a,b,$,it,st)}emplace(s,a,b,$,it,st,at){const ht=6*s;return this.float32[ht+0]=a,this.float32[ht+1]=b,this.float32[ht+2]=$,this.float32[ht+3]=it,this.float32[ht+4]=st,this.float32[ht+5]=at,s}}Zv.prototype.bytesPerElement=24,Xs(Zv,"StructArrayLayout6f24");class dx extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it){const st=this.length;return this.resize(st+1),this.emplace(st,s,a,b,$,it)}emplace(s,a,b,$,it,st){const at=5*s;return this.float32[at+0]=a,this.float32[at+1]=b,this.float32[at+2]=$,this.float32[at+3]=it,this.float32[at+4]=st,s}}dx.prototype.bytesPerElement=20,Xs(dx,"StructArrayLayout5f20");class Xv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at){const ht=this.length;return this.resize(ht+1),this.emplace(ht,s,a,b,$,it,st,at)}emplace(s,a,b,$,it,st,at,ht){const ft=7*s;return this.float32[ft+0]=a,this.float32[ft+1]=b,this.float32[ft+2]=$,this.float32[ft+3]=it,this.float32[ft+4]=st,this.float32[ft+5]=at,this.float32[ft+6]=ht,s}}Xv.prototype.bytesPerElement=28,Xs(Xv,"StructArrayLayout7f28");class Kv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,s,a,b,$,it,st,at,ht,ft,xt,Et)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt){const Pt=11*s;return this.float32[Pt+0]=a,this.float32[Pt+1]=b,this.float32[Pt+2]=$,this.float32[Pt+3]=it,this.float32[Pt+4]=st,this.float32[Pt+5]=at,this.float32[Pt+6]=ht,this.float32[Pt+7]=ft,this.float32[Pt+8]=xt,this.float32[Pt+9]=Et,this.float32[Pt+10]=Rt,s}}Kv.prototype.bytesPerElement=44,Xs(Kv,"StructArrayLayout11f44");class Ux extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft){const xt=this.length;return this.resize(xt+1),this.emplace(xt,s,a,b,$,it,st,at,ht,ft)}emplace(s,a,b,$,it,st,at,ht,ft,xt){const Et=9*s;return this.float32[Et+0]=a,this.float32[Et+1]=b,this.float32[Et+2]=$,this.float32[Et+3]=it,this.float32[Et+4]=st,this.float32[Et+5]=at,this.float32[Et+6]=ht,this.float32[Et+7]=ft,this.float32[Et+8]=xt,s}}Ux.prototype.bytesPerElement=36,Xs(Ux,"StructArrayLayout9f36");class Gp extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a){const b=this.length;return this.resize(b+1),this.emplace(b,s,a)}emplace(s,a,b){const $=2*s;return this.float32[$+0]=a,this.float32[$+1]=b,s}}Gp.prototype.bytesPerElement=8,Xs(Gp,"StructArrayLayout2f8");class Hu extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s,a,b,$){const it=this.length;return this.resize(it+1),this.emplace(it,s,a,b,$)}emplace(s,a,b,$,it){const st=6*s;return this.uint32[3*s+0]=a,this.uint16[st+2]=b,this.uint16[st+3]=$,this.uint16[st+4]=it,s}}Hu.prototype.bytesPerElement=12,Xs(Hu,"StructArrayLayout1ul3ui12");class Om extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint16[1*s+0]=a,s}}Om.prototype.bytesPerElement=2,Xs(Om,"StructArrayLayout1ui2");class Yv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt){const Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt)}emplace(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt){const nr=16*s;return this.float32[nr+0]=a,this.float32[nr+1]=b,this.float32[nr+2]=$,this.float32[nr+3]=it,this.float32[nr+4]=st,this.float32[nr+5]=at,this.float32[nr+6]=ht,this.float32[nr+7]=ft,this.float32[nr+8]=xt,this.float32[nr+9]=Et,this.float32[nr+10]=Rt,this.float32[nr+11]=Pt,this.float32[nr+12]=Lt,this.float32[nr+13]=Gt,this.float32[nr+14]=Kt,this.float32[nr+15]=Xt,s}}Yv.prototype.bytesPerElement=64,Xs(Yv,"StructArrayLayout16f64");class f_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(s,a,b,$,it,st,at){const ht=this.length;return this.resize(ht+1),this.emplace(ht,s,a,b,$,it,st,at)}emplace(s,a,b,$,it,st,at,ht){const ft=10*s,xt=5*s;return this.uint16[ft+0]=a,this.uint16[ft+1]=b,this.uint16[ft+2]=$,this.uint16[ft+3]=it,this.float32[xt+2]=st,this.float32[xt+3]=at,this.float32[xt+4]=ht,s}}f_.prototype.bytesPerElement=20,Xs(f_,"StructArrayLayout4ui3f20");class Qv extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.int16[1*s+0]=a,s}}Qv.prototype.bytesPerElement=2,Xs(Qv,"StructArrayLayout1i2");class p_ extends Xo{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(s){const a=this.length;return this.resize(a+1),this.emplace(a,s)}emplace(s,a){return this.uint8[1*s+0]=a,s}}p_.prototype.bytesPerElement=1,Xs(p_,"StructArrayLayout1ub1");class m_ extends Ny{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}m_.prototype.size=40;class Xw extends u_{get(s){return new m_(this,s)}}Xs(Xw,"CollisionBoxArray");class g_ extends Ny{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(s){this._structArray.uint8[this._pos1+49]=s}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(s){this._structArray.uint8[this._pos1+50]=s}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(s){this._structArray.uint32[this._pos4+13]=s}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(s){this._structArray.uint8[this._pos1+58]=s}}g_.prototype.size=60;class Kw extends Vx{get(s){return new g_(this,s)}}Xs(Kw,"PlacedSymbolArray");class Yw extends Ny{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(s){this._structArray.uint32[this._pos4+14]=s}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(s){this._structArray.float32[this._pos4+18]=s}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Yw.prototype.size=80;class Jv extends qv{get(s){return new Yw(this,s)}}Xs(Jv,"SymbolInstanceArray");class x_ extends om{getoffsetX(s){return this.float32[1*s+0]}}Xs(x_,"GlyphOffsetArray");class Qw extends Nm{getx(s){return this.int16[2*s+0]}gety(s){return this.int16[2*s+1]}}Xs(Qw,"SymbolLineVertexArray");class e1 extends Ny{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}e1.prototype.size=12;class t1 extends Hu{get(s){return new e1(this,s)}}Xs(t1,"FeatureIndexArray");class Jw extends tp{geta_centroid_pos0(s){return this.uint16[2*s+0]}geta_centroid_pos1(s){return this.uint16[2*s+1]}}Xs(Jw,"FillExtrusionCentroidArray");class y_ extends Ny{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}y_.prototype.size=6;class zy extends Ox{get(s){return new y_(this,s)}}Xs(zy,"FillExtrusionWallArray");const eE=Vn([{name:"a_pos",components:2,type:"Int16"}],4),_2=Vn([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),tE=Vn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ga{constructor(s=[]){this.segments=s}_prepareSegment(s,a,b,$){let it=this.segments[this.segments.length-1];return s>ga.MAX_VERTEX_ARRAY_LENGTH&&$s(`Max vertices per segment is ${ga.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${s}`),(!it||it.vertexLength+s>ga.MAX_VERTEX_ARRAY_LENGTH||it.sortKey!==$)&&(it={vertexOffset:a,primitiveOffset:b,vertexLength:0,primitiveLength:0},$!==void 0&&(it.sortKey=$),this.segments.push(it)),it}prepareSegment(s,a,b,$){return this._prepareSegment(s,a.length,b.length,$)}get(){return this.segments}destroy(){for(const s of this.segments)for(const a in s.vaos)s.vaos[a].destroy()}static simpleSegment(s,a,b,$){return new ga([{vertexOffset:s,primitiveOffset:a,vertexLength:b,primitiveLength:$,vaos:{},sortKey:0}])}}function __(g,s){return 256*(g=Qt(Math.floor(g),0,255))+Qt(Math.floor(s),0,255)}ga.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Xs(ga,"SegmentVector");const v2=Vn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),b2=Vn([{name:"a_pattern_b",components:4,type:"Uint16"}]),w2=Vn([{name:"a_dash",components:4,type:"Uint16"}]);class Oy{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(s,a,b,$){this.ids.push(r1(s)),this.positions.push(a,b,$)}eachPosition(s,a){const b=r1(s);let $=0,it=this.ids.length-1;for(;$<it;){const st=$+it>>1;this.ids[st]>=b?it=st:$=st+1}for(;this.ids[$]===b;)a(this.positions[3*$],this.positions[3*$+1],this.positions[3*$+2]),$++}static serialize(s,a){const b=new Float64Array(s.ids),$=new Uint32Array(s.positions);return i1(b,$,0,b.length-1),a&&(a.add(b.buffer),a.add($.buffer)),{ids:b,positions:$}}static deserialize(s){const a=new Oy;let b;a.ids=s.ids,a.positions=s.positions;for(const $ of a.ids)$!==b&&a.uniqueIds.push($),b=$;return a.indexed=!0,a}}function r1(g){const s=+g;return Number.isSafeInteger(s)?s:m0(String(g))}function i1(g,s,a,b){for(;a<b;){const $=g[a+b>>1];let it=a-1,st=b+1;for(;;){do it++;while(g[it]<$);do st--;while(g[st]>$);if(it>=st)break;v_(g,it,st),v_(s,3*it,3*st),v_(s,3*it+1,3*st+1),v_(s,3*it+2,3*st+2)}st-a<b-st?(i1(g,s,a,st),a=st+1):(i1(g,s,st+1,b),b=st)}}function v_(g,s,a){const b=g[s];g[s]=g[a],g[a]=b}Xs(Oy,"FeaturePositionMap");class am{constructor(s){this.gl=s.gl,this.initialized=!1}fetchUniformLocation(s,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(s,a),this.initialized=!0),!!this.location}set(s,a,b){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class b_ extends am{constructor(s){super(s),this.current=0}set(s,a,b){this.fetchUniformLocation(s,a)&&this.current!==b&&(this.current=b,this.gl.uniform1i(this.location,b))}}class Xl extends am{constructor(s){super(s),this.current=0}set(s,a,b){this.fetchUniformLocation(s,a)&&this.current!==b&&(this.current=b,this.gl.uniform1f(this.location,b))}}class Hp extends am{constructor(s){super(s),this.current=[0,0]}set(s,a,b){this.fetchUniformLocation(s,a)&&(b[0]===this.current[0]&&b[1]===this.current[1]||(this.current=b,this.gl.uniform2f(this.location,b[0],b[1])))}}class By extends am{constructor(s){super(s),this.current=[0,0,0]}set(s,a,b){this.fetchUniformLocation(s,a)&&(b[0]===this.current[0]&&b[1]===this.current[1]&&b[2]===this.current[2]||(this.current=b,this.gl.uniform3f(this.location,b[0],b[1],b[2])))}}class w_ extends am{constructor(s){super(s),this.current=[0,0,0,0]}set(s,a,b){this.fetchUniformLocation(s,a)&&(b[0]===this.current[0]&&b[1]===this.current[1]&&b[2]===this.current[2]&&b[3]===this.current[3]||(this.current=b,this.gl.uniform4f(this.location,b[0],b[1],b[2],b[3])))}}class Vy extends am{constructor(s){super(s),this.current=vo.transparent.toPremultipliedRenderColor(null)}set(s,a,b){this.fetchUniformLocation(s,a)&&(b.r===this.current.r&&b.g===this.current.g&&b.b===this.current.b&&b.a===this.current.a||(this.current=b,this.gl.uniform4f(this.location,b.r,b.g,b.b,b.a)))}}const E2=new Float32Array(16);class Uy extends am{constructor(s){super(s),this.current=E2}set(s,a,b){if(this.fetchUniformLocation(s,a)){if(b[12]!==this.current[12]||b[0]!==this.current[0])return this.current=b,void this.gl.uniformMatrix4fv(this.location,!1,b);for(let $=1;$<16;$++)if(b[$]!==this.current[$]){this.current=b,this.gl.uniformMatrix4fv(this.location,!1,b);break}}}}const E_=new Float32Array(9),S2=new Float32Array(4);class S_ extends am{constructor(s){super(s),this.current=S2}set(s,a,b){if(this.fetchUniformLocation(s,a)){for(let $=0;$<4;$++)if(b[$]!==this.current[$]){this.current=b,this.gl.uniformMatrix2fv(this.location,!1,b);break}}}}function s1(g){return[__(255*g.r,255*g.g),__(255*g.b,255*g.a)]}function $y(g,s,a,b,$,it,st,at){return!!g&&(g.kind==="composite"||g.kind==="source"?g.evaluate(new $o(0,{brightness:it,worldview:at}),s,a,$,b,st)==="none":g.value==="none")}class Gy{constructor(s,a,b,$){this.value=s,this.uniformNames=a.map(it=>`u_${it}`),this.type=b,this.context=$}setUniform(s,a,b,$,it){const st=$.constantOr(this.value);a.set(s,it,st instanceof vo?st.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):st)}getBinding(s,a){return this.type==="color"?new Vy(s):new Xl(s)}}class $x{constructor(s,a){this.uniformNames=a.map(b=>`u_${b}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(s,a){this.pixelRatio=s.pixelRatio||1,this.pattern=s.tl.concat(s.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(s,a,b,$,it){let st=null;it!=="u_pattern"&&it!=="u_dash"||(st=this.pattern),it==="u_pattern_b"&&(st=this.patternTransition),it==="u_pixel_ratio"&&(st=this.pixelRatio),st&&a.set(s,it,st)}getBinding(s,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new w_(s):new Xl(s)}}class lm{constructor(s,a,b,$){this.expression=s,this.type=b,this.maxValue=0,this.paintVertexAttributes=a.map(it=>({name:`a_${it}`,type:"Float32",components:b==="color"?2:1,offset:0})),this.paintVertexArray=new $}populatePaintArray(s,a,b,$,it,st,at,ht){const ft=this.paintVertexArray.length,xt=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new $o(0,{brightness:st,worldview:ht}),a,{},it,$,at):this.expression.kind==="constant"&&this.expression.value,Et=$y(this.lutExpression,a,{},$,it,st,at,ht);this.paintVertexArray.resize(s),this._setPaintValue(ft,s,xt,Et?null:this.context.lut)}updatePaintArray(s,a,b,$,it,st,at,ht){const ft=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:at,worldview:ht},b,$,void 0,it):this.expression.kind==="constant"&&this.expression.value,xt=$y(this.lutExpression,b,$,it,void 0,at,void 0,ht);this._setPaintValue(s,a,ft,xt?null:this.context.lut)}_setPaintValue(s,a,b,$){if(this.type==="color"){const it=s1(b.toPremultipliedRenderColor($));for(let st=s;st<a;st++)this.paintVertexArray.emplace(st,it[0],it[1])}else{for(let it=s;it<a;it++)this.paintVertexArray.emplace(it,b);this.maxValue=Math.max(this.maxValue,Math.abs(b))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class cm{constructor(s,a,b,$,it,st){this.expression=s,this.uniformNames=a.map(at=>`u_${at}_t`),this.type=b,this.useIntegerZoom=$,this.context=it,this.maxValue=0,this.paintVertexAttributes=a.map(at=>({name:`a_${at}`,type:"Float32",components:b==="color"?4:2,offset:0})),this.paintVertexArray=new st}populatePaintArray(s,a,b,$,it,st,at,ht){const ft=this.expression.evaluate(new $o(this.context.zoom,{brightness:st,worldview:ht}),a,{},it,$,at),xt=this.expression.evaluate(new $o(this.context.zoom+1,{brightness:st,worldview:ht}),a,{},it,$,at),Et=$y(this.lutExpression,a,{},$,it,st,at,ht),Rt=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValue(Rt,s,ft,xt,Et?null:this.context.lut)}updatePaintArray(s,a,b,$,it,st,at,ht){const ft=this.expression.evaluate({zoom:this.context.zoom,brightness:at,worldview:ht},b,$,void 0,it),xt=this.expression.evaluate({zoom:this.context.zoom+1,brightness:at,worldview:ht},b,$,void 0,it),Et=$y(this.lutExpression,b,$,it,void 0,at,void 0,ht);this._setPaintValue(s,a,ft,xt,Et?null:this.context.lut)}_setPaintValue(s,a,b,$,it){if(this.type==="color"){const st=s1(b.toPremultipliedRenderColor(it)),at=s1(b.toPremultipliedRenderColor(it));for(let ht=s;ht<a;ht++)this.paintVertexArray.emplace(ht,st[0],st[1],at[0],at[1])}else{for(let st=s;st<a;st++)this.paintVertexArray.emplace(st,b,$);this.maxValue=Math.max(this.maxValue,Math.abs(b),Math.abs($))}}upload(s){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(s,a,b,$,it){const st=this.useIntegerZoom?Math.floor(b.zoom):b.zoom,at=Qt(this.expression.interpolationFactor(st,this.context.zoom,this.context.zoom+1),0,1);a.set(s,it,at)}getBinding(s,a){return new Xl(s)}}class um{constructor(s,a,b,$,it){this.expression=s,this.layerId=it,this.paintVertexAttributes=(b==="array"?w2:v2).members;for(let st=0;st<a.length;++st);this.paintVertexArray=new $,this.paintTransitionVertexArray=new hx}populatePaintArray(s,a,b,$){const it=this.paintVertexArray.length;this.paintVertexArray.resize(s),this._setPaintValues(it,s,a.patterns&&a.patterns[this.layerId],b)}updatePaintArray(s,a,b,$,it,st,at){this._setPaintValues(s,a,b.patterns&&b.patterns[this.layerId],st)}_setPaintValues(s,a,b,$){if(!$||!b)return;const it=$[b[0]],st=$[b[1]];if(it){if(it){const{tl:at,br:ht,pixelRatio:ft}=it;for(let xt=s;xt<a;xt++)this.paintVertexArray.emplace(xt,at[0],at[1],ht[0],ht[1],ft)}if(st){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:at,br:ht}=st;for(let ft=s;ft<a;ft++)this.paintTransitionVertexArray.emplace(ft,at[0],at[1],ht[0],ht[1])}}}upload(s){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=s.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=s.createVertexBuffer(this.paintTransitionVertexArray,b2.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Bm{constructor(s,a,b=()=>!0){this.binders={},this._buffers=[],this.context=a;const $=[];for(const it in s.paint._values){const st=s.paint.get(it);if(it.endsWith("-use-theme")||!b(it)||!(st instanceof ox&&Py(st.property.specification)))continue;const at=R2(it,s.type),ht=st.value,ft=st.property.specification.type,xt=!!st.property.useIntegerZoom,Et=it==="line-dasharray"||it.endsWith("pattern"),Rt=s.paint.get(`${it}-use-theme`),Pt=it==="line-dasharray"&&s.layout.get("line-cap").value.kind!=="constant"||Rt&&Rt.value.kind!=="constant";if(ht.kind!=="constant"||Pt)if(ht.kind==="source"||Pt||Et){const Lt=n1(it,ft,"source");this.binders[it]=Et?new um(ht,at,ft,Lt,s.id):new lm(ht,at,ft,Lt),$.push(`/a_${it}`)}else{const Lt=n1(it,ft,"composite");this.binders[it]=new cm(ht,at,ft,xt,a,Lt),$.push(`/z_${it}`)}else this.binders[it]=Et?new $x(ht.value,at):new Gy(ht.value,at,ft,a),$.push(`/u_${it}`);Rt&&(this.binders[it].lutExpression=Rt.value)}this.cacheKey=$.sort().join("")}getMaxValue(s){const a=this.binders[s];return a instanceof lm||a instanceof cm?a.maxValue:0}populatePaintArrays(s,a,b,$,it,st,at,ht){for(const ft in this.binders){const xt=this.binders[ft];xt.context=this.context,(xt instanceof lm||xt instanceof cm||xt instanceof um)&&xt.populatePaintArray(s,a,b,$,it,st,at,ht)}}setConstantPatternPositions(s,a){for(const b in this.binders){const $=this.binders[b];$ instanceof $x&&$.setConstantPatternPositions(s,a)}}getPatternTransitionVertexBuffer(s){const a=this.binders[s];return a instanceof um?a.paintTransitionVertexBuffer:null}updatePaintArrays(s,a,b,$,it,st,at,ht,ft,xt){let Et=!1;const Rt=Object.keys(s),Pt=Rt.length!==0&&!ht,Lt=Pt?Rt:a.uniqueIds;this.context.lut=it.lut;for(const Gt in this.binders){const Kt=this.binders[Gt];if(Kt.context=this.context,(Kt instanceof lm||Kt instanceof cm||Kt instanceof um)&&Kt.expression&&Kt.expression.kind&&Kt.expression.kind!=="constant"&&(Kt.expression.isStateDependent===!0||Kt.expression.isLightConstant===!1)){const Xt=it.paint.get(Gt);Kt.expression=Xt.value;for(const nr of Lt){const lr=s[nr.toString()];a.eachPosition(nr,(hr,Er,_r)=>{const Rr=$.feature(hr);Kt.updatePaintArray(Er,_r,Rr,lr,st,at,ft,xt)})}if(!Pt)for(const nr of b.uniqueIds){const lr=s[nr.toString()];b.eachPosition(nr,(hr,Er,_r)=>{const Rr=$.feature(hr);Kt.updatePaintArray(Er,_r,Rr,lr,st,at,ft,xt)})}Et=!0}}return Et}defines(){const s=[];for(const a in this.binders){const b=this.binders[a];(b instanceof Gy||b instanceof $x)&&s.push(...b.uniformNames.map($=>`#define HAS_UNIFORM_${$}`))}return s}getPaintVertexBuffers(){return this._buffers}getUniforms(s){const a=[];for(const b in this.binders){const $=this.binders[b];if($ instanceof Gy||$ instanceof $x||$ instanceof cm)for(const it of $.uniformNames)a.push({name:it,property:b,binding:$.getBinding(s,it)})}return a}setUniforms(s,a,b,$,it){for(const{name:st,property:at,binding:ht}of b)this.binders[at].setUniform(s,ht,it,$.get(at),st)}updatePaintBuffers(){this._buffers=[];for(const s in this.binders){const a=this.binders[s];(a instanceof lm||a instanceof cm||a instanceof um)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof um&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(s){for(const a in this.binders){const b=this.binders[a];(b instanceof lm||b instanceof cm||b instanceof um)&&b.upload(s)}this.updatePaintBuffers()}destroy(){for(const s in this.binders){const a=this.binders[s];(a instanceof lm||a instanceof cm||a instanceof um)&&a.destroy()}}}class jp{constructor(s,a,b=()=>!0){this.programConfigurations={};for(const $ of s)this.programConfigurations[$.id]=new Bm($,a,b);this.needsUpload=!1,this._featureMap=new Oy,this._featureMapWithoutIds=new Oy,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(s,a,b,$,it,st,at,ht,ft){for(const xt in this.programConfigurations)this.programConfigurations[xt].populatePaintArrays(s,a,$,it,st,at,ht,ft);a.id!==void 0?this._featureMap.add(a.id,b,this._bufferOffset,s):(this._featureMapWithoutIds.add(this._idlessCounter,b,this._bufferOffset,s),this._idlessCounter+=1),this._bufferOffset=s,this.needsUpload=!0}updatePaintArrays(s,a,b,$,it,st,at,ht){for(const ft of b)this.needsUpload=this.programConfigurations[ft.id].updatePaintArrays(s,this._featureMap,this._featureMapWithoutIds,a,ft,$,it,st,at||0,ht)||this.needsUpload}get(s){return this.programConfigurations[s]}upload(s){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(s);this.needsUpload=!1}}destroy(){for(const s in this.programConfigurations)this.programConfigurations[s].destroy()}}const T2={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function R2(g,s){return T2[g]||[g.replace(`${s}-`,"").replace(/-/g,"_")]}const C2={"line-pattern":{source:Gu,composite:Gu},"fill-pattern":{source:Gu,composite:Gu},"fill-extrusion-pattern":{source:Gu,composite:Gu},"line-dasharray":{source:hx,composite:hx}},A2={color:{source:Gp,composite:zm},number:{source:om,composite:Gp}};function n1(g,s,a){const b=C2[g];return b&&b[a]||A2[s][a]}Xs(Gy,"ConstantBinder"),Xs($x,"PatternConstantBinder"),Xs(lm,"SourceExpressionBinder"),Xs(um,"PatternCompositeBinder"),Xs(cm,"CompositeExpressionBinder"),Xs(Bm,"ProgramConfiguration",{omit:["_buffers"]}),Xs(jp,"ProgramConfigurationSet");const Eu=Ps/Math.PI/2,mp=5,T_=6,j2=16383,Gx=64,o1=[Gx,32,16],gp=-Eu,xp=Eu;function fx(g,s,a,b=Eu){return a=wn(a),[g*Math.sin(a)*b,-s*b,g*Math.cos(a)*b]}function Hx(g,s,a){return fx(Math.cos(wn(g)),Math.sin(wn(g)),s,a)}const et=63710088e-1,o=2*Math.PI*et;class _{constructor(s,a){if(isNaN(s)||isNaN(a))throw new Error(`Invalid LngLat object: (${s}, ${a})`);if(this.lng=+s,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _(gr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(s){const a=Math.PI/180,b=this.lat*a,$=s.lat*a,it=Math.sin(b)*Math.sin($)+Math.cos(b)*Math.cos($)*Math.cos((s.lng-this.lng)*a);return et*Math.acos(Math.min(it,1))}toBounds(s=0){const a=360*s/40075017,b=a/Math.cos(Math.PI/180*this.lat);return new rt({lng:this.lng-b,lat:this.lat-a},{lng:this.lng+b,lat:this.lat+a})}toEcef(s){return Hx(this.lat,this.lng,Eu+s*Eu/et)}static convert(s){if(s instanceof _)return s;if(Array.isArray(s)&&(s.length===2||s.length===3))return new _(Number(s[0]),Number(s[1]));if(!Array.isArray(s)&&typeof s=="object"&&s!==null)return new _(Number("lng"in s?s.lng:s.lon),Number(s.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class rt{constructor(s,a){s&&(a?this.setSouthWest(s).setNorthEast(a):Array.isArray(s)&&s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1]))}setNorthEast(s){return this._ne=s instanceof _?new _(s.lng,s.lat):_.convert(s),this}setSouthWest(s){return this._sw=s instanceof _?new _(s.lng,s.lat):_.convert(s),this}extend(s){const a=this._sw,b=this._ne;let $,it;if(s instanceof _)$=s,it=s;else{if(!(s instanceof rt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(rt.convert(s)):this.extend(_.convert(s)):typeof s=="object"&&s!==null&&s.hasOwnProperty("lat")&&(s.hasOwnProperty("lon")||s.hasOwnProperty("lng"))?this.extend(_.convert(s)):this;if($=s._sw,it=s._ne,!$||!it)return this}return a||b?(a.lng=Math.min($.lng,a.lng),a.lat=Math.min($.lat,a.lat),b.lng=Math.max(it.lng,b.lng),b.lat=Math.max(it.lat,b.lat)):(this._sw=new _($.lng,$.lat),this._ne=new _(it.lng,it.lat)),this}getCenter(){return new _((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new _(this.getWest(),this.getNorth())}getSouthEast(){return new _(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:a,lat:b}=_.convert(s);let $=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&($=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=b&&b<=this._ne.lat&&$}static convert(s){if(s)return s instanceof rt?s:new rt(s)}}const ot=0,lt=25.5;function ut(g){return o*Math.cos(g*Math.PI/180)}function dt(g){return(180+g)/360}function mt(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function Tt(g,s){return g/ut(s)}function Ct(g){return 360*g-180}function Ut(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function Bt(g,s){return g*ut(Ut(s))}const $t=85.051129;function Zt(g){return Math.cos(wn(Qt(g,-$t,$t)))}function qt(g,s){const a=Qt(s,ot,lt),b=Math.pow(2,a);return Zt(g)*o/(512*b)}function sr(g){return 1/Math.cos(g*Math.PI/180)}function ir(g,s=0){const a=Math.exp(Math.PI*(1-(g.y+s/Ps)/(1<<g.z)*2));return 80150034*a/(a*a+1)/Ps/(1<<g.z)}class cr{constructor(s,a,b=0){this.x=+s,this.y=+a,this.z=+b}static fromLngLat(s,a=0){const b=_.convert(s);return new cr(dt(b.lng),mt(b.lat),Tt(a,b.lat))}toLngLat(){return new _(Ct(this.x),Ut(this.y))}toAltitude(){return Bt(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/o*sr(Ut(this.y))}}function pr(g,s,a,b,$,it,st,at,ht){const ft=(s+b)/2,xt=(a+$)/2,Et=new ps(ft,xt);at(Et),function(Rt,Pt,Lt,Gt,Kt,Xt){const nr=Lt-Kt,lr=Gt-Xt;return Math.abs((Gt-Pt)*nr-(Lt-Rt)*lr)/Math.hypot(nr,lr)}(Et.x,Et.y,it.x,it.y,st.x,st.y)>=ht?(pr(g,s,a,ft,xt,it,Et,at,ht),pr(g,ft,xt,b,$,Et,st,at,ht)):g.push(st)}function ur(g,s,a){let b=g[0],$=b.x,it=b.y;s(b);const st=[b];for(let at=1;at<g.length;at++){const ht=g[at],{x:ft,y:xt}=ht;s(ht),pr(st,$,it,ft,xt,b,ht,s,a),$=ft,it=xt,b=ht}return st}function Cr(g,s,a,b){if(b(s,a)){const $=s.add(a)._mult(.5);Cr(g,s,$,b),Cr(g,$,a,b)}else g.push(a)}function wr(g,s){let a=g[0];const b=[a];for(let $=1;$<g.length;$++){const it=g[$];Cr(b,a,it,s),a=it}return b}const Tr=Math.pow(2,14)-1,br=-Tr-1;function yr(g,s){const a=Math.round(g.x*s),b=Math.round(g.y*s);return g.x=Qt(a,br,Tr),g.y=Qt(b,br,Tr),(a<g.x||a>g.x+1||b<g.y||b>g.y+1)&&$s("Geometry exceeds allowed extent, reduce your vector tile buffer size"),g}function Pr(g,s,a){const b=g.loadGeometry(),$=g.extent,it=Ps/$;if(s&&a&&a.projection.isReprojectedInTileSpace){const st=1<<s.z,{scale:at,x:ht,y:ft,projection:xt}=a,Et=Rt=>{const Pt=Ct((s.x+Rt.x/$)/st),Lt=Ut((s.y+Rt.y/$)/st),Gt=xt.project(Pt,Lt);Rt.x=(Gt.x*at-ht)*$,Rt.y=(Gt.y*at-ft)*$};for(let Rt=0;Rt<b.length;Rt++)if(g.type!==1)b[Rt]=ur(b[Rt],Et,1);else{const Pt=[];for(const Lt of b[Rt])Lt.x<0||Lt.x>=$||Lt.y<0||Lt.y>=$||(Et(Lt),Pt.push(Lt));b[Rt]=Pt}}for(const st of b)for(const at of st)yr(at,it);return b}function Or(g,s){return{type:g.type,id:g.id,properties:g.properties,geometry:s?Pr(g):[]}}class Nr{constructor(s,a,b,$,it){this.properties={},this.extent=b,this.type=0,this.id=void 0,this._pbf=s,this._geometry=-1,this._keys=$,this._values=it,s.readFields(ts,this,a)}loadGeometry(){const s=this._pbf;s.pos=this._geometry;const a=s.readVarint()+s.pos,b=[];let $,it=1,st=0,at=0,ht=0;for(;s.pos<a;){if(st<=0){const ft=s.readVarint();it=7&ft,st=ft>>3}if(st--,it===1||it===2)at+=s.readSVarint(),ht+=s.readSVarint(),it===1&&($&&b.push($),$=[]),$&&$.push(new ps(at,ht));else{if(it!==7)throw new Error(`unknown command ${it}`);$&&$.push($[0].clone())}}return $&&b.push($),b}bbox(){const s=this._pbf;s.pos=this._geometry;const a=s.readVarint()+s.pos;let b=1,$=0,it=0,st=0,at=1/0,ht=-1/0,ft=1/0,xt=-1/0;for(;s.pos<a;){if($<=0){const Et=s.readVarint();b=7&Et,$=Et>>3}if($--,b===1||b===2)it+=s.readSVarint(),st+=s.readSVarint(),it<at&&(at=it),it>ht&&(ht=it),st<ft&&(ft=st),st>xt&&(xt=st);else if(b!==7)throw new Error(`unknown command ${b}`)}return[at,ft,ht,xt]}toGeoJSON(s,a,b){const $=this.extent*Math.pow(2,b),it=this.extent*s,st=this.extent*a,at=this.loadGeometry();function ht(Rt){return[360*(Rt.x+it)/$-180,360/Math.PI*Math.atan(Math.exp((1-2*(Rt.y+st)/$)*Math.PI))-90]}function ft(Rt){return Rt.map(ht)}let xt;if(this.type===1){const Rt=[];for(const Lt of at)Rt.push(Lt[0]);const Pt=ft(Rt);xt=Rt.length===1?{type:"Point",coordinates:Pt[0]}:{type:"MultiPoint",coordinates:Pt}}else if(this.type===2){const Rt=at.map(ft);xt=Rt.length===1?{type:"LineString",coordinates:Rt[0]}:{type:"MultiLineString",coordinates:Rt}}else{if(this.type!==3)throw new Error("unknown feature type");{const Rt=function(Lt){const Gt=Lt.length;if(Gt<=1)return[Lt];const Kt=[];let Xt,nr;for(let lr=0;lr<Gt;lr++){const hr=rs(Lt[lr]);hr!==0&&(nr===void 0&&(nr=hr<0),nr===hr<0?(Xt&&Kt.push(Xt),Xt=[Lt[lr]]):Xt&&Xt.push(Lt[lr]))}return Xt&&Kt.push(Xt),Kt}(at),Pt=[];for(const Lt of Rt)Pt.push(Lt.map(ft));xt=Pt.length===1?{type:"Polygon",coordinates:Pt[0]}:{type:"MultiPolygon",coordinates:Pt}}}const Et={type:"Feature",geometry:xt,properties:this.properties};return this.id!=null&&(Et.id=this.id),Et}}function ts(g,s,a){g===1?s.id=a.readVarint():g===2?function(b,$){const it=b.readVarint()+b.pos;for(;b.pos<it;){const st=$._keys[b.readVarint()],at=$._values[b.readVarint()];$.properties[st]=at}}(a,s):g===3?s.type=a.readVarint():g===4&&(s._geometry=a.pos)}function rs(g){let s=0;for(let a,b,$=0,it=g.length,st=it-1;$<it;st=$++)a=g[$],b=g[st],s+=(b.x-a.x)*(a.y+b.y);return s}Nr.types=["Unknown","Point","LineString","Polygon"];class cs{constructor(s,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Ss,this,a),this.length=this._features.length}feature(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];const a=this._pbf.readVarint()+this._pbf.pos;return new Nr(this._pbf,a,this.extent,this._keys,this._values)}}function Ss(g,s,a){g===15?s.version=a.readVarint():g===1?s.name=a.readString():g===5?s.extent=a.readVarint():g===2?s._features.push(a.pos):g===3?s._keys.push(a.readString()):g===4&&s._values.push(function(b){let $=null;const it=b.readVarint()+b.pos;for(;b.pos<it;){const st=b.readVarint()>>3;$=st===1?b.readString():st===2?b.readFloat():st===3?b.readDouble():st===4?b.readVarint64():st===5?b.readVarint():st===6?b.readSVarint():st===7?b.readBoolean():null}if($==null)throw new Error("unknown feature value");return $}(a))}class Zr{constructor(s,a){this.layers=s.readFields(Fr,{},a)}}function Fr(g,s,a){if(g===3){const b=new cs(a,a.readVarint()+a.pos);b.length&&(s[b.name]=b)}}const ns="3d_elevation_id",Qr="level";class gs{constructor(){this._valid=!1}reset(s){return this.feature=s,this._valid=!0,this._geometry=s.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(s,a){return this._valid&&s(a(this._geometry)),this}require(s,a,b){return this.get(s,!0,a,b)}optional(s,a,b){return this.get(s,!1,a,b)}success(){return this._valid}get(s,a,b,$){const it=this.feature.properties.hasOwnProperty(s)?+this.feature.properties[s]:void 0;return this._valid&&it!==void 0&&!Number.isNaN(it)?b($?$(it):it):a&&(this._valid=!1),this}}class ks{constructor(s,a){this.featureFunc=s,this.vertexFunc=a}parseFeature(s,a,b){return this.featureFunc(s,a,b)}parseVertex(s,a,b){return this.vertexFunc(s,a,b)}}const Bs=new ks((g,s,a)=>g.reset(s).require(ns,b=>{a.id=b}).optional("fixed_height_relative",b=>{a.constantHeight=b},Ts.decodeRelativeHeight).geometry(b=>{a.bounds=b},Jp).success(),(g,s,a)=>g.reset(s).require(ns,b=>{a.id=b}).require("elevation_idx",b=>{a.idx=b}).require("extent",b=>{a.extent=b}).require("height_relative",b=>{a.height=b},Ts.decodeRelativeHeight).geometry(b=>{a.position=b},Ts.getPoint).success()),js=new ks((g,s,a)=>g.reset(s).require(ns,b=>{a.id=b}).optional("fixed_height",b=>{a.constantHeight=b},Ts.decodeMetricHeight).geometry(b=>{a.bounds=b},Jp).success(),(g,s,a)=>g.reset(s).require(ns,b=>{a.id=b}).require("elevation_idx",b=>{a.idx=b}).require("extent",b=>{a.extent=b}).require("height",b=>{a.height=b},Ts.decodeMetricHeight).geometry(b=>{a.position=b},Ts.getPoint).success());class Ts{static getPoint(s){return Gl(s[0][0].x,s[0][0].y)}static decodeRelativeHeight(s){return 1e-4*s*5}static decodeMetricHeight(s){return 1e-4*s}static getVersionSchema(s){return s?s==="1.0.1"?js:void 0:Bs}static parse(s){const a=[],b=[],$=s.length,it=new gs;for(let st=0;st<$;st++){const at=s.feature(st),ht=at.properties.version,ft=Ts.getVersionSchema(ht);if(ft===void 0){$s(`Unknown elevation feature version number ${ht||"(unknown)"}`);continue}const xt=at.properties.type;if(!xt)continue;const Et=Nr.types[at.type];if(Et==="Point"&&xt==="curve_point"){const Rt={};ft.parseVertex(it,at,Rt)&&a.push(Rt)}else if(Et==="Polygon"&&xt==="curve_meta"){const Rt={};ft.parseFeature(it,at,Rt)&&b.push(Rt)}}return{vertices:a,features:b}}}class Js{constructor(s,a){this.pos=s,this.dir=a}intersectsPlane(s,a,b){const $=Zu(a,this.dir);if(Math.abs($)<1e-6)return!1;const it=((s[0]-this.pos[0])*a[0]+(s[1]-this.pos[1])*a[1])/$;return b[0]=this.pos[0]+this.dir[0]*it,b[1]=this.pos[1]+this.dir[1]*it,!0}}class Ks{constructor(s,a){this.pos=s,this.dir=a}intersectsPlane(s,a,b){const $=On(a,this.dir);if(Math.abs($)<1e-6)return!1;const it=((s[0]-this.pos[0])*a[0]+(s[1]-this.pos[1])*a[1]+(s[2]-this.pos[2])*a[2])/$;return b[0]=this.pos[0]+this.dir[0]*it,b[1]=this.pos[1]+this.dir[1]*it,b[2]=this.pos[2]+this.dir[2]*it,!0}closestPointOnSphere(s,a,b){if(function(Pt,Lt){var Gt=Pt[0],Kt=Pt[1],Xt=Pt[2],nr=Lt[0],lr=Lt[1],hr=Lt[2];return Math.abs(Gt-nr)<=pt*Math.max(1,Math.abs(Gt),Math.abs(nr))&&Math.abs(Kt-lr)<=pt*Math.max(1,Math.abs(Kt),Math.abs(lr))&&Math.abs(Xt-hr)<=pt*Math.max(1,Math.abs(Xt),Math.abs(hr))}(this.pos,s)||a===0)return b[0]=b[1]=b[2]=0,!1;const[$,it,st]=this.dir,at=this.pos[0]-s[0],ht=this.pos[1]-s[1],ft=this.pos[2]-s[2],xt=$*$+it*it+st*st,Et=2*(at*$+ht*it+ft*st),Rt=Et*Et-4*xt*(at*at+ht*ht+ft*ft-a*a);if(Rt<0){const Pt=Math.max(-Et/2,0),Lt=at+$*Pt,Gt=ht+it*Pt,Kt=ft+st*Pt,Xt=Math.hypot(Lt,Gt,Kt);return b[0]=Lt*a/Xt,b[1]=Gt*a/Xt,b[2]=Kt*a/Xt,!1}{const Pt=(-Et-Math.sqrt(Rt))/(2*xt);if(Pt<0){const Lt=Math.hypot(at,ht,ft);return b[0]=at*a/Lt,b[1]=ht*a/Lt,b[2]=ft*a/Lt,!1}return b[0]=at+$*Pt,b[1]=ht+it*Pt,b[2]=ft+st*Pt,!0}}}class Ns{constructor(s,a,b,$,it){this.TL=s,this.TR=a,this.BR=b,this.BL=$,this.horizon=it}static fromInvProjectionMatrix(s,a,b){const $=[-1,1,1],it=[1,1,1],st=[1,-1,1],at=[-1,-1,1],ht=Os($,$,s),ft=Os(it,it,s),xt=Os(st,st,s),Et=Os(at,at,s);return new Ns(ht,ft,xt,Et,a/b)}}function Gs(g,s,a){let b=1/0,$=-1/0;const it=[];for(const st of g){Pn(it,st,s);const at=On(it,a);b=Math.min(b,at),$=Math.max($,at)}return[b,$]}function ln(g,s){let a=!0;for(let b=0;b<g.planes.length;b++){const $=g.planes[b];let it=0;for(let st=0;st<s.length;st++)it+=+(On($,s[st])+$[3]>=0);if(it===0)return 0;it!==s.length&&(a=!1)}return a?2:1}function En(g,s){for(const a of g.projections){const b=Gs(s,g.points[0],a.axis);if(a.projection[1]<b[0]||a.projection[0]>b[1])return 0}return 1}function Hn(g,s){let a=0;const b=[0,0,0,0];for(let st=0;st<g.length;st++)b[0]=g[st][0],b[1]=g[st][1],b[2]=g[st][2],b[3]=1,($=b)[0]*(it=s)[0]+$[1]*it[1]+$[2]*it[2]+$[3]*it[3]>=0&&a++;var $,it;return a}class ho{constructor(s,a){this.points=s||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=en.fromPoints(this.points),this.projections=[],this.frustumEdges=[Pn([],this.points[2],this.points[3]),Pn([],this.points[0],this.points[3]),Pn([],this.points[4],this.points[0]),Pn([],this.points[5],this.points[1]),Pn([],this.points[6],this.points[2]),Pn([],this.points[7],this.points[3])];for(const b of this.frustumEdges){const $=[0,-b[2],b[1]],it=[b[2],0,-b[0]];this.projections.push({axis:$,projection:Gs(this.points,this.points[0],$)}),this.projections.push({axis:it,projection:Gs(this.points,this.points[0],it)})}}static fromInvProjectionMatrix(s,a,b,$){const it=Math.pow(2,b),st=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ft=>{const xt=uo([],ft,s),Et=1/xt[3]/a*it;return(Rt=xt)[0]=(Pt=xt)[0]*(Lt=[Et,Et,$?1/xt[3]:Et,Et])[0],Rt[1]=Pt[1]*Lt[1],Rt[2]=Pt[2]*Lt[2],Rt[3]=Pt[3]*Lt[3],Rt;var Rt,Pt,Lt}),at=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ft=>{const xt=Cn([],qr([],Pn([],st[ft[0]],st[ft[1]]),Pn([],st[ft[2]],st[ft[1]]))),Et=-On(xt,st[ft[1]]);return xt.concat(Et)}),ht=[];for(let ft=0;ft<st.length;ft++)ht.push([st[ft][0],st[ft][1],st[ft][2]]);return new ho(ht,at)}intersectsPrecise(s,a,b){for(let $=0;$<a.length;$++)if(!Hn(s,a[$]))return 0;for(let $=0;$<this.planes.length;$++)if(!Hn(s,this.planes[$]))return 0;for(const $ of b)for(const it of this.frustumEdges){const st=qr([],$,it),at=Kr(st);if(at===0)continue;us(st,st,1/at);const ht=Gs(this.points,this.points[0],st),ft=Gs(s,this.points[0],st);if(ht[0]>ft[1]||ft[0]>ht[1])return 0}return 1}containsPoint(s){for(const a of this.planes){const b=a[3];if(On([a[0],a[1],a[2]],s)+b<0)return!1}return!0}}class en{static fromPoints(s){const a=[1/0,1/0,1/0],b=[-1/0,-1/0,-1/0];for(const $ of s)Ar(a,a,$),Xr(b,b,$);return new en(a,b)}static fromTileIdAndHeight(s,a,b){const $=1<<s.canonical.z,it=s.canonical.x,st=s.canonical.y;return new en([it/$,st/$,a],[(it+1)/$,(st+1)/$,b])}static applyTransform(s,a){const b=s.getCorners();for(let $=0;$<b.length;++$)Os(b[$],b[$],a);return en.fromPoints(b)}static applyTransformFast(s,a){const b=[a[12],a[13],a[14]],$=[...b];for(let it=0;it<3;it++)for(let st=0;st<3;st++){const at=a[4*st+it],ht=at*s.min[st],ft=at*s.max[st];b[it]+=Math.min(ht,ft),$[it]+=Math.max(ht,ft)}return new en(b,$)}static projectAabbCorners(s,a){const b=s.getCorners();for(let $=0;$<b.length;++$)Os(b[$],b[$],a);return b}constructor(s,a){this.min=s,this.max=a,this.center=us([],rr([],this.min,this.max),.5)}quadrant(s){const a=[s%2==0,s<2],b=Ms(this.min),$=Ms(this.max);for(let it=0;it<a.length;it++)b[it]=a[it]?this.min[it]:this.center[it],$[it]=a[it]?this.center[it]:this.max[it];return $[2]=this.max[2],new en(b,$)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}distanceZ(s){return Math.max(Math.min(this.max[2],s[2]),this.min[2])-s[2]}getCorners(){const s=this.min,a=this.max;return[[s[0],s[1],s[2]],[a[0],s[1],s[2]],[a[0],a[1],s[2]],[s[0],a[1],s[2]],[s[0],s[1],a[2]],[a[0],s[1],a[2]],[a[0],a[1],a[2]],[s[0],a[1],a[2]]]}intersects(s){return this.intersectsAabb(s.bounds)?ln(s,this.getCorners()):0}intersectsFlat(s){return this.intersectsAabb(s.bounds)?ln(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(s,a){return a||this.intersects(s)?En(s,this.getCorners()):0}intersectsPreciseFlat(s,a){return a||this.intersectsFlat(s)?En(s,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(s){for(let a=0;a<3;++a)if(this.min[a]>s.max[a]||s.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(s){return!(this.min[0]>s.max[0]||s.min[0]>this.max[0]||this.min[1]>s.max[1]||s.min[1]>this.max[1])}encapsulate(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s.min[a]),this.max[a]=Math.max(this.max[a],s.max[a])}encapsulatePoint(s){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],s[a]),this.max[a]=Math.max(this.max[a],s[a])}closestPoint(s){return[Math.max(Math.min(this.max[0],s[0]),this.min[0]),Math.max(Math.min(this.max[1],s[1]),this.min[1]),Math.max(Math.min(this.max[2],s[2]),this.min[2])]}}Xs(en,"Aabb");class ao{constructor(s,a){this.feature=s,this.metersToTile=a,this.index=0}get(){const s=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,b=a[1],$=-a[0],it=(s.extent+1)*this.metersToTile;return[new ps(Math.trunc(s.position[0]+b*it),Math.trunc(s.position[1]+$*it)),new ps(Math.trunc(s.position[0]-b*it),Math.trunc(s.position[1]-$*it))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class bn{constructor(s,a,b,$,it,st){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Vo(),Vo(),Vo(),Vo(),Vo(),Vo(),Vo()],this.id=s,this.heightRange={min:b,max:b},this.safeArea=a,this.constantHeight=b,this.constantHeight==null&&(this.constantHeight!=null||$.length!==0)){this.vertices=$,this.edges=it,this.edges=this.edges.filter(at=>{return at.a<this.vertices.length&&at.b<this.vertices.length&&!((ht=this.vertices[at.a].position)[0]===(ft=this.vertices[at.b].position)[0]&&ht[1]===ft[1]);var ht,ft}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const at of this.vertices)this.vertexProps.push({dir:Gl(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,at.height),this.heightRange.max=Math.max(this.heightRange.max,at.height);for(const at of this.edges){const ht=this.vertices[at.a].position,ft=this.vertices[at.b].position,xt=au(Vo(),ft,ht),Et=Il(xt),Rt=pu(Vo(),xt,1/Et);this.edgeProps.push({vec:xt,dir:Rt,len:Et});const Pt=this.vertexProps[at.a].dir,Lt=this.vertexProps[at.b].dir;ju(Pt,Pt,Rt),ju(Lt,Lt,Rt)}for(const at of this.vertexProps)at.dir[0]===0&&at.dir[1]===0||Ou(at.dir,at.dir);this.tessellate(st)}}pointElevation(s){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(s);if(a==null)return 0;const[b,$]=a;return pn(this.vertices[this.edges[b].a].height,this.vertices[this.edges[b].b].height,$)}computeSlopeNormal(s,a){const b=this.getClosestEdge(s);if(!b)return xr(0,0,1);const $=b[0],it=this.edges[$],st=this.edgeProps[$].vec,at=xr(st[0],st[1],(this.vertices[it.b].height-this.vertices[it.a].height)*a),ht=xr(at[1],-at[0],0);qr(ht,ht,at);const ft=Kr(ht);return ft>0?us(ht,ht,1/ft):jr(ht,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(s){if(this.edges.length===0)return;let a=0,b=Number.POSITIVE_INFINITY,$=0;const[it,st,at,ht,ft,xt,Et]=this._tmpVec2;fu(Et,s.x,s.y);const Rt=new Js(Et,null);for(let Pt=0;Pt<this.edges.length;Pt++){const Lt=this.edges[Pt],Gt=this.edgeProps[Pt].dir;Rt.dir=Gt;const Kt=this.vertices[Lt.a].position,Xt=this.vertices[Lt.b].position,nr=Rt.intersectsPlane(Kt,this.vertexProps[Lt.a].dir,it),lr=Rt.intersectsPlane(Xt,this.vertexProps[Lt.b].dir,st);if(!nr||!lr)continue;au(at,st,it),au(ht,Et,it);const hr=Zu(at,at),Er=hr>0?Zu(ht,at)/hr:0,_r=Qt(Er,0,1),Rr=Math.abs((Er-_r)*this.edgeProps[Pt].len);au(ft,Et,Kt),fu(xt,Gt[1],-Gt[0]);const kr=Rr+Math.abs(Zu(ft,xt));kr<b&&(a=Pt,b=kr,$=_r)}return[a,$]}tessellate(s){const a=ms(),b=ms(),$=ms(),it=ms();for(let st=this.edges.length-1;st>=0;--st){const at=this.edges[st].a,ht=this.edges[st].b,{position:ft,height:xt,extent:Et}=this.vertices[at],{position:Rt,height:Pt,extent:Lt}=this.vertices[ht],Gt=this.vertexProps[at].dir,Kt=this.vertexProps[ht].dir;if(jr(a,ft[0]/s,ft[1]/s,xt),jr(b,Rt[0]/s,Rt[1]/s,Pt),jr($,Gt[1],-Gt[0],0),us($,$,Et),jr(it,Kt[1],-Kt[0],0),us(it,it,Lt),this.distSqLines(xr(a[0]+.5*$[0],a[1]+.5*$[1],a[2]+.5*$[2]),xr(b[0]-.5*it[0],b[1]-.5*it[1],b[2]-.5*it[2]),xr(a[0]-.5*$[0],a[1]-.5*$[1],a[2]-.5*$[2]),xr(b[0]+.5*it[0],b[1]+.5*it[1],b[2]+.5*it[2]))<=.0025000000000000005)continue;const Xt=this.vertices.length,nr=ju(Vo(),ft,Rt);this.vertices.push({position:pu(nr,nr,.5),height:.5*(xt+Pt),extent:.5*(Et+Lt)});const lr=ju(Vo(),Gt,Kt);this.vertexProps.push({dir:Ou(lr,lr)}),this.edges.splice(st,1),this.edgeProps.splice(st,1),this.edges.push({a:at,b:Xt}),this.edges.push({a:Xt,b:ht});const hr=au(Vo(),this.vertices[Xt].position,ft),Er=Il(hr),_r={vec:hr,dir:pu(Vo(),hr,1/Er),len:Er};this.edgeProps.push(_r),this.edgeProps.push(_r)}}distSqLines(s,a,b,$){const it=ar(ms(),a,s),st=ar(ms(),$,b),at=ar(ms(),s,b),ht=On(it,it),ft=On(it,st),xt=On(it,at),Et=On(st,st),Rt=On(st,at),Pt=ht*Et-ft*ft;if(Pt===0)return yn(Zs(it,b,$,On(at,st)/On(st,st)),s);const Lt=(ht*Rt-ft*xt)/Pt;return yn(Zs(it,s,a,(ft*Rt-xt*Et)/Pt),Zs(st,b,$,Lt))}}class mo{static parseFrom(s,a){const b=Ts.parse(s);if(!b)return[];let{vertices:$,features:it}=b;const st=1/ir(a);it.sort((xt,Et)=>xt.id-Et.id),$.sort((xt,Et)=>xt.id-Et.id||xt.idx-Et.idx),$=$.filter((xt,Et,Rt)=>Et===Rt.findIndex(Pt=>Pt.id===xt.id&&Pt.idx===xt.idx));const at=new Array;let ht=0;const ft=$.length;for(const xt of it){if(xt.constantHeight){at.push(new bn(xt.id,xt.bounds,xt.constantHeight));continue}for(;ht!==ft&&$[ht].id<xt.id;)ht++;if(ht===ft||$[ht].id!==xt.id)continue;const Et=new Array,Rt=new Array,Pt=ht;for(;ht!==ft&&$[ht].id===xt.id;){const Lt=$[ht];if(Et.push({position:Lt.position,height:Lt.height,extent:Lt.extent}),ht!==Pt&&$[ht-1].idx===Lt.idx-1){const Gt=ht-Pt;Rt.push({a:Gt-1,b:Gt})}ht++}at.push(new bn(xt.id,xt.bounds,void 0,Et,Rt,st))}return at}static getElevationFeature(s,a){if(!a)return;const b=+s.properties[ns];return Number.isNaN(b)?void 0:a.find($=>$.id===b)}}class To{constructor(s,a){this.zScale=1,this.xOffset=0,this.yOffset=0,s.equals(a)||(this.zScale=Math.pow(2,a.z-s.z),this.xOffset=(s.x*this.zScale-a.x)*Ps,this.yOffset=(s.y*this.zScale-a.y)*Ps)}constantElevation(s,a){if(s.constantHeight!=null)return this.computeBiasedHeight(s.constantHeight,a)}pointElevation(s,a,b){const $=this.constantElevation(a,b);return $??(s.x=s.x*this.zScale+this.xOffset,s.y=s.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(s),b))}computeBiasedHeight(s,a){return a<=0?s:s+a*or(0,a,s>=0?s:Math.abs(.5*s))}}Xs(bn,"ElevationFeature");class bo{constructor(s){this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.projection=s.projection,this.layoutVertexArray=new Nm,this.indexArray=new Zl,this.segments=new ga,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new om),this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,a){}updateAppearances(s,a,b,$){}populate(s,a,b,$){const it=this.layers[0],st=[];let at=null;it.type==="circle"&&(at=it.layout.get("circle-sort-key"));for(const{feature:ft,id:xt,index:Et,sourceLayerIndex:Rt}of s){const Pt=this.layers[0]._featureFilter.needGeometry,Lt=Or(ft,Pt);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Lt,b))continue;const Gt=at?at.evaluate(Lt,{},b):void 0,Kt={id:xt,properties:ft.properties,type:ft.type,sourceLayerIndex:Rt,index:Et,geometry:Pt?Lt.geometry:Pr(ft,b,$),patterns:{},sortKey:Gt};st.push(Kt)}at&&st.sort((ft,xt)=>ft.sortKey-xt.sortKey);let ht=null;$.projection.name==="globe"&&(this.globeExtVertexArray=new l_,ht=$.projection);for(const ft of st){const{geometry:xt,index:Et,sourceLayerIndex:Rt}=ft,Pt=s[Et].feature;this.addFeature(ft,xt,Et,a.availableImages,b,ht,a.brightness,a.elevationFeatures),a.featureIndex.insert(Pt,xt,Et,Rt,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(s,a,b,$,it,st,at){this.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,eE.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,tE.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,_2.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(s,a,b,$,it,st,at,ht){let ft;this.elevationMode!=="none"&&(ft=mo.getElevationFeature(s,ht));for(const xt of a)for(const Et of xt){const Rt=Et.x,Pt=Et.y;if(Rt<0||Rt>=Ps||Pt<0||Pt>=Ps)continue;if(st){const Kt=st.projectTilePoint(Rt,Pt,it),Xt=st.upVector(it,Rt,Pt);this.addGlobeExtVertex(Kt,Xt),this.addGlobeExtVertex(Kt,Xt),this.addGlobeExtVertex(Kt,Xt),this.addGlobeExtVertex(Kt,Xt)}const Lt=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,s.sortKey),Gt=Lt.vertexLength;if(this.addCircleVertex(Rt,Pt,-1,-1),this.addCircleVertex(Rt,Pt,1,-1),this.addCircleVertex(Rt,Pt,1,1),this.addCircleVertex(Rt,Pt,-1,1),this.elevationMode!=="none"){const Kt=ft?ft.pointElevation(new ps(Rt,Pt)):0;this.hasElevation=this.hasElevation||Kt!==0;for(let Xt=0;Xt<4;Xt++)this.elevatedLayoutVertexArray.emplaceBack(Kt)}this.indexArray.emplaceBack(Gt,Gt+1,Gt+2),this.indexArray.emplaceBack(Gt,Gt+2,Gt+3),Lt.vertexLength+=4,Lt.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,b,{},$,it,at,void 0,this.worldview)}addCircleVertex(s,a,b,$){this.layoutVertexArray.emplaceBack(2*s+(b+1)/2,2*a+($+1)/2)}addGlobeExtVertex(s,a){this.globeExtVertexArray.emplaceBack(s.x,s.y,s.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function no(g,s){for(let a=0;a<g.length;a++)if(ko(s,g[a]))return!0;for(let a=0;a<s.length;a++)if(ko(g,s[a]))return!0;return!!Ko(g,s)}function kn(g,s,a){return!!ko(g,s)||!!Zo(s,g,a)}function po(g,s){if(g.length===1)return xa(s,g[0]);for(let a=0;a<s.length;a++){const b=s[a];for(let $=0;$<b.length;$++)if(ko(g,b[$]))return!0}for(let a=0;a<g.length;a++)if(xa(s,g[a]))return!0;for(let a=0;a<s.length;a++)if(Ko(g,s[a]))return!0;return!1}function yl(g,s,a){if(g.length>1){if(Ko(g,s))return!0;for(let b=0;b<s.length;b++)if(Zo(s[b],g,a))return!0}for(let b=0;b<g.length;b++)if(Zo(g[b],s,a))return!0;return!1}function Ko(g,s){if(g.length===0||s.length===0)return!1;for(let a=0;a<g.length-1;a++){const b=g[a],$=g[a+1];for(let it=0;it<s.length-1;it++)if(go(b,$,s[it],s[it+1]))return!0}return!1}function go(g,s,a,b){return In(g,a,b)!==In(s,a,b)&&In(g,s,a)!==In(g,s,b)}function Jn(g,s,a){return(g.x-a.x)*(s.y-a.y)-(g.y-a.y)*(s.x-a.x)}function Mn(g,s,a,b){const $=Jn(g,s,b),it=Jn(g,s,a);if(Math.sign($)===Math.sign(it))return;const st=Jn(a,b,g),at=st+it-$;return Math.sign(st)!==Math.sign(at)?[st/(st-at),it/(it-$)]:void 0}function Zo(g,s,a){const b=a*a;if(s.length===1)return g.distSqr(s[0])<b;for(let $=1;$<s.length;$++)if(Al(g,s[$-1],s[$])<b)return!0;return!1}function Al(g,s,a){const b=s.distSqr(a);if(b===0)return g.distSqr(s);const $=((g.x-s.x)*(a.x-s.x)+(g.y-s.y)*(a.y-s.y))/b;return g.distSqr($<0?s:$>1?a:a.sub(s)._mult($)._add(s))}function xa(g,s){let a,b,$,it=!1;for(let st=0;st<g.length;st++){a=g[st];for(let at=0,ht=a.length-1;at<a.length;ht=at++)b=a[at],$=a[ht],b.y>s.y!=$.y>s.y&&s.x<($.x-b.x)*(s.y-b.y)/($.y-b.y)+b.x&&(it=!it)}return it}function ko(g,s){let a=!1;for(let b=0,$=g.length-1;b<g.length;$=b++){const it=g[b],st=g[$];it.y>s.y!=st.y>s.y&&s.x<(st.x-it.x)*(s.y-it.y)/(st.y-it.y)+it.x&&(a=!a)}return a}function Lu(g,s,a,b,$){for(const st of g)if(s<=st.x&&a<=st.y&&b>=st.x&&$>=st.y)return!0;const it=[new ps(s,a),new ps(s,$),new ps(b,$),new ps(b,a)];if(g.length>2){for(const st of it)if(ko(g,st))return!0}for(let st=0;st<g.length-1;st++)if(yu(g[st],g[st+1],it))return!0;return!1}function yu(g,s,a){const b=a[0],$=a[2];if(g.x<b.x&&s.x<b.x||g.x>$.x&&s.x>$.x||g.y<b.y&&s.y<b.y||g.y>$.y&&s.y>$.y)return!1;const it=In(g,s,a[0]);return it!==In(g,s,a[1])||it!==In(g,s,a[2])||it!==In(g,s,a[3])}function Kl(g,s,a,b,$,it){let st=s.y-g.y,at=g.x-s.x;if(it=it||0){const ht=st*st+at*at;if(ht===0)return!0;const ft=Math.sqrt(ht);st/=ft,at/=ft}return!((a.x-g.x)*st+(a.y-g.y)*at-it<0||(b.x-g.x)*st+(b.y-g.y)*at-it<0||($.x-g.x)*st+($.y-g.y)*at-it<0)}function Su(g,s,a,b,$,it,st){return!(Kl(g,s,b,$,it,st)||Kl(s,a,b,$,it,st)||Kl(a,g,b,$,it,st)||Kl(b,$,g,s,a,st)||Kl($,it,g,s,a,st)||Kl(it,b,g,s,a,st))}function Tu(g,s,a){const b=s.paint.get(g).value;return b.kind==="constant"?b.value:a.programConfigurations.get(s.id).getMaxValue(g)}function mu(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function rp(g,s,a,b,$){if(!s[0]&&!s[1])return g;const it=ps.convert(s)._mult($);a==="viewport"&&it._rotate(-b);const st=[];for(let at=0;at<g.length;at++)st.push(g[at].sub(it));return st}function yp(g,s,a,b){const $=ps.convert(g)._mult(b);return s==="viewport"&&$._rotate(-a),$}let Wu,Tl;function Ml(g,s,a){var b=2*Math.PI*6378137/256/Math.pow(2,a);return[g*b-2*Math.PI*6378137/2,s*b-2*Math.PI*6378137/2]}Xs(bo,"CircleBucket",{omit:["layers"]});class Mo{constructor(s,a,b){this.z=s,this.x=a,this.y=b,this.key=_a(0,s,s,a,b)}equals(s){return this.z===s.z&&this.x===s.x&&this.y===s.y}isChildOf(s){const a=this.z-s.z;return s.z===0||s.z<this.z&&s.x===this.x>>a&&s.y===this.y>>a}url(s,a){const b=function(it,st,at){var ht=Ml(256*it,256*(st=Math.pow(2,at)-st-1),at),ft=Ml(256*(it+1),256*(st+1),at);return ht[0]+","+ht[1]+","+ft[0]+","+ft[1]}(this.x,this.y,this.z),$=function(it,st,at){let ht,ft="";for(let xt=it;xt>0;xt--)ht=1<<xt-1,ft+=(st&ht?1:0)+(at&ht?2:0);return ft}(this.z,this.x,this.y);return s[(this.x+this.y)%s.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",$).replace("{bbox-epsg-3857}",b)}toString(){return`${this.z}/${this.x}/${this.y}`}}class zl{constructor(s,a){this.wrap=s,this.canonical=a,this.key=_a(s,a.z,a.z,a.x,a.y)}}class _l{constructor(s,a,b,$,it){this.overscaledZ=s,this.wrap=a,this.canonical=new Mo(b,+$,+it),this.key=a===0&&s===b?this.canonical.key:_a(a,s,b,$,it)}equals(s){return this.overscaledZ===s.overscaledZ&&this.wrap===s.wrap&&this.canonical.equals(s.canonical)}scaledTo(s){const a=this.canonical.z-s;return s>this.canonical.z?new _l(s,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _l(s,this.wrap,s,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(s,a=!0){if(this.overscaledZ===s&&a)return this.key;if(s>this.canonical.z)return _a(this.wrap*+a,s,this.canonical.z,this.canonical.x,this.canonical.y);{const b=this.canonical.z-s;return _a(this.wrap*+a,s,s,this.canonical.x>>b,this.canonical.y>>b)}}isChildOf(s){if(s.wrap!==this.wrap)return!1;const a=this.canonical.z-s.canonical.z;return s.overscaledZ===0||s.overscaledZ<this.overscaledZ&&s.canonical.z<this.canonical.z&&s.canonical.x===this.canonical.x>>a&&s.canonical.y===this.canonical.y>>a}children(s){if(this.overscaledZ>=s)return[new _l(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,b=2*this.canonical.x,$=2*this.canonical.y;return[new _l(a,this.wrap,a,b,$),new _l(a,this.wrap,a,b+1,$),new _l(a,this.wrap,a,b,$+1),new _l(a,this.wrap,a,b+1,$+1)]}isLessThan(s){return this.wrap<s.wrap||!(this.wrap>s.wrap)&&(this.overscaledZ<s.overscaledZ||!(this.overscaledZ>s.overscaledZ)&&(this.canonical.x<s.canonical.x||!(this.canonical.x>s.canonical.x)&&this.canonical.y<s.canonical.y))}wrapped(){return new _l(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(s){return new _l(this.overscaledZ,s,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new zl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _a(g,s,a,b,$){const it=1<<Math.min(a,22);let st=it*($%it)+b%it;return g&&a<22&&(st+=it*it*((g<0?-2*g-1:2*g)%(1<<2*(22-a)))),16*(32*st+a)+(s-a)}const _p=[g=>{let s=g.canonical.x-1,a=g.wrap;return s<0&&(s=(1<<g.canonical.z)-1,a--),new _l(g.overscaledZ,a,g.canonical.z,s,g.canonical.y)},g=>{let s=g.canonical.x+1,a=g.wrap;return s===1<<g.canonical.z&&(s=0,a++),new _l(g.overscaledZ,a,g.canonical.z,s,g.canonical.y)},g=>new _l(g.overscaledZ,g.wrap,g.canonical.z,g.canonical.x,(g.canonical.y===0?1<<g.canonical.z:g.canonical.y)-1),g=>new _l(g.overscaledZ,g.wrap,g.canonical.z,g.canonical.x,g.canonical.y===(1<<g.canonical.z)-1?0:g.canonical.y+1)];Xs(Mo,"CanonicalTileID"),Xs(_l,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Hy=Vn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Pp}=Hy,Wy=Vn([{name:"a_pos_3",components:3,type:"Int16"}]);var Wx=Vn([{name:"a_pos",type:"Int16",components:2}]);function Wp(g){return g*Eu/et}const hm=[new en([gp,gp,gp],[xp,xp,xp]),new en([gp,gp,gp],[0,0,xp]),new en([0,gp,gp],[xp,0,xp]),new en([gp,0,gp],[0,xp,xp]),new en([0,0,gp],[xp,xp,xp])];function qx(g,s,a,b=!0){const $=us([],g._camera.position,g.worldSize),it=[s,a,1,1];uo(it,it,g.pixelMatrixInverse),Qo(it,it,1/it[3]);const st=Cn([],Pn([],it,$)),at=g.globeMatrix,ht=[at[12],at[13],at[14]],ft=Pn([],ht,$),xt=Kr(ft),Et=Cn([],ft),Rt=g.worldSize/(2*Math.PI),Pt=On(Et,st),Lt=Math.asin(Rt/xt);if(Lt<Math.acos(Pt)){if(!b)return null;const is=[],Br=[];us(is,st,xt/Pt),Cn(Br,Pn(Br,is,ft)),Cn(st,rr(st,ft,us(st,Br,Math.tan(Lt)*xt)))}const Gt=[];new Ks($,st).closestPointOnSphere(ht,Rt,Gt);const Kt=Cn([],Rl(at,0)),Xt=Cn([],Rl(at,1)),nr=Cn([],Rl(at,2)),lr=On(Kt,Gt),hr=On(Xt,Gt),Er=On(nr,Gt),_r=Nl(Math.asin(-hr/Rt));let Rr=Nl(Math.atan2(lr,Er));Rr=g.center.lng+function(is,Br){const as=(Br-is+180)%360-180;return as<-180?as+360:as}(g.center.lng,Rr);const kr=dt(Rr),Lr=Qt(mt(_r),0,1);return new cr(kr,Lr)}class Vm{constructor(s,a,b){this.a=Pn([],s,b),this.b=Pn([],a,b),this.center=b;const $=Cn([],this.a),it=Cn([],this.b);this.angle=Math.acos(On($,it))}}function dm(g,s){if(g.angle===0)return null;let a;return a=g.a[s]===0?1/g.angle*.5*Math.PI:1/g.angle*Math.atan(g.b[s]/g.a[s]/Math.sin(g.angle)-1/Math.tan(g.angle)),a<0||a>1?null:function(b,$,it,st){const at=Math.sin(it);return b*(Math.sin((1-st)*it)/at)+$*(Math.sin(st*it)/at)}(g.a[s],g.b[s],g.angle,Qt(a,0,1))+g.center[s]}function Ip(g){if(g.z<=1)return hm[g.z+2*g.y+g.x];const s=P2(rE(g));return en.fromPoints(s)}function fm(g,s,a){return us(g,g,1-a),Wr(g,g,s,a)}function YS(g,s,a){for(const b of g)Os(b,b,s),us(b,b,a)}function QS(g,s,a,b){const $=s/g.worldSize,it=g.globeMatrix;if(a.z<=1){const Lr=Ip(a).getCorners();return YS(Lr,it,$),en.fromPoints(Lr)}const st=rE(a,b),at=P2(st,Eu+Wp(g._tileCoverLift));YS(at,it,$);const ht=Number.MAX_VALUE,ft=[-ht,-ht,-ht],xt=[ht,ht,ht];if(st.contains(g.center)){for(const Br of at)Ar(xt,xt,Br),Xr(ft,ft,Br);ft[2]=0;const Lr=g.point,is=[Lr.x*$,Lr.y*$,0];return Ar(xt,xt,is),Xr(ft,ft,is),new en(xt,ft)}if(g._tileCoverLift>0){for(const Lr of at)Ar(xt,xt,Lr),Xr(ft,ft,Lr);return new en(xt,ft)}const Et=[it[12]*$,it[13]*$,it[14]*$],Rt=st.getCenter(),Pt=Qt(g.center.lat,-$t,$t),Lt=Qt(Rt.lat,-$t,$t),Gt=dt(g.center.lng),Kt=mt(Pt);let Xt=Gt-dt(Rt.lng);const nr=Kt-mt(Lt);Xt>.5?Xt-=1:Xt<-.5&&(Xt+=1);let lr=0;Math.abs(Xt)>Math.abs(nr)?lr=Xt>=0?1:3:(lr=nr>=0?0:2,Wr(Et,Et,[it[4]*$,it[5]*$,it[6]*$],-Math.sin(wn(nr>=0?st.getSouth():st.getNorth()))*Eu));const hr=at[lr],Er=at[(lr+1)%4],_r=new Vm(hr,Er,Et),Rr=[dm(_r,0)||hr[0],dm(_r,1)||hr[1],dm(_r,2)||hr[2]],kr=Zx(g.zoom);if(kr>0){const Lr=function({x:Br,y:as,z:ds},fs,vs,ws,xs){const ys=1/(1<<ds);let os=Br*ys,ss=os+ys,_s=as*ys,Is=_s+ys,Rs=0;const rn=(os+ss)/2-ws;return rn>.5?Rs=-1:rn<-.5&&(Rs=1),os=((os+Rs)*fs-(ws*=fs))*vs+ws,ss=((ss+Rs)*fs-ws)*vs+ws,_s=(_s*fs-(xs*=fs))*vs+xs,Is=(Is*fs-xs)*vs+xs,[[os,Is,0],[ss,Is,0],[ss,_s,0],[os,_s,0]]}(a,s,g._pixelsPerMercatorPixel,Gt,Kt);for(let Br=0;Br<at.length;Br++)fm(at[Br],Lr[Br],kr);const is=rr([],Lr[lr],Lr[(lr+1)%4]);us(is,is,.5),fm(Rr,is,kr)}for(const Lr of at)Ar(xt,xt,Lr),Xr(ft,ft,Lr);return xt[2]=Math.min(hr[2],Er[2]),Ar(xt,xt,Rr),Xr(ft,ft,Rr),new en(xt,ft)}function rE({x:g,y:s,z:a},b=!1){const $=1/(1<<a),it=new _(Ct(g*$),s===(1<<a)-1&&b?-90:Ut((s+1)*$)),st=new _(Ct((g+1)*$),s===0&&b?90:Ut(s*$));return new rt(it,st)}function P2(g,s=Eu){const a=wn(g.getNorth()),b=wn(g.getSouth()),$=Math.cos(a),it=Math.cos(b),st=Math.sin(a),at=Math.sin(b),ht=g.getWest(),ft=g.getEast();return[fx(it,at,ht,s),fx(it,at,ft,s),fx($,st,ft,s),fx($,st,ht,s)]}function a1(g,s,a,b){const $=1<<a.z,it=(g/Ps+a.x)/$;return Hx(Ut((s/Ps+a.y)/$),Ct(it),b)}function iE({min:g,max:s}){return j2/Math.max(s[0]-g[0],s[1]-g[1],s[2]-g[2])}const JS=new Float64Array(16);function sE(g){const s=iE(g),a=mr(JS,[s,s,s]);return Mt(a,a,zo([],g.min))}function I2(g){const s=(b=g.min,(a=JS)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a);var a,b;const $=1/iE(g);return Ht(s,s,[$,$,$])}function k2(g){const s=Ps/(2*Math.PI);return g/(2*Math.PI)/s}function eT(g,s){return Ps/(512*Math.pow(2,g))*iE(Ip(s))}function tT(g,s,a,b,$){const it=k2(a),st=[g,s,-a/(2*Math.PI)],at=Jt(new Float64Array(16));return Mt(at,at,st),Ht(at,at,[it,it,it]),tr(at,at,wn(-$)),er(at,at,wn(-b)),at}function Zx(g){return or(mp,T_,g)}function rT(g,s){const a=Hx(s.lat,s.lng),b=function(Lt){const Gt=Hx(Lt._center.lat,Lt._center.lng);let Kt=qr([],xr(0,1,0),Gt);const Xt=Ur([],-Lt.angle,Gt);Kt=Os(Kt,Kt,Xt),Ur(Xt,-Lt._pitch,Kt);const nr=Cn([],Gt);return us(nr,nr,Wp(Lt.cameraToCenterDistance/Lt.pixelsPerMeter)),Os(nr,nr,Xt),rr([],Gt,nr)}(g);return st=($=ar([],b,a))[0],at=$[1],ht=$[2],ft=(it=a)[0],xt=it[1],Et=it[2],Pt=(Rt=Math.sqrt((st*st+at*at+ht*ht)*(ft*ft+xt*xt+Et*Et)))&&On($,it)/Rt,Math.acos(Math.min(Math.max(Pt,-1),1));var $,it,st,at,ht,ft,xt,Et,Rt,Pt}function M2(g,s){return rT(g,s)>Math.PI/2*1.01}const iT=wn(85),sP=Math.cos(iT),nP=Math.sin(iT),oP=Vt(),sT=g=>{const s=[];return g.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),g.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s};function nT(g,s,a,b,$,it,st,at,ht){if(it&&g.queryGeometry.isAboveHorizon)return!1;it&&(ht*=g.pixelToTileUnitsFactor);const ft=g.tileID.canonical,xt=a.projection.upVectorScale(ft,a.center.lat,a.worldSize).metersToTile;for(const Et of s)for(const Rt of Et){const Pt=Rt.add(at),Lt=$&&a.elevation?a.elevation.exaggeration()*$.getElevationAt(Pt.x,Pt.y,!0):0,Gt=a.projection.projectTilePoint(Pt.x,Pt.y,ft);if(Lt>0){const lr=a.projection.upVector(ft,Pt.x,Pt.y);Gt.x+=lr[0]*xt*Lt,Gt.y+=lr[1]*xt*Lt,Gt.z+=lr[2]*xt*Lt}const Kt=it?Pt:aP(Gt.x,Gt.y,Gt.z,b),Xt=it?g.tilespaceRays.map(lr=>cP(lr,Lt)):g.queryGeometry.screenGeometry,nr=uo([],[Gt.x,Gt.y,Gt.z,1],b);if(!st&&it?ht*=nr[3]/a.cameraToCenterDistance:st&&!it&&(ht*=a.cameraToCenterDistance/nr[3]),it){const lr=Ut((Rt.y/Ps+ft.y)/(1<<ft.z));ht/=a.projection.pixelsPerMeter(lr,1)/Tt(1,lr)}if(kn(Xt,Kt,ht))return!0}return!1}function aP(g,s,a,b){const $=uo([],[g,s,a,1],b);return new ps($[0]/$[3],$[1]/$[3])}const oT=xr(0,0,0),lP=xr(0,0,1);function cP(g,s){const a=ms();return oT[2]=s,g.intersectsPlane(oT,lP,a),new ps(a[0],a[1])}class aT extends bo{}let lT,cT,uT,hT;function dT(g,{width:s,height:a},b,$){if($){if($ instanceof Uint8ClampedArray)$=new Uint8Array($.buffer);else if($.length!==s*a*b)throw new RangeError("mismatched image size")}else $=new Uint8Array(s*a*b);return g.width=s,g.height=a,g.data=$,g}function fT(g,s,a){const{width:b,height:$}=s;b===g.width&&$===g.height||(F2(g,s,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,b),height:Math.min(g.height,$)},a,null),g.width=b,g.height=$,g.data=s.data)}function F2(g,s,a,b,$,it,st,at){if($.width===0||$.height===0)return s;if($.width>g.width||$.height>g.height||a.x>g.width-$.width||a.y>g.height-$.height)throw new RangeError("out of range source coordinates for image copy");if($.width>s.width||$.height>s.height||b.x>s.width-$.width||b.y>s.height-$.height)throw new RangeError("out of range destination coordinates for image copy");const ht=g.data,ft=s.data,xt=it===4&&at;for(let Et=0;Et<$.height;Et++){const Rt=((a.y+Et)*g.width+a.x)*it,Pt=((b.y+Et)*s.width+b.x)*it;if(xt)for(let Lt=0;Lt<$.width;Lt++){const Gt=Rt+Lt*it+3,Kt=Pt+Lt*it;ft[Kt+0]=255,ft[Kt+1]=255,ft[Kt+2]=255,ft[Kt+3]=ht[Gt]}else if(st)for(let Lt=0;Lt<$.width;Lt++){const Gt=Rt+Lt*it,Kt=Pt+Lt*it,Xt=new vo(ht[Gt+0]/255,ht[Gt+1]/255,ht[Gt+2]/255,ht[Gt+3]).toNonPremultipliedRenderColor(st).toArray();ft[Kt+0]=Xt[0],ft[Kt+1]=Xt[1],ft[Kt+2]=Xt[2],ft[Kt+3]=Xt[3]}else for(let Lt=0;Lt<$.width*it;Lt++)ft[Pt+Lt]=ht[Rt+Lt]}return s}Xs(aT,"HeatmapBucket",{omit:["layers"]});class Xx{constructor(s,a){dT(this,s,1,a)}resize(s){fT(this,new Xx(s),1)}clone(){return new Xx({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,b,$,it){F2(s,a,b,$,it,1,null)}}class Ru{constructor(s,a){dT(this,s,4,a)}resize(s){fT(this,new Ru(s),4)}replace(s,a){a?this.data.set(s):this.data=s instanceof Uint8ClampedArray?new Uint8Array(s.buffer):s}clone(){return new Ru({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(s,a,b,$,it,st,at){F2(s,a,b,$,it,4,st,at)}}class pT{constructor(s,a){this.width=s.width,this.height=s.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function l1(g){const s={},a=g.resolution||256,b=g.clips?g.clips.length:1,$=g.image||new Ru({width:a,height:b}),it=(st,at,ht)=>{s[g.evaluationKey]=ht;const ft=g.expression.evaluate(s),xt=ft?ft.toNonPremultipliedRenderColor(null):null;xt&&($.data[st+at+0]=Math.floor(255*xt.r),$.data[st+at+1]=Math.floor(255*xt.g),$.data[st+at+2]=Math.floor(255*xt.b),$.data[st+at+3]=Math.floor(255*xt.a))};if(g.clips)for(let st=0,at=0;st<b;++st,at+=4*a)for(let ht=0,ft=0;ht<a;ht++,ft+=4){const xt=ht/(a-1),{start:Et,end:Rt}=g.clips[st];it(at,ft,Et*(1-xt)+Rt*xt)}else for(let st=0,at=0;st<a;st++,at+=4)it(0,at,st/(a-1));return $}Xs(Xx,"AlphaImage"),Xs(Ru,"RGBAImage");const uP=Vn([{name:"a_pos",components:2,type:"Int16"}],4),hP=Vn([{name:"a_road_z_offset",components:1,type:"Float32"}],4),dP=Vn([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),fP=Vn([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function R_(g,s,a=2){const b=s&&s.length,$=b?s[0]*a:g.length;let it=mT(g,0,$,a,!0);const st=[];if(!it||it.next===it.prev)return st;let at,ht,ft;if(b&&(it=function(xt,Et,Rt,Pt){const Lt=[];for(let Gt=0,Kt=Et.length;Gt<Kt;Gt++){const Xt=mT(xt,Et[Gt]*Pt,Gt<Kt-1?Et[Gt+1]*Pt:xt.length,Pt,!1);Xt===Xt.next&&(Xt.steiner=!0),Lt.push(bP(Xt))}Lt.sort(yP);for(let Gt=0;Gt<Lt.length;Gt++)Rt=_P(Lt[Gt],Rt);return Rt}(g,s,it,a)),g.length>80*a){at=g[0],ht=g[1];let xt=at,Et=ht;for(let Rt=a;Rt<$;Rt+=a){const Pt=g[Rt],Lt=g[Rt+1];Pt<at&&(at=Pt),Lt<ht&&(ht=Lt),Pt>xt&&(xt=Pt),Lt>Et&&(Et=Lt)}ft=Math.max(xt-at,Et-ht),ft=ft!==0?32767/ft:0}return c1(it,st,a,at,ht,ft,0),st}function mT(g,s,a,b,$){let it;if($===function(st,at,ht,ft){let xt=0;for(let Et=at,Rt=ht-ft;Et<ht;Et+=ft)xt+=(st[Rt]-st[Et])*(st[Et+1]+st[Rt+1]),Rt=Et;return xt}(g,s,a,b)>0)for(let st=s;st<a;st+=b)it=_T(st/b|0,g[st],g[st+1],it);else for(let st=a-b;st>=s;st-=b)it=_T(st/b|0,g[st],g[st+1],it);return it&&C_(it,it.next)&&(d1(it),it=it.next),it}function qy(g,s){if(!g)return g;s||(s=g);let a,b=g;do if(a=!1,b.steiner||!C_(b,b.next)&&du(b.prev,b,b.next)!==0)b=b.next;else{if(d1(b),b=s=b.prev,b===b.next)break;a=!0}while(a||b!==s);return s}function c1(g,s,a,b,$,it,st){if(!g)return;!st&&it&&function(ht,ft,xt,Et){let Rt=ht;do Rt.z===0&&(Rt.z=L2(Rt.x,Rt.y,ft,xt,Et)),Rt.prevZ=Rt.prev,Rt.nextZ=Rt.next,Rt=Rt.next;while(Rt!==ht);Rt.prevZ.nextZ=null,Rt.prevZ=null,function(Pt){let Lt,Gt=1;do{let Kt,Xt=Pt;Pt=null;let nr=null;for(Lt=0;Xt;){Lt++;let lr=Xt,hr=0;for(let _r=0;_r<Gt&&(hr++,lr=lr.nextZ,lr);_r++);let Er=Gt;for(;hr>0||Er>0&&lr;)hr!==0&&(Er===0||!lr||Xt.z<=lr.z)?(Kt=Xt,Xt=Xt.nextZ,hr--):(Kt=lr,lr=lr.nextZ,Er--),nr?nr.nextZ=Kt:Pt=Kt,Kt.prevZ=nr,nr=Kt;Xt=lr}nr.nextZ=null,Gt*=2}while(Lt>1)}(Rt)}(g,b,$,it);let at=g;for(;g.prev!==g.next;){const ht=g.prev,ft=g.next;if(it?mP(g,b,$,it):pP(g))s.push(ht.i,g.i,ft.i),d1(g),g=ft.next,at=ft.next;else if((g=ft)===at){st?st===1?c1(g=gP(qy(g),s),s,a,b,$,it,2):st===2&&xP(g,s,a,b,$,it):c1(qy(g),s,a,b,$,it,1);break}}}function pP(g){const s=g.prev,a=g,b=g.next;if(du(s,a,b)>=0)return!1;const $=s.x,it=a.x,st=b.x,at=s.y,ht=a.y,ft=b.y,xt=Math.min($,it,st),Et=Math.min(at,ht,ft),Rt=Math.max($,it,st),Pt=Math.max(at,ht,ft);let Lt=b.next;for(;Lt!==s;){if(Lt.x>=xt&&Lt.x<=Rt&&Lt.y>=Et&&Lt.y<=Pt&&u1($,at,it,ht,st,ft,Lt.x,Lt.y)&&du(Lt.prev,Lt,Lt.next)>=0)return!1;Lt=Lt.next}return!0}function mP(g,s,a,b){const $=g.prev,it=g,st=g.next;if(du($,it,st)>=0)return!1;const at=$.x,ht=it.x,ft=st.x,xt=$.y,Et=it.y,Rt=st.y,Pt=Math.min(at,ht,ft),Lt=Math.min(xt,Et,Rt),Gt=Math.max(at,ht,ft),Kt=Math.max(xt,Et,Rt),Xt=L2(Pt,Lt,s,a,b),nr=L2(Gt,Kt,s,a,b);let lr=g.prevZ,hr=g.nextZ;for(;lr&&lr.z>=Xt&&hr&&hr.z<=nr;){if(lr.x>=Pt&&lr.x<=Gt&&lr.y>=Lt&&lr.y<=Kt&&lr!==$&&lr!==st&&u1(at,xt,ht,Et,ft,Rt,lr.x,lr.y)&&du(lr.prev,lr,lr.next)>=0||(lr=lr.prevZ,hr.x>=Pt&&hr.x<=Gt&&hr.y>=Lt&&hr.y<=Kt&&hr!==$&&hr!==st&&u1(at,xt,ht,Et,ft,Rt,hr.x,hr.y)&&du(hr.prev,hr,hr.next)>=0))return!1;hr=hr.nextZ}for(;lr&&lr.z>=Xt;){if(lr.x>=Pt&&lr.x<=Gt&&lr.y>=Lt&&lr.y<=Kt&&lr!==$&&lr!==st&&u1(at,xt,ht,Et,ft,Rt,lr.x,lr.y)&&du(lr.prev,lr,lr.next)>=0)return!1;lr=lr.prevZ}for(;hr&&hr.z<=nr;){if(hr.x>=Pt&&hr.x<=Gt&&hr.y>=Lt&&hr.y<=Kt&&hr!==$&&hr!==st&&u1(at,xt,ht,Et,ft,Rt,hr.x,hr.y)&&du(hr.prev,hr,hr.next)>=0)return!1;hr=hr.nextZ}return!0}function gP(g,s){let a=g;do{const b=a.prev,$=a.next.next;!C_(b,$)&&xT(b,a,a.next,$)&&h1(b,$)&&h1($,b)&&(s.push(b.i,a.i,$.i),d1(a),d1(a.next),a=g=$),a=a.next}while(a!==g);return qy(a)}function xP(g,s,a,b,$,it){let st=g;do{let at=st.next.next;for(;at!==st.prev;){if(st.i!==at.i&&wP(st,at)){let ht=yT(st,at);return st=qy(st,st.next),ht=qy(ht,ht.next),c1(st,s,a,b,$,it,0),void c1(ht,s,a,b,$,it,0)}at=at.next}st=st.next}while(st!==g)}function yP(g,s){let a=g.x-s.x;return a===0&&(a=g.y-s.y,a===0)&&(a=(g.next.y-g.y)/(g.next.x-g.x)-(s.next.y-s.y)/(s.next.x-s.x)),a}function _P(g,s){const a=function($,it){let st=it;const at=$.x,ht=$.y;let ft,xt=-1/0;if(C_($,st))return st;do{if(C_($,st.next))return st.next;if(ht<=st.y&&ht>=st.next.y&&st.next.y!==st.y){const Gt=st.x+(ht-st.y)*(st.next.x-st.x)/(st.next.y-st.y);if(Gt<=at&&Gt>xt&&(xt=Gt,ft=st.x<st.next.x?st:st.next,Gt===at))return ft}st=st.next}while(st!==it);if(!ft)return null;const Et=ft,Rt=ft.x,Pt=ft.y;let Lt=1/0;st=ft;do{if(at>=st.x&&st.x>=Rt&&at!==st.x&&gT(ht<Pt?at:xt,ht,Rt,Pt,ht<Pt?xt:at,ht,st.x,st.y)){const Gt=Math.abs(ht-st.y)/(at-st.x);h1(st,$)&&(Gt<Lt||Gt===Lt&&(st.x>ft.x||st.x===ft.x&&vP(ft,st)))&&(ft=st,Lt=Gt)}st=st.next}while(st!==Et);return ft}(g,s);if(!a)return s;const b=yT(a,g);return qy(b,b.next),qy(a,a.next)}function vP(g,s){return du(g.prev,g,s.prev)<0&&du(s.next,g,g.next)<0}function L2(g,s,a,b,$){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-a)*$|0)|g<<8))|g<<4))|g<<2))|g<<1))|(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-b)*$|0)|s<<8))|s<<4))|s<<2))|s<<1))<<1}function bP(g){let s=g,a=g;do(s.x<a.x||s.x===a.x&&s.y<a.y)&&(a=s),s=s.next;while(s!==g);return a}function gT(g,s,a,b,$,it,st,at){return($-st)*(s-at)>=(g-st)*(it-at)&&(g-st)*(b-at)>=(a-st)*(s-at)&&(a-st)*(it-at)>=($-st)*(b-at)}function u1(g,s,a,b,$,it,st,at){return!(g===st&&s===at)&&gT(g,s,a,b,$,it,st,at)}function wP(g,s){return g.next.i!==s.i&&g.prev.i!==s.i&&!function(a,b){let $=a;do{if($.i!==a.i&&$.next.i!==a.i&&$.i!==b.i&&$.next.i!==b.i&&xT($,$.next,a,b))return!0;$=$.next}while($!==a);return!1}(g,s)&&(h1(g,s)&&h1(s,g)&&function(a,b){let $=a,it=!1;const st=(a.x+b.x)/2,at=(a.y+b.y)/2;do $.y>at!=$.next.y>at&&$.next.y!==$.y&&st<($.next.x-$.x)*(at-$.y)/($.next.y-$.y)+$.x&&(it=!it),$=$.next;while($!==a);return it}(g,s)&&(du(g.prev,g,s.prev)||du(g,s.prev,s))||C_(g,s)&&du(g.prev,g,g.next)>0&&du(s.prev,s,s.next)>0)}function du(g,s,a){return(s.y-g.y)*(a.x-s.x)-(s.x-g.x)*(a.y-s.y)}function C_(g,s){return g.x===s.x&&g.y===s.y}function xT(g,s,a,b){const $=oE(du(g,s,a)),it=oE(du(g,s,b)),st=oE(du(a,b,g)),at=oE(du(a,b,s));return $!==it&&st!==at||!($!==0||!nE(g,a,s))||!(it!==0||!nE(g,b,s))||!(st!==0||!nE(a,g,b))||!(at!==0||!nE(a,s,b))}function nE(g,s,a){return s.x<=Math.max(g.x,a.x)&&s.x>=Math.min(g.x,a.x)&&s.y<=Math.max(g.y,a.y)&&s.y>=Math.min(g.y,a.y)}function oE(g){return g>0?1:g<0?-1:0}function h1(g,s){return du(g.prev,g,g.next)<0?du(g,s,g.next)>=0&&du(g,g.prev,s)>=0:du(g,s,g.prev)<0||du(g,g.next,s)<0}function yT(g,s){const a=D2(g.i,g.x,g.y),b=D2(s.i,s.x,s.y),$=g.next,it=s.prev;return g.next=s,s.prev=g,a.next=$,$.prev=a,b.next=a,a.prev=b,it.next=b,b.prev=it,b}function _T(g,s,a,b){const $=D2(g,s,a);return b?($.next=b.next,$.prev=b,b.next.prev=$,b.next=$):($.prev=$,$.next=$),$}function d1(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function D2(g,s,a){return{i:g,x:s,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function f1(g,s){const a=g.length;if(a<=1)return[g];const b=[];let $,it;for(let st=0;st<a;st++){const at=An(g[st]);at!==0&&(g[st].area=Math.abs(at),it===void 0&&(it=at<0),it===at<0?($&&b.push($),$=[g[st]]):$.push(g[st]))}if($&&b.push($),s>1)for(let st=0;st<b.length;st++)b[st].length<=s||(S0(b[st],s,1,b[st].length-1,EP),b[st]=b[st].slice(0,s));return b}function EP(g,s){return s.area-g.area}function vT(g,s,a=1){if(!g)return null;const b=typeof g=="string"?Iu.from(g).getPrimary():g.getPrimary(),$=typeof g=="string"?null:g.getSecondary();for(const it of[b,$]){if(!it)continue;const st=it.id.toString();s.has(st)||s.set(st,[]),it.scaleSelf(a),s.get(st).push(it)}return{primary:b.toString(),secondary:$?$.toString():null}}function N2(g,s,a,b){const $=b.patternDependencies;let it=!1;for(const st of s){const at=st.paint.get(`${g}-pattern`);at.isConstant()||(it=!0),vT(at.constantOr(null),$,a)&&(it=!0)}return it}function z2(g,s,a,b,$,it){const st=it.patternDependencies;for(const at of s){const ht=at.paint.get(`${g}-pattern`).value;if(ht.kind!=="constant"){let ft=ht.evaluate({zoom:b},a,{},it.availableImages);ft=ft&&ft.name?ft.name:ft;const xt=vT(ft,st,$);if(!xt)continue;const{primary:Et,secondary:Rt}=xt;Et&&(a.patterns[at.id]=[Et,Rt].filter(Boolean))}}return a}class bT{constructor(){this.polygons=new Map}add(s,...a){const b=this.polygons.get(s);b?b.push(...a):this.polygons.set(s,a)}merge(s){for(const[a,b]of s.polygons)this.add(a,...b)}}class mx{constructor(){this.portals=[]}static isOnBorder(s,a){return s<=0&&a<=0||s>=Ps&&a>=Ps}static evaluate(s){if(s.length===0)return new mx;let a=[];for(const ht of s)a.push(...ht.portals);if(a.length===0)return new mx;for(const ht of a){const ft=ht.va,xt=ht.vb;(mx.isOnBorder(ft.x,xt.x)||mx.isOnBorder(ft.y,xt.y))&&(ht.type="border")}const b=a.filter(ht=>ht.type!=="unevaluated"),$=a.filter(ht=>ht.type==="unevaluated");if($.length===0)return new mx;$.sort((ht,ft)=>ht.hash===ft.hash?ht.isTunnel===ft.isTunnel?0:ht.isTunnel?-1:1:ht.hash<ft.hash?1:-1),a=b.concat($);let it=b.length,st=it,at=it;do if(st++,st===a.length||a[it].hash!==a[st].hash){if(st-it==2){at<it&&(a[at]=a[it],a[it]=null);const ht=a[at],ft=a[st-1];ht.type=ht.isTunnel!==ft.isTunnel?"tunnel":"polygon",ht.connection={a:ht.connection.a,b:ft.connection.a},at++}it=st}while(it!==a.length);return a.splice(at),a.sort((ht,ft)=>ht.hash<ft.hash?1:-1),{portals:a}}}Xs(mx,"ElevationPortalGraph"),Xs(bT,"ElevationPolygons");class SP{constructor(s,a,b){this.outPositions=s,this.outNormals=a,this.outIndices=b,this.vertexLookup=new Map}addVertex(s,a,b){let $=s[2];b!=null&&($*=b);const it=`${s[0]},${s[1]},${s[2]},${a[0]},${a[1]},${a[2]}`,st=this.vertexLookup.get(it);if(st!=null)return st;const at=this.outPositions.length;this.vertexLookup.set(it,at);const ht=Math.trunc(16384*a[0]),ft=Math.trunc(16384*a[1]),xt=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(s[0],s[1],$),this.outNormals.emplaceBack(ht,ft,xt),at}addTriangle(s,a,b){this.outIndices.emplaceBack(s,a,b)}addTriangles(s,a,b){if(s.length===0)return;const $=b.length===1,it=ms(),st=ms();for(let at=0;at<s.length;at+=3){const ht=a[s[at+0]],ft=a[s[at+1]],xt=a[s[at+2]],Et=$?b[0]:b[s[at+1]],Rt=$?b[0]:b[s[at+2]];jr(it,ht.x,ht.y,$?b[0]:b[s[at+0]]);const Pt=this.addVertex(it,st);jr(it,ft.x,ft.y,Et);const Lt=this.addVertex(it,st);jr(it,xt.x,xt.y,Rt);const Gt=this.addVertex(it,st);this.outIndices.emplaceBack(Pt,Lt,Gt)}}addQuad(s,a,b,$,it,st){const at=this.addVertex(s,it,st),ht=this.addVertex(a,it,st),ft=this.addVertex(b,it,st),xt=this.addVertex($,it,st);this.addTriangle(at,ht,ft),this.addTriangle(ft,xt,at)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class sp{constructor(s,a,b,$){this.unevaluatedPortals=new mx,this.portalPolygons=new bT,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Vv,this.vertexNormals=new Uv,this.indexArray=new Zl,this.tileToMeters=ir(s),this.bridgeProgramConfigurations=new jp(a,{zoom:b,lut:$},it=>it!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new jp(a,{zoom:b,lut:$},it=>it!=="fill-bridge-guard-rail-color")}addVertices(s,a){const b=this.unevalVertices.length;for(let $=0;$<s.length;$++)this.unevalVertices.push(s[$]),this.unevalHeights.push(a[$]);return b}addTriangles(s,a,b){const $=b?this.unevalTunnelTriangles:this.unevalTriangles;for(const it of s)$.push(it+a)}addRenderableRing(s,a,b,$,it,st){const at=[new ps(it.min.x,it.min.y),new ps(it.max.x,it.min.y),new ps(it.max.x,it.max.y),new ps(it.min.x,it.max.y)];for(let ht=0;ht<b-1;ht++){const ft=a+ht,xt=ft+1,Et=this.unevalVertices[ft],Rt=this.unevalVertices[xt];if(!(Et.x>=it.min.x&&Et.x<=it.max.x&&Et.y>=it.min.y&&Et.y<=it.max.y||Rt.x>=it.min.x&&Rt.x<=it.max.x&&Rt.y>=it.min.y&&Rt.y<=it.max.y||yu(Et,Rt,at))||this.isOnBorder(Et.x,Rt.x)||this.isOnBorder(Et.y,Rt.y))continue;const Pt=sp.computeEdgeHash(this.unevalVertices[ft],this.unevalVertices[xt]);let Lt,Gt=this.vertexHashLookup.get(sp.computePosHash(Et));Gt!=null?Lt=Gt.next:(Gt=this.vertexHashLookup.get(sp.computePosHash(Rt)),Lt=Gt!=null?Gt.prev:Pt),this.unevalEdges.push({polygonIdx:s,a:ft,b:xt,hash:Pt,portalHash:Lt,isTunnel:$,type:"unevaluated",featureInfo:st})}}addPortalCandidates(s,a,b,$,it){if(a.length===0)return;this.portalPolygons.add(s,{geometry:a,zLevel:it});const st=a[0];this.vertexHashLookup.clear();let at=sp.computeEdgeHash(st[st.length-2],st[st.length-1]);for(let ht=0;ht<st.length-1;ht++){const ft=st[ht+0],xt=st[ht+1],Et=Gl(xt.x-ft.x,xt.y-ft.y),Rt=Il(Et);if(Rt===0)continue;let Pt="unevaluated";const Lt=$.pointElevation(ft),Gt=$.pointElevation(xt);Math.abs(Lt)<.01&&Math.abs(Gt)<.01?Pt="entrance":(this.isOnBorder(ft.x,xt.x)||this.isOnBorder(ft.y,xt.y))&&(Pt="border");const Kt=sp.computeEdgeHash(ft,xt);this.unevaluatedPortals.portals.push({connection:{a:s,b:void 0},va:ft,vb:xt,vab:Et,length:Rt,hash:Kt,isTunnel:b,type:Pt});const Xt=sp.computePosHash(ft);this.vertexHashLookup.set(Xt,{prev:at,next:Kt}),at=Kt}}construct(s){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),b=Rt=>{Rt.primitiveLength=this.indexArray.length-Rt.primitiveOffset},$=new SP(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(s.portals,this.unevalEdges);const it=a(),st=a(),at=a(),ht=(Rt,Pt)=>{Rt.sort((Gt,Kt)=>Gt.type===Pt&&Kt.type!==Pt?-1:Gt.type!==Pt&&Kt.type===Pt?1:0);const Lt=Rt.findIndex(Gt=>Gt.type!==Pt);return Lt>=0?Lt:Rt.length};let ft=0;this.unevalEdges.length>0&&(ft=ht(this.unevalEdges,"none"),this.constructBridgeStructures($,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:ft},this.tileToMeters)),b(at);const xt=a(),Et=a();if(this.unevalEdges.length>0){const Rt=this.unevalEdges.splice(ft),Pt=ht(Rt,"tunnel")+ft;this.unevalEdges.push(...Rt),this.constructTunnelStructures($,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:ft},{min:ft,max:Pt})}b(xt),$.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),b(Et),$.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),b(st),$.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),b(it),this.maskSegments=ga.simpleSegment(0,Et.primitiveOffset,0,Et.primitiveLength),this.depthSegments=ga.simpleSegment(0,st.primitiveOffset,0,st.primitiveLength),this.renderableBridgeSegments=ga.simpleSegment(0,at.primitiveOffset,0,at.primitiveLength),this.renderableTunnelSegments=ga.simpleSegment(0,xt.primitiveOffset,0,xt.primitiveLength),this.shadowCasterSegments=ga.simpleSegment(0,it.primitiveOffset,0,it.primitiveLength)}update(s,a,b,$,it,st,at,ht){this.bridgeProgramConfigurations.updatePaintArrays(s,a,it,b,$,st,at,ht),this.tunnelProgramConfigurations.updatePaintArrays(s,a,it,b,$,st,at,ht)}upload(s){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=s.createVertexBuffer(this.vertexPositions,dP.members),this.vertexBufferNormal=s.createVertexBuffer(this.vertexNormals,fP.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(s),this.tunnelProgramConfigurations.upload(s))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(s,a,b,$,it){const st=(at,ht)=>{for(let ft=0;ft<ht.length-1;ft++){const xt=ht[ft].featureIndex,Et=ht[ft+1].vertexStart,Rt=s.feature(xt);at.populatePaintArrays(Et,Rt,xt,{},b,a,$,void 0,it)}};st(this.bridgeProgramConfigurations,this.bridgeFeatureSections),st(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(s,a,b,$,it){const st=new Map;for(let at=$;at<it;at++){const ht=b[at],ft=ht.a,xt=ht.b,Et=sp.computePosHash(s[ft]),Rt=sp.computePosHash(s[xt]);let Pt=st.get(Et);Pt||(Pt={},st.set(Et,Pt));let Lt=st.get(Rt);Lt||(Lt={},st.set(Rt,Lt)),a[ft]<=0&&a[xt]<=0||(Pt.to=xt,Lt.from=ft)}return st}isTerminalVertex(s,a){const b=sp.computePosHash(this.unevalVertices[s]),$=a.get(b);return!$||!$.from||!$.to}constructBridgeStructures(s,a,b,$,it,st){s.clearVertexLookup();const at=this.computeVertexConnections(a,b,$,it.min,it.max),ht=1/st,ft=.5*ht,xt=(vs,ws)=>jr(vs,a[ws].x,a[ws].y,b[ws]*ht),Et=ms(),Rt=ms(),Pt=ms(),Lt=ms(),Gt=ms(),Kt=(vs,ws)=>{const xs=at.get(sp.computePosHash(a[ws])),ys=xs.from,os=xs.to;if(!ys||!os)return;xt(Et,ys),xt(Rt,ws),xt(Pt,os),cn(Lt),Bn(Et,Rt)||(Pn(Gt,Rt,Et),Cn(Lt,Gt)),Bn(Pt,Rt)||(Pn(Gt,Pt,Rt),rr(Lt,Lt,Cn(Gt,Gt)));const ss=Ho(Lt);return ss>0?us(vs,Lt,1/ss):void 0};let Xt=Number.POSITIVE_INFINITY;this.sortSubarray($,it.min,it.max,(vs,ws)=>vs.featureInfo.featureIndex-ws.featureInfo.featureIndex);const nr=ms(),lr=ms(),hr=ms(),Er=ms(),_r=ms(),Rr=ms(),kr=ms(),Lr=ms(),is=ms(),Br=[ms(),ms(),ms(),ms()],as=[ms(),ms(),ms(),ms()],ds=[{coord:new ps(0,0),height:0},{coord:new ps(0,0),height:0}],fs=(vs,ws)=>vs>ws;for(let vs=it.min;vs<it.max;vs++){const ws=$[vs];if(!ws.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ds,a,b,ws,fs))continue;const[xs,ys]=ds;if(jr(nr,xs.coord.x,xs.coord.y,ht*xs.height),jr(lr,ys.coord.x,ys.coord.y,ht*ys.height),Bn(nr,lr))continue;Pn(hr,lr,nr),Cn(hr,hr);const os=Kt(Lr,ws.a)||hr,ss=Kt(is,ws.b)||hr;jr(Er,os[1],-os[0],0),Cn(Er,Er),jr(_r,ss[1],-ss[0],0),Cn(_r,_r),qr(Lr,Er,os),Cn(Rr,Lr),qr(Lr,_r,ss),Cn(kr,Lr),rr(Br[0],nr,us(Lr,Pn(Lr,Er,Rr),ft)),rr(Br[1],nr,us(Lr,rr(Lr,Er,Rr),ft)),rr(Br[2],nr,us(Lr,Rr,ft)),Br[3]=nr,rr(as[0],lr,us(Lr,Pn(Lr,_r,kr),ft)),rr(as[1],lr,us(Lr,rr(Lr,_r,kr),ft)),rr(as[2],lr,us(Lr,kr,ft)),as[3]=lr,Xt=this.addFeatureSection(ws.featureInfo.featureIndex,Xt,this.bridgeFeatureSections,s);const _s=s.addVertex(Br[0],Er,st),Is=s.addVertex(Br[1],Er,st),Rs=s.addVertex(as[0],_r,st),rn=s.addVertex(as[1],_r,st);s.addTriangle(_s,Is,Rs),s.addTriangle(Is,rn,Rs);const zs=s.addVertex(Br[1],Rr,st),Hs=s.addVertex(Br[2],Rr,st),Ys=s.addVertex(as[1],kr,st),zn=s.addVertex(as[2],kr,st);s.addTriangle(zs,Hs,Ys),s.addTriangle(Hs,zn,Ys),zo(Er,Er),zo(_r,_r);const Cs=s.addVertex(Br[2],Er,st),Qs=s.addVertex(Br[3],Er,st),vn=s.addVertex(as[2],_r,st),Wn=s.addVertex(as[3],_r,st);s.addTriangle(Cs,Qs,vn),s.addTriangle(Qs,Wn,vn);const Xn=this.isTerminalVertex(ws.a,at),Rn=this.isTerminalVertex(ws.b,at);xs.height<.01&&Xn&&s.addQuad(Br[3],Br[2],Br[1],Br[0],zo(os,os),st),ys.height<.01&&Rn&&s.addQuad(as[0],as[1],as[2],as[3],ss,st)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}constructTunnelStructures(s,a,b,$,it,st){s.clearVertexLookup();let at=Number.POSITIVE_INFINITY;const ht=(Xt,nr)=>Xt.featureInfo.featureIndex-nr.featureInfo.featureIndex;this.sortSubarray($,it.min,it.max,ht),this.sortSubarray($,st.min,st.max,ht);const ft=Xt=>Cn(Xt,Xt),xt=[{coord:new ps(0,0),height:0},{coord:new ps(0,0),height:0}],Et=(Xt,nr)=>Xt<nr,Rt=ms(),Pt=ms(),Lt=ms(),Gt=ms(),Kt=ms();for(let Xt=it.min;Xt<it.max;Xt++){if(!this.prepareEdgePoints(xt,a,b,$[Xt],Et))continue;const[nr,lr]=xt,hr=ft(jr(Kt,-(lr.coord.y-nr.coord.y),lr.coord.x-nr.coord.x,0));at=this.addFeatureSection($[Xt].featureInfo.featureIndex,at,this.tunnelFeatureSections,s),s.addQuad(jr(Rt,nr.coord.x,nr.coord.y,nr.height),jr(Pt,lr.coord.x,lr.coord.y,lr.height),jr(Lt,lr.coord.x,lr.coord.y,$[Xt].isTunnel?-.1:0),jr(Gt,nr.coord.x,nr.coord.y,$[Xt].isTunnel?-.1:0),hr)}for(let Xt=st.min;Xt<st.max;Xt++){const nr=$[Xt];nr.isTunnel&&([nr.a,nr.b]=[nr.b,nr.a]);const lr=a[nr.a],hr=a[nr.b],Er=ft(jr(Kt,-(hr.y-lr.y),hr.x-lr.x,0));at=this.addFeatureSection(nr.featureInfo.featureIndex,at,this.tunnelFeatureSections,s),s.addQuad(jr(Rt,hr.x,hr.y,0),jr(Pt,lr.x,lr.y,0),jr(Lt,lr.x,lr.y,b[nr.a]+4),jr(Gt,hr.x,hr.y,b[nr.b]+4),Er),s.addQuad(jr(Rt,lr.x,lr.y,0),jr(Pt,hr.x,hr.y,0),jr(Lt,hr.x,hr.y,b[nr.b]+4),jr(Gt,lr.x,lr.y,b[nr.a]+4),Er)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:s.getVertexCount()})}setElevatedPoint(s,a,b,$){s.coord.x=a,s.coord.y=b,s.height=$}prepareEdgePoints(s,a,b,$,it){let st=a[$.a].x,at=a[$.a].y,ht=a[$.b].x,ft=a[$.b].y,xt=b[$.a],Et=b[$.b];const Rt=it(xt,0),Pt=it(Et,0);if(Rt&&Pt)return this.setElevatedPoint(s[0],st,at,xt),this.setElevatedPoint(s[1],ht,ft,Et),!0;if(!Rt&&!Pt)return!1;if(Rt){if(!Pt){const Lt=Et/(Et-xt);ht=pn(ht,st,Lt),ft=pn(ft,at,Lt),Et=pn(Et,xt,Lt)}}else{const Lt=xt/(xt-Et);st=pn(st,ht,Lt),at=pn(at,ft,Lt),xt=pn(xt,Et,Lt)}return this.setElevatedPoint(s[0],st,at,xt),this.setElevatedPoint(s[1],ht,ft,Et),!0}prepareEdges(s,a){if(a.length===0)return;a.sort((at,ht)=>at.hash===ht.hash?ht.polygonIdx-at.polygonIdx:ht.hash>at.hash?1:-1);let b=0,$=0,it=0,st=a[b].polygonIdx;do $++,($===a.length||a[b].hash!==a[$].hash)&&(($-b==1||a[$-1].polygonIdx!==st)&&(it<b&&(a[it]=a[b],a[b]=null),a[it].type="none",it++),b=$,b!==a.length&&(st=a[b].polygonIdx));while(b!==a.length);if(a.splice(it),a.length!==0&&s.length!==0){a.sort((ft,xt)=>ft.portalHash<xt.portalHash?1:-1);let at=0,ht=0;for(;at!==a.length&&ht!==s.length;){const ft=a[at],xt=s[ht];ft.portalHash>xt.hash?at++:xt.hash>ft.portalHash?ht++:(ft.type=xt.type,at++)}}}isOnBorder(s,a){return s<=0&&a<=0||s>=Ps&&a>=Ps}addFeatureSection(s,a,b,$){return s!==a&&(a=s,b.push({featureIndex:s,vertexStart:$.getVertexCount()}),$.clearVertexLookup()),a}sortSubarray(s,a,b,$){const it=s.slice(a,b);it.sort($),s.splice(a,it.length,...it)}static computeEdgeHash(s,a){return(s.y===a.y&&s.x>a.x||s.y>a.y)&&([s,a]=[a,s]),BigInt(sp.computePosHash(s))<<32n|BigInt(sp.computePosHash(a))}static computePosHash(s){return((65535&s.x)<<16|65535&s.y)>>>0}}var wT,ET={exports:{}},ST=(wT||(wT=1,function(g){function s(vr,Sr){return vr>Sr?1:vr<Sr?-1:0}var a=function(vr,Sr){vr===void 0&&(vr=s),Sr===void 0&&(Sr=!1),this._compare=vr,this._root=null,this._size=0,this._noDuplicates=!!Sr},b={size:{configurable:!0}};function $(vr,Sr,ls,bs,Ls){var Ds=Ls-bs;if(Ds>0){var sn=bs+Math.floor(Ds/2),on={key:Sr[sn],data:ls[sn],parent:vr};return on.left=$(on,Sr,ls,bs,sn),on.right=$(on,Sr,ls,sn+1,Ls),on}return null}function it(vr,Sr,ls,bs,Ls){if(!(ls>=bs)){for(var Ds=vr[ls+bs>>1],sn=ls-1,on=bs+1;;){do sn++;while(Ls(vr[sn],Ds)<0);do on--;while(Ls(vr[on],Ds)>0);if(sn>=on)break;var Sn=vr[sn];vr[sn]=vr[on],vr[on]=Sn,Sn=Sr[sn],Sr[sn]=Sr[on],Sr[on]=Sn}it(vr,Sr,ls,on,Ls),it(vr,Sr,on+1,bs,Ls)}}a.prototype.rotateLeft=function(vr){var Sr=vr.right;Sr&&(vr.right=Sr.left,Sr.left&&(Sr.left.parent=vr),Sr.parent=vr.parent),vr.parent?vr===vr.parent.left?vr.parent.left=Sr:vr.parent.right=Sr:this._root=Sr,Sr&&(Sr.left=vr),vr.parent=Sr},a.prototype.rotateRight=function(vr){var Sr=vr.left;Sr&&(vr.left=Sr.right,Sr.right&&(Sr.right.parent=vr),Sr.parent=vr.parent),vr.parent?vr===vr.parent.left?vr.parent.left=Sr:vr.parent.right=Sr:this._root=Sr,Sr&&(Sr.right=vr),vr.parent=Sr},a.prototype._splay=function(vr){for(;vr.parent;){var Sr=vr.parent;Sr.parent?Sr.left===vr&&Sr.parent.left===Sr?(this.rotateRight(Sr.parent),this.rotateRight(Sr)):Sr.right===vr&&Sr.parent.right===Sr?(this.rotateLeft(Sr.parent),this.rotateLeft(Sr)):Sr.left===vr&&Sr.parent.right===Sr?(this.rotateRight(Sr),this.rotateLeft(Sr)):(this.rotateLeft(Sr),this.rotateRight(Sr)):Sr.left===vr?this.rotateRight(Sr):this.rotateLeft(Sr)}},a.prototype.splay=function(vr){for(var Sr,ls,bs,Ls,Ds;vr.parent;)(ls=(Sr=vr.parent).parent)&&ls.parent?((bs=ls.parent).left===ls?bs.left=vr:bs.right=vr,vr.parent=bs):(vr.parent=null,this._root=vr),Ls=vr.left,Ds=vr.right,vr===Sr.left?(ls&&(ls.left===Sr?(Sr.right?(ls.left=Sr.right,ls.left.parent=ls):ls.left=null,Sr.right=ls,ls.parent=Sr):(Ls?(ls.right=Ls,Ls.parent=ls):ls.right=null,vr.left=ls,ls.parent=vr)),Ds?(Sr.left=Ds,Ds.parent=Sr):Sr.left=null,vr.right=Sr,Sr.parent=vr):(ls&&(ls.right===Sr?(Sr.left?(ls.right=Sr.left,ls.right.parent=ls):ls.right=null,Sr.left=ls,ls.parent=Sr):(Ds?(ls.left=Ds,Ds.parent=ls):ls.left=null,vr.right=ls,ls.parent=vr)),Ls?(Sr.right=Ls,Ls.parent=Sr):Sr.right=null,vr.left=Sr,Sr.parent=vr)},a.prototype.replace=function(vr,Sr){vr.parent?vr===vr.parent.left?vr.parent.left=Sr:vr.parent.right=Sr:this._root=Sr,Sr&&(Sr.parent=vr.parent)},a.prototype.minNode=function(vr){if(vr===void 0&&(vr=this._root),vr)for(;vr.left;)vr=vr.left;return vr},a.prototype.maxNode=function(vr){if(vr===void 0&&(vr=this._root),vr)for(;vr.right;)vr=vr.right;return vr},a.prototype.insert=function(vr,Sr){var ls=this._root,bs=null,Ls=this._compare;if(this._noDuplicates)for(;ls;){if(bs=ls,Ls(ls.key,vr)===0)return;ls=Ls(ls.key,vr)<0?ls.right:ls.left}else for(;ls;)bs=ls,ls=Ls(ls.key,vr)<0?ls.right:ls.left;return ls={key:vr,data:Sr,left:null,right:null,parent:bs},bs?Ls(bs.key,ls.key)<0?bs.right=ls:bs.left=ls:this._root=ls,this.splay(ls),this._size++,ls},a.prototype.find=function(vr){for(var Sr=this._root,ls=this._compare;Sr;){var bs=ls(Sr.key,vr);if(bs<0)Sr=Sr.right;else{if(!(bs>0))return Sr;Sr=Sr.left}}return null},a.prototype.contains=function(vr){for(var Sr=this._root,ls=this._compare;Sr;){var bs=ls(vr,Sr.key);if(bs===0)return!0;Sr=bs<0?Sr.left:Sr.right}return!1},a.prototype.remove=function(vr){var Sr=this.find(vr);if(!Sr)return!1;if(this.splay(Sr),Sr.left)if(Sr.right){var ls=this.minNode(Sr.right);ls.parent!==Sr&&(this.replace(ls,ls.right),ls.right=Sr.right,ls.right.parent=ls),this.replace(Sr,ls),ls.left=Sr.left,ls.left.parent=ls}else this.replace(Sr,Sr.left);else this.replace(Sr,Sr.right);return this._size--,!0},a.prototype.removeNode=function(vr){if(!vr)return!1;if(this.splay(vr),vr.left)if(vr.right){var Sr=this.minNode(vr.right);Sr.parent!==vr&&(this.replace(Sr,Sr.right),Sr.right=vr.right,Sr.right.parent=Sr),this.replace(vr,Sr),Sr.left=vr.left,Sr.left.parent=Sr}else this.replace(vr,vr.left);else this.replace(vr,vr.right);return this._size--,!0},a.prototype.erase=function(vr){var Sr=this.find(vr);if(Sr){this.splay(Sr);var ls=Sr.left,bs=Sr.right,Ls=null;ls&&(ls.parent=null,Ls=this.maxNode(ls),this.splay(Ls),this._root=Ls),bs&&(ls?Ls.right=bs:this._root=bs,bs.parent=Ls),this._size--}},a.prototype.pop=function(){var vr=this._root,Sr=null;if(vr){for(;vr.left;)vr=vr.left;Sr={key:vr.key,data:vr.data},this.remove(vr.key)}return Sr},a.prototype.next=function(vr){var Sr=vr;if(Sr)if(Sr.right)for(Sr=Sr.right;Sr&&Sr.left;)Sr=Sr.left;else for(Sr=vr.parent;Sr&&Sr.right===vr;)vr=Sr,Sr=Sr.parent;return Sr},a.prototype.prev=function(vr){var Sr=vr;if(Sr)if(Sr.left)for(Sr=Sr.left;Sr&&Sr.right;)Sr=Sr.right;else for(Sr=vr.parent;Sr&&Sr.left===vr;)vr=Sr,Sr=Sr.parent;return Sr},a.prototype.forEach=function(vr){for(var Sr=this._root,ls=[],bs=!1,Ls=0;!bs;)Sr?(ls.push(Sr),Sr=Sr.left):ls.length>0?(vr(Sr=ls.pop(),Ls++),Sr=Sr.right):bs=!0;return this},a.prototype.range=function(vr,Sr,ls,bs){for(var Ls=[],Ds=this._compare,sn=this._root;Ls.length!==0||sn;)if(sn)Ls.push(sn),sn=sn.left;else{if(Ds((sn=Ls.pop()).key,Sr)>0)break;if(Ds(sn.key,vr)>=0&&ls.call(bs,sn))return this;sn=sn.right}return this},a.prototype.keys=function(){for(var vr=this._root,Sr=[],ls=[],bs=!1;!bs;)vr?(Sr.push(vr),vr=vr.left):Sr.length>0?(vr=Sr.pop(),ls.push(vr.key),vr=vr.right):bs=!0;return ls},a.prototype.values=function(){for(var vr=this._root,Sr=[],ls=[],bs=!1;!bs;)vr?(Sr.push(vr),vr=vr.left):Sr.length>0?(vr=Sr.pop(),ls.push(vr.data),vr=vr.right):bs=!0;return ls},a.prototype.at=function(vr){for(var Sr=this._root,ls=[],bs=!1,Ls=0;!bs;)if(Sr)ls.push(Sr),Sr=Sr.left;else if(ls.length>0){if(Sr=ls.pop(),Ls===vr)return Sr;Ls++,Sr=Sr.right}else bs=!0;return null},a.prototype.load=function(vr,Sr,ls){if(vr===void 0&&(vr=[]),Sr===void 0&&(Sr=[]),ls===void 0&&(ls=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bs=vr.length;return ls&&it(vr,Sr,0,bs-1,this._compare),this._root=$(null,vr,Sr,0,bs),this._size=bs,this},a.prototype.min=function(){var vr=this.minNode(this._root);return vr?vr.key:null},a.prototype.max=function(){var vr=this.maxNode(this._root);return vr?vr.key:null},a.prototype.isEmpty=function(){return this._root===null},b.size.get=function(){return this._size},a.createTree=function(vr,Sr,ls,bs,Ls){return new a(ls,Ls).load(vr,Sr,bs)},Object.defineProperties(a.prototype,b);var st=0,at=1,ht=2,ft=3,xt=0,Et=1,Rt=2,Pt=3;function Lt(vr,Sr,ls){Sr===null?(vr.inOut=!1,vr.otherInOut=!0):(vr.isSubject===Sr.isSubject?(vr.inOut=!Sr.inOut,vr.otherInOut=Sr.otherInOut):(vr.inOut=!Sr.otherInOut,vr.otherInOut=Sr.isVertical()?!Sr.inOut:Sr.inOut),Sr&&(vr.prevInResult=!Gt(Sr,ls)||Sr.isVertical()?Sr.prevInResult:Sr));var bs=Gt(vr,ls);vr.resultTransition=bs?function(Ls,Ds){var sn,on=!Ls.inOut,Sn=!Ls.otherInOut;switch(Ds){case xt:sn=on&&Sn;break;case Et:sn=on||Sn;break;case Pt:sn=on^Sn;break;case Rt:sn=Ls.isSubject?on&&!Sn:Sn&&!on}return sn?1:-1}(vr,ls):0}function Gt(vr,Sr){switch(vr.type){case st:switch(Sr){case xt:return!vr.otherInOut;case Et:return vr.otherInOut;case Rt:return vr.isSubject&&vr.otherInOut||!vr.isSubject&&!vr.otherInOut;case Pt:return!0}break;case ht:return Sr===xt||Sr===Et;case ft:return Sr===Rt;case at:return!1}return!1}var Kt=function(vr,Sr,ls,bs,Ls){this.left=Sr,this.point=vr,this.otherEvent=ls,this.isSubject=bs,this.type=Ls||st,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},Xt={inResult:{configurable:!0}};function nr(vr,Sr){return vr[0]===Sr[0]&&vr[1]===Sr[1]}Kt.prototype.isBelow=function(vr){var Sr=this.point,ls=this.otherEvent.point;return this.left?(Sr[0]-vr[0])*(ls[1]-vr[1])-(ls[0]-vr[0])*(Sr[1]-vr[1])>0:(ls[0]-vr[0])*(Sr[1]-vr[1])-(Sr[0]-vr[0])*(ls[1]-vr[1])>0},Kt.prototype.isAbove=function(vr){return!this.isBelow(vr)},Kt.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},Xt.inResult.get=function(){return this.resultTransition!==0},Kt.prototype.clone=function(){var vr=new Kt(this.point,this.left,this.otherEvent,this.isSubject,this.type);return vr.contourId=this.contourId,vr.resultTransition=this.resultTransition,vr.prevInResult=this.prevInResult,vr.isExteriorRing=this.isExteriorRing,vr.inOut=this.inOut,vr.otherInOut=this.otherInOut,vr},Object.defineProperties(Kt.prototype,Xt);var lr=11102230246251565e-32,hr=134217729,Er=(3+8*lr)*lr;function _r(vr,Sr,ls,bs,Ls){var Ds,sn,on,Sn,Fn=Sr[0],Dn=bs[0],Un=0,fn=0;Dn>Fn==Dn>-Fn?(Ds=Fn,Fn=Sr[++Un]):(Ds=Dn,Dn=bs[++fn]);var xn=0;if(Un<vr&&fn<ls)for(Dn>Fn==Dn>-Fn?(on=Ds-((sn=Fn+Ds)-Fn),Fn=Sr[++Un]):(on=Ds-((sn=Dn+Ds)-Dn),Dn=bs[++fn]),Ds=sn,on!==0&&(Ls[xn++]=on);Un<vr&&fn<ls;)Dn>Fn==Dn>-Fn?(on=Ds-((sn=Ds+Fn)-(Sn=sn-Ds))+(Fn-Sn),Fn=Sr[++Un]):(on=Ds-((sn=Ds+Dn)-(Sn=sn-Ds))+(Dn-Sn),Dn=bs[++fn]),Ds=sn,on!==0&&(Ls[xn++]=on);for(;Un<vr;)on=Ds-((sn=Ds+Fn)-(Sn=sn-Ds))+(Fn-Sn),Fn=Sr[++Un],Ds=sn,on!==0&&(Ls[xn++]=on);for(;fn<ls;)on=Ds-((sn=Ds+Dn)-(Sn=sn-Ds))+(Dn-Sn),Dn=bs[++fn],Ds=sn,on!==0&&(Ls[xn++]=on);return Ds===0&&xn!==0||(Ls[xn++]=Ds),xn}function Rr(vr){return new Float64Array(vr)}var kr=33306690738754716e-32,Lr=22204460492503146e-32,is=11093356479670487e-47,Br=Rr(4),as=Rr(8),ds=Rr(12),fs=Rr(16),vs=Rr(4);function ws(vr,Sr,ls){var bs=function(Ls,Ds,sn,on,Sn,Fn){var Dn=(Ds-Fn)*(sn-Sn),Un=(Ls-Sn)*(on-Fn),fn=Dn-Un;if(Dn===0||Un===0||Dn>0!=Un>0)return fn;var xn=Math.abs(Dn+Un);return Math.abs(fn)>=kr*xn?fn:-function(ro,lo,co,wo,Fo,Ao,fo){var xo,Ln,qn,na,hn,$n,Po,No,Go,Fl,Oo,dn,ba,Eo,Yo,Yl,nu,Ul,$l=ro-Fo,tu=co-Fo,qu=lo-Ao,Bo=wo-Ao;Br[0]=(Yo=(No=$l-(Po=($n=hr*$l)-($n-$l)))*(Fl=Bo-(Go=($n=hr*Bo)-($n-Bo)))-((Eo=$l*Bo)-Po*Go-No*Go-Po*Fl))-((Oo=Yo-(nu=(No=qu-(Po=($n=hr*qu)-($n-qu)))*(Fl=tu-(Go=($n=hr*tu)-($n-tu)))-((Yl=qu*tu)-Po*Go-No*Go-Po*Fl)))+(hn=Yo-Oo))+(hn-nu),Br[1]=(ba=Eo-((dn=Eo+Oo)-(hn=dn-Eo))+(Oo-hn))-((Oo=ba-Yl)+(hn=ba-Oo))+(hn-Yl),Br[2]=dn-((Ul=dn+Oo)-(hn=Ul-dn))+(Oo-hn),Br[3]=Ul;var Pl=function(Gm,_u){for(var Du=_u[0],ap=1;ap<4;ap++)Du+=_u[ap];return Du}(0,Br),Ll=Lr*fo;if(Pl>=Ll||-Pl>=Ll||(xo=ro-($l+(hn=ro-$l))+(hn-Fo),qn=co-(tu+(hn=co-tu))+(hn-Fo),Ln=lo-(qu+(hn=lo-qu))+(hn-Ao),na=wo-(Bo+(hn=wo-Bo))+(hn-Ao),xo===0&&Ln===0&&qn===0&&na===0)||(Ll=is*fo+Er*Math.abs(Pl),(Pl+=$l*na+Bo*xo-(qu*qn+tu*Ln))>=Ll||-Pl>=Ll))return Pl;vs[0]=(Yo=(No=xo-(Po=($n=hr*xo)-($n-xo)))*(Fl=Bo-(Go=($n=hr*Bo)-($n-Bo)))-((Eo=xo*Bo)-Po*Go-No*Go-Po*Fl))-((Oo=Yo-(nu=(No=Ln-(Po=($n=hr*Ln)-($n-Ln)))*(Fl=tu-(Go=($n=hr*tu)-($n-tu)))-((Yl=Ln*tu)-Po*Go-No*Go-Po*Fl)))+(hn=Yo-Oo))+(hn-nu),vs[1]=(ba=Eo-((dn=Eo+Oo)-(hn=dn-Eo))+(Oo-hn))-((Oo=ba-Yl)+(hn=ba-Oo))+(hn-Yl),vs[2]=dn-((Ul=dn+Oo)-(hn=Ul-dn))+(Oo-hn),vs[3]=Ul;var Yu=_r(4,Br,4,vs,as);vs[0]=(Yo=(No=$l-(Po=($n=hr*$l)-($n-$l)))*(Fl=na-(Go=($n=hr*na)-($n-na)))-((Eo=$l*na)-Po*Go-No*Go-Po*Fl))-((Oo=Yo-(nu=(No=qu-(Po=($n=hr*qu)-($n-qu)))*(Fl=qn-(Go=($n=hr*qn)-($n-qn)))-((Yl=qu*qn)-Po*Go-No*Go-Po*Fl)))+(hn=Yo-Oo))+(hn-nu),vs[1]=(ba=Eo-((dn=Eo+Oo)-(hn=dn-Eo))+(Oo-hn))-((Oo=ba-Yl)+(hn=ba-Oo))+(hn-Yl),vs[2]=dn-((Ul=dn+Oo)-(hn=Ul-dn))+(Oo-hn),vs[3]=Ul;var Ql=_r(Yu,as,4,vs,ds);vs[0]=(Yo=(No=xo-(Po=($n=hr*xo)-($n-xo)))*(Fl=na-(Go=($n=hr*na)-($n-na)))-((Eo=xo*na)-Po*Go-No*Go-Po*Fl))-((Oo=Yo-(nu=(No=Ln-(Po=($n=hr*Ln)-($n-Ln)))*(Fl=qn-(Go=($n=hr*qn)-($n-qn)))-((Yl=Ln*qn)-Po*Go-No*Go-Po*Fl)))+(hn=Yo-Oo))+(hn-nu),vs[1]=(ba=Eo-((dn=Eo+Oo)-(hn=dn-Eo))+(Oo-hn))-((Oo=ba-Yl)+(hn=ba-Oo))+(hn-Yl),vs[2]=dn-((Ul=dn+Oo)-(hn=Ul-dn))+(Oo-hn),vs[3]=Ul;var Zp=_r(Ql,ds,4,vs,fs);return fs[Zp-1]}(Ls,Ds,sn,on,Sn,Fn,xn)}(vr[0],vr[1],Sr[0],Sr[1],ls[0],ls[1]);return bs>0?-1:bs<0?1:0}function xs(vr,Sr){var ls=vr.point,bs=Sr.point;return ls[0]>bs[0]?1:ls[0]<bs[0]?-1:ls[1]!==bs[1]?ls[1]>bs[1]?1:-1:function(Ls,Ds,sn,on){return Ls.left!==Ds.left?Ls.left?1:-1:ws(sn,Ls.otherEvent.point,Ds.otherEvent.point)!==0?Ls.isBelow(Ds.otherEvent.point)?-1:1:!Ls.isSubject&&Ds.isSubject?1:-1}(vr,Sr,ls)}function ys(vr,Sr,ls){var bs=new Kt(Sr,!1,vr,vr.isSubject),Ls=new Kt(Sr,!0,vr.otherEvent,vr.isSubject);return nr(vr.point,vr.otherEvent.point)&&console.warn("what is that, a collapsed segment?",vr),bs.contourId=Ls.contourId=vr.contourId,xs(Ls,vr.otherEvent)>0&&(vr.otherEvent.left=!0,Ls.left=!1),vr.otherEvent.otherEvent=Ls,vr.otherEvent=bs,ls.push(Ls),ls.push(bs),ls}function os(vr,Sr){return vr[0]*Sr[1]-vr[1]*Sr[0]}function ss(vr,Sr){return vr[0]*Sr[0]+vr[1]*Sr[1]}function _s(vr,Sr,ls){var bs=function(Sn,Fn,Dn,Un,fn){var xn=[Fn[0]-Sn[0],Fn[1]-Sn[1]],ro=[Un[0]-Dn[0],Un[1]-Dn[1]];function lo($n,Po,No){return[$n[0]+Po*No[0],$n[1]+Po*No[1]]}var co=[Dn[0]-Sn[0],Dn[1]-Sn[1]],wo=os(xn,ro),Fo=wo*wo,Ao=ss(xn,xn);if(Fo>0){var fo=os(co,ro)/wo;if(fo<0||fo>1)return null;var xo=os(co,xn)/wo;return xo<0||xo>1?null:fo===0||fo===1?[lo(Sn,fo,xn)]:xo===0||xo===1?[lo(Dn,xo,ro)]:[lo(Sn,fo,xn)]}if((Fo=(wo=os(co,xn))*wo)>0)return null;var Ln=ss(xn,co)/Ao,qn=Ln+ss(xn,ro)/Ao,na=Math.min(Ln,qn),hn=Math.max(Ln,qn);return na<=1&&hn>=0?na===1?[lo(Sn,na>0?na:0,xn)]:hn===0?[lo(Sn,hn<1?hn:1,xn)]:[lo(Sn,na>0?na:0,xn),lo(Sn,hn<1?hn:1,xn)]:null}(vr.point,vr.otherEvent.point,Sr.point,Sr.otherEvent.point),Ls=bs?bs.length:0;if(Ls===0||Ls===1&&(nr(vr.point,Sr.point)||nr(vr.otherEvent.point,Sr.otherEvent.point))||Ls===2&&vr.isSubject===Sr.isSubject)return 0;if(Ls===1)return nr(vr.point,bs[0])||nr(vr.otherEvent.point,bs[0])||ys(vr,bs[0],ls),nr(Sr.point,bs[0])||nr(Sr.otherEvent.point,bs[0])||ys(Sr,bs[0],ls),1;var Ds=[],sn=!1,on=!1;return nr(vr.point,Sr.point)?sn=!0:xs(vr,Sr)===1?Ds.push(Sr,vr):Ds.push(vr,Sr),nr(vr.otherEvent.point,Sr.otherEvent.point)?on=!0:xs(vr.otherEvent,Sr.otherEvent)===1?Ds.push(Sr.otherEvent,vr.otherEvent):Ds.push(vr.otherEvent,Sr.otherEvent),sn&&on||sn?(Sr.type=at,vr.type=Sr.inOut===vr.inOut?ht:ft,sn&&!on&&ys(Ds[1].otherEvent,Ds[0].point,ls),2):on?(ys(Ds[0],Ds[1].point,ls),3):Ds[0]!==Ds[3].otherEvent?(ys(Ds[0],Ds[1].point,ls),ys(Ds[1],Ds[2].point,ls),3):(ys(Ds[0],Ds[1].point,ls),ys(Ds[3].otherEvent,Ds[2].point,ls),3)}function Is(vr,Sr){if(vr===Sr)return 0;if(ws(vr.point,vr.otherEvent.point,Sr.point)!==0||ws(vr.point,vr.otherEvent.point,Sr.otherEvent.point)!==0)return nr(vr.point,Sr.point)?vr.isBelow(Sr.otherEvent.point)?-1:1:vr.point[0]===Sr.point[0]?vr.point[1]<Sr.point[1]?-1:1:xs(vr,Sr)===1?Sr.isAbove(vr.point)?-1:1:vr.isBelow(Sr.point)?-1:1;if(vr.isSubject!==Sr.isSubject)return vr.isSubject?-1:1;var ls=vr.point,bs=Sr.point;return ls[0]===bs[0]&&ls[1]===bs[1]?(ls=vr.otherEvent.point)[0]===(bs=Sr.otherEvent.point)[0]&&ls[1]===bs[1]?0:vr.contourId>Sr.contourId?1:-1:xs(vr,Sr)===1?1:-1}var Rs=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function rn(vr,Sr,ls,bs){var Ls,Ds=vr+1,sn=Sr[vr].point,on=Sr.length;for(Ds<on&&(Ls=Sr[Ds].point);Ds<on&&Ls[0]===sn[0]&&Ls[1]===sn[1];){if(!ls[Ds])return Ds;++Ds<on&&(Ls=Sr[Ds].point)}for(Ds=vr-1;ls[Ds]&&Ds>bs;)Ds--;return Ds}Rs.prototype.isExterior=function(){return this.holeOf==null};var zs=Ys,Hs=Ys;function Ys(vr,Sr){if(!(this instanceof Ys))return new Ys(vr,Sr);if(this.data=vr||[],this.length=this.data.length,this.compare=Sr||zn,this.length>0)for(var ls=(this.length>>1)-1;ls>=0;ls--)this._down(ls)}function zn(vr,Sr){return vr<Sr?-1:vr>Sr?1:0}Ys.prototype={push:function(vr){this.data.push(vr),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var vr=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),vr}},peek:function(){return this.data[0]},_up:function(vr){for(var Sr=this.data,ls=this.compare,bs=Sr[vr];vr>0;){var Ls=vr-1>>1,Ds=Sr[Ls];if(ls(bs,Ds)>=0)break;Sr[vr]=Ds,vr=Ls}Sr[vr]=bs},_down:function(vr){for(var Sr=this.data,ls=this.compare,bs=this.length>>1,Ls=Sr[vr];vr<bs;){var Ds=1+(vr<<1),sn=Ds+1,on=Sr[Ds];if(sn<this.length&&ls(Sr[sn],on)<0&&(Ds=sn,on=Sr[sn]),ls(on,Ls)>=0)break;Sr[vr]=on,vr=Ds}Sr[vr]=Ls}},zs.default=Hs;var Cs=Math.max,Qs=Math.min,vn=0;function Wn(vr,Sr,ls,bs,Ls,Ds){var sn,on,Sn,Fn,Dn,Un;for(sn=0,on=vr.length-1;sn<on;sn++)if(Fn=vr[sn+1],Dn=new Kt(Sn=vr[sn],!1,void 0,Sr),Un=new Kt(Fn,!1,Dn,Sr),Dn.otherEvent=Un,Sn[0]!==Fn[0]||Sn[1]!==Fn[1]){Dn.contourId=Un.contourId=ls,Ds||(Dn.isExteriorRing=!1,Un.isExteriorRing=!1),xs(Dn,Un)>0?Un.left=!0:Dn.left=!0;var fn=Sn[0],xn=Sn[1];Ls[0]=Qs(Ls[0],fn),Ls[1]=Qs(Ls[1],xn),Ls[2]=Cs(Ls[2],fn),Ls[3]=Cs(Ls[3],xn),bs.push(Dn),bs.push(Un)}}var Xn=[];function Rn(vr,Sr,ls){typeof vr[0][0][0]=="number"&&(vr=[vr]),typeof Sr[0][0][0]=="number"&&(Sr=[Sr]);var bs=function(xn,ro,lo){var co=null;return xn.length*ro.length==0&&(lo===xt?co=Xn:lo===Rt?co=xn:lo!==Et&&lo!==Pt||(co=xn.length===0?ro:xn)),co}(vr,Sr,ls);if(bs)return bs===Xn?null:bs;var Ls=[1/0,1/0,-1/0,-1/0],Ds=[1/0,1/0,-1/0,-1/0],sn=function(xn,ro,lo,co,wo){var Fo,Ao,fo,xo,Ln,qn,na=new zs(null,xs);for(fo=0,xo=xn.length;fo<xo;fo++)for(Ln=0,qn=(Fo=xn[fo]).length;Ln<qn;Ln++)(Ao=Ln===0)&&vn++,Wn(Fo[Ln],!0,vn,na,lo,Ao);for(fo=0,xo=ro.length;fo<xo;fo++)for(Ln=0,qn=(Fo=ro[fo]).length;Ln<qn;Ln++)Ao=Ln===0,wo===Rt&&(Ao=!1),Ao&&vn++,Wn(Fo[Ln],!1,vn,na,co,Ao);return na}(vr,Sr,Ls,Ds,ls);if(bs=function(xn,ro,lo,co,wo){var Fo=null;return(lo[0]>co[2]||co[0]>lo[2]||lo[1]>co[3]||co[1]>lo[3])&&(wo===xt?Fo=Xn:wo===Rt?Fo=xn:wo!==Et&&wo!==Pt||(Fo=xn.concat(ro))),Fo}(vr,Sr,Ls,Ds,ls))return bs===Xn?null:bs;for(var on=function(xn){var ro,lo,co=function(fo){var xo,Ln,qn,na,hn=[];for(Ln=0,qn=fo.length;Ln<qn;Ln++)((xo=fo[Ln]).left&&xo.inResult||!xo.left&&xo.otherEvent.inResult)&&hn.push(xo);for(var $n=!1;!$n;)for($n=!0,Ln=0,qn=hn.length;Ln<qn;Ln++)Ln+1<qn&&xs(hn[Ln],hn[Ln+1])===1&&(na=hn[Ln],hn[Ln]=hn[Ln+1],hn[Ln+1]=na,$n=!1);for(Ln=0,qn=hn.length;Ln<qn;Ln++)(xo=hn[Ln]).otherPos=Ln;for(Ln=0,qn=hn.length;Ln<qn;Ln++)(xo=hn[Ln]).left||(na=xo.otherPos,xo.otherPos=xo.otherEvent.otherPos,xo.otherEvent.otherPos=na);return hn}(xn),wo={},Fo=[],Ao=function(){if(!wo[ro]){var fo=Fo.length,xo=function(hn,$n,Po){var No=new Rs;if(hn.prevInResult!=null){var Go=hn.prevInResult,Fl=Go.outputContourId;if(Go.resultTransition>0){var Oo=$n[Fl];if(Oo.holeOf!=null){var dn=Oo.holeOf;$n[dn].holeIds.push(Po),No.holeOf=dn,No.depth=$n[Fl].depth}else $n[Fl].holeIds.push(Po),No.holeOf=Fl,No.depth=$n[Fl].depth+1}else No.holeOf=null,No.depth=$n[Fl].depth}else No.holeOf=null,No.depth=0;return No}(co[ro],Fo,fo),Ln=function(hn){wo[hn]=!0,hn<co.length&&co[hn]&&(co[hn].outputContourId=fo)},qn=ro,na=ro;for(xo.points.push(co[ro].point);Ln(qn),Ln(qn=co[qn].otherPos),xo.points.push(co[qn].point),!((qn=rn(qn,co,wo,na))==na||qn>=co.length)&&co[qn];);Fo.push(xo)}};for(ro=0,lo=co.length;ro<lo;ro++)Ao();return Fo}(function(xn,ro,lo,co,wo,Fo){for(var Ao,fo,xo,Ln=new a(Is),qn=[],na=Math.min(co[2],wo[2]);xn.length!==0;){var hn=xn.pop();if(qn.push(hn),Fo===xt&&hn.point[0]>na||Fo===Rt&&hn.point[0]>co[2])break;if(hn.left){fo=Ao=Ln.insert(hn),Ao=Ao!==(xo=Ln.minNode())?Ln.prev(Ao):null,fo=Ln.next(fo);var $n=Ao?Ao.key:null;if(Lt(hn,$n,Fo),fo&&_s(hn,fo.key,xn)===2&&(Lt(hn,$n,Fo),Lt(fo.key,hn,Fo)),Ao&&_s(Ao.key,hn,xn)===2){var Po=Ao;Lt($n,(Po=Po!==xo?Ln.prev(Po):null)?Po.key:null,Fo),Lt(hn,$n,Fo)}}else fo=Ao=Ln.find(hn=hn.otherEvent),Ao&&fo&&(Ao=Ao!==xo?Ln.prev(Ao):null,fo=Ln.next(fo),Ln.remove(hn),fo&&Ao&&_s(Ao.key,fo.key,xn))}return qn}(sn,0,0,Ls,Ds,ls)),Sn=[],Fn=0;Fn<on.length;Fn++){var Dn=on[Fn];if(Dn.isExterior()){for(var Un=[Dn.points],fn=0;fn<Dn.holeIds.length;fn++)Un.push(on[Dn.holeIds[fn]].points);Sn.push(Un)}}return Sn}var Co={UNION:Et,DIFFERENCE:Rt,INTERSECTION:xt,XOR:Pt};g.diff=function(vr,Sr){return Rn(vr,Sr,Rt)},g.intersection=function(vr,Sr){return Rn(vr,Sr,xt)},g.operations=Co,g.union=function(vr,Sr){return Rn(vr,Sr,Et)},g.xor=function(vr,Sr){return Rn(vr,Sr,Pt)},Object.defineProperty(g,"__esModule",{value:!0})}(ET.exports)),ET.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function aE(g,s,a,b){const $=[],it=b===0?(st,at,ht,ft,xt,Et)=>{st.push(new ps(Et,ht+(Et-at)/(ft-at)*(xt-ht)))}:(st,at,ht,ft,xt,Et)=>{st.push(new ps(at+(Et-ht)/(xt-ht)*(ft-at),Et))};for(const st of g){const at=[];for(const ht of st){if(ht.length<=2)continue;const ft=[];for(let Rt=0;Rt<ht.length-1;Rt++){const Pt=ht[Rt].x,Lt=ht[Rt].y,Gt=ht[Rt+1].x,Kt=ht[Rt+1].y,Xt=b===0?Pt:Lt,nr=b===0?Gt:Kt;Xt<s?nr>s&&it(ft,Pt,Lt,Gt,Kt,s):Xt>a?nr<a&&it(ft,Pt,Lt,Gt,Kt,a):ft.push(ht[Rt]),nr<s&&Xt>=s&&it(ft,Pt,Lt,Gt,Kt,s),nr>a&&Xt<=a&&it(ft,Pt,Lt,Gt,Kt,a)}let xt=ht[ht.length-1];const Et=b===0?xt.x:xt.y;Et>=s&&Et<=a&&ft.push(xt),ft.length&&(xt=ft[ft.length-1],ft[0].x===xt.x&&ft[0].y===xt.y||ft.push(ft[0]),at.push(ft))}at.length&&$.push(at)}return $}function TP(g,s){const a=O2(g),b=O2([s]),$=ST.intersection(a,b);return $==null?[]:TT($)}function RP(g,s){let b=O2(g,65536);const $=[];for(;s.valid();s.next()){const[it,st]=s.get(),at=it.x*65536,ht=it.y*65536,ft=st.x*65536,xt=st.y*65536,Et=ft-at,Rt=xt-ht,Pt=Math.hypot(Et,Rt);if(Pt===0)continue;const Lt=Math.trunc(Rt/Pt*3),Gt=-Math.trunc(Et/Pt*3);$.push([[[at,ht],[ft,xt],[ft+Lt,xt+Gt],[at+Lt,ht+Gt],[at,ht]]])}return $.length>0&&(b=ST.diff(b,$)),TT(b,1/65536)}function O2(g,s=1){return[g.map(a=>a.map(b=>[b.x*s,b.y*s]))]}function TT(g,s=1){return g.map(a=>a.map((b,$)=>{const it=b.map(st=>new ps(st[0]*s,st[1]*s).round());return $>0&&it.reverse(),it}))}class B2{constructor(s,a){this.layoutVertexArray=new Nm,this.indexArray=new Zl,this.lineIndexArray=new tp,this.triangleSegments=new ga,this.lineSegments=new ga,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new om)}update(s,a,b,$,it,st,at,ht){this.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,ht)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,uP.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.lineIndexBuffer=s.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=s.createVertexBuffer(this.elevatedLayoutVertexArray,hP.members))),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(s,a,b,$,it,st,at){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,a,b,$,it,st,void 0,at)}}class V2{constructor(s){this.zoom=s.zoom,this.pixelRatio=s.pixelRatio,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=s.lut,this.bufferData=new B2(s,!1),this.elevationBufferData=new B2(s,!0),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=s.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=s.sourceLayerIndex,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,a){}updateAppearances(s,a,b,$){}populate(s,a,b,$){this.hasPattern=N2("fill",this.layers,this.pixelRatio,a);const it=this.layers[0].layout.get("fill-sort-key"),st=[];for(const{feature:at,id:ht,index:ft,sourceLayerIndex:xt}of s){const Et=this.layers[0]._featureFilter.needGeometry,Rt=Or(at,Et);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Rt,b))continue;const Pt=it?it.evaluate(Rt,{},b,a.availableImages):void 0,Lt={id:ht,properties:at.properties,type:at.type,sourceLayerIndex:xt,index:ft,geometry:Et?Rt.geometry:Pr(at,b,$),patterns:{},sortKey:Pt};st.push(Lt)}it&&st.sort((at,ht)=>at.sortKey-ht.sortKey);for(const at of st){const{geometry:ht,index:ft,sourceLayerIndex:xt}=at;if(this.hasPattern){const Et=z2("fill",this.layers,at,this.zoom,this.pixelRatio,a);this.patternFeatures.push(Et)}else this.addFeature(at,ht,ft,b,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(s[ft].feature,ht,ft,xt,this.index)}}update(s,a,b,$,it,st,at){this.bufferData.update(s,a,b,$,it,st,at,this.worldview),this.elevationBufferData.update(s,a,b,$,it,st,at,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(s,a,b,$,it,st,at,this.worldview)}addFeatures(s,a,b,$,it,st){for(const at of this.patternFeatures)this.addFeature(at,at.geometry,at.index,a,b,$,st,s.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(s){this.bufferData.upload(s),this.elevationBufferData.upload(s),this.elevatedStructures&&this.elevatedStructures.upload(s)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(s,a,b,$,it,st=[],at,ht){const ft=f1(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(s,ft,$,b,ht):this.addGeometry(ft,this.bufferData),this.bufferData.populatePaintArrays(s,b,it,st,$,at,this.worldview),this.elevationBufferData.populatePaintArrays(s,b,it,st,$,at,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(s,a,b,$,it){this.elevatedStructures&&(this.elevatedStructures.construct(s),this.elevatedStructures.populatePaintArrays(a,b,$,it,this.worldview))}addElevatedRoadFeature(s,a,b,$,it){const st=new Array,at=mo.getElevationFeature(s,it);if(!at)return void this.addGeometry(a,this.bufferData);{const ft=this.clipPolygonsToTile(a,1);ft.length>0&&st.push({polygons:ft,elevationFeature:at,elevationTileID:b})}const ht={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(s,{},b),featureIndex:$};for(const ft of st)if(ft.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new sp(ft.elevationTileID,this.layers,this.zoom,this.lut));const Et=ft.elevationFeature.isTunnel();let Rt=0;s.properties.hasOwnProperty(Qr)&&(Rt=+s.properties[Qr]);for(const Pt of ft.polygons)this.elevatedStructures.addPortalCandidates(ft.elevationFeature.id,Pt,Et,ft.elevationFeature,Rt)}ft.elevationFeature.constantHeight==null&&(ft.polygons=this.prepareElevatedPolygons(ft.polygons,ft.elevationFeature,ft.elevationTileID));const xt=new To(b,ft.elevationTileID);this.addElevatedGeometry(ft.polygons,xt,ft.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,$,ht)}}addElevatedGeometry(s,a,b,$,it,st){const at={elevation:b,elevationSampler:a,bias:$,index:it,featureInfo:st},[ht,ft]=this.addGeometry(s,this.elevationBufferData,at);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:ht,max:ft}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,ht),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,ft))}addGeometry(s,a,b){let $=Number.POSITIVE_INFINITY,it=Number.NEGATIVE_INFINITY,st=null;b&&(st=b.elevationSampler.constantElevation(b.elevation,b.bias),st!=null&&($=st,it=st));const at=(ht,ft,xt)=>{if(b!=null)if(ft.push(ht),st!=null)a.elevatedLayoutVertexArray.emplaceBack(st),xt.push(st);else{const Et=b.elevationSampler.pointElevation(ht,b.elevation,b.bias);a.elevatedLayoutVertexArray.emplaceBack(Et),xt.push(Et),$=Math.min($,Et),it=Math.max(it,Et)}};for(const ht of s){let ft=0;for(const lr of ht)ft+=lr.length;const xt=a.triangleSegments.prepareSegment(ft,a.layoutVertexArray,a.indexArray),Et=xt.vertexLength,Rt=[],Pt=[],Lt=[],Gt=[],Kt=[],Xt=a.layoutVertexArray.length;for(const lr of ht){if(lr.length===0)continue;lr!==ht[0]&&Pt.push(Rt.length/2);const hr=a.lineSegments.prepareSegment(lr.length,a.layoutVertexArray,a.lineIndexArray),Er=hr.vertexLength;b&&Kt.push(a.layoutVertexArray.length-Xt),at(lr[0],Lt,Gt),a.layoutVertexArray.emplaceBack(lr[0].x,lr[0].y),a.lineIndexArray.emplaceBack(Er+lr.length-1,Er),Rt.push(lr[0].x),Rt.push(lr[0].y);for(let _r=1;_r<lr.length;_r++)at(lr[_r],Lt,Gt),a.layoutVertexArray.emplaceBack(lr[_r].x,lr[_r].y),a.lineIndexArray.emplaceBack(Er+_r-1,Er+_r),Rt.push(lr[_r].x),Rt.push(lr[_r].y);hr.vertexLength+=lr.length,hr.primitiveLength+=lr.length}const nr=R_(Rt,Pt);for(let lr=0;lr<nr.length;lr+=3)a.indexArray.emplaceBack(Et+nr[lr],Et+nr[lr+1],Et+nr[lr+2]);if(nr.length>0&&b&&this.elevationMode==="hd-road-base"){const lr=b.elevation.isTunnel(),hr=b.elevation.safeArea,Er=this.elevatedStructures.addVertices(Lt,Gt);this.elevatedStructures.addTriangles(nr,Er,lr);const _r=Kt.length;if(_r>0){for(let Rr=0;Rr<_r-1;Rr++)this.elevatedStructures.addRenderableRing(b.index,Kt[Rr]+Er,Kt[Rr+1]-Kt[Rr],lr,hr,b.featureInfo);this.elevatedStructures.addRenderableRing(b.index,Kt[_r-1]+Er,Lt.length-Kt[_r-1],lr,hr,b.featureInfo)}}xt.vertexLength+=ft,xt.primitiveLength+=nr.length/3}return[$,it]}prepareElevatedPolygons(s,a,b){const $=1/ir(b),it=[];for(const st of s){const at=RP(st,new ao(a,$));it.push(...at)}return it}clipPolygonsToTile(s,a){const b=-a,$=-a,it=Ps+a,st=Ps+a;let at=0;const ht=[],ft=[];for(;at<s.length;at++){const Rt=s[at],Pt=Jp(Rt);(Pt.min.x>=b&&Pt.max.x<=it&&Pt.min.y>=$&&Pt.max.y<=st?ht:ft).push(Rt)}if(ht.length===s.length)return s;const xt=[new ps(b,$),new ps(it,$),new ps(it,st),new ps(b,st),new ps(b,$)],Et=ht;for(const Rt of ft)Et.push(...TP(Rt,xt));return Et}}let RT,CT,AT,jT;Xs(V2,"FillBucket",{omit:["layers","patternFeatures"]}),Xs(B2,"FillBufferData"),Xs(sp,"ElevatedStructures");class lE{constructor(s,a,b,$){if(this.triangleCount=a.length/3,this.min=new ps(0,0),this.max=new ps(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||s.length===0)return;const[it,st]=[s[0].clone(),s[0].clone()];for(let Et=1;Et<s.length;++Et){const Rt=s[Et];it.x=Math.min(it.x,Rt.x),it.y=Math.min(it.y,Rt.y),st.x=Math.max(st.x,Rt.x),st.y=Math.max(st.y,Rt.y)}if($){const Et=Math.ceil(Math.max(st.x-it.x,st.y-it.y)/$);b=Math.max(b,Et)}if(b===0)return;this.min=it,this.max=st;const at=this.max.sub(this.min);at.x=Math.max(at.x,1),at.y=Math.max(at.y,1);const ht=Math.max(at.x,at.y)/b;this.cellsX=Math.max(1,Math.ceil(at.x/ht)),this.cellsY=Math.max(1,Math.ceil(at.y/ht)),this.xScale=1/ht,this.yScale=1/ht;const ft=[];for(let Et=0;Et<this.triangleCount;Et++){const Rt=s[a[3*Et+0]].sub(this.min),Pt=s[a[3*Et+1]].sub(this.min),Lt=s[a[3*Et+2]].sub(this.min),Gt=Um(Math.floor(Math.min(Rt.x,Pt.x,Lt.x)),this.xScale,this.cellsX),Kt=Um(Math.floor(Math.max(Rt.x,Pt.x,Lt.x)),this.xScale,this.cellsX),Xt=Um(Math.floor(Math.min(Rt.y,Pt.y,Lt.y)),this.yScale,this.cellsY),nr=Um(Math.floor(Math.max(Rt.y,Pt.y,Lt.y)),this.yScale,this.cellsY),lr=new ps(0,0),hr=new ps(0,0),Er=new ps(0,0),_r=new ps(0,0);for(let Rr=Xt;Rr<=nr;++Rr){lr.y=hr.y=Rr*ht,Er.y=_r.y=(Rr+1)*ht;for(let kr=Gt;kr<=Kt;++kr)lr.x=Er.x=kr*ht,hr.x=_r.x=(kr+1)*ht,(Su(Rt,Pt,Lt,lr,hr,_r)||Su(Rt,Pt,Lt,lr,_r,Er))&&ft.push({cellIdx:Rr*this.cellsX+kr,triIdx:Et})}}if(ft.length===0)return;ft.sort((Et,Rt)=>Et.cellIdx-Rt.cellIdx||Et.triIdx-Rt.triIdx);let xt=0;for(;xt<ft.length;){const Et=ft[xt].cellIdx,Rt={start:this.payload.length,len:0};for(;xt<ft.length&&ft[xt].cellIdx===Et;)++Rt.len,this.payload.push(ft[xt++].triIdx);this.cells[Et]=Rt}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(s,a){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>s.x||s.y>this.max.y||this.min.y>s.y)return;const b=Um(s.x-this.min.x,this.xScale,this.cellsX),$=Um(s.y-this.min.y,this.yScale,this.cellsY),it=this.cells[$*this.cellsX+b];if(it){this._lazyInitLookup();for(let st=0;st<it.len;st++){const at=this.payload[it.start+st],ht=Math.floor(at/8),ft=1<<at%8;if(!(this.lookup[ht]&ft)&&(this.lookup[ht]|=ft,a.push(at),a.length===this.triangleCount))return}}}query(s,a,b){if(this.triangleCount===0||this.cells.length===0||s.x>this.max.x||this.min.x>a.x||s.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const $=Um(s.x-this.min.x,this.xScale,this.cellsX),it=Um(a.x-this.min.x,this.xScale,this.cellsX),st=Um(s.y-this.min.y,this.yScale,this.cellsY),at=Um(a.y-this.min.y,this.yScale,this.cellsY);for(let ht=st;ht<=at;ht++)for(let ft=$;ft<=it;ft++){const xt=this.cells[ht*this.cellsX+ft];if(xt)for(let Et=0;Et<xt.len;Et++){const Rt=this.payload[xt.start+Et],Pt=Math.floor(Rt/8),Lt=1<<Rt%8;if(!(this.lookup[Pt]&Lt)&&(this.lookup[Pt]|=Lt,b.push(Rt),b.length===this.triangleCount))return}}}}function Um(g,s,a){return Math.max(0,Math.min(a-1,Math.floor(g*s)))}Xs(lE,"TriangleGridIndex");class PT{constructor(s){this.zoom=s.zoom,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,a){for(const b of this.footprints)a.push({footprint:b,id:s})}updateAppearances(s,a,b,$){}populate(s,a,b,$){const it=[];for(const{feature:st,id:at,index:ht,sourceLayerIndex:ft}of s){const xt=this.layers[0]._featureFilter.needGeometry,Et=Or(st,xt);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Et,b))continue;const Rt={id:at,properties:st.properties,type:st.type,sourceLayerIndex:ft,index:ht,geometry:xt?Et.geometry:Pr(st,b,$),patterns:{}};it.push(Rt)}for(const st of it){const{geometry:at,index:ht,sourceLayerIndex:ft}=st;this.addFeature(st,at,ht,b,{},a.availableImages,a.brightness),a.featureIndex.insert(s[ht].feature,at,ht,ft,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(s){}update(s,a,b,$,it,st,at){}destroy(){}addFeature(s,a,b,$,it,st=[],at){for(const ht of f1(a,2)){const ft=[],xt=[],Et=[],Rt=new ps(1/0,1/0),Pt=new ps(-1/0,-1/0);for(const Kt of ht)if(Kt.length!==0){Kt!==ht[0]&&Et.push(xt.length/2);for(let Xt=0;Xt<Kt.length;Xt++)xt.push(Kt[Xt].x),xt.push(Kt[Xt].y),ft.push(Kt[Xt]),Rt.x=Math.min(Rt.x,Kt[Xt].x),Rt.y=Math.min(Rt.y,Kt[Xt].y),Pt.x=Math.max(Pt.x,Kt[Xt].x),Pt.y=Math.max(Pt.y,Kt[Xt].y)}const Lt=R_(xt,Et),Gt=new lE(ft,Lt,8,256);this.footprints.push({vertices:ft,indices:Lt,grid:Gt,min:Rt,max:Pt})}}}Xs(PT,"ClipBucket",{omit:["layers"]});const CP=Vn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),AP=Vn([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),jP=Vn([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),PP=Vn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),IP=Vn([{name:"a_join_normal_inside",components:3,type:"Int16"}]),kP=Vn([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),MP=Vn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:FP}=CP,p1=Number.MAX_SAFE_INTEGER,IT=p1-1;function kT(g,s,a,b){return g.order<s||g.order===p1||!(g.clipMask&a)||function($,it){return it.length!==0&&it.find(st=>st===$)===void 0}(b,g.clipScope)}function cE(g,s){return g.x-s.x||g.y-s.y}function MT(g,s){return cE(g.min,s.min)===0&&cE(g.max,s.max)===0}function U2(g,s){return!(g.min.x>s.max.x||g.max.x<s.min.x||g.min.y>s.max.y||g.max.y<s.min.y)}function uE(g,s){if(g.length!==s.length)return!1;for(let a=0;a<g.length;a++)if(g[a].sourceId!==s[a].sourceId||!MT(g[a],s[a])||g[a].order!==s[a].order||g[a].clipMask!==s[a].clipMask||!Wl(g[a].clipScope,s[a].clipScope))return!1;return!0}function FT(g,s,a){const b=1/Ps,$=1/(1<<a.canonical.z),it=(s.x*b+a.canonical.x)*$+a.wrap,st=(s.y*b+a.canonical.y)*$;return{min:new ps((g.x*b+a.canonical.x)*$+a.wrap,(g.y*b+a.canonical.y)*$),max:new ps(it,st)}}function LP(g,s,a){const b=1<<a.canonical.z,$=((s.x-a.wrap)*b-a.canonical.x)*Ps,it=(s.y*b-a.canonical.y)*Ps;return{min:new ps(((g.x-a.wrap)*b-a.canonical.x)*Ps,(g.y*b-a.canonical.y)*Ps),max:new ps($,it)}}function $2(g,s,a,b,$,it,st){const at=g.indices,ht=g.vertices,ft=[];for(let xt=b;xt<b+$;xt+=3){const Et=s[a[xt+0]+it],Rt=s[a[xt+1]+it],Pt=s[a[xt+2]+it],Lt=Math.min(Et.x,Rt.x,Pt.x),Gt=Math.max(Et.x,Rt.x,Pt.x),Kt=Math.min(Et.y,Rt.y,Pt.y),Xt=Math.max(Et.y,Rt.y,Pt.y);ft.length=0,g.grid.query(new ps(Lt,Kt),new ps(Gt,Xt),ft);for(let nr=0;nr<ft.length;nr++){const lr=ft[nr];if(Su(ht[at[3*lr+0]],ht[at[3*lr+1]],ht[at[3*lr+2]],Et,Rt,Pt,st))return!0}}return!1}function LT(g,s,a,b){if(!g||!a)return!1;let $=g.vertices;if(!s.canonical.equals(b.canonical)||s.wrap!==b.wrap){if(a.vertices.length<g.vertices.length)return LT(a,b,g,s);const it=s.canonical,st=b.canonical,at=Math.pow(2,st.z-it.z);$=g.vertices.map(ht=>new ps((ht.x+it.x*Ps)*at-st.x*Ps,(ht.y+it.y*Ps)*at-st.y*Ps))}return $2(a,$,g.indices,0,g.indices.length,0,0)}function DT(g,s,a,b){const $=Math.pow(2,b.z-a.z);return new ps((g+a.x*Ps)*$-b.x*Ps,(s+a.y*Ps)*$-b.y*Ps)}function NT(g,s){const a=[];s.grid.queryPoint(g,a);const b=s.indices,$=s.vertices;for(let it=0;it<a.length;it++){const st=a[it];if(ko([$[b[3*st+0]],$[b[3*st+1]],$[b[3*st+2]]],g))return!0}return!1}const G2=[new ps(0,0),new ps(Ps,0),new ps(Ps,Ps),new ps(0,Ps)];function zT(g,s){const a=[];let b=[];if(!s||g.length<2)return[g];if(g.length===2)return yu(g[0],g[1],G2)?[g]:[];for(let $=0;$<g.length+2;$++){const it=g[$%g.length],st=g[($+1)%g.length],at=yu($===0?g[g.length-1]:g[($-1)%g.length],it,G2),ht=yu(it,st,G2),ft=at||ht;ft&&b.push(it),ft&&ht||b.length>0&&(b.length>1&&a.push(b),b=[])}return b.length>1&&a.push(b),a}const H2=Nr.types,DP=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],NP=["fill-extrusion-flood-light-ground-radius"],zP=Math.pow(2,13),OP=Math.pow(2,15)-1,OT=new ps(0,1),gx=2147483648,BT=7,VT=450;function m1(g,s,a,b,$,it,st,at){g.emplaceBack((s<<1)+st,(a<<1)+it,(Math.floor(b*zP)<<1)+$,Math.round(at))}function g1(g,s,a){g.emplaceBack(s.x*Ps,s.y*Ps,a?1:0)}function hE(g,s,a,b,$,it){g.emplaceBack(s.x,s.y,(a.x<<1)+b,(a.y<<1)+$,it)}function x1(g,s,a){g.emplaceBack(s.x,s.y,s.z,a[0]*16384,a[1]*16384,a[2]*16384)}class UT{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $T{constructor(){this.centroidXY=new ps(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new ps(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new ps(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new ps(this.max.x-this.min.x,this.max.y-this.min.y)}}class GT{constructor(){this.acc=new ps(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(s,a){s.min.x===Number.MAX_VALUE&&(s.min.x=s.max.x=a.x,s.min.y=s.max.y=a.y)}appendEdge(s,a,b){this.accCount++,this.acc._add(a);let $=!!this.borders;a.x<s.min.x?(s.min.x=a.x,$=!0):a.x>s.max.x&&(s.max.x=a.x,$=!0),a.y<s.min.y?(s.min.y=a.y,$=!0):a.y>s.max.y&&(s.max.y=a.y,$=!0),((a.x===0||a.x===Ps)&&a.x===b.x)!=((a.y===0||a.y===Ps)&&a.y===b.y)&&this.processBorderOverlap(a,b),$&&this.checkBorderIntersection(a,b)}checkBorderIntersection(s,a){a.x<0!=s.x<0&&this.addBorderIntersection(0,pn(a.y,s.y,(0-a.x)/(s.x-a.x))),a.x>Ps!=s.x>Ps&&this.addBorderIntersection(1,pn(a.y,s.y,(Ps-a.x)/(s.x-a.x))),a.y<0!=s.y<0&&this.addBorderIntersection(2,pn(a.x,s.x,(0-a.y)/(s.y-a.y))),a.y>Ps!=s.y>Ps&&this.addBorderIntersection(3,pn(a.x,s.x,(Ps-a.y)/(s.y-a.y)))}addBorderIntersection(s,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const b=this.borders[s];a<b[0]&&(b[0]=a),a>b[1]&&(b[1]=a)}processBorderOverlap(s,a){if(s.x===a.x){if(s.y===a.y)return;const b=s.x===0?0:1;this.addBorderIntersection(b,a.y),this.addBorderIntersection(b,s.y)}else{const b=s.y===0?2:3;this.addBorderIntersection(b,a.x),this.addBorderIntersection(b,s.x)}}centroid(){return this.accCount===0?new ps(0,0):new ps(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((s,a)=>s+ +(a[0]!==Number.MAX_VALUE),0):0}}function HT(g,s){const a=g.add(s)._unit(),b=Qt(g.x*a.x+g.y*a.y,-1,1);var $,it,st;return $=Math.acos(b),Math.min(4,Math.max(-4,Math.tan($)))/4*OP*((it=g).x*(st=s).y-it.y*st.x<0?-1:1)}const BP=[g=>g.x<0,g=>g.x>Ps,g=>g.y<0,g=>g.y>Ps];function VP(g,s,a,b){const $=[4];if(b===0)return $;a._mult(b);const it=g.sub(a),st=s.sub(a),at=[g,s,it,st];for(let ht=0;ht<4;ht++)for(const ft of at)if(BP[ht](ft)){$.push(ht);break}return $}class W2{constructor(s){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new $v,this.indexArray=new Zl,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut},a=>NP.includes(a)),this._segments=new ga,this.hiddenByLandmarkVertexArray=new p_,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ga}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(s,a,b,$=!1){const it=s.length;if(it>2){let st=Math.max(0,this._segments.get().length-1);const at=this._segments._prepareSegment(4*it,this.vertexArray.length,2*this._segmentToGroundQuads[st].length);let ht;st!==this._segments.get().length-1&&(st++,this._segmentToGroundQuads[st]=[],this._segmentToRegionTriCounts[st]=[0,0,0,0,0]);{const ft=s[0],xt=s[1];ht=HT(ft.sub(s[it-1])._perp()._unit(),xt.sub(ft)._perp()._unit())}for(let ft=0;ft<it;ft++){const xt=ft===it-1?0:ft+1,Et=s[ft],Rt=s[xt],Pt=s[xt===it-1?0:xt+1],Lt=Rt.sub(Et)._perp()._unit(),Gt=HT(Lt,Pt.sub(Rt)._perp()._unit()),Kt=ht,Xt=Gt;if(q2(Et,Rt,a)||$&&ZT(Et,a)&&ZT(Rt,a)){ht=Gt;continue}const nr=at.vertexLength;hE(this.vertexArray,Et,Rt,1,1,Kt),hE(this.vertexArray,Et,Rt,1,0,Kt),hE(this.vertexArray,Et,Rt,0,1,Xt),hE(this.vertexArray,Et,Rt,0,0,Xt),at.vertexLength+=4;const lr=VP(Et,Rt,Lt,b);for(const hr of lr)this._segmentToGroundQuads[st].push({id:nr,region:hr}),this._segmentToRegionTriCounts[st][hr]+=2,at.primitiveLength+=2;ht=Gt}}}prepareBorderSegments(){if(!this.hasData())return;const s=this._segments.get(),a=s.length;for(let b=0;b<a;b++)this._segmentToGroundQuads[b].sort(($,it)=>$.region-it.region);for(let b=0;b<a;b++){const $=this._segmentToGroundQuads[b],it=s[b],st=this._segmentToRegionTriCounts[b];st.reduce((ht,ft)=>ht+ft,0);let at=0;for(let ht=0;ht<=4;ht++){const ft=st[ht];if(ft!==0){let xt=this.regionSegments[ht];xt||(xt=this.regionSegments[ht]=new ga);const Et={vertexOffset:it.vertexOffset,primitiveOffset:it.primitiveOffset+at,vertexLength:it.vertexLength,primitiveLength:ft};xt.get().push(Et)}at+=ft}for(let ht=0;ht<$.length;ht++){const ft=$[ht].id;this.indexArray.emplaceBack(ft,ft+1,ft+3),this.indexArray.emplaceBack(ft,ft+3,ft+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(s,a,b,$,it,st,at){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,s,a,b,$,it,st,void 0,at)}upload(s){this.hasData()&&(this.vertexBuffer=s.createVertexBuffer(this.vertexArray,AP.members),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=s.createVertexBuffer(this.groundRadiusArray,jP.members)))}uploadPaintProperties(s){this.hasData()&&this.programConfigurations.upload(s)}update(s,a,b,$,it,st,at,ht){this.hasData()&&this.programConfigurations.updatePaintArrays(s,a,b,$,it,st,at,ht)}updateHiddenByLandmark(s){this.updateHiddenByLandmarkRange(s.groundVertexArrayOffset,s.groundVertexCount,!!(s.flags&gx))}updateHiddenByLandmarkRange(s,a,b){if(!this.hasData())return;const $=a+s;if(a!==0){for(let it=s;it<$;++it)this.hiddenByLandmarkVertexArray.emplace(it,b?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(s){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=s.createVertexBuffer(this.hiddenByLandmarkVertexArray,kP.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let s=0;s<=4;s++){const a=this.regionSegments[s];a&&a.destroy()}}}}class dE{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaling=s.overscaling,this.layers=s.layers,this.pixelRatio=s.pixelRatio,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=s.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Zl,this.footprintVertices=new Nm,this.footprintSegments=[],this.layoutVertexArray=new Bx,this.centroidVertexArray=new Jw,this.wallVertexArray=new zy,this.indexArray=new Zl,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut},a=>DP.includes(a)),this.segments=new ga,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new W2(s),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,a){}updateAppearances(s,a,b,$){}populate(s,a,b,$){this.features=[],this.hasPattern=N2("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ir(b),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:it,id:st,index:at,sourceLayerIndex:ht}of s){const ft=this.layers[0]._featureFilter.needGeometry,xt=Or(it,ft);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),xt,b))continue;const Et={id:st,sourceLayerIndex:ht,index:at,geometry:ft?xt.geometry:Pr(it,b,$),properties:it.properties,type:it.type,patterns:{}},Rt=this.layoutVertexArray.length,Pt=H2[Et.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:it.id,feature:z2("fill-extrusion",this.layers,Et,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const Lt of Et.geometry)for(const Gt of zT(Lt,Pt))this.addFeature(it.id,Et,[Gt],at,b,{},a.availableImages,$,a.brightness);else this.addFeature(it.id,Et,Et.geometry,at,b,{},a.availableImages,$,a.brightness);a.featureIndex.insert(it,Et.geometry,at,ht,this.index,Rt)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(s,a,b,$,it,st){for(const{featureId:at,feature:ht}of this.features){const ft=H2[ht.type]==="Polygon",{geometry:xt}=ht;if(this.wallMode)for(const Et of xt)for(const Rt of zT(Et,ft))this.addFeature(at,ht,[Rt],ht.index,a,b,$,it,st);else this.addFeature(at,ht,xt,ht.index,a,b,$,it,st)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(s,a,b,$,it,st,at){this.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,this.worldview),this.groundEffect.update(s,a,it,b,$,st,at,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,FP),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.wallVertexBuffer=s.createVertexBuffer(this.wallVertexArray,IP.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=s.createVertexBuffer(this.layoutVertexExtArray,MP.members,!0)),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}uploadCentroid(s){this.groundEffect.uploadHiddenByLandmark(s),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=s.createVertexBuffer(this.centroidVertexArray,PP.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(s,a,b,$,it,st,at,ht,ft){const xt=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,Et=[new ps(0,0),new ps(Ps,Ps)],Rt=ht.projection,Pt=Rt.name==="globe",Lt=this.wallMode||H2[a.type]==="Polygon",Gt=new GT;Gt.centroidDataIndex=this.centroidData.length;const Kt=new $T;Kt.buildingId=s,a.properties&&a.properties.hasOwnProperty("building_id")&&(Kt.buildingId=a.properties.building_id);const Xt=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},it)<=0,nr=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},it);let lr;if(Kt.height=nr,Kt.vertexArrayOffset=this.layoutVertexArray.length,Kt.groundVertexArrayOffset=this.groundEffect.vertexArray.length,Pt&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new l_),this.wallMode){if(Pt)return void $s("Non zero fill-extrusion-line-width is not yet supported on globe.");if(b.length!==1)return;lr=function(Br){const as=Br[0].x===Br[Br.length-1].x&&Br[0].y===Br[Br.length-1].y;(function(Hs){let Ys=0;const zn=Hs.length;for(let Cs=0;Cs<zn;Cs++)Ys+=(Hs[(Cs+1)%zn].x-Hs[Cs].x)*(Hs[(Cs+1)%zn].y+Hs[Cs].y);return Ys>=0})(Br)||(Br=Br.reverse());const fs={geometry:[],joinNormals:[],indices:[]},vs=[],ws=[],xs=[];let ys=Br.length;for(;ys>=2&&Br[ys-1].equals(Br[ys-2]);)ys--;if(ys<(as?3:2))return fs;let os,ss,_s,Is,Rs,rn=0;for(;rn<ys-1&&Br[rn].equals(Br[rn+1]);)rn++;as&&(os=Br[ys-2],Rs=Br[rn].sub(os)._unit()._perp());for(let Hs=rn;Hs<ys;Hs++){if(_s=Hs===ys-1?as?Br[rn+1]:void 0:Br[Hs+1],_s&&Br[Hs].equals(_s))continue;Rs&&(Is=Rs),os&&(ss=os),os=Br[Hs],Rs=_s?_s.sub(os)._unit()._perp():Is,Is=Is||Rs;let Ys=Is.add(Rs);Ys.x===0&&Ys.y===0||Ys._unit();const zn=Ys.x*Rs.x+Ys.y*Rs.y,Cs=zn!==0?1/zn:1/0,Qs=Is.x*Rs.y-Is.y*Rs.x>0;let vn="miter";const Wn=2;vn==="miter"&&Cs>Wn&&(vn="bevel"),vn==="bevel"&&(Cs>100&&(vn="flipbevel"),Cs<Wn&&(vn="miter"));const Xn=(Rn,Co,vr,Sr)=>{const ls=new ps(Rn.x,Rn.y),bs=new ps(Rn.x,Rn.y);ls.x+=Co.x*Sr,ls.y+=Co.y*Sr,bs.x-=Co.x*Math.max(vr,1),bs.y-=Co.y*Math.max(vr,1),xs.push(Co),vs.push(ls),ws.push(bs)};if(vn==="miter")Ys._mult(Cs),Xn(os,Ys,0,0);else if(vn==="flipbevel")Ys=Rs.mult(-1),Xn(os,Ys,0,0),Xn(os,Ys.mult(-1),0,0);else{const Rn=-Math.sqrt(Cs*Cs-1),Co=Qs?Rn:0,vr=Qs?0:Rn;ss&&Xn(os,Is,Co,vr),_s&&Xn(os,Rs,Co,vr)}}fs.geometry=[...vs,...ws.reverse(),vs[0]],fs.joinNormals=[...xs,...xs.reverse(),xs[xs.length-1]];const zs=fs.geometry.length-1;for(let Hs=0;Hs<zs/2;Hs++)if(Hs+1<zs/2){let Ys=Hs,zn=Hs+1,Cs=zs-1-Hs,Qs=zs-2-Hs;Ys=Ys===0?zs-1:Ys-1,zn=zn===0?zs-1:zn-1,Cs=Cs===0?zs-1:Cs-1,Qs=Qs===0?zs-1:Qs-1,fs.indices.push(Cs),fs.indices.push(zn),fs.indices.push(Ys),fs.indices.push(Cs),fs.indices.push(Qs),fs.indices.push(zn)}return fs}(b[0]),b=[lr.geometry]}const hr=(Br,as)=>Br<(as.length-1)/2||Br===as.length-1,Er=this.wallMode?[b]:f1(b,500);for(let Br=Er.length-1;Br>=0;Br--){const as=Er[Br];(as.length===0||(_r=as[0]).every(ds=>ds.x<=0)||_r.every(ds=>ds.x>=Ps)||_r.every(ds=>ds.y<=0)||_r.every(ds=>ds.y>=Ps))&&Er.splice(Br,1)}var _r;let Rr;if(Pt)Rr=QT(Er,Et,it);else{Rr=[];for(const Br of Er)Rr.push({polygon:Br,bounds:Et})}const kr=Lt?this.edgeRadius:0,Lr=kr>0&&this.zoom<17,is=(Br,as)=>{if(Br.length===0)return!1;const ds=Br[Br.length-1];return as.x===ds.x&&as.y===ds.y};for(const{polygon:Br,bounds:as}of Rr){let ds=0,fs=0;for(const ys of Br)Lt&&!ys[0].equals(ys[ys.length-1])&&ys.push(ys[0]),fs+=Lt?ys.length-1:ys.length;const vs=this.segments.prepareSegment((Lt?5:4)*fs,this.layoutVertexArray,this.indexArray);Kt.footprintSegIdx<0&&(Kt.footprintSegIdx=this.footprintSegments.length),Kt.polygonSegIdx<0&&(Kt.polygonSegIdx=this.polygonSegments.length);const ws={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},xs=new UT;if(xs.vertexOffset=this.footprintVertices.length,xs.indexOffset=3*this.footprintIndices.length,xs.ringIndices=[],Lt){const ys=[],os=[];ds=vs.vertexLength;for(let _s=0;_s<Br.length;_s++){const Is=Br[_s];Is.length&&_s!==0&&os.push(ys.length/2);const Rs=[];let rn,zs;rn=Is[1].sub(Is[0])._perp()._unit(),xs.ringIndices.push(Is.length-1);for(let Hs=1;Hs<Is.length;Hs++){const Ys=Is[Hs],zn=Is[Hs===Is.length-1?1:Hs+1],Cs=Ys.clone();if(kr){zs=zn.sub(Ys)._perp()._unit();const Qs=rn.add(zs)._unit(),vn=kr*Math.min(4,1/(rn.x*Qs.x+rn.y*Qs.y));Cs.x+=vn*Qs.x,Cs.y+=vn*Qs.y,Cs.x=Math.round(Cs.x),Cs.y=Math.round(Cs.y),rn=zs}if(!Xt||kr!==0&&!Lr||is(Rs,Cs)||Rs.push(Cs),m1(this.layoutVertexArray,Cs.x,Cs.y,0,0,1,1,0),this.wallMode){const Qs=hr(Hs,Is);g1(this.wallVertexArray,lr.joinNormals[Hs],!Qs)}vs.vertexLength++,this.footprintVertices.emplaceBack(Ys.x,Ys.y),ys.push(Ys.x,Ys.y),Pt&&x1(this.layoutVertexExtArray,Rt.projectTilePoint(Cs.x,Cs.y,it),Rt.upVector(it,Cs.x,Cs.y))}Xt&&(kr===0||Lr)&&(Rs.length!==0&&is(Rs,Rs[0])&&Rs.pop(),this.groundEffect.addData(Rs,as,xt))}const ss=this.wallMode?lr.indices:R_(ys,os);for(let _s=0;_s<ss.length;_s+=3)this.footprintIndices.emplaceBack(xs.vertexOffset+ss[_s+0],xs.vertexOffset+ss[_s+1],xs.vertexOffset+ss[_s+2]),this.indexArray.emplaceBack(ds+ss[_s],ds+ss[_s+2],ds+ss[_s+1]),vs.primitiveLength++;xs.indexCount+=ss.length,xs.vertexCount+=this.footprintVertices.length-xs.vertexOffset}for(let ys=0;ys<Br.length;ys++){const os=Br[ys];Gt.startRing(Kt,os[0]);let ss=os.length>4&&XT(os[os.length-2],os[0],os[1]),_s=kr?UP(os[os.length-2],os[0],os[1],kr):0;const Is=[];let Rs,rn,zs;rn=os[1].sub(os[0])._perp()._unit();let Hs=!0;for(let Ys=1,zn=0;Ys<os.length;Ys++){let Cs=os[Ys-1],Qs=os[Ys];const vn=os[Ys===os.length-1?1:Ys+1];if(Gt.appendEdge(Kt,Qs,Cs),q2(Qs,Cs,as)){kr&&(rn=vn.sub(Qs)._perp()._unit(),Hs=!Hs);continue}const Wn=Qs.sub(Cs)._perp(),Xn=Wn.x/(Math.abs(Wn.x)+Math.abs(Wn.y)),Rn=Wn.y>0?1:0,Co=Cs.dist(Qs);if(zn+Co>32768&&(zn=0),kr){zs=vn.sub(Qs)._perp()._unit();let bs=qT(Cs,Qs,vn,WT(rn,zs),kr);isNaN(bs)&&(bs=0);const Ls=Qs.sub(Cs)._unit();Cs=Cs.add(Ls.mult(_s))._round(),Qs=Qs.add(Ls.mult(-bs))._round(),_s=bs,rn=zs,Xt&&this.zoom>=17&&(is(Is,Cs)||Is.push(Cs),is(Is,Qs)||Is.push(Qs))}const vr=vs.vertexLength,Sr=os.length>4&&XT(Cs,Qs,vn);let ls=KT(zn,ss,Hs);if(m1(this.layoutVertexArray,Cs.x,Cs.y,Xn,Rn,0,0,ls),m1(this.layoutVertexArray,Cs.x,Cs.y,Xn,Rn,0,1,ls),this.wallMode){const bs=hr(Ys-1,os),Ls=lr.joinNormals[Ys-1];g1(this.wallVertexArray,Ls,bs),g1(this.wallVertexArray,Ls,bs)}if(zn+=Co,ls=KT(zn,Sr,!Hs),ss=Sr,m1(this.layoutVertexArray,Qs.x,Qs.y,Xn,Rn,0,0,ls),m1(this.layoutVertexArray,Qs.x,Qs.y,Xn,Rn,0,1,ls),this.wallMode){const bs=hr(Ys,os),Ls=lr.joinNormals[Ys];g1(this.wallVertexArray,Ls,bs),g1(this.wallVertexArray,Ls,bs)}if(vs.vertexLength+=4,this.indexArray.emplaceBack(vr+0,vr+1,vr+2),this.indexArray.emplaceBack(vr+1,vr+3,vr+2),vs.primitiveLength+=2,kr){const bs=ds+(Ys===1?os.length-2:Ys-2),Ls=Ys===1?ds:bs+1;if(this.indexArray.emplaceBack(vr+1,bs,vr+3),this.indexArray.emplaceBack(bs,Ls,vr+3),vs.primitiveLength+=2,Rs===void 0&&(Rs=vr),!q2(vn,os[Ys],as)){const Ds=Ys===os.length-1?Rs:vs.vertexLength;this.indexArray.emplaceBack(vr+2,vr+3,Ds),this.indexArray.emplaceBack(vr+3,Ds+1,Ds),this.indexArray.emplaceBack(vr+3,Ls,Ds+1),vs.primitiveLength+=3}Hs=!Hs}if(Pt){const bs=this.layoutVertexExtArray,Ls=Rt.projectTilePoint(Cs.x,Cs.y,it),Ds=Rt.projectTilePoint(Qs.x,Qs.y,it),sn=Rt.upVector(it,Cs.x,Cs.y),on=Rt.upVector(it,Qs.x,Qs.y);x1(bs,Ls,sn),x1(bs,Ls,sn),x1(bs,Ds,on),x1(bs,Ds,on)}}Lt&&(ds+=os.length-1),Xt&&kr&&this.zoom>=17&&(Is.length!==0&&is(Is,Is[0])&&Is.pop(),this.groundEffect.addData(Is,as,xt,kr>0))}this.footprintSegments.push(xs),ws.triangleCount=this.indexArray.length-ws.triangleArrayOffset,this.polygonSegments.push(ws),++Kt.footprintSegLen,++Kt.polygonSegLen}if(Kt.vertexCount=this.layoutVertexArray.length-Kt.vertexArrayOffset,Kt.groundVertexCount=this.groundEffect.vertexArray.length-Kt.groundVertexArrayOffset,Kt.vertexCount!==0){if(Kt.centroidXY=Gt.borders?OT:this.encodeCentroid(Gt,Kt),this.centroidData.push(Kt),Gt.borders){this.featuresOnBorder.push(Gt);const Br=this.featuresOnBorder.length-1;for(let as=0;as<Gt.borders.length;as++)Gt.borders[as][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[as].push(Br)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,$,st,at,it,ft,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,$,st,at,it,ft,this.worldview),this.maxHeight=Math.max(this.maxHeight,nr)}}sortBorders(){for(let s=0;s<this.borderFeatureIndices.length;s++)this.borderFeatureIndices[s].sort((a,b)=>this.featuresOnBorder[a].borders[s][0]-this.featuresOnBorder[b].borders[s][0])}splitToSubtiles(){const s=[];for(let at=0;at<this.centroidData.length;at++){const ht=this.centroidData[at],ft=+(ht.min.y+ht.max.y>Ps),xt=2*ft+(+(ht.min.x+ht.max.x>Ps)^ft);for(let Et=0;Et<ht.polygonSegLen;Et++){const Rt=ht.polygonSegIdx+Et;s.push({centroidIdx:at,subtile:xt,polygonSegmentIdx:Rt,triangleSegmentIdx:this.polygonSegments[Rt].triangleSegIdx})}}const a=new Zl;s.sort((at,ht)=>at.triangleSegmentIdx===ht.triangleSegmentIdx?at.subtile-ht.subtile:at.triangleSegmentIdx-ht.triangleSegmentIdx);let b=0,$=0,it=0;for(const at of s){if(at.triangleSegmentIdx!==b)break;it++}const st=s.length;for(;$!==s.length;){b=s[$].triangleSegmentIdx;let at=0,ht=$,ft=$;for(let xt=ht;xt<it&&s[xt].subtile===at;xt++)ft++;for(;ht!==it;){const xt=s[ht];at=xt.subtile;const Et=this.centroidData[xt.centroidIdx].min.clone(),Rt=this.centroidData[xt.centroidIdx].max.clone(),Pt={vertexOffset:this.segments.segments[b].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[b].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let Lt=ht;Lt<ft;Lt++){const Gt=s[Lt],Kt=this.polygonSegments[Gt.polygonSegmentIdx],Xt=this.centroidData[Gt.centroidIdx].min,nr=this.centroidData[Gt.centroidIdx].max,lr=this.indexArray.uint16;for(let hr=Kt.triangleArrayOffset;hr<Kt.triangleArrayOffset+Kt.triangleCount;hr++)a.emplaceBack(lr[3*hr],lr[3*hr+1],lr[3*hr+2]);Pt.primitiveLength+=Kt.triangleCount,Et.x=Math.min(Et.x,Xt.x),Et.y=Math.min(Et.y,Xt.y),Rt.x=Math.max(Rt.x,nr.x),Rt.y=Math.max(Rt.y,nr.y)}Pt.primitiveLength>0&&this.triangleSubSegments.push({segment:Pt,min:Et,max:Rt}),ht=ft;for(let Lt=ht;Lt<it&&s[Lt].subtile===s[ht].subtile;Lt++)ft++}$=it;for(let xt=$;xt<st&&s[xt].triangleSegmentIdx===s[$].triangleSegmentIdx;xt++)it++}a._trim(),this.indexArray=a}getVisibleSegments(s,a,b){const $=new ga;if(this.wallMode){for(const Gt of this.triangleSubSegments)$.segments.push(Gt.segment);return $}let it=0,st=0;const at=1<<s.canonical.z;if(a){const Gt=a.getMinMaxForTile(s);Gt&&(it=Gt.min,st=Gt.max)}st+=this.maxHeight;const ht=s.toUnwrapped();let ft;const xt=[ht.canonical.x/at+ht.wrap,ht.canonical.y/at],Et=[(ht.canonical.x+1)/at+ht.wrap,(ht.canonical.y+1)/at],Rt=(Gt,Kt,Xt)=>[Gt[0]*(1-Xt[0])+Kt[0]*Xt[0],Gt[1]*(1-Xt[1])+Kt[1]*Xt[1]],Pt=[],Lt=[];for(const Gt of this.triangleSubSegments){Pt[0]=Gt.min.x/Ps,Pt[1]=Gt.min.y/Ps,Lt[0]=Gt.max.x/Ps,Lt[1]=Gt.max.y/Ps;const Kt=Rt(xt,Et,Pt),Xt=Rt(xt,Et,Lt);if(new en([Kt[0],Kt[1],it],[Xt[0],Xt[1],st]).intersectsPrecise(b)===0){ft&&($.segments.push(ft),ft=void 0);continue}const nr=Gt.segment;ft&&ft.vertexOffset!==nr.vertexOffset&&($.segments.push(ft),ft=void 0),ft?(ft.vertexLength+=nr.vertexLength,ft.primitiveLength+=nr.primitiveLength):ft={vertexOffset:nr.vertexOffset,primitiveLength:nr.primitiveLength,vertexLength:nr.vertexLength,primitiveOffset:nr.primitiveOffset,sortKey:void 0,vaos:{}}}return ft&&$.segments.push(ft),$}encodeCentroid(s,a){const b=s.centroid(),$=a.span(),it=Math.min(7,Math.round($.x*this.tileToMeter/10)),st=Math.min(7,Math.round($.y*this.tileToMeter/10));return new ps(Qt(b.x,1,Ps-1)<<3|it,Qt(b.y,1,Ps-1)<<3|st)}encodeBorderCentroid(s){if(!s.borders)return new ps(0,0);const a=s.borders,b=Number.MAX_VALUE;if(a[0][0]!==b||a[1][0]!==b){const $=a[0][0]!==b?0:1;return new ps(6|(a[0][0]!==b?0:65528),(a[$][0]+a[$][1])/2<<3|6)}{const $=a[2][0]!==b?2:3;return new ps((a[$][0]+a[$][1])/2<<3|6,6|(a[2][0]!==b?0:65528))}}showCentroid(s){const a=this.centroidData[s.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(s){this.groundEffect.updateHiddenByLandmark(s);const a=s.vertexArrayOffset,b=s.vertexCount+s.vertexArrayOffset,$=s.flags&gx?OT:s.centroidXY,it=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==$.y||it!==$.x){for(let st=a;st<b;++st)this.centroidVertexArray.emplace(st,$.x,$.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.centroidData)this.writeCentroidToBuffer(s)}updateReplacement(s,a,b){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const $=a.getReplacementRegionsForTile(s.toUnwrapped());if(uE(this.activeReplacements,$))return;if(this.activeReplacements=$,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const st of this.centroidData)st.flags&=2147483647;const it=[];for(const st of this.activeReplacements){if(st.order<b)continue;const at=Math.max(1,Math.pow(2,st.footprintTileId.canonical.z-s.canonical.z));if(st.footprint.buildingIds)for(const ht of this.centroidData)ht.flags&gx||st.min.x>ht.max.x||ht.min.x>st.max.x||st.min.y>ht.max.y||ht.min.y>st.max.y||st.footprint.buildingIds.has(ht.buildingId)&&(ht.flags|=gx);else for(const ht of this.centroidData)if(!(ht.flags&gx||st.min.x>ht.max.x||ht.min.x>st.max.x||st.min.y>ht.max.y||ht.min.y>st.max.y))for(let ft=0;ft<ht.footprintSegLen;ft++){const xt=this.footprintSegments[ht.footprintSegIdx+ft];if(it.length=0,$P(this.footprintVertices,xt.vertexOffset,xt.vertexCount,st.footprintTileId.canonical,s.canonical,it),$2(st.footprint,it,this.footprintIndices.uint16,xt.indexOffset,xt.indexCount,-xt.vertexOffset,-at)){ht.flags|=gx;break}}}for(const st of this.centroidData)this.writeCentroidToBuffer(st);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(s,a,b){let $=!1;for(let it=0;it<b.footprintSegLen;it++){const st=this.footprintSegments[b.footprintSegIdx+it];let at=0;for(const ht of st.ringIndices){for(let ft=at,xt=ht+at-1;ft<ht+at;xt=ft++){const Et=this.footprintVertices.int16[2*(ft+st.vertexOffset)+0],Rt=this.footprintVertices.int16[2*(ft+st.vertexOffset)+1],Pt=this.footprintVertices.int16[2*(xt+st.vertexOffset)+1];Rt>a!=Pt>a&&s<(this.footprintVertices.int16[2*(xt+st.vertexOffset)+0]-Et)*(a-Rt)/(Pt-Rt)+Et&&($=!$)}at=ht}}return $}getHeightAtTileCoord(s,a){let b=Number.NEGATIVE_INFINITY,$=!0;const it=4*(s+Ps)*Ps+(a+Ps);if(this.partLookup.hasOwnProperty(it)){const st=this.partLookup[it];return st?{height:st.height,hidden:!!(st.flags&gx)}:void 0}for(const st of this.centroidData)s>st.max.x||st.min.x>s||a>st.max.y||st.min.y>a||st.height<=b||this.footprintContainsPoint(s,a,st)&&(b=st.height,this.partLookup[it]=st,$=!!(st.flags&gx));if(b!==Number.NEGATIVE_INFINITY)return{height:b,hidden:$};this.partLookup[it]=void 0}}function WT(g,s){const a=g.add(s)._unit();return g.x*a.x+g.y*a.y}function UP(g,s,a,b){const $=s.sub(g)._perp()._unit(),it=a.sub(s)._perp()._unit();return qT(g,s,a,WT($,it),b)}function qT(g,s,a,b,$){const it=Math.sqrt(1-b*b);return Math.min(g.dist(s)/3,s.dist(a)/3,$*it/b)}function q2(g,s,a){return g.x<a[0].x&&s.x<a[0].x||g.x>a[1].x&&s.x>a[1].x||g.y<a[0].y&&s.y<a[0].y||g.y>a[1].y&&s.y>a[1].y}function ZT(g,s){return g.x<s[0].x||g.x>s[1].x||g.y<s[0].y||g.y>s[1].y}function XT(g,s,a){if(g.x<0||g.x>=Ps||s.x<0||s.x>=Ps||a.x<0||a.x>=Ps)return!1;const b=a.sub(s),$=b.perp(),it=g.sub(s);return(b.x*it.x+b.y*it.y)/Math.sqrt((b.x*b.x+b.y*b.y)*(it.x*it.x+it.y*it.y))>-.866&&$.x*it.x+$.y*it.y<0}function KT(g,s,a){const b=s?2|g:-3&g;return a?1|b:-2&b}function YT(){const g=Math.PI/32,s=Math.tan(g),a=et;return a*Math.sqrt(1+2*s*s)-a}function QT(g,s,a){const b=1<<a.z,$=Ct(a.x/b),it=Ct((a.x+1)/b),st=Ut(a.y/b),at=Ut((a.y+1)/b);return function(ht,ft,xt,Et,Rt=0,Pt){const Lt=[];if(!ht.length||!xt||!Et)return Lt;const Gt=(_r,Rr)=>{for(const kr of _r)Lt.push({polygon:kr,bounds:Rr})},Kt=Math.ceil(Math.log2(xt)),Xt=Math.ceil(Math.log2(Et)),nr=Kt-Xt,lr=[];for(let _r=0;_r<Math.abs(nr);_r++)lr.push(nr>0?0:1);for(let _r=0;_r<Math.min(Kt,Xt);_r++)lr.push(0),lr.push(1);let hr=ht;if(hr=aE(hr,ft[0].y-Rt,ft[1].y+Rt,1),hr=aE(hr,ft[0].x-Rt,ft[1].x+Rt,0),!hr.length)return Lt;const Er=[];for(lr.length?Er.push({polygons:hr,bounds:ft,depth:0}):Gt(hr,ft);Er.length;){const _r=Er.pop(),Rr=_r.depth,kr=lr[Rr],Lr=_r.bounds[0],is=_r.bounds[1],Br=kr===0?Lr.x:Lr.y,as=kr===0?is.x:is.y,ds=Pt?Pt(kr,Br,as):.5*(Br+as),fs=aE(_r.polygons,Br-Rt,ds+Rt,kr),vs=aE(_r.polygons,ds-Rt,as+Rt,kr);if(fs.length){const ws=[Lr,new ps(kr===0?ds:is.x,kr===1?ds:is.y)];lr.length>Rr+1?Er.push({polygons:fs,bounds:ws,depth:Rr+1}):Gt(fs,ws)}if(vs.length){const ws=[new ps(kr===0?ds:Lr.x,kr===1?ds:Lr.y),is];lr.length>Rr+1?Er.push({polygons:vs,bounds:ws,depth:Rr+1}):Gt(vs,ws)}}return Lt}(g,s,Math.ceil((it-$)/11.25),Math.ceil((st-at)/11.25),1,(ht,ft,xt)=>{if(ht===0)return .5*(ft+xt);{const Et=Ut((a.y+ft/Ps)/b);return(mt(.5*(Ut((a.y+xt/Ps)/b)+Et))*b-a.y)*Ps}})}function $P(g,s,a,b,$,it){const st=Math.pow(2,b.z-$.z);for(let at=0;at<a;at++){let ht=g.int16[2*(at+s)+0],ft=g.int16[2*(at+s)+1];ht=(ht+$.x*Ps)*st-b.x*Ps,ft=(ft+$.y*Ps)*st-b.y*Ps,it.push(new ps(ht,ft))}}let JT,eR;Xs(dE,"FillExtrusionBucket",{omit:["layers","features"]}),Xs($T,"PartData"),Xs(UT,"FootprintSegment"),Xs(GT,"BorderCentroidData"),Xs(W2,"GroundEffect");class Zy extends ps{constructor(s,a,b){super(s,a),this.z=b}}class tR extends Zy{constructor(s,a,b,$){super(s,a,b),this.w=$}}function rR(g,s,a,b){const $=a==="x"?"y":"x",it=(b-g[a])/(s[a]-g[a]);g[$]=Math.round(g[$]+(s[$]-g[$])*it),g[a]=b,g.hasOwnProperty("z")&&(g.z=pn(g.z,s.z,it)),g.hasOwnProperty("w")&&(g.w=pn(g.w,s.w,it))}function iR(g,s,a,b){const $=a,it=b;for(const st of["x","y"]){let at=g,ht=s;at[st]>=ht[st]&&(at=s,ht=g),at[st]<$&&ht[st]>$&&rR(at,ht,st,$),at[st]<it&&ht[st]>it&&rR(ht,at,st,it)}}function fE(g,s,a,b,$,it){const st=[];for(let at=0;at<g.length;at++){const ht=g[at];let ft;const xt=st.length;let Et=0;for(let Rt=0;Rt<ht.length-1;Rt++){let Pt=ht[Rt],Lt=ht[Rt+1],Gt=0;const Kt=Et;let Xt,nr;it&&(Gt=Math.hypot(Lt.x-Pt.x,Lt.y-Pt.y),Et+=Gt,Xt=Pt,nr=Lt),Pt.x<s&&Lt.x<s||(Pt.x<s?Pt=new ps(s,Pt.y+(s-Pt.x)/(Lt.x-Pt.x)*(Lt.y-Pt.y))._round():Lt.x<s&&(Lt=new ps(s,Pt.y+(s-Pt.x)/(Lt.x-Pt.x)*(Lt.y-Pt.y))._round()),Pt.y<a&&Lt.y<a||(Pt.y<a?Pt=new ps(Pt.x+(a-Pt.y)/(Lt.y-Pt.y)*(Lt.x-Pt.x),a)._round():Lt.y<a&&(Lt=new ps(Pt.x+(a-Pt.y)/(Lt.y-Pt.y)*(Lt.x-Pt.x),a)._round()),Pt.x>=b&&Lt.x>=b||(Pt.x>=b?Pt=new ps(b,Pt.y+(b-Pt.x)/(Lt.x-Pt.x)*(Lt.y-Pt.y))._round():Lt.x>=b&&(Lt=new ps(b,Pt.y+(b-Pt.x)/(Lt.x-Pt.x)*(Lt.y-Pt.y))._round()),Pt.y>=$&&Lt.y>=$||(Pt.y>=$?Pt=new ps(Pt.x+($-Pt.y)/(Lt.y-Pt.y)*(Lt.x-Pt.x),$)._round():Lt.y>=$&&(Lt=new ps(Pt.x+($-Pt.y)/(Lt.y-Pt.y)*(Lt.x-Pt.x),$)._round()),ft&&Pt.equals(ft[ft.length-1])||(ft=[Pt],st.push(ft),it&&it.push({progress:{min:Kt+sR(Xt,nr,Pt)*Gt,max:1},parentIndex:at,prevPoint:Xt,nextPoint:nr})),ft.push(Lt),it&&(it[it.length-1].progress.max=Kt+sR(Xt,nr,Lt)*Gt,it[it.length-1].nextPoint=nr)))))}if(it&&Et>0)for(let Rt=xt;Rt<st.length;Rt++)it[Rt].progress.min/=Et,it[Rt].progress.max/=Et}return st}function GP(g,s,a,b,$){if(g.length<2)return void b.push(g);const it=[];for(;s.valid();){const[ft,xt]=s.get();for(let Et=0;Et<g.length-1;Et++){const Rt=g[Et],Pt=g[Et+1],Lt=Mn(Rt,Pt,ft,xt);if(Lt){const[Gt]=Lt,Kt=new ps(pn(Rt.x,Pt.x,Gt),pn(Rt.y,Pt.y,Gt));it.push({t:Et+Gt,distance:0,point:Kt})}}s.next()}if(it.length===0)return void b.push(g);it.sort((ft,xt)=>ft.t-xt.t);let st=0,at=0,ht=[];for(b.push(ht);st!==g.length;){if(at===it.length){for(;st!==g.length;)ht.length!==0&&ht[ht.length-1].equals(g[st])||ht.push(g[st]),st++;break}it[at].t<=st?(ht.length!==0&&ht[ht.length-1].equals(it[at].point)||ht.push(it[at].point),Math.trunc(it[at].t),at++):(ht.length!==0&&ht[ht.length-1].equals(g[st])||ht.push(g[st]),st++)}}function sR(g,s,a){return g.x!==s.x?(a.x-g.x)/(s.x-g.x):g.y!==s.y?(a.y-g.y)/(s.y-g.y):0}function y1(g,s){return g.x*s.x+g.y*s.y}function nR(g,s){if(g.length===1){let a=0;const b=s[a++];let $;for(;!$||b.equals($);)if($=s[a++],!$)return 1/0;for(;a<s.length;a++){const it=s[a],st=g[0],at=$.sub(b),ht=it.sub(b),ft=st.sub(b),xt=y1(at,at),Et=y1(at,ht),Rt=y1(ht,ht),Pt=y1(ft,at),Lt=y1(ft,ht),Gt=xt*Rt-Et*Et,Kt=(Rt*Pt-Et*Lt)/Gt,Xt=(xt*Lt-Et*Pt)/Gt,nr=b.z*(1-Kt-Xt)+$.z*Kt+it.z*Xt;if(isFinite(nr))return nr}return 1/0}{let a=1/0;for(const b of s)a=Math.min(a,b.z);return a}}function oR(g,s,a){let b=1/0;po(a,s)&&(b=nR(a,s[0]));for(let $=0;$<s.length;$++){const it=s[$],st=g[$];for(let at=0;at<it.length-1;at++){const ht=it[at],ft=[ht,it[at+1],st[at+1],st[at],ht];no(a,ft)&&(b=Math.min(b,nR(a,ft)))}}return b!==1/0&&b}function aR(g,s,a,b,$,it,st,at,ht,ft,xt){return g.projection.name==="globe"?function(Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er){const _r=[],Rr=[],kr=Et.projection.upVectorScale(Er,Et.center.lat,Et.worldSize).metersToTile,Lr=[0,0,0,1],is=[0,0,0,1],Br=(ds,fs,vs,ws)=>{ds[0]=fs,ds[1]=vs,ds[2]=ws,ds[3]=1},as=YT();Pt>0&&(Pt+=as),Lt+=as;for(const ds of Rt){const fs=[],vs=[];for(const ws of ds){const xs=ws.x+Gt.x,ys=ws.y+Gt.y,os=Et.projection.projectTilePoint(xs,ys,Er),ss=Et.projection.upVector(Er,ws.x,ws.y);let _s=Pt,Is=Lt;if(Xt){const Rs=lR(xs,ys,Pt,Lt,Xt,nr,lr,hr);_s+=Rs.base,Is+=Rs.top}Pt!==0?Br(Lr,os.x+ss[0]*kr*_s,os.y+ss[1]*kr*_s,os.z+ss[2]*kr*_s):Br(Lr,os.x,os.y,os.z),Br(is,os.x+ss[0]*kr*Is,os.y+ss[1]*kr*Is,os.z+ss[2]*kr*Is),Os(Lr,Lr,Kt),Os(is,is,Kt),fs.push(new Zy(Lr[0],Lr[1],Lr[2])),vs.push(new Zy(is[0],is[1],is[2]))}_r.push(fs),Rr.push(vs)}return[_r,Rr]}(g,s,a,b,$,it,st,at,ht,ft,xt):st?function(Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr){const hr=[],Er=[],_r=[0,0,0,1];for(const Rr of Et){const kr=[],Lr=[];for(const is of Rr){const Br=is.x+Lt.x,as=is.y+Lt.y,ds=lR(Br,as,Rt,Pt,Kt,Xt,nr,lr);_r[0]=Br,_r[1]=as,_r[2]=ds.base,_r[3]=1,uo(_r,_r,Gt),_r[3]=Math.max(_r[3],1e-5);const fs=new Zy(_r[0]/_r[3],_r[1]/_r[3],_r[2]/_r[3]);_r[0]=Br,_r[1]=as,_r[2]=ds.top,_r[3]=1,uo(_r,_r,Gt),_r[3]=Math.max(_r[3],1e-5);const vs=new Zy(_r[0]/_r[3],_r[1]/_r[3],_r[2]/_r[3]);kr.push(fs),Lr.push(vs)}hr.push(kr),Er.push(Lr)}return[hr,Er]}(s,a,b,$,it,st,at,ht,ft):function(Et,Rt,Pt,Lt,Gt){const Kt=[],Xt=[],nr=Gt[8]*Rt,lr=Gt[9]*Rt,hr=Gt[10]*Rt,Er=Gt[11]*Rt,_r=Gt[8]*Pt,Rr=Gt[9]*Pt,kr=Gt[10]*Pt,Lr=Gt[11]*Pt;for(const is of Et){const Br=[],as=[];for(const ds of is){const fs=ds.x+Lt.x,vs=ds.y+Lt.y,ws=Gt[0]*fs+Gt[4]*vs+Gt[12],xs=Gt[1]*fs+Gt[5]*vs+Gt[13],ys=Gt[2]*fs+Gt[6]*vs+Gt[14],os=Gt[3]*fs+Gt[7]*vs+Gt[15],ss=ws+nr,_s=xs+lr,Is=ys+hr,Rs=Math.max(os+Er,1e-5),rn=ws+_r,zs=xs+Rr,Hs=ys+kr,Ys=Math.max(os+Lr,1e-5);Br.push(new Zy(ss/Rs,_s/Rs,Is/Rs)),as.push(new Zy(rn/Ys,zs/Ys,Hs/Ys))}Kt.push(Br),Xt.push(as)}return[Kt,Xt]}(s,a,b,$,it)}function lR(g,s,a,b,$,it,st,at){const ht=st*$.getElevationAt(g,s,!0,!0),ft=it[0]!==0,xt=ft?it[1]===0?st*(it[0]/BT-VT):st*function(Et,Rt,Pt){const Lt=Math.floor(Rt[0]/8),Gt=Math.floor(Rt[1]/8),Kt=10*(Rt[0]-8*Lt),Xt=10*(Rt[1]-8*Gt),nr=Et.getElevationAt(Lt,Gt,!0,!0),lr=Et.getMeterToDEM(Pt),hr=Math.floor(.5*(Kt*lr-1)),Er=Math.floor(.5*(Xt*lr-1)),_r=Et.tileCoordToPixel(Lt,Gt),Rr=2*hr+1,kr=2*Er+1,Lr=function(vs,ws,xs,ys,os){return[vs.getElevationAtPixel(ws,xs,!0),vs.getElevationAtPixel(ws+os,xs,!0),vs.getElevationAtPixel(ws,xs+os,!0),vs.getElevationAtPixel(ws+ys,xs+os,!0)]}(Et,_r.x-hr,_r.y-Er,Rr,kr),is=Math.abs(Lr[0]-Lr[1]),Br=Math.abs(Lr[2]-Lr[3]),as=Math.abs(Lr[0]-Lr[2])+Math.abs(Lr[1]-Lr[3]),ds=Math.min(.25,.5*lr*(is+Br)/Rr),fs=Math.min(.25,.5*lr*as/kr);return nr+Math.max(ds*Kt,fs*Xt)}($,it,at):ht;return{base:ht+(a===0?-1:a),top:ft?Math.max(xt+b,ht+a+2):ht+b}}class HP{constructor(s){this._callback=s,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class WP{constructor(){this.tasks={},this.taskQueue=[],Vr(["process"],this),this.invoker=new HP(this.process),this.nextId=0}add(s,a){const b=this.nextId++,$=function({type:it,isSymbolTile:st,zoom:at}){return at=at||0,it==="message"?0:it!=="maybePrepare"||st?it!=="parseTile"||st?it==="parseTile"&&st?300-at:it==="maybePrepare"&&st?400-at:500:200-at:100-at}(a);if($===0){try{s()}finally{}return null}return this.tasks[b]={fn:s,metadata:a,priority:$,id:b},this.taskQueue.push(b),this.invoker.trigger(),{cancel:()=>{delete this.tasks[b]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(b=>!!this.tasks[b]),!this.taskQueue.length)return;const s=this.pick();if(s===null)return;const a=this.tasks[s];if(delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let s=null,a=1/0;for(let $=0;$<this.taskQueue.length;$++){const it=this.tasks[this.taskQueue[$]];it.priority<a&&(a=it.priority,s=$)}if(s===null)return null;const b=this.taskQueue[s];return this.taskQueue.splice(s,1),b}remove(){this.invoker.remove()}}class cR{constructor(s,a,b){this.target=s,this.parent=a,this.mapId=b,this.callbacks={},this.cancelCallbacks={},Vr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new WP}send(s,a,b,$,it=!1,st){const at=Math.round(1e18*Math.random()).toString(36).substring(0,10);b&&(b.metadata=st,this.callbacks[at]=b);const ht=new Set;return this.target.postMessage({id:at,type:s,hasCallback:!!b,targetMapId:$,mustQueue:it,sourceMapId:this.mapId,data:tm(a,ht)},ht),{cancel:()=>{b&&delete this.callbacks[at],this.target.postMessage({id:at,type:"<cancel>",targetMapId:$,sourceMapId:this.mapId})}}}receive(s){const a=s.data;if(!a)return;const b=a.id;if(b&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const $=this.cancelCallbacks[b];delete this.cancelCallbacks[b],$&&$.cancel()}else if(a.mustQueue||Yn(self)){const $=this.callbacks[b],it=this.scheduler.add(()=>this.processTask(b,a),$&&$.metadata||{type:"message"});it&&(this.cancelCallbacks[b]=it)}else this.processTask(b,a)}processTask(s,a){if(delete this.cancelCallbacks[s],a.type==="<response>"){const b=this.callbacks[s];delete this.callbacks[s],b&&(a.error?b(Dm(a.error)):b(null,Dm(a.data)))}else{const b=new Set,$=a.hasCallback?(st,at)=>{this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:st?tm(st):null,data:tm(at,b)},b)}:()=>{},it=Dm(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,it,$);else if(this.parent.getWorkerSource){const st=a.type.split("."),{source:at,scope:ht}=it;this.parent.getWorkerSource(a.sourceMapId,st[0],at,ht)[st[1]](it,$)}else $(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var _1={workerUrl:"",workerClass:null,workerParams:void 0};const Z2="mapboxgl_preloaded_worker_pool";class Xy{constructor(s){this.active={},this.name=s}acquire(s,a=Xy.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;){const $=(b=`${this.name||""}WorkerPool: ${s}-${this.workers.length}`,_1.workerClass!=null?new _1.workerClass:new self.Worker(_1.workerUrl,Object.assign({name:b},_1.workerParams)));this.workers.push($)}var b;return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Z2]}numActive(){return Object.keys(this.active).length}}Xy.workerCount=2;class A_{constructor(s,a,b="Worker",$=Xy.workerCount){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=zr();const it=this.workerPool.acquire(this.id,$);for(let st=0;st<it.length;st++){const at=new A_.Actor(it[st],a,this.id);at.name=`${b} ${st}`,this.actors.push(at)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,a,b){Mr(this.actors,($,it)=>{$.send(s,a,it)},b=b||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}let v1,X2;function pE(){return v1||(v1=new Xy),v1}A_.Actor=cR;const K2=4096;class qP{constructor(s){this.module=s,this.memoryStack=this.module.malloc(K2),this.memoryStackNextFree=this.memoryStack}createIntArray(s){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=s.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>K2?-1:(new Int32Array(this.module.heap32.buffer,a,s.length).set(s),a)}createFloatArray(s){const a=this.memoryStackNextFree;return this.memoryStackNextFree+=s.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>K2?-1:(new Float32Array(this.module.heapF32.buffer,a,s.length).set(s),a)}readStringBuffer(s){let a="";for(;this.module.heapU8[s]!==0;)a+=String.fromCharCode(this.module.heapU8[s]),++s;return a}setStyle(s){const a=s.normalScale;this.module.setStyle(a[0],a[1],a[2],s.tileToMeters)}setAOOptions(s,a){this.module.setAOOptions(s?1:0,a)}setMetricOptions(s,a){this.module.setMetricOptions(s?1:0,a)}setStructuralOptions(s){this.module.setStructuralOptions(s?1:0)}setFacadeOptions(s,a){this.module.setFacadeOptions(s,a?1:0)}setFauxFacadeOptions(s,a,b){this.module.setFauxFacadeOptions(s?1:0,a?1:0,b)}setFacadeClassifierOptions(s){this.module.setFacadeClassifierOptions(s)}generateMesh(s,a){this.memoryStackNextFree=this.memoryStack;for(const at of s){const ht=this.createIntArray(at.ringIndices),ft=this.createFloatArray(at.coordinates);if(ht===-1||ft===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(at.id,at.sourceId,at.minHeight,at.height,at.roofType,ft,ht,at.ringIndices.length-1)}for(const at of a){let ht;ht=at.entrances?JSON.parse(at.entrances):[];const ft=this.createFloatArray(ht),xt=this.createFloatArray(at.coordinates);if(ft===-1||xt===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(at.sourceId,at.crossPerc,at.distanceToRoad,ft,ht.length,xt,at.coordinates.length)}if(!this.module.generateMesh()){const at=this.module.getLastError();return this.readStringBuffer(at)}const b=this.module.getMeshCount(),$=new Array(b);for(let at=0;at<b;at++){const ht=this.module.getPositionsPtr(at),ft=this.module.getPositionsLength(at),xt=new Float32Array(this.module.heapF32.buffer,ht,ft),Et=this.module.getNormalsPtr(at),Rt=this.module.getNormalsLength(at),Pt=new Float32Array(this.module.heapF32.buffer,Et,Rt),Lt=this.module.getAOPtr(at),Gt=this.module.getAOLength(at),Kt=new Float32Array(this.module.heapF32.buffer,Lt,Gt),Xt=this.module.getUVPtr(at),nr=this.module.getUVLength(at),lr=new Float32Array(this.module.heapF32.buffer,Xt,nr),hr=this.module.getFauxFacadePtr(at),Er=this.module.getFauxFacadeLength(at),_r=new Uint8Array(this.module.heapU8.buffer,hr,Er),Rr=this.module.getIndicesPtr(at),kr=this.module.getIndicesLength(at),Lr=new Int16Array(this.module.heap16.buffer,Rr,kr),is=this.module.getBuildingPart(at);$[at]={positions:xt,normals:Pt,ao:Kt,uv:lr,isFauxFacade:_r,indices:Lr,buildingPart:is}}const it=this.module.getRingCount(),st=[];for(let at=0;at<it;at++){const ht=this.module.getRingPtr(at),ft=this.module.getRingLength(at),xt=new Float32Array(this.module.heapF32.buffer,ht,ft);st.push(xt)}return{meshes:$,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:st}}}let b1,Y2,pm,j_,Q2,P_=null,I_=null,uR=null,mE=null;function hR(){return Yn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Y2||Gn.DRACO_URL}function dR(){if(Yn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(j_)return j_;const g=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return j_=WebAssembly.validate(g)?Gn.MESHOPT_SIMD_URL:Gn.MESHOPT_URL,j_}function ZP(){return mE}const gE={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},XP={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},w1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fR(g,s,a){const b=a.json.bufferViews.length,$=a.buffers.length;s.bufferView=b,a.json.bufferViews[b]={buffer:$,byteLength:g.byteLength},a.buffers[$]=g}const J2="KHR_draco_mesh_compression";function KP(g,s){const a=g.extensions&&g.extensions[J2];if(!a)return;const b=new pm.Decoder,$=xR(s,a.bufferView),it=new pm.Mesh;if(!b.DecodeArrayToMesh($,$.byteLength,it))throw new Error("Failed to decode Draco mesh");const st=s.json.accessors[g.indices],at=gE[st.componentType],ht=st.count*at.BYTES_PER_ELEMENT,ft=pm._malloc(ht);at===Uint16Array?b.GetTrianglesUInt16Array(it,ht,ft):b.GetTrianglesUInt32Array(it,ht,ft),fR(pm.memory.buffer.slice(ft,ft+ht),st,s),pm._free(ft);for(const xt of Object.keys(a.attributes)){const Et=b.GetAttributeByUniqueId(it,a.attributes[xt]),Rt=s.json.accessors[g.attributes[xt]],Pt=XP[Rt.componentType],Lt=Rt.count*w1[Rt.type]*gE[Rt.componentType].BYTES_PER_ELEMENT,Gt=pm._malloc(Lt);b.GetAttributeDataArrayForAllPoints(it,Et,pm[Pt],Lt,Gt),fR(pm.memory.buffer.slice(Gt,Gt+Lt),Rt,s),pm._free(Gt)}b.destroy(),it.destroy(),delete g.extensions[J2]}const xE="EXT_meshopt_compression";function YP(g,s){if(!g.extensions||!g.extensions[xE])return;const a=g.extensions[xE],b=new Uint8Array(s.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),$=new Uint8Array(a.count*a.byteStride);Q2.decodeGltfBuffer($,a.count,a.byteStride,b,a.mode,a.filter),g.buffer=s.buffers.length,g.byteOffset=0,s.buffers[g.buffer]=$.buffer,delete g.extensions[xE]}const pR=1179937895,mR=new TextDecoder("utf8");function gR(g,s){return new URL(g,s).href}function QP(g,s,a,b){return fetch(gR(g.uri,b)).then($=>$.arrayBuffer()).then($=>{s.buffers[a]=$})}function xR(g,s){const a=g.json.bufferViews[s];return new Uint8Array(g.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function JP(g,s,a,b){if(g.uri){const $=gR(g.uri,b);return fetch($).then(it=>it.blob()).then(it=>createImageBitmap(it)).then(it=>{s.images[a]=it})}if(g.bufferView!==void 0){const $=xR(s,g.bufferView),it=new Blob([$],{type:g.mimeType});return createImageBitmap(it).then(st=>{s.images[a]=st})}}function yR(g,s=0,a){const b={json:null,images:[],buffers:[]};if(new Uint32Array(g,s,1)[0]===pR){const xt=new Uint32Array(g,s);let Et=2;const Rt=(xt[Et++]>>2)-3,Pt=xt[Et++]>>2;if(Et++,b.json=JSON.parse(mR.decode(xt.subarray(Et,Et+Pt))),Et+=Pt,Et<Rt){const Lt=xt[Et++];Et++;const Gt=s+(Et<<2);b.buffers[0]=g.slice(Gt,Gt+Lt)}}else b.json=JSON.parse(mR.decode(new Uint8Array(g,s)));const{buffers:$,images:it,meshes:st,extensionsUsed:at,bufferViews:ht}=b.json;let ft=Promise.resolve();if($){const xt=[];for(let Et=0;Et<$.length;Et++){const Rt=$[Et];Rt.uri?xt.push(QP(Rt,b,Et,a)):b.buffers[Et]||(b.buffers[Et]=null)}ft=Promise.all(xt)}return ft.then(()=>{const xt=[],Et=at&&at.includes(J2),Rt=at&&at.includes(xE);if(Et&&xt.push(function(){if(!pm)return b1??(b1=function(Pt){let Lt,Gt=null;function Kt(){Lt=new Uint8Array(Gt.buffer)}function Xt(){throw new Error("Unexpected Draco error.")}const nr={a:{a:Xt,d:function(lr,hr,Er){return Lt.copyWithin(lr,hr,hr+Er)},c:function(lr){const hr=Lt.length,Er=Math.max(lr>>>0,Math.ceil(1.2*hr)),_r=Math.ceil((Er-hr)/65536);try{return Gt.grow(_r),Kt(),!0}catch{return!1}},b:Xt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(Pt,nr):Pt.then(lr=>lr.arrayBuffer()).then(lr=>WebAssembly.instantiate(lr,nr))).then(lr=>{const{Rb:hr,Qb:Er,P:_r,T:Rr,X:kr,Ja:Lr,La:is,Qa:Br,Va:as,Wa:ds,eb:fs,jb:vs,f:ws,e:xs,yb:ys,zb:os,Ab:ss,Bb:_s,Db:Is,Gb:Rs}=lr.instance.exports;Gt=xs;const rn=(()=>{let zs=0,Hs=0,Ys=0,zn=0;return Cs=>{Ys&&(hr(zn),hr(zs),Hs+=Ys,Ys=zs=0),zs||(Hs+=128,zs=Er(Hs));const Qs=Cs.length+7&-8;let vn=zs;Qs>=Hs&&(Ys=Qs,vn=zn=Er(Qs));for(let Wn=0;Wn<Cs.length;Wn++)Lt[vn+Wn]=Cs[Wn];return vn}})();return Kt(),ws(),{memory:xs,_free:hr,_malloc:Er,Mesh:class{constructor(){this.ptr=_r()}destroy(){Rr(this.ptr)}},Decoder:class{constructor(){this.ptr=Lr()}destroy(){vs(this.ptr)}DecodeArrayToMesh(zs,Hs,Ys){const zn=rn(zs),Cs=is(this.ptr,zn,Hs,Ys.ptr);return!!kr(Cs)}GetAttributeByUniqueId(zs,Hs){return{ptr:Br(this.ptr,zs.ptr,Hs)}}GetTrianglesUInt16Array(zs,Hs,Ys){as(this.ptr,zs.ptr,Hs,Ys)}GetTrianglesUInt32Array(zs,Hs,Ys){ds(this.ptr,zs.ptr,Hs,Ys)}GetAttributeDataArrayForAllPoints(zs,Hs,Ys,zn,Cs){fs(this.ptr,zs.ptr,Hs.ptr,Ys,zn,Cs)}},DT_INT8:ys(),DT_UINT8:os(),DT_INT16:ss(),DT_UINT16:_s(),DT_UINT32:Is(),DT_FLOAT32:Rs()}})}(fetch(hR())),b1.then(Pt=>{pm=Pt,b1=void 0}))}()),Rt&&xt.push(function(){if(Q2)return;const Pt=function(Lt){let Gt;const Kt=WebAssembly.instantiateStreaming(Lt,{}).then(lr=>{Gt=lr.instance,Gt.exports.__wasm_call_ctors()}),Xt={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},nr={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Kt,supported:!0,decodeGltfBuffer(lr,hr,Er,_r,Rr,kr){(function(Lr,is,Br,as,ds,fs,vs){const ws=Lr.exports.sbrk,xs=as+3&-4,ys=ws(xs*ds),os=ws(fs.length),ss=new Uint8Array(Lr.exports.memory.buffer);ss.set(fs,os);const _s=is(ys,as,ds,os,fs.length);if(_s===0&&vs&&vs(ys,xs,ds),Br.set(ss.subarray(ys,ys+as*ds)),ws(ys-ws(0)),_s!==0)throw new Error(`Malformed buffer data: ${_s}`)})(Gt,Gt.exports[nr[Rr]],lr,hr,Er,_r,Gt.exports[Xt[kr]])}}}(fetch(dR()));return Pt.ready.then(()=>{Q2=Pt})}()),it)for(let Pt=0;Pt<it.length;Pt++)xt.push(JP(it[Pt],b,Pt,a));return(xt.length?Promise.all(xt):Promise.resolve()).then(()=>{if(Et&&st)for(const{primitives:Pt}of st)for(const Lt of Pt)KP(Lt,b);if(Rt&&st&&ht)for(const Pt of ht)YP(Pt,b);return b})})}function _R(g){return fetch(g).then(s=>s.arrayBuffer()).then(s=>yR(s,0,g))}function eS(g){switch(g){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function tS(g){switch(g){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class rS{constructor(s,a,b,$){this.context=s,this.format=b,this.useMipmap=$&&$.useMipmap,this.texture=s.gl.createTexture(),this.update(a,{premultiply:$&&$.premultiply})}update(s,a){const b=s&&s instanceof HTMLVideoElement&&s.width===0?s.videoWidth:s.width,$=s&&s instanceof HTMLVideoElement&&s.height===0?s.videoHeight:s.height,{context:it}=this,{gl:st}=it,{x:at,y:ht}=a&&a.position?a.position:{x:0,y:0},ft=at+b,xt=ht+$;!this.size||this.size[0]===ft&&this.size[1]===xt||(st.bindTexture(st.TEXTURE_2D,null),st.deleteTexture(this.texture),this.texture=st.createTexture(),this.size=null),st.bindTexture(st.TEXTURE_2D,this.texture),it.pixelStoreUnpackFlipY.set(!1),it.pixelStoreUnpack.set(1),it.pixelStoreUnpackPremultiplyAlpha.set(this.format===st.RGBA8&&(!a||a.premultiply!==!1));const Et=s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||ImageBitmap&&s instanceof ImageBitmap;if(!this.size&&ft>0&&xt>0){const Rt=this.useMipmap?Math.floor(Math.log2(Math.max(ft,xt)))+1:1;st.texStorage2D(st.TEXTURE_2D,Rt,this.format,ft,xt),this.size=[ft,xt]}this.size&&(Et?st.texSubImage2D(st.TEXTURE_2D,0,at,ht,eS(this.format),tS(this.format),s):"data"in s&&s.data&&st.texSubImage2D(st.TEXTURE_2D,0,at,ht,b,$,eS(this.format),tS(this.format),s.data)),this.useMipmap&&st.generateMipmap(st.TEXTURE_2D)}bind(s,a,b=!1){const{context:$}=this,{gl:it}=$;it.bindTexture(it.TEXTURE_2D,this.texture),s!==this.minFilter&&(it.texParameteri(it.TEXTURE_2D,it.TEXTURE_MAG_FILTER,s),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_MIN_FILTER,this.useMipmap&&!b?s===it.NEAREST?it.NEAREST_MIPMAP_NEAREST:it.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),a!==this.wrapS&&(it.texParameteri(it.TEXTURE_2D,it.TEXTURE_WRAP_S,a),it.texParameteri(it.TEXTURE_2D,it.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(s,a,b,$,it){const{context:st}=this,{gl:at}=st;at.bindTexture(at.TEXTURE_2D,this.texture),a!==this.magFilter&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MAG_FILTER,a),this.magFilter=a),s!==this.minFilter&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_MIN_FILTER,this.useMipmap?s===at.NEAREST?at.NEAREST_MIPMAP_NEAREST:at.LINEAR_MIPMAP_LINEAR:s),this.minFilter=s),b!==this.wrapS&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_S,b),this.wrapS=b),$!==this.wrapT&&(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_WRAP_T,$),this.wrapT=$),it!==this.compareMode&&(it?(at.texParameteri(at.TEXTURE_2D,at.TEXTURE_COMPARE_MODE,at.COMPARE_REF_TO_TEXTURE),at.texParameteri(at.TEXTURE_2D,at.TEXTURE_COMPARE_FUNC,it)):at.texParameteri(at.TEXTURE_2D,at.TEXTURE_COMPARE_MODE,at.NONE),this.compareMode=it)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}class E1{constructor(s,a){this.context=s,this.texture=a}bind(s,a){const{context:b}=this,{gl:$}=b;$.bindTexture($.TEXTURE_2D,this.texture),s!==this.minFilter&&($.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,s),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,s),this.minFilter=s),a!==this.wrapS&&($.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,a),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,a),this.wrapS=a)}}const eI=Vn([{name:"a_pos_3f",components:3,type:"Float32"}]),tI=Vn([{name:"a_color_3f",components:3,type:"Float32"}]),rI=Vn([{name:"a_color_4f",components:4,type:"Float32"}]),iI=Vn([{name:"a_uv_2f",components:2,type:"Float32"}]),sI=Vn([{name:"a_normal_3f",components:3,type:"Float32"}]),nI=Vn([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),oI=Vn([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function vR(g,s){const a=yE(g.projection,g.zoom,g.width,g.height),b=function(it,st,at,ht,ft){const xt=new _(at.lng-180*Kx,at.lat),Et=new _(at.lng+180*Kx,at.lat),Rt=it.project(xt.lng,xt.lat),Pt=it.project(Et.lng,Et.lat),Lt=-Math.atan2(Pt.y-Rt.y,Pt.x-Rt.x),Gt=cr.fromLngLat(at);Gt.y=Qt(Gt.y,-1+Kx,1-Kx);const Kt=Gt.toLngLat(),Xt=it.project(Kt.lng,Kt.lat),nr=cr.fromLngLat(Kt);nr.x+=Kx;const lr=nr.toLngLat(),hr=it.project(lr.lng,lr.lat),Er=wR(hr.x-Xt.x,hr.y-Xt.y,Lt),_r=cr.fromLngLat(Kt);_r.y+=Kx;const Rr=_r.toLngLat(),kr=it.project(Rr.lng,Rr.lat),Lr=wR(kr.x-Xt.x,kr.y-Xt.y,Lt),is=Math.abs(Er.x)/Math.abs(Lr.y),Br=Jt([]);dr(Br,Br,-Lt*(1-(ft?0:ht)));const as=Jt([]);return Ht(as,as,[1,1-(1-is)*ht,1]),as[4]=-Lr.x/Lr.y*ht,dr(as,as,Lt),It(as,Br,as),as}(g.projection,0,g.center,a,s),$=bR(g);return Ht(b,b,[$,$,1]),b}function bR(g){const s=g.projection,a=yE(g.projection,g.zoom,g.width,g.height),b=iS(s,g.center),$=iS(s,_.convert(s.center));return Math.pow(2,b*a+(1-a)*$)}function yE(g,s,a,b,$=1/0){const it=g.range;if(!it)return 0;const st=Math.min($,Math.max(a,b)),at=Math.log2(st/1024);return or(it[0]+at,it[1]+at,s)}const Kx=1/4e4;function iS(g,s){const a=Qt(s.lat,-$t,$t),b=new _(s.lng-180*Kx,a),$=new _(s.lng+180*Kx,a),it=g.project(b.lng,a),st=g.project($.lng,a),at=cr.fromLngLat(b),ht=cr.fromLngLat($),ft=st.x-it.x,xt=st.y-it.y,Et=ht.x-at.x,Rt=ht.y-at.y,Pt=Math.sqrt((Et*Et+Rt*Rt)/(ft*ft+xt*xt));return Math.log2(Pt)}function wR(g,s,a){const b=Math.cos(a),$=Math.sin(a);return{x:g*b-s*$,y:g*$+s*b}}function ER(g,s,a){Jt(g),dr(g,g,wn(s[2])),tr(g,g,wn(s[0])),er(g,g,wn(s[1])),Ht(g,g,a),It(g,g,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function _E(g,s,a,b,$,it,st,at){const ht=[a[0]-s[0],a[1]-s[1],0],ft=[b[0]-s[0],b[1]-s[1],0];if(Kr(ht)<1e-12||Kr(ft)<1e-12)return to(g);const xt=qr([],ht,ft);Cn(xt,xt),ar(ft,b,s),ht[2]=(it-$)*at,ft[2]=(st-$)*at;const Et=ht;return qr(Et,ht,ft),Cn(Et,Et),vu(g,xt,Et)}function vE(g,s,a=!1){const b=Zx(s.zoom),$=function(it,st,at){const ht=st.worldSize,ft=[it[12],it[13],it[14]],xt=Ut(ft[1]/ht),Et=Ct(ft[0]/ht),Rt=Jt([]),Pt=Tt(1,xt)*ht,Lt=Tt(1,0)*ht*qt(xt,st.zoom),Gt=1/k2(ht);let Kt=Lt*Gt;if(at){const hr=yE(st.projection,st.zoom,st.width,st.height,1024);Kt=Gt*st.projection.pixelSpaceConversion(st.center.lat,ht,hr)}const Xt=Hx(xt,Et);rr(Xt,Xt,us([],Cn([],Xt),Pt*Kt*ft[2]));const nr=function(hr){const Er=[hr[0],hr[1],hr[2]];let _r=[0,1,0];const Rr=qr([],_r,Er);return qr(_r,Er,Rr),_n(_r)===0&&(_r=[0,1,0],qr(Rr,Er,_r)),Cn(Rr,Rr),Cn(_r,_r),Cn(Er,Er),[Rr[0],Rr[1],Rr[2],0,_r[0],_r[1],_r[2],0,Er[0],Er[1],Er[2],0,hr[0],hr[1],hr[2],1]}(Xt);Ht(Rt,Rt,[Kt,Kt,Kt*Pt]),Mt(Rt,Rt,[-ft[0],-ft[1],-ft[2]]);const lr=It([],st.globeMatrix,nr);return It(lr,lr,Rt),It(lr,lr,it),lr}(g,s,a);if(b>0){const it=function(st,at){const ht=at.worldSize,ft=Tt(1,0)*ht*qt(at.center.lat,at.zoom)/k2(ht),xt=Tt(1,at.center.lat)*ht,Et=Jt([]);er(Et,Et,wn(at.center.lng)),tr(Et,Et,wn(at.center.lat)),Mt(Et,Et,[0,0,Eu]),Ht(Et,Et,[ft,ft,ft*xt]);const Rt=at.point;return Mt(Et,Et,[-Rt.x,-Rt.y,0]),It(Et,Et,st),It(Et,at.globeMatrix,Et)}(g,s);return function(st,at,ht){const ft=(Lt,Gt,Kt)=>{const Xt=Kr(Lt),nr=Kr(Gt),lr=fm(Lt,Gt,Kt);return us(lr,lr,1/Kr(lr)*pn(Xt,nr,Kt))},xt=ft([st[0],st[1],st[2]],[at[0],at[1],at[2]],ht),Et=ft([st[4],st[5],st[6]],[at[4],at[5],at[6]],ht),Rt=ft([st[8],st[9],st[10]],[at[8],at[9],at[10]],ht),Pt=fm([st[12],st[13],st[14]],[at[12],at[13],at[14]],ht);return[xt[0],xt[1],xt[2],0,Et[0],Et[1],Et[2],0,Rt[0],Rt[1],Rt[2],0,Pt[0],Pt[1],Pt[2],1]}($,it,b)}return $}function sS(g,s,a,b){const $=en.projectAabbCorners(b,a);let it=Number.MAX_VALUE;for(let at=0;at<$.length;++at){const ht=$[at];ht[0]=(.5*ht[0]+.5)*s.width,ht[1]=(.5-.5*ht[1])*s.height,ht[2]<it&&(it=ht[2])}const st=function(at){const ht=[];let ft=0;for(let Pt=1;Pt<at.length;Pt++)(at[Pt][0]<at[ft][0]||at[Pt][0]===at[ft][0]&&at[Pt][1]<at[ft][1])&&(ft=Pt);let xt,Et=ft;const Rt=new Uint8Array(at.length);do{if(Rt[Et])break;ht.push(new ps(at[Et][0],at[Et][1])),Rt[Et]=1,xt=(Et+1)%at.length;for(let Pt=0;Pt<at.length;Pt++){if(at[Pt][0]===at[xt][0]&&at[Pt][1]===at[xt][1]||at[Pt][0]===at[Et][0]&&at[Pt][1]===at[Et][1])continue;const Lt=[at[Pt][0]-at[Et][0],at[Pt][1]-at[Et][1]],Gt=[at[xt][0]-at[Et][0],at[xt][1]-at[Et][1]],Kt=Lt[0]*Gt[1]-Lt[1]*Gt[0];(Kt>0||Kt===0&&Lt[0]*Gt[0]+Lt[1]*Gt[1]>=0&&Lt[0]*Lt[0]+Lt[1]*Lt[1]>Gt[0]*Gt[0]+Gt[1]*Gt[1])&&(xt=Pt)}Et=xt}while(Et!==ft);return ht.length>0&&ht.push(ht[0]),ht}($);if(no(g,st))return it}const Ky=64,k_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function bE(g,s,a,b,$,it,st,at,ht,ft=!1){const xt=a.zoom,Et=a.project(b),Rt=qt(b.lat,xt),Pt=1/Rt;Jt(g),Mt(g,g,[Et.x+st[0]*Pt,Et.y+st[1]*Pt,st[2]]);let Lt=1,Gt=1;const Kt=a.worldSize;if(ft){if(a.projection.name==="mercator"){let hr=0;a.elevation&&(hr=a.elevation.getAtPointOrZero(new cr(Et.x/Kt,Et.y/Kt),0));const Er=uo([],[Et.x,Et.y,hr,1],a.projMatrix)[3]/a.cameraToCenterDistance;Lt=Er,Gt=Er*qt(a.center.lat,xt)}else if(a.projection.name==="globe"){const hr=vE(g,a),Er=[0,0,0,1];uo(Er,Er,It([],a.projMatrix,hr));const _r=Er[3]/a.cameraToCenterDistance,Rr=Zx(xt),kr=a.projection.pixelsPerMeter(b.lat,Kt)*qt(b.lat,xt),Lr=a.projection.pixelsPerMeter(a.center.lat,Kt)*qt(a.center.lat,xt);Lt=_r/pn(kr,Zt(a.center.lat),Rr),Gt=_r*Rt/kr,Lt*=Lr,Gt*=Lr}}else Lt=Pt;Ht(g,g,[Lt,Lt,Gt]);const Xt=[...g],nr=s.orientation,lr=[];if(ER(lr,[nr[0]+($?$[0]:0),nr[1]+($?$[1]:0),nr[2]+($?$[2]:0)],it),It(g,Xt,lr),at&&a.elevation){let hr=0;const Er=[];if(ht&&a.elevation){hr=function(Rr,kr,Lr,is,Br){const as=kr.elevation;if(!as)return 0;const ds=en.projectAabbCorners(Lr,is),fs=Tt(1,Br.lat)*kr.worldSize,vs=function(Hs,Ys){const zn=[0,0,1],Cs=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Qs of Cs){const vn=Hs[Qs.corners[0]],Wn=Hs[Qs.corners[1]],Xn=Hs[Qs.corners[2]],Rn=[Wn[0]-vn[0],Wn[1]-vn[1],Ys*(Wn[2]-vn[2])],Co=qr(Rn,Rn,[Xn[0]-vn[0],Xn[1]-vn[1],Ys*(Xn[2]-vn[2])]);Cn(Co,Co),Qs.dotProductWithUp=On(Co,zn)}return Cs.sort((Qs,vn)=>Qs.dotProductWithUp-vn.dotProductWithUp),Cs[0].corners}(ds,fs),ws=ds[vs[0]],xs=ds[vs[1]],ys=ds[vs[2]],os=ds[vs[3]],ss=as.getAtPointOrZero(new cr(ws[0]/kr.worldSize,ws[1]/kr.worldSize),0),_s=as.getAtPointOrZero(new cr(xs[0]/kr.worldSize,xs[1]/kr.worldSize),0),Is=as.getAtPointOrZero(new cr(ys[0]/kr.worldSize,ys[1]/kr.worldSize),0),Rs=as.getAtPointOrZero(new cr(os[0]/kr.worldSize,os[1]/kr.worldSize),0),rn=(ss+Rs)/2,zs=(_s+Is)/2;return rn>zs?_s<Is?_E(Rr,xs,os,ws,_s,Rs,ss,fs):_E(Rr,ys,ws,os,Is,ss,Rs,fs):ss<Rs?_E(Rr,ws,xs,ys,ss,_s,Is,fs):_E(Rr,os,ys,xs,Rs,Is,_s,fs),Math.max(rn,zs)}(Er,a,s.aabb,g,b);const _r=It([],Yr([],Er),lr);It(g,Xt,_r)}else hr=a.elevation.getAtPointOrZero(new cr(Et.x/Kt,Et.y/Kt),0);hr!==0&&(g[14]+=hr)}}class SR{constructor(s,a,b,$,it){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=s,this.uri=a,this.position=b!=null?new _(b[0],b[1]):new _(0,0),this.orientation=$??[0,0,0],this.nodes=it,this.uploaded=!1,this.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,a){It(s.globalMatrix,a,s.localMatrix);const b=this.nodeOverrides.get(s.name);if(b!==void 0){const st=[];it=b.orientation,Jt($=st),er($,$,wn(it[1])),dr($,$,wn(it[2])),tr($,$,wn(it[0])),It(s.globalMatrix,s.globalMatrix,st)}var $,it;if(s.meshes)for(const st of s.meshes){const at=en.applyTransformFast(st.aabb,s.globalMatrix);this.aabb.encapsulate(at)}if(s.children)for(const st of s.children)this._applyTransformations(st,s.globalMatrix)}computeBoundsAndApplyParent(){const s=Jt([]);this.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.nodes)this._applyTransformations(a,s)}computeModelMatrix(s,a,b,$,it,st,at=!1){bE(this.matrix,this,s.transform,this.position,a,b,$,it,st,at)}upload(s){if(!this.uploaded){for(const a of this.nodes)nS(a,s);for(const a of this.nodes)wE(a);this.uploaded=!0}}destroy(){for(const s of this.nodes)oS(s)}}function S1(g,s,a=!1){g.uploaded||(g.gfxTexture=new rS(s,g.image,a?s.gl.R8:s.gl.RGBA8,{useMipmap:g.sampler.minFilter>=s.gl.NEAREST_MIPMAP_NEAREST}),g.uploaded=!0,g.image=null)}function aI(g,s,a){g.indexBuffer=s.createIndexBuffer(g.indexArray,!1,!0),g.vertexBuffer=s.createVertexBuffer(g.vertexArray,eI.members,!1,!0),g.normalArray&&(g.normalBuffer=s.createVertexBuffer(g.normalArray,sI.members,!1,!0)),g.texcoordArray&&(g.texcoordBuffer=s.createVertexBuffer(g.texcoordArray,iI.members,!1,!0)),g.colorArray&&(g.colorBuffer=s.createVertexBuffer(g.colorArray,(g.colorArray.bytesPerElement===12?tI:rI).members,!1,!0)),g.featureArray&&(g.pbrBuffer=s.createVertexBuffer(g.featureArray,oI.members,!0)),g.segments=ga.simpleSegment(0,0,g.vertexArray.length,g.indexArray.length);const b=g.material;b.pbrMetallicRoughness.baseColorTexture&&S1(b.pbrMetallicRoughness.baseColorTexture,s),b.pbrMetallicRoughness.metallicRoughnessTexture&&S1(b.pbrMetallicRoughness.metallicRoughnessTexture,s),b.normalTexture&&S1(b.normalTexture,s),b.occlusionTexture&&S1(b.occlusionTexture,s,a),b.emissionTexture&&S1(b.emissionTexture,s)}function nS(g,s,a){if(g.meshes)for(const b of g.meshes)aI(b,s,a);if(g.children)for(const b of g.children)nS(b,s,a)}function wE(g){if(g.meshes)for(const s of g.meshes)s.indexArray.destroy(),s.vertexArray.destroy(),s.colorArray&&s.colorArray.destroy(),s.normalArray&&s.normalArray.destroy(),s.texcoordArray&&s.texcoordArray.destroy(),s.featureArray&&s.featureArray.destroy();if(g.children)for(const s of g.children)wE(s)}function oS(g){if(g.meshes)for(const a of g.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((s=a.material).pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()));var s;if(g.children)for(const a of g.children)oS(a)}function Yy(g,s){const a=g.json.bufferViews[s.bufferView],b=gE[s.componentType];return new b(g.buffers[a.buffer],(s.byteOffset||0)+(a.byteOffset||0),s.count*(a.byteStride&&a.byteStride!==w1[s.type]*b.BYTES_PER_ELEMENT?a.byteStride/b.BYTES_PER_ELEMENT:w1[s.type]))}function aS(g,s,a,b){const $=gE[s.componentType],it=function(xt){switch(xt){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}($),st=g.json.bufferViews[s.bufferView],at=st.byteStride?st.byteStride/$.BYTES_PER_ELEMENT:w1[s.type],ht=a.float32,ft=ht.length/a.capacity;for(let xt=0,Et=0;xt<s.count*at;xt+=at,Et+=ft)for(let Rt=0;Rt<ft;Rt++)ht[Et+Rt]=b[xt+Rt]*it;a._trim()}function lI(g,s,a){const b=g.indices,$=g.attributes,it={};it.indexArray=new Zl;const st=s.json.accessors[b],at=st.count/3;it.indexArray.reserve(at);const ht=Yy(s,st);for(let Rt=0;Rt<at;Rt++)it.indexArray.emplaceBack(ht[3*Rt],ht[3*Rt+1],ht[3*Rt+2]);it.indexArray._trim(),it.vertexArray=new ep;const ft=s.json.accessors[$.POSITION];it.vertexArray.reserve(ft.count);const xt=Yy(s,ft);for(let Rt=0;Rt<ft.count;Rt++)it.vertexArray.emplaceBack(xt[3*Rt],xt[3*Rt+1],xt[3*Rt+2]);if(it.vertexArray._trim(),it.aabb=new en(ft.min,ft.max),it.centroid=function(Rt,Pt){const Lt=[0,0,0],Gt=Rt.length;if(Gt>0){for(let Kt=0;Kt<Gt;Kt++){const Xt=3*Rt[Kt];Lt[0]+=Pt[Xt],Lt[1]+=Pt[Xt+1],Lt[2]+=Pt[Xt+2]}Lt[0]/=Gt,Lt[1]/=Gt,Lt[2]/=Gt}return Lt}(ht,xt),$.COLOR_0!==void 0){const Rt=s.json.accessors[$.COLOR_0],Pt=w1[Rt.type],Lt=Yy(s,Rt);it.colorArray=Pt===3?new ep:new zm,it.colorArray.resize(Rt.count),aS(s,Rt,it.colorArray,Lt)}if($.NORMAL!==void 0){it.normalArray=new ep;const Rt=s.json.accessors[$.NORMAL];it.normalArray.resize(Rt.count);const Pt=Yy(s,Rt);aS(s,Rt,it.normalArray,Pt)}if($.TEXCOORD_0!==void 0&&a.length>0){it.texcoordArray=new Gp;const Rt=s.json.accessors[$.TEXCOORD_0];it.texcoordArray.resize(Rt.count);const Pt=Yy(s,Rt);aS(s,Rt,it.texcoordArray,Pt)}if($._FEATURE_ID_RGBA4444!==void 0){const Rt=s.json.accessors[$._FEATURE_ID_RGBA4444];s.json.extensionsUsed&&s.json.extensionsUsed.includes("EXT_meshopt_compression")&&(it.featureData=Yy(s,Rt))}$._FEATURE_RGBA4444!==void 0&&(it.featureData=new Uint32Array(Yy(s,s.json.accessors[$._FEATURE_RGBA4444]).buffer));const Et=g.material;return it.material=function(Rt,Pt){const{emissiveFactor:Lt=[0,0,0],alphaMode:Gt="OPAQUE",alphaCutoff:Kt=.5,normalTexture:Xt,occlusionTexture:nr,emissiveTexture:lr,doubleSided:hr,name:Er}=Rt,{baseColorFactor:_r=[1,1,1,1],metallicFactor:Rr=1,roughnessFactor:kr=1,baseColorTexture:Lr,metallicRoughnessTexture:is}=Rt.pbrMetallicRoughness||{},Br=nr?Pt[nr.index]:void 0;if(nr&&nr.extensions&&nr.extensions.KHR_texture_transform&&Br){const as=nr.extensions.KHR_texture_transform;Br.offsetScale=[as.offset[0],as.offset[1],as.scale[0],as.scale[1]]}return{name:Er,pbrMetallicRoughness:{baseColorFactor:new vo(..._r),metallicFactor:Rr,roughnessFactor:kr,baseColorTexture:Lr?Pt[Lr.index]:void 0,metallicRoughnessTexture:is?Pt[is.index]:void 0},doubleSided:hr,emissiveFactor:new vo(...Lt),alphaMode:Gt,alphaCutoff:Kt,normalTexture:Xt?Pt[Xt.index]:void 0,occlusionTexture:Br,emissionTexture:lr?Pt[lr.index]:void 0,defined:Rt.defined===void 0}}(Et!==void 0?s.json.materials[Et]:{defined:!1},a),it}function TR(g,s,a){const{matrix:b,rotation:$,translation:it,scale:st,mesh:at,extras:ht,children:ft,name:xt}=g,Et={};if(Et.name=xt,Et.localMatrix=b||function(Rt,Pt,Lt,Gt){var Kt=Pt[0],Xt=Pt[1],nr=Pt[2],lr=Pt[3],hr=Kt+Kt,Er=Xt+Xt,_r=nr+nr,Rr=Kt*hr,kr=Kt*Er,Lr=Kt*_r,is=Xt*Er,Br=Xt*_r,as=nr*_r,ds=lr*hr,fs=lr*Er,vs=lr*_r,ws=Gt[0],xs=Gt[1],ys=Gt[2];return Rt[0]=(1-(is+as))*ws,Rt[1]=(kr+vs)*ws,Rt[2]=(Lr-fs)*ws,Rt[3]=0,Rt[4]=(kr-vs)*xs,Rt[5]=(1-(Rr+as))*xs,Rt[6]=(Br+ds)*xs,Rt[7]=0,Rt[8]=(Lr+fs)*ys,Rt[9]=(Br-ds)*ys,Rt[10]=(1-(Rr+is))*ys,Rt[11]=0,Rt[12]=Lt[0],Rt[13]=Lt[1],Rt[14]=Lt[2],Rt[15]=1,Rt}([],$||[0,0,0,1],it||[0,0,0],st||[1,1,1]),Et.globalMatrix=zt(Et.localMatrix),at!==void 0){Et.meshes=a[at];const Rt=Et.anchor=[0,0];for(const Pt of Et.meshes){const{min:Lt,max:Gt}=Pt.aabb;Rt[0]+=Lt[0]+Gt[0],Rt[1]+=Lt[1]+Gt[1]}Rt[0]=Math.floor(Rt[0]/Et.meshes.length/2),Rt[1]=Math.floor(Rt[1]/Et.meshes.length/2)}if(ht&&(ht.id&&(Et.id=ht.id),ht.lights&&(Et.lights=function(Rt){if(!Rt.length)return[];const Pt=function(nr){const lr=atob(nr),hr=new Uint8Array(lr.length);for(let Er=0;Er<lr.length;Er++)hr[Er]=lr.codePointAt(Er);return hr}(Rt),Lt=[],Gt=Pt.length/24,Kt=new Uint16Array(Pt.buffer),Xt=new Float32Array(Pt.buffer);for(let nr=0;nr<Gt;nr++){const lr=Kt[2*nr*6]/30,hr=Kt[2*nr*6+1]/30,Er=Kt[2*nr*6+10]/100,_r=Xt[6*nr+1],Rr=Xt[6*nr+2],kr=Xt[6*nr+3],Lr=Xt[6*nr+4],is=kr-_r,Br=Lr-Rr,as=Math.hypot(is,Br);Lt.push({pos:[_r+.5*is,Rr+.5*Br,hr],normal:[Br/as,-is/as,0],width:as,height:lr,depth:Er,points:[_r,Rr,kr,Lr]})}return Lt}(ht.lights)),ht.MAPBOX_geometry_bloom&&(Et.isGeometryBloom=ht.MAPBOX_geometry_bloom)),ft){const Rt=[];for(const Pt of ft)Rt.push(TR(s.json.nodes[Pt],s,a));Et.children=Rt}return Et}function cI(g){if(g.vertices.length===0||g.indices.length===0)return null;const s=new lE(g.vertices,g.indices,8,256),[a,b]=[s.min.clone(),s.max.clone()];return{vertices:g.vertices,indices:g.indices,grid:s,min:a,max:b}}function uI(g){if(!g.extras||!g.extras.ground)return null;const s=g.extras.ground;if(!s||!Array.isArray(s)||s.length===0)return null;const a=s[0];if(!a||!Array.isArray(a)||a.length===0)return null;const b=[];for(const st of a){if(!Array.isArray(st)||st.length!==2)continue;const at=st[0],ht=st[1];typeof at=="number"&&typeof ht=="number"&&b.push(new ps(at,ht))}if(b.length<3)return null;b.length>1&&b[b.length-1].equals(b[0])&&b.pop();let $=0;for(let st=0;st<b.length;st++){const at=b[st],ht=b[(st+1)%b.length],ft=b[(st+2)%b.length];$+=(at.x-ht.x)*(ft.y-ht.y)-(ft.x-ht.x)*(at.y-ht.y)}$>0&&b.reverse();const it=R_(b.flatMap(st=>[st.x,st.y]),[]);return it.length===0?null:{vertices:b,indices:it}}function hI(g,s){const a=[],b=[];let $=0;const it=[];for(const st of g){$=a.length;const at=st.vertexArray.float32,ht=st.indexArray.uint16;for(let ft=0;ft<st.vertexArray.length;ft++)it[0]=at[3*ft+0],it[1]=at[3*ft+1],it[2]=at[3*ft+2],Os(it,it,s),a.push(new ps(it[0],it[1]));for(let ft=0;ft<3*st.indexArray.length;ft++)b.push(ht[ft]+$)}if(b.length%3!=0)return null;for(let st=0;st<b.length;st+=3){const at=a[b[st+0]],ht=a[b[st+1]],ft=a[b[st+2]];(at.x-ht.x)*(ft.y-ht.y)-(ft.x-ht.x)*(at.y-ht.y)>0&&([b[st+1],b[st+2]]=[b[st+2],b[st+1]])}return{vertices:a,indices:b}}function lS(g){const s=function(ht,ft){const xt=[],Et=WebGL2RenderingContext;if(ht.json.textures)for(const Rt of ht.json.textures){const Pt={magFilter:Et.LINEAR,minFilter:Et.NEAREST,wrapS:Et.REPEAT,wrapT:Et.REPEAT};Rt.sampler!==void 0&&Object.assign(Pt,ht.json.samplers[Rt.sampler]),xt.push({image:ft[Rt.source],sampler:Pt,uploaded:!1})}return xt}(g,g.images),a=function(ht,ft){const xt=[];for(const Et of ht.json.meshes){const Rt=[];for(const Pt of Et.primitives)Rt.push(lI(Pt,ht,ft));xt.push(Rt)}return xt}(g,s),{scenes:b,scene:$,nodes:it}=g.json,st=b?b[$||0].nodes:[...it.keys()],at=[];for(const ht of st)at.push(TR(it[ht],g,a));return function(ht,ft,xt){const Et={},Rt=new Set;for(let Pt=0;Pt<ht.length;Pt++){const Lt=xt[ft[Pt]];if(!Lt.extras)continue;const Gt=Lt.extras["mapbox:footprint:version"],Kt=Lt.extras["mapbox:footprint:id"];(Gt||Kt)&&Rt.add(Pt),Gt==="1.0.0"&&Kt&&(Et[Kt]=Pt)}for(let Pt=0;Pt<ht.length;Pt++){if(Rt.has(Pt))continue;const Lt=ht[Pt],Gt=xt[ft[Pt]];if(!Gt.extras)continue;let Kt=null;Lt.id in Et&&(Kt=hI(ht[Et[Lt.id]].meshes,Lt.localMatrix)),Kt||(Kt=uI(Gt)),Kt&&(Lt.footprint=cI(Kt))}if(Rt.size>0){const Pt=Array.from(Rt.values()).sort((Lt,Gt)=>Lt-Gt);for(let Lt=Pt.length-1;Lt>=0;Lt--)ht.splice(Pt[Lt],1)}}(at,st,g.json.nodes),at}function dI(g){g.heightmap=new Float32Array(4096),g.heightmap.fill(-1);const s=g.vertexArray.float32,a=g.aabb.min[0]-1,b=g.aabb.min[1]-1,$=Ky/(g.aabb.max[0]-a+2),it=Ky/(g.aabb.max[1]-b+2);for(let st=0;st<s.length;st+=3){const at=s[st+2],ht=(s[st+0]-a)*$|0,ft=(s[st+1]-b)*it|0;at>g.heightmap[ft*Ky+ht]&&(g.heightmap[ft*Ky+ht]=at)}}function RR(g,s,a,b,$){a.reserve(a.length+4*g.length),b.reserve(b.length+10*g.length),$.reserve($.length+10*g.length);let it=b.length;for(const st of g){const at=Math.min(10,Math.max(4,1.3*st.height))*s,ht=[-st.normal[1],st.normal[0],0],ft=Math.min(.29,.1*st.width/st.depth),xt=st.width-2*st.depth*s*(ft+.01),Et=Wr([],st.pos,ht,xt/2),Rt=Wr([],st.pos,ht,-xt/2),Pt=[Et[0],Et[1],Et[2]+st.height],Lt=[Rt[0],Rt[1],Rt[2]+st.height],Gt=Wr([],st.normal,ht,ft);us(Gt,Gt,at);const Kt=Wr([],st.normal,ht,-ft);us(Kt,Kt,at),rr(Gt,Et,Gt),rr(Kt,Rt,Kt),Et[2]+=.1,Rt[2]+=.1,b.emplaceBack(Gt[0],Gt[1],Gt[2]),b.emplaceBack(Kt[0],Kt[1],Kt[2]),b.emplaceBack(Et[0],Et[1],Et[2]),b.emplaceBack(Rt[0],Rt[1],Rt[2]),b.emplaceBack(Pt[0],Pt[1],Pt[2]),b.emplaceBack(Lt[0],Lt[1],Lt[2]),b.emplaceBack(Et[0],Et[1],Et[2]),b.emplaceBack(Rt[0],Rt[1],Rt[2]),b.emplaceBack(Gt[0],Gt[1],Gt[2]),b.emplaceBack(Kt[0],Kt[1],Kt[2]);const Xt=xt/at/2;$.emplaceBack(-Xt-ft,-1,Xt,.8),$.emplaceBack(Xt+ft,-1,Xt,.8),$.emplaceBack(-Xt,0,Xt,1.3),$.emplaceBack(Xt,0,Xt,1.3),$.emplaceBack(Xt+ft,-.8,Xt,.7),$.emplaceBack(Xt+ft,-.8,Xt,.7),$.emplaceBack(0,0,Xt,1.3),$.emplaceBack(0,0,Xt,1.3),$.emplaceBack(Xt+ft,-1.2,Xt,.8),$.emplaceBack(Xt+ft,-1.2,Xt,.8),a.emplaceBack(6+it,4+it,8+it),a.emplaceBack(7+it,9+it,5+it),a.emplaceBack(0+it,1+it,2+it),a.emplaceBack(1+it,3+it,2+it),it+=10}}function fI(g,s){const a={};a.indexArray=new Zl,a.vertexArray=new ep,a.colorArray=new zm,RR(g,s,a.indexArray,a.vertexArray,a.colorArray);const b={defined:!0};b.emissiveFactor=vo.black;const $={};return $.baseColorFactor=vo.white,b.pbrMetallicRoughness=$,a.material=b,a.aabb=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const CR=Vn([{name:"a_pos_3f",components:3,type:"Float32"}]),pI=Vn([{name:"a_normal_3",components:3,type:"Int16"}]),mI=Vn([{name:"a_centroid_3",components:3,type:"Int16"}]),AR=Vn([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),gI=Vn([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),xI=Vn([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yI=Vn([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),_I=Vn([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),vI=Vn([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),jR=Nr.types,EE=32767;function bI(g,s){const a=Ps+s;for(const b of g)for(const $ of b)if($.x<-s||$.x>a||$.y<-s||$.y>a)return!1;return!0}function wI(g){switch(g){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${g}`)}}class cS{constructor(){this.layoutVertexArray=new ep,this.layoutAttenuationArray=new zm,this.layoutColorArray=new tp,this.indexArray=new Zl,this.indexArrayForConflation=new Zl,this.segmentsBucket=new ga}}class uS{constructor(s){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new ga,this.entranceBloom=new cS;const a=66560;this.layoutVertexArray=new ep,this.layoutVertexArray.reserve(a),this.layoutNormalArray=new Ox,this.layoutNormalArray.reserve(a),this.layoutCentroidArray=new Ox,this.layoutCentroidArray.reserve(a),this.layoutColorArray=new tp,this.layoutColorArray.reserve(a),this.layoutFloodLightDataArray=new Om,this.layoutFloodLightDataArray.reserve(a),this.layoutAOArray=new p_,this.layoutAOArray.reserve(a),this.indexArray=new Zl,this.indexArray.reserve(66560),this.indexArrayForConflation=new Zl,this.segmentsBucket=new ga,this.entranceBloom=new cS,s&&(this.layoutFacadePaintArray=new tp,this.layoutFacadeDataArray=new hx,this.layoutFacadeVerticalRangeArray=new tp)}reserve(s,a,b){this.layoutVertexArray.reserveForAdditional(s),this.layoutCentroidArray.reserveForAdditional(s),this.layoutFloodLightDataArray.reserveForAdditional(s),this.layoutNormalArray.reserveForAdditional(s),this.layoutAOArray.reserveForAdditional(s),this.layoutColorArray.reserveForAdditional(s),this.indexArray.reserveForAdditional(a),b&&(this.layoutFacadePaintArray.reserveForAdditional(s),this.layoutFacadeDataArray.reserveForAdditional(s),this.layoutFacadeVerticalRangeArray.reserveForAdditional(s))}}class PR{constructor(s){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Gp,this.footprintsIndices=new Om,this.footprintsMin=new ps(1/0,1/0),this.footprintsMax=new ps(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new uS(!1),this.buildingWithFacade=new uS(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=s.zoom,this.canonical=s.canonical,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.hasPattern=!1,this.worldview=s.worldview,this.lut=s.lut,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=s.projection,this.groundEffect=new W2(s),this.groundEffect.groundRadiusArray=new om,this.hasAppearances=null}updateFootprints(s,a){const b=new lE([],[],1),$={vertices:[],indices:new Uint32Array(0),grid:b,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};a.push({footprint:$,id:s})}updateAppearances(s,a,b,$){}prepare(){return function(){if(mE!=null||uR!=null)return null;if(I_!=null)return I_;const s=fetch(Gn.BUILDING_GEN_URL);return I_=function(a){let b,$,it,st,at;function ht(){b=new Uint8Array(at.buffer),$=new Int16Array(at.buffer),it=new Int32Array(at.buffer),st=new Float32Array(at.buffer)}function ft(){throw new Error("Unexpected BuildingGen error.")}const xt=()=>{},Et={a:{a:ft,f:function(Rt){const Pt=b.length,Lt=Math.max(Rt>>>0,Math.ceil(1.2*Pt)),Gt=Math.ceil((Lt-Pt)/65536);try{return at.grow(Gt),ht(),!0}catch{return!1}},g:ft,b:xt,c:xt,d:xt,e:xt}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,Et):a.then(Rt=>Rt.arrayBuffer()).then(Rt=>WebAssembly.instantiate(Rt,Et))).then(Rt=>{const Pt=Rt.instance.exports;return(0,Pt.g)(),at=Pt.f,ht(),new qP({setStyle:Pt.h,setAOOptions:Pt.i,setMetricOptions:Pt.j,setStructuralOptions:Pt.k,setFacadeOptions:Pt.l,setFauxFacadeOptions:Pt.m,setFacadeClassifierOptions:Pt.n,addFeature:Pt.o,addFacade:Pt.p,generateMesh:Pt.q,getLastError:Pt.r,getOuterRingLength:Pt.s,getMeshCount:Pt.t,getPositionsPtr:Pt.u,getPositionsLength:Pt.v,getNormalsPtr:Pt.w,getNormalsLength:Pt.x,getAOPtr:Pt.y,getAOLength:Pt.z,getUVPtr:Pt.A,getUVLength:Pt.B,getFauxFacadePtr:Pt.C,getFauxFacadeLength:Pt.D,getIndicesPtr:Pt.E,getIndicesLength:Pt.F,getBuildingPart:Pt.G,getRingCount:Pt.H,getRingPtr:Pt.I,getRingLength:Pt.J,malloc:Pt.K,free:Pt.L,heapU8:b,heap16:$,heap32:it,heapF32:st})})}(s).then(a=>(I_=null,mE=a,mE)).catch(a=>{$s("Could not load building-gen"),I_=null,uR=a}),I_}()}populate(s,a,b,$){const it=ZP();if(!it)return;const st=ir(b);this.tileToMeter=st,this.brightness=a.brightness,it.setStyle({normalScale:[1,-1,st],tileToMeters:st}),it.setAOOptions(!1,.3),it.setMetricOptions(!1,16),it.setStructuralOptions(!0),it.setFacadeClassifierOptions(3);const at=new Map,ht=new Map;let ft=0;for(const{feature:Xt}of s){if(jR[Xt.type]!=="LineString"){at.set(Xt.id,Xt.properties.source_id);continue}const nr=this.layers[0]._featureFilter.needGeometry;if(nr&&!this.layers[0]._featureFilter.filter(new $o(this.zoom),Xt,b))continue;const lr=Or(Xt,nr);if(!nr&&!this.layers[0]._featureFilter.filter(new $o(this.zoom),lr,b))continue;const hr=nr?lr.geometry:Pr(Xt,b,$),Er=[];for(const Lr of hr)for(const is of Lr)Er.push(is.x),Er.push(is.y);const _r={coordinates:Er,crossPerc:Xt.properties.cross_perc,distanceToRoad:Xt.properties.distance_to_road,entrances:Xt.properties.entrances,sourceId:0},Rr=Xt.properties.source_id;let kr=ht.get(Rr);kr||(kr=[],ht.set(Rr,kr)),kr.push(_r),++ft}this.maxHeight=0;const xt=new Array,Et=new Set,Rt=Xt=>{Xt!=null&&Et.add(Xt)},Pt=(Xt,nr)=>{Xt!=null&&xt.push({buildingId:Xt,footprintIndex:nr})},Lt=64*(s.length-ft),Gt=Lt/2;this.buildingWithFacade.reserve(Lt,Gt,!0),this.buildingWithoutFacade.reserve(2*Lt,2*Gt,!1),this.footprintsIndices.reserve(16*(s.length-ft)),this.footprintsVertices.reserve(8*(s.length-ft));for(const{feature:Xt,id:nr,index:lr,sourceLayerIndex:hr}of s){if(jR[Xt.type]==="LineString")continue;const Er=this.layers[0]._featureFilter.needGeometry;if(Er&&!this.layers[0]._featureFilter.filter(new $o(this.zoom),Xt,b))continue;let _r=null;if(Xt.properties&&Xt.properties.hasOwnProperty("building_id")&&(_r=Xt.properties.building_id,Et.has(_r)))continue;const Rr=Or(Xt,Er);if(!Er&&!this.layers[0]._featureFilter.filter(new $o(this.zoom),Rr,b))continue;const kr=Er?Rr.geometry:Pr(Xt,b,$),Lr=f1(kr,500);let is=!1;for(const dn of Lr)if(dn.length!==1){is=!0;break}if(is){Rt(_r);continue}if(!bI(kr,163)){Rt(_r);continue}const Br=this.layers[0],as=wI(Br.layout.get("building-roof-shape").evaluate(Xt,{},b)),ds=Br.layout.get("building-base").evaluate(Xt,{},b),fs=Br.layout.get("building-height").evaluate(Xt,{},b),vs=Br.layout.get("building-flood-light-ground-radius").evaluate(Xt,{},b),ws=Br.paint.get("building-ambient-occlusion-intensity"),xs=vs/this.tileToMeter;Xt.properties["building-part"]="roof";const ys=Br.paint.get("building-color").evaluate(Xt,{},this.canonical).toPremultipliedRenderColor(this.lut),os=Br.paint.get("building-emissive-strength").evaluate(Xt,{},this.canonical);Xt.properties["building-part"]="wall";const ss=Br.paint.get("building-color").evaluate(Xt,{},this.canonical).toPremultipliedRenderColor(this.lut),_s=Br.paint.get("building-emissive-strength").evaluate(Xt,{},this.canonical);Xt.properties["building-part"]="window";const Is=Br.paint.get("building-color").evaluate(Xt,{},this.canonical).toPremultipliedRenderColor(this.lut),Rs=Br.paint.get("building-emissive-strength").evaluate(Xt,{},this.canonical);Xt.properties["building-part"]="door";const rn=Br.paint.get("building-color").evaluate(Xt,{},this.canonical).toPremultipliedRenderColor(this.lut),zs=Br.paint.get("building-emissive-strength").evaluate(Xt,{},this.canonical);let Hs=Br.layout.get("building-flood-light-wall-radius").evaluate(Xt,{},b);Hs=Qt(Hs,0,2048);const Ys=Hs/2048*EE,zn=at.get(nr),Cs=ht.get(zn)||[],Qs=Cs.length!==0&&Br.layout.get("building-facade").evaluate(Xt,{},b);it.setFacadeOptions(4,!0),it.setFauxFacadeOptions(Qs,!1,1);let vn=0,Wn=0,Xn=0,Rn=0,Co=0,vr=0,Sr=0,ls=0,bs=0,Ls=0,Ds=0;if(Qs){let dn=Math.round(Br.layout.get("building-facade-floors").evaluate(Xt,{},b));if(ds===0){dn=Math.max(1,dn-(Cs.length>0?1:0));let Eo=4;if(fs>100){const Yo=[10,13,15];Eo=Yo[Xt.id?Xt.id%Yo.length:0]}else fs<=10&&(Eo=3);it.setFacadeOptions(Eo,!0),Co=(fs<15?1.3:1.61803)*Eo/st}else Co=ds/st;vr=fs/st,Co=Math.min(Co,vr),Xn=Br.layout.get("building-facade-unit-width").evaluate(Xt,{},b)/st,Rn=(vr-Co)/dn,it.setFauxFacadeOptions(!0,!0,Xn);const ba=Br.layout.get("building-facade-window").evaluate(Xt,{},b);vn=ba[0],Wn=ba[1],Sr=Math.floor(65535*Math.min(1,Co/Ps)),ls=Math.floor(65535*Math.min(1,vr/Ps)),bs=Math.floor(255*vn)<<8|Math.floor(255*Wn),Ls=Math.floor(65535*Math.min(1,Xn/Ps)),Ds=Math.floor(65535*Math.min(1,Rn/Ps))}const sn=Array(Lr.length),on={x:1/0,y:1/0},Sn={x:-1/0,y:-1/0},Fn={x:0,y:0};let Dn=0;for(let dn=0;dn<Lr.length;dn++){const ba=Lr[dn];if(ba.length>0){const Eo=[],Yo=Array(ba.length+1);Yo[0]=0;for(let Yl=0;Yl<ba.length;Yl++){const nu=ba[Yl];for(let Ul=0;Ul<nu.length;Ul++){const $l=nu[nu.length-Ul-1];on.x=Math.min(on.x,$l.x),on.y=Math.min(on.y,$l.y),Sn.x=Math.max(Sn.x,$l.x),Sn.y=Math.max(Sn.y,$l.y),Fn.x+=$l.x,Fn.y+=$l.y,Dn++,Eo.push($l.x),Eo.push($l.y)}Yo[Yl+1]=Eo.length}sn[dn]={id:Xt.id?Xt.id:0,height:fs,minHeight:ds,sourceId:0,roofType:as,coordinates:Eo,ringIndices:Yo}}}Fn.x/=Dn||1,Fn.y/=Dn||1;const Un=it.generateMesh(sn,Cs);if(typeof Un=="string"){$s(`Unable to generate building ${Xt.id}: ${Un}`),Rt(_r);continue}if(Un.meshes.length===0||Un.modifiedPolygonRings.length===0){Rt(_r);continue}const fn=Qs?this.buildingWithFacade:this.buildingWithoutFacade;let xn=0;for(const dn of Un.meshes)xn+=dn.positions.length/3;const ro=fn.segmentsBucket.prepareSegment(xn,fn.layoutVertexArray,fn.indexArray),lo=[];let co=null,wo=0,Fo=-1;const Ao=fn.layoutVertexArray.length,fo=Ao+xn;fn.layoutVertexArray.resize(fo),fn.layoutCentroidArray.resize(fo),fn.layoutNormalArray.resize(fo),fn.layoutAOArray.resize(fo),fn.layoutColorArray.resize(fo),fn.layoutFloodLightDataArray.resize(fo),Qs&&(fn.layoutFacadePaintArray.resize(fo),fn.layoutFacadeDataArray.resize(fo),fn.layoutFacadeVerticalRangeArray.resize(fo));const xo=fn.indexArray.length;let Ln=0,qn=Ao;for(const dn of Un.meshes){let ba,Eo;if(dn.buildingPart===1)ba=ys,Eo=os;else if(dn.buildingPart===0)ba=ss,Eo=_s;else if(dn.buildingPart===2)ba=Is,Eo=Rs;else{if(dn.buildingPart!==3)continue;ba=rn,Eo=zs}if(Eo=Qt(Eo,0,1),dn.buildingPart===3){const Bo=new Array;for(let Ql=0;Ql<dn.positions.length;Ql+=12){const Zp=dn.positions[Ql+0],Gm=dn.positions[Ql+1],_u=dn.positions[Ql+3],Du=dn.positions[Ql+4],ap=dn.positions[Ql+2],ey=dn.positions[Ql+8]-ap,H_=1,_m=_u-Zp,vm=Du-Gm,Z1=Math.hypot(_m,vm);Bo.push({pos:[Zp+.5*_m,Gm+.5*vm,ap],normal:[vm/Z1,-_m/Z1,0],width:Z1,height:ey,depth:H_,points:[Zp,Gm,_u,Du]})}const Pl=fn.entranceBloom.segmentsBucket.prepareSegment(10*Bo.length,fn.entranceBloom.layoutVertexArray,fn.entranceBloom.indexArray),Ll=fn.entranceBloom.layoutVertexArray.length;wo=fn.entranceBloom.indexArray.length,RR(Bo,.5/this.tileToMeter,fn.entranceBloom.indexArray,fn.entranceBloom.layoutVertexArray,fn.entranceBloom.layoutAttenuationArray);const Yu=fn.entranceBloom.layoutVertexArray.length-Ll;Fo=fn.entranceBloom.indexArray.length-wo;for(let Ql=0;Ql<Yu;Ql++)fn.entranceBloom.layoutColorArray.emplaceBack(255*rn.r<<8|255*rn.g,255*rn.b<<8|51*zs);Pl.vertexLength+=Yu,Pl.primitiveLength+=Fo,co={part:dn.buildingPart,vertexOffset:Ll,vertexLength:Yu}}fn.layoutVertexArray.float32.set(dn.positions,3*qn);const Yo=dn.positions.length/3;for(let Bo=0;Bo<Yo;++Bo){const Pl=3*Bo;Ln=Math.max(Ln,dn.positions[Pl+2]);const Ll=dn.normals[Pl+1]*EE,Yu=dn.normals[Pl+2]*EE,Ql=3*(qn+Bo);fn.layoutNormalArray.int16[Ql]=dn.normals[Pl]*EE,fn.layoutNormalArray.int16[Ql+1]=Ll,fn.layoutNormalArray.int16[Ql+2]=Yu;const Zp=dn.ao[Bo];fn.layoutAOArray.uint8[qn+Bo]=255*Zp;const Gm=1+(Zp-1)*ws,_u=255*ba.b*Gm<<8|255*Eo;fn.layoutColorArray.uint16[2*(qn+Bo)]=255*ba.r*Gm<<8|255*ba.g*Gm,fn.layoutColorArray.uint16[2*(qn+Bo)+1]=_u}const Yl=Math.floor(Fn.x),nu=Math.floor(Fn.y),Ul=Math.floor(fs);for(let Bo=0;Bo<Yo;++Bo){const Pl=3*(qn+Bo);fn.layoutCentroidArray.int16[Pl]=Yl,fn.layoutCentroidArray.int16[Pl+1]=nu,fn.layoutCentroidArray.int16[Pl+2]=Ul}if(fn.layoutFloodLightDataArray.uint16.fill(dn.buildingPart===0?Ys:0,qn,qn+Yo),Qs){const Bo=255*Is.r<<8|255*Is.g,Pl=255*Is.b<<8|255*Rs;for(let Ll=0;Ll<Yo;++Ll){const Yu=2*(qn+Ll);fn.layoutFacadePaintArray.uint16[Yu]=Bo,fn.layoutFacadePaintArray.uint16[Yu+1]=Pl}for(let Ll=0;Ll<Yo;++Ll)if(dn.isFauxFacade[Ll]){const Yu=Math.min(65535,Math.floor(dn.uv[2*Ll]*Un.outerRingLength));fn.layoutFacadeDataArray.emplace(qn+Ll,1|Yu,bs,Ls,Ds),fn.layoutFacadeVerticalRangeArray.emplace(qn+Ll,Sr,ls)}else fn.layoutFacadeDataArray.emplace(qn+Ll,0,0,0,0),fn.layoutFacadeVerticalRangeArray.emplace(qn+Ll,0,0)}const $l=ro.vertexLength,tu=dn.indices.length/3,qu=fn.indexArray.length;fn.indexArray.resize(qu+tu);for(let Bo=0;Bo<tu;++Bo){const Pl=3*Bo,Ll=3*qu+Pl;fn.indexArray.uint16[Ll]=$l+dn.indices[Pl],fn.indexArray.uint16[Ll+1]=$l+dn.indices[Pl+1],fn.indexArray.uint16[Ll+2]=$l+dn.indices[Pl+2]}dn.buildingPart!==1&&dn.buildingPart!==0&&dn.buildingPart!==2&&dn.buildingPart!==3||lo.push({part:dn.buildingPart,vertexOffset:qn,vertexLength:dn.positions.length/3}),qn+=Yo,ro.vertexLength+=Yo,ro.primitiveLength+=dn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Ln);const na=fn.indexArray.length-xo,hn=this.footprintsIndices.length,$n=this.footprintsVertices.length,Po=[],No=new ps(1/0,1/0),Go=new ps(-1/0,-1/0),Fl=this.groundEffect.vertexArray.length;for(const dn of Un.modifiedPolygonRings){const ba=[],Eo=new ps(1/0,1/0),Yo=new ps(-1/0,-1/0);for(let Yl=0;Yl<dn.length;Yl+=2){const nu=dn.length-Yl-2;Eo.x=Math.min(Eo.x,dn[nu]),Eo.y=Math.min(Eo.y,dn[nu+1]),Yo.x=Math.max(Yo.x,dn[nu]),Yo.y=Math.max(Yo.y,dn[nu+1]);const Ul=new ps(dn[nu],dn[nu+1]);ba.push(Ul),Po.push(Ul.x,Ul.y),this.footprintsVertices.emplaceBack(Ul.x,Ul.y)}No.x=Math.min(No.x,Eo.x),No.y=Math.min(No.y,Eo.y),Go.x=Math.max(Go.x,Yo.x),Go.y=Math.max(Go.y,Yo.y),this.groundEffect.addData(ba,[Eo,Yo],xs)}const Oo=this.groundEffect.vertexArray.length-Fl;this.groundEffect.groundRadiusArray.reserveForAdditional(Oo);for(let dn=0;dn<Oo;dn++)this.groundEffect.groundRadiusArray.emplaceBack(vs);(on.x<0||Sn.x>Ps||on.y<0||Sn.y>Ps)&&this.featuresOnBorder.push({featureId:Xt.id,footprintIndex:this.footprints.length});{const dn=R_(Po,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+dn.length),this.footprintsIndices.uint16.set(dn,hn),this.buildingIds.add(_r??Xt.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,No.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,No.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Go.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Go.y);const ba={footprintVertexOffset:$n,footprintVertexLength:this.footprintsVertices.length-$n,footprintIndexOffset:hn,footprintIndexLength:this.footprintsIndices.length-hn,min:No,max:Go,hiddenFlags:0,indicesOffset:xo,indicesLength:na,bloomIndicesOffset:wo,bloomIndicesLength:Fo,groundEffectVertexOffset:Fl,groundEffectVertexLength:Oo,hasFauxFacade:Qs,height:Ln,promoteId:nr,feature:Rr,parts:lo,buildingBloom:co},Eo=this.footprints.length;Xt.id!==void 0&&this.featureFootprintLookup.set(Xt.id,Eo),Pt(_r,Eo),this.footprints.push(ba)}this.programConfigurations.populatePaintArrays(fn.layoutVertexArray.length,Xt,lr,{},a.availableImages,b,a.brightness),this.groundEffect.addPaintPropertiesData(Xt,lr,{},a.availableImages,b,a.brightness),a.featureIndex.insert(Xt,kr,lr,hr,this.index,Ao)}xt.forEach(({buildingId:Xt,footprintIndex:nr})=>{Et.has(Xt)&&(this.footprints[nr].hiddenFlags|=4)});const Kt=new Set;this.buildingIds.forEach((Xt,nr,lr)=>{Et.has(Xt)||Kt.add(Xt)}),this.buildingIds=Kt,this.groundEffect.prepareBorderSegments()}update(s,a,b,$,it,st,at){this.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at),this.groundEffect.update(s,a,it,b,$,st,at),this.evaluate(this.layers[0],s),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(s){const a=b=>{b.layoutVertexBuffer=s.createVertexBuffer(b.layoutVertexArray,CR.members),b.layoutNormalBuffer=s.createVertexBuffer(b.layoutNormalArray,pI.members),b.layoutCentroidBuffer=s.createVertexBuffer(b.layoutCentroidArray,mI.members),b.layoutFloodLightDataBuffer=s.createVertexBuffer(b.layoutFloodLightDataArray,vI.members),b.layoutFacadeDataArray&&b.layoutFacadeDataArray.length&&(b.layoutFacadeDataBuffer=s.createVertexBuffer(b.layoutFacadeDataArray,xI.members)),b.layoutFacadeVerticalRangeArray&&b.layoutFacadeVerticalRangeArray.length&&(b.layoutFacadeVerticalRangeBuffer=s.createVertexBuffer(b.layoutFacadeVerticalRangeArray,yI.members)),b.entranceBloom.layoutVertexArray.length&&(b.entranceBloom.layoutVertexBuffer=s.createVertexBuffer(b.entranceBloom.layoutVertexArray,CR.members),b.entranceBloom.layoutAttenuationBuffer=s.createVertexBuffer(b.entranceBloom.layoutAttenuationArray,_I.members)),this.uploadUpdatedColorBuffer(s),this.uploadUpdatedIndexBuffer(s)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(s)),this.groundEffect.uploadPaintProperties(s),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){const s=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(s,a,b=!0){let $=!1;const it=b?a:0,st=0|(b?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const at of s){const ht=this.footprints[at],ft=ht.hiddenFlags&st|it;ht.hiddenFlags!==ft&&(ht.hiddenFlags=ft,$=!0,this.groundEffect.updateHiddenByLandmarkRange(ht.groundEffectVertexOffset,ht.groundEffectVertexLength,ht.hiddenFlags!==0))}return $&&(this.indexArrayForConflationUploaded=!1),$}uploadUpdatedIndexBuffer(s){if(this.groundEffect.uploadHiddenByLandmark(s),this.indexArrayForConflationUploaded)return;const a=$=>{$.indexArray.length!==0&&($.indexArrayForConflation.resize($.indexArray.length),$.indexArrayForConflation.uint16.set($.indexArray.uint16),$.entranceBloom.indexArrayForConflation.resize($.entranceBloom.indexArray.length),$.entranceBloom.indexArrayForConflation.uint16.set($.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const $ of this.footprints){const it=$.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,st=$.indicesOffset+$.indicesLength;if($.hiddenFlags!==0){for(let ht=$.indicesOffset;ht<st;ht++)it.indexArrayForConflation.uint16[3*ht+0]=0,it.indexArrayForConflation.uint16[3*ht+1]=0,it.indexArrayForConflation.uint16[3*ht+2]=0;const at=$.bloomIndicesOffset+$.bloomIndicesLength;for(let ht=$.bloomIndicesOffset;ht<at;ht++)it.entranceBloom.indexArrayForConflation.uint16[3*ht+0]=0,it.entranceBloom.indexArrayForConflation.uint16[3*ht+1]=0,it.entranceBloom.indexArrayForConflation.uint16[3*ht+2]=0}}const b=$=>{$.indexArray.length!==0&&($.indexBuffer?$.indexBuffer.updateData($.indexArrayForConflation):$.indexBuffer=s.createIndexBuffer($.indexArrayForConflation,!0),$.entranceBloom.indexBuffer?$.entranceBloom.indexBuffer.updateData($.entranceBloom.indexArrayForConflation):$.entranceBloom.indexBuffer=s.createIndexBuffer($.entranceBloom.indexArrayForConflation,!0))};b(this.buildingWithoutFacade),b(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(s){const a=b=>{b.layoutColorBuffer?b.layoutColorBuffer.updateData(b.layoutColorArray):b.layoutColorBuffer=s.createVertexBuffer(b.layoutColorArray,AR.members,!0),b.layoutFacadePaintArray&&(b.layoutFacadePaintBuffer?b.layoutFacadePaintBuffer.updateData(b.layoutFacadePaintArray):b.layoutFacadePaintBuffer=s.createVertexBuffer(b.layoutFacadePaintArray,gI.members,!0)),b.entranceBloom.layoutColorBuffer?b.entranceBloom.layoutColorBuffer.updateData(b.entranceBloom.layoutColorArray):b.entranceBloom.layoutColorBuffer=s.createVertexBuffer(b.entranceBloom.layoutColorArray,AR.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(s,a){const b=s.paint.get("building-ambient-occlusion-intensity");for(const $ of this.footprints){if(4&$.hiddenFlags)continue;const it=a[$.promoteId],st=$.feature;st.properties["building-part"]="roof";const at=s.paint.get("building-color").evaluate(st,it,this.canonical).toPremultipliedRenderColor(this.lut),ht=s.paint.get("building-emissive-strength").evaluate(st,it,this.canonical);st.properties["building-part"]="wall";const ft=s.paint.get("building-color").evaluate(st,it,this.canonical).toPremultipliedRenderColor(this.lut),xt=s.paint.get("building-emissive-strength").evaluate(st,it,this.canonical);st.properties["building-part"]="window";const Et=s.paint.get("building-color").evaluate(st,it,this.canonical).toPremultipliedRenderColor(this.lut),Rt=s.paint.get("building-emissive-strength").evaluate(st,it,this.canonical);st.properties["building-part"]="door";const Pt=s.paint.get("building-color").evaluate(st,it,this.canonical).toPremultipliedRenderColor(this.lut),Lt=s.paint.get("building-emissive-strength").evaluate(st,it,this.canonical),Gt=$.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const Xt of $.parts){let nr,lr=at;Xt.part===1?(lr=at,nr=ht):Xt.part===0?(lr=ft,nr=xt):Xt.part===2?(lr=Et,nr=Rt):Xt.part===3&&(lr=Pt,nr=Lt),nr=Qt(nr,0,1);for(let hr=0;hr<Xt.vertexLength;hr++){const Er=Xt.vertexOffset+hr,_r=1+(Gt.layoutAOArray.uint8[Er]/255-1)*b;Gt.layoutColorArray.emplace(Er,lr.r*_r*255<<8|lr.g*_r*255,lr.b*_r*255<<8|255*nr),$.hasFauxFacade&&Gt.layoutFacadePaintArray.emplace(Er,255*Et.r<<8|255*Et.g,255*Et.b<<8|255*Rt)}}const Kt=$.buildingBloom;if(Kt)for(let Xt=0;Xt<Kt.vertexLength;Xt++)Gt.entranceBloom.layoutColorArray.emplace(Kt.vertexOffset+Xt,255*Pt.r<<8|255*Pt.g,255*Pt.b<<8|51*Lt)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(s,a,b){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const $=a.getReplacementRegionsForTile(s.toUnwrapped());if(uE(this.activeReplacements,$))return;this.activeReplacements=$;for(const st of this.footprints)st.hiddenFlags&=-2;const it=[];for(const st of this.activeReplacements){if(st.order<=IT)continue;const at=Math.max(1,Math.pow(2,st.footprintTileId.canonical.z-s.canonical.z));for(const ht of this.footprints)ht.min.x>st.max.x||ht.max.x<st.min.x||ht.min.y>st.max.y||ht.max.y<st.min.y||(it.length=0,SI(this.footprintsVertices,ht.footprintVertexOffset,ht.footprintVertexLength,st.footprintTileId.canonical,s.canonical,it),$2(st.footprint,it,this.footprintsIndices.uint16,ht.footprintIndexOffset,ht.footprintIndexLength,0,-at)&&(ht.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const st of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(st.groundEffectVertexOffset,st.groundEffectVertexLength,st.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(s){if(s.id!==void 0){const a=this.featureFootprintLookup.get(s.id);return this.footprints[a]}return null}getHeightAtTileCoord(s,a){let b=Number.NEGATIVE_INFINITY,$=!0;const it=4*(s+Ps)*Ps+(a+Ps);if(this.footprintLookup.hasOwnProperty(it)){const at=this.footprintLookup[it];return at?{height:at.height,hidden:at.hiddenFlags!==0}:void 0}const st=new ps(s,a);for(const at of this.footprints)s>at.max.x||at.min.x>s||a>at.max.y||at.min.y>a||at.height<=b||EI(st,this.footprintsVertices.float32.subarray(2*at.footprintVertexOffset,2*(at.footprintVertexOffset+at.footprintVertexLength)),this.footprintsIndices.uint16.subarray(at.footprintIndexOffset,at.footprintIndexOffset+at.footprintIndexLength))&&(b=at.height,this.footprintLookup[it]=at,$=at.hiddenFlags!==0);if(b!==Number.NEGATIVE_INFINITY)return{height:b,hidden:$};this.footprintLookup[it]=void 0}}function EI(g,s,a){for(let b=0;b<a.length;b+=3){const $=a[b],it=a[b+1],st=a[b+2],at=s[2*$+0],ht=s[2*$+1],ft=s[2*it+0],xt=s[2*it+1],Et=s[2*st+0],Rt=s[2*st+1],Pt=(at-Et)*(g.y-Rt)-(ht-Rt)*(g.x-Et),Lt=(ft-at)*(g.y-ht)-(xt-ht)*(g.x-at);if(Pt<0!=Lt<0&&Pt!==0&&Lt!==0)continue;const Gt=(Et-ft)*(g.y-xt)-(Rt-xt)*(g.x-ft);if(Gt===0||Gt<0==Pt+Lt<=0)return!0}return!1}function SI(g,s,a,b,$,it){const st=Math.pow(2,b.z-$.z);for(let at=0;at<a;at++){let ht=g.float32[2*(at+s)+0],ft=g.float32[2*(at+s)+1];ht=(ht+$.x*Ps)*st-b.x*Ps,ft=(ft+$.y*Ps)*st-b.y*Ps,it.push(new ps(ht,ft))}}let IR,kR;Xs(PR,"BuildingBucket",{omit:["layers"]}),Xs(uS,"BuildingGeometry"),Xs(cS,"BuildingBloomGeometry");const TI=Vn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),RI=Vn([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:CI}=TI,AI=Vn([{name:"a_packed",components:3,type:"Float32"}]),{members:jI}=AI,PI=Vn([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:II}=PI;class MR{constructor(s,a){this.width=s,this.height=a,this.nextRow=0,this.image=new Xx({width:s,height:a}),this.positions={},this.uploaded=!1}getDash(s,a){const b=this.getKey(s,a);return this.positions[b]}trim(){const s=this.width,a=this.height=_i(this.nextRow);this.image.resize({width:s,height:a})}getKey(s,a){return s.join(",")+a}getDashRanges(s,a,b){const $=[];let it=s.length%2==1?-s[s.length-1]*b:0,st=s[0]*b,at=!0;$.push({left:it,right:st,isDash:at,zeroLength:s[0]===0});let ht=s[0];for(let ft=1;ft<s.length;ft++){at=!at;const xt=s[ft];it=ht*b,ht+=xt,st=ht*b,$.push({left:it,right:st,isDash:at,zeroLength:xt===0})}return $}addRoundDash(s,a,b){const $=a/2;for(let it=-b;it<=b;it++){const st=this.width*(this.nextRow+b+it);let at=0,ht=s[at];for(let ft=0;ft<this.width;ft++){ft/ht.right>1&&(ht=s[++at]);const xt=Math.abs(ft-ht.left),Et=Math.abs(ft-ht.right),Rt=Math.min(xt,Et);let Pt;const Lt=it/b*($+1);if(ht.isDash){const Gt=$-Math.abs(Lt);Pt=Math.sqrt(Rt*Rt+Gt*Gt)}else Pt=$-Math.sqrt(Rt*Rt+Lt*Lt);this.image.data[st+ft]=Math.max(0,Math.min(255,Pt+128))}}}addRegularDash(s,a){for(let ht=s.length-1;ht>=0;--ht){const ft=s[ht],xt=s[ht+1];ft.zeroLength?s.splice(ht,1):xt&&xt.isDash===ft.isDash&&(xt.left=ft.left,s.splice(ht,1))}const b=s[0],$=s[s.length-1];b.isDash===$.isDash&&(b.left=$.left-this.width,$.right=b.right+this.width);const it=this.width*this.nextRow;let st=0,at=s[st];for(let ht=0;ht<this.width;ht++){ht/at.right>1&&(at=s[++st]);const ft=Math.abs(ht-at.left),xt=Math.abs(ht-at.right),Et=Math.min(ft,xt);this.image.data[it+ht]=Math.max(0,Math.min(255,(at.isDash?Et:-Et)+a+128))}}addDash(s,a){const b=this.getKey(s,a);if(this.positions[b])return this.positions[b];const $=a==="round",it=$?7:0,st=2*it+1;if(this.nextRow+st>this.height)return $s("LineAtlas out of space"),null;s.length===0&&s.push(1);let at=0;for(let xt=0;xt<s.length;xt++)s[xt]<0&&($s("Negative value is found in line dasharray, replacing values with 0"),s[xt]=0),at+=s[xt];if(at!==0){const xt=this.width/at,Et=this.getDashRanges(s,this.width,xt);$?this.addRoundDash(Et,xt,it):this.addRegularDash(Et,a==="square"?.5*xt:0)}const ht=this.nextRow+it;this.nextRow+=st;const ft={tl:[ht,it],br:[at,0]};return this.positions[b]=ft,ft}}Xs(MR,"LineAtlas");const kI=Nr.types,MI=Math.cos(Math.PI/180*37.5),FI=Math.cos(Math.PI/180*5);class hS{constructor(s){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=s.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=s.overscaling,this.pixelRatio=s.pixelRatio,this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=s.index,this.projection=s.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new a_,this.layoutVertexArray2=new ep,this.patternVertexArray=new ep,this.indexArray=new Zl,this.programConfigurations=new jp(s.layers,{zoom:s.zoom,lut:s.lut}),this.segments=new ga,this.maxLineLength=0,this.zOffsetVertexArray=new ep,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=s.tessellationStep?s.tessellationStep:Ps/64,this.worldview=s.worldview,this.hasAppearances=null}updateFootprints(s,a){}updateAppearances(s,a,b,$){}populate(s,a,b,$){this.hasPattern=N2("line",this.layers,this.pixelRatio,a);const it=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ir(b);const st=this.layers[0].layout.get("line-elevation-reference");if(st==="hd-road-markup")this.elevationType="road";else{const Rt=this.layers[0].layout.get("line-z-offset"),Pt=Rt.isConstant()&&!Rt.constantOr(0);this.elevationType=st!=="sea"&&st!=="ground"&&Pt?"none":"offset",this.elevationType==="offset"&&st==="none"&&$s(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const at=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&at!==void 0;const ht=[];for(const{feature:Rt,id:Pt,index:Lt,sourceLayerIndex:Gt}of s){const Kt=this.layers[0]._featureFilter.needGeometry,Xt=Or(Rt,Kt);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Xt,b))continue;const nr=it?it.evaluate(Xt,{},b):void 0,lr={id:Pt,properties:Rt.properties,type:Rt.type,sourceLayerIndex:Gt,index:Lt,geometry:Kt?Xt.geometry:Pr(Rt,b,$),patterns:{},sortKey:nr};ht.push(lr)}it&&ht.sort((Rt,Pt)=>Rt.sortKey-Pt.sortKey);const{lineAtlas:ft,featureIndex:xt}=a,Et=this.addConstantDashes(ft);for(const Rt of ht){const{geometry:Pt,index:Lt,sourceLayerIndex:Gt}=Rt;if(Et&&this.addFeatureDashes(Rt,ft),this.hasPattern){const Kt=z2("line",this.layers,Rt,this.zoom,this.pixelRatio,a);this.patternFeatures.push(Kt)}else this.addFeature(Rt,Pt,Lt,b,ft.positions,a.availableImages,a.brightness,a.elevationFeatures);xt.insert(s[Lt].feature,Pt,Lt,Gt,this.index)}}addConstantDashes(s){let a=!1;for(const b of this.layers){const $=b.paint.get("line-dasharray").value,it=b.layout.get("line-cap").value;if($.kind!=="constant"||it.kind!=="constant")a=!0;else{const st=it.value,at=$.value;if(!at)continue;s.addDash(at,st)}}return a}addFeatureDashes(s,a){const b=this.zoom;for(const $ of this.layers){const it=$.paint.get("line-dasharray").value,st=$.layout.get("line-cap").value;if(it.kind==="constant"&&st.kind==="constant")continue;let at,ht;if(it.kind==="constant"){if(at=it.value,!at)continue}else at=it.evaluate({zoom:b},s);ht=st.kind==="constant"?st.value:st.evaluate({zoom:b},s),a.addDash(at,ht),s.patterns[$.id]=[a.getKey(at,ht)]}}update(s,a,b,$,it,st,at,ht){this.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,ht)}addFeatures(s,a,b,$,it,st){for(const at of this.patternFeatures)this.addFeature(at,at.geometry,at.index,a,b,$,st,s.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(s){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=s.createVertexBuffer(this.layoutVertexArray2,jI)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=s.createVertexBuffer(this.patternVertexArray,II)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,RI.members,!0)),this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,CI),this.indexBuffer=s.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(s),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(s,a){let b,$;if(a&&a>0?(b=`mapbox_clip_start_${a}`,$=`mapbox_clip_end_${a}`):(b="mapbox_clip_start",$="mapbox_clip_end"),s.properties&&s.properties.hasOwnProperty(b)&&s.properties.hasOwnProperty($))return{start:+s.properties[b],end:+s.properties[$]}}addFeature(s,a,b,$,it,st,at,ht){const ft=this.layers[0].layout,xt=ft.get("line-join").evaluate(s,{}),Et=ft.get("line-cap").evaluate(s,{}),Rt=ft.get("line-miter-limit"),Pt=ft.get("line-round-limit");this.lineClips=this.lineFeatureClips(s),this.lineFeature=s;const Lt=!(!s.properties||!s.properties.hasOwnProperty("mapbox_line_metrics"))&&s.properties.mapbox_line_metrics;this.zOffsetValue=ft.get("line-z-offset").value;const Gt=this.layers[0].paint.get("line-width").value;if(Gt.kind!=="constant"&&Gt.isLineProgressConstant===!1&&(this.variableWidthValue=Gt),this.elevationType==="road"){const Kt=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(s,a,$,ht,xt,Et,Rt,Pt)){const[Xt,nr]=this.clipRuntimeLinesToTile(a,1);for(let lr=0;lr<Xt.length;lr++){const hr=Xt[lr],Er=nr[lr],_r={progress:{min:Er.progress.min,max:Er.progress.max},nextDir:this.computeSegNextDir(Er,hr),prevDir:this.computeSegPrevDir(Er,hr)};this.addLine(hr,s,$,xt,Et,Rt,Pt,_r,Lt&&Er.parentIndex>0?Er.parentIndex:null)}this.fillNonElevatedRoadSegment(Kt)}}else for(let Kt=0;Kt<a.length;Kt++)this.addLine(a[Kt],s,$,xt,Et,Rt,Pt,void 0,Lt&&Kt>0?Kt:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,s,b,it,st,$,at,void 0,this.worldview)}computeSegNextDir(s,a){return s.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(s,a){return a[1].sub(s.prevPoint).unit()}clipLinesToTile(s,a){return fE(s,-a,-a,Ps+a,Ps+a)}clipRuntimeLinesToTile(s,a){const b=[];return[fE(s,-a,-a,Ps+a,Ps+a,b),b]}addElevatedRoadFeature(s,a,b,$,it,st,at,ht){const ft=[],xt=mo.getElevationFeature(s,$);if(xt){const Et=this.clipLinesToTile(a,1),Rt=this.prepareElevatedLines(Et,xt,b);for(const Pt of Rt)ft.push({geometry:Pt,elevation:xt,elevationTileID:b,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(ft.length===0)return!1;for(const Et of ft){const Rt=this.layoutVertexArray.length;this.addLine(Et.geometry,s,b,it,st,at,ht);const Pt=new To(b,Et.elevationTileID);if(Et.elevation)for(let Lt=Rt;Lt<this.layoutVertexArray.length;Lt++){const Gt=new ps(this.layoutVertexArray.int16[6*Lt]>>1,this.layoutVertexArray.int16[6*Lt+1]>>1),Kt=Pt.pointElevation(Gt,Et.elevation,.05);this.updateHeightRange(Kt),this.zOffsetVertexArray.emplaceBack(Kt,0,0)}else this.fillNonElevatedRoadSegment(Rt)}return!0}prepareElevatedLines(s,a,b){if(a.constantHeight!=null)return s;const $=[],it=1/ir(b);for(const st of s)GP(st,new ao(a,it),0,$);return $}fillNonElevatedRoadSegment(s){for(let a=s;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(s){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,s),this.heightRange.max=Math.max(this.heightRange.max,s)):this.heightRange={min:s,max:s}}addLine(s,a,b,$,it,st,at,ht,ft){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=ft?this.lineFeatureClips(a,ft):this.lineClips;const xt=$==="none";this.patternJoinNone=this.hasPattern&&xt,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const Et=ht&&ht.progress.min>0,Rt=ht&&ht.progress.max<1;if(this.lineClips){let Lr={min:this.lineClips.start,max:this.lineClips.end},is=1;if(ht){const ds=this.lineClips.end-this.lineClips.start;Lr=function(fs,vs,ws){return{min:Do(fs.min,vs,ws),max:Do(fs.max,vs,ws)}}(ht.progress,{min:0,max:1},Lr),ds>0&&(is=(Lr.max-Lr.min)/ds)}const Br=+a.properties.mapbox_clip_feature_len,as=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Br)||Number.isNaN(as)){for(let fs=0;fs<s.length-1;fs++)this.totalDistance+=s[fs].dist(s[fs+1]);const ds=this.totalDistance/(Lr.max-Lr.min);this.totalFeatureLength=Number.isFinite(ds)?ds:0,this.lineClips.start=Lr.min,this.lineClips.end=Lr.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Br,this.distance=as*is,this.lineClips.start=Lr.min,this.lineClips.end=Lr.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const Pt=kI[a.type]==="Polygon";let Lt=s.length;for(;Lt>=2&&s[Lt-1].equals(s[Lt-2]);)Lt--;let Gt=0;for(;Gt<Lt-1&&s[Gt].equals(s[Gt+1]);)Gt++;if(Lt<(Pt?3:2))return;$==="bevel"&&(st=1.05);const Kt=this.segments.prepareSegment(10*Lt,this.layoutVertexArray,this.indexArray);let Xt,nr,lr,hr,Er,_r,Rr,kr;ht&&ht.prevDir&&(_r=ht.prevDir.perp()),ht&&ht.nextDir&&(Rr=ht.nextDir.perp()),this.e1=this.e2=-1,Pt&&(Xt=s[Lt-2],Er=s[Gt].sub(Xt)._unit()._perp());for(let Lr=Gt;Lr<Lt;Lr++){if(lr=Lr===Lt-1?Pt?s[Gt+1]:void 0:s[Lr+1],lr&&s[Lr].equals(lr))continue;Er&&(hr=Er),Xt&&(nr=Xt),Xt=s[Lr],kr=this.evaluateLineProgressFeatures(nr?nr.dist(Xt):0),Er=lr?lr.sub(Xt)._unit()._perp():hr,hr=hr||Er;const is=nr&&lr;let Br=is?$:Pt||xt?"butt":it;const as=hr.x*Er.x+hr.y*Er.y;if(xt){const ss=function(_s){if(_s.patternJoinNone){const Is=_s.segmentPoints.length/2,Rs=_s.lineSoFar-_s.segmentStart;for(let rn=0;rn<Is;++rn){const zs=_s.segmentPoints[2*rn+1],Hs=Math.round(_s.segmentPoints[2*rn])+.5+.25*zs;_s.patternVertexArray.emplaceBack(Hs,Rs,_s.segmentStart),_s.patternVertexArray.emplaceBack(Hs,Rs,_s.segmentStart)}_s.segmentPoints.length=0}_s.e1=_s.e2=-1};if(is&&as<FI){this.updateDistance(nr,Xt),this.addCurrentVertex(Xt,hr,1,1,Kt,kr),ss(this),this.addCurrentVertex(Xt,Er,-1,-1,Kt,kr);continue}if(nr){if(!lr){this.updateDistance(nr,Xt),this.addCurrentVertex(Xt,hr,1,1,Kt,kr),ss(this);continue}Br="miter"}}let ds=hr.add(Er);ds.x===0&&ds.y===0||ds._unit();const fs=ds.x*Er.x+ds.y*Er.y,vs=fs!==0?1/fs:1/0,ws=2*Math.sqrt(2-2*fs),xs=fs<MI&&nr&&lr,ys=hr.x*Er.y-hr.y*Er.x>0,os=this.overscaling<=16?15*Ps/(512*this.overscaling):0;if(is&&Br==="round"){if(vs<at)Br="miter";else if(vs<=2){const ss=dS(Xt,-10,Ps+10);Br=this.elevationType==="offset"&&(ss||this.hasCrossSlope)?"miter":"fakeround"}}if(Br==="miter"&&vs>st&&(Br="bevel"),Br==="bevel"&&(vs>2&&(Br="flipbevel"),vs<st&&(Br="miter")),nr&&!(Br==="miter"&&xs)&&this.updateDistance(nr,Xt),Br==="miter")if(xs){const ss=Xt.dist(nr);if(ss>2*os){const Is=Xt.sub(Xt.sub(nr)._mult(os/ss)._round());this.updateDistance(nr,Is),this.addCurrentVertex(Is,hr,0,0,Kt,kr),nr=Is}this.updateDistance(nr,Xt),ds._mult(vs),this.addCurrentVertex(Xt,ds,0,0,Kt,kr);const _s=Xt.dist(lr);if(_s>2*os){const Is=Xt.add(lr.sub(Xt)._mult(os/_s)._round());this.updateDistance(Xt,Is),this.addCurrentVertex(Is,Er,0,0,Kt,kr),Xt=Is}}else ds._mult(vs),this.addCurrentVertex(Xt,ds,0,0,Kt,kr);else if(Br==="flipbevel"){if(vs>100)ds=Er.mult(-1);else{const ss=vs*hr.add(Er).mag()/hr.sub(Er).mag();ds._perp()._mult(ss*(ys?-1:1))}this.addCurrentVertex(Xt,ds,0,0,Kt,kr),this.addCurrentVertex(Xt,ds.mult(-1),0,0,Kt,kr)}else if(Br==="bevel"||Br==="fakeround"){kr!=null&&nr&&this.addCurrentVertex(Xt,Rr||hr,-1,-1,Kt,kr);const ss=Xt.dist(nr)<=2*os&&Br!=="bevel",_s=ds.mult(ys?1:-1);_s._mult(vs);const Is=Er.mult(ys?-1:1),Rs=hr.mult(ys?-1:1),rn=this.evaluateLineProgressFeatures(this.distance);if(kr==null&&(this.addHalfVertex(Xt,_s.x,_s.y,!1,!ys,0,Kt,rn),ss||this.addHalfVertex(Xt,_s.x+2*Rs.x,_s.y+2*Rs.y,!1,ys,0,Kt,rn)),Br==="fakeround"){const zs=Math.round(180*ws/Math.PI/20);this.addHalfVertex(Xt,Rs.x,Rs.y,!1,ys,0,Kt,rn);for(let Hs=0;Hs<zs;Hs++){let Ys=Hs/zs;if(Ys!==.5){const Cs=Ys-.5;Ys+=Ys*Cs*(Ys-1)*((1.0904+as*(as*(3.55645-1.43519*as)-3.2452))*Cs*Cs+(.848013+as*(.215638*as-1.06021)))}const zn=Is.sub(Rs)._mult(Ys)._add(Rs)._unit();this.addHalfVertex(Xt,zn.x,zn.y,!1,ys,0,Kt,rn)}this.addHalfVertex(Xt,Is.x,Is.y,!1,ys,0,Kt,rn)}ss||kr!=null||this.addHalfVertex(Xt,_s.x+2*Is.x,_s.y+2*Is.y,!1,ys,0,Kt,rn),kr!=null&&lr&&this.addCurrentVertex(Xt,_r||Er,1,1,Kt,kr)}else if(Br==="butt")this.addCurrentVertex(Xt,ds,0,0,Kt,kr);else if(Br==="square"){if(!nr){const ss=Et?0:-1;this.addCurrentVertex(Xt,ds,ss,ss,Kt,kr)}if(this.addCurrentVertex(Xt,ds,0,0,Kt,kr),nr){const ss=Rt?0:1;this.addCurrentVertex(Xt,ds,ss,ss,Kt,kr)}}else if(Br==="round"){if(nr){const ss=!is&&Rr?Rr:hr;this.addCurrentVertex(Xt,ss,0,0,Kt,kr),!is&&Rt||this.addCurrentVertex(Xt,ss,1,1,Kt,kr,!0)}if(lr){const ss=!is&&_r?_r:Er;!is&&Et||this.addCurrentVertex(Xt,ss,-1,-1,Kt,kr,!0),this.addCurrentVertex(Xt,ss,0,0,Kt,kr)}}}}addVerticesTo(s,a,b,$,it,st,at,ht,ft,xt){const Et=(a.w-s.w)/this.tessellationStep|0;let Rt=0;const Pt=this.scaledDistance;if(Et>1){this.lineSoFar=s.w;const Gt=(a.x-s.x)/Et,Kt=(a.y-s.y)/Et,Xt=(a.z-s.z)/Et,nr=(a.w-s.w)/Et;for(let lr=1;lr<Et;++lr){s.x+=Gt,s.y+=Kt,s.z+=Xt,this.lineSoFar+=nr,Rt+=nr;const hr=this.evaluateLineProgressFeatures(this.prevDistance+Rt);this.scaledDistance=(this.prevDistance+Rt)/this.totalDistance,this.addHalfVertex(s,b,$,xt,!1,at,ft,hr),this.addHalfVertex(s,it,st,xt,!0,-ht,ft,hr)}}this.lineSoFar=a.w,this.scaledDistance=Pt;const Lt=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,b,$,xt,!1,at,ft,Lt),this.addHalfVertex(a,it,st,xt,!0,-ht,ft,Lt)}evaluateLineProgressFeatures(s){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+s)/this.totalFeatureLength):$s(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(s,a,b,$,it,st,at=!1){const ht=a.x+a.y*b,ft=a.y-a.x*b,xt=a.y*$-a.x,Et=-a.y-a.x*$;if(st!=null){const Rt=this.elevationType==="offset",Pt=-10,Lt=Ps+10,Gt=st.zOffset,Kt=new tR(s.x,s.y,Gt,this.lineSoFar),Xt=!!Rt&&dS(s,Pt,Lt),nr=this.lineSoFar,lr=this.distance;if(this.currentVertex)if(Xt){const hr=this.currentVertexIsOutside,Er=this.currentVertex,_r=new tR(s.x,s.y,Gt,this.lineSoFar);if(iR(Er,_r,Pt,Lt),!dS(_r,Pt,Lt)){if(hr){this.e1=this.e2=-1,this.distance-=Er.dist(Kt),this.lineSoFar=Er.w;const Rr=this.evaluateLineProgressFeatures(Er.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Er,ht,ft,at,!1,b,it,Rr),this.addHalfVertex(Er,xt,Et,at,!0,-$,it,Rr),this.prevDistance=this.distance}this.distance=this.prevDistance+Er.dist(_r),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Er,_r,ht,ft,xt,Et,b,$,it,at),this.distance=lr,this.scaledDistance=this.distance/this.totalDistance}}else{const hr=this.currentVertex;if(this.currentVertexIsOutside){iR(hr,Kt,Pt,Lt),this.e1=this.e2=-1,this.distance-=hr.dist(Kt),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=hr.w;const Er=this.evaluateLineProgressFeatures(hr.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(hr,ht,ft,at,!1,b,it,Er),this.addHalfVertex(hr,xt,Et,at,!0,-$,it,Er),this.prevDistance=this.distance,this.distance=lr,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(hr,Kt,ht,ft,xt,Et,b,$,it,at)}else Xt||(this.addHalfVertex(s,ht,ft,at,!1,b,it,st),this.addHalfVertex(s,xt,Et,at,!0,-$,it,st));this.currentVertex=Kt,this.currentVertexIsOutside=Xt,this.lineSoFar=nr}else this.addHalfVertex(s,ht,ft,at,!1,b,it,st),this.addHalfVertex(s,xt,Et,at,!0,-$,it,st)}addHalfVertex({x:s,y:a},b,$,it,st,at,ht,ft){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),st||this.segmentPoints.push(this.lineSoFar-this.segmentStart,at)),this.layoutVertexArray.emplaceBack((s<<1)+(it?1:0),(a<<1)+(st?1:0),Math.round(63*b)+128,Math.round(63*$)+128,1+(at===0?0:at<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const Et=pn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,Et)}const xt=ht.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,xt),ht.primitiveLength++),st?this.e2=xt:this.e1=xt,ft!=null&&this.zOffsetVertexArray.emplaceBack(ft.zOffset,ft.variableWidth,ft.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(s,a){this.prevDistance=this.distance,this.distance+=s.dist(a),this.updateScaledDistance()}}function dS(g,s,a){return g.x<s||g.x>a||g.y<s||g.y>a}let FR,LR;function DR(g,s,a){return s*(Ps/(g.tileSize*Math.pow(2,a-g.tileID.overscaledZ)))}Xs(hS,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const NR=(g,s,a)=>(1-a)*g+a*s;function zR(g,s){return 1/DR(g,1,s.tileZoom)}function OR(g,s,a,b){return g.translatePosMatrix(b||s.tileID.projMatrix,s,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const BR=g=>{const s=[];VR(g)&&s.push("RENDER_LINE_DASH"),g.paint.get("line-gradient")&&s.push("RENDER_LINE_GRADIENT");const a=g.paint.get("line-trim-offset");a[0]===0&&a[1]===0||s.push("RENDER_LINE_TRIM_OFFSET"),g.paint.get("line-border-width").constantOr(1)!==0&&s.push("RENDER_LINE_BORDER");const b=g.layout.get("line-join").constantOr("miter")==="none",$=!!g.paint.get("line-pattern").constantOr(1);return b&&$&&s.push("LINE_JOIN_NONE"),s};function VR(g){const s=g.paint.get("line-dasharray").value;return s.kind!=="constant"||s.value}let fS;const UR=()=>fS||(fS={layout:FR||(FR=new Sl({"line-cap":new Fs(Gr.layout_line["line-cap"]),"line-join":new Fs(Gr.layout_line["line-join"]),"line-miter-limit":new As(Gr.layout_line["line-miter-limit"]),"line-round-limit":new As(Gr.layout_line["line-round-limit"]),"line-sort-key":new Fs(Gr.layout_line["line-sort-key"]),"line-z-offset":new Fs(Gr.layout_line["line-z-offset"]),"line-elevation-reference":new As(Gr.layout_line["line-elevation-reference"]),"line-cross-slope":new As(Gr.layout_line["line-cross-slope"]),visibility:new As(Gr.layout_line.visibility),"line-width-unit":new As(Gr.layout_line["line-width-unit"])})),paint:LR||(LR=new Sl({"line-opacity":new Fs(Gr.paint_line["line-opacity"]),"line-color":new Fs(Gr.paint_line["line-color"]),"line-translate":new As(Gr.paint_line["line-translate"]),"line-translate-anchor":new As(Gr.paint_line["line-translate-anchor"]),"line-width":new Fs(Gr.paint_line["line-width"]),"line-gap-width":new Fs(Gr.paint_line["line-gap-width"]),"line-offset":new Fs(Gr.paint_line["line-offset"]),"line-blur":new Fs(Gr.paint_line["line-blur"]),"line-dasharray":new Fs(Gr.paint_line["line-dasharray"]),"line-pattern":new Fs(Gr.paint_line["line-pattern"]),"line-pattern-cross-fade":new As(Gr.paint_line["line-pattern-cross-fade"]),"line-gradient":new lx(Gr.paint_line["line-gradient"]),"line-trim-offset":new As(Gr.paint_line["line-trim-offset"]),"line-trim-fade-range":new As(Gr.paint_line["line-trim-fade-range"]),"line-trim-color":new As(Gr.paint_line["line-trim-color"]),"line-emissive-strength":new Fs(Gr.paint_line["line-emissive-strength"]),"line-border-width":new Fs(Gr.paint_line["line-border-width"]),"line-border-color":new Fs(Gr.paint_line["line-border-color"]),"line-occlusion-opacity":new As(Gr.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},fS);class LI extends Fs{possiblyEvaluate(s,a){return a=new $o(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(s,a)}evaluate(s,a,b,$){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(s,a,b,$)}}let T1;function $R(g,s){return s>0?s+2*g:g}const DI=Vn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),NI=Vn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),zI=Vn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Vn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const OI=Vn([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),BI=Vn([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),VI=Vn([{name:"a_texb",components:2,type:"Uint16"}]),UI=Vn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),$I=Vn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Vn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const GR=Vn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),GI=Vn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Vn([{name:"triangle",components:3,type:"Uint16"}]),Vn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Vn([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Vn([{type:"Float32",name:"offsetX"}]),Vn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var su=24;function HI(g,s,a){return g.sections.forEach(b=>{b.text=function($,it,st){const at=it.layout.get("text-transform").evaluate(st,{});return at==="uppercase"?$=$.toLocaleUpperCase():at==="lowercase"&&($=$.toLocaleLowerCase()),sm.applyArabicShaping&&($=sm.applyArabicShaping($)),$}(b.text,s,a)}),g}const R1={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function WI(g){return g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""}function qI(g){return g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""||g===""}const pS=4294967296,HR=1/pS,WR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let SE=class{constructor(g=new Uint8Array(16)){this.buf=ArrayBuffer.isView(g)?g:new Uint8Array(g),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(g,s,a=this.length){for(;this.pos<a;){const b=this.readVarint(),$=b>>3,it=this.pos;this.type=7&b,g($,s,this),this.pos===it&&this.skip(b)}return s}readMessage(g,s){return this.readFields(g,s,this.readVarint()+this.pos)}readFixed32(){const g=this.dataView.getUint32(this.pos,!0);return this.pos+=4,g}readSFixed32(){const g=this.dataView.getInt32(this.pos,!0);return this.pos+=4,g}readFixed64(){const g=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*pS;return this.pos+=8,g}readSFixed64(){const g=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*pS;return this.pos+=8,g}readFloat(){const g=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,g}readDouble(){const g=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,g}readVarint(g){const s=this.buf;let a,b;return b=s[this.pos++],a=127&b,b<128?a:(b=s[this.pos++],a|=(127&b)<<7,b<128?a:(b=s[this.pos++],a|=(127&b)<<14,b<128?a:(b=s[this.pos++],a|=(127&b)<<21,b<128?a:(b=s[this.pos],a|=(15&b)<<28,function($,it,st){const at=st.buf;let ht,ft;if(ft=at[st.pos++],ht=(112&ft)>>4,ft<128||(ft=at[st.pos++],ht|=(127&ft)<<3,ft<128)||(ft=at[st.pos++],ht|=(127&ft)<<10,ft<128)||(ft=at[st.pos++],ht|=(127&ft)<<17,ft<128)||(ft=at[st.pos++],ht|=(127&ft)<<24,ft<128)||(ft=at[st.pos++],ht|=(1&ft)<<31,ft<128))return M_($,ht,it);throw new Error("Expected varint not more than 10 bytes")}(a,g,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const g=this.readVarint();return g%2==1?(g+1)/-2:g/2}readBoolean(){return!!this.readVarint()}readString(){const g=this.readVarint()+this.pos,s=this.pos;return this.pos=g,g-s>=12&&WR?WR.decode(this.buf.subarray(s,g)):function(a,b,$){let it="",st=b;for(;st<$;){const at=a[st];let ht,ft,xt,Et=null,Rt=at>239?4:at>223?3:at>191?2:1;if(st+Rt>$)break;Rt===1?at<128&&(Et=at):Rt===2?(ht=a[st+1],(192&ht)==128&&(Et=(31&at)<<6|63&ht,Et<=127&&(Et=null))):Rt===3?(ht=a[st+1],ft=a[st+2],(192&ht)==128&&(192&ft)==128&&(Et=(15&at)<<12|(63&ht)<<6|63&ft,(Et<=2047||Et>=55296&&Et<=57343)&&(Et=null))):Rt===4&&(ht=a[st+1],ft=a[st+2],xt=a[st+3],(192&ht)==128&&(192&ft)==128&&(192&xt)==128&&(Et=(15&at)<<18|(63&ht)<<12|(63&ft)<<6|63&xt,(Et<=65535||Et>=1114112)&&(Et=null))),Et===null?(Et=65533,Rt=1):Et>65535&&(Et-=65536,it+=String.fromCharCode(Et>>>10&1023|55296),Et=56320|1023&Et),it+=String.fromCharCode(Et),st+=Rt}return it}(this.buf,s,g)}readBytes(){const g=this.readVarint()+this.pos,s=this.buf.subarray(this.pos,g);return this.pos=g,s}readPackedVarint(g=[],s){const a=this.readPackedEnd();for(;this.pos<a;)g.push(this.readVarint(s));return g}readPackedSVarint(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readSVarint());return g}readPackedBoolean(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readBoolean());return g}readPackedFloat(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readFloat());return g}readPackedDouble(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readDouble());return g}readPackedFixed32(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readFixed32());return g}readPackedSFixed32(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readSFixed32());return g}readPackedFixed64(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readFixed64());return g}readPackedSFixed64(g=[]){const s=this.readPackedEnd();for(;this.pos<s;)g.push(this.readSFixed64());return g}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(g){const s=7&g;if(s===0)for(;this.buf[this.pos++]>127;);else if(s===2)this.pos=this.readVarint()+this.pos;else if(s===5)this.pos+=4;else{if(s!==1)throw new Error(`Unimplemented type: ${s}`);this.pos+=8}}writeTag(g,s){this.writeVarint(g<<3|s)}realloc(g){let s=this.length||16;for(;s<this.pos+g;)s*=2;if(s!==this.length){const a=new Uint8Array(s);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=s}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(g){this.realloc(4),this.dataView.setInt32(this.pos,g,!0),this.pos+=4}writeSFixed32(g){this.realloc(4),this.dataView.setInt32(this.pos,g,!0),this.pos+=4}writeFixed64(g){this.realloc(8),this.dataView.setInt32(this.pos,-1&g,!0),this.dataView.setInt32(this.pos+4,Math.floor(g*HR),!0),this.pos+=8}writeSFixed64(g){this.realloc(8),this.dataView.setInt32(this.pos,-1&g,!0),this.dataView.setInt32(this.pos+4,Math.floor(g*HR),!0),this.pos+=8}writeVarint(g){(g=+g||0)>268435455||g<0?function(s,a){let b,$;if(s>=0?(b=s%4294967296|0,$=s/4294967296|0):(b=~(-s%4294967296),$=~(-s/4294967296),4294967295^b?b=b+1|0:(b=0,$=$+1|0)),s>=18446744073709552e3||s<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(it,st,at){at.buf[at.pos++]=127&it|128,it>>>=7,at.buf[at.pos++]=127&it|128,it>>>=7,at.buf[at.pos++]=127&it|128,it>>>=7,at.buf[at.pos++]=127&it|128,at.buf[at.pos]=127&(it>>>=7)}(b,0,a),function(it,st){const at=(7&it)<<4;st.buf[st.pos++]|=at|((it>>>=3)?128:0),it&&(st.buf[st.pos++]=127&it|((it>>>=7)?128:0),it&&(st.buf[st.pos++]=127&it|((it>>>=7)?128:0),it&&(st.buf[st.pos++]=127&it|((it>>>=7)?128:0),it&&(st.buf[st.pos++]=127&it|((it>>>=7)?128:0),it&&(st.buf[st.pos++]=127&it)))))}($,a)}(g,this):(this.realloc(4),this.buf[this.pos++]=127&g|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=127&(g>>>=7)|(g>127?128:0),g<=127||(this.buf[this.pos++]=g>>>7&127))))}writeSVarint(g){this.writeVarint(g<0?2*-g-1:2*g)}writeBoolean(g){this.writeVarint(+g)}writeString(g){g=String(g),this.realloc(4*g.length),this.pos++;const s=this.pos;this.pos=function(b,$,it){for(let st,at,ht=0;ht<$.length;ht++){if(st=$.charCodeAt(ht),st>55295&&st<57344){if(!at){st>56319||ht+1===$.length?(b[it++]=239,b[it++]=191,b[it++]=189):at=st;continue}if(st<56320){b[it++]=239,b[it++]=191,b[it++]=189,at=st;continue}st=at-55296<<10|st-56320|65536,at=null}else at&&(b[it++]=239,b[it++]=191,b[it++]=189,at=null);st<128?b[it++]=st:(st<2048?b[it++]=st>>6|192:(st<65536?b[it++]=st>>12|224:(b[it++]=st>>18|240,b[it++]=st>>12&63|128),b[it++]=st>>6&63|128),b[it++]=63&st|128)}return it}(this.buf,g,this.pos);const a=this.pos-s;a>=128&&qR(s,a,this),this.pos=s-1,this.writeVarint(a),this.pos+=a}writeFloat(g){this.realloc(4),this.dataView.setFloat32(this.pos,g,!0),this.pos+=4}writeDouble(g){this.realloc(8),this.dataView.setFloat64(this.pos,g,!0),this.pos+=8}writeBytes(g){const s=g.length;this.writeVarint(s),this.realloc(s);for(let a=0;a<s;a++)this.buf[this.pos++]=g[a]}writeRawMessage(g,s){this.pos++;const a=this.pos;g(s,this);const b=this.pos-a;b>=128&&qR(a,b,this),this.pos=a-1,this.writeVarint(b),this.pos+=b}writeMessage(g,s,a){this.writeTag(g,2),this.writeRawMessage(s,a)}writePackedVarint(g,s){s.length&&this.writeMessage(g,ZI,s)}writePackedSVarint(g,s){s.length&&this.writeMessage(g,XI,s)}writePackedBoolean(g,s){s.length&&this.writeMessage(g,QI,s)}writePackedFloat(g,s){s.length&&this.writeMessage(g,KI,s)}writePackedDouble(g,s){s.length&&this.writeMessage(g,YI,s)}writePackedFixed32(g,s){s.length&&this.writeMessage(g,JI,s)}writePackedSFixed32(g,s){s.length&&this.writeMessage(g,_k,s)}writePackedFixed64(g,s){s.length&&this.writeMessage(g,eM,s)}writePackedSFixed64(g,s){s.length&&this.writeMessage(g,tM,s)}writeBytesField(g,s){this.writeTag(g,2),this.writeBytes(s)}writeFixed32Field(g,s){this.writeTag(g,5),this.writeFixed32(s)}writeSFixed32Field(g,s){this.writeTag(g,5),this.writeSFixed32(s)}writeFixed64Field(g,s){this.writeTag(g,1),this.writeFixed64(s)}writeSFixed64Field(g,s){this.writeTag(g,1),this.writeSFixed64(s)}writeVarintField(g,s){this.writeTag(g,0),this.writeVarint(s)}writeSVarintField(g,s){this.writeTag(g,0),this.writeSVarint(s)}writeStringField(g,s){this.writeTag(g,2),this.writeString(s)}writeFloatField(g,s){this.writeTag(g,5),this.writeFloat(s)}writeDoubleField(g,s){this.writeTag(g,1),this.writeDouble(s)}writeBooleanField(g,s){this.writeVarintField(g,+s)}};function M_(g,s,a){return a?4294967296*s+(g>>>0):4294967296*(s>>>0)+(g>>>0)}function qR(g,s,a){const b=s<=16383?1:s<=2097151?2:s<=268435455?3:Math.floor(Math.log(s)/(7*Math.LN2));a.realloc(b);for(let $=a.pos-1;$>=g;$--)a.buf[$+b]=a.buf[$]}function ZI(g,s){for(let a=0;a<g.length;a++)s.writeVarint(g[a])}function XI(g,s){for(let a=0;a<g.length;a++)s.writeSVarint(g[a])}function KI(g,s){for(let a=0;a<g.length;a++)s.writeFloat(g[a])}function YI(g,s){for(let a=0;a<g.length;a++)s.writeDouble(g[a])}function QI(g,s){for(let a=0;a<g.length;a++)s.writeBoolean(g[a])}function JI(g,s){for(let a=0;a<g.length;a++)s.writeFixed32(g[a])}function _k(g,s){for(let a=0;a<g.length;a++)s.writeSFixed32(g[a])}function eM(g,s){for(let a=0;a<g.length;a++)s.writeFixed64(g[a])}function tM(g,s){for(let a=0;a<g.length;a++)s.writeSFixed64(g[a])}const mS=3;function rM(g,s,a){s.glyphs=[],g===1&&a.readMessage(iM,s)}function iM(g,s,a){if(g===3){const{id:b,bitmap:$,width:it,height:st,left:at,top:ht,advance:ft}=a.readMessage(sM,{});s.glyphs.push({id:b,bitmap:new Xx({width:it+2*mS,height:st+2*mS},$),metrics:{width:it,height:st,left:at,top:ht,advance:ft}})}else g===4?s.ascender=a.readSVarint():g===5&&(s.descender=a.readSVarint())}function sM(g,s,a){g===1?s.id=a.readVarint():g===2?s.bitmap=a.readBytes():g===3?s.width=a.readVarint():g===4?s.height=a.readVarint():g===5?s.left=a.readSVarint():g===6?s.top=a.readSVarint():g===7&&(s.advance=a.readVarint())}const ZR=mS,np={horizontal:1,vertical:2,horizontalOnly:3};class C1{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(s,a){const b=new C1;return b.scale=s||1,b.fontStack=a,b}static forImage(s){const a=new C1;return a.image=s,a}}class F_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(s,a,b){const $=new F_;for(let it=0;it<s.sections.length;it++){const st=s.sections[it];st.image?$.addImageSection(st,b):$.addTextSection(st,a)}return $}length(){return this.text.length}getSection(s){return this.sections[this.sectionIndex[s]]}getSections(){return this.sections}getSectionIndex(s){return this.sectionIndex[s]}getCodePoint(s){return this.text.codePointAt(s)}verticalizePunctuation(s){this.text=function(a,b){let $="";for(let it=0;it<a.length;it++){const st=a.charCodeAt(it+1)||null,at=a.charCodeAt(it-1)||null;$+=!b&&(st&&K0(st)&&!R1[a[it+1]]||at&&K0(at)&&!R1[a[it-1]])||!R1[a[it]]?a[it]:R1[a[it]]}return $}(this.text,s)}trim(){let s=0;for(let b=0;b<this.text.length&&TE[this.text.charCodeAt(b)];b++)s++;let a=this.text.length;for(let b=this.text.length-1;b>=0&&b>=s&&TE[this.text.charCodeAt(b)];b--)a--;this.text=this.text.substring(s,a),this.sectionIndex=this.sectionIndex.slice(s,a)}substring(s,a){const b=new F_;return b.text=this.text.substring(s,a),b.sectionIndex=this.sectionIndex.slice(s,a),b.sections=this.sections,b}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((s,a)=>Math.max(s,this.sections[a].scale),0)}addTextSection(s,a){this.text+=s.text,this.sections.push(C1.forText(s.scale,s.fontStack||a));const b=this.sections.length-1;for(let $=0;$<s.text.length;++$)this.sectionIndex.push(b)}addImageSection(s,a){const b=s.image?s.image.getPrimary():null;if(!b)return void $s("Can't add FormattedSection with an empty image.");b.scaleSelf(a);const $=this.getNextImageSectionCharCode();$?(this.text+=String.fromCodePoint($),this.sections.push(C1.forImage(b)),this.sectionIndex.push(this.sections.length-1)):$s("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gS(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt=1){const Kt=F_.fromFeature(g,$,Gt);Et===np.vertical&&Kt.verticalizePunctuation(Rt);let Xt=[];const nr=function(Rr,kr,Lr,is,Br,as){if(!Rr)return[];const ds=[],fs=function(ys,os,ss,_s,Is,Rs){let rn=0;for(let zs=0;zs<ys.length();zs++){const Hs=ys.getSection(zs);rn+=XR(ys.getCodePoint(zs),Hs,_s,Is,os,Rs)}return rn/Math.max(1,Math.ceil(rn/ss))}(Rr,kr,Lr,is,Br,as),vs=Rr.text.indexOf("")>=0;let ws=0;for(let ys=0;ys<Rr.length();ys++){const os=Rr.getSection(ys),ss=Rr.getCodePoint(ys);if(TE[ss]||(ws+=XR(ss,os,is,Br,kr,as)),ys<Rr.length()-1){const _s=!((xs=ss)<11904||!(un["Bopomofo Extended"](xs)||un.Bopomofo(xs)||un["CJK Compatibility Forms"](xs)||un["CJK Compatibility Ideographs"](xs)||un["CJK Compatibility"](xs)||un["CJK Radicals Supplement"](xs)||un["CJK Strokes"](xs)||un["CJK Symbols and Punctuation"](xs)||un["CJK Unified Ideographs Extension A"](xs)||un["CJK Unified Ideographs"](xs)||un["Enclosed CJK Letters and Months"](xs)||un["Halfwidth and Fullwidth Forms"](xs)||un.Hiragana(xs)||un["Ideographic Description Characters"](xs)||un["Kangxi Radicals"](xs)||un["Katakana Phonetic Extensions"](xs)||un.Katakana(xs)||un["Vertical Forms"](xs)||un["Yi Radicals"](xs)||un["Yi Syllables"](xs)));(nM[ss]||_s||os.image)&&ds.push(YR(ys+1,ws,fs,ds,oM(ss,Rr.getCodePoint(ys+1),_s&&vs),!1))}}var xs;return QR(YR(Rr.length(),ws,fs,ds,0,!0))}(Kt,ft,it,s,b,Pt),{processBidirectionalText:lr,processStyledBidirectionalText:hr}=sm;if(lr&&Kt.sections.length===1){const Rr=lr(Kt.toString(),nr);for(const kr of Rr){const Lr=new F_;Lr.text=kr,Lr.sections=Kt.sections;for(let is=0;is<kr.length;is++)Lr.sectionIndex.push(0);Xt.push(Lr)}}else if(hr){const Rr=hr(Kt.text,Kt.sectionIndex,nr);for(const kr of Rr){const Lr=new F_;Lr.text=kr[0],Lr.sectionIndex=kr[1],Lr.sections=Kt.sections,Xt.push(Lr)}}else Xt=function(Rr,kr){const Lr=[],is=Rr.text;let Br=0;for(const as of kr)Lr.push(Rr.substring(Br,as)),Br=as;return Br<is.length&&Lr.push(Rr.substring(Br,is.length)),Lr}(Kt,nr);const Er=[],_r={positionedLines:Er,text:Kt.toString(),top:xt[1],bottom:xt[1],left:xt[0],right:xt[0],writingMode:Et,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(Rr,kr,Lr,is,Br,as,ds,fs,vs,ws,xs,ys){let os=0,ss=0,_s=0;const Is=fs==="right"?1:fs==="left"?0:.5;let Rs=!1;for(const Cs of Br){const Qs=Cs.getSections();for(const vn of Qs){if(vn.image)continue;const Wn=kr[vn.fontStack];if(Wn&&(Rs=Wn.ascender!==void 0&&Wn.descender!==void 0,!Rs))break}if(!Rs)break}let rn=0;for(const Cs of Br){Cs.trim();const Qs=Cs.getMaxScale(),vn=(Qs-1)*su,Wn={positionedGlyphs:[],lineOffset:0};Rr.positionedLines[rn]=Wn;const Xn=Wn.positionedGlyphs;let Rn=0;if(!Cs.length()){ss+=as,++rn;continue}let Co=0,vr=0;for(let ls=0;ls<Cs.length();ls++){const bs=Cs.getSection(ls),Ls=Cs.getSectionIndex(ls),Ds=Cs.getCodePoint(ls);let sn=bs.scale,on=null,Sn=null,Fn=null,Dn=su,Un=0,fn=vs;fn===np.vertical&&((zs=Ds)===12312||zs===12313||zs===12316||zs===12540||zs===12448)&&(fn=np.horizontal);const xn=!(fn===np.horizontal||!xs&&!X0(Ds)||xs&&(TE[Ds]||Y0(Ds)));if(bs.image){const ro=is.get(bs.image.toString());if(!ro)continue;Fn=bs.image,Rr.iconsInText=Rr.iconsInText||!0,Sn=ro.paddedRect;const lo=ro.displaySize;sn=sn*su/ys,on={width:lo[0],height:lo[1],left:0,top:-ZR,advance:xn?lo[1]:lo[0],localGlyph:!1},Un=Rs?-on.height*sn:Qs*su-17-lo[1]*sn,Dn=on.advance;const co=(xn?lo[0]:lo[1])*sn-su*Qs;co>0&&co>Rn&&(Rn=co)}else{const ro=Lr[bs.fontStack];if(!ro)continue;ro[Ds]&&(Sn=ro[Ds]);const lo=kr[bs.fontStack];if(!lo)continue;const co=lo.glyphs[Ds];if(!co)continue;if(on=co.metrics,Dn=Ds!==8203?su:0,Rs){const wo=lo.ascender!==void 0?Math.abs(lo.ascender):0,Fo=lo.descender!==void 0?Math.abs(lo.descender):0,Ao=(wo+Fo)*sn;Co<Ao&&(Co=Ao,vr=(wo-Fo)/2*sn),Un=-wo*sn}else Un=(Qs-sn)*su-17}xn?(Rr.verticalizable=!0,Xn.push({glyph:Ds,image:Fn,x:os,y:ss+Un,vertical:xn,scale:sn,localGlyph:on.localGlyph,fontStack:bs.fontStack,sectionIndex:Ls,metrics:on,rect:Sn}),os+=Dn*sn+ws):(Xn.push({glyph:Ds,image:Fn,x:os,y:ss+Un,vertical:xn,scale:sn,localGlyph:on.localGlyph,fontStack:bs.fontStack,sectionIndex:Ls,metrics:on,rect:Sn}),os+=on.advance*sn+ws)}Xn.length!==0&&(_s=Math.max(os-ws,_s),Rs?JR(Xn,Is,Rn,vr,as*Qs/2):JR(Xn,Is,Rn,0,as/2)),os=0;const Sr=as*Qs+Rn;Wn.lineOffset=Math.max(Rn,vn),ss+=Sr,++rn}var zs;const Hs=ss,{horizontalAlign:Ys,verticalAlign:zn}=xS(ds);(function(Cs,Qs,vn,Wn,Xn,Rn){const Co=(Qs-vn)*Xn,vr=-Rn*Wn;for(const Sr of Cs)for(const ls of Sr.positionedGlyphs)ls.x+=Co,ls.y+=vr})(Rr.positionedLines,Is,Ys,zn,_s,Hs),Rr.top+=-zn*Hs,Rr.bottom=Rr.top+Hs,Rr.left+=-Ys*_s,Rr.right=Rr.left+_s,Rr.hasBaseline=Rs}(_r,s,a,b,Xt,st,at,ht,Et,ft,Rt,Lt),!function(Rr){for(const kr of Rr)if(kr.positionedGlyphs.length!==0)return!1;return!0}(Er))return _r}const TE={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nM={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function XR(g,s,a,b,$,it){if(s.image){const st=b.get(s.image.toString());return st?st.displaySize[0]*s.scale*su/it+$:0}{const st=a[s.fontStack],at=st&&st.glyphs[g];return at?at.metrics.advance*s.scale+$:0}}function KR(g,s,a,b){const $=Math.pow(g-s,2);return b?g<s?$/2:2*$:$+Math.abs(a)*a}function oM(g,s,a){let b=0;return g===10&&(b-=1e4),a&&(b+=150),g!==40&&g!==65288||(b+=50),s!==41&&s!==65289||(b+=50),b}function YR(g,s,a,b,$,it){let st=null,at=KR(s,a,$,it);for(const ht of b){const ft=KR(s-ht.x,a,$,it)+ht.badness;ft<=at&&(st=ht,at=ft)}return{index:g,x:s,priorBreak:st,badness:at}}function QR(g){return g?QR(g.priorBreak).concat(g.index):[]}function xS(g){let s=.5,a=.5;switch(g){case"right":case"top-right":case"bottom-right":s=1;break;case"left":case"top-left":case"bottom-left":s=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:s,verticalAlign:a}}function JR(g,s,a,b,$){if(!(s||a||b||$))return;const it=g.length-1,st=g[it],at=(st.x+st.metrics.advance*st.scale)*s;for(let ht=0;ht<=it;ht++)g[ht].x-=at,g[ht].y+=a+b+$}function yS(g){return g.imagePrimary!==void 0&&g.top!==void 0&&g.bottom!==void 0&&g.left!==void 0&&g.right!==void 0}function RE(g,s,a,b){const{horizontalAlign:$,verticalAlign:it}=xS(b),st=a[0]-g.displaySize[0]*$,at=a[1]-g.displaySize[1]*it;return{imagePrimary:g,imageSecondary:s,top:at,bottom:at+g.displaySize[1],left:st,right:st+g.displaySize[0]}}function _S(g,s,a,b,$,it){const st=g.imagePrimary;let at;if(st.content){const Kt=st.content,Xt=st.pixelRatio||1;at=[Kt[0]/Xt,Kt[1]/Xt,st.displaySize[0]-Kt[2]/Xt,st.displaySize[1]-Kt[3]/Xt]}const ht=s.left*it,ft=s.right*it;let xt,Et,Rt,Pt;a==="width"||a==="both"?(Pt=$[0]+ht-b[3],Et=$[0]+ft+b[1]):(Pt=$[0]+(ht+ft-st.displaySize[0])/2,Et=Pt+st.displaySize[0]);const Lt=s.top*it,Gt=s.bottom*it;return a==="height"||a==="both"?(xt=$[1]+Lt-b[0],Rt=$[1]+Gt+b[2]):(xt=$[1]+(Lt+Gt-st.displaySize[1])/2,Rt=xt+st.displaySize[1]),{imagePrimary:st,imageSecondary:void 0,top:xt,right:Et,bottom:Rt,left:Pt,collisionPadding:at}}function eC(g){return!g.imagePrimary.stretchX}function tC(g){return!g.imagePrimary.stretchY}function rC(g){return{width:g.right-g.left,height:g.bottom-g.top}}const mm=128;function L_(g,s,a){const{expression:b}=s;if(b.kind==="constant")return{kind:"constant",layoutSize:b.evaluate(new $o(g+1,{worldview:a}))};if(b.kind==="source")return{kind:"source"};{const{zoomStops:$,interpolationType:it}=b;let st=0;for(;st<$.length&&$[st]<=g;)st++;st=Math.max(0,st-1);let at=st;for(;at<$.length&&$[at]<g+1;)at++;at=Math.min($.length-1,at);const ht=$[st],ft=$[at];return b.kind==="composite"?{kind:"composite",minZoom:ht,maxZoom:ft,interpolationType:it}:{kind:"camera",minZoom:ht,maxZoom:ft,minSize:b.evaluate(new $o(ht,{worldview:a})),maxSize:b.evaluate(new $o(ft,{worldview:a})),interpolationType:it}}}function vS(g,{uSize:s,uSizeT:a},{lowerSize:b,upperSize:$}){return g.kind==="source"?b/mm:g.kind==="composite"?pn(b/mm,$/mm,a):s}function D_(g,s,a=1){let b=0,$=0;if(g.kind==="constant")$=g.layoutSize*a;else if(g.kind!=="source"){const{interpolationType:it,minZoom:st,maxZoom:at}=g,ht=it?Qt(_f.interpolationFactor(it,s,st,at),0,1):0;g.kind==="camera"?$=pn(g.minSize,g.maxSize,ht)*a:b=ht*a}return{uSizeT:b,uSize:$}}class xx extends ps{constructor(s,a,b,$,it){super(s,a),this.angle=$,this.z=b,it!==void 0&&(this.segment=it)}clone(){return new xx(this.x,this.y,this.z,this.angle,this.segment)}}function iC(g,s,a,b,$){if(s.segment===void 0)return!0;let it=s,st=s.segment+1,at=0;for(;at>-a/2;){if(st--,st<0)return!1;at-=g[st].dist(it),it=g[st]}at+=g[st].dist(g[st+1]),st++;const ht=[];let ft=0;for(;at<a/2;){const xt=g[st],Et=g[st+1];if(!Et)return!1;let Rt=g[st-1].angleTo(xt)-xt.angleTo(Et);for(Rt=Math.abs((Rt+3*Math.PI)%(2*Math.PI)-Math.PI),ht.push({distance:at,angleDelta:Rt}),ft+=Rt;at-ht[0].distance>b;)ft-=ht.shift().angleDelta;if(ft>$)return!1;st++,at+=xt.dist(Et)}return!0}function sC(g){let s=0;for(let a=0;a<g.length-1;a++)s+=g[a].dist(g[a+1]);return s}function nC(g,s,a){return g?.6*s*a:0}function oC(g,s){return Math.max(g?g.right-g.left:0,s?s.right-s.left:0)}function aM(g,s,a,b,$,it){const st=nC(a,$,it),at=oC(a,b)*it;let ht=0;const ft=sC(g)/2;for(let xt=0;xt<g.length-1;xt++){const Et=g[xt],Rt=g[xt+1],Pt=Et.dist(Rt);if(ht+Pt>ft){const Lt=(ft-ht)/Pt,Gt=pn(Et.x,Rt.x,Lt),Kt=pn(Et.y,Rt.y,Lt),Xt=new xx(Gt,Kt,0,Rt.angleTo(Et),xt);return!st||iC(g,Xt,at,st,s)?Xt:void 0}ht+=Pt}}function lM(g,s,a,b,$,it,st,at,ht){const ft=nC(b,it,st),xt=oC(b,$),Et=xt*st,Rt=g[0].x===0||g[0].x===ht||g[0].y===0||g[0].y===ht;return s-Et<s/4&&(s=Et+s/4),aC(g,Rt?s/2*at%s:(xt/2+2*it)*st*at%s,s,ft,a,Et,Rt,!1,ht)}function aC(g,s,a,b,$,it,st,at,ht){const ft=it/2,xt=sC(g);let Et=0,Rt=s-a,Pt=[];for(let Lt=0;Lt<g.length-1;Lt++){const Gt=g[Lt],Kt=g[Lt+1],Xt=Gt.dist(Kt),nr=Kt.angleTo(Gt);for(;Rt+a<Et+Xt;){Rt+=a;const lr=(Rt-Et)/Xt,hr=pn(Gt.x,Kt.x,lr),Er=pn(Gt.y,Kt.y,lr);if(hr>=0&&hr<ht&&Er>=0&&Er<ht&&Rt-ft>=0&&Rt+ft<=xt){const _r=new xx(hr,Er,0,nr,Lt);b&&!iC(g,_r,it,b,$)||Pt.push(_r)}}Et+=Xt}return at||Pt.length||st||(Pt=aC(g,Et/2,a,b,$,it,st,!0,ht)),Pt}function lC(g){let s=0,a=0;for(const st of g)s+=st.w*st.h,a=Math.max(a,st.w);g.sort((st,at)=>at.h-st.h);const b=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(s/.95)),a),h:1/0}];let $=0,it=0;for(const st of g)for(let at=b.length-1;at>=0;at--){const ht=b[at];if(!(st.w>ht.w||st.h>ht.h)){if(st.x=ht.x,st.y=ht.y,it=Math.max(it,st.y+st.h),$=Math.max($,st.x+st.w),st.w===ht.w&&st.h===ht.h){const ft=b.pop();ft&&at<b.length&&(b[at]=ft)}else st.h===ht.h?(ht.x+=st.w,ht.w-=st.w):st.w===ht.w?(ht.y+=st.h,ht.h-=st.h):(b.push({x:ht.x+st.w,y:ht.y,w:ht.w-st.w,h:st.h}),ht.y+=st.h,ht.h-=st.h);break}}return{w:$,h:it,fill:s/($*it)||0}}Xs(xx,"Anchor");const Qy=1;class A1{static getImagePositionScale(s,a,b){if(a&&s){const{sx:$,sy:it}=s;return{x:$,y:it}}return{x:b,y:b}}constructor(s,a,b,$){this.paddedRect=s;const{pixelRatio:it,version:st,stretchX:at,stretchY:ht,content:ft,sdf:xt,usvg:Et}=a;this.pixelRatio=it,this.stretchX=at,this.stretchY=ht,this.content=ft,this.version=st,this.padding=b,this.sdf=xt,this.usvg=Et,this.scale=A1.getImagePositionScale($,Et,it)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function bS(g,s,a){const b=Yp.parse(g),$=function(it,st,at=[1,1]){return{x:0,y:0,w:(it.data?it.data.width:it.width*at[0])+2*st,h:(it.data?it.data.height:it.height*at[1])+2*st}}(s,a,[b.sx,b.sy]);return{bin:$,imagePosition:new A1($,s,a,b),imageVariant:b}}class cC{constructor(s,a,b){const $=new Map,it=new Map;this.haveRenderCallbacks=[];const st=[];this.addImages(s,$,Qy,st),this.addImages(a,it,2,st);const{w:at,h:ht}=lC(st),ft=new Ru({width:at||1,height:ht||1});for(const[xt,Et]of s.entries()){const Rt=$.get(xt).paddedRect;Ru.copy(Et.data,ft,{x:0,y:0},{x:Rt.x+Qy,y:Rt.y+Qy},Et.data,null,Et.sdf)}for(const[xt,Et]of a.entries()){const Rt=it.get(xt),Pt=Rt.paddedRect;let Lt=Rt.padding;const Gt=Pt.x+Lt,Kt=Pt.y+Lt,Xt=Et.data.width,nr=Et.data.height;Lt=Lt>1?Lt-1:Lt,Ru.copy(Et.data,ft,{x:0,y:0},{x:Gt,y:Kt},Et.data,b),Ru.copy(Et.data,ft,{x:0,y:nr-Lt},{x:Gt,y:Kt-Lt},{width:Xt,height:Lt},b),Ru.copy(Et.data,ft,{x:0,y:0},{x:Gt,y:Kt+nr},{width:Xt,height:Lt},b),Ru.copy(Et.data,ft,{x:Xt-Lt,y:0},{x:Gt-Lt,y:Kt},{width:Lt,height:nr},b),Ru.copy(Et.data,ft,{x:0,y:0},{x:Gt+Xt,y:Kt},{width:Lt,height:nr},b),Ru.copy(Et.data,ft,{x:Xt-Lt,y:nr-Lt},{x:Gt-Lt,y:Kt-Lt},{width:Lt,height:Lt},b),Ru.copy(Et.data,ft,{x:0,y:nr-Lt},{x:Gt+Xt,y:Kt-Lt},{width:Lt,height:Lt},b),Ru.copy(Et.data,ft,{x:0,y:0},{x:Gt+Xt,y:Kt+nr},{width:Lt,height:Lt},b),Ru.copy(Et.data,ft,{x:Xt-Lt,y:0},{x:Gt-Lt,y:Kt+nr},{width:Lt,height:Lt},b)}this.lut=b,this.image=ft,this.iconPositions=$,this.patternPositions=it}addImages(s,a,b,$){for(const[it,st]of s.entries()){const{bin:at,imagePosition:ht,imageVariant:ft}=bS(it,st,b);a.set(it,ht),$.push(at),st.hasRenderCallback&&this.haveRenderCallbacks.push(ft.id)}}patchUpdatedImages(s,a,b){this.haveRenderCallbacks=this.haveRenderCallbacks.filter($=>s.hasImage($,b)),s.dispatchRenderCallbacks(this.haveRenderCallbacks,b);for(const $ of s.getUpdatedImages(b)){for(const it of this.iconPositions.keys()){const st=Yp.parse(it);if(Au.isEqual(st.id,$)){const at=s.getImage($,b);this.patchUpdatedImage(this.iconPositions.get(it),at,a,null)}}for(const it of this.patternPositions.keys()){const st=Yp.parse(it);if(Au.isEqual(st.id,$)){const at=s.getImage($,b);this.patchUpdatedImage(this.patternPositions.get(it),at,a,this.lut)}}}}patchUpdatedImage(s,a,b,$=null){if(!s||!a||s.version===a.version)return;s.version=a.version;const[it,st]=s.tl,at=s.sdf;if(this.lut||at){const ht={width:a.data.width,height:a.data.height},ft=new Ru(ht);Ru.copy(a.data,ft,{x:0,y:0},{x:0,y:0},ht,$,at),b.update(ft,{position:{x:it,y:st}})}else b.update(a.data,{position:{x:it,y:st}})}}Xs(A1,"ImagePosition"),Xs(cC,"ImageAtlas");const j1=1e20;function uC(g,s,a,b,$,it,st,at,ht){for(let ft=s;ft<s+b;ft++)hC(g,a*it+ft,it,$,st,at,ht);for(let ft=a;ft<a+$;ft++)hC(g,ft*it+s,1,b,st,at,ht)}function hC(g,s,a,b,$,it,st){it[0]=0,st[0]=-j1,st[1]=j1,$[0]=g[s];for(let at=1,ht=0,ft=0;at<b;at++){$[at]=g[s+at*a];const xt=at*at;do{const Et=it[ht];ft=($[at]-$[Et]+xt-Et*Et)/(at-Et)/2}while(ft<=st[ht]&&--ht>-1);ht++,it[ht]=at,st[ht]=ft,st[ht+1]=j1}for(let at=0,ht=0;at<b;at++){for(;st[ht+1]<at;)ht++;const ft=it[ht],xt=at-ft;g[s+at*a]=$[ft]+xt*xt}}const gm=2,wS={none:0,ideographs:1,all:2};class N_{constructor(s,a,b){this.requestManager=s,this.localGlyphMode=a,this.localFontFamily=b,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(s){this.url=s}getGlyphs(s,a){const b=[],$=this.url||Gn.GLYPHS_URL;for(const it in s)for(const st of s[it])b.push({stack:it,id:st});Mr(b,({stack:it,id:st},at)=>{let ht=this.entries[it];ht||(ht=this.entries[it]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let ft=ht.glyphs[st];if(ft!==void 0)return void at(null,{stack:it,id:st,glyph:ft});if(ft=this._tinySDF(ht,it,st),ft)return ht.glyphs[st]=ft,void at(null,{stack:it,id:st,glyph:ft});const xt=Math.floor(st/256);if(256*xt>65535)return $s("glyphs > 65535 not supported"),void at(null,{stack:it,id:st,glyph:ft});if(ht.ranges[xt])return void at(null,{stack:it,id:st,glyph:ft});let Et=ht.requests[xt];Et||(Et=ht.requests[xt]=[],N_.loadGlyphRange(it,xt,$,this.requestManager,(Rt,Pt)=>{if(Pt){ht.ascender=Pt.ascender,ht.descender=Pt.descender;for(const Lt in Pt.glyphs)this._doesCharSupportLocalGlyph(+Lt)||(ht.glyphs[+Lt]=Pt.glyphs[+Lt]);ht.ranges[xt]=!0}for(const Lt of Et)Lt(Rt,Pt);delete ht.requests[xt]})),Et.push((Rt,Pt)=>{Rt?at(Rt):Pt&&at(null,{stack:it,id:st,glyph:Pt.glyphs[st]||null})})},(it,st)=>{if(it)a(it);else if(st){const at={};for(const{stack:ht,id:ft,glyph:xt}of st)at[ht]===void 0&&(at[ht]={}),at[ht].glyphs===void 0&&(at[ht].glyphs={}),at[ht].glyphs[ft]=xt&&{id:xt.id,bitmap:xt.bitmap.clone(),metrics:xt.metrics},at[ht].ascender=this.entries[ht].ascender,at[ht].descender=this.entries[ht].descender;a(null,at)}})}_doesCharSupportLocalGlyph(s){return this.localGlyphMode!==wS.none&&(this.localGlyphMode===wS.all?!!this.localFontFamily:!!this.localFontFamily&&(un["CJK Unified Ideographs"](s)||un["Hangul Syllables"](s)||un.Hiragana(s)||un.Katakana(s)||un["CJK Symbols and Punctuation"](s)||un["CJK Unified Ideographs Extension A"](s)||un["CJK Unified Ideographs Extension B"](s)||un.Osage(s)))}_tinySDF(s,a,b){const $=this.localFontFamily;if(!$||!this._doesCharSupportLocalGlyph(b))return;let it=s.tinySDF;if(!it){let Gt="400";/bold/i.test(a)?Gt="900":/medium/i.test(a)?Gt="500":/light/i.test(a)&&(Gt="200"),it=s.tinySDF=new N_.TinySDF({fontFamily:$,fontWeight:Gt,fontSize:24*gm,buffer:3*gm,radius:8*gm}),it.fontWeight=Gt}if(this.localGlyphs[it.fontWeight][b])return this.localGlyphs[it.fontWeight][b];const st=String.fromCodePoint(b),{data:at,width:ht,height:ft,glyphWidth:xt,glyphHeight:Et,glyphLeft:Rt,glyphTop:Pt,glyphAdvance:Lt}=it.draw(st);return this.localGlyphs[it.fontWeight][b]={id:b,bitmap:new Xx({width:ht,height:ft},at),metrics:{width:xt/gm,height:Et/gm,left:Rt/gm,top:Pt/gm-27,advance:Lt/gm,localGlyph:!0}}}}N_.loadGlyphRange=function(g,s,a,b,$){const it=256*s,st=it+255,at=b.transformRequest(b.normalizeGlyphsURL(a).replace("{fontstack}",g).replace("{range}",`${it}-${st}`),cy.Glyphs);Kp(at,(ht,ft)=>{if(ht)$(ht);else if(ft){const xt={},Et=function(Rt){return new SE(Rt).readFields(rM,{})}(ft);for(const Rt of Et.glyphs)xt[Rt.id]=Rt;$(null,{glyphs:xt,ascender:Et.ascender,descender:Et.descender})}})},N_.TinySDF=class{constructor({fontSize:g=24,buffer:s=3,radius:a=8,cutoff:b=.25,fontFamily:$="sans-serif",fontWeight:it="normal",fontStyle:st="normal",lang:at=null}={}){this.buffer=s,this.cutoff=b,this.radius=a,this.lang=at;const ht=this.size=g+4*s,ft=this._createCanvas(ht),xt=this.ctx=ft.getContext("2d",{willReadFrequently:!0});xt.font=`${st} ${it} ${g}px ${$}`,xt.textBaseline="alphabetic",xt.textAlign="left",xt.fillStyle="black",this.gridOuter=new Float64Array(ht*ht),this.gridInner=new Float64Array(ht*ht),this.f=new Float64Array(ht),this.z=new Float64Array(ht+1),this.v=new Uint16Array(ht)}_createCanvas(g){const s=document.createElement("canvas");return s.width=s.height=g,s}draw(g){const{width:s,actualBoundingBoxAscent:a,actualBoundingBoxDescent:b,actualBoundingBoxLeft:$,actualBoundingBoxRight:it}=this.ctx.measureText(g),st=Math.ceil(a),at=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(it-$))),ht=Math.min(this.size-this.buffer,st+Math.ceil(b)),ft=at+2*this.buffer,xt=ht+2*this.buffer,Et=Math.max(ft*xt,0),Rt=new Uint8ClampedArray(Et),Pt={data:Rt,width:ft,height:xt,glyphWidth:at,glyphHeight:ht,glyphTop:st,glyphLeft:0,glyphAdvance:s};if(at===0||ht===0)return Pt;const{ctx:Lt,buffer:Gt,gridInner:Kt,gridOuter:Xt}=this;this.lang&&(Lt.lang=this.lang),Lt.clearRect(Gt,Gt,at,ht),Lt.fillText(g,Gt,Gt+st);const nr=Lt.getImageData(Gt,Gt,at,ht);Xt.fill(j1,0,Et),Kt.fill(0,0,Et);for(let lr=0;lr<ht;lr++)for(let hr=0;hr<at;hr++){const Er=nr.data[4*(lr*at+hr)+3]/255;if(Er===0)continue;const _r=(lr+Gt)*ft+hr+Gt;if(Er===1)Xt[_r]=0,Kt[_r]=j1;else{const Rr=.5-Er;Xt[_r]=Rr>0?Rr*Rr:0,Kt[_r]=Rr<0?Rr*Rr:0}}uC(Xt,0,0,ft,xt,ft,this.f,this.v,this.z),uC(Kt,Gt,Gt,at,ht,ft,this.f,this.v,this.z);for(let lr=0;lr<Et;lr++){const hr=Math.sqrt(Xt[lr])-Math.sqrt(Kt[lr]);Rt[lr]=Math.round(255-255*(hr/this.radius+this.cutoff))}return Pt}};const $m=Qy;function dC(g,s){return g+s[1]-s[0]}function ES(g,s,a,b,$=1){const it=[],st=g.imagePrimary,at=st.pixelRatio,ht=st.paddedRect.w-2*$m,ft=st.paddedRect.h-2*$m,xt=(g.right-g.left)*$,Et=(g.bottom-g.top)*$,Rt=st.stretchX||[[0,ht]],Pt=st.stretchY||[[0,ft]],Lt=Rt.reduce(dC,0),Gt=Pt.reduce(dC,0),Kt=ht-Lt,Xt=ft-Gt;let nr=0,lr=Lt,hr=0,Er=Gt,_r=0,Rr=Kt,kr=0,Lr=Xt;if(st.content&&b){const Br=st.content;nr=CE(Rt,0,Br[0]),hr=CE(Pt,0,Br[1]),lr=CE(Rt,Br[0],Br[2]),Er=CE(Pt,Br[1],Br[3]),_r=Br[0]-nr,kr=Br[1]-hr,Rr=Br[2]-Br[0]-lr,Lr=Br[3]-Br[1]-Er}const is=(Br,as,ds,fs)=>{const vs=AE(Br.stretch-nr,lr,xt,g.left*$),ws=jE(Br.fixed-_r,Rr,Br.stretch,Lt),xs=AE(as.stretch-hr,Er,Et,g.top*$),ys=jE(as.fixed-kr,Lr,as.stretch,Gt),os=AE(ds.stretch-nr,lr,xt,g.left*$),ss=jE(ds.fixed-_r,Rr,ds.stretch,Lt),_s=AE(fs.stretch-hr,Er,Et,g.top*$),Is=jE(fs.fixed-kr,Lr,fs.stretch,Gt),Rs=new ps(vs,xs),rn=new ps(os,xs),zs=new ps(os,_s),Hs=new ps(vs,_s),Ys=new ps(ws/at,ys/at),zn=new ps(ss/at,Is/at),Cs=s*Math.PI/180;if(Cs){const Co=Math.sin(Cs),vr=Math.cos(Cs),Sr=[vr,-Co,Co,vr];Rs._matMult(Sr),rn._matMult(Sr),Hs._matMult(Sr),zs._matMult(Sr)}const Qs=Br.stretch+Br.fixed,vn=ds.stretch+ds.fixed,Wn=as.stretch+as.fixed,Xn=fs.stretch+fs.fixed,Rn=g.imageSecondary;return{tl:Rs,tr:rn,bl:Hs,br:zs,texPrimary:{x:st.paddedRect.x+$m+Qs,y:st.paddedRect.y+$m+Wn,w:vn-Qs,h:Xn-Wn},texSecondary:Rn?{x:Rn.paddedRect.x+$m+Qs,y:Rn.paddedRect.y+$m+Wn,w:vn-Qs,h:Xn-Wn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ys,pixelOffsetBR:zn,minFontScaleX:Rr/at/xt,minFontScaleY:Lr/at/Et,isSDF:a}};if(b&&(st.stretchX||st.stretchY)){const Br=fC(Rt,Kt,Lt),as=fC(Pt,Xt,Gt);for(let ds=0;ds<Br.length-1;ds++){const fs=Br[ds],vs=Br[ds+1];for(let ws=0;ws<as.length-1;ws++)it.push(is(fs,as[ws],vs,as[ws+1]))}}else it.push(is({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ht+1},{fixed:0,stretch:ft+1}));return it}function cM(g,s){const a=g.stretchY||[[0,g.paddedRect.h-2*$m]];return s&&(g.stretchX||g.stretchY)?pC(g.stretchX||[[0,g.paddedRect.w-2*$m]])*pC(a):1}function CE(g,s,a){let b=0;for(const $ of g)b+=Math.max(s,Math.min(a,$[1]))-Math.max(s,Math.min(a,$[0]));return b}function fC(g,s,a){const b=[{fixed:-$m,stretch:0}];for(const[$,it]of g){const st=b[b.length-1];b.push({fixed:$-st.stretch,stretch:st.stretch}),b.push({fixed:$-st.stretch,stretch:st.stretch+(it-$)})}return b.push({fixed:s+$m,stretch:a}),b}function pC(g){return 2*g.length+1}function AE(g,s,a,b){return g/s*a+b}function jE(g,s,a,b){return g-s*a/b}function uM(g,s,a,b){const $=s+g.positionedLines[b].lineOffset;return b===0?a+$/2:a+($+(s+g.positionedLines[b-1].lineOffset))/2}function hM(g,s=1,a=!1){let b=1/0,$=1/0,it=-1/0,st=-1/0;const at=g[0];for(let Pt=0;Pt<at.length;Pt++){const Lt=at[Pt];(!Pt||Lt.x<b)&&(b=Lt.x),(!Pt||Lt.y<$)&&($=Lt.y),(!Pt||Lt.x>it)&&(it=Lt.x),(!Pt||Lt.y>st)&&(st=Lt.y)}const ht=Math.min(it-b,st-$);let ft=ht/2;const xt=new C0([],dM);if(ht===0)return new ps(b,$);for(let Pt=b;Pt<it;Pt+=ht)for(let Lt=$;Lt<st;Lt+=ht)xt.push(new z_(Pt+ft,Lt+ft,ft,g));let Et=function(Pt){let Lt=0,Gt=0,Kt=0;const Xt=Pt[0];for(let nr=0,lr=Xt.length,hr=lr-1;nr<lr;hr=nr++){const Er=Xt[nr],_r=Xt[hr],Rr=Er.x*_r.y-_r.x*Er.y;Gt+=(Er.x+_r.x)*Rr,Kt+=(Er.y+_r.y)*Rr,Lt+=3*Rr}return new z_(Gt/Lt,Kt/Lt,0,Pt)}(g),Rt=xt.length;for(;xt.length;){const Pt=xt.pop();(Pt.d>Et.d||!Et.d)&&(Et=Pt,a&&console.log("found best %d after %d probes",Math.round(1e4*Pt.d)/1e4,Rt)),Pt.max-Et.d<=s||(ft=Pt.h/2,xt.push(new z_(Pt.p.x-ft,Pt.p.y-ft,ft,g)),xt.push(new z_(Pt.p.x+ft,Pt.p.y-ft,ft,g)),xt.push(new z_(Pt.p.x-ft,Pt.p.y+ft,ft,g)),xt.push(new z_(Pt.p.x+ft,Pt.p.y+ft,ft,g)),Rt+=4)}return a&&(console.log(`num probes: ${Rt}`),console.log(`best distance: ${Et.d}`)),Et.p}function dM(g,s){return s.max-g.max}class z_{constructor(s,a,b,$){this.p=new ps(s,a),this.h=b,this.d=function(it,st){let at=!1,ht=1/0;for(let ft=0;ft<st.length;ft++){const xt=st[ft];for(let Et=0,Rt=xt.length,Pt=Rt-1;Et<Rt;Pt=Et++){const Lt=xt[Et],Gt=xt[Pt];Lt.y>it.y!=Gt.y>it.y&&it.x<(Gt.x-Lt.x)*(it.y-Lt.y)/(Gt.y-Lt.y)+Lt.x&&(at=!at),ht=Math.min(ht,Al(it,Lt,Gt))}}return(at?1:-1)*Math.sqrt(ht)}(this.p,$),this.max=this.d+this.h*Math.SQRT2}}const fM=Object.keys,SS=Number.POSITIVE_INFINITY,pM=Math.sqrt(2);function Yx(g,s,a,b,$){const it=yS(g)&&g.collisionPadding?g.collisionPadding:[0,0,0,0],st={top:g.top-it[1],bottom:g.bottom+it[3],left:g.left-it[0],right:g.right+it[2],scaled:!1};return b!==void 0&&function(at,ht){at.top*=ht,at.bottom*=ht,at.left*=ht,at.right*=ht,at.scaled=!0}(st,b),a&&function(at,ht){if(!ht)return;const ft=wn(ht),xt=new ps(at.left,at.top),Et=new ps(at.right,at.top),Rt=new ps(at.left,at.bottom),Pt=new ps(at.right,at.bottom),Lt=new ps(0,0);xt._rotateAround(ft,Lt),Et._rotateAround(ft,Lt),Rt._rotateAround(ft,Lt),Pt._rotateAround(ft,Lt),at.left=Math.min(xt.x,Et.x,Rt.x,Pt.x),at.right=Math.max(xt.x,Et.x,Rt.x,Pt.x),at.top=Math.min(xt.y,Et.y,Rt.y,Pt.y),at.bottom=Math.max(xt.y,Et.y,Rt.y,Pt.y)}(st,a),$&&(st.left+=$[0],st.right+=$[0],st.top+=$[1],st.bottom+=$[1]),s?{top:Math.min(s.top,st.top),bottom:Math.max(s.bottom,st.bottom),left:Math.min(s.left,st.left),right:Math.max(s.right,st.right),scaled:s.scaled||st.scaled}:st}function mC(g,[s,a]){let b=0,$=0;if(a===SS){s<0&&(s=0);const it=s/pM;switch(g){case"top-right":case"top-left":$=it-7;break;case"bottom-right":case"bottom-left":$=7-it;break;case"bottom":$=7-s;break;case"top":$=s-7}switch(g){case"top-right":case"bottom-right":b=-it;break;case"top-left":case"bottom-left":b=it;break;case"left":b=s;break;case"right":b=-s}}else{switch(s=Math.abs(s),a=Math.abs(a),g){case"top-right":case"top-left":case"top":$=a-7;break;case"bottom-right":case"bottom-left":case"bottom":$=7-a}switch(g){case"top-right":case"bottom-right":case"right":b=-s;break;case"top-left":case"bottom-left":case"left":b=s}}return[b,$]}function mM(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt){const Lt=g.layers[0],Gt=Lt.appearances;if(Gt.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const Kt={iconBBox:null,iconVerticalBBox:null},Xt={textBBox:null,textVerticalBBox:null},{baseIconRotate:nr,baseTextRotate:lr,iconScaleFactor:hr}=function(_r,Rr,kr){const Lr=_r.get("icon-rotate").evaluate(Rr,{},kr),is=_r.get("text-rotate").evaluate(Rr,{},kr),[Br,as]=_r.get("icon-size-scale-range");return{baseIconRotate:Lr,baseTextRotate:is,iconScaleFactor:Qt(1,Br,as)}}(b,$,it);s&&(Kt.iconBBox=Yx(s,Kt.iconBBox,nr,st),a)&&(Kt.iconVerticalBBox=Yx(a,Kt.iconVerticalBBox,nr+90,st));const Er=IE(Et.horizontal);Er&&(Xt.textBBox=Yx(Er,Xt.textBBox,lr,1,Pt)),Et.vertical&&(Xt.textVerticalBBox=Yx(Et.vertical,Xt.textVerticalBBox,lr+90,1,Pt));for(const _r of Gt)_r.hasIconProperties()&&gM(Kt,g,Lt,_r,$,it,at,nr,st,ht,s,ft,hr,xt),_r.hasTextProperties()&&xM(Xt,Lt,_r,$,it,Pt,lr,Rt,Er,Et.vertical);return{iconBBox:Kt.iconBBox,iconVerticalBBox:Kt.iconVerticalBBox,textBBox:Xt.textBBox,textVerticalBBox:Xt.textVerticalBBox}}function gM(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt){const{appearanceIconOffset:Lt,appearanceIconRotate:Gt,appearanceIconSize:Kt}=function(hr,Er,_r,Rr,kr,Lr,is,Br){const as=hr.hasProperty("icon-offset")?Er.getAppearanceValueAndResolveTokens(hr,"icon-offset",_r,Rr,[]):null,ds=as&&Array.isArray(as)?as:kr,fs=hr.hasProperty("icon-rotate")?Er.getAppearanceValueAndResolveTokens(hr,"icon-rotate",_r,Rr,[]):null,vs=typeof fs=="number"?fs:Lr,ws=hr.hasProperty("icon-size")?Er.getAppearanceValueAndResolveTokens(hr,"icon-size",_r,Rr,[]):null;return{appearanceIconOffset:ds,appearanceIconRotate:vs,appearanceIconSize:typeof ws=="number"?ws*Br.iconScaleFactor:is}}(b,a,$,it,st,at,ht,ft);let Xt=null,nr=null,lr=null;b.hasProperty("icon-image")?lr=function(hr,Er,_r,Rr,kr,Lr,is){let Br=null;const as=Er.getAppearanceValueAndResolveTokens(_r,"icon-image",Rr,kr,[]);if(as){const ds=hr.getResolvedImageFromTokens(as),fs=_r.getUnevaluatedProperty("icon-size"),vs=P1(ds,L_(hr.zoom,fs,hr.worldview),fs,kr,hr.zoom,Rr,hr.pixelRatio,is,hr.worldview);Br=Lr.get(vs.iconPrimary.toString())}return Br}(s,a,b,$,it,Et,Rt):xt&&(lr=xt.imagePrimary),lr&&(Xt=RE(lr,null,Lt,Pt),s.allowVerticalPlacement&&(nr=RE(lr,null,Lt,Pt))),Xt&&(g.iconBBox=Yx(Xt,g.iconBBox,Gt,Kt)),nr&&(g.iconVerticalBBox=Yx(nr,g.iconVerticalBBox,Gt+90,Kt))}function xM(g,s,a,b,$,it,st,at,ht,ft){const{appearanceTextOffset:xt,appearanceTextRotate:Et,appearanceTextSize:Rt}=function(Lt,Gt,Kt,Xt,nr,lr,hr){const Er=Lt.hasProperty("text-offset")?Gt.getAppearanceValueAndResolveTokens(Lt,"text-offset",Kt,Xt,[]):null,_r=Er&&Array.isArray(Er)?[Er[0]*su,Er[1]*su]:nr,Rr=Lt.hasProperty("text-rotate")?Gt.getAppearanceValueAndResolveTokens(Lt,"text-rotate",Kt,Xt,[]):null,kr=typeof Rr=="number"?Rr:lr,Lr=Lt.hasProperty("text-size")?Gt.getAppearanceValueAndResolveTokens(Lt,"text-size",Kt,Xt,[]):null;return{appearanceTextOffset:_r,appearanceTextRotate:kr,appearanceTextSize:typeof Lr=="number"?Lr:hr}}(a,s,b,$,it,st,at),Pt=Rt/at;ht&&(g.textBBox=Yx(ht,g.textBBox,Et,Pt,xt)),ft&&(g.textVerticalBBox=Yx(ft,g.textVerticalBBox,Et+90,Pt,xt))}function PE(g,s,a,b,$,it,st,at,ht){if(!s||!s.usvg)return;const ft=rC(b),xt=rC($),Et=it!=="both"&&it!=="width"||!eC(b)?1:xt.width/ft.width,Rt=it!=="both"&&it!=="height"||!tC(b)?1:xt.height/ft.height;a.scaleSelf(Et,Rt);const Pt=a.toString();st.set(Pt,a),at.set(Pt,s);const{imagePosition:Lt}=bS(Pt,s,Qy);ht.set(Pt,Lt)}function gC(g,s,a,b,$,it,st,at,ht){if(!g)return;const ft=function(xt,Et,Rt,Pt,Lt,Gt){if(xt.kind==="camera")return xt.maxSize;if(xt.kind==="composite"){const Kt=Et.possiblyEvaluate(new $o(xt.maxZoom,{worldview:Gt}),Rt).evaluate(Lt,{},Rt),Xt=Et.possiblyEvaluate(new $o(xt.minZoom,{worldview:Gt}),Rt).evaluate(Lt,{},Rt);return Math.max(Kt,Xt)}return Et.possiblyEvaluate(new $o(Pt,{worldview:Gt})).evaluate(Lt,{},Rt)}(s,a,b,$,it,ht);return g.scaleSelf(ft*at*st)}function P1(g,s,a,b,$,it,st,at,ht){return{iconPrimary:gC(g.getPrimary(),s,a,b,$,it,st,at,ht),iconSecondary:gC(g.getSecondary(),s,a,b,$,it,st,at,ht)}}function yM(g,s,a){if(!s)return;const b=a.get(g.toString()),$=a.get(s.toString());b&&$&&(b.paddedRect.w===$.paddedRect.w&&b.paddedRect.h===$.paddedRect.h||$s(`Mismatch in icon variant sizes: ${g.toString()} and ${s.toString()}`),b.usvg!==$.usvg&&$s(`Mismatch in icon variant image types: ${g.id} and ${s.id}`))}function xC(g,s,a,b){if(!g)return;const $=s.get(a.toString());if(g.imagePrimary=$,b){const it=s.get(b.toString());g.imageSecondary=it}}function _M(g,s){for(const a in g.horizontal)yC(g.horizontal[a],s);yC(g.vertical,s)}function yC(g,s){if(g){for(const a of g.positionedLines)for(const b of a.positionedGlyphs)if(b.image!==null){const $=b.image.toString();b.rect=s.get($).paddedRect}}}function TS(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function vM(g,s,a,b,$,it,st,at,ht){const ft=IE(it.horizontal)||it.vertical,xt=a.get("icon-text-fit-padding").evaluate(b,{},$);let Et,Rt=s;return s&&ht!=="none"&&(g.allowVerticalPlacement&&it.vertical&&(Et=_S(s,it.vertical,ht,xt,at,st)),ft&&(Rt=_S(s,ft,ht,xt,at,st))),{defaultShapedIcon:Rt,verticallyShapedIcon:Et}}function bM(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr,lr,hr,Er,_r,Rr){let kr=st.textMaxSize.evaluate(s,{},Rt);kr===void 0?kr=at*st.textScaleFactor:kr*=st.textScaleFactor;const Lr=g.layers[0].layout,is=su,Br=at*st.textScaleFactor/is,as=IE(a.horizontal)||a.vertical;if(Kt!=="none"&&g.appearanceFeatureData&&s.index<g.appearanceFeatureData.length){const zs=g.appearanceFeatureData[s.index];zs&&(zs.textShaping=as,zs.iconTextFitPadding=Lr.get("icon-text-fit-padding").evaluate(s,{},Rt),zs.fontScale=Br)}const ds=Pt.name==="globe",fs=g.tilePixelRatio*kr/is,vs=(_s=g.overscaling,g.zoom>18&&_s>2&&(_s>>=1),Math.max(Ps/(512*_s),1)*Lr.get("symbol-spacing")),ws=Lr.get("text-padding")*g.tilePixelRatio,xs=Lr.get("icon-padding")*g.tilePixelRatio,ys=wn(Lr.get("text-max-angle")),os=Lr.get("icon-rotation-alignment")==="map"&&lr!=="point",ss=vs/2;var _s;g.hasAnyIconTextFit===!1&&Kt!=="none"&&(g.hasAnyIconTextFit=!0);const Is=s.properties?+s.properties[ns]:null,Rs=Is&&g.elevationFeatureIdToIndex?g.elevationFeatureIdToIndex.get(Is):65535,rn=(zs,Hs,Ys)=>{if(Hs.x<0||Hs.x>=Ps||Hs.y<0||Hs.y>=Ps)return;let zn=null;if(ds){const{x:Cs,y:Qs,z:vn}=Pt.projectTilePoint(Hs.x,Hs.y,Ys);zn={anchor:new xx(Cs,Qs,vn,0,void 0),up:Pt.upVector(Ys,Hs.x,Hs.y)}}(function(Cs,Qs,vn,Wn,Xn,Rn,Co,vr,Sr,ls,bs,Ls,Ds,sn,on,Sn,Fn,Dn,Un,fn,xn,ro,lo,co,wo,Fo,Ao,fo,xo,Ln,qn,na,hn){const $n=Cs.addToLineVertexArray(Qs,Wn);let Po,No,Go,Fl,Oo,dn,ba,Eo=0,Yo=0,Yl=0,nu=0,Ul=-1,$l=-1;const tu={};let qu=m0("");const Bo=vn?vn.anchor:Qs,Pl=fo!=="none";let Ll=0,Yu=0;if(Sr._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _u=Sr.layout.get("text-offset").evaluate(xn,{},wo);Ll=_u[0]*su,Yu=_u[1]*su}else Ll=Sr.layout.get("text-radial-offset").evaluate(xn,{},wo)*su,Yu=SS;if(Cs.allowVerticalPlacement&&Xn.vertical){const _u=Xn.vertical;if(on)dn=RS(_u),vr&&(ba=RS(vr));else{const Du=Sr.layout.get("text-rotate").evaluate(xn,{},wo)+90;Go=kE(ls,Bo,Qs,bs,Ls,Ds,_u,sn,Du,Sn,na),vr&&(Fl=kE(ls,Bo,Qs,bs,Ls,Ds,vr,Dn,Du,null,qn))}}if(Rn){const _u=Cs.iconSizeData,Du=Sr.layout.get("icon-rotate").evaluate(xn,{},wo),ap=ES(Rn,Du,lo,Pl,ro.iconScaleFactor),ey=vr?ES(vr,Du,lo,Pl,ro.iconScaleFactor):void 0;No=kE(ls,Bo,Qs,bs,Ls,Ds,Rn,Dn,Du,null,Ln);const H_=function(vm,Z1,NA,M3,zA,OA,F3,L3){const BA=vm.layers[0],VA=BA.appearances;let W_=Z1.length;if(NA&&(W_=Math.max(W_,NA.length)),VA.length===0)return W_;const[D3,N3]=M3.get("icon-size-scale-range"),z3=Qt(1,D3,N3);for(const UA of VA){const $A=UA.getUnevaluatedProperties();if($A._values["icon-image"].value!==void 0){const GA=BA.getAppearanceValueAndResolveTokens(UA,"icon-image",zA,OA,[]);if(GA){const HA=vm.getResolvedImageFromTokens(GA);if(HA){const WA=$A._values["icon-size"],O3=P1(HA,L_(vm.zoom,WA,vm.worldview),WA,OA,vm.zoom,zA,vm.pixelRatio,z3,vm.worldview),B3=F3.get(O3.iconPrimary.toString());W_=Math.max(W_,cM(B3,L3))}}}}return W_}(Cs,ap,ey,Sr.layout,xn,wo,Cs.iconAtlasPositions,Pl);Eo=4*H_;let _m=null;_u.kind==="source"?(_m=[mm*Sr.layout.get("icon-size").evaluate(xn,{},wo)*ro.iconScaleFactor],_m[0]>yx&&$s(`${Cs.layerIds[0]}: Value for "icon-size" is >= ${I1}. Reduce your "icon-size".`)):_u.kind==="composite"&&(_m=[mm*ro.compositeIconSizes[0].evaluate(xn,{},wo)*ro.iconScaleFactor,mm*ro.compositeIconSizes[1].evaluate(xn,{},wo)*ro.iconScaleFactor],(_m[0]>yx||_m[1]>yx)&&$s(`${Cs.layerIds[0]}: Value for "icon-size" is >= ${I1}. Reduce your "icon-size".`)),Cs.addSymbols(Cs.icon,ap,_m,fn,Un,xn,void 0,vn,Qs,$n.lineStartIndex,$n.lineLength,-1,co,wo,Fo,Ao,Cs.symbolInstances.length,H_),Ul=Cs.icon.placedSymbolArray.length-1,ey&&(Yo=4*H_,Cs.addSymbols(Cs.icon,ey,_m,fn,Un,xn,np.vertical,vn,Qs,$n.lineStartIndex,$n.lineLength,-1,co,wo,Fo,Ao,Cs.symbolInstances.length,H_),$l=Cs.icon.placedSymbolArray.length-1)}for(const _u in Xn.horizontal){const Du=_u,ap=Xn.horizontal[Du];Po||(qu=m0(ap.text),on?Oo=RS(ap):Po=kE(ls,Bo,Qs,bs,Ls,Ds,ap,sn,Sr.layout.get("text-rotate").evaluate(xn,{},wo),Sn,na));const ey=ap.positionedLines.length===1;if(Yl+=_C(Cs,vn,Qs,ap,Co,Sr,on,xn,Sn,$n,Xn.vertical?np.horizontal:np.horizontalOnly,ey?fM(Xn.horizontal):[Du],tu,Ul,ro,co,wo,Cs.symbolInstances.length,Fo),ey)break}Xn.vertical&&(nu+=_C(Cs,vn,Qs,Xn.vertical,Co,Sr,on,xn,Sn,$n,np.vertical,["vertical"],tu,$l,ro,co,wo,Cs.symbolInstances.length,Fo));let Ql=-1;const Zp=(_u,Du)=>_u?Math.max(_u,Du):Du;Ql=Zp(Oo,Ql),Ql=Zp(dn,Ql),Ql=Zp(ba,Ql);const Gm=Ql>-1?1:0;Cs.glyphOffsetArray.length>=65535&&$s("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xn.sortKey!==void 0&&Cs.addToSortKeyRanges(Cs.symbolInstances.length,xn.sortKey),Cs.symbolInstances.emplaceBack(Qs.x,Qs.y,Bo.x,Bo.y,Bo.z,tu.right>=0?tu.right:-1,tu.center>=0?tu.center:-1,tu.left>=0?tu.left:-1,tu.vertical>=0?tu.vertical:-1,Ul,$l,qu,Po!==void 0?Po:Cs.collisionBoxArray.length,Po!==void 0?Po+1:Cs.collisionBoxArray.length,Go!==void 0?Go:Cs.collisionBoxArray.length,Go!==void 0?Go+1:Cs.collisionBoxArray.length,No!==void 0?No:Cs.collisionBoxArray.length,No!==void 0?No+1:Cs.collisionBoxArray.length,Fl||Cs.collisionBoxArray.length,Fl?Fl+1:Cs.collisionBoxArray.length,bs,Yl,nu,Eo,Yo,Gm,0,Ll,Yu,Ql,0,Pl?1:0,xo)})(g,Hs,zn,zs,a,b,it,$,g.layers[0],g.collisionBoxArray,s.index,s.sourceLayerIndex,g.index,ws,nr,ft,0,xs,os,Xt,s,st,xt,Et,Rt,Lt,Gt,Kt,Rs,hr,Er,_r)};if(lr==="line")for(const zs of fE(s.geometry,0,0,Ps,Ps)){const Hs=lM(zs,vs,ys,a.vertical||as,b,is,fs,g.overscaling,Ps);for(const Ys of Hs)as&&wM(g,as.text,ss,Ys)||rn(zs,Ys,Rt)}else if(lr==="line-center"){for(const zs of s.geometry)if(zs.length>1){const Hs=aM(zs,ys,a.vertical||as,b,is,fs);Hs&&rn(zs,Hs,Rt)}}else if(s.type==="Polygon")for(const zs of f1(s.geometry,0)){const Hs=hM(zs,16);rn(zs[0],new xx(Hs.x,Hs.y,0,0,void 0),Rt)}else if(s.type==="LineString")for(const zs of s.geometry)rn(zs,new xx(zs[0].x,zs[0].y,0,0,void 0),Rt);else if(s.type==="Point")for(const zs of s.geometry)for(const Hs of zs)rn([Hs],new xx(Hs.x,Hs.y,0,0,void 0),Rt)}const I1=255,yx=I1*mm;function _C(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr){const lr=function(_r,Rr,kr,Lr,is,Br,as,ds){const fs=[];if(Rr.positionedLines.length===0)return fs;const vs=Lr.layout.get("text-rotate").evaluate(Br,{})*Math.PI/180,ws=function(_s){const Is=_s[0],Rs=_s[1],rn=Is*Rs;return rn>0?[Is,-Rs]:rn<0?[-Is,Rs]:Is===0?[Rs,Is]:[Rs,-Is]}(kr);let xs=Math.abs(Rr.top-Rr.bottom);for(const _s of Rr.positionedLines)xs-=_s.lineOffset;const ys=Rr.positionedLines.length,os=xs/ys;let ss=Rr.top-kr[1];for(let _s=0;_s<ys;++_s){const Is=Rr.positionedLines[_s];ss=uM(Rr,os,ss,_s);for(const Rs of Is.positionedGlyphs){if(!Rs.rect)continue;const rn=Rs.rect||{};let zs=ZR+1,Hs=!0,Ys=1,zn=0;if(Rs.image){const Fn=as.get(Rs.image.toString());if(!Fn)continue;if(Fn.sdf){$s("SDF images are not supported in formatted text and will be ignored.");continue}Hs=!1,Ys=Fn.pixelRatio,zs=Qy/Ys}const Cs=(is||ds)&&Rs.vertical,Qs=Rs.metrics.advance*Rs.scale/2,vn=Rs.metrics,Wn=Rs.rect;if(Wn===null)continue;ds&&Rr.verticalizable&&(zn=Rs.image?Qs-Rs.metrics.width*Rs.scale/2:0);const Xn=is?[Rs.x+Qs,Rs.y]:[0,0];let Rn=[0,0],Co=[0,0],vr=!1;is||(Cs?(Co=[Rs.x+Qs+ws[0],Rs.y+ws[1]-zn],vr=!0):Rn=[Rs.x+Qs+kr[0],Rs.y+kr[1]-zn]);const Sr=Wn.w*Rs.scale/(Ys*(Rs.localGlyph?gm:1)),ls=Wn.h*Rs.scale/(Ys*(Rs.localGlyph?gm:1));let bs,Ls,Ds,sn;if(Cs){const Fn=Rs.y-ss,Dn=new ps(-Qs,Qs-Fn),Un=-Math.PI/2,fn=new ps(...Co);bs=new ps(-Qs+Rn[0],Rn[1]),bs._rotateAround(Un,Dn)._add(fn),bs.x+=-Fn+Qs,bs.y-=(vn.left-zs)*Rs.scale;const xn=Rs.image?vn.advance*Rs.scale:su*Rs.scale,ro=String.fromCodePoint(Rs.glyph);WI(ro)?bs.x+=(1-zs)*Rs.scale:qI(ro)?bs.x+=xn-vn.height*Rs.scale+(-zs-1)*Rs.scale:bs.x+=Rs.image||vn.width+2*zs===Wn.w&&vn.height+2*zs===Wn.h?(xn-ls)/2:(xn-(vn.height+2*zs)*Rs.scale)/2,Ls=new ps(bs.x,bs.y-Sr),Ds=new ps(bs.x+ls,bs.y),sn=new ps(bs.x+ls,bs.y-Sr)}else{const Fn=(vn.left-zs)*Rs.scale-Qs+Rn[0],Dn=(-vn.top-zs)*Rs.scale+Rn[1],Un=Fn+Sr,fn=Dn+ls;bs=new ps(Fn,Dn),Ls=new ps(Un,Dn),Ds=new ps(Fn,fn),sn=new ps(Un,fn)}if(vs){let Fn;Fn=is?new ps(0,0):vr?new ps(ws[0],ws[1]):new ps(kr[0],kr[1]),bs._rotateAround(vs,Fn),Ls._rotateAround(vs,Fn),Ds._rotateAround(vs,Fn),sn._rotateAround(vs,Fn)}const on=new ps(0,0),Sn=new ps(0,0);fs.push({tl:bs,tr:Ls,bl:Ds,br:sn,texPrimary:rn,texSecondary:void 0,writingMode:Rr.writingMode,glyphOffset:Xn,sectionIndex:Rs.sectionIndex,isSDF:Hs,pixelOffsetTL:on,pixelOffsetBR:Sn,minFontScaleX:0,minFontScaleY:0})}}return fs}(0,b,ht,it,st,at,$,g.allowVerticalPlacement),hr=g.textSizeData;let Er=null;hr.kind==="source"?(Er=[mm*it.layout.get("text-size").evaluate(at,{},Kt)*Lt.textScaleFactor],Er[0]>yx&&$s(`${g.layerIds[0]}: Value for "text-size" is >= ${I1}. Reduce your "text-size".`)):hr.kind==="composite"&&(Er=[mm*Lt.compositeTextSizes[0].evaluate(at,{},Kt)*Lt.textScaleFactor,mm*Lt.compositeTextSizes[1].evaluate(at,{},Kt)*Lt.textScaleFactor],(Er[0]>yx||Er[1]>yx)&&$s(`${g.layerIds[0]}: Value for "text-size" is >= ${I1}. Reduce your "text-size".`)),g.addSymbols(g.text,lr,Er,ht,st,at,xt,s,a,ft.lineStartIndex,ft.lineLength,Pt,Gt,Kt,nr,!1,Xt,lr.length);for(const _r of Et)Rt[_r]=g.text.placedSymbolArray.length-1;return 4*lr.length}function IE(g){for(const s in g)return g[s];return null}function kE(g,s,a,b,$,it,st,at,ht,ft,xt){let Et,Rt,Pt,Lt;if(Et=xt?xt.top:st.top,Rt=xt?xt.bottom:st.bottom,Pt=xt?xt.left:st.left,Lt=xt?xt.right:st.right,yS(st)&&st.collisionPadding){const Gt=st.collisionPadding;Pt-=Gt[0],Et-=Gt[1],Lt+=Gt[2],Rt+=Gt[3]}if(ht){const Gt=new ps(Pt,Et),Kt=new ps(Lt,Et),Xt=new ps(Pt,Rt),nr=new ps(Lt,Rt),lr=wn(ht);let hr=new ps(0,0);ft&&(hr=new ps(ft[0],ft[1])),Gt._rotateAround(lr,hr),Kt._rotateAround(lr,hr),Xt._rotateAround(lr,hr),nr._rotateAround(lr,hr),Pt=Math.min(Gt.x,Kt.x,Xt.x,nr.x),Lt=Math.max(Gt.x,Kt.x,Xt.x,nr.x),Et=Math.min(Gt.y,Kt.y,Xt.y,nr.y),Rt=Math.max(Gt.y,Kt.y,Xt.y,nr.y)}return g.emplaceBack(s.x,s.y,s.z,a.x,a.y,Pt,Et,Lt,Rt,at,b,$,it),g.length-1}function RS(g){yS(g)&&g.collisionPadding&&(g.top-=g.collisionPadding[1],g.bottom+=g.collisionPadding[3]);const s=g.bottom-g.top;return s>0?Math.max(10,s):null}function wM(g,s,a,b){const $=g.compareText;if(s in $){const it=$[s];for(let st=it.length-1;st>=0;st--)if(b.dist(it[st])<a)return!0}else $[s]=[];return $[s].push(b),!1}function vC(g,s){const a=g.fovAboveCenter,b=g.elevation?g.elevation.getMinElevationBelowMSL()*s:0,$=(g._camera.position[2]*g.worldSize-b)/Math.cos(g._pitch),it=Math.sin(a)*$/Math.sin(Math.max(Math.PI/2-g._pitch-a,.01));let st=Math.sin(g._pitch)*it+$;const at=$*(1/g._horizonShift);if(!g.elevation||g.elevation.exaggeration()===0){let ht=Math.max(g.zoom-17,0);g.isOrthographic&&(ht/=10),st*=1+ht}return Math.min(1.01*st,at)}function k1(g,s){if(!s.isReprojectedInTileSpace)return{scale:1<<g.z,x:g.x,y:g.y,x2:g.x+1,y2:g.y+1,projection:s};const a=Math.pow(2,-g.z),b=g.x*a,$=(g.x+1)*a,it=g.y*a,st=(g.y+1)*a,at=Ct(b),ht=Ct($),ft=Ut(it),xt=Ut(st),Et=s.project(at,ft),Rt=s.project(ht,ft),Pt=s.project(ht,xt),Lt=s.project(at,xt);let Gt=Math.min(Et.x,Rt.x,Pt.x,Lt.x),Kt=Math.min(Et.y,Rt.y,Pt.y,Lt.y),Xt=Math.max(Et.x,Rt.x,Pt.x,Lt.x),nr=Math.max(Et.y,Rt.y,Pt.y,Lt.y);const lr=a/16;function hr(_r,Rr,kr,Lr,is,Br){const as=(kr+is)/2,ds=(Lr+Br)/2,fs=s.project(Ct(as),Ut(ds)),vs=Math.max(0,Gt-fs.x,Kt-fs.y,fs.x-Xt,fs.y-nr);Gt=Math.min(Gt,fs.x),Xt=Math.max(Xt,fs.x),Kt=Math.min(Kt,fs.y),nr=Math.max(nr,fs.y),vs>lr&&(hr(_r,fs,kr,Lr,as,ds),hr(fs,Rr,as,ds,is,Br))}hr(Et,Rt,b,it,$,it),hr(Rt,Pt,$,it,$,st),hr(Pt,Lt,$,st,b,st),hr(Lt,Et,b,st,b,it),Gt-=lr,Kt-=lr,Xt+=lr,nr+=lr;const Er=1/Math.max(Xt-Gt,nr-Kt);return{scale:Er,x:Gt*Er,y:Kt*Er,x2:Xt*Er,y2:nr*Er,projection:s}}function bC(g,{x:s,y:a},b=0){return new ps(((s-b)*g.scale-g.x)*Ps,(a*g.scale-g.y)*Ps)}const EM=Jt(new Float32Array(16));class Qx{constructor(s){this.spec=s,this.name=s.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(s,a){return{x:0,y:0,z:0}}unproject(s,a){return new _(0,0)}projectTilePoint(s,a,b){return{x:s,y:a,z:0}}locationPoint(s,a,b,$=!0){return s._coordinatePoint(s.locationCoordinate(a,b),$)}pixelsPerMeter(s,a){return Tt(1,s)*a}pixelSpaceConversion(s,a,b){return 1}farthestPixelDistance(s){return vC(s,s.pixelsPerMeter)}pointCoordinate(s,a,b,$){const it=s.horizonLineFromTop(!1),st=new ps(a,Math.max(it,b));return s.rayIntersectionCoordinate(s.pointRayIntersection(st,$))}pointCoordinate3D(s,a,b){const $=new ps(a,b);if(s.elevation)return s.elevation.pointCoordinate($);{const it=this.pointCoordinate(s,$.x,$.y,0);return[it.x,it.y,it.z]}}isPointAboveHorizon(s,a){if(s.elevation&&s.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(s,a.x,a.y);const b=s.horizonLineFromTop();return a.y<b}createInversionMatrix(s,a){return EM}createTileMatrix(s,a,b){let $,it,st;const at=b.canonical,ht=Jt(new Float64Array(16));if(this.isReprojectedInTileSpace){const ft=k1(at,this);$=1,it=ft.x+b.wrap*ft.scale,st=ft.y,Ht(ht,ht,[$/ft.scale,$/ft.scale,s.pixelsPerMeter/a])}else $=a/s.zoomScale(at.z),it=(at.x+Math.pow(2,at.z)*b.wrap)*$,st=at.y*$;return Mt(ht,ht,[it,st,0]),Ht(ht,ht,[$/Ps,$/Ps,1]),ht}upVector(s,a,b){return[0,0,1]}upVectorScale(s,a,b){return{metersToTile:1}}}class SM extends Qx{constructor(s){super(s),this.range=[4,7],this.center=s.center||[-96,37.5];const[a,b]=this.parallels=s.parallels||[29.5,45.5],$=Math.sin(wn(a));this.n=($+Math.sin(wn(b)))/2,this.c=1+$*(2*this.n-$),this.r0=Math.sqrt(this.c)/this.n}project(s,a){const{n:b,c:$,r0:it}=this,st=wn(s-this.center[0]),at=wn(a),ht=Math.sqrt($-2*b*Math.sin(at))/b;return{x:ht*Math.sin(st*b),y:ht*Math.cos(st*b)-it,z:0}}unproject(s,a){const{n:b,c:$,r0:it}=this,st=it+a;let at=Math.atan2(s,Math.abs(st))*Math.sign(st);st*b<0&&(at-=Math.PI*Math.sign(s)*Math.sign(st));const ht=wn(this.center[0])*b;at=gr(at,-Math.PI-ht,Math.PI-ht);const ft=Qt(Nl(at/b)+this.center[0],-180,180),xt=Math.asin(Qt(($-(s*s+st*st)*b*b)/(2*b),-1,1)),Et=Qt(Nl(xt),-$t,$t);return new _(ft,Et)}}const M1=1.340264,F1=-.081106,L1=893e-6,D1=.003796,ME=Math.sqrt(3)/2;class TM extends Qx{project(s,a){a=a/180*Math.PI,s=s/180*Math.PI;const b=Math.asin(ME*Math.sin(a)),$=b*b,it=$*$*$;return{x:.5*(s*Math.cos(b)/(ME*(M1+3*F1*$+it*(7*L1+9*D1*$)))/Math.PI+.5),y:1-.5*(b*(M1+F1*$+it*(L1+D1*$))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let b=a=(2*(1-a)-1)*Math.PI,$=b*b,it=$*$*$;for(let xt,Et,Rt,Pt=0;Pt<12&&(Et=b*(M1+F1*$+it*(L1+D1*$))-a,Rt=M1+3*F1*$+it*(7*L1+9*D1*$),xt=Et/Rt,b=Qt(b-xt,-Math.PI/3,Math.PI/3),$=b*b,it=$*$*$,!(Math.abs(xt)<1e-12));++Pt);const st=ME*s*(M1+3*F1*$+it*(7*L1+9*D1*$))/Math.cos(b),at=Math.asin(Math.sin(b)/ME),ht=Qt(180*st/Math.PI,-180,180),ft=Qt(180*at/Math.PI,-$t,$t);return new _(ht,ft)}}class RM extends Qx{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){return{x:.5+s/360,y:.5-a/360,z:0}}unproject(s,a){const b=360*(s-.5),$=Qt(360*(.5-a),-$t,$t);return new _(b,$)}}const O_=Math.PI/2;function FE(g){return Math.tan((O_+g)/2)}class CM extends Qx{constructor(s){super(s),this.center=s.center||[0,30];const[a,b]=this.parallels=s.parallels||[30,30];let $=wn(a),it=wn(b);this.southernCenter=$+it<0,this.southernCenter&&($=-$,it=-it);const st=Math.cos($),at=FE($);this.n=$===it?Math.sin($):Math.log(st/Math.cos(it))/Math.log(FE(it)/at),this.f=st*Math.pow(FE($),this.n)/this.n}project(s,a){a=wn(a),this.southernCenter&&(a=-a),s=wn(s-this.center[0]);const b=1e-6,{n:$,f:it}=this;it>0?a<-O_+b&&(a=-O_+b):a>O_-b&&(a=O_-b);const st=it/Math.pow(FE(a),$);let at=st*Math.sin($*s),ht=it-st*Math.cos($*s);return at=.5*(at/Math.PI+.5),ht=.5*(ht/Math.PI+.5),{x:at,y:this.southernCenter?ht:1-ht,z:0}}unproject(s,a){s=(2*s-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:b,f:$}=this,it=$-a,st=Math.sign(it),at=Math.sign(b)*Math.sqrt(s*s+it*it);let ht=Math.atan2(s,Math.abs(it))*st;it*b<0&&(ht-=Math.PI*Math.sign(s)*st);const ft=Qt(Nl(ht/b)+this.center[0],-180,180),xt=Qt(Nl(2*Math.atan(Math.pow($/at,1/b))-O_),-$t,$t);return new _(ft,this.southernCenter?-xt:xt)}}class wC extends Qx{constructor(s){super(s),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(s,a){return{x:dt(s),y:mt(a),z:0}}unproject(s,a){const b=Ct(s),$=Ut(a);return new _(b,$)}}const EC=wn($t);class AM extends Qx{project(s,a){const b=(a=wn(a))*a,$=b*b;return{x:.5*((s=wn(s))*(.8707-.131979*b+$*($*(.003971*b-.001529*$)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+b*(.015085+$*(.028874*b-.044475-.005916*$)))/Math.PI+1),z:0}}unproject(s,a){s=(2*s-.5)*Math.PI;let b=a=(2*(1-a)-1)*Math.PI,$=25,it=0,st=b*b;do{st=b*b;const ft=st*st;it=(b*(1.007226+st*(.015085+ft*(.028874*st-.044475-.005916*ft)))-a)/(1.007226+st*(.045255+ft*(.259866*st-.311325-.005916*11*ft))),b=Qt(b-it,-EC,EC)}while(Math.abs(it)>1e-6&&--$>0);st=b*b;const at=Qt(Nl(s/(.8707+st*(st*(st*st*st*(.003971-.001529*st)-.013791)-.131979))),-180,180),ht=Nl(b);return new _(at,ht)}}const SC=wn($t);class jM extends Qx{project(s,a){a=wn(a),s=wn(s);const b=Math.cos(a),$=2/Math.PI,it=Math.acos(b*Math.cos(s/2)),st=Math.sin(it)/it,at=.5*(s*$+2*b*Math.sin(s/2)/st)||0,ht=.5*(a+Math.sin(a)/st)||0;return{x:.5*(at/Math.PI+.5),y:1-.5*(ht/Math.PI+1),z:0}}unproject(s,a){let b=s=(2*s-.5)*Math.PI,$=a=(2*(1-a)-1)*Math.PI,it=25;const st=1e-6;let at=0,ht=0;do{const ft=Math.cos($),xt=Math.sin($),Et=2*xt*ft,Rt=xt*xt,Pt=ft*ft,Lt=Math.cos(b/2),Gt=Math.sin(b/2),Kt=2*Lt*Gt,Xt=Gt*Gt,nr=1-Pt*Lt*Lt,lr=nr?1/nr:0,hr=nr?Math.acos(ft*Lt)*Math.sqrt(1/nr):0,Er=.5*(2*hr*ft*Gt+2*b/Math.PI)-s,_r=.5*(hr*xt+$)-a,Rr=.5*lr*(Pt*Xt+hr*ft*Lt*Rt)+1/Math.PI,kr=lr*(Kt*Et/4-hr*xt*Gt),Lr=.125*lr*(Et*Gt-hr*xt*Pt*Kt),is=.5*lr*(Rt*Lt+hr*Xt*ft)+.5,Br=kr*Lr-is*Rr;at=(_r*kr-Er*is)/Br,ht=(Er*Lr-_r*Rr)/Br,b=Qt(b-at,-Math.PI,Math.PI),$=Qt($-ht,-SC,SC)}while((Math.abs(at)>st||Math.abs(ht)>st)&&--it>0);return new _(Nl(b),Nl($))}}class TC extends Qx{constructor(s){super(s),this.center=s.center||[0,0],this.parallels=s.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(wn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(s,a){const{scale:b,cosPhi:$}=this;return{x:wn(s)*$*b+.5,y:-Math.sin(wn(a))/$*b+.5,z:0}}unproject(s,a){const{scale:b,cosPhi:$}=this,it=-(a-.5)/b,st=Qt(Nl((s-.5)/b)/$,-180,180),at=Math.asin(Qt(it*$,-1,1)),ht=Qt(Nl(at),-$t,$t);return new _(st,ht)}}class PM extends wC{constructor(s){super(s),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(s,a,b){const $=a1(s,a,b);return Os($,$,sE(Ip(b))),{x:$[0],y:$[1],z:$[2]}}locationPoint(s,a,b){const $=Hx(a.lat,a.lng),it=Cn([],$),st=b?s._centerAltitude+b:s.elevation?s.elevation.getAtPointOrZero(s.locationCoordinate(a),s._centerAltitude):s._centerAltitude;Wr($,$,it,Tt(1,0)*Ps*st);const at=Jt(new Float64Array(16));return It(at,s.pixelMatrix,s.globeMatrix),Os($,$,at),new ps($[0],$[1])}pixelsPerMeter(s,a){return Tt(1,0)*a}pixelSpaceConversion(s,a,b){const $=Tt(1,s)*a,it=pn(Tt(1,45)*a,$,b);return this.pixelsPerMeter(s,a)/it}createTileMatrix(s,a,b){const $=I2(Ip(b.canonical));return It(new Float64Array(16),s.globeMatrix,$)}createInversionMatrix(s,a){const{center:b}=s,$=sE(Ip(a));return er($,$,wn(b.lng)),tr($,$,wn(b.lat)),Ht($,$,[s._pixelsPerMercatorPixel,s._pixelsPerMercatorPixel,1]),Float32Array.from($)}pointCoordinate(s,a,b,$){return qx(s,a,b,!0)||new cr(0,0)}pointCoordinate3D(s,a,b){const $=this.pointCoordinate(s,a,b,0);return[$.x,$.y,$.z]}isPointAboveHorizon(s,a){return!qx(s,a.x,a.y,!1)}farthestPixelDistance(s){const a=function($,it){const st=$.cameraToCenterDistance,at=$._centerAltitude*it,ht=$._camera,ft=$._camera.forward(),xt=rr([],us([],ft,-st),[0,0,at]),Et=$.worldSize/(2*Math.PI),Rt=[0,0,-Et],Pt=$.width/$.height,Lt=Math.tan($.fovAboveCenter),Gt=us([],ht.up(),Lt),Kt=us([],ht.right(),Lt*Pt),Xt=Cn([],rr([],rr([],ft,Gt),Kt)),nr=[];let lr;if(new Ks(xt,Xt).closestPointOnSphere(Rt,Et,nr)){const hr=rr([],nr,Rt),Er=Pn([],hr,xt);lr=Math.cos($.fovAboveCenter)*Kr(Er)}else{const hr=Pn([],xt,Rt),Er=Pn([],Rt,xt);Cn(Er,Er);const _r=Kr(hr)-Et;lr=Math.sqrt(_r*(_r+2*Et));const Rr=Math.acos(lr/(Et+_r))-Math.acos(On(ft,Er));lr*=Math.cos(Rr)}return 1.01*lr}(s,this.pixelsPerMeter(s.center.lat,s.worldSize)),b=Zx(s.zoom);if(b>0){const $=vC(s,Tt(1,s.center.lat)*s.worldSize),it=s.worldSize/(2*Math.PI),st=Math.max(s.width,s.height)/s.worldSize*Math.PI;return pn(a,$+it*(1-Math.cos(st)),Math.pow(b,10))}return a}upVector(s,a,b){return a1(a,b,s,1)}upVectorScale(s){return{metersToTile:Wp(iE(Ip(s)))}}}function RC(g){const s=g.parallels,a=!!s&&Math.abs(s[0]+s[1])<.01;switch(g.name){case"mercator":return new wC(g);case"equirectangular":return new RM(g);case"naturalEarth":return new AM(g);case"equalEarth":return new TM(g);case"winkelTripel":return new jM(g);case"albers":return a?new TC(g):new SM(g);case"lambertConformalConic":return a?new TC(g):new CM(g);case"globe":return new PM(g)}throw new Error(`Invalid projection name: ${g.name}`)}const IM=Nr.types,kM=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function N1(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt){const Pt=at?Math.min(yx,Math.round(at[0])):0,Lt=at?Math.min(yx,Math.round(at[1])):0;g.emplaceBack(s,a,Math.round(32*b),Math.round(32*$),it,st,(Pt<<1)+(ht?1:0),0+(Lt<<1),16*ft,16*xt,256*Et,256*Rt)}function z1(g,s,a){g.emplaceBack(s,a)}function O1(g,s,a,b,$,it,st){g.emplaceBack(s,a,b,$,it,st)}const LE=(g,s,a,b)=>{for(let $=0;$<s;$++)g.emplaceBack(a[0],a[1],a[2],b[0],b[1],b[2])};function B_(g,s,a,b,$){g.emplaceBack(s,a,b,$),g.emplaceBack(s,a,b,$),g.emplaceBack(s,a,b,$),g.emplaceBack(s,a,b,$)}function MM(g){for(const s of g.sections)if(m2(s.text))return!0;return!1}class CS{constructor(s){this.layoutVertexArray=new Gv,this.indexArray=new Zl,this.programConfigurations=s,this.segments=new ga,this.dynamicLayoutVertexArray=new zm,this.opacityVertexArray=new c_,this.placedSymbolArray=new Kw,this.iconTransitioningVertexArray=new tp,this.globeExtVertexArray=new Hv,this.zOffsetVertexArray=new om,this.orientationVertexArray=new Zv,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(s,a){const b=[],$=this.layoutVertexArray.uint16;for(let it=0;it<a;++it){const st=12*(s+it);b.push(...$.slice(st,st+12))}return b}updateIconVertexData(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt){const Lt=this.layoutVertexArray.uint16,Gt=12*s;Lt[Gt]=a,Lt[Gt+1]=b,Lt[Gt+2]=$,Lt[Gt+3]=it,Lt[Gt+4]=st,Lt[Gt+5]=at,Lt[Gt+6]=ht,Lt[Gt+7]=ft,Lt[Gt+8]=xt,Lt[Gt+9]=Et,Lt[Gt+10]=Rt,Lt[Gt+11]=Pt}upload(s,a,b,$,it,st){this.isEmpty()||(b&&(this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,DI.members,!!st),this.indexBuffer=s.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=s.createVertexBuffer(this.dynamicLayoutVertexArray,zI.members,!0),this.opacityVertexBuffer=s.createVertexBuffer(this.opacityVertexArray,kM,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=s.createVertexBuffer(this.iconTransitioningVertexArray,VI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=s.createVertexBuffer(this.globeExtVertexArray,NI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||it)&&(this.zOffsetVertexBuffer=s.createVertexBuffer(this.zOffsetVertexArray,OI.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=s.createVertexBuffer(this.orientationVertexArray,BI.members,!0)),this.opacityVertexBuffer.itemSize=1),(b||$)&&this.programConfigurations.upload(s))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Xs(CS,"SymbolBuffers");class AS{constructor(s,a,b){this.layoutVertexArray=new s,this.layoutAttributes=a,this.indexArray=new b,this.segments=new ga,this.collisionVertexArray=new Wv,this.collisionVertexArrayExt=new zm}upload(s){this.layoutVertexBuffer=s.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=s.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=s.createVertexBuffer(this.collisionVertexArray,UI.members,!0),this.collisionVertexBufferExt=s.createVertexBuffer(this.collisionVertexArrayExt,$I.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Xs(AS,"CollisionBuffers");class DE{constructor(s){this.collisionBoxArray=s.collisionBoxArray,this.zoom=s.zoom,this.overscaling=s.overscaling,this.layers=s.layers,this.layerIds=this.layers.map(st=>st.fqid),this.index=s.index,this.pixelRatio=s.pixelRatio,this.sourceLayerIndex=s.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Jt([]),this.placementViewportMatrix=Jt([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=s.worldview,this.localizable=s.localizable,this.textSizeData=L_(this.zoom,a["text-size"],this.worldview),this.iconSizeData=L_(this.zoom,a["icon-size"],this.worldview);const b=this.layers[0].layout,$=b.get("symbol-sort-key"),it=b.get("symbol-z-order");this.lut=s.lut,this.canOverlap=b.get("text-allow-overlap")||b.get("icon-allow-overlap")||b.get("text-ignore-placement")||b.get("icon-ignore-placement"),this.sortFeaturesByKey=it!=="viewport-y"&&$.constantOr(1)!==void 0,this.sortFeaturesByY=(it==="viewport-y"||it==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=b.get("text-writing-mode").map(st=>np[st]),this.stateDependentLayerIds=this.layers.filter(st=>st.isStateDependent()).map(st=>st.id),this.sourceID=s.sourceID,this.projection=s.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(s){const a=this.layers[0].getAppearances();return!(!a||a.length===0)&&a.some(b=>b.getProperty(s)!=null)}createArrays(){this.text=new CS(new jp(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("text")||s.startsWith("symbol"))),this.icon=new CS(new jp(this.layers,{zoom:this.zoom,lut:this.lut},s=>s.startsWith("icon")||s.startsWith("symbol"))),this.glyphOffsetArray=new x_,this.lineVertexArray=new Qw,this.symbolInstances=new Jv}calculateGlyphDependencies(s,a,b,$,it){for(const st of s){const at=st.codePointAt(0);if(at===void 0)break;if(a[at]=!0,$&&it&&at<=65535){const ht=R1[st];ht&&(a[ht.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(s,a,b,$,it,st){let at=1;const ht=s.getUnevaluatedProperties()._values["icon-size"],ft=L_(this.zoom,ht,this.worldview),xt=D_(ft,a);if(ft.kind!=="constant"&&ft.kind!=="camera"||(at=xt.uSize),ft.kind==="composite"){const{minZoom:Et,maxZoom:Rt}=ft,Pt=ht.possiblyEvaluate(new $o(Et,{worldview:this.worldview}),$),Lt=ht.possiblyEvaluate(new $o(Rt,{worldview:this.worldview}),$),Gt=Pt.evaluate(b,{},$,it);at=Gt+(Lt.evaluate(b,{},$,it)-Gt)*xt.uSizeT}return ft.kind==="source"&&(at=ht.possiblyEvaluate(new $o(this.zoom,{worldview:this.worldview}),$).evaluate(b,{},$,it)),at*st}updateFootprints(s,a){}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const b=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);return!uE(this.activeReplacements,b)&&(this.activeReplacements=b,!0)}getResolvedImageFromTokens(s){return typeof s=="string"?Iu.build(s):s}populate(s,a,b,$){const it=this.layers[0],st=it.layout,at=this.projection.name==="globe",ht=st.get("text-font"),ft=st.get("text-field"),xt=st.get("icon-image"),[Et,Rt]=st.get("icon-size-scale-range"),Pt=Qt(a.scaleFactor||1,Et,Rt),Lt=(ft.value.kind!=="constant"||ft.value.value instanceof Pu&&!ft.value.value.isEmpty()||ft.value.value.toString().length>0)&&(ht.value.kind!=="constant"||ht.value.value.length>0),Gt=xt.value.kind!=="constant"||!!xt.value.value||Object.keys(xt.parameters).length>0,Kt=this.hasAnyAppearanceProperty("icon-image"),Xt=st.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!Lt&&!Gt&&!Kt)return;const nr=a.iconDependencies,lr=a.glyphDependencies,hr=a.availableImages,Er=new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),_r=Rr=>{const kr=Rr.id.toString();nr.has(kr)?nr.get(kr).push(Rr):nr.set(kr,[Rr])};for(const Rr of s){const{feature:kr,id:Lr,index:is,sourceLayerIndex:Br}=Rr,as=it._featureFilter.needGeometry,ds=Or(kr,as);if(!it._featureFilter.filter(Er,ds,b))continue;if(as||(ds.geometry=Pr(kr,b,$)),at&&kr.type!==1&&b.z<=5){const _s=ds.geometry,Is=.98078528056,Rs=(rn,zs)=>On(a1(rn.x,rn.y,b,1),a1(zs.x,zs.y,b,1))<Is;for(let rn=0;rn<_s.length;rn++)_s[rn]=wr(_s[rn],Rs)}let fs,vs;if(Lt){const _s=it.getValueAndResolveTokens("text-field",ds,b,hr),Is=Pu.factory(_s);MM(Is)&&(this.hasRTLText=!0),(!this.hasRTLText||Ly()==="unavailable"||this.hasRTLText&&sm.isParsed())&&(fs=HI(Is,it,ds))}if(Gt){const _s=it.getValueAndResolveTokens("icon-image",ds,b,hr);vs=this.getResolvedImageFromTokens(_s)}const ws=this.layers[0];let xs=!1;if(!vs&&Kt){const _s=ws.getAppearances();for(const Is of _s)if(Is.getProperty("icon-image")){const Rs=ws.getAppearanceValueAndResolveTokens(Is,"icon-image",ds,b,hr);if(Rs){vs=this.getResolvedImageFromTokens(Rs),xs=!0;break}}}if(!fs&&!vs)continue;const ys=this.sortFeaturesByKey?Xt.evaluate(ds,{},b):void 0,os={id:Lr,text:fs,icon:vs,index:is,sourceLayerIndex:Br,geometry:ds.geometry,properties:kr.properties,type:IM[kr.type],sortKey:ys};if(this.features.push(os),this.featureToAppearanceIndex[is]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:Lr,properties:kr.properties,usesAppearanceIconAsPlaceholder:xs,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),vs){const _s=ws._unevaluatedLayout._values,{iconPrimary:Is,iconSecondary:Rs}=P1(vs,this.iconSizeData,_s["icon-size"],b,this.zoom,os,this.pixelRatio,Pt,this.worldview);_r(Is),Rs&&(this.hasAnySecondaryIcon=!0,_r(Rs))}const ss=ws.getAppearances();if(ss.length!==0&&ss.forEach(_s=>{if(!_s.getProperty("icon-image"))return;const Is=this.getCombinedIconPrimary(_s,ws,ds,b,hr,os,Pt);Is&&_r(Is)}),fs){const _s=ht.evaluate(ds,{},b).join(","),Is=st.get("text-rotation-alignment")==="map"&&st.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(np.vertical)>=0;for(const Rs of fs.sections)if(Rs.image){const rn=Rs.image.getPrimary().scaleSelf(this.pixelRatio),zs=rn.id.toString(),Hs=nr.get(zs)||[];Hs.push(rn),nr.set(zs,Hs)}else{const rn=My(fs.toString()),zs=Rs.fontStack||_s,Hs=lr[zs]=lr[zs]||{};this.calculateGlyphDependencies(Rs.text,Hs,Is,this.allowVerticalPlacement,rn)}}}if(st.get("symbol-placement")==="line"&&(this.features=function(Rr){const kr={},Lr={},is=[];let Br=0;function as(ws){is.push(Rr[ws]),Br++}function ds(ws,xs,ys){const os=Lr[ws];return delete Lr[ws],Lr[xs]=os,is[os].geometry[0].pop(),is[os].geometry[0]=is[os].geometry[0].concat(ys[0]),os}function fs(ws,xs,ys){const os=kr[xs];return delete kr[xs],kr[ws]=os,is[os].geometry[0].shift(),is[os].geometry[0]=ys[0].concat(is[os].geometry[0]),os}function vs(ws,xs,ys){const os=ys?xs[0][xs[0].length-1]:xs[0][0];return`${ws}:${os.x}:${os.y}`}for(let ws=0;ws<Rr.length;ws++){const xs=Rr[ws],ys=xs.geometry,os=xs.text?xs.text.toString():null;if(!os){as(ws);continue}const ss=vs(os,ys),_s=vs(os,ys,!0);if(ss in Lr&&_s in kr&&Lr[ss]!==kr[_s]){const Is=fs(ss,_s,ys),Rs=ds(ss,_s,is[Is].geometry);delete kr[ss],delete Lr[_s],Lr[vs(os,is[Rs].geometry,!0)]=Rs,is[Is].geometry=null}else ss in Lr?ds(ss,_s,ys):_s in kr?fs(ss,_s,ys):(as(ws),kr[ss]=Br-1,Lr[_s]=Br-1)}return is.filter(ws=>ws.geometry)}(this.features)),st.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Rr of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Rr.id,this.elevationFeatures.length),this.elevationFeatures.push(Rr)}}else st.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Rr,kr)=>Rr.sortKey-kr.sortKey)}getCombinedIconPrimary(s,a,b,$,it,st,at){let ht,ft;const xt=s.getUnevaluatedProperties();if(xt._values["icon-image"].value!==void 0){const Et=a.getAppearanceValueAndResolveTokens(s,"icon-image",b,$,it);ht=this.getResolvedImageFromTokens(Et)}else{const Et=a.getValueAndResolveTokens("icon-image",b,$,it);ht=this.getResolvedImageFromTokens(Et)}if(ht){const Et=xt._values["icon-size"]||a._unevaluatedLayout._values["icon-size"];ft=P1(ht,L_(this.zoom,Et,this.worldview),Et,$,this.zoom,st,this.pixelRatio,at,this.worldview).iconPrimary}return ft}updateAppearanceBasedIconTextures(s,a,b,$){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const it=this.layers[0];let st=!1,at=0;const ht=it.layout,[ft,xt]=ht.get("icon-size-scale-range"),Et=Qt(1,ft,xt);for(let Rt=0;Rt<this.symbolInstances.length;Rt++){const Pt=this.symbolInstances.get(Rt),Lt=this.featureToAppearanceIndex[Pt.featureIndex],Gt=Lt!==void 0?this.appearanceFeatureData[Lt]:void 0;if(Gt&&Pt.placedIconSymbolIndex>=0){const Kt=Gt.id,Xt=a&&Kt!==void 0?a[String(Kt)]:void 0,nr={type:"Point",id:Gt.id,properties:Gt.properties,geometry:[]},lr=this.layers[0].appearances&&this.layers[0].appearances.find(hr=>hr.isActive({globals:$,feature:nr,canonical:s,featureState:Xt}));if(Gt.activeAppearance===lr){at+=Pt.numIconVertices;continue}if(lr){Gt.activeAppearance=lr;const hr=this.getCombinedIconPrimary(lr,it,nr,s,b,{sortKey:void 0,text:void 0,icon:null,index:Pt.featureIndex,sourceLayerIndex:Pt.featureIndex,geometry:[],properties:Gt.properties,type:"Point",id:Gt.id},Et);if(!hr)continue;const Er=hr.toString(),_r=this.iconAtlasPositions&&this.iconAtlasPositions.get(Er);if(_r){const Rr=it.getAppearanceValueAndResolveTokens(lr,"icon-offset",nr,s,b),kr=Rr&&Array.isArray(Rr)?Rr:[0,0];let Lr=RE(_r,void 0,kr,it.layout.get("icon-anchor").evaluate(nr,{},s));const is=it.getAppearanceValueAndResolveTokens(lr,"icon-rotate",nr,s,b),Br=typeof is=="number"?is:0,as=_r.sdf,ds=it.layout.get("icon-text-fit").constantOr("none");ds!=="none"&&Gt.textShaping&&Gt.iconTextFitPadding&&Gt.fontScale&&(Lr=_S(Lr,Gt.textShaping,ds,Gt.iconTextFitPadding,kr,Gt.fontScale));const fs=this.calculateEffectiveAppearanceIconSize(lr,$.zoom,nr,s,b,Et),vs=0,ws=1+(Math.min(yx,Math.round(fs*mm))<<1),xs=ES(Lr,Br,as,ds!=="none",Et);Gt.isUsingAppearanceVertexData||(Gt.isUsingAppearanceVertexData=!0,Gt.layoutBasedVertexData=this.icon.getIconVertexData(at,Pt.numIconVertices));for(let os=0;os<xs.length;++os){const ss=xs[os],_s=Gt.layoutBasedVertexData[0]||Pt.tileAnchorX,Is=Gt.layoutBasedVertexData[1]||Pt.tileAnchorY,Rs=16*ss.pixelOffsetTL.x,rn=16*ss.pixelOffsetTL.y,zs=16*ss.pixelOffsetBR.x,Hs=16*ss.pixelOffsetBR.y,Ys=16*ss.minFontScaleX,zn=16*ss.minFontScaleY;this.icon.updateIconVertexData(at,_s,Is,Math.round(32*ss.tl.x),Math.round(32*ss.tl.y),ss.texPrimary.x,ss.texPrimary.y,vs,ws,Rs,rn,Ys,zn),this.icon.updateIconVertexData(at+1,_s,Is,Math.round(32*ss.tr.x),Math.round(32*ss.tr.y),ss.texPrimary.x+ss.texPrimary.w,ss.texPrimary.y,vs,ws,zs,rn,Ys,zn),this.icon.updateIconVertexData(at+2,_s,Is,Math.round(32*ss.bl.x),Math.round(32*ss.bl.y),ss.texPrimary.x,ss.texPrimary.y+ss.texPrimary.h,vs,ws,Rs,Hs,Ys,zn),this.icon.updateIconVertexData(at+3,_s,Is,Math.round(32*ss.br.x),Math.round(32*ss.br.y),ss.texPrimary.x+ss.texPrimary.w,ss.texPrimary.y+ss.texPrimary.h,vs,ws,zs,Hs,Ys,zn),at+=4}const ys=Pt.numIconVertices-4*xs.length;for(let os=0;os<ys;++os)this.icon.updateIconVertexData(at+os,0,0,0,0,0,0,0,0,0,0,0,0);st=!0}else at+=Pt.numIconVertices}else if(Gt.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(at,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(at+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(at+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(at+3,0,0,0,0,0,0,0,0,0,0,0,0),st=!0),at+=Pt.numIconVertices,Gt.activeAppearance=null;else if(Gt.isUsingAppearanceVertexData){const Er=Gt.layoutBasedVertexData.length/12;for(let _r=0;_r<Er;++_r){const Rr=_r*12;this.icon.updateIconVertexData(at+_r,Gt.layoutBasedVertexData[Rr+0],Gt.layoutBasedVertexData[Rr+1],Gt.layoutBasedVertexData[Rr+2],Gt.layoutBasedVertexData[Rr+3],Gt.layoutBasedVertexData[Rr+4],Gt.layoutBasedVertexData[Rr+5],Gt.layoutBasedVertexData[Rr+6],Gt.layoutBasedVertexData[Rr+7],Gt.layoutBasedVertexData[Rr+8],Gt.layoutBasedVertexData[Rr+9],Gt.layoutBasedVertexData[Rr+10],Gt.layoutBasedVertexData[Rr+11])}at+=Er,Gt.isUsingAppearanceVertexData=!1,Gt.activeAppearance=null,st=!0}else at+=Pt.numIconVertices,Gt.activeAppearance=null}}return st}update(s,a,b,$,it,st,at){this.text.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,this.worldview),this.icon.programConfigurations.updatePaintArrays(s,a,it,b,$,st,at,this.worldview)}updateRoadElevation(s){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const b=ir(s),$=1/b;let it=!1,st=!1;for(let at=0;at<this.symbolInstances.length;at++){const ht=this.symbolInstances.get(at),ft=xr(1,0,0),xt=xr(0,1,0),{numHorizontalGlyphVertices:Et,numVerticalGlyphVertices:Rt,numIconVertices:Pt,numVerticalIconVertices:Lt}=ht,Gt=Et>0||Rt>0,Kt=Pt>0,Xt=this.elevationFeatures[ht.elevationFeatureIndex];if(Xt){const nr=new ps(ht.tileAnchorX,ht.tileAnchorY),lr=.075+Xt.pointElevation(nr);ht.zOffset!==lr&&(a=!0,ht.zOffset=lr),lr!==0&&(this.hasAnyZOffset=!0);const hr=Xt.computeSlopeNormal(nr,$),Er=vu(eo(),xr(0,0,1),hr);Nn(ft,ft,Er),Nn(xt,xt,Er),ft[2]*=b,xt[2]*=b,ft[0]===1&&ft[1]===0&&ft[2]===0&&xt[0]===0&&xt[1]===1&&xt[2]===0||(it=it||Gt,st=st||Kt)}if(Gt&&(LE(this.text.orientationVertexArray,Et,ft,xt),LE(this.text.orientationVertexArray,Rt,ft,xt)),Kt){const{placedIconSymbolIndex:nr,verticalPlacedIconSymbolIndex:lr}=ht;nr>=0&&LE(this.icon.orientationVertexArray,Pt,ft,xt),lr>=0&&LE(this.icon.orientationVertexArray,Lt,ft,xt)}}it||(this.text.orientationVertexArray=void 0),st||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const s=(it,st,at)=>{b+=st,b>it.length&&it.resize(b);for(let ht=-st;ht<0;ht++)it.emplace(ht+b,at)},a=(it,st,at)=>{$+=st,$>it.length&&it.resize($);for(let ht=-st;ht<0;ht++)it.emplace(ht+$,at)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let b=0,$=0;for(let it=0;it<this.symbolInstances.length;it++){const st=this.symbolInstances.get(it),{numHorizontalGlyphVertices:at,numVerticalGlyphVertices:ht,numIconVertices:ft}=st,xt=st.zOffset,Et=ft>0;if((at>0||ht>0)&&(s(this.text.zOffsetVertexArray,at,xt),s(this.text.zOffsetVertexArray,ht,xt)),Et){const{placedIconSymbolIndex:Rt,verticalPlacedIconSymbolIndex:Pt}=st;Rt>=0&&a(this.icon.zOffsetVertexArray,ft,xt),Pt>=0&&a(this.icon.zOffsetVertexArray,st.numVerticalIconVertices,xt)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(s,a,b,$,it){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(s),this.iconCollisionBox.upload(s)),this.text.upload(s,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(st=>st.appearances&&st.appearances.length>0)),this.icon.upload(s,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(s,a,b,$){return!!(s&&a&&b)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(s,a,b,$)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=RC(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(s,a){const b=this.lineVertexArray.length;if(s.segment!==void 0)for(const{x:$,y:it}of a)this.lineVertexArray.emplaceBack($,it);return{lineStartIndex:b,lineLength:this.lineVertexArray.length-b}}addSymbols(s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt,Kt,Xt,nr){const lr=s.indexArray,hr=s.layoutVertexArray,Er=s.globeExtVertexArray,_r=s.segments.prepareSegment(4*nr,hr,lr,this.canOverlap?st.sortKey:void 0),Rr=this.glyphOffsetArray.length,kr=_r.vertexLength,Lr=this.allowVerticalPlacement&&at===np.vertical?Math.PI/2:0,is=st.text&&st.text.sections;for(let ds=0;ds<a.length;ds++){const{tl:fs,tr:vs,bl:ws,br:xs,texPrimary:ys,texSecondary:os,pixelOffsetTL:ss,pixelOffsetBR:_s,minFontScaleX:Is,minFontScaleY:Rs,glyphOffset:rn,isSDF:zs,sectionIndex:Hs}=a[ds],Ys=_r.vertexLength,zn=rn[1];if(N1(hr,ft.x,ft.y,fs.x,zn+fs.y,ys.x,ys.y,b,zs,ss.x,ss.y,Is,Rs),N1(hr,ft.x,ft.y,vs.x,zn+vs.y,ys.x+ys.w,ys.y,b,zs,_s.x,ss.y,Is,Rs),N1(hr,ft.x,ft.y,ws.x,zn+ws.y,ys.x,ys.y+ys.h,b,zs,ss.x,_s.y,Is,Rs),N1(hr,ft.x,ft.y,xs.x,zn+xs.y,ys.x+ys.w,ys.y+ys.h,b,zs,_s.x,_s.y,Is,Rs),ht){const{x:Cs,y:Qs,z:vn}=ht.anchor,[Wn,Xn,Rn]=ht.up;O1(Er,Cs,Qs,vn,Wn,Xn,Rn),O1(Er,Cs,Qs,vn,Wn,Xn,Rn),O1(Er,Cs,Qs,vn,Wn,Xn,Rn),O1(Er,Cs,Qs,vn,Wn,Xn,Rn),B_(s.dynamicLayoutVertexArray,Cs,Qs,vn,Lr)}else B_(s.dynamicLayoutVertexArray,ft.x,ft.y,ft.z,Lr);if(Kt){const Cs=os||ys;z1(s.iconTransitioningVertexArray,Cs.x,Cs.y),z1(s.iconTransitioningVertexArray,Cs.x+Cs.w,Cs.y),z1(s.iconTransitioningVertexArray,Cs.x,Cs.y+Cs.h),z1(s.iconTransitioningVertexArray,Cs.x+Cs.w,Cs.y+Cs.h)}lr.emplaceBack(Ys,Ys+1,Ys+2),lr.emplaceBack(Ys+1,Ys+2,Ys+3),_r.vertexLength+=4,_r.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(rn[0]),ds!==a.length-1&&Hs===a[ds+1].sectionIndex||s.programConfigurations.populatePaintArrays(hr.length,st,st.index,{},Pt,Lt,Gt,is&&is[Hs],this.worldview)}const Br=nr-a.length;Br!==0&&this._addNullVertices(Br,hr,b,ht,Er,s,Kt,_r,lr);const as=ht?ht.anchor:ft;s.placedSymbolArray.emplaceBack(as.x,as.y,as.z,ft.x,ft.y,Rr,this.glyphOffsetArray.length-Rr,kr,xt,Et,ft.segment,b?b[0]:0,b?b[1]:0,$[0],$[1],at,0,0,0,Rt,0),s.symbolInstanceIndices.push(Xt)}_addNullVertices(s,a,b,$,it,st,at,ht,ft){for(let xt=0;xt<s;xt++){for(let Rt=0;Rt<4;Rt++)N1(a,0,0,0,0,0,0,b,!1,0,0,0,0),$&&O1(it,0,0,0,0,0,0),B_(st.dynamicLayoutVertexArray,0,0,0,0),at&&z1(st.iconTransitioningVertexArray,0,0);const Et=ht.vertexLength;ft.emplaceBack(Et,Et+1,Et+2),ft.emplaceBack(Et+1,Et+2,Et+3),ht.vertexLength+=4,ht.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(s,a,b,$,it,st,at){s.emplaceBack(a,b,$,it,st,Math.round(at.x),Math.round(at.y))}_addCollisionDebugVertices(s,a,b,$,it,st,at){const ht=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),ft=ht.vertexLength,xt=at.tileAnchorX,Et=at.tileAnchorY;for(let Pt=0;Pt<4;Pt++)b.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(b.collisionVertexArrayExt,a,s.padding,at.zOffset),this._commitLayoutVertex(b.layoutVertexArray,$,it,st,xt,Et,new ps(s.x1,s.y1)),this._commitLayoutVertex(b.layoutVertexArray,$,it,st,xt,Et,new ps(s.x2,s.y1)),this._commitLayoutVertex(b.layoutVertexArray,$,it,st,xt,Et,new ps(s.x2,s.y2)),this._commitLayoutVertex(b.layoutVertexArray,$,it,st,xt,Et,new ps(s.x1,s.y2)),ht.vertexLength+=4;const Rt=b.indexArray;Rt.emplaceBack(ft,ft+1),Rt.emplaceBack(ft+1,ft+2),Rt.emplaceBack(ft+2,ft+3),Rt.emplaceBack(ft+3,ft),ht.primitiveLength+=4}_addTextDebugCollisionBoxes(s,a,b,$,it,st){for(let at=$;at<it;at++){const ht=b.get(at),ft=this.getSymbolInstanceTextSize(s,st,a,at);this._addCollisionDebugVertices(ht,ft,this.textCollisionBox,ht.projectedAnchorX,ht.projectedAnchorY,ht.projectedAnchorZ,st)}}_addIconDebugCollisionBoxes(s,a,b,$,it,st){for(let at=$;at<it;at++){const ht=b.get(at),ft=this.getSymbolInstanceIconSize(s,a,st.placedIconSymbolIndex);this._addCollisionDebugVertices(ht,ft,this.iconCollisionBox,ht.projectedAnchorX,ht.projectedAnchorY,ht.projectedAnchorZ,st)}}generateCollisionDebugBuffers(s,a,b){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new AS(h_,GR.members,tp),this.iconCollisionBox=new AS(h_,GR.members,tp);const $=D_(this.iconSizeData,s),it=D_(this.textSizeData,s,b);for(let st=0;st<this.symbolInstances.length;st++){const at=this.symbolInstances.get(st);this._addTextDebugCollisionBoxes(it,s,a,at.textBoxStartIndex,at.textBoxEndIndex,at),this._addTextDebugCollisionBoxes(it,s,a,at.verticalTextBoxStartIndex,at.verticalTextBoxEndIndex,at),this._addIconDebugCollisionBoxes($,s,a,at.iconBoxStartIndex,at.iconBoxEndIndex,at),this._addIconDebugCollisionBoxes($,s,a,at.verticalIconBoxStartIndex,at.verticalIconBoxEndIndex,at)}}getSymbolInstanceTextSize(s,a,b,$){const it=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:$),st=vS(this.textSizeData,s,it)/su;return this.tilePixelRatio*st}getSymbolInstanceIconSize(s,a,b){const $=this.icon.placedSymbolArray.get(b),it=vS(this.iconSizeData,s,$);return this.tilePixelRatio*it}_commitDebugCollisionVertexUpdate(s,a,b,$){s.emplaceBack(a,-b,-b,$),s.emplaceBack(a,b,-b,$),s.emplaceBack(a,b,b,$),s.emplaceBack(a,-b,b,$)}_updateTextDebugCollisionBoxes(s,a,b,$,it,st,at){for(let ht=$;ht<it;ht++){const ft=b.get(ht),xt=this.getSymbolInstanceTextSize(s,st,a,ht);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,xt,ft.padding,st.zOffset)}}_updateIconDebugCollisionBoxes(s,a,b,$,it,st,at){for(let ht=$;ht<it;ht++){const ft=b.get(ht),xt=this.getSymbolInstanceIconSize(s,a,st.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,xt,ft.padding,st.zOffset)}}updateCollisionDebugBuffers(s,a,b,$){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const it=D_(this.iconSizeData,s,$),st=D_(this.textSizeData,s,b);for(let at=0;at<this.symbolInstances.length;at++){const ht=this.symbolInstances.get(at);this._updateTextDebugCollisionBoxes(st,s,a,ht.textBoxStartIndex,ht.textBoxEndIndex,ht,b),this._updateTextDebugCollisionBoxes(st,s,a,ht.verticalTextBoxStartIndex,ht.verticalTextBoxEndIndex,ht,b),this._updateIconDebugCollisionBoxes(it,s,a,ht.iconBoxStartIndex,ht.iconBoxEndIndex,ht,$),this._updateIconDebugCollisionBoxes(it,s,a,ht.verticalIconBoxStartIndex,ht.verticalIconBoxEndIndex,ht,$)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(s,a,b,$,it,st,at,ht,ft){const xt={};if(a<b){const{x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr,featureIndex:Er}=s.get(a);xt.textBox={x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr},xt.textFeatureIndex=Er}if($<it){const{x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr,featureIndex:Er}=s.get($);xt.verticalTextBox={x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr},xt.verticalTextFeatureIndex=Er}if(st<at){const{x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr,featureIndex:Er}=s.get(st);xt.iconBox={x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr},xt.iconFeatureIndex=Er}if(ht<ft){const{x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr,featureIndex:Er}=s.get(ht);xt.verticalIconBox={x1:Et,y1:Rt,x2:Pt,y2:Lt,padding:Gt,projectedAnchorX:Kt,projectedAnchorY:Xt,projectedAnchorZ:nr,tileAnchorX:lr,tileAnchorY:hr},xt.verticalIconFeatureIndex=Er}return xt}deserializeCollisionBoxes(s){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const b=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(s,b.textBoxStartIndex,b.textBoxEndIndex,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b.iconBoxStartIndex,b.iconBoxEndIndex,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(s,a){const b=s.placedSymbolArray.get(a),$=b.vertexStartIndex+4*b.numGlyphs;for(let it=b.vertexStartIndex;it<$;it+=4)s.indexArray.emplaceBack(it,it+1,it+2),s.indexArray.emplaceBack(it+1,it+2,it+3)}getSortedSymbolIndexes(s){if(this.sortedAngle===s&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(s),b=Math.cos(s),$=[],it=[],st=[];for(let at=0;at<this.symbolInstances.length;++at){st.push(at);const ht=this.symbolInstances.get(at);$.push(0|Math.round(a*ht.tileAnchorX+b*ht.tileAnchorY)),it.push(ht.featureIndex)}return st.sort((at,ht)=>$[at]-$[ht]||it[ht]-it[at]),st}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let s=0;s<this.symbolInstances.length;++s)this.symbolInstanceIndexesSortedZOffset.push(s)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((s,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(s).zOffset)}addToSortKeyRanges(s,a){const b=this.sortKeyRanges[this.sortKeyRanges.length-1];b&&b.sortKey===a?b.symbolInstanceEnd=s+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:s,symbolInstanceEnd:s+1})}sortFeatures(s){if(this.sortFeaturesByY&&this.sortedAngle!==s&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(s),this.sortedAngle=s,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const b=this.symbolInstances.get(a);this.featureSortOrder.push(b.featureIndex);const{rightJustifiedTextSymbolIndex:$,centerJustifiedTextSymbolIndex:it,leftJustifiedTextSymbolIndex:st,verticalPlacedTextSymbolIndex:at,placedIconSymbolIndex:ht,verticalPlacedIconSymbolIndex:ft}=b;$>=0&&this.addIndicesForPlacedSymbol(this.text,$),it>=0&&it!==$&&this.addIndicesForPlacedSymbol(this.text,it),st>=0&&st!==it&&st!==$&&this.addIndicesForPlacedSymbol(this.text,st),at>=0&&this.addIndicesForPlacedSymbol(this.text,at),ht>=0&&this.addIndicesForPlacedSymbol(this.icon,ht),ft>=0&&this.addIndicesForPlacedSymbol(this.icon,ft)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(s){const a=this.symbolInstances.get(this.text.symbolInstanceIndices[s]).elevationFeatureIndex;let b;return this.elevationFeatures&&a<this.elevationFeatures.length&&(b=this.elevationFeatures[a]),b}}function CC(g,s){return s.replace(/{([^{}]+)}/g,(a,b)=>b in g?String(g[b]):"")}let AC,jC,jS;Xs(DE,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),DE.addDynamicAttributes=B_;class PC{constructor(s){this.type=s.property.overrides?s.property.overrides.runtimeType:Sp,this.defaultValue=s}evaluate(s){if(s.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(s.formattedSection))return a.getOverride(s.formattedSection)}return s.feature&&s.featureState?this.defaultValue.evaluate(s.feature,s.featureState):this.defaultValue.property.specification.default}eachChild(s){this.defaultValue.isConstant()||s(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Xs(PC,"FormatSectionOverride",{omit:["defaultValue"]});const PS=()=>jS||(jS={layout:AC||(AC=new Sl({"symbol-placement":new As(Gr.layout_symbol["symbol-placement"]),"symbol-spacing":new As(Gr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new As(Gr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fs(Gr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new As(Gr.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new As(Gr.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new As(Gr.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new As(Gr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new As(Gr.layout_symbol["icon-ignore-placement"]),"icon-optional":new As(Gr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new As(Gr.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fs(Gr.layout_symbol["icon-size"]),"icon-size-scale-range":new As(Gr.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Fs(Gr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fs(Gr.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fs(Gr.layout_symbol["icon-image"]),"icon-image-use-theme":new As({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Fs(Gr.layout_symbol["icon-rotate"]),"icon-padding":new As(Gr.layout_symbol["icon-padding"]),"icon-keep-upright":new As(Gr.layout_symbol["icon-keep-upright"]),"icon-offset":new Fs(Gr.layout_symbol["icon-offset"]),"icon-anchor":new Fs(Gr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new As(Gr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new As(Gr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new As(Gr.layout_symbol["text-rotation-alignment"]),"text-field":new Fs(Gr.layout_symbol["text-field"]),"text-font":new Fs(Gr.layout_symbol["text-font"]),"text-size":new Fs(Gr.layout_symbol["text-size"]),"text-size-scale-range":new As(Gr.layout_symbol["text-size-scale-range"]),"text-max-width":new Fs(Gr.layout_symbol["text-max-width"]),"text-line-height":new Fs(Gr.layout_symbol["text-line-height"]),"text-letter-spacing":new Fs(Gr.layout_symbol["text-letter-spacing"]),"text-justify":new Fs(Gr.layout_symbol["text-justify"]),"text-radial-offset":new Fs(Gr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new As(Gr.layout_symbol["text-variable-anchor"]),"text-anchor":new Fs(Gr.layout_symbol["text-anchor"]),"text-max-angle":new As(Gr.layout_symbol["text-max-angle"]),"text-writing-mode":new As(Gr.layout_symbol["text-writing-mode"]),"text-rotate":new Fs(Gr.layout_symbol["text-rotate"]),"text-padding":new As(Gr.layout_symbol["text-padding"]),"text-keep-upright":new As(Gr.layout_symbol["text-keep-upright"]),"text-transform":new Fs(Gr.layout_symbol["text-transform"]),"text-offset":new Fs(Gr.layout_symbol["text-offset"]),"text-allow-overlap":new As(Gr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new As(Gr.layout_symbol["text-ignore-placement"]),"text-optional":new As(Gr.layout_symbol["text-optional"]),visibility:new As(Gr.layout_symbol.visibility)})),paint:jC||(jC=new Sl({"icon-opacity":new Fs(Gr.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Fs(Gr.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Fs(Gr.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fs(Gr.paint_symbol["text-emissive-strength"]),"icon-color":new Fs(Gr.paint_symbol["icon-color"]),"icon-halo-color":new Fs(Gr.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fs(Gr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fs(Gr.paint_symbol["icon-halo-blur"]),"icon-translate":new As(Gr.paint_symbol["icon-translate"]),"icon-translate-anchor":new As(Gr.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new As(Gr.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fs(Gr.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Fs(Gr.paint_symbol["text-occlusion-opacity"]),"text-color":new Fs(Gr.paint_symbol["text-color"],{runtimeType:$u,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new Fs(Gr.paint_symbol["text-halo-color"]),"text-halo-width":new Fs(Gr.paint_symbol["text-halo-width"]),"text-halo-blur":new Fs(Gr.paint_symbol["text-halo-blur"]),"text-translate":new As(Gr.paint_symbol["text-translate"]),"text-translate-anchor":new As(Gr.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new As(Gr.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new As(Gr.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new As(Gr.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new As(Gr.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Fs(Gr.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},jS);class NE extends Fu{constructor(s,a,b,$){super(s,PS(),a,b,$,s.layout?s.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Jt([]),this.hasOcclusionOpacityProperties=s.paint!==void 0&&("icon-occlusion-opacity"in s.paint||"text-occlusion-opacity"in s.paint)}_handleSpecialPaintPropertyUpdate(s){s!=="icon-occlusion-opacity"&&s!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(s,a){super.recalculate(s,a),this.appearances&&this.appearances.forEach($=>{$.recalculate(s,a,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const b=this.layout.get("text-writing-mode");if(b){const $=[];for(const it of b)$.indexOf(it)<0&&$.push(it);this.layout._values["text-writing-mode"]=$}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(s,a,b,$){return this._saturation===s&&this._contrast===a&&this._brightnessMin===b&&this._brightnessMax===$||(this._colorAdjustmentMatrix=function(it,st,at,ht){it=xl(it),st=io(st);const ft=Vt(),xt=it/3,Et=1-2*xt,Rt=[Et,xt,xt,0,xt,Et,xt,0,xt,xt,Et,0,0,0,0,1],Pt=.5-.5*st,Lt=ht-at;return It(ft,[Lt,0,0,0,0,Lt,0,0,0,0,Lt,0,at,at,at,1],[st,0,0,0,0,st,0,0,0,0,st,0,Pt,Pt,Pt,1]),It(ft,ft,Rt),ft}(s,a,b,$),this._saturation=s,this._contrast=a,this._brightnessMin=b,this._brightnessMax=$),this._colorAdjustmentMatrix}getValueAndResolveTokens(s,a,b,$){const it=this.layout.get(s).evaluate(a,{},b,$),st=this._unevaluatedLayout._values[s];return st.isDataDriven()||Iy(st.value)||!it?it:CC(a.properties,it)}getAppearanceValueAndResolveTokens(s,a,b,$,it){const st=s.getProperty(a);if(!st)return;const at=st.evaluate(b,{},$,it),ht=s.getUnevaluatedProperties()._values[a];return ht.isDataDriven()||Iy(ht.value)||!at||typeof at!="string"?at:CC(b.properties,at)}createBucket(s){return new DE(s)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const s of PS().paint.overridableProperties){if(!NE.hasPaintOverride(this.layout,s))continue;const a=this.paint.get(s),b=new PC(a),$=new q0(b,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let it=null;it=a.value.kind==="constant"||a.value.kind==="source"?new Dx("source",$):new sx("composite",$,a.value.zoomStops,a.value.interpolationType),this.paint._values[s]=new ox(a.property,it,a.parameters)}}_handleOverridablePaintPropertyUpdate(s,a,b){return!(!this.layout||a.isDataDriven()||b.isDataDriven())&&NE.hasPaintOverride(this.layout,s)}static hasPaintOverride(s,a){const b=s.get("text-field"),$=PS().paint.properties[a];let it=!1;const st=at=>{for(const ht of at)if($.overrides&&$.overrides.hasOverride(ht))return void(it=!0)};if(b.value.kind==="constant"&&b.value.value instanceof Pu)st(b.value.value.sections);else if(b.value.kind==="source"){const at=ft=>{it||(ft instanceof Qp&&iu(ft.value)===gy?st(ft.value.sections):ft instanceof zp?st(ft.sections):ft.eachChild(at))},ht=b.value;ht._styleExpression&&at(ht._styleExpression.expression)}return it}getProgramIds(){return["symbol"]}getDefaultProgramParams(s,a,b){return{config:new Bm(this,{zoom:a,lut:b}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let IC,kC,MC,FC;var IS=Vn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function zE(g,s,a,b,$,it,st,at){const ht=[g,s,1,a,b,1,$,it,1],ft=[st,at,1],xt=At([],ht),[Et,Rt,Pt]=Us(ft,ft,xt);return Nt(ht,ht,[Et,0,0,0,Rt,0,0,0,Pt])}function LC(g,s,a,b,$,it,st,at){const ht=function(ft,xt,Et,Rt,Pt,Lt,Gt,Kt){const Xt=zE(0,0,1,0,1,1,0,1),nr=zE(ft,xt,Et,Rt,Pt,Lt,Gt,Kt);return Nt(nr,nr,At([],Xt))}(g,s,a,b,$,it,st,at);return[ht[2]/ht[8]/Ps,ht[5]/ht[8]/Ps]}function OE(g){return[g[0],Math.min(Math.max(g[1],-$t),$t)]}class DC extends Jm{constructor(s,a,b,$){super(),this.id=s,this.dispatcher=b,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent($),this.options=a,this._dirty=!1}load(s,a){if(this._loaded=a||!1,this.fire(new Dp("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return s&&(this.coordinates=s),this._loaded=!0,void this._finishLoading();this._imageRequest=p0(this.map._requestManager.transformRequest(this.url,cy.Image),(b,$)=>{this._imageRequest=null,this._loaded=!0,b?this.fire(new fy(b)):$&&(this.image=$ instanceof HTMLImageElement?ru.getImageData($):$,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading())})}loaded(){return this._loaded}updateImage(s){return s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}setTexture(s){if(!(s.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new E1(this.map.painter.context,s.handle),this.width=s.dimensions[0],this.height=s.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Dp("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(s){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof E1||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(s){if(this.coordinates=s,this._boundsArray=void 0,this._unsupportedCoords=!1,!s.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=s[0][1],b=s[0][1];for(const it of s)it[1]>b&&(b=it[1]),it[1]<a&&(a=it[1]);const $=(b+a)/2;if($>$t?this.onNorthPole=!0:$<-$t&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const it=s.map(cr.fromLngLat);this.tileID=function(st){let at=1/0,ht=1/0,ft=-1/0,xt=-1/0;for(const Gt of st)at=Math.min(at,Gt.x),ht=Math.min(ht,Gt.y),ft=Math.max(ft,Gt.x),xt=Math.max(xt,Gt.y);const Et=Math.max(ft-at,xt-ht),Rt=Math.max(0,Math.floor(-Math.log2(Et))),Pt=Math.pow(2,Rt);let Lt=Math.floor((at+ft)/2*Pt);return Lt>1&&(Lt-=1),new Mo(Rt,Lt,Math.floor((ht+xt)/2*Pt))}(it),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Dp("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof E1||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(s){for(const Xt in this.tiles){const nr=this.tiles[Xt];nr.state!=="loaded"&&(nr.state="loaded",nr.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=k1(new Mo(0,0,0),this.map.transform.projection),b=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(Xt){const nr=Xt[1].x-Xt[0].x,lr=Xt[1].y-Xt[0].y,hr=Xt[2].x-Xt[1].x,Er=Xt[2].y-Xt[1].y,_r=Xt[3].x-Xt[2].x,Rr=Xt[3].y-Xt[2].y,kr=Xt[0].x-Xt[3].x,Lr=Xt[0].y-Xt[3].y,is=nr*Er-hr*lr,Br=hr*Rr-_r*Er,as=_r*Lr-kr*Rr,ds=kr*lr-nr*Lr;return is>0&&Br>0&&as>0&&ds>0||is<0&&Br<0&&as<0&&ds<0}(b))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const $=k1(this.tileID,this.map.transform.projection),[it,st,at,ht]=this.coordinates.map(Xt=>{const nr=$.projection.project(Xt[0],Xt[1]);return bC($,nr)._round()});this.perspectiveTransform=LC(it.x,it.y,st.x,st.y,at.x,at.y,ht.x,ht.y);const ft=this._boundsArray=new Bx;ft.emplaceBack(it.x,it.y,0,0),ft.emplaceBack(st.x,st.y,Ps,0),ft.emplaceBack(ht.x,ht.y,0,Ps),ft.emplaceBack(at.x,at.y,Ps,Ps),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=s.createVertexBuffer(ft,IS.members),this.boundsSegments=ga.simpleSegment(0,0,4,2);const xt=[],Et=[OE((Rt=this.coordinates)[0]),OE(Rt[1]),OE(Rt[2]),OE(Rt[3])];var Rt;const[Pt,Lt,Gt,Kt]=function(Xt){let nr=Xt[0][0],lr=nr,hr=Xt[0][1],Er=hr;for(let _r=1;_r<Xt.length;_r++)Xt[_r][0]<nr?nr=Xt[_r][0]:Xt[_r][0]>lr&&(lr=Xt[_r][0]),Xt[_r][1]<hr?hr=Xt[_r][1]:Xt[_r][1]>Er&&(Er=Xt[_r][1]);return[nr,hr,lr-nr,Er-hr]}(Et);{const Xt=new Bx,[nr,lr,hr,Er]=function(xs){let ys=xs[0].x,os=ys,ss=xs[0].y,_s=ss;for(let Is=1;Is<xs.length;Is++)xs[Is].x<ys?ys=xs[Is].x:xs[Is].x>os&&(os=xs[Is].x),xs[Is].y<ss?ss=xs[Is].y:xs[Is].y>_s&&(_s=xs[Is].y);return[ys,ss,os-ys,_s-ss]}(b),_r=xs=>[(xs.x-nr)/hr,(xs.y-lr)/Er],[Rr,kr,Lr,is]=b.map(_r),Br=function(xs,ys,os,ss,_s,Is,Rs,rn){const zs=zE(0,0,1,0,1,1,0,1);return Nt(zs,zs,At([],zE(xs,ys,os,ss,_s,Is,Rs,rn)))}(Rr[0],Rr[1],kr[0],kr[1],Lr[0],Lr[1],is[0],is[1]);this.elevatedGlobePerspectiveTransform=LC(Rr[0],Rr[1],kr[0],kr[1],Lr[0],Lr[1],is[0],is[1]);const as=(xs,ys)=>{xt.push(xs.lng);const os=Math.round((xs.lng-Pt)/Gt*Ps),ss=Math.round((xs.lat-Lt)/Kt*Ps),_s=_r(ys),Is=Us([],[_s[0],_s[1],1],Br),Rs=Math.round(Is[0]/Is[2]*Ps),rn=Math.round(Is[1]/Is[2]*Ps);Xt.emplaceBack(os,ss,Rs,rn)},ds=b[3].x-b[0].x,fs=b[3].y-b[0].y,vs=b[2].x-b[1].x,ws=b[2].y-b[1].y;for(let xs=0;xs<65;xs++){const ys=xs/64,os=[b[0].x+ys*ds,b[0].y+ys*fs],ss=[b[1].x+ys*vs,b[1].y+ys*ws],_s=ss[0]-os[0],Is=ss[1]-os[1];for(let Rs=0;Rs<65;Rs++){const rn=Rs/64,zs={x:os[0]+_s*rn,y:os[1]+Is*rn};as(a.projection.unproject(zs.x,zs.y),zs)}}this.elevatedGlobeVertexBuffer=s.createVertexBuffer(Xt,IS.members)}{this.maxLongitudeTriangleSize=0;let Xt=[],nr=new Zl;const lr=(hr,Er,_r)=>{nr.emplaceBack(hr,Er,_r);const Rr=xt[hr],kr=xt[Er],Lr=xt[_r],is=Math.min(Math.min(Rr,kr),Lr),Br=Math.max(Math.max(Rr,kr),Lr)-is;Br>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Br),Xt.push(is+Br/2)};for(let hr=0;hr<64;hr++)for(let Er=0;Er<64;Er++){const _r=65*hr+Er,Rr=_r+1,kr=_r+65,Lr=kr+1;lr(_r,kr,Rr),lr(Rr,kr,Lr)}[Xt,nr]=function(hr,Er){const _r=Array.from({length:hr.length},(Lr,is)=>is);_r.sort((Lr,is)=>hr[Lr]-hr[is]);const Rr=[],kr=new Zl;for(let Lr=0;Lr<_r.length;Lr++){const is=_r[Lr];Rr.push(hr[is]);const Br=3*is,as=Br+1;kr.emplaceBack(Er.uint16[Br],Er.uint16[as],Er.uint16[as+1])}return[Rr,kr]}(Xt,nr),this.elevatedGlobeTrianglesCenterLongitudes=Xt,this.elevatedGlobeIndexBuffer=s.createIndexBuffer(nr)}this.elevatedGlobeSegments=ga.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Gt/Ps,0,Kt/Ps,0,0,Lt,Pt,0])}prepare(){const s=Object.keys(this.tiles).length!==0;if(this.tileID&&!s)return;const a=this.map.painter.context,b=a.gl;!this._dirty||this.texture instanceof E1||(this.texture?this.texture.update(this.image):(this.texture=new rS(a,this.image,b.RGBA8),this.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE)),this._dirty=!1),s&&this._prepareData(a)}loadTile(s,a){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},a(null)):(s.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(s){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const b=this.elevatedGlobeTrianglesCenterLongitudes;let $=(it=s+180)+360*Math.round((b[0]-it)/360);var it;const st=new ga,at=(Et,Rt)=>{st.segments.push({vertexOffset:0,primitiveOffset:Et,vertexLength:a.segments[0].vertexLength,primitiveLength:Rt,sortKey:void 0,vaos:{}})},ht=.51*this.maxLongitudeTriangleSize;if(Math.abs(b[0]-$)<=ht){const Et=$a(b,0,b.length,$+ht);return Et===b.length||at(Et,Hl(b,Et+1,b.length,$+360-ht)-Et),st}$<b[0]&&($+=360);const ft=Hl(b,0,b.length,$-ht);if(ft===b.length)return at(0,b.length),st;at(0,ft-0);const xt=$a(b,ft+1,b.length,$+ht);return xt!==b.length&&at(xt,b.length-xt),st}}const FM=(Math.pow(256,2)-1)/16907520;class NC extends Fu{constructor(s,a,b,$){super(s,{layout:MC||(MC=new Sl({visibility:new As(Gr.layout_raster.visibility)})),paint:FC||(FC=new Sl({"raster-opacity":new As(Gr.paint_raster["raster-opacity"]),"raster-color":new lx(Gr.paint_raster["raster-color"]),"raster-color-mix":new As(Gr.paint_raster["raster-color-mix"]),"raster-color-range":new As(Gr.paint_raster["raster-color-range"]),"raster-hue-rotate":new As(Gr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new As(Gr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new As(Gr.paint_raster["raster-brightness-max"]),"raster-saturation":new As(Gr.paint_raster["raster-saturation"]),"raster-contrast":new As(Gr.paint_raster["raster-contrast"]),"raster-resampling":new As(Gr.paint_raster["raster-resampling"]),"raster-fade-duration":new As(Gr.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new As(Gr.paint_raster["raster-emissive-strength"]),"raster-array-band":new As(Gr.paint_raster["raster-array-band"]),"raster-elevation":new As(Gr.paint_raster["raster-elevation"]),"raster-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},a,b,$),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(s){return!(s&&s._source instanceof DC&&(s._source.onNorthPole||s._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(s){s!=="raster-color"&&s!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(s){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[b,$]=s||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(b)&&isNaN($)||b===this._curRampRange[0]&&$===this._curRampRange[1]||(this.colorRamp=l1({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:b,end:$}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[b,$])}}let zC,OC,BC,VC,UC;class $C extends Fu{constructor(s,a,b,$){super(s,{layout:zC||(zC=new Sl({visibility:new As(Gr["layout_raster-particle"].visibility)})),paint:OC||(OC=new Sl({"raster-particle-array-band":new As(Gr["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new As(Gr["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new lx(Gr["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new As(Gr["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new As(Gr["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new As(Gr["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new As(Gr["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new As(Gr["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},a,b,$),this._updateColorRamp(),this.lastInvalidatedAt=ru.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(s){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(s){return!1}_handleSpecialPaintPropertyUpdate(s){s!=="raster-particle-color"&&s!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),s==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const s=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=l1({expression:s,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=ru.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class LM extends Fu{constructor(s,a){super(s,{},a,null),this.implementation=s,s.slot&&(this.slot=s.slot)}is3D(s){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(s){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)}onRemove(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)}}function kS(g,s,a){const b=[0,0,1],$=to([]);return ou($,$,a?-wn(g)+Math.PI:wn(g)),Io($,$,-wn(s)),Nn(b,b,$),Cn(b,b)}const GC={None:0,Model:1,Symbol:2,FillExtrusion:4};class BE{constructor(s,a,b,$){this.message=(s?`${s}: `:"")+b,$&&(this.identifier=$),a!=null&&a.__line__&&(this.line=a.__line__)}}function MS(g,s){const a=g.indexOf("://")===-1;try{return new URL(g,a&&s?"http://example.com":void 0),!0}catch{return!1}}class HC{constructor(s,a){this.feature=s,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class WC{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Yv,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(s){const a=16*s,b=this.instancedDataArray.float32;let $=Math.floor(b[a+2]);const it=1.05*(b[a+2]-$);return $/=100,[b[a]%1*1.05,b[a+1]%1*1.05,it,$]}tileCoordinatesForInstance(s){const a=16*s,b=this.instancedDataArray.float32;let $=b[a+0];return $=$>Ps?$-Ps:$,new ps(Math.trunc($),Math.trunc(b[a+1]))}translationForInstance(s){const a=16*s,b=this.instancedDataArray.float32;return[b[a+4],b[a+5],b[a+6]]}rotationScaleForInstance(s){const a=16*s,b=this.instancedDataArray.float32;return[b[a+7],b[a+8],b[a+9],b[a+10],b[a+11],b[a+12],b[a+13],b[a+14],b[a+15]]}transformForInstance(s){const a=16*s,b=this.instancedDataArray.float32;return[b[a+7],b[a+8],b[a+9],b[a+4],b[a+10],b[a+11],b[a+12],b[a+5],b[a+13],b[a+14],b[a+15],b[a+6],0,0,0,1]}}class FS{constructor(s){this.zoom=s.zoom,this.canonical=s.canonical,this.overscaledZ=this.canonical.z+Math.log2(s.overscaling),this.layers=s.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=s.projection,this.index=s.index,this.worldview=s.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=s.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(s,a){}updateAppearances(s,a,b,$){}populate(s,a,b,$){this.tileToMeter=ir(b);const it=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:st,id:at,index:ht,sourceLayerIndex:ft}of s){const xt=at??(st.properties&&st.properties.hasOwnProperty("id")?st.properties.id:void 0),Et=Or(st,it);if(!this.layers[0]._featureFilter.filter(new $o(this.zoom,{worldview:this.worldview,activeFloors:a.activeFloors}),Et,b))continue;const Rt={id:xt,sourceLayerIndex:ft,index:ht,geometry:it?Et.geometry:Pr(st,b,$),properties:st.properties,type:st.type,patterns:{}},Pt=this.addFeature(Rt,Rt.geometry,Et);Pt&&a.featureIndex.insert(st,Rt.geometry,ht,ft,this.index,this.instancesPerModel[Pt].instancedDataArray.length,Ps/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const s=this.layers[0].modelManager,a=this.layers[0].scope;let b=0;for(const $ of this.modelUris){const it=s.getModel($,a);if(!it)continue;const st=this.instancesPerModel[$];if(st){const at=.5*Vs(it.aabb.max,it.aabb.min)*st.maxScale+st.maxXYTranslationDistance,ht=Math.min(Ps,Math.max(at/this.tileToMeter,Ps/32));b=Math.max(ht,b)}}return b}update(s,a,b,$){for(const it in this.instancesPerModel){const st=this.instancesPerModel[it];for(const at in s)st.idToFeaturesIndex.hasOwnProperty(at)&&(this.evaluate(st.features[st.idToFeaturesIndex[at]],s[at],st,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let s=!1;for(const a in this.instancesPerModel){const b=this.instancesPerModel[a];for(const $ of b.features){const it=this.layers[0],st=$.feature,at=this.canonical,ht=it.paint.get("model-rotation").evaluate(st,{},at),ft=it.paint.get("model-scale").evaluate(st,{},at),xt=it.paint.get("model-translation").evaluate(st,{},at);Bn($.rotation,ht)&&Bn($.scale,ft)&&Bn($.translation,xt)||(this.evaluate($,$.featureStates,b,!0),s=!0)}}return s}updateReplacement(s,a,b,$){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const it=a.getReplacementRegionsForTile(s.toUnwrapped(),!0);if(uE(this.activeReplacements,it))return!1;this.activeReplacements=it;let st=!1;for(const at in this.instancesPerModel){const ht=this.instancesPerModel[at],ft=ht.instancedDataArray;for(const xt of ht.features){const Et=xt.instancedDataOffset,Rt=xt.instancedDataCount;for(let Pt=0;Pt<Rt;Pt++){const Lt=16*(Pt+Et);let Gt=ft.float32[Lt+0];const Kt=Gt>Ps;Gt=Kt?Gt-Ps:Gt;const Xt=Math.floor(Gt),nr=Math.floor(ft.float32[Lt+1]);let lr=!1;for(const hr of this.activeReplacements)if(!kT(hr,b,GC.Model,$)&&!(hr.min.x>Xt||Xt>hr.max.x||hr.min.y>nr||nr>hr.max.y)&&(lr=NT(DT(Xt,nr,s.canonical,hr.footprintTileId.canonical),hr.footprint),lr))break;ft.float32[Lt]=lr?Gt+Ps:Gt,st=st||lr!==Kt}}}return st}isEmpty(){for(const s in this.instancesPerModel)if(this.instancesPerModel[s].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(s){if(!this.uploaded)for(const a in this.instancesPerModel){const b=this.instancesPerModel[a];b.instancedDataArray.length<0||b.instancedDataArray.length===0||(b.instancedDataBuffer?b.instancedDataBuffer.updateData(b.instancedDataArray):b.instancedDataBuffer=s.createVertexBuffer(b.instancedDataArray,nI.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(s){for(const b in this.instancesPerModel){const $=this.instancesPerModel[b];$.instancedDataArray.length!==0&&$.instancedDataBuffer&&$.instancedDataBuffer.destroy()}const a=this.layers[0].modelManager;if(s&&a&&this.modelUris&&this.modelsRequested)for(const b of this.modelUris)a.removeModel(b,"",!0)}addFeature(s,a,b){const $=this.layers[0],it=$.layout.get("model-id").evaluate(b,{},this.canonical);if(!it)return $s(`modelId is not evaluated for layer ${$.id} and it is not going to get rendered.`),it;(MS(it,!1)||this.styleDefinedModelURLs[it]!==void 0)&&(this.modelUris.includes(it)||this.modelUris.push(it)),this.instancesPerModel[it]||(this.instancesPerModel[it]=new WC);const st=this.instancesPerModel[it],at=st.instancedDataArray,ht=new HC(b,at.length);for(const ft of a)for(const xt of ft){if(xt.x<0||xt.x>=Ps||xt.y<0||xt.y>=Ps)continue;if(this.lookupDim!==0){const Rt=(this.lookupDim-1)/Ps,Pt=this.lookupDim*(xt.y*Rt|0)+xt.x*Rt|0;if(this.lookup){if(this.lookup[Pt]!==0)continue;this.lookup[Pt]=1}}this.instanceCount++;const Et=at.length;at.resize(Et+1),st.instancesEvaluatedElevation.push(0),at.float32[16*Et]=xt.x,at.float32[16*Et+1]=xt.y}return ht.instancedDataCount=st.instancedDataArray.length-ht.instancedDataOffset,ht.instancedDataCount>0&&(s.id&&(st.idToFeaturesIndex[s.id]=st.features.length),st.features.push(ht),this.evaluate(ht,{},st,!1)),it}getModelUris(){return this.modelUris}evaluate(s,a,b,$){const it=this.layers[0],st=s.feature,at=this.canonical,ht=s.rotation=it.paint.get("model-rotation").evaluate(st,a,at),ft=s.scale=it.paint.get("model-scale").evaluate(st,a,at),xt=s.translation=it.paint.get("model-translation").evaluate(st,a,at),Et=Object.assign({},it.paint.get("model-color").evaluate(st,a,at));Et.a=it.paint.get("model-color-mix-intensity").evaluate(st,a,at);const Rt=[];this.maxVerticalOffset<xt[2]&&(this.maxVerticalOffset=xt[2]);const Pt=xt[0]*xt[0]+xt[1]*xt[1],Lt=Pt>0?Math.sqrt(Pt):0;b.maxScale=Math.max(Math.max(b.maxScale,ft[0]),Math.max(ft[1],ft[2])),b.maxXYTranslationDistance=Math.max(b.maxXYTranslationDistance,Lt),this.maxScale=Math.max(Math.max(this.maxScale,ft[0]),Math.max(ft[1],ft[2])),ER(Rt,ht,ft);const Gt=Math.round(100*Et.a)+Et.b/1.05;for(let Kt=0;Kt<s.instancedDataCount;++Kt){const Xt=s.instancedDataOffset+Kt,nr=16*Xt,lr=b.instancedDataArray.float32;let hr=0;$&&(hr=lr[nr+6]-b.instancesEvaluatedElevation[Xt]);const Er=0|lr[nr+1];lr[nr]=(0|lr[nr])+Et.r/1.05,lr[nr+1]=Er+Et.g/1.05,lr[nr+2]=Gt,lr[nr+3]=1/(at.z>10?this.tileToMeter:ir(at,Er)),lr[nr+4]=xt[0],lr[nr+5]=xt[1],lr[nr+6]=xt[2]+hr,lr[nr+7]=Rt[0],lr[nr+8]=Rt[1],lr[nr+9]=Rt[2],lr[nr+10]=Rt[4],lr[nr+11]=Rt[5],lr[nr+12]=Rt[6],lr[nr+13]=Rt[8],lr[nr+14]=Rt[9],lr[nr+15]=Rt[10],b.instancesEvaluatedElevation[Xt]=xt[2]}}}let qC,ZC;Xs(FS,"ModelBucket",{omit:["layers"]}),Xs(WC,"PerModelAttributes"),Xs(HC,"ModelFeature");class V_{constructor(s,a,b){this._demTile=s,this._dem=this._demTile.dem,this._scale=a,this._offset=b}static create(s,a,b){const $=b||s.findDEMTileFor(a);if(!$||!$.dem)return;const it=$.dem,st=$.tileID,at=1<<a.canonical.z-st.canonical.z;return new V_($,it.dim/Ps/at,[(a.canonical.x/at-st.canonical.x)*it.dim,(a.canonical.y/at-st.canonical.y)*it.dim])}tileCoordToPixel(s,a){const b=a*this._scale+this._offset[1];return new ps(Math.floor(s*this._scale+this._offset[0]),Math.floor(b))}getElevationAt(s,a,b,$){const it=s*this._scale+this._offset[0],st=a*this._scale+this._offset[1],at=Math.floor(it),ht=Math.floor(st),ft=this._dem;return $=!!$,b?pn(pn(ft.get(at,ht,$),ft.get(at,ht+1,$),st-ht),pn(ft.get(at+1,ht,$),ft.get(at+1,ht+1,$),st-ht),it-at):ft.get(at,ht,$)}getElevationAtPixel(s,a,b){return this._dem.get(s,a,!!b)}getMeterToDEM(s){return(1<<this._demTile.tileID.canonical.z)*Tt(1,s)*this._dem.stride}}const LS=new Float32Array(262144),Jy=new Uint8Array(262144);function XC(g){let s=0;if(g.meshes)for(const a of g.meshes)s=Math.max(s,a.aabb.max[2]);if(g.children)for(const a of g.children)s=Math.max(s,XC(a));return s}function KC(g,s,a){if(g.meshes)for(const b of g.meshes){if(b.aabb.min[0]===1/0)continue;const $=en.applyTransform(b.aabb,g.globalMatrix);a.insert(s,$.min[0],$.min[1],$.max[0],$.max[1])}if(g.children)for(const b of g.children)KC(b,s,a)}const YC=["","wall","door","roof","window","lamp","logo"];class QC{constructor(s){this.node=s,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:s.id,geometry:[],properties:{height:XC(s)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let s=0;const a=new en([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const b of this.node.meshes)this.node.lightMeshIndex!==s&&(b.transformedAabb=en.applyTransformFast(b.aabb,this.node.globalMatrix),a.encapsulate(b.transformedAabb)),s++;this.aabb=a}return this.aabb}}class VE{constructor(s,a,b,$,it,st,at,ht){this.id=b,this.layers=s,this.layerIds=this.layers.map(ft=>ft.fqid),this.stateDependentLayerIds=this.layers.filter(ft=>ft.isStateDependent()).map(ft=>ft.id),this.modelTraits|=k_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,$&&(this.modelTraits|=k_.HasMapboxMeshFeatures),it&&(this.modelTraits|=k_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=st,this.worldview=ht,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const ft of a)this.nodesInfo.push(new QC(ft)),KC(ft,at.featureIndexArray.length,at.grid),at.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,at.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(s,a){for(const b of this.getNodesInfo()){const $=b.node;$.footprint&&a.push({footprint:$.footprint,id:s})}}updateAppearances(s,a,b,$){}update(s){const a=Object.keys(s).length!==0;if(a&&!this.stateDependentLayers.length)return;const b=a?this.stateDependentLayers:this.layers;if(!Wl(s,this.states))for(const $ of b)this.evaluate($,s);this.states=structuredClone(s)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(s){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const b of a){const $=b.node;this.uploaded?this.updatePbrBuffer($):nS($,s,!0)}for(const b of a)wE(b.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(s){let a=!1;if(!s.meshes)return a;for(const b of s.meshes)b.pbrBuffer&&(b.pbrBuffer.updateData(b.featureArray),a=!0);return a}needsReEvaluation(s,a,b){const $=s.transform.projectionOptions,it=s.style.getBrightness(),st=this.brightness!==it;if(!this.uploaded||this.dirty||$.name!==this.projection.name||B1(b.paint.get("model-color").value,st)||B1(b.paint.get("model-color-mix-intensity").value,st)||B1(b.paint.get("model-roughness").value,st)||B1(b.paint.get("model-emissive-strength").value,st)||B1(b.paint.get("model-height-based-emissive-strength-multiplier").value,st)){this.projection=$,this.brightness=it;const at=this.getNodesInfo();for(const ht of at)ht.state=null;return!0}return!1}evaluateTransform(s,a){if(s.transform.zoom===this.zoom)return;this.zoom=s.transform.zoom;const b=this.getNodesInfo(),$=this.id.canonical;for(const it of b){const st=it.feature;it.evaluatedTranslation=a.paint.get("model-translation").evaluate(st,{},$),it.evaluatedScale=a.paint.get("model-scale").evaluate(st,{},$)}}evaluate(s,a){const b=this.getNodesInfo();for(const $ of b){if(!$.node.meshes)continue;const it=$.feature,st=a&&a[it.id];if(Wl(st,$.state))continue;$.state=structuredClone(st);const at=$.node.meshes&&$.node.meshes[0].featureData,ht=$.evaluatedColor[2],ft=$.evaluatedRMEA[2],xt=this.id.canonical;if($.hasTranslucentParts=!1,at){for(let Et=0;Et<YC.length;Et++){const Rt=YC[Et];Rt.length&&(it.properties.part=Rt);const Pt=s.paint.get("model-color").evaluate(it,st,xt).toPremultipliedRenderColor(null),Lt=s.paint.get("model-color-mix-intensity").evaluate(it,st,xt);$.evaluatedColor[Et]=[Pt.r,Pt.g,Pt.b,Lt],$.evaluatedRMEA[Et][0]=s.paint.get("model-roughness").evaluate(it,st,xt),$.evaluatedRMEA[Et][2]=s.paint.get("model-emissive-strength").evaluate(it,st,xt),$.evaluatedRMEA[Et][3]=Pt.a,$.emissionHeightBasedParams[Et]=s.paint.get("model-height-based-emissive-strength-multiplier").evaluate(it,st,xt),!$.hasTranslucentParts&&Pt.a<1&&($.hasTranslucentParts=!0)}delete it.properties.part,NM($,ht!==$.evaluatedColor[2]||ft!==$.evaluatedRMEA[2],this.modelTraits)}else $.evaluatedRMEA[0][2]=s.paint.get("model-emissive-strength").evaluate(it,st,xt);$.evaluatedTranslation=s.paint.get("model-translation").evaluate(it,st,xt),$.evaluatedScale=s.paint.get("model-scale").evaluate(it,st,xt),this.updatePbrBuffer($.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(s,a,b,$){const it=s.findDEMTileFor(b);if(it&&(it.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(it.dem&&it.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=it.tileID.overscaledZ;const st=V_.create(s,b,it);if(!st)return;this.modelTraits&k_.HasMapboxMeshFeatures&&this.updateDEM(s,st,b,$);for(const at of this.getNodesInfo()){const ht=at.node;if(!ht.footprint||!ht.footprint.vertices||!ht.footprint.vertices.length)continue;const ft=ht.footprint.vertices;let xt=st.getElevationAt(ft[0].x,ft[0].y,!0,!0);for(let Et=1;Et<ft.length;Et++)xt=Math.min(xt,st.getElevationAt(ft[Et].x,ft[Et].y,!0,!0));ht.elevation=xt}}this.terrainTile=it.tileID.canonical,this.terrainExaggeration=a}}updateDEM(s,a,b,$){let it=a._dem._modifiedForSources[$];if(it===void 0&&(a._dem._modifiedForSources[$]=[],it=a._dem._modifiedForSources[$]),it.includes(b.canonical))return;const st=a._dem.dim;it.push(b.canonical);let at=!1;for(const ht of this.getNodesInfo()){const ft=ht.node;if(!ft.footprint||!ft.footprint.grid)continue;const xt=ft.footprint.grid,Et=a.tileCoordToPixel(xt.min.x,xt.min.y),Rt=a.tileCoordToPixel(xt.max.x,xt.max.y),Pt=Math.min(Math.min(st-Rt.y,Et.x),Math.min(Et.y,st-Rt.x));if(Pt<0)continue;const Lt=Qt(Pt,2,5);let Gt=Math.max(0,Et.x-Lt),Kt=Math.max(0,Et.y-Lt),Xt=Math.min(Rt.x+Lt,st-1),nr=Math.min(Rt.y+Lt,st-1);for(let _r=Kt;_r<=nr;++_r)for(let Rr=Gt;Rr<=Xt;++Rr)Jy[_r*st+Rr]=255;let lr=0,hr=0;for(let _r=0;_r<xt.cellsY;++_r)for(let Rr=0;Rr<xt.cellsX;++Rr){if(!xt.cells[_r*xt.cellsX+Rr])continue;const kr=a.tileCoordToPixel(xt.min.x+Rr/xt.xScale,xt.min.y+_r/xt.yScale),Lr=a.tileCoordToPixel(xt.min.x+(Rr+1)/xt.xScale,xt.min.y+(_r+1)/xt.yScale);for(let is=kr.y;is<=Math.min(Lr.y+1,st-1);++is)for(let Br=kr.x;Br<=Math.min(Lr.x+1,st-1);++Br)Jy[is*st+Br]===255&&(Jy[is*st+Br]=0,lr+=a.getElevationAtPixel(Br,is),hr++)}const Er=lr/hr;Gt=Math.max(1,Et.x-Lt),Kt=Math.max(1,Et.y-Lt),Xt=Math.min(Rt.x+Lt,st-2),nr=Math.min(Rt.y+Lt,st-2),at=!0;for(let _r=Kt;_r<=nr;++_r)for(let Rr=Gt;Rr<=Xt;++Rr)Jy[_r*st+Rr]===0&&(LS[_r*st+Rr]=a._dem.set(Rr,_r,Er));for(let _r=1;_r<Lt;++_r){Gt=Math.max(1,Et.x-_r),Kt=Math.max(1,Et.y-_r),Xt=Math.min(Rt.x+_r,st-2),nr=Math.min(Rt.y+_r,st-2);for(let Rr=Kt;Rr<=nr;++Rr)for(let kr=Gt;kr<=Xt;++kr){const Lr=Rr*st+kr;if(Jy[Lr]===255){let is=0,Br=0,as=-1,ds=-1;for(let fs=-1;fs<=1;++fs)for(let vs=-1;vs<=1;++vs){const ws=(Rr+fs)*st+kr+vs;if(Jy[ws]>=_r)continue;const xs=LS[ws],ys=Math.abs(xs);ys>Br&&(is=xs,Br=ys,as=vs,ds=fs)}if(Br>.1){const fs=1-(_r+.5*Math.abs(as*ds))/Lt;let vs=a._dem.get(kr,Rr)+is*fs;const ws=a._dem.get(kr+as,Rr+ds),xs=a._dem.get(kr-as,Rr-ds,!0);(vs-ws)*(vs-xs)>0&&(vs=(ws+xs)/2),LS[Lr]=a._dem.set(kr,Rr,vs),Jy[Lr]=_r}}}}}at&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=ru.now())}setFilter(s){this.filter=s?r_(s):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(s=>this.filter.filter(new $o(this.id.overscaledZ,{worldview:this.worldview}),s.feature,this.id.canonical)):this.nodesInfo}destroy(){const s=this.getNodesInfo();for(const a of s)wE(a.node),oS(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(s,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const b=a.getReplacementRegionsForTile(s.toUnwrapped());for(const $ of this.getNodesInfo()){const it=$.node.footprint;$.hiddenByReplacement=!!it&&!b.find(st=>st.footprint===it)}}getHeightAtTileCoord(s,a){const b=[],$=[0,0,0],it=Jt([]);for(const st of this.getNodesInfo()){const at=st.node.meshes[0],ht=at.transformedAabb;if(s<ht.min[0]||a<ht.min[1]||s>ht.max[0]||a>ht.max[1])continue;if(st.node.hidden===!0)return{height:1/0,maxHeight:st.feature.properties.height,hidden:!1,verticalScale:st.evaluatedScale[2]};Dt(it,st.node.globalMatrix),$[0]=s,$[1]=a,Os($,$,it);const ft=($[0]-at.aabb.min[0])/(at.aabb.max[0]-at.aabb.min[0])*Ky|0,xt=Math.min(63,($[1]-at.aabb.min[1])/(at.aabb.max[1]-at.aabb.min[1])*Ky|0)*Ky+Math.min(63,ft),Et=at.heightmap[xt];if(!(Et<0&&st.node.footprint))return st.hiddenByReplacement?void 0:{height:Et,maxHeight:st.feature.properties.height,hidden:!1,verticalScale:st.evaluatedScale[2]};if(st.node.footprint.grid.query(new ps(s,a),new ps(s,a),b),b.length>0)return{height:void 0,maxHeight:st.feature.properties.height,hidden:st.hiddenByReplacement,verticalScale:st.evaluatedScale[2]}}}}function B1(g,s){return g instanceof Dx&&!g.isLightConstant&&s}function DM(g,s,a,b,$,it,st,at){let ht=(61440&s|(61440&s)>>4)>>8,ft=(3840&s|(3840&s)>>4)>>4,xt=240&s|(240&s)>>4;a[3]>0&&(ht=pn(ht,255*a[0],a[3]),ft=pn(ft,255*a[1],a[3]),xt=pn(xt,255*a[2],a[3]));const Et=ht<<8|ft,Rt=xt<<8|Math.floor(255*b[3]),Pt=function(_r){const Rr=Qt(_r,0,2);return Math.min(Math.round(.5*Rr*255),255)}(b[2])<<8|15*b[0]<<4|15*b[1],Lt=Qt($[0],0,1),Gt=Qt($[1],0,1),Kt=Qt($[2],0,1),Xt=Qt($[3],0,1);let nr,lr,hr,Er;if(Lt!==Gt&&st!==it&&Gt!==Lt){const _r=st-it;lr=1/(_r*(Gt-Lt)),hr=-(it+_r*Lt)/(_r*(Gt-Lt));const Rr=Qt($[4],-1,1);Er=Math.pow(10,Rr),nr=255*Kt<<8|255*Xt}else nr=65535,lr=0,hr=1,Er=1;if(g.emplaceBack(Et,Rt,Pt,nr,lr,hr,Er),at){const _r=at.length;at.clear();for(let Rr=0;Rr<_r;Rr++)at.emplaceBack(Et,Rt,Pt,nr,lr,hr,Er)}}function NM(g,s,a){const b=g.node;let $=0;const it=a&k_.HasMeshoptCompression;for(const st of b.meshes){if(b.lights&&b.lightMeshIndex===$||!st.featureData)continue;st.featureArray=new f_,st.featureArray.reserve(st.featureData.length);let at=s;for(const ht of st.featureData){const ft=it?65535&ht:ht>>16&65535,xt=it?ht>>16&65535:65535&ht,Et=(15&xt)<8?15&xt:0,Rt=g.evaluatedRMEA[Et],Pt=g.evaluatedColor[Et],Lt=g.emissionHeightBasedParams[Et];let Gt;if(at&&Et===2&&b.lights&&(Gt=new f_,Gt.resize(10*b.lights.length)),DM(st.featureArray,ft,Pt,Rt,Lt,st.aabb.min[2],st.aabb.max[2],Gt),Gt&&at){at=!1;const Kt=b.meshes[b.lightMeshIndex];Kt.featureArray=Gt,Kt.featureArray._trim()}}st.featureArray._trim(),$++}}Xs(VE,"Tiled3dModelBucket",{omit:["layers"]}),Xs(QC,"Tiled3dModelFeature");const zM=["id","tile","layer","source","sourceLayer","state"];class e0{constructor(s,a,b,$,it){this.type="Feature",this._vectorTileFeature=s,this._z=a,this._x=b,this._y=$,this.properties=s?s.properties:{},this.id=it}clone(){const s=new e0(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(s.state=Object.assign({},this.state)),this.layer&&(s.layer=Object.assign({},this.layer)),this.source&&(s.source=this.source),this.sourceLayer&&(s.sourceLayer=this.sourceLayer),s}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(s){this._geometry=s}toJSON(){const s={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of zM)this[a]!==void 0&&(s[a]=this[a]);return s}}class t0 extends Jm{constructor(s,a,b,$){super(),this.id=s,this.type="model",this.models=[],this._loaded=!1,this._options=a,this._modelsInfo=new Map}load(){const s=[];for(const a in this._options.models){const b=this._options.models[a],$=this._modelsInfo.get(a);if($){const it=$.model;it.position=b.position!=null?new _(b.position[0],b.position[1]):new _(0,0),it.orientation=b.orientation!=null?b.orientation:[0,0,0],$.modelSpec=b,t0.applyModelSpecification(it,b),it.computeBoundsAndApplyParent(),this.models.push(it)}else{const it=_R(this.map._requestManager.transformRequest(b.uri,cy.Model).url).then(st=>{if(!st)return;const at=lS(st),ht=new SR(a,b.uri,b.position,b.orientation,at);t0.applyModelSpecification(ht,b),ht.computeBoundsAndApplyParent(),this.models.push(ht),this._modelsInfo.set(a,{modelSpec:b,model:ht})}).catch(st=>{this.fire(new fy(new Error(`Could not load model ${a} from ${b.uri}: ${st.message}`)))});s.push(it)}}Promise.allSettled(s).then(()=>{this._loaded=!0,this.fire(new Dp("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(a=>{this._loaded=!0,this.fire(new fy(new Error(`Could not load models: ${a.message}`)))})}static applyModelSpecification(s,a){a.nodeOverrides&&t0.convertNodeOverrides(s,a.nodeOverrides),a.materialOverrides&&t0.convertMaterialOverrides(s,a.materialOverrides),a.nodeOverrideNames&&(s.nodeOverrideNames=[...a.nodeOverrideNames]),a.materialOverrideNames&&(s.materialOverrideNames=[...a.materialOverrideNames]),a.featureProperties&&(s.featureProperties=a.featureProperties)}static convertNodeOverrides(s,a){if(Array.isArray(a)&&a.every(b=>typeof b=="string")){s.nodeOverrideNames=[];for(const b of a)s.nodeOverrideNames.push(b)}else Object.entries(a).forEach(([b,$])=>{const it={orientation:[0,0,0]};if($.hasOwnProperty("orientation")){const st=$.orientation;st&&(it.orientation=st)}s.nodeOverrides.set(b,it)})}static convertMaterialOverrides(s,a){if(Array.isArray(a)&&a.every(b=>typeof b=="string")){s.materialOverrideNames=[];for(const b of a)s.materialOverrideNames.push(b)}else Object.entries(a).forEach(([b,$])=>{const it={color:new vo(1,1,1),colorMix:0,emissionStrength:0,opacity:1},st=$["model-color"];st!==void 0&&(it.color.r=st[0],it.color.g=st[1],it.color.b=st[2]);const at=$["model-color-mix-intensity"];at!==void 0&&(it.colorMix=at);const ht=$["model-emissive-strength"];ht!==void 0&&(it.emissionStrength=ht);const ft=$["model-opacity"];ft!==void 0&&(it.opacity=ft),s.materialOverrides.set(b,it)})}onAdd(s){this.map=s,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(s,a){}serialize(){return this._options}setProperty(s,a){return!1}reload(){const s=Ap(this.id,this.scope);this.map.style.clearSource(s),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(s){this.models=[];const a=new Map;for(const b in s){const $=s[b];if(this._modelsInfo.has(b)){const it=this._modelsInfo.get(b);it&&it.modelSpec.uri===$.uri&&a.set(b,it)}}this._modelsInfo=a,this._options.models=s,this._loaded=!1,this.load()}}function DS(g,s,a,b){const $=1<<g.z;s.lat=Ut((b/Ps+g.y)/$),s.lng=Ct((a/Ps+g.x)/$)}function OM(g,s,a,b){const $=g.getNodesInfo()[s];if(!$||$.hiddenByReplacement||!$.node.meshes)return;let it=Number.MAX_VALUE;const st=$.node,at=a.tile,ht=b.calculatePosMatrix(at.tileID.toUnwrapped(),b.worldSize),ft=$.evaluatedScale;let xt=0;b.elevation&&st.elevation&&(xt=st.elevation*b.elevation.exaggeration()),Mt(ht,ht,[(st.anchor?st.anchor[0]:0)*(ft[0]-1),(st.anchor?st.anchor[1]:0)*(ft[1]-1),xt]),Ht(ht,ht,ft);const Et=a.queryGeometry,Rt=Et.isPointQuery()?Et.screenBounds:Et.screenGeometry,Pt=function(Gt){const Kt=It([],ht,Gt.globalMatrix);It(Kt,b.expandedFarZProjMatrix,Kt);for(let Xt=0;Xt<Gt.meshes.length;++Xt){const nr=Gt.meshes[Xt];if(Xt===Gt.lightMeshIndex)continue;const lr=sS(Rt,b,Kt,nr.aabb);lr!=null&&(it=Math.min(lr,it))}if(Gt.children)for(const Xt of Gt.children)Pt(Xt)};if(Pt(st),it===Number.MAX_VALUE)return;const Lt=new _(0,0);return DS(at.tileID.canonical,Lt,$.node.anchor[0],$.node.anchor[1]),{intersectionZ:it,position:Lt,feature:$.feature}}const BM={circle:class extends Fu{constructor(g,s,a,b){super(g,{layout:Wu||(Wu=new Sl({"circle-sort-key":new Fs(Gr.layout_circle["circle-sort-key"]),"circle-elevation-reference":new As(Gr.layout_circle["circle-elevation-reference"]),visibility:new As(Gr.layout_circle.visibility)})),paint:Tl||(Tl=new Sl({"circle-radius":new Fs(Gr.paint_circle["circle-radius"]),"circle-color":new Fs(Gr.paint_circle["circle-color"]),"circle-blur":new Fs(Gr.paint_circle["circle-blur"]),"circle-opacity":new Fs(Gr.paint_circle["circle-opacity"]),"circle-translate":new As(Gr.paint_circle["circle-translate"]),"circle-translate-anchor":new As(Gr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new As(Gr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new As(Gr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fs(Gr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fs(Gr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fs(Gr.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new As(Gr.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b)}createBucket(g){return new bo(g)}queryRadius(g){const s=g;return Tu("circle-radius",this,s)+Tu("circle-stroke-width",this,s)+mu(this.paint.get("circle-translate"))}queryIntersectsFeature(g,s,a,b,$,it,st,at){const ht=yp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),it.angle,g.pixelToTileUnitsFactor),ft=this.paint.get("circle-radius").evaluate(s,a)+this.paint.get("circle-stroke-width").evaluate(s,a);return nT(g,b,it,st,at,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",ht,ft)}getProgramIds(){return["circle"]}getDefaultProgramParams(g,s,a){const b=sT(this);return{config:new Bm(this,{zoom:s,lut:a}),defines:b,overrideFog:!1}}is3D(g){return!g&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Fu{createBucket(g){return new aT(g)}constructor(g,s,a,b){super(g,{layout:lT||(lT=new Sl({visibility:new As(Gr.layout_heatmap.visibility)})),paint:cT||(cT=new Sl({"heatmap-radius":new Fs(Gr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fs(Gr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new As(Gr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lx(Gr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new As(Gr.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(g){g==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=l1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(g){return Tu("heatmap-radius",this,g)}queryIntersectsFeature(g,s,a,b,$,it,st,at){const ht=this.paint.get("heatmap-radius").evaluate(s,a);return nT(g,b,it,st,at,!0,!0,new ps(0,0),ht)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(g,s,a){return g==="heatmap"?{config:new Bm(this,{zoom:s,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Fu{constructor(g,s,a,b){super(g,{layout:uT||(uT=new Sl({visibility:new As(Gr.layout_hillshade.visibility)})),paint:hT||(hT=new Sl({"hillshade-illumination-direction":new As(Gr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new As(Gr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new As(Gr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new As(Gr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new As(Gr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new As(Gr.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new As(Gr.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(g,s,a){return{overrideFog:!1}}},fill:class extends Fu{constructor(g,s,a,b){super(g,{layout:RT||(RT=new Sl({"fill-sort-key":new Fs(Gr.layout_fill["fill-sort-key"]),visibility:new As(Gr.layout_fill.visibility),"fill-elevation-reference":new As(Gr.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Fs(Gr.layout_fill["fill-construct-bridge-guard-rail"])})),paint:CT||(CT=new Sl({"fill-antialias":new As(Gr.paint_fill["fill-antialias"]),"fill-opacity":new Fs(Gr.paint_fill["fill-opacity"]),"fill-color":new Fs(Gr.paint_fill["fill-color"]),"fill-outline-color":new Fs(Gr.paint_fill["fill-outline-color"]),"fill-translate":new As(Gr.paint_fill["fill-translate"]),"fill-translate-anchor":new As(Gr.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fs(Gr.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new As(Gr.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new As(Gr.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Fs(Gr.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Fs(Gr.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Fs(Gr.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b)}getProgramIds(){const g=this.paint.get("fill-pattern"),s=g&&g.constantOr(1),a=[s?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(s&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(g,s,a){return{config:new Bm(this,{zoom:s,lut:a}),overrideFog:!1}}recalculate(g,s){super.recalculate(g,s);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(g){return new V2(g)}queryRadius(){return mu(this.paint.get("fill-translate"))}queryIntersectsFeature(g,s,a,b,$,it){return!g.queryGeometry.isAboveHorizon&&po(rp(g.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),it.angle,g.pixelToTileUnitsFactor),b)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(g){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const s=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return g!=null?s&&!g:s}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Fu{constructor(g,s,a,b){super(g,{layout:JT||(JT=new Sl({visibility:new As(Gr["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new As(Gr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:eR||(eR=new Sl({"fill-extrusion-opacity":new As(Gr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new As(Gr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new As(Gr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new As(Gr["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new As(Gr["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new As(Gr["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new As(Gr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new As(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new As(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new As(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new As(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new As(Gr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new As(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new As(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new As(Gr["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new As(Gr["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new As(Gr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new As(Gr["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Fs(Gr["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new As(Gr["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(g){return new dE(g)}queryRadius(){return mu(this.paint.get("fill-extrusion-translate"))}is3D(g){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(g,s,a,b,$,it,st,at,ht){const ft=yp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),it.angle,g.pixelToTileUnitsFactor),xt=this.paint.get("fill-extrusion-height").evaluate(s,a),Et=this.paint.get("fill-extrusion-base").evaluate(s,a),Rt=[0,0],Pt=at&&it.elevation,Lt=it.elevation?it.elevation.exaggeration():1,Gt=g.tile.getBucket(this);if(Pt&&Gt instanceof dE){const hr=Gt.centroidVertexArray,Er=ht+1;Er<hr.length&&(Rt[0]=hr.geta_centroid_pos0(Er),Rt[1]=hr.geta_centroid_pos1(Er))}if(Rt[0]===0&&Rt[1]===1)return!1;it.projection.name==="globe"&&(b=QT([b],[new ps(0,0),new ps(Ps,Ps)],g.tileID.canonical).map(hr=>hr.polygon).flat());const Kt=Pt?at:null,[Xt,nr]=aR(it,b,Et,xt,ft,st,Kt,Rt,Lt,it.center.lat,g.tileID.canonical),lr=g.queryGeometry;return oR(Xt,nr,lr.isPointQuery()?lr.screenBounds:lr.screenGeometry)}},building:class extends Fu{constructor(g,s,a,b){super(g,{layout:IR||(IR=new Sl({visibility:new As(Gr.layout_building.visibility),"building-facade":new Fs(Gr.layout_building["building-facade"]),"building-facade-floors":new Fs(Gr.layout_building["building-facade-floors"]),"building-facade-unit-width":new Fs(Gr.layout_building["building-facade-unit-width"]),"building-facade-window":new Fs(Gr.layout_building["building-facade-window"]),"building-roof-shape":new Fs(Gr.layout_building["building-roof-shape"]),"building-height":new Fs(Gr.layout_building["building-height"]),"building-base":new Fs(Gr.layout_building["building-base"]),"building-flood-light-wall-radius":new Fs(Gr.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Fs(Gr.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Fs(Gr.layout_building["building-flip-roof-orientation"])})),paint:kR||(kR=new Sl({"building-opacity":new As(Gr.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new As(Gr.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new As(Gr.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new As(Gr.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new As(Gr.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new As(Gr.paint_building["building-vertical-scale"]),"building-cast-shadows":new As(Gr.paint_building["building-cast-shadows"]),"building-color":new Fs(Gr.paint_building["building-color"]),"building-emissive-strength":new Fs(Gr.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new As(Gr.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new As(Gr.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new As(Gr.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new As(Gr.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new As(Gr.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(g){return new PR(g)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(g){return!0}queryRadius(g){return 0}queryIntersectsFeature(g,s,a,b,$,it,st,at,ht){let ft=this.layout.get("building-height").evaluate(s,a);const xt=this.layout.get("building-base").evaluate(s,a),Et=g.tile.getBucket(this).getFootprint(s);if(Et){if(Et.hiddenFlags!==0)return!1;ft=Et.height}const[Rt,Pt]=aR(it,b,xt,ft,new ps(0,0),st,null,[0,0],1,it.center.lat,g.tileID.canonical),Lt=g.queryGeometry;return oR(Rt,Pt,Lt.isPointQuery()?Lt.screenBounds:Lt.screenGeometry)}},line:class extends Fu{constructor(g,s,a,b){const $=UR();super(g,$,s,a,b),$.layout&&(this.layout=new ax($.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(g){if(g==="line-gradient"){const s=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=s._styleExpression&&s._styleExpression.expression instanceof Ty,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(g,s){super.recalculate(g,s),this.paint._values["line-floorwidth"]=(()=>{if(T1)return T1;const a=UR();return T1=new LI(a.paint.properties["line-width"].specification),T1.useIntegerZoom=!0,T1})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,g)}createBucket(g){return new hS(g)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(g,s,a){const b=BR(this);return{config:new Bm(this,{zoom:s,lut:a}),defines:b,overrideFog:!1}}queryRadius(g){const s=g,a=$R(Tu("line-width",this,s),Tu("line-gap-width",this,s)),b=Tu("line-offset",this,s);return a/2+Math.abs(b)+mu(this.paint.get("line-translate"))}queryIntersectsFeature(g,s,a,b,$,it){if(g.queryGeometry.isAboveHorizon)return!1;const st=rp(g.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),it.angle,g.pixelToTileUnitsFactor),at=g.pixelToTileUnitsFactor/2*$R(this.paint.get("line-width").evaluate(s,a),this.paint.get("line-gap-width").evaluate(s,a)),ht=this.paint.get("line-offset").evaluate(s,a);return ht&&(b=function(ft,xt){const Et=[],Rt=new ps(0,0);for(let Pt=0;Pt<ft.length;Pt++){const Lt=ft[Pt],Gt=[];for(let Kt=0;Kt<Lt.length;Kt++){const Xt=Lt[Kt],nr=Lt[Kt+1],lr=Kt===0?Rt:Xt.sub(Lt[Kt-1])._unit()._perp(),hr=Kt===Lt.length-1?Rt:nr.sub(Xt)._unit()._perp(),Er=lr._add(hr)._unit();Er._mult(1/(Er.x*hr.x+Er.y*hr.y)),Gt.push(Er._mult(xt)._add(Xt))}Et.push(Gt)}return Et}(b,ht*g.pixelToTileUnitsFactor)),function(ft,xt,Et){for(let Rt=0;Rt<xt.length;Rt++){const Pt=xt[Rt];if(ft.length>=3){for(let Lt=0;Lt<Pt.length;Lt++)if(ko(ft,Pt[Lt]))return!0}if(yl(ft,Pt,Et))return!0}return!1}(st,b,at)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(g){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:NE,background:class extends Fu{constructor(g,s,a,b){super(g,{layout:IC||(IC=new Sl({visibility:new As(Gr.layout_background.visibility)})),paint:kC||(kC=new Sl({"background-pitch-alignment":new As(Gr.paint_background["background-pitch-alignment"]),"background-color":new As(Gr.paint_background["background-color"]),"background-pattern":new As(Gr.paint_background["background-pattern"]),"background-opacity":new As(Gr.paint_background["background-opacity"]),"background-emissive-strength":new As(Gr.paint_background["background-emissive-strength"]),"background-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(g,s,a){return{overrideFog:!1}}is3D(g){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:NC,"raster-particle":$C,sky:class extends Fu{constructor(g,s,a,b){super(g,{layout:BC||(BC=new Sl({visibility:new As(Gr.layout_sky.visibility)})),paint:VC||(VC=new Sl({"sky-type":new As(Gr.paint_sky["sky-type"]),"sky-atmosphere-sun":new As(Gr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new As(Gr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new As(Gr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new As(Gr.paint_sky["sky-gradient-radius"]),"sky-gradient":new lx(Gr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new As(Gr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new As(Gr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new As(Gr.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(g){g==="sky-gradient"?this._updateColorRamp():g!=="sky-atmosphere-sun"&&g!=="sky-atmosphere-halo-color"&&g!=="sky-atmosphere-color"&&g!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=l1({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(g){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const s=g.style.light.properties.get("position");return this._lightPosition.azimuthal!==s.azimuthal||this._lightPosition.polar!==s.polar}return!1}getCenter(g,s){if(this.paint.get("sky-type")==="atmosphere"){const b=this.paint.get("sky-atmosphere-sun"),$=!b,it=g.style.light,st=it.properties.get("position");return $&&it.properties.get("anchor")==="viewport"&&$s("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),$?kS(st.azimuthal,90-st.polar,s):kS(b[0],90-b[1],s)}const a=this.paint.get("sky-gradient-center");return kS(a[0],90-a[1],s)}isSky(){return!0}markSkyboxValid(g){this._skyboxInvalidated=!1,this._lightPosition=g.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const g=this.paint.get("sky-type");return g==="atmosphere"?["skyboxCapture","skybox"]:g==="gradient"?["skyboxGradient"]:null}},slot:class extends Fu{constructor(g,s,a,b){super(g,{paint:UC||(UC=new Sl({}))},s,null)}},model:class extends Fu{constructor(g,s,a,b){super(g,{layout:qC||(qC=new Sl({visibility:new As(Gr.layout_model.visibility),"model-id":new Fs(Gr.layout_model["model-id"])})),paint:ZC||(ZC=new Sl({"model-opacity":new Fs(Gr.paint_model["model-opacity"]),"model-rotation":new Fs(Gr.paint_model["model-rotation"]),"model-scale":new Fs(Gr.paint_model["model-scale"]),"model-translation":new Fs(Gr.paint_model["model-translation"]),"model-color":new Fs(Gr.paint_model["model-color"]),"model-color-mix-intensity":new Fs(Gr.paint_model["model-color-mix-intensity"]),"model-type":new As(Gr.paint_model["model-type"]),"model-cast-shadows":new As(Gr.paint_model["model-cast-shadows"]),"model-receive-shadows":new As(Gr.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new As(Gr.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fs(Gr.paint_model["model-emissive-strength"]),"model-roughness":new Fs(Gr.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fs(Gr.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new As(Gr.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new As(Gr.paint_model["model-front-cutoff"]),"model-elevation-reference":new As(Gr.paint_model["model-elevation-reference"]),"model-color-use-theme":new Fs({type:"string",default:"default","property-type":"data-driven"})}))},s,a,b),this.layer=g,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(g){return new FS(g)}getProgramIds(){return["model"]}is3D(g){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(g){return g instanceof VE?Ps-1:0}queryRenderedFeatures(g,s,a){const b=s.getSource();if(!(b&&b instanceof t0))return{};const $=b,it={};it[this.id]=[];const st=it[this.id];let at=0;for(const ht of $.models){const ft=s.getFeatureState(this.sourceLayer,ht.id),xt={type:"Unknown",id:ht.id,properties:ht.featureProperties},Et=this.paint.get("model-rotation").evaluate(xt,ft),Rt=this.paint.get("model-scale").evaluate(xt,ft),Pt=this.paint.get("model-translation").evaluate(xt,ft),Lt=this.paint.get("model-elevation-reference");let Gt=[];bE(Gt,ht,a,ht.position,Et,Rt,Pt,Lt==="ground",Lt==="ground",!1),a.projection.name==="globe"&&(Gt=vE(Gt,a));const Kt=It([],a.projMatrix,Gt),Xt=sS(g.isPointQuery()?g.screenBounds:g.screenGeometry,a,Kt,ht.aabb);if(Xt!=null){const nr=new e0(void 0,0,0,0,ht.id);nr.layer=this.layer,nr.properties=structuredClone(ht.featureProperties),nr.properties.layer=this.id,nr.properties.uri=ht.uri,nr.properties.orientation=ht.orientation,nr.sourceLayer=this.sourceLayer,nr.geometry={type:"Point",coordinates:[ht.position.lng,ht.position.lat]},nr.state=ft,nr.source=this.source,st.push({featureIndex:at,feature:nr,intersectionZ:Xt})}++at}return it}queryIntersectsFeature(g,s,a,b,$,it){if(!this.modelManager)return!1;const st=this.modelManager,at=g.tile.getBucket(this);if(!(at&&at instanceof FS))return!1;for(const ht in at.instancesPerModel){const ft=at.instancesPerModel[ht],xt=s.id!==void 0?s.id:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0;if(ft.idToFeaturesIndex.hasOwnProperty(xt)){const Et=ft.features[ft.idToFeaturesIndex[xt]],Rt=st.getModel(ht,this.scope);if(!Rt)return!1;let Pt=[];const Lt=new _(0,0),Gt=at.canonical;let Kt=Number.MAX_VALUE;for(let Xt=0;Xt<Et.instancedDataCount;++Xt){const nr=16*(Et.instancedDataOffset+Xt),lr=ft.instancedDataArray.float32,hr=[lr[nr+4],lr[nr+5],lr[nr+6]];DS(Gt,Lt,Math.floor(lr[nr]),Math.floor(lr[nr+1])),bE(Pt,Rt,it,Lt,Et.rotation,Et.scale,hr,!1,!1,!1),it.projection.name==="globe"&&(Pt=vE(Pt,it));const Er=It([],it.projMatrix,Pt),_r=g.queryGeometry,Rr=sS(_r.isPointQuery()?_r.screenBounds:_r.screenGeometry,it,Er,Rt.aabb);Rr!=null&&(Kt=Math.min(Rr,Kt))}return Kt!==Number.MAX_VALUE&&Kt}}return!1}_handleOverridablePaintPropertyUpdate(g,s,a){return!(!this.layout||s.isDataDriven()||a.isDataDriven()||g!=="model-color"&&g!=="model-color-mix-intensity"&&g!=="model-rotation"&&g!=="model-scale"&&g!=="model-translation"&&g!=="model-emissive-strength")}_isPropertyZoomDependent(g){const s=this._transitionablePaint._values[g];return s!=null&&s.value!=null&&s.value.expression!=null&&s.value.expression instanceof sx}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Fu{constructor(g,s,a,b){super(g,{layout:AT||(AT=new Sl({"clip-layer-types":new As(Gr.layout_clip["clip-layer-types"]),"clip-layer-scope":new As(Gr.layout_clip["clip-layer-scope"])})),paint:jT||(jT=new Sl({}))},s,a,b)}recalculate(g,s){super.recalculate(g,s)}createBucket(g){return new PT(g)}is3D(g){return!0}}},NS=new vo(0,0,0),zS={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},OS={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},UE={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},VM={PAINT_ORDER_FILL_AND_STROKE:1},V1={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},JC={MASK_TYPE_LUMINANCE:1};function UM(g,s,a){g===1&&s.icons.push(function(b,$){return function(it){if(it.usvg_tree.height||(it.usvg_tree.height=it.usvg_tree.width),!it.metadata)return it;const{metadata:st}=it;if(st.content_area){const{content_area:at}=st;at.left==null&&(at.left=0),at.top==null&&(at.top=at.left),at.width==null&&(at.width=it.usvg_tree.width),at.height==null&&(at.height=at.width)}if(st.text_placeholder){const{text_placeholder:at}=st;at.top==null&&(at.top=at.left),at.height==null&&(at.height=at.width)}return st.stretch_x&&st.stretch_x.length&&eA(st,"x"),st.stretch_y&&st.stretch_y.length&&eA(st,"y"),it}(b.readFields($M,{name:void 0},$))}(a,a.readVarint()+a.pos))}function eA(g,s){const a=[],b=g[`stretch_${s}`];let $=null;for(let it=0;it<b.length;it++)$===null?$=a.length===0?b[0]:a[a.length-1][1]+b[it]:(a.push([$,$+b[it]]),$=null);g[`stretch_${s}_areas`]=a}function $M(g,s,a){g===1?s.name=a.readString():g===2?s.metadata=function(b,$){return b.readFields(GM,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},$)}(a,a.readVarint()+a.pos):g===3&&(s.usvg_tree=function(b,$){return b.readFields(qM,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},$)}(a,a.readVarint()+a.pos),s.data="usvg_tree")}function GM(g,s,a){g===1?s.stretch_x=a.readPackedVarint():g===2?s.stretch_y=a.readPackedVarint():g===3?s.content_area=tA(a,a.readVarint()+a.pos):g===4?s.variables.push(function(b,$){return b.readFields(WM,{name:void 0},$)}(a,a.readVarint()+a.pos)):g===5&&(s.text_placeholder=tA(a,a.readVarint()+a.pos))}function tA(g,s){return g.readFields(HM,{},s)}function HM(g,s,a){g===1?s.left=a.readVarint():g===2?s.width=a.readVarint():g===3?s.top=a.readVarint():g===4&&(s.height=a.readVarint())}function WM(g,s,a){g===1?s.name=a.readString():g===2&&(s.rgb_color=HE(a.readVarint()),s.value="rgb_color")}function qM(g,s,a){g===1?s.width=s.height=a.readVarint():g===2?s.height=a.readVarint():g===3?s.children.push($E(a,a.readVarint()+a.pos)):g===4?s.linear_gradients.push(function(b,$){return b.readFields(e3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},$)}(a,a.readVarint()+a.pos)):g===5?s.radial_gradients.push(function(b,$){return b.readFields(r3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},$)}(a,a.readVarint()+a.pos)):g===7?s.clip_paths.push(function(b,$){return b.readFields(i3,{children:[]},$)}(a,a.readVarint()+a.pos)):g===8&&s.masks.push(function(b,$){const it=b.readFields(s3,{left:0,width:20,mask_type:JC.MASK_TYPE_LUMINANCE,children:[]},$);return it.height==null&&(it.height=it.width),it.top==null&&(it.top=it.left),it}(a,a.readVarint()+a.pos))}function $E(g,s){return g.readFields(ZM,{},s)}function ZM(g,s,a){g===1?(s.group=function(b,$){return b.readFields(XM,{opacity:255,children:[]},$)}(a,a.readVarint()+a.pos),s.node="group"):g===2&&(s.path=function(b,$){return b.readFields(YM,{paint_order:1,commands:[],step:1,diffs:[],rule:zS.PATH_RULE_NON_ZERO},$)}(a,a.readVarint()+a.pos),s.node="path")}function XM(g,s,a){g===1?s.transform=GE(a,a.readVarint()+a.pos):g===2?s.opacity=a.readVarint():g===5?s.clip_path_idx=a.readVarint():g===6?s.mask_idx=a.readVarint():g===7&&s.children.push($E(a,a.readVarint()+a.pos))}function GE(g,s){return g.readFields(KM,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},s)}function KM(g,s,a){g===1?s.sx=a.readFloat():g===2?s.ky=a.readFloat():g===3?s.kx=a.readFloat():g===4?s.sy=a.readFloat():g===5?s.tx=a.readFloat():g===6&&(s.ty=a.readFloat())}function YM(g,s,a){g===1?s.fill=function(b,$){return b.readFields(QM,{rgb_color:NS,paint:"rgb_color",opacity:255},$)}(a,a.readVarint()+a.pos):g===2?s.stroke=function(b,$){return b.readFields(JM,{rgb_color:NS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},$)}(a,a.readVarint()+a.pos):g===3?s.paint_order=a.readVarint():g===5?a.readPackedVarint(s.commands):g===6?s.step=a.readFloat():g===7?a.readPackedSVarint(s.diffs):g===8&&(s.rule=a.readVarint())}function QM(g,s,a){g===1?(s.rgb_color=HE(a.readVarint()),s.paint="rgb_color"):g===2?(s.linear_gradient_idx=a.readVarint(),s.paint="linear_gradient_idx"):g===3?(s.radial_gradient_idx=a.readVarint(),s.paint="radial_gradient_idx"):g===5&&(s.opacity=a.readVarint())}function HE(g){return new vo((g>>16&255)/255,(g>>8&255)/255,(255&g)/255,1)}function JM(g,s,a){g===1?(s.rgb_color=HE(a.readVarint()),s.paint="rgb_color"):g===2?(s.linear_gradient_idx=a.readVarint(),s.paint="linear_gradient_idx"):g===3?(s.radial_gradient_idx=a.readVarint(),s.paint="radial_gradient_idx"):g===5?a.readPackedFloat(s.dasharray):g===6?s.dashoffset=a.readFloat():g===7?s.miterlimit=a.readFloat():g===8?s.opacity=a.readVarint():g===9?s.width=a.readFloat():g===10?s.linecap=a.readVarint():g===11&&(s.linejoin=a.readVarint())}function e3(g,s,a){g===1?s.transform=GE(a,a.readVarint()+a.pos):g===2?s.spread_method=a.readVarint():g===3?s.stops.push(rA(a,a.readVarint()+a.pos)):g===4?s.x1=a.readFloat():g===5?s.y1=a.readFloat():g===6?s.x2=a.readFloat():g===7&&(s.y2=a.readFloat())}function rA(g,s){return g.readFields(t3,{offset:0,opacity:255,rgb_color:NS},s)}function t3(g,s,a){g===1?s.offset=a.readFloat():g===2?s.opacity=a.readVarint():g===3&&(s.rgb_color=HE(a.readVarint()))}function r3(g,s,a){g===1?s.transform=GE(a,a.readVarint()+a.pos):g===2?s.spread_method=a.readVarint():g===3?s.stops.push(rA(a,a.readVarint()+a.pos)):g===4?s.cx=a.readFloat():g===5?s.cy=a.readFloat():g===6?s.r=a.readFloat():g===7?s.fx=a.readFloat():g===8?s.fy=a.readFloat():g===9&&(s.fr=a.readFloat())}function i3(g,s,a){g===1?s.transform=GE(a,a.readVarint()+a.pos):g===2?s.clip_path_idx=a.readVarint():g===3&&s.children.push($E(a,a.readVarint()+a.pos))}function s3(g,s,a){g===1?s.left=s.top=a.readFloat():g===2?s.width=s.height=a.readFloat():g===3?s.top=a.readFloat():g===4?s.height=a.readFloat():g===5?s.mask_type=a.readVarint():g===6?s.mask_idx=a.readVarint():g===7&&s.children.push($E(a,a.readVarint()+a.pos))}class n3{static calculate(s={},a=[]){const b=new Map,$=new Map;if(Object.keys(s).length===0)return b;a.forEach(it=>{$.set(it.name,it.rgb_color||new vo(0,0,0))});for(const[it,st]of Object.entries(s))$.has(it)?b.set($.get(it).toString(),st):console.warn(`Ignoring unknown image variable "${it}"`);return b}}function U_(g,s=255,a){const b=s/255,$=g.toString(),it=a.has($)?a.get($).clone():g.clone();return it.a*=b,it.toString()}function U1(g,s){if(!Mp()){const a=document.createElement("canvas");return a.width=g,a.height=s,a}return new OffscreenCanvas(g,s)}let BS,$1=null;function VS(g,s,a,b,$){for(const it of b.children)iA(g,s,a,it,$)}function iA(g,s,a,b,$){b.group?(g.save(),function(it,st,at,ht,ft){const xt=ht.mask_idx!=null?at.masks[ht.mask_idx]:null,Et=ht.clip_path_idx!=null?at.clip_paths[ht.clip_path_idx]:null;if(ht.transform&&(st=$_(ht.transform).preMultiplySelf(st)),!function(Lt,Gt,Kt){return Lt.opacity!==255||Gt||Kt}(ht,Et!=null,xt!=null))return void VS(it,st,at,ht,ft);const Rt=U1(it.canvas.width,it.canvas.height),Pt=Rt.getContext("2d");VS(Pt,st,at,ht,ft),Et&&uA(Pt,st,at,Et),xt&&hA(Pt,st,at,xt,ft),it.globalAlpha=ht.opacity/255,it.drawImage(Rt,0,0)}(g,s,a,b.group,$),g.restore()):b.path&&(g.save(),function(it,st,at,ht,ft){it.setTransform(st),ht.paint_order===VM.PAINT_ORDER_FILL_AND_STROKE?(sA(it,at,ht,ft),oA(it,at,ht,ft)):(oA(it,at,ht,ft),sA(it,at,ht,ft))}(g,s,a,b.path,$),g.restore())}function sA(g,s,a,b){const $=a.fill;if(!$)return;const it=$.opacity/255;switch(g.save(),g.beginPath(),dA(a,g),$.paint){case"rgb_color":g.fillStyle=U_($.rgb_color,$.opacity,b);break;case"linear_gradient_idx":{const st=s.linear_gradients[$.linear_gradient_idx];st.transform&&g.setTransform($_(st.transform).preMultiplySelf(g.getTransform())),g.fillStyle=aA(g,st,it,b);break}case"radial_gradient_idx":{const st=s.radial_gradients[$.radial_gradient_idx];st.transform&&g.setTransform($_(st.transform).preMultiplySelf(g.getTransform())),g.fillStyle=lA(g,st,it,b)}}g.fill(nA(a)),g.restore()}function nA(g){return g.rule===zS.PATH_RULE_NON_ZERO?"nonzero":g.rule===zS.PATH_RULE_EVEN_ODD?"evenodd":void 0}function oA(g,s,a,b){const $=a.stroke;if(!$)return;const it=fA(a);g.lineWidth=$.width,g.miterLimit=$.miterlimit,g.setLineDash($.dasharray),g.lineDashOffset=$.dashoffset;const st=$.opacity/255;switch($.paint){case"rgb_color":g.strokeStyle=U_($.rgb_color,$.opacity,b);break;case"linear_gradient_idx":g.strokeStyle=aA(g,s.linear_gradients[$.linear_gradient_idx],st,b,!0);break;case"radial_gradient_idx":g.strokeStyle=lA(g,s.radial_gradients[$.radial_gradient_idx],st,b,!0)}switch($.linejoin){case UE.LINE_JOIN_MITER_CLIP:case UE.LINE_JOIN_MITER:g.lineJoin="miter";break;case UE.LINE_JOIN_ROUND:g.lineJoin="round";break;case UE.LINE_JOIN_BEVEL:g.lineJoin="bevel"}switch($.linecap){case OS.LINE_CAP_BUTT:g.lineCap="butt";break;case OS.LINE_CAP_ROUND:g.lineCap="round";break;case OS.LINE_CAP_SQUARE:g.lineCap="square"}g.stroke(it)}function aA(g,s,a,b,$=!1){if(s.stops.length===1){const Rt=s.stops[0];return U_(Rt.rgb_color,Rt.opacity*a,b)}const{x1:it,y1:st,x2:at,y2:ht}=s;let ft=new DOMPoint(it,st),xt=new DOMPoint(at,ht);if($){const Rt=$_(s.transform);ft=Rt.transformPoint(ft),xt=Rt.transformPoint(xt)}const Et=g.createLinearGradient(ft.x,ft.y,xt.x,xt.y);for(const Rt of s.stops)Et.addColorStop(Rt.offset,U_(Rt.rgb_color,Rt.opacity*a,b));return Et}function lA(g,s,a,b,$=!1){if(s.stops.length===1){const Xt=s.stops[0];return U_(Xt.rgb_color,Xt.opacity*a,b)}const it=$_(s.transform),{fx:st,fy:at,fr:ht,cx:ft,cy:xt,r:Et}=s;let Rt=new DOMPoint(st,at),Pt=new DOMPoint(ft,xt),Lt=ht,Gt=Et;if($){Rt=it.transformPoint(Rt),Pt=it.transformPoint(Pt);const Xt=(it.a+it.d)/2;Lt=ht*Xt,Gt=s.r*Xt}const Kt=g.createRadialGradient(Rt.x,Rt.y,Lt,Pt.x,Pt.y,Gt);for(const Xt of s.stops)Kt.addColorStop(Xt.offset,U_(Xt.rgb_color,Xt.opacity*a,b));return Kt}function cA(g,s,a,b){const $=b.transform?$_(b.transform).preMultiplySelf(s):s,it=U1(g.canvas.width,g.canvas.height),st=it.getContext("2d");for(const ht of b.children)if(ht.group)cA(st,$,a,ht.group);else if(ht.path){const ft=ht.path,xt=new Path2D;xt.addPath(fA(ft),$),st.fill(xt,nA(ft))}const at=b.clip_path_idx!=null?a.clip_paths[b.clip_path_idx]:null;at&&uA(st,$,a,at),g.globalCompositeOperation="source-over",g.drawImage(it,0,0)}function uA(g,s,a,b){const $=U1(g.canvas.width,g.canvas.height);cA($.getContext("2d"),s,a,b),g.globalCompositeOperation="destination-in",g.drawImage($,0,0)}function hA(g,s,a,b,$){if(b.children.length===0)return;const it=b.mask_idx!=null?a.masks[b.mask_idx]:null;it&&hA(g,s,a,it,$);const st=g.canvas.width,at=g.canvas.height,ht=U1(st,at),ft=ht.getContext("2d"),xt=b.width,Et=b.height,Rt=b.left,Pt=b.top,Lt=new Path2D,Gt=new Path2D;Gt.rect(Rt,Pt,xt,Et),Lt.addPath(Gt,s),ft.clip(Lt);for(const nr of b.children)iA(ft,s,a,nr,$);const Kt=ft.getImageData(0,0,st,at),Xt=Kt.data;if(b.mask_type===JC.MASK_TYPE_LUMINANCE)for(let nr=0;nr<Xt.length;nr+=4)Xt[nr+3]=Xt[nr+3]/255*(.2126*Xt[nr]+.7152*Xt[nr+1]+.0722*Xt[nr+2]);ft.putImageData(Kt,0,0),g.globalCompositeOperation="destination-in",g.drawImage(ht,0,0)}function $_(g){return g?new DOMMatrix([g.sx,g.ky,g.kx,g.sy,g.tx,g.ty]):new DOMMatrix}function dA(g,s){const a=g.step;let b=g.diffs[0]*a,$=g.diffs[1]*a;s.moveTo(b,$);for(let it=0,st=2;it<g.commands.length;it++)switch(g.commands[it]){case V1.PATH_COMMAND_MOVE:b+=g.diffs[st++]*a,$+=g.diffs[st++]*a,s.moveTo(b,$);break;case V1.PATH_COMMAND_LINE:b+=g.diffs[st++]*a,$+=g.diffs[st++]*a,s.lineTo(b,$);break;case V1.PATH_COMMAND_QUAD:{const at=b+g.diffs[st++]*a,ht=$+g.diffs[st++]*a;b=at+g.diffs[st++]*a,$=ht+g.diffs[st++]*a,s.quadraticCurveTo(at,ht,b,$);break}case V1.PATH_COMMAND_CUBIC:{const at=b+g.diffs[st++]*a,ht=$+g.diffs[st++]*a,ft=at+g.diffs[st++]*a,xt=ht+g.diffs[st++]*a;b=ft+g.diffs[st++]*a,$=xt+g.diffs[st++]*a,s.bezierCurveTo(at,ht,ft,xt,b,$);break}case V1.PATH_COMMAND_CLOSE:s.closePath()}return s}function fA(g){return dA(g,new Path2D)}class WE{constructor(s){this.capacity=s,this.cache=new Map}get(s){if(!this.cache.has(s))return;const a=this.cache.get(s);return this.cache.delete(s),this.cache.set(s,a),a}put(s,a){this.cache.has(s)?this.cache.delete(s):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(s,a)}delete(s){this.cache.delete(s)}}Xs(WE,"LRUCache");class US{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(s){return new Ru(s,s.data)}getFromCache(s,a,b){return this.cacheMap.has(b)||this.cacheMap.set(b,new WE(150)),this.cacheMap.get(b).get(Ap(s.toString(),a))}setInCache(s,a,b,$){this.cacheDependenciesMap.has($)||this.cacheDependenciesMap.set($,new Map),this.cacheMap.has($)||this.cacheMap.set($,new WE(150));const it=this.cacheDependenciesMap.get($),st=Ap(s.id.toString(),b);it.get(st)||it.set(st,new Set);const at=this.cacheMap.get($),ht=s.toString();it.get(st).add(ht),at.put(Ap(s.toString(),b),a)}removeImagesFromCacheByIds(s,a,b=0){if(!this.cacheMap.has(b)||!this.cacheDependenciesMap.has(b))return;const $=this.cacheMap.get(b),it=this.cacheDependenciesMap.get(b);for(const st of s){const at=Ap(st.toString(),a);if(it.has(at)){for(const ht of it.get(at))$.delete(ht);it.delete(at)}}}rasterize(s,a,b,$){const it=this.getFromCache(s,b,$);if(it)return it.clone();const st=function(ht,ft){const xt=n3.calculate(ft.params,ht.metadata?ht.metadata.variables:[]),Et=ht.usvg_tree,Rt=Et.width,Pt=Et.height,Lt=Math.max(1,Math.round(Rt*ft.sx)),Gt=Math.max(1,Math.round(Pt*ft.sy)),Kt=new DOMMatrix([Lt/Rt,0,0,Gt/Pt,0,0]);return $1===null&&($1=U1(10,10),BS=$1.getContext("2d",{willReadFrequently:!0})),$1.width=Lt,$1.height=Gt,VS(BS,Kt,Et,Et,xt),BS.getImageData(0,0,Lt,Gt)}(a.icon,s),at=US._getImage(st);return this.setInCache(s,at,b,$),at.clone()}}class pA{constructor(s){this.size=s,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(s,a){const b=this.toIdx(s,a);return{min:this.minimums[b],max:this.maximums[b]}}isLeaf(s,a){return this.leaves[this.toIdx(s,a)]}toIdx(s,a){return a*this.size+s}}function mA(g,s,a,b){let $=0,it=Number.MAX_VALUE;for(let st=0;st<3;st++)if(Math.abs(b[st])<1e-15){if(a[st]<g[st]||a[st]>s[st])return null}else{const at=1/b[st];let ht=(g[st]-a[st])*at,ft=(s[st]-a[st])*at;if(ht>ft){const xt=ht;ht=ft,ft=xt}if(ht>$&&($=ht),ft<it&&(it=ft),$>it)return null}return $}function gA(g,s,a,b,$,it,st,at,ht,ft,xt){const Et=b-g,Rt=$-s,Pt=it-a,Lt=st-g,Gt=at-s,Kt=ht-a,Xt=xt[1]*Kt-xt[2]*Gt,nr=xt[2]*Lt-xt[0]*Kt,lr=xt[0]*Gt-xt[1]*Lt,hr=Et*Xt+Rt*nr+Pt*lr;if(Math.abs(hr)<1e-15)return null;const Er=1/hr,_r=ft[0]-g,Rr=ft[1]-s,kr=ft[2]-a,Lr=(_r*Xt+Rr*nr+kr*lr)*Er;if(Lr<0||Lr>1)return null;const is=Rr*Pt-kr*Rt,Br=kr*Et-_r*Pt,as=_r*Rt-Rr*Et,ds=(xt[0]*is+xt[1]*Br+xt[2]*as)*Er;return ds<0||Lr+ds>1?null:(Lt*is+Gt*Br+Kt*as)*Er}function xA(g,s,a){return(g-s)/(a-s)}function yA(g,s,a,b,$,it,st,at,ht){const ft=1<<a,xt=it-b,Et=st-$,Rt=(g+1)/ft*xt+b,Pt=(s+0)/ft*Et+$,Lt=(s+1)/ft*Et+$;at[0]=(g+0)/ft*xt+b,at[1]=Pt,ht[0]=Rt,ht[1]=Lt}class _A{constructor(s){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=s,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(it){const st=Math.ceil(Math.log2(it.dim/8)),at=[];let ht=Math.ceil(Math.pow(2,st));const ft=1/ht,xt=(Pt,Lt,Gt,Kt,Xt)=>{const nr=Kt?1:0,lr=(Pt+1)*Gt-nr,hr=Lt*Gt,Er=(Lt+1)*Gt-nr;Xt[0]=Pt*Gt,Xt[1]=hr,Xt[2]=lr,Xt[3]=Er};let Et=new pA(ht);const Rt=[];for(let Pt=0;Pt<ht*ht;Pt++){xt(Pt%ht,Math.floor(Pt/ht),ft,!1,Rt);const Lt=Jx(Rt[0],Rt[1],it),Gt=Jx(Rt[2],Rt[1],it),Kt=Jx(Rt[2],Rt[3],it),Xt=Jx(Rt[0],Rt[3],it);Et.minimums.push(Math.min(Lt,Gt,Kt,Xt)),Et.maximums.push(Math.max(Lt,Gt,Kt,Xt)),Et.leaves.push(1)}for(at.push(Et),ht/=2;ht>=1;ht/=2){const Pt=at[at.length-1];Et=new pA(ht);for(let Lt=0;Lt<ht*ht;Lt++){xt(Lt%ht,Math.floor(Lt/ht),2,!0,Rt);const Gt=Pt.getElevation(Rt[0],Rt[1]),Kt=Pt.getElevation(Rt[2],Rt[1]),Xt=Pt.getElevation(Rt[2],Rt[3]),nr=Pt.getElevation(Rt[0],Rt[3]),lr=Pt.isLeaf(Rt[0],Rt[1]),hr=Pt.isLeaf(Rt[2],Rt[1]),Er=Pt.isLeaf(Rt[2],Rt[3]),_r=Pt.isLeaf(Rt[0],Rt[3]),Rr=Math.min(Gt.min,Kt.min,Xt.min,nr.min),kr=Math.max(Gt.max,Kt.max,Xt.max,nr.max),Lr=lr&&hr&&Er&&_r;Et.maximums.push(kr),Et.minimums.push(Rr),Et.leaves.push(kr-Rr<=5&&Lr?1:0)}at.push(Et)}return at}(this.dem),b=a.length-1,$=a[b];this._addNode($.minimums[0],$.maximums[0],$.leaves[0]),this._construct(a,0,0,b,0)}raycastRoot(s,a,b,$,it,st,at=1){return mA([s,a,-100],[b,$,this.maximums[0]*at],it,st)}raycast(s,a,b,$,it,st,at=1){if(!this.nodeCount)return null;const ht=this.raycastRoot(s,a,b,$,it,st,at);if(ht==null)return null;const ft=[],xt=[],Et=[],Rt=[],Pt=[{idx:0,t:ht,nodex:0,nodey:0,depth:0}];for(;Pt.length>0;){const{idx:Lt,t:Gt,nodex:Kt,nodey:Xt,depth:nr}=Pt.pop();if(this.leaves[Lt]){yA(Kt,Xt,nr,s,a,b,$,Et,Rt);const hr=1<<nr,Er=(Kt+0)/hr,_r=(Kt+1)/hr,Rr=(Xt+0)/hr,kr=(Xt+1)/hr,Lr=Jx(Er,Rr,this.dem)*at,is=Jx(_r,Rr,this.dem)*at,Br=Jx(_r,kr,this.dem)*at,as=Jx(Er,kr,this.dem)*at,ds=gA(Et[0],Et[1],Lr,Rt[0],Et[1],is,Rt[0],Rt[1],Br,it,st),fs=gA(Rt[0],Rt[1],Br,Et[0],Rt[1],as,Et[0],Et[1],Lr,it,st),vs=Math.min(ds!==null?ds:Number.MAX_VALUE,fs!==null?fs:Number.MAX_VALUE);if(vs!==Number.MAX_VALUE)return vs;{const ws=Wr([],it,st,Gt);if(vA(Lr,is,as,Br,xA(ws[0],Et[0],Rt[0]),xA(ws[1],Et[1],Rt[1]))>=ws[2])return Gt}continue}let lr=0;for(let hr=0;hr<this._siblingOffset.length;hr++){yA((Kt<<1)+this._siblingOffset[hr][0],(Xt<<1)+this._siblingOffset[hr][1],nr+1,s,a,b,$,Et,Rt),Et[2]=-100,Rt[2]=this.maximums[this.childOffsets[Lt]+hr]*at;const Er=mA(Et,Rt,it,st);if(Er!=null){const _r=Er;ft[hr]=_r;let Rr=!1;for(let kr=0;kr<lr&&!Rr;kr++)_r>=ft[xt[kr]]&&(xt.splice(kr,0,hr),Rr=!0);Rr||(xt[lr]=hr),lr++}}for(let hr=0;hr<lr;hr++){const Er=xt[hr];Pt.push({idx:this.childOffsets[Lt]+Er,t:ft[Er],nodex:(Kt<<1)+this._siblingOffset[Er][0],nodey:(Xt<<1)+this._siblingOffset[Er][1],depth:nr+1})}}return null}_addNode(s,a,b){return this.minimums.push(s),this.maximums.push(a),this.leaves.push(b),this.childOffsets.push(0),this.nodeCount++}_construct(s,a,b,$,it){if(s[$].isLeaf(a,b)===1)return;this.childOffsets[it]||(this.childOffsets[it]=this.nodeCount);const st=$-1,at=s[st];let ht=0,ft=0;for(let xt=0;xt<this._siblingOffset.length;xt++){const Et=2*a+this._siblingOffset[xt][0],Rt=2*b+this._siblingOffset[xt][1],Pt=at.getElevation(Et,Rt),Lt=at.isLeaf(Et,Rt),Gt=this._addNode(Pt.min,Pt.max,Lt);Lt&&(ht|=1<<xt),ft||(ft=Gt)}for(let xt=0;xt<this._siblingOffset.length;xt++)ht&1<<xt||this._construct(s,2*a+this._siblingOffset[xt][0],2*b+this._siblingOffset[xt][1],st,ft+xt)}}function vA(g,s,a,b,$,it){return pn(pn(g,a,it),pn(s,b,it),$)}function Jx(g,s,a){const b=a.dim,$=Qt(g*b-.5,0,b-1),it=Qt(s*b-.5,0,b-1),st=Math.floor($),at=Math.floor(it),ht=Math.min(st+1,b-1),ft=Math.min(at+1,b-1);return vA(a.get(st,at),a.get(ht,at),a.get(st,ft),a.get(ht,ft),$-st,it-at)}const o3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function a3(g,s,a){return(256*g*256+256*s+a)/10-1e4}function l3(g,s,a){return 256*g+s+a/256-32768}class qE{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(s,a,b,$=!1){if(this.uid=s,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(b&&b!=="mapbox"&&b!=="terrarium")return void $s(`"${b}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const it=this.dim=a.height-2,st=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=$,this._modifiedForSources={},!$){for(let ht=0;ht<it;ht++)st[this._idx(-1,ht)]=st[this._idx(0,ht)],st[this._idx(it,ht)]=st[this._idx(it-1,ht)],st[this._idx(ht,-1)]=st[this._idx(ht,0)],st[this._idx(ht,it)]=st[this._idx(ht,it-1)];st[this._idx(-1,-1)]=st[this._idx(0,0)],st[this._idx(it,-1)]=st[this._idx(it-1,0)],st[this._idx(-1,it)]=st[this._idx(0,it-1)],st[this._idx(it,it)]=st[this._idx(it-1,it-1)]}const at=b==="terrarium"?l3:a3;for(let ht=0;ht<st.length;++ht){const ft=4*ht;this.floatView[ht]=at(this.pixels[ft],this.pixels[ft+1],this.pixels[ft+2])}this._timestamp=ru.now()}_buildQuadTree(){this._tree=new _A(this)}get(s,a,b=!1){b&&(s=Qt(s,-1,this.dim),a=Qt(a,-1,this.dim));const $=this._idx(s,a);return this.floatView[$]}set(s,a,b){const $=this._idx(s,a),it=this.floatView[$];return this.floatView[$]=b,b-it}static getUnpackVector(s){return o3[s]}_idx(s,a){if(s<-1||s>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(s+1)}static pack(s,a){const b=[0,0,0,0],$=qE.getUnpackVector(a);let it=Math.floor((s+$[3])/$[2]);return b[2]=it%256,it=Math.floor(it/256),b[1]=it%256,it=Math.floor(it/256),b[0]=it,b}getPixels(){return new pT({width:this.stride,height:this.stride},this.pixels)}backfillBorder(s,a,b){if(this.dim!==s.dim)throw new Error("dem dimension mismatch");let $=a*this.dim,it=a*this.dim+this.dim,st=b*this.dim,at=b*this.dim+this.dim;switch(a){case-1:$=it-1;break;case 1:it=$+1}switch(b){case-1:st=at-1;break;case 1:at=st+1}const ht=-a*this.dim,ft=-b*this.dim;for(let xt=st;xt<at;xt++)for(let Et=$;Et<it;Et++){const Rt=4*this._idx(Et,xt),Pt=4*this._idx(Et+ht,xt+ft);this.pixels[Rt+0]=s.pixels[Pt+0],this.pixels[Rt+1]=s.pixels[Pt+1],this.pixels[Rt+2]=s.pixels[Pt+2],this.pixels[Rt+3]=s.pixels[Pt+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function c3(g,s,a){g===1?s.headerLength=a.readFixed32():g===2?s.x=a.readVarint():g===3?s.y=a.readVarint():g===4?s.z=a.readVarint():g===5&&s.layers.push(function(b,$){return b.readFields(p3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},$)}(a,a.readVarint()+a.pos))}function u3(g,s,a){g===1?(s.delta_filter=function(b,$){return b.readFields(h3,{blockSize:0},$)}(a,a.readVarint()+a.pos),s.filter="delta_filter"):g===2?(a.readVarint(),s.filter="zigzag_filter"):g===3?(a.readVarint(),s.filter="bitshuffle_filter"):g===4&&(a.readVarint(),s.filter="byteshuffle_filter")}function h3(g,s,a){g===1&&(s.blockSize=a.readVarint())}function d3(g,s,a){g===1?(a.readVarint(),s.codec="gzip_data"):g===2?(a.readVarint(),s.codec="jpeg_image"):g===3?(a.readVarint(),s.codec="webp_image"):g===4&&(a.readVarint(),s.codec="png_image")}function f3(g,s,a){let b=0,$=0;g===1?s.firstByte=a.readFixed64():g===2?s.lastByte=a.readFixed64():g===3?s.filters.push(function(it,st){return it.readFields(u3,{},st)}(a,a.readVarint()+a.pos)):g===4?s.codec=function(it,st){return it.readFields(d3,{},st)}(a,a.readVarint()+a.pos):g===5?$=a.readFloat():g===6?b=a.readFloat():g===7?s.bands.push(a.readString()):g===8?s.offset=a.readDouble():g===9&&(s.scale=a.readDouble()),s.offset===0&&(s.offset=$),s.scale===0&&(s.scale=b)}function p3(g,s,a){g===1?s.version=a.readVarint():g===2?s.name=a.readString():g===3?s.units=a.readString():g===4?s.tileSize=a.readVarint():g===5?s.buffer=a.readVarint():g===6?s.pixelFormat=a.readVarint():g===7&&s.dataIndex.push(function(b,$){return b.readFields(f3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},$)}(a,a.readVarint()+a.pos))}function m3(g,s,a){if(g===2)(function(b,$,it){b.readFields(g3,it,$)})(a,a.readVarint()+a.pos,s);else if(g===3)throw new Error("Not implemented")}function g3(g,s,a){if(g===1){let b=0;const $=a.readVarint()+a.pos;for(;a.pos<$;)s[b++]=a.readVarint()}}function x3(g,s){if(s.length!==4)throw new Error(`Expected data of dimension 4 but got ${s.length}.`);let a=s[3];for(let b=2;b>=1;b--){const $=b===1?1:0,it=b===2?1:0;for(let st=0;st<s[0];st++){const at=s[1]*st;for(let ht=$;ht<s[1];ht++){const ft=s[2]*(ht+at);for(let xt=it;xt<s[2];xt++){const Et=s[3]*(xt+ft);for(let Rt=0;Rt<s[3];Rt++){const Pt=Et+Rt;g[Pt]+=g[Pt-a]}}}}a*=s[b]}return g}function y3(g){for(let s=0,a=g.length;s<a;s++)g[s]=g[s]>>>1^-(1&g[s]);return g}function _3(g,s){switch(s){case"uint32":return g;case"uint16":for(let a=0;a<g.length;a+=2){const b=g[a],$=g[a+1];g[a]=(240&b)>>4|(61440&b)>>8|(240&$)<<4|61440&$,g[a+1]=15&b|(3840&b)>>4|(15&$)<<8|(3840&$)<<4}return g;case"uint8":for(let a=0;a<g.length;a+=4){const b=g[a],$=g[a+1],it=g[a+2],st=g[a+3];g[a+0]=(192&b)>>6|(192&$)>>4|(192&it)>>2|192&st,g[a+1]=(48&b)>>4|(48&$)>>2|48&it|(48&st)<<2,g[a+2]=(12&b)>>2|12&$|(12&it)<<2|(12&st)<<4,g[a+3]=3&b|(3&$)<<2|(3&it)<<4|(3&st)<<6}return g;default:throw new Error(`Invalid pixel format, "${s}"`)}}Xs(qE,"DEMData"),Xs(_A,"DemMinMaxQuadTree",{omit:["dem"]});var kp=Uint8Array,G1=Uint16Array,v3=Int32Array,bA=new kp([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),wA=new kp([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),b3=new kp([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),EA=function(g,s){for(var a=new G1(31),b=0;b<31;++b)a[b]=s+=1<<g[b-1];var $=new v3(a[30]);for(b=1;b<30;++b)for(var it=a[b];it<a[b+1];++it)$[it]=it-a[b]<<5|b;return{b:a,r:$}},SA=EA(bA,2),TA=SA.b,w3=SA.r;TA[28]=258,w3[258]=28;for(var E3=EA(wA,0).b,RA=new G1(32768),eu=0;eu<32768;++eu){var G_=(43690&eu)>>1|(21845&eu)<<1;RA[eu]=((65280&(G_=(61680&(G_=(52428&G_)>>2|(13107&G_)<<2))>>4|(3855&G_)<<4))>>8|(255&G_)<<8)>>1}var H1=function(g,s,a){for(var b=g.length,$=0,it=new G1(s);$<b;++$)g[$]&&++it[g[$]-1];var st,at=new G1(s);for($=1;$<s;++$)at[$]=at[$-1]+it[$-1]<<1;st=new G1(1<<s);var ht=15-s;for($=0;$<b;++$)if(g[$])for(var ft=$<<4|g[$],xt=s-g[$],Et=at[g[$]-1]++<<xt,Rt=Et|(1<<xt)-1;Et<=Rt;++Et)st[RA[Et]>>ht]=ft;return st},W1=new kp(288);for(eu=0;eu<144;++eu)W1[eu]=8;for(eu=144;eu<256;++eu)W1[eu]=9;for(eu=256;eu<280;++eu)W1[eu]=7;for(eu=280;eu<288;++eu)W1[eu]=8;var CA=new kp(32);for(eu=0;eu<32;++eu)CA[eu]=5;var S3=H1(W1,9),T3=H1(CA,5),$S=function(g){for(var s=g[0],a=1;a<g.length;++a)g[a]>s&&(s=g[a]);return s},xm=function(g,s,a){var b=s/8|0;return(g[b]|g[b+1]<<8)>>(7&s)&a},GS=function(g,s){var a=s/8|0;return(g[a]|g[a+1]<<8|g[a+2]<<16)>>(7&s)},R3=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],ym=function(g,s,a){var b=new Error(s||R3[g]);if(b.code=g,Error.captureStackTrace&&Error.captureStackTrace(b,ym),!a)throw b;return b},C3=new kp(0),A3=typeof TextDecoder<"u"&&new TextDecoder;try{A3.decode(C3,{stream:!0})}catch{}const j3={gzip_data:"gzip"};class qp extends Error{constructor(s){super(s),this.name="MRTError"}}const P3={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},AA={uint32:1,uint16:2,uint8:4},I3={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let HS;class ZE{constructor(s=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=s}getLayer(s){const a=this.layers[s];if(!a)throw new qp(`Layer '${s}' not found`);return a}getHeaderLength(s){const a=new Uint8Array(s),b=new DataView(s);if(a[0]!==13)throw new qp("File is not a valid MRT.");return b.getUint32(1,!0)}parseHeader(s){const a=new Uint8Array(s),b=this.getHeaderLength(s);if(a.length<b)throw new qp(`Expected header with length >= ${b} but got buffer of length ${a.length}`);const $=new HS(a.subarray(0,b)).readFields(c3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==$.x||this.y!==$.y||this.z!==$.z))throw new qp(`Invalid attempt to parse header ${$.z}/${$.x}/${$.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=$.x,this.y=$.y,this.z=$.z;for(const it of $.layers)this.layers[it.name]=new jA(it,{cacheSize:this._cacheSize});return this}createDecodingTask(s){const a=[],b=this.getLayer(s.layerName);for(let $ of s.blockIndices){const it=b.dataIndex[$],st=it.firstByte-s.firstByte,at=it.lastByte-s.firstByte;if(b._blocksInProgress.has($))continue;const ht={layerName:b.name,firstByte:st,lastByte:at,pixelFormat:b.pixelFormat,blockIndex:$,blockShape:[it.bands.length].concat(b.bandShape),buffer:b.buffer,codec:it.codec.codec,filters:it.filters.map(ft=>ft.filter)};b._blocksInProgress.add($),a.push(ht)}return new PA(a,()=>{a.forEach($=>b._blocksInProgress.delete($.blockIndex))},($,it)=>{if(a.forEach(st=>b._blocksInProgress.delete(st.blockIndex)),$)throw $;it.forEach(st=>{this.getLayer(st.layerName).processDecodedData(st)})})}}class jA{constructor({version:s,name:a,units:b,tileSize:$,pixelFormat:it,buffer:st,dataIndex:at},ht){if(this.version=s,this.version!==1)throw new qp(`Cannot parse raster layer encoded with MRT version ${s}`);this.name=a,this.units=b,this.tileSize=$,this.buffer=st,this.pixelFormat=P3[it],this.dataIndex=at,this.bandShape=[$+2*st,$+2*st,AA[this.pixelFormat]],this._decodedBlocks=new WE(ht?ht.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return AA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:s})=>s).flat()}processDecodedData(s){const a=s.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,s.data)}getBlockForBand(s){let a=0;switch(typeof s){case"string":for(const[b,$]of this.dataIndex.entries()){for(const[it,st]of $.bands.entries())if(st===s)return{bandIndex:a+it,blockIndex:b,blockBandIndex:it};a+=$.bands.length}break;case"number":for(const[b,$]of this.dataIndex.entries()){if(s>=a&&s<a+$.bands.length)return{bandIndex:s,blockIndex:b,blockBandIndex:s-a};a+=$.bands.length}break;default:throw new qp(`Invalid band \`${JSON.stringify(s)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(s){let a=1/0,b=-1/0;const $=[],it=new Set;for(const st of s){const{blockIndex:at}=this.getBlockForBand(st);if(at<0)throw new qp(`Invalid band: ${JSON.stringify(st)}`);const ht=this.dataIndex[at];$.includes(at)||$.push(at),it.add(at),a=Math.min(a,ht.firstByte),b=Math.max(b,ht.lastByte)}if(it.size>this.cacheSize)throw new qp(`Number of blocks to decode (${it.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:b,blockIndices:$}}hasBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0}hasDataForBand(s){const{blockIndex:a}=this.getBlockForBand(s);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(s){const{blockIndex:a,blockBandIndex:b}=this.getBlockForBand(s);if(a<0)throw new qp(`Band not found: ${JSON.stringify(s)}`);const $=this._decodedBlocks.get(a.toString());if(!$)throw new qp(`Data for band ${JSON.stringify(s)} of layer "${this.name}" not decoded.`);const it=this.dataIndex[a],st=this.bandShape.reduce((ft,xt)=>ft*xt,1),at=b*st,ht=$.subarray(at,at+st);return{data:ht,bytes:new Uint8Array(ht.buffer).subarray(ht.byteOffset,ht.byteOffset+ht.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:it.offset,scale:it.scale}}}ZE.setPbf=function(g){HS=g};class PA{constructor(s,a,b){this.tasks=s,this._onCancel=a,this._onComplete=b,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(s,a){this._finalized||(this._onComplete(s,a),this._finalized=!0)}}ZE.performDecoding=function(g,s){const a=new Uint8Array(g);return Promise.all(s.tasks.map(b=>{const{layerName:$,firstByte:it,lastByte:st,pixelFormat:at,blockShape:ht,blockIndex:ft,filters:xt,codec:Et}=b,Rt=a.subarray(it,st+1),Pt=new Uint32Array(ht[0]*ht[1]*ht[2]);let Lt;if(Et!=="gzip_data")throw new qp(`Unhandled codec: ${Et}`);return Lt=function(Gt,Kt){if(!globalThis.DecompressionStream&&Kt==="gzip_data")return Promise.resolve(((hr=function(Rr){Rr[0]==31&&Rr[1]==139&&Rr[2]==8||ym(6,"invalid gzip data");var kr=Rr[3],Lr=10;4&kr&&(Lr+=2+(Rr[10]|Rr[11]<<8));for(var is=(kr>>3&1)+(kr>>4&1);is>0;is-=!Rr[Lr++]);return Lr+(2&kr)}(lr=Gt))+8>lr.length&&ym(6,"invalid gzip data"),function(Rr,kr,Lr,is){var Br=Rr.length;if(!Br||kr.f&&!kr.l)return Lr||new kp(0);var as=!Lr,ds=as||kr.i!=2,fs=kr.i;as&&(Lr=new kp(3*Br));var vs,ws,xs=function(Ao){var fo=Lr.length;if(Ao>fo){var xo=new kp(Math.max(2*fo,Ao));xo.set(Lr),Lr=xo}},ys=kr.f||0,os=kr.p||0,ss=kr.b||0,_s=kr.l,Is=kr.d,Rs=kr.m,rn=kr.n,zs=8*Br;do{if(!_s){ys=xm(Rr,os,1);var Hs=xm(Rr,os+1,3);if(os+=3,!Hs){var Ys=Rr[(ls=4+((os+7)/8|0))-4]|Rr[ls-3]<<8,zn=ls+Ys;if(zn>Br){fs&&ym(0);break}ds&&xs(ss+Ys),Lr.set(Rr.subarray(ls,zn),ss),kr.b=ss+=Ys,kr.p=os=8*zn,kr.f=ys;continue}if(Hs==1)_s=S3,Is=T3,Rs=9,rn=5;else if(Hs==2){var Cs=xm(Rr,os,31)+257,Qs=xm(Rr,os+10,15)+4,vn=Cs+xm(Rr,os+5,31)+1;os+=14;for(var Wn=new kp(vn),Xn=new kp(19),Rn=0;Rn<Qs;++Rn)Xn[b3[Rn]]=xm(Rr,os+3*Rn,7);os+=3*Qs;var Co=$S(Xn),vr=(1<<Co)-1,Sr=H1(Xn,Co);for(Rn=0;Rn<vn;){var ls,bs=Sr[xm(Rr,os,vr)];if(os+=15&bs,(ls=bs>>4)<16)Wn[Rn++]=ls;else{var Ls=0,Ds=0;for(ls==16?(Ds=3+xm(Rr,os,3),os+=2,Ls=Wn[Rn-1]):ls==17?(Ds=3+xm(Rr,os,7),os+=3):ls==18&&(Ds=11+xm(Rr,os,127),os+=7);Ds--;)Wn[Rn++]=Ls}}var sn=Wn.subarray(0,Cs),on=Wn.subarray(Cs);Rs=$S(sn),rn=$S(on),_s=H1(sn,Rs),Is=H1(on,rn)}else ym(1);if(os>zs){fs&&ym(0);break}}ds&&xs(ss+131072);for(var Sn=(1<<Rs)-1,Fn=(1<<rn)-1,Dn=os;;Dn=os){var Un=(Ls=_s[GS(Rr,os)&Sn])>>4;if((os+=15&Ls)>zs){fs&&ym(0);break}if(Ls||ym(2),Un<256)Lr[ss++]=Un;else{if(Un==256){Dn=os,_s=null;break}var fn=Un-254;Un>264&&(fn=xm(Rr,os,(1<<(lo=bA[Rn=Un-257]))-1)+TA[Rn],os+=lo);var xn=Is[GS(Rr,os)&Fn],ro=xn>>4;if(xn||ym(3),os+=15&xn,on=E3[ro],ro>3){var lo=wA[ro];on+=GS(Rr,os)&(1<<lo)-1,os+=lo}if(os>zs){fs&&ym(0);break}ds&&xs(ss+131072);var co=ss+fn;if(ss<on){var wo=0-on,Fo=Math.min(on,co);for(wo+ss<0&&ym(3);ss<Fo;++ss)Lr[ss]=(void 0)[wo+ss]}for(;ss<co;++ss)Lr[ss]=Lr[ss-on]}}kr.l=_s,kr.p=Dn,kr.b=ss,kr.f=ys,_s&&(ys=1,kr.m=Rs,kr.d=Is,kr.n=rn)}while(!ys);return ss!=Lr.length&&as?(vs=Lr,((ws=ss)==null||ws>vs.length)&&(ws=vs.length),new kp(vs.subarray(0,ws))):Lr.subarray(0,ss)}(lr.subarray(hr,-8),{i:2},new kp(((Xt=lr)[(nr=Xt.length)-4]|Xt[nr-3]<<8|Xt[nr-2]<<16|Xt[nr-1]<<24)>>>0))));var Xt,nr,lr,hr;const Er=j3[Kt];if(!Er)throw new Error(`Unhandled codec: ${Kt}`);const _r=new globalThis.DecompressionStream(Er);return new Response(new Blob([Gt]).stream().pipeThrough(_r)).arrayBuffer().then(Rr=>new Uint8Array(Rr))}(Rt,Et).then(Gt=>(function(Kt,Xt){Kt.readFields(m3,Xt)}(new HS(Gt),Pt),new I3[at](Pt.buffer))),Lt.then(Gt=>{for(let Kt=xt.length-1;Kt>=0;Kt--)switch(xt[Kt]){case"delta_filter":x3(Gt,ht);break;case"zigzag_filter":y3(Gt);break;case"bitshuffle_filter":_3(Gt,at);break;default:throw new qp(`Unhandled filter "${xt[Kt]}"`)}return{layerName:$,blockIndex:ft,data:Gt}}).catch(Gt=>{throw Gt})}))},Xs(PA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Xs(ZE,"MapboxRasterTile"),Xs(jA,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class IA{constructor(s){this._stringToNumber={},this._numberToString=[];for(let a=0;a<s.length;a++){const b=s[a];this._stringToNumber[b]=a,this._numberToString[a]=b}}encode(s){return this._stringToNumber[s]}decode(s){return this._numberToString[s]}}class kA{constructor(s,a){this.tileID=s,this.x=s.canonical.x,this.y=s.canonical.y,this.z=s.canonical.z,this.grid=new Nx(Ps,16,0),this.featureIndexArray=new t1,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(s,a,b,$,it,st=0,at=0){const ht=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(b,$,it,st);const ft=this.grid;for(let xt=0;xt<a.length;xt++){const Et=a[xt],Rt=[1/0,1/0,-1/0,-1/0];for(let Pt=0;Pt<Et.length;Pt++){const Lt=Et[Pt];Rt[0]=Math.min(Rt[0],Lt.x),Rt[1]=Math.min(Rt[1],Lt.y),Rt[2]=Math.max(Rt[2],Lt.x),Rt[3]=Math.max(Rt[3],Lt.y)}at!==0&&(Rt[0]-=at,Rt[1]-=at,Rt[2]+=at,Rt[3]+=at),Rt[0]<Ps&&Rt[1]<Ps&&Rt[2]>=0&&Rt[3]>=0&&ft.insert(ht,Rt[0],Rt[1],Rt[2],Rt[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Zr(new SE(this.rawTileData)).layers,this.sourceLayerCoder=new IA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const s in this.vtLayers)this.vtFeatures[s]=[]}return this.vtLayers}query(s,a){const{tilespaceGeometry:b,transform:$,tileTransform:it,pixelPosMatrix:st,availableImages:at,worldview:ht}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const ft=a.queryRadius?a.queryRadius:0,xt=b.bufferedTilespaceBounds,Et=this.grid.query(xt.min.x,xt.min.y,xt.max.x,xt.max.y,(Gt,Kt,Xt,nr)=>Lu(b.bufferedTilespaceGeometry,Gt-ft,Kt-ft,Xt+ft,nr+ft));Et.sort(k3);let Rt=null;$.elevation&&Et.length>0&&(Rt=V_.create($.elevation,this.tileID));const Pt={};let Lt;for(let Gt=0;Gt<Et.length;Gt++){const Kt=Et[Gt];if(Kt===Lt)continue;Lt=Kt;const Xt=this.featureIndexArray.get(Kt);let nr=null;this.is3DTile?this.loadMatchingModelFeature(Pt,Xt,s,b,$,ht):this.loadMatchingFeature(Pt,Xt,s,at,ht,(lr,hr,Er,_r=0)=>(nr||(nr=Pr(lr,this.tileID.canonical,it)),hr.queryIntersectsFeature(b,lr,Er,nr,this.z,$,st,Rt,_r)))}return Pt}loadMatchingFeature(s,a,b,$,it,st){const{featureIndex:at,bucketIndex:ht,sourceLayerIndex:ft,layoutVertexArrayOffset:xt}=a,Et=this.bucketLayerIDs[ht],Rt=b.layers,Pt=Object.keys(Rt);if(Pt.length&&!Ws(Pt,Et))return;const Lt=b.sourceCache,Gt=this.sourceLayerCoder.decode(ft),Kt=this.vtLayers[Gt].feature(at),Xt=this.getId(Kt,Gt);for(let nr=0;nr<Et.length;nr++){const lr=Et[nr];if(!Rt[lr])continue;const{styleLayer:hr,targets:Er}=Rt[lr];let _r={};Xt!==void 0&&(_r=Lt.getFeatureState(hr.sourceLayer,Xt));const Rr=!st||st(Kt,hr,_r,xt);if(!Rr)continue;const kr=new e0(Kt,this.z,this.x,this.y,Xt);kr.tile=this.tileID.canonical,kr.state=_r;let Lr=this.serializedLayersCache.get(lr);Lr||(Lr=hr.serialize(),Lr.id=lr,this.serializedLayersCache.set(lr,Lr)),kr.source=Lr.source,kr.sourceLayer=Lr["source-layer"],kr.layer=Object.assign({},Lr),kr.layer.paint=MA(Lr.paint,hr.paint,Kt,_r,$),kr.layer.layout=MA(Lr.layout,hr.layout,Kt,_r,$);let is=!1;for(const Br of Er){this.updateFeatureProperties(kr,Br);const{filter:as}=Br;if(as){if(Kt.properties=kr.properties,as.needGeometry){const ds=Or(Kt,!0);if(!as.filter(new $o(this.tileID.overscaledZ,{worldview:it}),ds,this.tileID.canonical))continue}else if(!as.filter(new $o(this.tileID.overscaledZ,{worldview:it}),Kt))continue}is=!0,Br.targetId&&this.addFeatureVariant(kr,Br)}is&&this.appendToResult(s,lr,at,kr,Rr)}}loadMatchingModelFeature(s,a,b,$,it,st){const{featureIndex:at,bucketIndex:ht}=a,ft=this.bucketLayerIDs[ht],xt=b.layers,Et=Object.keys(xt);if(!Et.length||Ws(Et,ft))for(let Rt=0;Rt<ft.length;Rt++){const Pt=ft[Rt],{styleLayer:Lt,targets:Gt}=xt[Pt];if(Lt.type!=="model")continue;const Kt=$.tile,Xt=Kt.getBucket(Lt);if(!(Xt&&Xt instanceof VE))continue;const nr=OM(Xt,at,$,it);if(!nr)continue;const{z:lr,x:hr,y:Er}=Kt.tileID.canonical,{feature:_r,intersectionZ:Rr,position:kr}=nr;let Lr={};_r.id!==void 0&&(Lr=b.sourceCache.getFeatureState(Lt.sourceLayer,_r.id));const is=new e0({},lr,hr,Er,_r.id);is.tile=this.tileID.canonical,is.state=Lr,is.properties=_r.properties,is.geometry={type:"Point",coordinates:[kr.lng,kr.lat]};let Br=this.serializedLayersCache.get(Pt);Br||(Br=Lt.serialize(),Br.id=Pt,this.serializedLayersCache.set(Pt,Br)),is.source=Br.source,is.sourceLayer=Br["source-layer"],is.layer=Object.assign({},Br);let as=!1;for(const ds of Gt){this.updateFeatureProperties(is,ds);const{filter:fs}=ds;if(fs){if(_r.properties=is.properties,fs.needGeometry){if(!fs.filter(new $o(this.tileID.overscaledZ,{worldview:st}),_r,this.tileID.canonical))continue}else if(!fs.filter(new $o(this.tileID.overscaledZ,{worldview:st}),_r))continue}as=!0,ds.targetId&&this.addFeatureVariant(is,ds)}as&&this.appendToResult(s,Pt,at,is,Rr)}}updateFeatureProperties(s,a,b){if(a.properties){const $={};for(const it in a.properties){const st=a.properties[it].evaluate({zoom:this.z},s._vectorTileFeature,s.state,s.tile,b);st!=null&&($[it]=st)}s.properties=$}}addFeatureVariant(s,a,b){const $={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&($.properties=s.properties),s.variants=s.variants||{},s.variants[a.targetId]=s.variants[a.targetId]||[],s.variants[a.targetId].push($)}appendToResult(s,a,b,$,it){let st=s[a];st===void 0&&(st=s[a]=[]),st.push({featureIndex:b,feature:$,intersectionZ:it})}lookupSymbolFeatures(s,a,b,$,it,st){const at={};this.loadVTLayers();for(const ht of s)this.loadMatchingFeature(at,{bucketIndex:a,sourceLayerIndex:b,featureIndex:ht,layoutVertexArrayOffset:0},$,it,st);return at}loadFeature(s){const{featureIndex:a,sourceLayerIndex:b}=s;this.loadVTLayers();const $=this.sourceLayerCoder.decode(b),it=this.vtFeatures[$];if(it[a])return it[a];const st=this.vtLayers[$].feature(a);return it[a]=st,st}hasLayer(s){for(const a of this.bucketLayerIDs)for(const b of a)if(s===b)return!0;return!1}getId(s,a){let b=s.id;if(this.promoteId){const $=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if($!=null)if(Array.isArray($)){if(!this.promoteIdExpression){const it=Lm($);if(it.result!=="success"){const st=it.value.map(at=>`${at.key}: ${at.message}`).join(", ");return void $s(`Failed to create expression for promoteId: ${st}`)}this.promoteIdExpression=it.value}b=this.promoteIdExpression.evaluate({zoom:0},s)}else b=s.properties[$];typeof b=="boolean"&&(b=Number(b))}return b}}function MA(g,s,a,b,$){return Jr(g,(it,st)=>{const at=s instanceof ax?s.get(st):null;return at&&at.evaluate?at.evaluate(a,b,void 0,$):at})}function k3(g,s){return s-g}Xs(kA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const FA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class WS{static from(s){if(!(s instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,b]=new Uint8Array(s,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const $=b>>4;if($!==1)throw new Error(`Got v${$} data when expected v1.`);const it=FA[15&b];if(!it)throw new Error("Unrecognized array type.");const[st]=new Uint16Array(s,2,1),[at]=new Uint32Array(s,4,1);return new WS(at,st,it,s)}constructor(s,a=64,b=Float64Array,$){if(isNaN(s)||s<0)throw new Error(`Unpexpected numItems value: ${s}.`);this.numItems=+s,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=b,this.IndexArrayType=s<65536?Uint16Array:Uint32Array;const it=FA.indexOf(this.ArrayType),st=2*s*this.ArrayType.BYTES_PER_ELEMENT,at=s*this.IndexArrayType.BYTES_PER_ELEMENT,ht=(8-at%8)%8;if(it<0)throw new Error(`Unexpected typed array class: ${b}.`);$&&$ instanceof ArrayBuffer?(this.data=$,this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+at+ht,2*s),this._pos=2*s,this._finished=!0):(this.data=new ArrayBuffer(8+st+at+ht),this.ids=new this.IndexArrayType(this.data,8,s),this.coords=new this.ArrayType(this.data,8+at+ht,2*s),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+it]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=s)}add(s,a){const b=this._pos>>1;return this.ids[b]=b,this.coords[this._pos++]=s,this.coords[this._pos++]=a,b}finish(){const s=this._pos>>1;if(s!==this.numItems)throw new Error(`Added ${s} items when expected ${this.numItems}.`);return qS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(s,a,b,$){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:it,coords:st,nodeSize:at}=this,ht=[0,it.length-1,0],ft=[];for(;ht.length;){const xt=ht.pop()||0,Et=ht.pop()||0,Rt=ht.pop()||0;if(Et-Rt<=at){for(let Kt=Rt;Kt<=Et;Kt++){const Xt=st[2*Kt],nr=st[2*Kt+1];Xt>=s&&Xt<=b&&nr>=a&&nr<=$&&ft.push(it[Kt])}continue}const Pt=Rt+Et>>1,Lt=st[2*Pt],Gt=st[2*Pt+1];Lt>=s&&Lt<=b&&Gt>=a&&Gt<=$&&ft.push(it[Pt]),(xt===0?s<=Lt:a<=Gt)&&(ht.push(Rt),ht.push(Pt-1),ht.push(1-xt)),(xt===0?b>=Lt:$>=Gt)&&(ht.push(Pt+1),ht.push(Et),ht.push(1-xt))}return ft}within(s,a,b){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:$,coords:it,nodeSize:st}=this,at=[0,$.length-1,0],ht=[],ft=b*b;for(;at.length;){const xt=at.pop()||0,Et=at.pop()||0,Rt=at.pop()||0;if(Et-Rt<=st){for(let Kt=Rt;Kt<=Et;Kt++)DA(it[2*Kt],it[2*Kt+1],s,a)<=ft&&ht.push($[Kt]);continue}const Pt=Rt+Et>>1,Lt=it[2*Pt],Gt=it[2*Pt+1];DA(Lt,Gt,s,a)<=ft&&ht.push($[Pt]),(xt===0?s-b<=Lt:a-b<=Gt)&&(at.push(Rt),at.push(Pt-1),at.push(1-xt)),(xt===0?s+b>=Lt:a+b>=Gt)&&(at.push(Pt+1),at.push(Et),at.push(1-xt))}return ht}}function qS(g,s,a,b,$,it){if($-b<=a)return;const st=b+$>>1;LA(g,s,st,b,$,it),qS(g,s,a,b,st-1,1-it),qS(g,s,a,st+1,$,1-it)}function LA(g,s,a,b,$,it){for(;$>b;){if($-b>600){const ft=$-b+1,xt=a-b+1,Et=Math.log(ft),Rt=.5*Math.exp(2*Et/3),Pt=.5*Math.sqrt(Et*Rt*(ft-Rt)/ft)*(xt-ft/2<0?-1:1);LA(g,s,a,Math.max(b,Math.floor(a-xt*Rt/ft+Pt)),Math.min($,Math.floor(a+(ft-xt)*Rt/ft+Pt)),it)}const st=s[2*a+it];let at=b,ht=$;for(q1(g,s,b,a),s[2*$+it]>st&&q1(g,s,b,$);at<ht;){for(q1(g,s,at,ht),at++,ht--;s[2*at+it]<st;)at++;for(;s[2*ht+it]>st;)ht--}s[2*b+it]===st?q1(g,s,b,ht):(ht++,q1(g,s,ht,$)),ht<=a&&(b=ht+1),a<=ht&&($=ht-1)}}function q1(g,s,a,b){ZS(g,a,b),ZS(s,2*a,2*b),ZS(s,2*a+1,2*b+1)}function ZS(g,s,a){const b=g[s];g[s]=g[a],g[a]=b}function DA(g,s,a,b){const $=g-a,it=s-b;return $*$+it*it}c.$=b0,c.A=Yp,c.B=Ap,c.C=2,c.D=A_,c.E=Jm,c.F=A1,c.G=lC,c.H=v0,c.I=Au,c.J=Bw,c.K=tn,c.L=Sx,c.M=H0,c.N=Py,c.O=Cw,c.P=ps,c.Q=Iy,c.R=cy,c.S=t_,c.T=rS,c.U=Lm,c.V=BE,c.W=Lv,c.X=jx,c.Y=Ax,c.Z=Sy,c._=ku,c.a=function(g){return Gn.API_CDN_URL_REGEX.test(g)},c.a$=Ut,c.a0=gn,c.a1=up,c.a2=Up,c.a3=class extends BE{},c.a4=W0,c.a5=Rw,c.a6=Gr,c.a7=function(g){const s=g.value;return s?gn(s)?MS(s,!0)?[]:[new BE(g.key,s,`invalid url "${s}"`)]:[new BE(g.key,s,`string expected, "${tn(s)}" found`)]:[]},c.a8=Dw,c.a9=Sl,c.aA=Qt,c.aB=It,c.aC=uo,c.aD=Eu,c.aE=ko,c.aF=dt,c.aG=ur,c.aH=function(g,s){const a={};for(let b=0;b<s.length;b++){const $=s[b];$ in g&&(a[$]=g[$])}return a},c.aI=rt,c.aJ=mt,c.aK=class{constructor(g){this.entries={},this.scheduler=g}request(g,s,a,b){const $=this.entries[g]=this.entries[g]||{callbacks:[]};if($.result){const[it,st]=$.result;return this.scheduler?this.scheduler.add(()=>{b(it,st)},s):b(it,st),()=>{}}return $.callbacks.push(b),$.cancel||($.cancel=a((it,st)=>{$.result=[it,st];for(const at of $.callbacks)this.scheduler?this.scheduler.add(()=>{at(it,st)},s):at(it,st);setTimeout(()=>delete this.entries[g],3e3)})),()=>{$.result||($.callbacks=$.callbacks.filter(it=>it!==b),$.callbacks.length||($.cancel(),delete this.entries[g]))}}},c.aL=function(g,s,a){const b=JSON.stringify(g.request);return g.data&&(this.deduped.entries[b]={result:[null,g.data]}),this.deduped.request(b,{type:"parseTile",isSymbolTile:g.isSymbolTile,zoom:g.tileZoom},$=>{const it=Kp(g.request,(st,at,ht)=>{st?$(st):at&&$(null,{rawData:at,vectorTile:a?void 0:new Zr(new SE(at)),responseHeaders:new Map(ht.entries())})});return()=>{it.cancel(),$()}},s)},c.aM=function(g){return g?{cacheControl:g.get("Cache-Control"),expires:g.get("Expires")}:{cacheControl:void 0,expires:void 0}},c.aN=Xu,c.aO=function(g){cp++,cp>u0&&(g.getActor().send("enforceCacheSizeLimit",c0),cp=0)},c.aP=function(g){return g<=1?1:Math.pow(2,Math.floor(Math.log2(g)))},c.aQ=_l,c.aR=NC,c.aS=$C,c.aT=_,c.aU=DC,c.aV=function(g,s){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){s(null,a)};for(let b=0;b<g.length;b++){const $=document.createElement("source");KE(g[b])||(a.crossOrigin="Anonymous"),$.src=g[b],a.appendChild($)}return{cancel:()=>{}}},c.aW=E1,c.aX=t0,c.aY=Vr,c.aZ=k1,c.a_=Ct,c.aa=As,c.ab=class{constructor(g){this.specification=g}possiblyEvaluate(g,s){return Tn(g.expression.evaluate(s))}interpolate(g,s,a){return{x:pn(g.x,s.x,a),y:pn(g.y,s.y,a),z:pn(g.z,s.z,a),azimuthal:pn(g.azimuthal,s.azimuthal,a),polar:pn(g.polar,s.polar,a)}}},c.ac=$o,c.ad=sx,c.ae=cr,c.af=Os,c.ag=Kr,c.ah=or,c.ai=ax,c.aj=Zx,c.ak=pn,c.al=Ps,c.am=sv,c.an=wn,c.ao=vo,c.ap=class{constructor(g){this.specification=g}possiblyEvaluate(g,s){return function([a,b]){const $=Tn([1,a,b]);return{x:$.x,y:$.y,z:$.z}}(g.expression.evaluate(s))}interpolate(g,s,a){return{x:pn(g.x,s.x,a),y:pn(g.y,s.y,a),z:pn(g.z,s.z,a)}}},c.aq=function(g,s,a=0,b=!0){const $=new ps(a,a),it=g.sub($),st=s.add($),at=[it,new ps(st.x,it.y),st,new ps(it.x,st.y)];return b&&at.push(it.clone()),at},c.ar=function(g,s){const a=[];for(let b=0;b<g.length;b++){const $=gr(b-1,-1,g.length-1),it=gr(b+1,-1,g.length-1),st=g[b],at=g[it],ht=g[$].sub(st).unit(),ft=at.sub(st).unit(),xt=ft.angleWithSep(ht.x,ht.y),Et=ht.add(ft).unit().mult(-1*s/Math.sin(xt/2));a.push(st.add(Et))}return a},c.as=bC,c.at=Lu,c.au=function(g,s,a=0){return xr(((s.x-a)*g.scale-g.x)*Ps,(s.y*g.scale-g.y)*Ps,Bt(s.z,s.y))},c.av=Pn,c.aw=Cn,c.ax=Ks,c.ay=DR,c.az=function(g){let s=1/0,a=1/0,b=-1/0,$=-1/0;for(const it of g)s=Math.min(s,it.x),a=Math.min(a,it.y),b=Math.max(b,it.x),$=Math.max($,it.y);return{min:new ps(s,a),max:new ps(b,$)}},c.b=function(g){return Gn.API_FONTS_REGEX.test(g)},c.b$=DT,c.b0=Zl,c.b1=Bx,c.b2=zr,c.b3=Xw,c.b4=DE,c.b5=function(){sm.isLoading()||sm.isLoaded()||Ly()!=="deferred"||Lw()},c.b6=r_,c.b7=Or,c.b8=e0,c.b9=El,c.bA=Jt,c.bB=dr,c.bC=Vt,c.bD=function(g,s){const{x:a,y:b}=g.point,$=tT(a,b,g.worldSize/g._pixelsPerMercatorPixel,0,0);return It($,$,I2(Ip(s)))},c.bE=St,c.bF=cn,c.bG=Vs,c.bH=Wr,c.bI=qr,c.bJ=On,c.bK=D_,c.bL=np,c.bM=vS,c.bN=function(g,s,a,b,$){const it=5*s+2;g.float32[it+0]=a,g.float32[it+1]=b,g.float32[it+2]=$},c.bO=B_,c.bP=Gl,c.bQ=pu,c.bR=ju,c.bS=oo,c.bT=gr,c.bU=function(g,s,a,b){var $=new gt(4);return $[0]=g,$[1]=s,$[2]=a,$[3]=b,$},c.bV=class{isDataAvailableAtPoint(g){const s=this._source();if(this.isUsingMockSource()||!s||g.y<0||g.y>1)return!1;const a=s.getSource().maxzoom,b=1<<a,$=Math.floor(g.x),it=Math.floor((g.x-$)*b),st=Math.floor(g.y*b),at=this.findDEMTileFor(new _l(a,$,a,it,st));return!(!at||!at.dem)}getAtPointOrZero(g,s=0){return this.getAtPoint(g,s)||0}getAtPoint(g,s,a=!0){if(this.isUsingMockSource())return null;s==null&&(s=null);const b=this._source();if(!b||g.y<0||g.y>1)return s;const $=b.getSource().maxzoom,it=1<<$,st=Math.floor(g.x),at=g.x-st,ht=new _l($,st,$,Math.floor(at*it),Math.floor(g.y*it)),ft=this.findDEMTileFor(ht);if(!ft||!ft.dem)return s;const xt=ft.dem,Et=1<<ft.tileID.canonical.z,Rt=(at*Et-ft.tileID.canonical.x)*xt.dim,Pt=(g.y*Et-ft.tileID.canonical.y)*xt.dim,Lt=Math.floor(Rt),Gt=Math.floor(Pt);return(a?this.exaggeration():1)*pn(pn(xt.get(Lt,Gt),xt.get(Lt,Gt+1),Pt-Gt),pn(xt.get(Lt+1,Gt),xt.get(Lt+1,Gt+1),Pt-Gt),Rt-Lt)}static getAtTileOffset(g,s,a,b){const $=1<<g.canonical.z;return b?b.pointElevation(s):a?a.getAtPointOrZero(new cr(g.wrap+(g.canonical.x+s.x/Ps)/$,(g.canonical.y+s.y/Ps)/$)):0}static getAtTileOffsetFunc(g,s,a,b){return($,it,st)=>{const at=this.getAtTileOffset(g,$,it,st),ht=b.upVector(g.canonical,$.x,$.y);return us(ht,ht,at*b.upVectorScale(g.canonical,s,a).metersToTile),ht}}getForTilePoints(g,s,a,b){if(this.isUsingMockSource())return!1;const $=V_.create(this,g,b);return!!$&&(s.forEach(it=>{it[2]=this.exaggeration()*$.getElevationAt(it[0],it[1],a)}),!0)}getMinMaxForTile(g){if(this.isUsingMockSource())return null;const s=this.findDEMTileFor(g);if(!s||!s.dem)return null;const a=s.dem.tree,b=s.tileID,$=1<<g.canonical.z-b.canonical.z;let it=g.canonical.x/$-b.canonical.x,st=g.canonical.y/$-b.canonical.y,at=0;for(let ht=0;ht<g.canonical.z-b.canonical.z&&!a.leaves[at];ht++){it*=2,st*=2;const ft=2*Math.floor(st)+Math.floor(it);at=a.childOffsets[at]+ft,it%=1,st%=1}return{min:this.exaggeration()*a.minimums[at],max:this.exaggeration()*a.maximums[at]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(g,s,a){throw new Error("Pure virtual method called.")}pointCoordinate(g){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(g){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const g=this.visibleDemTiles;if(g.length===0)return null;let s=!1,a=Number.MAX_VALUE,b=Number.MIN_VALUE;for(const $ of g){const it=this.getMinMaxForTile($.tileID);it&&(a=Math.min(a,it.min),b=Math.max(b,it.max),s=!0)}return s?{min:a,max:b}:null}},c.bW=fE,c.bX=no,c.bY=su,c.bZ=kT,c.b_=GC,c.ba=hS,c.bb=V2,c.bc=Pr,c.bd=Nm,c.be=Om,c.bf=Wx,c.bg=ga,c.bh=R_,c.bi=IS,c.bj=function(g,s){const a=Zx(s.zoom);if(a===0)return Ip(g);const b=rE(g),$=P2(b),it=dt(b.getWest())*s.worldSize,st=dt(b.getEast())*s.worldSize,at=mt(b.getNorth())*s.worldSize,ht=mt(b.getSouth())*s.worldSize,ft=[it,at,0],xt=[st,at,0],Et=[it,ht,0],Rt=[st,ht,0],Pt=Dt([],s.globeMatrix);return Os(ft,ft,Pt),Os(xt,xt,Pt),Os(Et,Et,Pt),Os(Rt,Rt,Pt),$[0]=fm($[0],Et,a),$[1]=fm($[1],Rt,a),$[2]=fm($[2],xt,a),$[3]=fm($[3],ft,a),en.fromPoints($)},c.bk=sE,c.bl=Dt,c.bm=a1,c.bn=fm,c.bo=Ox,c.bp=Wy,c.bq=mr,c.br=Mt,c.bs=ZE,c.bt=SE,c.bu=Kp,c.bv=function(g,s){const a=[];for(const b in g)b in s||a.push(b);return a},c.bw=Mr,c.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.by=Wl,c.bz=zt,c.c=xu,c.c$=function(g,s,a){let b=0;for(let $=0;$<2;++$)g[$]>0&&(b+=(g[$]-0)*(g[$]-0)),s[$]<0&&(b+=(0-s[$])*(0-s[$]));return b},c.c0=NT,c.c1=xS,c.c2=mC,c.c3=TS,c.c4=WS,c.c5=us,c.c6=Ho,c.c7=to,c.c8=function(g,s,a){a*=.5;var b=s[0],$=s[1],it=s[2],st=s[3],at=Math.sin(a),ht=Math.cos(a);return g[0]=b*ht+$*at,g[1]=$*ht-b*at,g[2]=it*ht+st*at,g[3]=st*ht-it*at,g},c.c9=Io,c.cA=ms,c.cB=ho,c.cC=bR,c.cD=Mo,c.cE=QS,c.cF=function(g,s,a,b,$,it,st,at,ht){if(ht.name==="globe")return QS(g,s,new Mo(a,b,$),!1);const ft=k1({z:a,x:b,y:$},ht);return new en([(it+ft.x/ft.scale)*s,s*(ft.y/ft.scale),st],[(it+ft.x2/ft.scale)*s,s*(ft.y2/ft.scale),at])},c.cG=function(g,s,a){return g[0]=Math.min(s[0],a[0]),g[1]=Math.min(s[1],a[1]),g[2]=Math.min(s[2],a[2]),g[3]=Math.min(s[3],a[3]),g},c.cH=function(g,s,a){return g[0]=Math.max(s[0],a[0]),g[1]=Math.max(s[1],a[1]),g[2]=Math.max(s[2],a[2]),g[3]=Math.max(s[3],a[3]),g},c.cI=function(g){const s=Math.round((g+45+360)%360/90)%4;return vp[s]},c.cJ=$t,c.cK=Qo,c.cL=T_,c.cM=function(g){const s=Jt(new Float64Array(16));It(s,g.pixelMatrix,g.globeMatrix);const a=[0,gp,0],b=[0,xp,0];return Os(a,a,s),Os(b,b,s),[a[0]>0&&a[0]<=g.width&&a[1]>0&&a[1]<=g.height&&!M2(g,new _(g.center.lat,90)),b[0]>0&&b[0]<=g.width&&b[1]>0&&b[1]<=g.height&&!M2(g,new _(g.center.lat,-90))]},c.cN=function(g,s){const{scale:a}=g.tileTransform,b=a*Ps/(g.tileSize*Math.pow(2,s.zoom-g.tileID.overscaledZ+g.tileID.canonical.z));return function($,it,st){var at=it[1],ht=it[2],ft=it[3],xt=st[0],Et=st[1];return $[0]=it[0]*xt,$[1]=at*xt,$[2]=ht*Et,$[3]=ft*Et,$}(new Float32Array(4),s.inverseAdjustmentMatrix,[b,b])},c.cO=yE,c.cP=es,c.cQ=vR,c.cR=function(g){const s=vR(g,!0);return St([],[s[0],s[1],s[4],s[5]])},c.cS=Ht,c.cT=Ns,c.cU=tr,c.cV=function(g){const{x:s,y:a}=g.point,{lng:b,lat:$}=g._center;return tT(s,a,g.worldSize,b,$)},c.cW=$r,c.cX=Nl,c.cY=_a,c.cZ=yu,c.c_=mp,c.ca=Rl,c.cb=function(g,s){return g[0]=-s[0],g[1]=-s[1],g[2]=-s[2],g[3]=s[3],g},c.cc=Yr,c.cd=function(g,s,a,b,$){var it=1/Math.tan(s/2);if(g[0]=it/a,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=it,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,$!=null&&$!==1/0){var st=1/(b-$);g[10]=($+b)*st,g[14]=2*$*b*st}else g[10]=-1,g[14]=-2*b;return g},c.ce=function(g,s,a,b,$,it,st){var at=1/(s-a),ht=1/(b-$),ft=1/(it-st);return g[0]=-2*at,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*ht,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*ft,g[11]=0,g[12]=(s+a)*at,g[13]=($+b)*ht,g[14]=(st+it)*ft,g[15]=1,g},c.cf=Tt,c.cg=function(g,s,a){g[4*s+0]=a[0],g[4*s+1]=a[1],g[4*s+2]=a[2],g[4*s+3]=a[3]},c.ch=b_,c.ci=By,c.cj=Xl,c.ck=Hp,c.cl=Uy,c.cm=RC,c.cn=function(){var g=new gt(4);return gt!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g},c.co=function(g,s,a){var b=s[0],$=s[1],it=s[2],st=s[3],at=Math.sin(a),ht=Math.cos(a);return g[0]=b*ht+it*at,g[1]=$*ht+st*at,g[2]=b*-at+it*ht,g[3]=$*-at+st*ht,g},c.cp=function(g,s){return g[0]===s[0]&&g[1]===s[1]&&g[2]===s[2]&&g[3]===s[3]},c.cq=Bn,c.cr=function(g){var s=g[0],a=g[1],b=g[2],$=g[3];return Math.sqrt(s*s+a*a+b*b+$*$)},c.cs=zu,c.ct=Nn,c.cu=zl,c.cv=3,c.cw=2,c.cx=7,c.cy=6,c.cz=Zs,c.d=function(g){return Gn.API_TILEJSON_REGEX.test(g)},c.d$=class{constructor(g,s,a,b){this.context=g,this.format=b,this.size=a,this.texture=g.gl.createTexture();const[$,it,st]=this.size,{gl:at}=g;at.bindTexture(at.TEXTURE_3D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in s&&s.data&&at.texImage3D(at.TEXTURE_3D,0,this.format,$,it,st,0,eS(this.format),tS(this.format),s.data)}bind(g,s){const{context:a}=this,{gl:b}=a;b.bindTexture(b.TEXTURE_3D,this.texture),g!==this.minFilter&&(b.texParameteri(b.TEXTURE_3D,b.TEXTURE_MAG_FILTER,g),b.texParameteri(b.TEXTURE_3D,b.TEXTURE_MIN_FILTER,g),this.minFilter=g),s!==this.wrapS&&(b.texParameteri(b.TEXTURE_3D,b.TEXTURE_WRAP_S,s),b.texParameteri(b.TEXTURE_3D,b.TEXTURE_WRAP_T,s),this.wrapS=s)}destroy(){const{gl:g}=this.context;g.deleteTexture(this.texture),this.texture=null}},c.d0=function(g){return g*g*g*g*g},c.d1=ut,c.d2=45,c.d3=w_,c.d4=function(g,s,a){const b=Math.sqrt(g*g+s*s+a*a),$=b>0?Math.acos(a/b)*qo:0;let it=g!==0||s!==0?Math.atan2(-s,-g)*qo+90:0;return it<0&&(it+=360),[b,it,$]},c.d5=xr,c.d6=Tn,c.d7=ir,c.d8=rr,c.d9=en,c.dA=function(g){return g({pluginStatus:Mu,pluginURL:im}),J0.on("pluginStateChange",g),g},c.dB=Vy,c.dC=class extends am{constructor(g){super(g),this.current=E_}set(g,s,a){if(this.fetchUniformLocation(g,s)){for(let b=0;b<9;b++)if(a[b]!==this.current[b]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},c.dD=cu,c.dE=function(g,s,a){const b=Zx(a.zoom),$=g.style.map._antialias,it=g.terrain&&g.terrain.exaggeration()>0;return b===0&&!$&&!it},c.dF=function(g){const s=g.pixelsPerMeter,a=s/Tt(1,g.center.lat),b=Jt(new Float64Array(16));return Mt(b,b,[g.point.x,g.point.y,0]),Ht(b,b,[a,a,s]),Float32Array.from(b)},c.dG=rE,c.dH=function(g){const s=$t-5;g=Qt(g,-s,s)/s*90;const a=Math.pow(Math.abs(Math.sin(wn(g))),3);return Math.round(a*(o1.length-1))},c.dI=function(g,s,a,b){const $=s.getNorth(),it=s.getSouth(),st=s.getWest(),at=s.getEast(),ht=1<<g.z,ft=at-st,xt=$-it,Et=ft/Gx,Rt=-xt/o1[a],Pt=[0,Et,0,Rt,0,0,$,st,0];if(g.z>0){const Lt=180/b;Nt(Pt,Pt,[Lt/ft+1,0,0,0,Lt/xt+1,0,-.5*Lt/Et,.5*Lt/Rt,1])}return Pt[2]=ht,Pt[5]=g.x,Pt[8]=g.y,Pt},c.dJ=Ip,c.dK=function(g,s,a){const b=Jt(new Float64Array(16)),$=(s/(1<<g)-.5)*Math.PI*2;return er(b,a.globeMatrix,$),Float32Array.from(b)},c.dL=pT,c.dM=Wp,c.dN=function(g,s){return[Math.pow(g[0],2.2)*s,Math.pow(g[1],2.2)*s,Math.pow(g[2],2.2)*s]},c.dO=kt,c.dP=function(g,s){var a=Math.sin(s),b=Math.cos(s);return g[0]=b,g[1]=a,g[2]=0,g[3]=-a,g[4]=b,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},c.dQ=Us,c.dR=eT,c.dS=io,c.dT=xl,c.dU=256,c.dV=function(g,s){const a=[0,0,0];return Os(a,a,sE(Ip(s.canonical))),Os(a,a,g),a},c.dW=g=>({u_matrix:new Uy(g),u_texsize:new Hp(g),u_pixels_to_tile_units:new S_(g),u_device_pixel_ratio:new Xl(g),u_width_scale:new Xl(g),u_floor_width_scale:new Xl(g),u_image:new b_(g),u_units_to_pixels:new Hp(g),u_tile_units_to_pixels:new Xl(g),u_alpha_discard_threshold:new Xl(g),u_trim_offset:new Hp(g),u_trim_fade_range:new Hp(g),u_trim_color:new w_(g),u_zbias_factor:new Xl(g),u_tile_to_meter:new Xl(g),u_ground_shadow_factor:new By(g),u_pattern_transition:new Xl(g)}),c.dX=g=>({u_matrix:new Uy(g),u_pixels_to_tile_units:new S_(g),u_device_pixel_ratio:new Xl(g),u_width_scale:new Xl(g),u_floor_width_scale:new Xl(g),u_units_to_pixels:new Hp(g),u_dash_image:new b_(g),u_gradient_image:new b_(g),u_image_height:new Xl(g),u_texsize:new Hp(g),u_tile_units_to_pixels:new Xl(g),u_alpha_discard_threshold:new Xl(g),u_trim_offset:new Hp(g),u_trim_fade_range:new Hp(g),u_trim_color:new w_(g),u_zbias_factor:new Xl(g),u_tile_to_meter:new Xl(g),u_ground_shadow_factor:new By(g)}),c.dY=g=>({u_camera_to_center_distance:new Xl(g),u_extrude_scale:new S_(g),u_device_pixel_ratio:new Xl(g),u_matrix:new Uy(g),u_inv_rot_matrix:new Uy(g),u_merc_center:new Hp(g),u_tile_id:new By(g),u_zoom_transition:new Xl(g),u_up_dir:new By(g),u_emissive_strength:new Xl(g)}),c.dZ=d_,c.d_=GI,c.da=ar,c.db=function(g){return[Math.pow(g[0],1/2.2),Math.pow(g[1],1/2.2),Math.pow(g[2],1/2.2)]},c.dc=_R,c.dd=lS,c.de=SR,c.df=MS,c.dg=function(g,s){return g.readFields(UM,{icons:[]},s)},c.dh=pE,c.di=N_,c.dj=wS,c.dk=f0,c.dl=Fy,c.dm=bx,c.dn=m0,c.dp=hs,c.dq=function(g){const s=g.indexOf(ux);return s>=0?g.slice(0,s):g},c.dr=function(g){return g.indexOf(ux)>=0},c.ds=function(g){const s=g.lastIndexOf(ux);return s>=0?g.slice(s+1):""},c.dt=function(g){const s=[],a=g.id;return a===void 0&&s.push({message:`layers.${a}: missing required property "id"`}),g.render===void 0&&s.push({message:`layers.${a}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&s.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),s},c.du=function(g,s,a,b){return g.type==="custom"?new LM(g,s):new BM[g.type](g,s,a,b)},c.dv=Es,c.dw=function(g){const s=g.indexOf(ux);return s>=0?g.slice(s+1):""},c.dx=class extends e0{constructor(g,s){super(g._vectorTileFeature,g._z,g._x,g._y,g.id),g.state&&(this.state=Object.assign({},g.state)),this.target=s.target,this.namespace=s.namespace,s.properties&&(this.properties=s.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=g.source,this.sourceLayer=g.sourceLayer,this.layer=g.layer)}toJSON(){const g=super.toJSON();return g.target=this.target,g.namespace=this.namespace,g}},c.dy=J0,c.dz=Qm,c.e=Gn,c.e$=jr,c.e0=sT,c.e1=(g,s,a,b,$,it)=>{const st=g.transform,at=st.projection.name==="globe";let ht;if(it.paint.get("circle-pitch-alignment")==="map")if(at){const xt=eT(st.zoom,s.canonical)*st._pixelsPerMercatorPixel;ht=Float32Array.from([xt,0,0,xt])}else ht=st.calculatePixelsToTileUnitsMatrix(a);else ht=new Float32Array([st.pixelsToGLUnits[0],0,0,st.pixelsToGLUnits[1]]);const ft={u_camera_to_center_distance:g.transform.getCameraToCenterDistance(st.projection),u_matrix:g.translatePosMatrix(s.projMatrix,a,it.paint.get("circle-translate"),it.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ru.devicePixelRatio,u_extrude_scale:ht,u_inv_rot_matrix:oP,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:it.paint.get("circle-emissive-strength")};if(at){ft.u_inv_rot_matrix=b,ft.u_merc_center=$,ft.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],ft.u_zoom_transition=Zx(st.zoom);const xt=$[0]*Ps,Et=$[1]*Ps;ft.u_up_dir=st.projection.upVector(new Mo(0,0,0),xt,Et)}return ft},c.e2=BR,c.e3=Iu,c.e4=(g,s,a,b,$,it,st,at,ht,ft)=>{const xt=g.transform,Et=xt.pitch<15?NR(.07,.7,Qt((14-xt.zoom)/5,0,1)):.07,Rt=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:OR(g,s,a,b),u_texsize:s.imageAtlasTexture?s.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:xt.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:$,u_width_scale:it,u_floor_width_scale:st,u_image:0,u_tile_units_to_pixels:zR(s,xt),u_units_to_pixels:[1/xt.pixelsToGLUnits[0],1/xt.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:at,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(Rt?null:a.lut).toArray01(),u_zbias_factor:Et,u_tile_to_meter:ir(s.tileID.canonical,0),u_ground_shadow_factor:ht,u_pattern_transition:ft}},c.e5=(g,s,a,b,$,it,st,at,ht,ft)=>{const xt=g.transform,Et=xt.calculatePixelsToTileUnitsMatrix(s),Rt=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",Pt=xt.pitch<15?NR(.07,.7,Qt((14-xt.zoom)/5,0,1)):.07;return{u_matrix:OR(g,s,a,b),u_pixels_to_tile_units:Et,u_device_pixel_ratio:it,u_width_scale:st,u_floor_width_scale:at,u_units_to_pixels:[1/xt.pixelsToGLUnits[0],1/xt.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:$,u_texsize:VR(a)&&s.lineAtlasTexture?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:zR(s,g.transform),u_alpha_discard_threshold:0,u_trim_offset:ht,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(Rt?null:a.lut).toArray01(),u_zbias_factor:Pt,u_tile_to_meter:ir(s.tileID.canonical,0),u_ground_shadow_factor:ft}},c.e6=_i,c.e7=l1,c.e8=Bt,c.e9=_p,c.eA=function(g,s){var a=2*Math.acos(s[3]),b=Math.sin(a/2);return b>pt?(g[0]=s[0]/b,g[1]=s[1]/b,g[2]=s[2]/b):(g[0]=1,g[1]=0,g[2]=0),a},c.eB=DS,c.eC=bE,c.eD=vE,c.eE=[1,1,1],c.eF=V_,c.eG=Zn,c.eH=function(g,s,a,b){var $=s[0],it=s[1],st=s[2],at=s[3];return g[0]=$+b*(a[0]-$),g[1]=it+b*(a[1]-it),g[2]=st+b*(a[2]-st),g[3]=at+b*(a[3]-at),g},c.eI=k_,c.eJ=tp,c.eK=Gp,c.eL=function(g,s,a,b,$,it,st,at,ht,ft,xt,Et,Rt,Pt,Lt,Gt){var Kt=new gt(16);return Kt[0]=g,Kt[1]=s,Kt[2]=a,Kt[3]=b,Kt[4]=$,Kt[5]=it,Kt[6]=st,Kt[7]=at,Kt[8]=ht,Kt[9]=ft,Kt[10]=xt,Kt[11]=Et,Kt[12]=Rt,Kt[13]=Pt,Kt[14]=Lt,Kt[15]=Gt,Kt},c.eM=et,c.eN=Ux,c.eO=Kv,c.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new ps(1/0,1/0),max:new ps(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(g,s=!1){const a=FT(new ps(0,0),new ps(Ps,Ps),g),b=[];if(s&&!U2(a,this._globalClipBounds))return b;for(const $ of this._activeRegions){if($.hiddenByOverlap||!U2(a,$))continue;const it=LP($.min,$.max,g);b.push({min:it.min,max:it.max,sourceId:this._sourceIds[$.priority],footprint:$.footprint,footprintTileId:$.tileId,order:$.order,clipMask:$.clipMask,clipScope:$.clipScope})}return b}setSources(g){this._setSources(g.map(s=>({getSourceId:()=>s.cache.id,getFootprints:()=>{const a=[];for(const b of s.cache.getVisibleCoordinates()){const $=s.cache.getTile(b).buckets[s.layer];$&&$.updateFootprints(b.toUnwrapped(),a)}return a},getOrder:()=>s.order,getClipMask:()=>s.clipMask,getClipScope:()=>s.clipScope})))}_addSource(g){const s=g.getFootprints();if(s.length===0)return;const a=g.getOrder(),b=g.getClipMask(),$=g.getClipScope();for(const it of s){if(!it.footprint)continue;const st=FT(it.footprint.min,it.footprint.max,it.id);this._activeRegions.push({min:st.min,max:st.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:it.id,footprint:it.footprint,order:a,clipMask:b,clipScope:$})}this._sourceIds.push(g.getSourceId())}_computeReplacement(){this._activeRegions.sort((s,a)=>s.priority-a.priority||cE(s.min,a.min)||cE(s.max,a.max)||s.order-a.order||s.clipMask-a.clipMask||function(b,$){const it=(st,at)=>st+at;return b.length-$.length||b.reduce(it,"").localeCompare($.reduce(it,""))}(s.clipScope,a.clipScope));let g=this._activeRegions.length!==this._prevRegions.length;if(!g){let s=0;for(;!g&&s!==this._activeRegions.length;){const a=this._activeRegions[s],b=this._prevRegions[s];g=a.priority!==b.priority||!MT(a,b)||a.order!==b.order||a.clipMask!==b.clipMask||!Wl(a.clipScope,b.clipScope),this._activeRegions[s].hiddenByOverlap=b.hiddenByOverlap,++s}}if(g){++this._updateTime;for(const a of this._activeRegions)a.order!==p1&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const s=a=>{const b=this._activeRegions;if(a>=b.length)return a;const $=b[a].priority;for(;a<b.length&&b[a].priority===$;)++a;return a};if(this._sourceIds.length>1){let a=0,b=s(a);for(;a!==b;){let $=a;const it=a;for(;$!==b;){const st=this._activeRegions[$];st.hiddenByOverlap=!1;for(let at=0;at<it;at++){const ht=this._activeRegions[at];if(!ht.hiddenByOverlap&&st.order===p1&&U2(st,ht)&&(st.hiddenByOverlap=LT(st.footprint,st.tileId,ht.footprint,ht.tileId),st.hiddenByOverlap))break}++$}a=b,b=s(a)}}}}_setSources(g){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let s=g.length-1;s>=0;s--)this._addSource(g[s]);this._computeReplacement()}},c.eQ=p1,c.eR=class{constructor(g){this._createGrid(g),this._createPoles(g)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const g of this._poleSegments)g.destroy();for(const g of this._gridSegments)g.withSkirts.destroy(),g.withoutSkirts.destroy()}_fillGridMeshWithLods(g,s){const a=new Nm,b=new Zl,$=[],it=g+1+2,st=s[0]+1,at=s[0]+1+(1+s.length),ht=(ft,xt,Et)=>{let Rt=ft===it-1?ft-2:ft===0?ft:ft-1;return Rt+=Et?24575:0,[Rt,xt]};for(let ft=0;ft<it;++ft)a.emplaceBack(...ht(ft,0,!0));for(let ft=0;ft<st;++ft)for(let xt=0;xt<it;++xt)a.emplaceBack(...ht(xt,ft,(xt===0||xt===it-1)&&!0));for(let ft=0;ft<s.length;++ft){const xt=s[ft];for(let Et=0;Et<it;++Et)a.emplaceBack(...ht(Et,xt,!0))}for(let ft=0;ft<s.length;++ft){const xt=b.length,Et=s[ft]+1+2,Rt=new Zl;for(let Gt=0;Gt<Et-1;Gt++){const Kt=Gt===Et-2,Xt=Kt?it*(at-s.length+ft-Gt):it;for(let nr=0;nr<it-1;nr++){const lr=Gt*it+nr;Gt===0||Kt||nr===0||nr===it-2?(Rt.emplaceBack(lr+1,lr,lr+Xt),Rt.emplaceBack(lr+Xt,lr+Xt+1,lr+1)):(b.emplaceBack(lr+1,lr,lr+Xt),b.emplaceBack(lr+Xt,lr+Xt+1,lr+1))}}const Pt=ga.simpleSegment(0,xt,a.length,b.length-xt);for(let Gt=0;Gt<Rt.uint16.length;Gt+=3)b.emplaceBack(Rt.uint16[Gt],Rt.uint16[Gt+1],Rt.uint16[Gt+2]);const Lt=ga.simpleSegment(0,xt,a.length,b.length-xt);$.push({withoutSkirts:Pt,withSkirts:Lt})}return{vertices:a,indices:b,segments:$}}_createGrid(g){const s=this._fillGridMeshWithLods(Gx,o1);this._gridSegments=s.segments,this._gridBuffer=g.createVertexBuffer(s.vertices,Wx.members),this._gridIndexBuffer=g.createIndexBuffer(s.indices,!0)}_createPoles(g){const s=new Zl;for(let st=0;st<=Gx;st++)s.emplaceBack(0,st+1,st+2);this._poleIndexBuffer=g.createIndexBuffer(s,!0);const a=new dx,b=new dx,$=new dx,it=new dx;this._poleSegments=[];for(let st=0,at=0;st<mp;st++){const ht=360/(1<<st);a.emplaceBack(0,-Eu,0,.5,0),b.emplaceBack(0,-Eu,0,.5,1),$.emplaceBack(0,-Eu,0,.5,.5),it.emplaceBack(0,-Eu,0,.5,.5);for(let ft=0;ft<=Gx;ft++){let xt=ft/Gx,Et=0;const Rt=pn(0,ht,xt),[Pt,Lt,Gt]=fx(sP,nP,Rt,Eu);a.emplaceBack(Pt,Lt,Gt,xt,Et),b.emplaceBack(Pt,Lt,Gt,xt,1-Et);const Kt=wn(Rt);xt=.5+.5*Math.sin(Kt),Et=.5+.5*Math.cos(Kt),$.emplaceBack(Pt,Lt,Gt,xt,Et),it.emplaceBack(Pt,Lt,Gt,xt,1-Et)}this._poleSegments.push(ga.simpleSegment(at,0,66,64)),at+=66}this._poleNorthVertexBuffer=g.createVertexBuffer(a,Pp,!1),this._poleSouthVertexBuffer=g.createVertexBuffer(b,Pp,!1),this._texturedPoleNorthVertexBuffer=g.createVertexBuffer($,Pp,!1),this._texturedPoleSouthVertexBuffer=g.createVertexBuffer(it,Pp,!1)}getGridBuffers(g,s){return[this._gridBuffer,this._gridIndexBuffer,s?this._gridSegments[g].withSkirts:this._gridSegments[g].withoutSkirts]}getPoleBuffers(g,s){return[s?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,s?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[g]]}},c.eS=IT,c.eT=bp,c.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},c.eV=Hr,c.eW=sr,c.eX=function(g,s,a){return g[0]=s[0]/a[0],g[1]=s[1]/a[1],g[2]=s[2]/a[2],g},c.eY=Ro,c.eZ=Hx,c.e_=_n,c.ea=dE,c.eb=YT,c.ec=gx,c.ed=VT,c.ee=BT,c.ef=qt,c.eg=function(g,s){if(g===s){var a=s[1],b=s[2],$=s[3],it=s[6],st=s[7],at=s[11];g[1]=s[4],g[2]=s[8],g[3]=s[12],g[4]=a,g[6]=s[9],g[7]=s[13],g[8]=b,g[9]=it,g[11]=s[14],g[12]=$,g[13]=st,g[14]=at}else g[0]=s[0],g[1]=s[4],g[2]=s[8],g[3]=s[12],g[4]=s[1],g[5]=s[5],g[6]=s[9],g[7]=s[13],g[8]=s[2],g[9]=s[6],g[10]=s[10],g[11]=s[14],g[12]=s[3],g[13]=s[7],g[14]=s[11],g[15]=s[15];return g},c.eh=FM,c.ei=Vn,c.ej=Qv,c.ek=256,c.el=I2,c.em=ep,c.en=er,c.eo=function(g,s){return g[0]=s[0],g[1]=s[1],g[2]=s[2],g[3]=s[4],g[4]=s[5],g[5]=s[6],g[6]=s[8],g[7]=s[9],g[8]=s[10],g},c.ep=dx,c.eq=Ew,c.er=Xv,c.es=function(g,s,a,b,$){return Qt((g-s)/(a-s)*($-b)+b,b,$)},c.et=ou,c.eu=function(g,s){var a=s[0],b=s[1],$=s[2],it=s[3],st=s[4],at=s[5],ht=s[6],ft=s[7],xt=s[8],Et=xt*st-at*ft,Rt=-xt*it+at*ht,Pt=ft*it-st*ht,Lt=a*Et+b*Rt+$*Pt;return Lt?(g[0]=Et*(Lt=1/Lt),g[1]=(-xt*b+$*ft)*Lt,g[2]=(at*b-$*st)*Lt,g[3]=Rt*Lt,g[4]=(xt*a-$*ht)*Lt,g[5]=(-at*a+$*it)*Lt,g[6]=Pt*Lt,g[7]=(-ft*a+b*ht)*Lt,g[8]=(st*a-b*it)*Lt,g):null},c.ev=2,c.ew=zo,c.ex=eo,c.ey=Dr,c.ez=function(g,s){var a=new gt(3);Dr(a,s);var b=1/a[0],$=1/a[1],it=1/a[2],st=s[0]*b,at=s[1]*$,ht=s[2]*it,ft=s[4]*b,xt=s[5]*$,Et=s[6]*it,Rt=s[8]*b,Pt=s[9]*$,Lt=s[10]*it,Gt=st+xt+Lt,Kt=0;return Gt>0?(Kt=2*Math.sqrt(Gt+1),g[3]=.25*Kt,g[0]=(Et-Pt)/Kt,g[1]=(Rt-ht)/Kt,g[2]=(at-ft)/Kt):st>xt&&st>Lt?(Kt=2*Math.sqrt(1+st-xt-Lt),g[3]=(Et-Pt)/Kt,g[0]=.25*Kt,g[1]=(at+ft)/Kt,g[2]=(Rt+ht)/Kt):xt>Lt?(Kt=2*Math.sqrt(1+xt-st-Lt),g[3]=(Rt-ht)/Kt,g[0]=(at+ft)/Kt,g[1]=.25*Kt,g[2]=(Et+Pt)/Kt):(Kt=2*Math.sqrt(1+Lt-st-xt),g[3]=(at-ft)/Kt,g[0]=(Rt+ht)/Kt,g[1]=(Et+Pt)/Kt,g[2]=.25*Kt),g},c.f=function(g){return btoa(encodeURIComponent(g).replace(/%([0-9A-F]{2})/g,(s,a)=>String.fromCharCode(+("0x"+a))))},c.f0=function([g,s,a]){const b=Math.hypot(g,s,a),$=Math.atan2(g,a),it=.5*Math.PI-Math.acos(-s/b);return new _(Nl($),Nl(it))},c.f1=Wo,c.f2=iS,c.f3=function(g){const s=g.navigator?g.navigator.userAgent:null;return!!function(a){if(Bl==null){const b=a.navigator?a.navigator.userAgent:null;Bl=!!a.safari||!(!b||!(/\b(iPad|iPhone|iPod)\b/.test(b)||b.match("Safari")&&!b.match("Chrome")))}return Bl}(g)&&!(!s||!(s.match("Version/15.4")||s.match("Version/15.5")||s.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},c.f4=function(g,s){c0=g,u0=s},c.f5=M2,c.f6=rT,c.f7=function(g){const s=[0,0,0],a=Jt(new Float64Array(16));return It(a,g.pixelMatrix,g.globeMatrix),Os(s,s,a),new ps(s[0],s[1])},c.f8=function(){const g=v1;g&&(g.isPreloaded()&&g.numActive()===1?(g.release(Z2),v1=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},c.f9=function(){pE().acquire(Z2)},c.fA=qE,c.fB=Nr,c.fC=function(g){let s=0;if(new Uint32Array(g,0,1)[0]!==pR){const a=new Uint32Array(g,0,7),[,,b,$,it,st]=a;s=a.byteLength+$+it+st+it,(b!==g.byteLength||s>=g.byteLength)&&$s("Invalid b3dm header information.")}return yR(g,s)},c.fD=function(g,s){const a=lS(g);for(const b of a){for(const $ of b.meshes)dI($);b.lights&&(b.lightMeshIndex=b.meshes.length,b.meshes.push(fI(b.lights,s)))}return a},c.fE=VE,c.fF=Yn,c.fG=cR,c.fH=sm,c.fI=Ku,c.fJ=function(g){Ep(),Fp!=null&&Fp.then(s=>{s.keys().then(a=>{for(let b=0;b<a.length-g;b++)s.delete(a[b]).catch($=>$s($.message))}).catch(a=>$s(a.message))}).catch(s=>$s(s.message))},c.fa=Ly,c.fb=function(g,s,a=!1){if(Mu===Ku.deferred||Mu===Ku.loading||Mu===Ku.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");im=ru.resolveURL(g),Mu=Ku.deferred,Ov=s,Q0(),a||Lw()},c.fc=function(g){j_=ru.resolveURL(g),P_||(P_=new A_(pE(),new Jm)),P_.broadcast("setMeshoptUrl",j_)},c.fd=dR,c.fe=function(g){Y2=ru.resolveURL(g),P_||(P_=new A_(pE(),new Jm)),P_.broadcast("setDracoUrl",Y2)},c.ff=hR,c.fg=_1,c.fh=function(g){const s=wp();if(!s)return;const a=s.delete(l0);g&&a.then(()=>g()).catch(g)},c.fi=Xy,c.fj=Xs,c.fk=Xx,c.fl=gm,c.fm=IA,c.fn=kA,c.fo=MR,c.fp=ns,c.fq="hd_road_elevation",c.fr=mo,c.fs=Jr,c.ft=mx,c.fu=bS,c.fv=Qy,c.fw=function(g,s,a,b,$,it,st,at=1,ht,ft,xt){g.createArrays(),g.tilePixelRatio=Ps/(512*g.overscaling),g.compareText={},g.iconsNeedLinear=!1;const Et=g.layers[0].layout,Rt=g.layers[0]._unevaluatedLayout._values,Pt={};Pt.scaleFactor=at,Pt.textSizeScaleRange=Et.get("text-size-scale-range"),Pt.iconSizeScaleRange=Et.get("icon-size-scale-range");const[Lt,Gt]=Pt.textSizeScaleRange,[Kt,Xt]=Pt.iconSizeScaleRange;Pt.textScaleFactor=Qt(Pt.scaleFactor,Lt,Gt),Pt.iconScaleFactor=Qt(Pt.scaleFactor,Kt,Xt);const nr=Rt["text-size"],lr=Rt["icon-size"];if(g.textSizeData.kind==="composite"){const{minZoom:Lr,maxZoom:is}=g.textSizeData;Pt.compositeTextSizes=[nr.possiblyEvaluate(new $o(Lr,{worldview:xt}),it),nr.possiblyEvaluate(new $o(is,{worldview:xt}),it)]}if(g.iconSizeData.kind==="composite"){const{minZoom:Lr,maxZoom:is}=g.iconSizeData;Pt.compositeIconSizes=[lr.possiblyEvaluate(new $o(Lr,{worldview:xt}),it),lr.possiblyEvaluate(new $o(is,{worldview:xt}),it)]}Pt.layoutTextSize=nr.possiblyEvaluate(new $o(st+1,{worldview:xt}),it),Pt.layoutIconSize=lr.possiblyEvaluate(new $o(st+1,{worldview:xt}),it),Pt.textMaxSize=nr.possiblyEvaluate(new $o(18,{worldview:xt}),it);const hr=Et.get("symbol-placement"),Er=Et.get("text-rotation-alignment")==="map"&&hr!=="point",_r=Et.get("text-size");let Rr=!1;const kr=[];for(const Lr of g.features){const is=Et.get("text-font").evaluate(Lr,{},it).join(","),Br=_r.evaluate(Lr,{},it)*Pt.textScaleFactor,as=Pt.layoutTextSize.evaluate(Lr,{},it)*Pt.textScaleFactor,ds=Pt.layoutIconSize.evaluate(Lr,{},it)*Pt.iconScaleFactor,fs={horizontal:{},vertical:void 0},vs=Lr.text;let ws,xs=[0,0];if(vs){const Rn=vs.toString(),Co=Et.get("text-letter-spacing").evaluate(Lr,{},it)*su,vr=Et.get("text-line-height").evaluate(Lr,{},it)*su,Sr=Nv(Rn)?Co:0,ls=Et.get("text-anchor").evaluate(Lr,{},it),bs=Et.get("text-variable-anchor");if(!bs){const Sn=Et.get("text-radial-offset").evaluate(Lr,{},it);if(Sn)xs=mC(ls,[Sn*su,SS]);else{const Fn=Et.get("text-offset").evaluate(Lr,{},it);xs=[Fn[0]*su,Fn[1]*su]}}let Ls=Er?"center":Et.get("text-justify").evaluate(Lr,{},it);const Ds=hr==="point",sn=Ds?Et.get("text-max-width").evaluate(Lr,{},it)*su:1/0,on=Sn=>{g.allowVerticalPlacement&&My(Rn)&&(fs.vertical=gS(vs,s,a,$,is,sn,vr,ls,Sn,Sr,xs,np.vertical,!0,as,Br,ht))};if(!Er&&bs){const Sn=Ls==="auto"?bs.map(Dn=>TS(Dn)):[Ls];let Fn=!1;for(let Dn=0;Dn<Sn.length;Dn++){const Un=Sn[Dn];if(!fs.horizontal[Un])if(Fn)fs.horizontal[Un]=fs.horizontal[0];else{const fn=gS(vs,s,a,$,is,sn,vr,"center",Un,Sr,xs,np.horizontal,!1,as,Br,ht);fn&&(fs.horizontal[Un]=fn,Fn=fn.positionedLines.length===1)}}on("left")}else{if(Ls==="auto"&&(Ls=TS(ls)),Ds||Et.get("text-writing-mode").indexOf("horizontal")>=0||!My(Rn)){const Sn=gS(vs,s,a,$,is,sn,vr,ls,Ls,Sr,xs,np.horizontal,!1,as,Br,ht);Sn&&(fs.horizontal[Ls]=Sn)}on(Ds?"left":Ls)}}let ys,os,ss,_s,Is,Rs,rn=!1;const zs=Et.get("icon-text-fit").evaluate(Lr,{},it);if(Lr.icon&&Lr.icon.hasPrimary()){const Rn=P1(Lr.icon,g.iconSizeData,Rt["icon-size"],it,g.zoom,Lr,ht,Pt.iconScaleFactor,xt);ys=Rn.iconPrimary,ss=Rn.iconSecondary;const Co=ys.toString();if(os=b.get(Co),os&&(Is=Et.get("icon-offset").evaluate(Lr,{},it),Rs=Et.get("icon-anchor").evaluate(Lr,{},it),ws=RE($.get(Co),ss?$.get(ss.toString()):void 0,Is,Rs),rn=os.sdf,g.sdfIcons===void 0?g.sdfIcons=os.sdf:g.sdfIcons!==os.sdf&&$s("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(os.pixelRatio!==g.pixelRatio||Et.get("icon-rotate").constantOr(1)!==0)&&(g.iconsNeedLinear=!0)),ss){const vr=ss.toString();_s=b.get(vr)}}Rr=Rr||!(!Lr.icon||!Lr.icon.hasSecondary());const Hs=IE(fs.horizontal)||fs.vertical;g.iconsInText||(g.iconsInText=!!Hs&&Hs.iconsInText);const Ys=as*Pt.textScaleFactor/su,{defaultShapedIcon:zn,verticallyShapedIcon:Cs}=vM(g,ws,Et,Lr,it,fs,Ys,Is,zs);zs!=="none"&&ws&&(eC(ws)||tC(ws))&&(PE(0,os,ys,ws,zn,zs,ft,b,$),PE(0,_s,ss,ws,zn,zs,ft,b,$),Cs&&(PE(0,os,ys,ws,Cs,zs,ft,b,$),PE(0,_s,ss,ws,Cs,zs,ft,b,$))),ws=zn;const{iconBBox:Qs,iconVerticalBBox:vn,textBBox:Wn,textVerticalBBox:Xn}=mM(g,ws,Cs,Et,Lr,it,ds,Is,Pt,$,Rs,fs,as,xs);kr.push({feature:Lr,shapedTextOrientations:fs,shapedText:Hs,shapedIcon:ws,iconPrimary:ys,iconSecondary:ss,iconOffset:Is,iconAnchor:Rs,verticallyShapedIcon:Cs,layoutTextSize:as,layoutIconSize:ds,textOffset:xs,isSDFIcon:rn,iconTextFit:zs,iconCollisionBounds:Qs,iconVerticalCollisionBounds:vn,textCollisionBounds:Wn,textVerticalCollisionBounds:Xn})}return{featureData:kr,sizes:Pt,hasAnySecondaryIcon:Rr,textAlongLine:Er,symbolPlacement:hr}},c.fx=cC,c.fy=function(g,s,a,b,$,it,st,at,ht,ft){g.iconAtlasPositions=ft.iconPositions;const{featureData:xt,hasAnySecondaryIcon:Et,sizes:Rt,textAlongLine:Pt,symbolPlacement:Lt}=s;for(const Gt of xt){const{shapedIcon:Kt,verticallyShapedIcon:Xt,feature:nr,shapedTextOrientations:lr,shapedText:hr,layoutTextSize:Er,textOffset:_r,isSDFIcon:Rr,iconPrimary:kr,iconSecondary:Lr,iconTextFit:is,iconOffset:Br,iconCollisionBounds:as,iconVerticalCollisionBounds:ds,textCollisionBounds:fs}=Gt;xC(Kt,ft.iconPositions,kr,Lr),xC(Xt,ft.iconPositions,kr,Lr),_M(lr,ft.iconPositions),yM(kr,Lr,ft.iconPositions),(hr||Kt)&&bM(g,nr,lr,Kt,Xt,ht,Rt,Er,0,_r,Rr,b,$,st,at,Et,is,Br,Pt,Lt,as,ds,fs)}a&&g.generateCollisionDebugBuffers(it,g.collisionBoxArray,Rt.textScaleFactor)},c.fz=Zr,c.g=function(g,s){return Qm(Object.assign(g,{method:"GET"}),s)},c.h=function(g){return g.indexOf("mapbox:")===0},c.i=function(g){return Gn.API_STYLE_REGEX.test(g)&&!xu(g)},c.j=Cl,c.k=Lp,c.l=function(g){return decodeURIComponent(atob(g).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join(""))},c.m=function(g,s){return Qm(Object.assign(g,{type:"json"}),s)},c.n=p0,c.o=ru,c.p=function(g,s){return Qm(Object.assign(g,{method:"POST"}),s)},c.q=Ru,c.r=Mp,c.s=function(g){try{const s=self[g];return s.setItem("_mapbox_test_",1),s.removeItem("_mapbox_test_"),!0}catch{return!1}},c.t=function(){return X2||(X2=new Xy("ImageRasterizer")),X2},c.u=function(){return function g(s){return s?(s^Math.random()*(16>>s/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,g)}()},c.v=function(g){return!!g&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(g)},c.w=$s,c.x=US,c.y=fy,c.z=Dp}),nt(["./shared"],function(c){function pt(Hr){const Qt=Hr?Hr.url.toString():void 0;return Qt?performance.getEntriesByName(Qt):[]}function gt(Hr){if(typeof Hr=="number"||typeof Hr=="boolean"||typeof Hr=="string"||Hr==null)return JSON.stringify(Hr);if(Array.isArray(Hr)){let or="[";for(const gr of Hr)or+=`${gt(gr)},`;return`${or}]`}let Qt="{";for(const or of Object.keys(Hr).sort())Qt+=`${or}:${gt(Hr[or])},`;return`${Qt}}`}function St(Hr){let Qt="";for(const or of c.bx)Qt+=`/${gt(Hr[or])}`;return Qt}class kt{constructor(Qt){this.keyCache={},this._layers={},this._layerConfigs={},Qt&&this.replace(Qt)}replace(Qt,or){this._layerConfigs={},this._layers={},this.update(Qt,[],or)}update(Qt,or,gr){this._options=gr;for(const Ir of Qt)this._layerConfigs[Ir.id]=Ir,(this._layers[Ir.id]=c.du(Ir,this.scope,null,this._options)).compileFilter(gr),this.keyCache[Ir.id]&&delete this.keyCache[Ir.id];for(const Ir of or)delete this.keyCache[Ir],delete this._layerConfigs[Ir],delete this._layers[Ir];this.familiesBySource={};const Mr=function(Ir,zr){const _i={};for(let Jr=0;Jr<Ir.length;Jr++){const Es=Ir[Jr];let hs=zr&&zr[Es.id];hs||(Es.type==="symbol"?hs=Es.id:(hs=St(Es),Es.type==="line"&&Es.paint&&function an($s){return typeof $s=="string"&&$s==="line-progress"||(Array.isArray($s)?$s.some(an):!(!$s||typeof $s!="object")&&Object.values($s).some(an))}(Es.paint["line-width"])&&(hs+=`/${gt(Es.paint["line-width"])}`))),zr&&(zr[Es.id]=hs);let Ws=_i[hs];Ws||(Ws=_i[hs]=[]),Ws.push(Es)}const Vr=[];for(const Jr in _i)Vr.push(_i[Jr]);return Vr}(Object.values(this._layerConfigs),this.keyCache);for(const Ir of Mr){const zr=Ir.map(Ws=>this._layers[Ws.id]),_i=zr[0];if(_i.visibility==="none")continue;const Vr=_i.source||"";let Jr=this.familiesBySource[Vr];Jr||(Jr=this.familiesBySource[Vr]={});const Es=_i.sourceLayer||"_geojsonTileLayer";let hs=Jr[Es];hs||(hs=Jr[Es]=[]),hs.push(zr)}}}const At=1*c.fl;class Nt{constructor(Qt){const or={},gr=[];for(const _i in Qt){const Vr=Qt[_i],Jr=or[_i]={};for(const Es in Vr.glyphs){const hs=Vr.glyphs[+Es];if(!hs||hs.bitmap.width===0||hs.bitmap.height===0)continue;const Ws=hs.metrics.localGlyph?At:1,an={x:0,y:0,w:hs.bitmap.width+2*Ws,h:hs.bitmap.height+2*Ws};gr.push(an),Jr[Es]=an}}const{w:Mr,h:Ir}=c.G(gr),zr=new c.fk({width:Mr||1,height:Ir||1});for(const _i in Qt){const Vr=Qt[_i];for(const Jr in Vr.glyphs){const Es=Vr.glyphs[+Jr];if(!Es||Es.bitmap.width===0||Es.bitmap.height===0)continue;const hs=or[_i][Jr],Ws=Es.metrics.localGlyph?At:1;c.fk.copy(Es.bitmap,zr,{x:0,y:0},{x:hs.x+Ws,y:hs.y+Ws},Es.bitmap)}}this.image=zr,this.positions=or}}function Vt(Hr,Qt,or){Hr[Qt]?or&&(Hr[Qt].center=or):Hr[Qt]={floorIds:new Set,center:or||[0,0],floors:{}}}function zt(Hr,Qt,or,gr){for(const Mr of Qt)Vt(Hr,Mr),Hr[Mr].floors[or]=gr,Hr[Mr].floorIds.add(or)}function Jt(Hr){return{id:Hr.properties.id.toString(),center:Hr.properties.center.toString().split(";").map(Number)}}function Dt(Hr){return{id:Hr.properties.id.toString(),isDefault:!!Hr.properties.is_default&&Hr.properties.is_default,connections:Hr.properties.connected_floor_ids?new Set(Hr.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Hr.properties.conflicted_floor_ids?new Set(Hr.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Hr.properties.building_ids?new Set(Hr.properties.building_ids.toString().split(";")):new Set,name:Hr.properties.name.toString(),zIndex:Hr.properties.z_index}}function It(Hr,Qt){return Qt.every(or=>Hr.properties&&Hr.properties[or]!=null)}function Mt(Hr){return It(Hr,["type","id","name"])&&Hr.properties.type==="building"}function Ht(Hr){return It(Hr,["type","id","name","z_index"])&&Hr.properties.type==="floor"}c.fj(Nt,"GlyphAtlas");class tr{constructor(Qt){this.tileID=new c.aQ(Qt.tileID.overscaledZ,Qt.tileID.wrap,Qt.tileID.canonical.z,Qt.tileID.canonical.x,Qt.tileID.canonical.y),this.tileZoom=Qt.tileZoom,this.uid=Qt.uid,this.zoom=Qt.zoom,this.lut=Qt.lut,this.canonical=Qt.tileID.canonical,this.pixelRatio=Qt.pixelRatio,this.tileSize=Qt.tileSize,this.source=Qt.source,this.scope=Qt.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Qt.showCollisionBoxes,this.collectResourceTiming=!!Qt.request&&Qt.request.collectResourceTiming,this.promoteId=Qt.promoteId,this.isSymbolTile=Qt.isSymbolTile,this.tileTransform=c.aZ(Qt.tileID.canonical,Qt.projection),this.projection=Qt.projection,this.worldview=Qt.worldview,this.localizableLayerIds=Qt.localizableLayerIds,this.brightness=Qt.brightness,this.extraShadowCaster=!!Qt.extraShadowCaster,this.tessellationStep=Qt.tessellationStep,this.scaleFactor=Qt.scaleFactor,this.worldview=Qt.worldview,this.indoor=Qt.indoor}parse(Qt,or,gr,Mr,Ir,zr){this.status="parsing",this.data=Qt,this.collisionBoxArray=new c.b3;const _i=new c.fm(Object.keys(Qt.layers).sort()),Vr=new c.fn(this.tileID,this.promoteId);Vr.bucketLayerIDs=[];const Jr={},Es=new c.fo(256,256),hs={featureIndex:Vr,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Es,availableImages:gr,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const In=this.indoor.indoorState.activeFloorsVisible,An=function(Tn,Yn,El){const Bl=function($a,io){if(!$a)return c.w("No source layers defined in indoor specification"),io;if($a.size===0)return io;const xl=$a.difference(io);for(const Do of xl)c.w(`Missing source layer required in indoor specification: ${Do}`);return io.intersection(io)}(Yn.sourceLayers,new Set(Object.keys(Tn.layers))),Rl=Yn.indoorState,Hl=function($a,io,xl,Do){const Gn=new Set,Cl=new Set,xu=new Set,bu=new Map,Vu={},Zm=uu=>{const _h=bu.get(uu)||new Set;for(const Cu of Gn)if((bu.get(Cu)||new Set).has(uu)||_h.has(Cu))return!0;return!1};for(const uu of io){const _h=$a.layers[uu];if(_h)for(let Cu=0;Cu<_h.length;Cu++){const Mp=_h.feature(Cu);if(Mt(Mp)){const{id:ru,center:Xm}=Jt(Mp);Vt(Vu,ru,Xm),Gn.add(ru)}else if(Ht(Mp)){const{id:ru,isDefault:Xm,connections:bx,conflicts:l0,buildings:c0,name:u0,zIndex:ly}=Dt(Mp);zt(Vu,c0,ru,{name:u0,zIndex:ly}),bu.set(ru,l0),(ru===Do||bx.has(Do))&&Gn.add(ru),Cl.add(ru),Xm&&xu.add(ru)}}else c.w(`indoor source layer not found: ${uu}`)}if(xl)for(const uu of xl)Cl.has(uu)&&(Zm(uu)||Gn.add(uu));for(const uu of xu)Gn.has(uu)||Zm(uu)||Gn.add(uu);return{buildings:Vu,activeFloors:Gn}}(Tn,Bl,Rl.lastActiveFloors,Rl.selectedFloorId);return El.send("setIndoorData",Hl),Hl}(Qt,this.indoor,Ir);hs.activeFloors=In?An.activeFloors:void 0}const Ws=[],an=or.familiesBySource[this.source];for(const In in an){const An=Qt.layers[In];if(!An)continue;let Tn=!1,Yn=!1,El=!1;for(const io of an[In])io[0].type==="symbol"?Tn=!0:Yn=!0,io[0].is3D()&&io[0].type!=="model"&&(El=!0);if(this.extraShadowCaster&&!El||this.isSymbolTile===!0&&!Tn||this.isSymbolTile===!1&&!Yn)continue;An.version===1&&c.w(`Vector tile source "${this.source}" layer "${In}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bl=_i.encode(In),Rl=[],Hl=this.localizableLayerIds&&this.localizableLayerIds.has(In);let $a=!1;for(let io=0,xl=0;io<An.length;io++){const Do=An.feature(io),Gn=Vr.getId(Do,In),Cl=Do.properties?Do.properties.worldview:null;if(Hl&&this.worldview&&typeof Cl=="string")if(Cl==="all")Do.properties.$localized=!0;else{if(!Cl.split(",").includes(this.worldview))continue;Do.properties.$localized=!0,Do.properties.worldview=this.worldview}!$a&&Do.properties&&Do.properties.hasOwnProperty(c.fp)&&($a=!0),Rl.push({feature:Do,id:Gn,index:xl,sourceLayerIndex:Bl}),xl++}$a&&!hs.elevationFeatures&&Qt.layers.hasOwnProperty(c.fq)&&(hs.elevationFeatures=c.fr.parseFrom(Qt.layers[c.fq],this.canonical));for(const io of an[In]){const xl=io[0];if(this.extraShadowCaster&&(!xl.is3D()||xl.type==="model")||this.isSymbolTile!==void 0&&xl.type==="symbol"!==this.isSymbolTile||xl.minzoom&&this.zoom<Math.floor(xl.minzoom)||xl.maxzoom&&this.zoom>=xl.maxzoom||xl.visibility==="none")continue;er(io,this.zoom,hs.brightness,gr,this.worldview);const Do=Jr[xl.id]=xl.createBucket({index:Vr.bucketLayerIDs.length,layers:io,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bl,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Mr,worldview:this.worldview,localizable:Hl});Vr.bucketLayerIDs.push(io.map(Cl=>c.B(Cl.id,Cl.scope)));let Gn=Do.prepare?Do.prepare():null;Gn!=null?(Gn=Gn.then(()=>Do.populate(Rl,hs,this.tileID.canonical,this.tileTransform)),Ws.push(Gn)):Do.populate(Rl,hs,this.tileID.canonical,this.tileTransform)}}const $s=()=>{let In,An,Tn,Yn,El,Bl;Es.trim();const Rl={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Hl=()=>{if(In)return this.status="done",zr(In);if(this.extraShadowCaster)this.status="done",zr(null,{buckets:Object.values(Jr).filter(io=>!io.isEmpty()),featureIndex:Vr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:hs.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(An&&Tn&&Yn){const io=new Nt(An),xl=new Map;for(const[Cl,xu]of Tn.entries()){const{imagePosition:bu}=c.fu(Cl,xu,c.fv);xl.set(Cl,bu)}const Do={};for(const Cl in Jr){const xu=Jr[Cl];xu instanceof c.b4&&(er(xu.layers,this.zoom,hs.brightness,gr,this.worldview),Do[Cl]=c.fw(xu,An,io.positions,Tn,xl,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,El,this.worldview))}const Gn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Ir,Tn,El,()=>{Gn.iconsPending=!1,$a(Do,io,Gn)}),this.rasterizeIfNeeded(Ir,Yn,Bl,()=>{Gn.patternsPending=!1,$a(Do,io,Gn)})}},$a=(io,xl,Do,Gn)=>{if(Do.iconsPending||Do.patternsPending)return;const Cl=new c.fx(Tn,Yn,this.lut);for(const xu in Jr){const bu=Jr[xu];if(xu in io)c.fy(bu,io[xu],this.showCollisionBoxes,gr,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Tn,Cl);else if(bu.hasPattern&&(bu instanceof c.ba||bu instanceof c.bb||bu instanceof c.ea)){er(bu.layers,this.zoom,hs.brightness,gr,this.worldview);const Vu=Object.fromEntries(Cl.patternPositions);bu.addFeatures(hs,this.tileID.canonical,Vu,gr,this.tileTransform,this.brightness)}}this.status="done",zr(null,{buckets:Object.values(Jr).filter(xu=>!xu.isEmpty()),featureIndex:Vr,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xl.image,lineAtlas:Es,imageAtlas:Cl,brightness:hs.brightness})};if(!this.extraShadowCaster){const io=c.fs(hs.glyphDependencies,Gn=>Object.keys(Gn).map(Number));Object.keys(io).length?Ir.send("getGlyphs",{uid:this.uid,stacks:io},(Gn,Cl)=>{In||(In=Gn,An=Cl,Hl())},void 0,!1,Rl):An={};const xl=Array.from(hs.iconDependencies.keys()).map(Gn=>c.I.parse(Gn));xl.length?Ir.send("getImages",{images:xl,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Gn,Cl)=>{In||(In=Gn,Tn=new Map,El=this.updateImageMapAndGetImageTaskQueue(Tn,Cl,hs.iconDependencies),Hl())},void 0,!1,Rl):(Tn=new Map,El=new Map);const Do=Array.from(hs.patternDependencies.keys()).map(Gn=>c.I.parse(Gn));Do.length?Ir.send("getImages",{images:Do,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Gn,Cl)=>{In||(In=Gn,Yn=new Map,Bl=this.updateImageMapAndGetImageTaskQueue(Yn,Cl,hs.patternDependencies),Hl())},void 0,!1,Rl):(Yn=new Map,Bl=new Map)}if(hs.elevationFeatures&&hs.elevationFeatures.length>0){const io=[];for(const Do of Object.values(Jr))if(Do instanceof c.bb){const Gn=Do.getUnevaluatedPortalGraph();Gn&&io.push(Gn)}const xl=c.ft.evaluate(io);for(const Do of Object.values(Jr))if(Do instanceof c.bb){const Gn=Qt.layers[_i.decode(Do.sourceLayerIndex)];Do.setEvaluatedPortalGraph(xl,Gn,this.tileID.canonical,hs.availableImages,hs.brightness)}}Hl()};Ws.length>0?Promise.allSettled(Ws).then($s).catch(zr):$s()}updateParameters(Qt){this.scaleFactor=Qt.scaleFactor,this.showCollisionBoxes=Qt.showCollisionBoxes,this.projection=Qt.projection,this.brightness=Qt.brightness,this.tileTransform=c.aZ(Qt.tileID.canonical,Qt.projection),this.extraShadowCaster=Qt.extraShadowCaster,this.lut=Qt.lut,this.worldview=Qt.worldview,this.indoor=Qt.indoor}rasterizeIfNeeded(Qt,or,gr,Mr){Array.from(or.values()).some(Ir=>Ir.usvg)?this.rasterize(Qt,or,gr,Mr):Mr()}updateImageMapAndGetImageTaskQueue(Qt,or,gr){const Mr=new Map;for(const Ir of or.keys()){const zr=gr.get(Ir)||[];for(const _i of zr){const Vr=_i.toString(),Jr=or.get(_i.id.toString());Jr.usvg?Mr.has(Vr)||(Mr.set(Vr,_i),Qt.set(Vr,Object.assign({},Jr))):Qt.set(Vr,Jr)}}return Mr}rasterize(Qt,or,gr,Mr){this.rasterizeTask=Qt.send("rasterizeImages",{scope:this.scope,tasks:gr},(Ir,zr)=>{if(!Ir)for(const[_i,Vr]of zr.entries()){const Jr=Object.assign(or.get(_i),{data:Vr});or.set(_i,Jr)}Mr()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function er(Hr,Qt,or,gr,Mr){const Ir=new c.ac(Qt,{brightness:or,worldview:Mr});for(const zr of Hr)zr.recalculate(Ir,gr)}class dr extends c.E{constructor(Qt,or,gr,Mr,Ir,zr,_i){super(),this.actor=Qt,this.layerIndex=or,this.availableImages=gr,this.availableModels=Mr,this.loadVectorData=zr||c.aL,this.loading={},this.loaded={},this.deduped=new c.aK(Qt.scheduler),this.isSpriteLoaded=Ir,this.scheduler=Qt.scheduler,this.brightness=_i}loadTile(Qt,or){const gr=Qt.uid,Mr=Qt&&Qt.request,Ir=Mr&&Mr.collectResourceTiming,zr=this.loading[gr]=new tr(Qt);zr.abort=this.loadVectorData(Qt,(_i,Vr)=>{const Jr=!this.loading[gr];if(delete this.loading[gr],zr.cancelRasterize(),Jr||_i||!Vr)return zr.status="done",Jr||(this.loaded[gr]=zr),or(_i);const Es=Vr.rawData,hs={},Ws=c.aM(Vr.responseHeaders);Ws&&Ws.expires&&(hs.expires=Ws.expires),Ws&&Ws.cacheControl&&(hs.cacheControl=Ws.cacheControl),zr.vectorTile=Vr.vectorTile||new c.fz(new c.bt(Es));const an=()=>{zr.parse(zr.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,($s,In)=>{if($s||!In)return or($s);const An={};if(Ir){const Tn=pt(Mr);Tn.length>0&&(An.resourceTiming=JSON.parse(JSON.stringify(Tn)))}or(null,Object.assign({rawTileData:Es.slice(0),responseHeaders:Vr.responseHeaders},In,hs,An))})};this.isSpriteLoaded?an():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(an,{type:"parseTile",isSymbolTile:Qt.isSymbolTile,zoom:Qt.tileZoom}):an()}),this.loaded=this.loaded||{},this.loaded[gr]=zr})}reloadTile(Qt,or){const gr=this.loaded,Mr=Qt.uid;if(gr&&gr[Mr]){const Ir=gr[Mr];Ir.updateParameters(Qt);const zr=(_i,Vr)=>{const Jr=Ir.reloadCallback;Jr&&(delete Ir.reloadCallback,Ir.parse(Ir.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Jr)),or(_i,Vr)};Ir.status==="parsing"?Ir.reloadCallback=zr:Ir.status==="done"&&(Ir.vectorTile?Ir.parse(Ir.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,zr):zr())}else or(null,void 0)}abortTile(Qt,or){const gr=Qt.uid,Mr=this.loading[gr];Mr&&(Mr.abort&&Mr.abort(),delete this.loading[gr]),or()}removeTile(Qt,or){const gr=this.loaded,Mr=Qt.uid;gr&&gr[Mr]&&delete gr[Mr],or()}}class mr{loadTile(Qt,or){const{uid:gr,encoding:Mr,rawImageData:Ir,padding:zr}=Qt,_i=ImageBitmap&&Ir instanceof ImageBitmap?this.getImageData(Ir,zr):Ir;or(null,new c.fA(gr,_i,Mr,zr<1))}reloadTile(Qt,or){or(null,null)}abortTile(Qt,or){or()}removeTile(Qt,or){or()}getImageData(Qt,or){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Qt.width,Qt.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=Qt.width,this.offscreenCanvas.height=Qt.height,this.offscreenCanvasContext.drawImage(Qt,0,0,Qt.width,Qt.height);const gr=this.offscreenCanvasContext.getImageData(-or,-or,Qt.width+2*or,Qt.height+2*or);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),gr}}c.bs.setPbf(c.bt);class Ur{constructor(Qt){this._mrt=new c.bs(Qt.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=Qt.uid,this.tileID=Qt.tileID,this.source=Qt.source}parse(Qt,or){const gr=this._mrt;this.status="parsing",this._entireBuffer=Qt;try{gr.parseHeader(Qt),this._isHeaderLoaded=!0;const Mr=[];for(const Ir in gr.layers){const zr=gr.getLayer(Ir),_i=zr.getDataRange(zr.getBandList()),Vr=gr.createDecodingTask(_i),Jr=Qt.slice(_i.firstByte,_i.lastByte+1),Es=c.bs.performDecoding(Jr,Vr).then(hs=>Vr.complete(null,hs)).catch(hs=>Vr.complete(hs,null));Mr.push(Es)}Promise.allSettled(Mr).then(()=>or(null,gr)).catch(Ir=>or(Ir))}catch(Mr){or(Mr)}}}class Dr{constructor(Qt){this.actor=Qt,this.loading={},this.loaded={}}loadTile(Qt,or){const gr=Qt.uid,Mr=Qt.request,Ir=this.loading[gr]=new Ur(Qt),{cancel:zr}=c.bu(Mr,(_i,Vr,Jr)=>{const Es=!this.loading[gr];if(delete this.loading[gr],Es||_i||!Vr)return Ir.status="done",Es||(this.loaded[gr]=Ir),or(_i);Ir.parse(Vr,(hs,Ws)=>{if(hs||!Ws)return or(hs);or(null,Ws,Jr)}),this.loaded[gr]=Ir});Ir.abort=zr}reloadTile(Qt,or){or(null,void 0)}abortTile(Qt,or){const gr=Qt.uid,Mr=this.loading[gr];Mr&&(Mr.abort&&Mr.abort(),delete this.loading[gr]),or()}removeTile(Qt,or){const gr=Qt.uid;this.loaded[gr]&&delete this.loaded[gr],or()}decodeRasterArray(Qt,or){c.bs.performDecoding(Qt.buffer,Qt.task).then(gr=>or(null,gr)).catch(gr=>or(gr))}}const Yr=c.fB.prototype.toGeoJSON;class es{constructor(Qt){this._feature=Qt,this.extent=c.al,this.type=Qt.type,this.properties=Qt.tags,"id"in Qt&&!isNaN(Qt.id)&&(this.id=parseInt(Qt.id,10))}loadGeometry(){if(this._feature.type===1){const Qt=[];for(const or of this._feature.geometry)Qt.push([new c.P(or[0],or[1])]);return Qt}{const Qt=[];for(const or of this._feature.geometry){const gr=[];for(const Mr of or)gr.push(new c.P(Mr[0],Mr[1]));Qt.push(gr)}return Qt}}toGeoJSON(Qt,or,gr){return Yr.call(this,Qt,or,gr)}}class ms{constructor(Qt,or){this.name=Qt,this.extent=c.al,this.length=or.length,this._jsonFeatures=or}feature(Qt){return new es(this._jsonFeatures[Qt])}}class Ms{constructor(Qt){this.layers={},this.extent=c.al;for(const or of Object.keys(Qt))this.layers[or]=new ms(or,Qt[or])}}const Kr=64/4096,xr=128;class jr{constructor(){this.features=new Map}clear(){this.features.clear()}load(Qt=[],or){for(const gr of Qt){const Mr=gr.id;if(Mr==null)continue;let Ir=this.features.get(Mr);Ir&&this.updateCache(Ir,or),gr.geometry?(Ir=ar(gr),this.updateCache(Ir,or),this.features.set(Mr,Ir)):this.features.delete(Mr),this.updateCache(Ir,or)}}updateCache(Qt,or){for(const{canonical:gr,uid:Mr}of Object.values(or)){const{z:Ir,x:zr,y:_i}=gr;rr(Qt,Math.pow(2,Ir),zr,_i)&&delete or[Mr]}}getTile(Qt,or,gr){const Mr=Math.pow(2,Qt),Ir=[];for(const zr of this.features.values())rr(zr,Mr,or,gr)&&Ir.push(us(zr,Mr,or,gr));return{features:Ir}}getFeatures(){return[...this.features.values()]}}function rr({minX:Hr,minY:Qt,maxX:or,maxY:gr},Mr,Ir,zr){return Hr<(Ir+1+Kr)/Mr&&Qt<(zr+1+Kr)/Mr&&or>(Ir-Kr)/Mr&&gr>(zr-Kr)/Mr}function ar(Hr){const{id:Qt,geometry:or,properties:gr}=Hr;if(!or)return;if(or.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Mr,coordinates:Ir}=or,zr={id:Qt,type:1,geometry:[],tags:gr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},_i=zr.geometry;if(Mr==="Point")$r(Ir,_i,zr);else if(Mr==="MultiPoint")for(const Vr of Ir)$r(Vr,_i,zr);else if(Mr==="LineString")zr.type=2,Ar(Ir,_i,zr);else if(Mr==="MultiLineString")zr.type=2,Xr(Ir,_i,zr);else if(Mr==="Polygon")zr.type=3,Xr(Ir,_i,zr,!0);else{if(Mr!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");zr.type=3;for(const Vr of Ir)Xr(Vr,_i,zr,!0)}return zr}function $r([Hr,Qt],or,gr){const Mr=c.aF(Hr);let Ir=c.aJ(Qt);Ir=Ir<0?0:Ir>1?1:Ir,or.push(Mr,Ir),gr.minX=Math.min(gr.minX,Mr),gr.minY=Math.min(gr.minY,Ir),gr.maxX=Math.max(gr.maxX,Mr),gr.maxY=Math.max(gr.maxY,Ir)}function Ar(Hr,Qt,or,gr=!1,Mr=!1){const Ir=[];for(const zr of Hr)$r(zr,Ir,or);Qt.push(Ir),gr&&function(zr,_i){let Vr=0;for(let Jr=0,Es=zr.length,hs=Es-2;Jr<Es;hs=Jr,Jr+=2)Vr+=(zr[Jr]-zr[hs])*(zr[Jr+1]+zr[hs+1]);if(Vr>0===_i)for(let Jr=0,Es=zr.length;Jr<Es/2;Jr+=2){const hs=zr[Jr],Ws=zr[Jr+1];zr[Jr]=zr[Es-2-Jr],zr[Jr+1]=zr[Es-1-Jr],zr[Es-2-Jr]=hs,zr[Es-1-Jr]=Ws}}(Ir,Mr)}function Xr(Hr,Qt,or,gr=!1){for(let Mr=0;Mr<Hr.length;Mr++)Ar(Hr[Mr],Qt,or,gr,Mr===0)}function us(Hr,Qt,or,gr){const{id:Mr,type:Ir,geometry:zr,tags:_i}=Hr,Vr=[];if(Ir===1)(function(Jr,Es,hs,Ws,an){for(let $s=0;$s<Jr.length;$s+=2){const In=Math.round(c.al*(Jr[$s+0]*Es-hs)),An=Math.round(c.al*(Jr[$s+1]*Es-Ws));an.push([In,An])}})(zr,Qt,or,gr,Vr);else if(Ir===2)for(const Jr of zr)Wr(Jr,Qt,or,gr,Vr);else if(Ir===3)for(const Jr of zr)Vs(Jr,Qt,or,gr,Vr);return{id:Mr,type:Ir,geometry:Vr,tags:_i}}function Wr(Hr,Qt,or,gr,Mr){const Ir=-xr,zr=c.al+xr;let _i;for(let Vr=0;Vr<Hr.length-2;Vr+=2){let Jr=Math.round(c.al*(Hr[Vr+0]*Qt-or)),Es=Math.round(c.al*(Hr[Vr+1]*Qt-gr)),hs=Math.round(c.al*(Hr[Vr+2]*Qt-or)),Ws=Math.round(c.al*(Hr[Vr+3]*Qt-gr));const an=hs-Jr,$s=Ws-Es;Jr<Ir&&hs<Ir||(Jr<Ir?(Es+=Math.round($s*((Ir-Jr)/an)),Jr=Ir):hs<Ir&&(Ws=Es+Math.round($s*((Ir-Jr)/an)),hs=Ir),Es<Ir&&Ws<Ir||(Es<Ir?(Jr+=Math.round(an*((Ir-Es)/$s)),Es=Ir):Ws<Ir&&(hs=Jr+Math.round(an*((Ir-Es)/$s)),Ws=Ir),Jr>=zr&&hs>=zr||(Jr>=zr?(Es+=Math.round($s*((zr-Jr)/an)),Jr=zr):hs>=zr&&(Ws=Es+Math.round($s*((zr-Jr)/an)),hs=zr),Es>=zr&&Ws>=zr||(Es>=zr?(Jr+=Math.round(an*((zr-Es)/$s)),Es=zr):Ws>=zr&&(hs=Jr+Math.round(an*((zr-Es)/$s)),Ws=zr),_i&&Jr===_i[_i.length-1][0]&&Es===_i[_i.length-1][1]||(_i=[[Jr,Es]],Mr.push(_i)),_i.push([hs,Ws])))))}}function Vs(Hr,Qt,or,gr,Mr){const Ir=(or-Kr)/Qt,zr=(gr-Kr)/Qt,_i=(or+1+Kr)/Qt,Vr=(gr+1+Kr)/Qt;function Jr(Ws,an){let $s=0;return Ws<Ir?$s|=1:Ws>_i&&($s|=2),an<zr?$s|=4:an>Vr&&($s|=8),$s}let Es=[];for(let Ws=1;Ws<=8;Ws*=2){let an=Hr[Hr.length-2],$s=Hr[Hr.length-1],In=!(Jr(an,$s)&Ws);for(let An=0;An<Hr.length;An+=2){const Tn=Hr[An],Yn=Hr[An+1],El=!(Jr(Tn,Yn)&Ws);El!==In&&(8&Ws?Es.push(an+(Tn-an)*(Vr-$s)/(Yn-$s),Vr):4&Ws?Es.push(an+(Tn-an)*(zr-$s)/(Yn-$s),zr):2&Ws?Es.push(_i,$s+(Yn-$s)*(_i-an)/(Tn-an)):1&Ws&&Es.push(Ir,$s+(Yn-$s)*(Ir-an)/(Tn-an))),El&&Es.push(Tn,Yn),an=Tn,$s=Yn,In=El}if(!(Hr=Es).length||Ws===8)break;Es=[]}const hs=[];for(let Ws=0;Ws<Es.length;Ws+=2)hs.push([Math.round(c.al*(Es[Ws]*Qt-or)),Math.round(c.al*(Es[Ws+1]*Qt-gr))]);Mr.push(hs)}function yn({name:Hr,features:Qt},or){or.writeStringField(1,Hr),or.writeVarintField(5,c.al);const gr=new Map,Mr=new Map,Ir={keys:gr,values:Mr,feature:null};for(const zr of Qt)Ir.feature=zr,or.writeMessage(2,_n,Ir);for(const zr of gr.keys())or.writeStringField(3,zr);for(const zr of Mr.keys())or.writeMessage(4,Zs,zr)}function _n(Hr,Qt){const or=Hr.feature;or.id!==void 0&&Number.isSafeInteger(+or.id)&&Qt.writeVarintField(1,+or.id),or.tags&&Qt.writeMessage(2,zo,Hr),Qt.writeVarintField(3,or.type),Qt.writeMessage(4,qr,or)}function zo({keys:Hr,values:Qt,feature:or},gr){for(const Mr of Object.keys(or.tags)){let Ir=or.tags[Mr];if(Ir===null)continue;let zr=Hr.get(Mr);zr===void 0&&(zr=Hr.size,Hr.set(Mr,zr)),gr.writeVarint(zr);const _i=typeof Ir;_i!=="string"&&_i!=="boolean"&&_i!=="number"&&(Ir=JSON.stringify(Ir));let Vr=Qt.get(Ir);Vr===void 0&&(Vr=Qt.size,Qt.set(Ir,Vr)),gr.writeVarint(Vr)}}function Cn(Hr,Qt){return(Qt<<3)+(7&Hr)}function On(Hr){return Hr<<1^Hr>>31}function qr(Hr,Qt){const{geometry:or,type:gr}=Hr;let Mr=0,Ir=0;if(gr===1){Qt.writeVarint(Cn(1,or.length));for(const zr of or){const _i=zr[0]-Mr,Vr=zr[1]-Ir;Qt.writeVarint(On(_i)),Qt.writeVarint(On(Vr)),Mr+=_i,Ir+=Vr}}else for(const zr of or){Qt.writeVarint(Cn(1,1));const _i=zr.length-(gr===3?1:0);for(let Vr=0;Vr<_i;Vr++){Vr===1&&Qt.writeVarint(Cn(2,_i-1));const Jr=zr[Vr][0]-Mr,Es=zr[Vr][1]-Ir;Qt.writeVarint(On(Jr)),Qt.writeVarint(On(Es)),Mr+=Jr,Ir+=Es}gr===3&&Qt.writeVarint(Cn(7,1))}}function Zs(Hr,Qt){const or=typeof Hr;or==="string"?Qt.writeStringField(1,Hr):or==="boolean"?Qt.writeBooleanField(7,Hr):or==="number"&&(Hr%1!=0?Qt.writeDoubleField(3,Hr):Hr<0?Qt.writeSVarintField(6,Hr):Qt.writeVarintField(5,Hr))}const Os={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Hr=>Hr},Us=Math.fround||(Nn=new Float32Array(1),Hr=>(Nn[0]=+Hr,Nn[0]));var Nn;const cn=3,Bn=5,Pn=6;class Ro{constructor(Qt){this.options=Object.assign(Object.create(Os),Qt),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Qt){const{log:or,minZoom:gr,maxZoom:Mr}=this.options;or&&console.time("total time");const Ir=`prepare ${Qt.length} points`;or&&console.time(Ir),this.points=Qt;const zr=[];for(let Vr=0;Vr<Qt.length;Vr++){const Jr=Qt[Vr];if(!Jr.geometry)continue;const[Es,hs]=Jr.geometry.coordinates,Ws=Us(Qo(Es)),an=Us(Wo(hs));zr.push(Ws,an,1/0,Vr,-1,1),this.options.reduce&&zr.push(0)}let _i=this.trees[Mr+1]=this._createTree(zr);or&&console.timeEnd(Ir);for(let Vr=Mr;Vr>=gr;Vr--){const Jr=+Date.now();_i=this.trees[Vr]=this._createTree(this._cluster(_i,Vr)),or&&console.log("z%d: %d clusters in %dms",Vr,_i.numItems,+Date.now()-Jr)}return or&&console.timeEnd("total time"),this}getClusters(Qt,or){let gr=((Qt[0]+180)%360+360)%360-180;const Mr=Math.max(-90,Math.min(90,Qt[1]));let Ir=Qt[2]===180?180:((Qt[2]+180)%360+360)%360-180;const zr=Math.max(-90,Math.min(90,Qt[3]));if(Qt[2]-Qt[0]>=360)gr=-180,Ir=180;else if(gr>Ir){const hs=this.getClusters([gr,Mr,180,zr],or),Ws=this.getClusters([-180,Mr,Ir,zr],or);return hs.concat(Ws)}const _i=this.trees[this._limitZoom(or)],Vr=_i.range(Qo(gr),Wo(zr),Qo(Ir),Wo(Mr)),Jr=_i.data,Es=[];for(const hs of Vr){const Ws=this.stride*hs;Es.push(Jr[Ws+Bn]>1?Ho(Jr,Ws,this.clusterProps):this.points[Jr[Ws+cn]])}return Es}getChildren(Qt){const or=this._getOriginId(Qt),gr=this._getOriginZoom(Qt),Mr="No cluster with the specified id.",Ir=this.trees[gr];if(!Ir)throw new Error(Mr);const zr=Ir.data;if(or*this.stride>=zr.length)throw new Error(Mr);const _i=this.options.radius/(this.options.extent*Math.pow(2,gr-1)),Vr=Ir.within(zr[or*this.stride],zr[or*this.stride+1],_i),Jr=[];for(const Es of Vr){const hs=Es*this.stride;zr[hs+4]===Qt&&Jr.push(zr[hs+Bn]>1?Ho(zr,hs,this.clusterProps):this.points[zr[hs+cn]])}if(Jr.length===0)throw new Error(Mr);return Jr}getLeaves(Qt,or,gr){const Mr=[];return this._appendLeaves(Mr,Qt,or=or||10,gr=gr||0,0),Mr}getTile(Qt,or,gr){const Mr=this.trees[this._limitZoom(Qt)],Ir=Math.pow(2,Qt),{extent:zr,radius:_i}=this.options,Vr=_i/zr,Jr=(gr-Vr)/Ir,Es=(gr+1+Vr)/Ir,hs={features:[]};return this._addTileFeatures(Mr.range((or-Vr)/Ir,Jr,(or+1+Vr)/Ir,Es),Mr.data,or,gr,Ir,hs),or===0&&this._addTileFeatures(Mr.range(1-Vr/Ir,Jr,1,Es),Mr.data,Ir,gr,Ir,hs),or===Ir-1&&this._addTileFeatures(Mr.range(0,Jr,Vr/Ir,Es),Mr.data,-1,gr,Ir,hs),hs.features.length?hs:null}getClusterExpansionZoom(Qt){let or=this._getOriginZoom(Qt)-1;for(;or<=this.options.maxZoom;){const gr=this.getChildren(Qt);if(or++,gr.length!==1)break;Qt=gr[0].properties.cluster_id}return or}_appendLeaves(Qt,or,gr,Mr,Ir){const zr=this.getChildren(or);for(const _i of zr){const Vr=_i.properties;if(Vr&&Vr.cluster?Ir+Vr.point_count<=Mr?Ir+=Vr.point_count:Ir=this._appendLeaves(Qt,Vr.cluster_id,gr,Mr,Ir):Ir<Mr?Ir++:Qt.push(_i),Qt.length===gr)break}return Ir}_createTree(Qt){const or=new c.c4(Qt.length/this.stride|0,this.options.nodeSize,Float32Array);for(let gr=0;gr<Qt.length;gr+=this.stride)or.add(Qt[gr],Qt[gr+1]);return or.finish(),or.data=Qt,or}_addTileFeatures(Qt,or,gr,Mr,Ir,zr){for(const _i of Qt){const Vr=_i*this.stride,Jr=or[Vr+Bn]>1;let Es,hs,Ws;if(Jr)Es=Zn(or,Vr,this.clusterProps),hs=or[Vr],Ws=or[Vr+1];else{const In=this.points[or[Vr+cn]];Es=In.properties;const[An,Tn]=In.geometry.coordinates;hs=Qo(An),Ws=Wo(Tn)}const an={type:1,geometry:[[Math.round(this.options.extent*(hs*Ir-gr)),Math.round(this.options.extent*(Ws*Ir-Mr))]],tags:Es};let $s;$s=Jr||this.options.generateId?or[Vr+cn]:this.points[or[Vr+cn]].id,$s!==void 0&&(an.id=$s),zr.features.push(an)}}_limitZoom(Qt){return Math.max(this.options.minZoom,Math.min(Math.floor(+Qt),this.options.maxZoom+1))}_cluster(Qt,or){const{radius:gr,extent:Mr,reduce:Ir,minPoints:zr}=this.options,_i=gr/(Mr*Math.pow(2,or)),Vr=Qt.data,Jr=[],Es=this.stride;for(let hs=0;hs<Vr.length;hs+=Es){if(Vr[hs+2]<=or)continue;Vr[hs+2]=or;const Ws=Vr[hs],an=Vr[hs+1],$s=Qt.within(Vr[hs],Vr[hs+1],_i),In=Vr[hs+Bn];let An=In;for(const Tn of $s){const Yn=Tn*Es;Vr[Yn+2]>or&&(An+=Vr[Yn+Bn])}if(An>In&&An>=zr){let Tn,Yn=Ws*In,El=an*In,Bl=-1;const Rl=(hs/Es<<5)+(or+1)+this.points.length;for(const Hl of $s){const $a=Hl*Es;if(Vr[$a+2]<=or)continue;Vr[$a+2]=or;const io=Vr[$a+Bn];Yn+=Vr[$a]*io,El+=Vr[$a+1]*io,Vr[$a+4]=Rl,Ir&&(Tn||(Tn=this._map(Vr,hs,!0),Bl=this.clusterProps.length,this.clusterProps.push(Tn)),Ir(Tn,this._map(Vr,$a)))}Vr[hs+4]=Rl,Jr.push(Yn/An,El/An,1/0,Rl,-1,An),Ir&&Jr.push(Bl)}else{for(let Tn=0;Tn<Es;Tn++)Jr.push(Vr[hs+Tn]);if(An>1)for(const Tn of $s){const Yn=Tn*Es;if(!(Vr[Yn+2]<=or)){Vr[Yn+2]=or;for(let El=0;El<Es;El++)Jr.push(Vr[Yn+El])}}}}return Jr}_getOriginId(Qt){return Qt-this.points.length>>5}_getOriginZoom(Qt){return(Qt-this.points.length)%32}_map(Qt,or,gr){if(Qt[or+Bn]>1){const zr=this.clusterProps[Qt[or+Pn]];return gr?Object.assign({},zr):zr}const Mr=this.points[Qt[or+cn]].properties,Ir=this.options.map(Mr);return gr&&Ir===Mr?Object.assign({},Ir):Ir}}function Ho(Hr,Qt,or){return{type:"Feature",id:Hr[Qt+cn],properties:Zn(Hr,Qt,or),geometry:{type:"Point",coordinates:[(gr=Hr[Qt],360*(gr-.5)),uo(Hr[Qt+1])]}};var gr}function Zn(Hr,Qt,or){const gr=Hr[Qt+Bn],Mr=gr>=1e4?`${Math.round(gr/1e3)}k`:gr>=1e3?Math.round(gr/100)/10+"k":gr,Ir=Hr[Qt+Pn],zr=Ir===-1?{}:Object.assign({},or[Ir]);return Object.assign(zr,{cluster:!0,cluster_id:Hr[Qt+cn],point_count:gr,point_count_abbreviated:Mr})}function Qo(Hr){return Hr/360+.5}function Wo(Hr){const Qt=Math.sin(Hr*Math.PI/180),or=.5-.25*Math.log((1+Qt)/(1-Qt))/Math.PI;return or<0?0:or>1?1:or}function uo(Hr){const Qt=(180-360*Hr)*Math.PI/180;return 360*Math.atan(Math.exp(Qt))/Math.PI-90}function eo(Hr,Qt,or,gr){let Mr=gr;const Ir=Qt+(or-Qt>>1);let zr,_i=or-Qt;const Vr=Hr[Qt],Jr=Hr[Qt+1],Es=Hr[or],hs=Hr[or+1];for(let Ws=Qt+3;Ws<or;Ws+=3){const an=to(Hr[Ws],Hr[Ws+1],Vr,Jr,Es,hs);if(an>Mr)zr=Ws,Mr=an;else if(an===Mr){const $s=Math.abs(Ws-Ir);$s<_i&&(zr=Ws,_i=$s)}}Mr>gr&&(zr-Qt>3&&eo(Hr,Qt,zr,gr),Hr[zr+2]=Mr,or-zr>3&&eo(Hr,zr,or,gr))}function to(Hr,Qt,or,gr,Mr,Ir){let zr=Mr-or,_i=Ir-gr;if(zr!==0||_i!==0){const Vr=((Hr-or)*zr+(Qt-gr)*_i)/(zr*zr+_i*_i);Vr>1?(or=Mr,gr=Ir):Vr>0&&(or+=zr*Vr,gr+=_i*Vr)}return zr=Hr-or,_i=Qt-gr,zr*zr+_i*_i}function Io(Hr,Qt,or,gr){const Mr={id:Hr??null,type:Qt,geometry:or,tags:gr,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Qt==="Point"||Qt==="MultiPoint"||Qt==="LineString")ou(Mr,or);else if(Qt==="Polygon")ou(Mr,or[0]);else if(Qt==="MultiLineString")for(const Ir of or)ou(Mr,Ir);else if(Qt==="MultiPolygon")for(const Ir of or)ou(Mr,Ir[0]);return Mr}function ou(Hr,Qt){for(let or=0;or<Qt.length;or+=3)Hr.minX=Math.min(Hr.minX,Qt[or]),Hr.minY=Math.min(Hr.minY,Qt[or+1]),Hr.maxX=Math.max(Hr.maxX,Qt[or]),Hr.maxY=Math.max(Hr.maxY,Qt[or+1])}function Dl(Hr,Qt,or,gr){if(!Qt.geometry)return;const Mr=Qt.geometry.coordinates;if(Mr&&Mr.length===0)return;const Ir=Qt.geometry.type,zr=Math.pow(or.tolerance/((1<<or.maxZoom)*or.extent),2);let _i=[],Vr=Qt.id;if(or.promoteId?Vr=Qt.properties[or.promoteId]:or.generateId&&(Vr=gr||0),Ir==="Point")Jl(Mr,_i);else if(Ir==="MultiPoint")for(const Jr of Mr)Jl(Jr,_i);else if(Ir==="LineString")Ju(Mr,_i,zr,!1);else if(Ir==="MultiLineString"){if(or.lineMetrics){for(const Jr of Mr)_i=[],Ju(Jr,_i,zr,!1),Hr.push(Io(Vr,"LineString",_i,Qt.properties));return}zu(Mr,_i,zr,!1)}else if(Ir==="Polygon")zu(Mr,_i,zr,!0);else{if(Ir!=="MultiPolygon"){if(Ir==="GeometryCollection"){for(const Jr of Qt.geometry.geometries)Dl(Hr,{id:Vr,geometry:Jr,properties:Qt.properties},or,gr);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Jr of Mr){const Es=[];zu(Jr,Es,zr,!0),_i.push(Es)}}Hr.push(Io(Vr,Ir,_i,Qt.properties))}function Jl(Hr,Qt){Qt.push(vu(Hr[0]),Vo(Hr[1]),0)}function Ju(Hr,Qt,or,gr){let Mr,Ir,zr=0;for(let Vr=0;Vr<Hr.length;Vr++){const Jr=vu(Hr[Vr][0]),Es=Vo(Hr[Vr][1]);Qt.push(Jr,Es,0),Vr>0&&(zr+=gr?(Mr*Es-Jr*Ir)/2:Math.sqrt(Math.pow(Jr-Mr,2)+Math.pow(Es-Ir,2))),Mr=Jr,Ir=Es}const _i=Qt.length-3;Qt[2]=1,eo(Qt,0,_i,or),Qt[_i+2]=1,Qt.size=Math.abs(zr),Qt.start=0,Qt.end=Qt.size}function zu(Hr,Qt,or,gr){for(let Mr=0;Mr<Hr.length;Mr++){const Ir=[];Ju(Hr[Mr],Ir,or,gr),Qt.push(Ir)}}function vu(Hr){return Hr/360+.5}function Vo(Hr){const Qt=Math.sin(Hr*Math.PI/180),or=.5-.25*Math.log((1+Qt)/(1-Qt))/Math.PI;return or<0?0:or>1?1:or}function Gl(Hr,Qt,or,gr,Mr,Ir,zr,_i){if(gr/=Qt,Ir>=(or/=Qt)&&zr<gr)return Hr;if(zr<or||Ir>=gr)return null;const Vr=[];for(const Jr of Hr){const Es=Jr.geometry;let hs=Jr.type;const Ws=Mr===0?Jr.minX:Jr.minY,an=Mr===0?Jr.maxX:Jr.maxY;if(Ws>=or&&an<gr){Vr.push(Jr);continue}if(an<or||Ws>=gr)continue;let $s=[];if(hs==="Point"||hs==="MultiPoint")fu(Es,$s,or,gr,Mr);else if(hs==="LineString")ju(Es,$s,or,gr,Mr,!1,_i.lineMetrics);else if(hs==="MultiLineString")pu(Es,$s,or,gr,Mr,!1);else if(hs==="Polygon")pu(Es,$s,or,gr,Mr,!0);else if(hs==="MultiPolygon")for(const In of Es){const An=[];pu(In,An,or,gr,Mr,!0),An.length&&$s.push(An)}if($s.length){if(_i.lineMetrics&&hs==="LineString"){for(const In of $s)Vr.push(Io(Jr.id,hs,In,Jr.tags));continue}hs!=="LineString"&&hs!=="MultiLineString"||($s.length===1?(hs="LineString",$s=$s[0]):hs="MultiLineString"),hs!=="Point"&&hs!=="MultiPoint"||(hs=$s.length===3?"Point":"MultiPoint"),Vr.push(Io(Jr.id,hs,$s,Jr.tags))}}return Vr.length?Vr:null}function fu(Hr,Qt,or,gr,Mr){for(let Ir=0;Ir<Hr.length;Ir+=3){const zr=Hr[Ir+Mr];zr>=or&&zr<=gr&&Il(Qt,Hr[Ir],Hr[Ir+1],Hr[Ir+2])}}function ju(Hr,Qt,or,gr,Mr,Ir,zr){let _i=au(Hr);const Vr=Mr===0?Ou:Zu;let Jr,Es,hs=Hr.start;for(let An=0;An<Hr.length-3;An+=3){const Tn=Hr[An],Yn=Hr[An+1],El=Hr[An+2],Bl=Hr[An+3],Rl=Hr[An+4],Hl=Mr===0?Tn:Yn,$a=Mr===0?Bl:Rl;let io=!1;zr&&(Jr=Math.sqrt(Math.pow(Tn-Bl,2)+Math.pow(Yn-Rl,2))),Hl<or?$a>or&&(Es=Vr(_i,Tn,Yn,Bl,Rl,or),zr&&(_i.start=hs+Jr*Es)):Hl>gr?$a<gr&&(Es=Vr(_i,Tn,Yn,Bl,Rl,gr),zr&&(_i.start=hs+Jr*Es)):Il(_i,Tn,Yn,El),$a<or&&Hl>=or&&(Es=Vr(_i,Tn,Yn,Bl,Rl,or),io=!0),$a>gr&&Hl<=gr&&(Es=Vr(_i,Tn,Yn,Bl,Rl,gr),io=!0),!Ir&&io&&(zr&&(_i.end=hs+Jr*Es),Qt.push(_i),_i=au(Hr)),zr&&(hs+=Jr)}let Ws=Hr.length-3;const an=Hr[Ws],$s=Hr[Ws+1],In=Mr===0?an:$s;In>=or&&In<=gr&&Il(_i,an,$s,Hr[Ws+2]),Ws=_i.length-3,Ir&&Ws>=3&&(_i[Ws]!==_i[0]||_i[Ws+1]!==_i[1])&&Il(_i,_i[0],_i[1],_i[2]),_i.length&&Qt.push(_i)}function au(Hr){const Qt=[];return Qt.size=Hr.size,Qt.start=Hr.start,Qt.end=Hr.end,Qt}function pu(Hr,Qt,or,gr,Mr,Ir){for(const zr of Hr)ju(zr,Qt,or,gr,Mr,Ir,!1)}function Il(Hr,Qt,or,gr){Hr.push(Qt,or,gr)}function Ou(Hr,Qt,or,gr,Mr,Ir){const zr=(Ir-Qt)/(gr-Qt);return Il(Hr,Ir,or+(Mr-or)*zr,1),zr}function Zu(Hr,Qt,or,gr,Mr,Ir){const zr=(Ir-or)/(Mr-or);return Il(Hr,Qt+(gr-Qt)*zr,Ir,1),zr}function _o(Hr,Qt){const or=[];for(let gr=0;gr<Hr.length;gr++){const Mr=Hr[gr],Ir=Mr.type;let zr;if(Ir==="Point"||Ir==="MultiPoint"||Ir==="LineString")zr=Ol(Mr.geometry,Qt);else if(Ir==="MultiLineString"||Ir==="Polygon"){zr=[];for(const _i of Mr.geometry)zr.push(Ol(_i,Qt))}else if(Ir==="MultiPolygon"){zr=[];for(const _i of Mr.geometry){const Vr=[];for(const Jr of _i)Vr.push(Ol(Jr,Qt));zr.push(Vr)}}or.push(Io(Mr.id,Ir,zr,Mr.tags))}return or}function Ol(Hr,Qt){const or=[];or.size=Hr.size,Hr.start!==void 0&&(or.start=Hr.start,or.end=Hr.end);for(let gr=0;gr<Hr.length;gr+=3)or.push(Hr[gr]+Qt,Hr[gr+1],Hr[gr+2]);return or}function oo(Hr,Qt){if(Hr.transformed)return Hr;const or=1<<Hr.z,gr=Hr.x,Mr=Hr.y;for(const Ir of Hr.features){const zr=Ir.geometry,_i=Ir.type;if(Ir.geometry=[],_i===1)for(let Vr=0;Vr<zr.length;Vr+=2)Ir.geometry.push(Uo(zr[Vr],zr[Vr+1],Qt,or,gr,Mr));else for(let Vr=0;Vr<zr.length;Vr++){const Jr=[];for(let Es=0;Es<zr[Vr].length;Es+=2)Jr.push(Uo(zr[Vr][Es],zr[Vr][Es+1],Qt,or,gr,Mr));Ir.geometry.push(Jr)}}return Hr.transformed=!0,Hr}function Uo(Hr,Qt,or,gr,Mr,Ir){return[Math.round(or*(Hr*gr-Mr)),Math.round(or*(Qt*gr-Ir))]}function Lo(Hr,Qt,or,gr,Mr){const Ir=Qt===Mr.maxZoom?0:Mr.tolerance/((1<<Qt)*Mr.extent),zr={features:[],numPoints:0,numSimplified:0,numFeatures:Hr.length,source:null,x:or,y:gr,z:Qt,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const _i of Hr)lu(zr,_i,Ir,Mr);return zr}function lu(Hr,Qt,or,gr){const Mr=Qt.geometry,Ir=Qt.type,zr=[];if(Hr.minX=Math.min(Hr.minX,Qt.minX),Hr.minY=Math.min(Hr.minY,Qt.minY),Hr.maxX=Math.max(Hr.maxX,Qt.maxX),Hr.maxY=Math.max(Hr.maxY,Qt.maxY),Ir==="Point"||Ir==="MultiPoint")for(let _i=0;_i<Mr.length;_i+=3)zr.push(Mr[_i],Mr[_i+1]),Hr.numPoints++,Hr.numSimplified++;else if(Ir==="LineString")ps(zr,Mr,Hr,or,!1,!1);else if(Ir==="MultiLineString"||Ir==="Polygon")for(let _i=0;_i<Mr.length;_i++)ps(zr,Mr[_i],Hr,or,Ir==="Polygon",_i===0);else if(Ir==="MultiPolygon")for(let _i=0;_i<Mr.length;_i++){const Vr=Mr[_i];for(let Jr=0;Jr<Vr.length;Jr++)ps(zr,Vr[Jr],Hr,or,!0,Jr===0)}if(zr.length){let _i=Qt.tags||null;if(Ir==="LineString"&&gr.lineMetrics){_i={};for(const Jr in Qt.tags)_i[Jr]=Qt.tags[Jr];_i.mapbox_clip_start=Mr.start/Mr.size,_i.mapbox_clip_end=Mr.end/Mr.size}const Vr={geometry:zr,type:Ir==="Polygon"||Ir==="MultiPolygon"?3:Ir==="LineString"||Ir==="MultiLineString"?2:1,tags:_i};Qt.id!==null&&(Vr.id=Qt.id),Hr.features.push(Vr)}}function ps(Hr,Qt,or,gr,Mr,Ir){const zr=gr*gr;if(gr>0&&Qt.size<(Mr?zr:gr))return void(or.numPoints+=Qt.length/3);const _i=[];for(let Vr=0;Vr<Qt.length;Vr+=3)(gr===0||Qt[Vr+2]>zr)&&(or.numSimplified++,_i.push(Qt[Vr],Qt[Vr+1])),or.numPoints++;Mr&&function(Vr,Jr){let Es=0;for(let hs=0,Ws=Vr.length,an=Ws-2;hs<Ws;an=hs,hs+=2)Es+=(Vr[hs]-Vr[an])*(Vr[hs+1]+Vr[an+1]);if(Es>0===Jr)for(let hs=0,Ws=Vr.length;hs<Ws/2;hs+=2){const an=Vr[hs],$s=Vr[hs+1];Vr[hs]=Vr[Ws-2-hs],Vr[hs+1]=Vr[Ws-1-hs],Vr[Ws-2-hs]=an,Vr[Ws-1-hs]=$s}}(_i,Ir),Hr.push(_i)}const Wl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Bu{constructor(Qt,or){const gr=(or=this.options=function(Ir,zr){for(const _i in zr)Ir[_i]=zr[_i];return Ir}(Object.create(Wl),or)).debug;if(gr&&console.time("preprocess data"),or.maxZoom<0||or.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(or.promoteId&&or.generateId)throw new Error("promoteId and generateId cannot be used together.");let Mr=function(Ir,zr){const _i=[];if(Ir.type==="FeatureCollection")for(let Vr=0;Vr<Ir.features.length;Vr++)Dl(_i,Ir.features[Vr],zr,Vr);else Dl(_i,Ir.type==="Feature"?Ir:{geometry:Ir},zr);return _i}(Qt,or);this.tiles={},this.tileCoords=[],gr&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",or.indexMaxZoom,or.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Mr=function(Ir,zr){const _i=zr.buffer/zr.extent;let Vr=Ir;const Jr=Gl(Ir,1,-1-_i,_i,0,-1,2,zr),Es=Gl(Ir,1,1-_i,2+_i,0,-1,2,zr);return(Jr||Es)&&(Vr=Gl(Ir,1,-_i,1+_i,0,-1,2,zr)||[],Jr&&(Vr=_o(Jr,1).concat(Vr)),Es&&(Vr=Vr.concat(_o(Es,-1)))),Vr}(Mr,or),Mr.length&&this.splitTile(Mr,0,0,0),gr&&(Mr.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Qt,or,gr,Mr,Ir,zr,_i){const Vr=[Qt,or,gr,Mr],Jr=this.options,Es=Jr.debug;for(;Vr.length;){Mr=Vr.pop(),gr=Vr.pop(),or=Vr.pop(),Qt=Vr.pop();const hs=1<<or,Ws=qo(or,gr,Mr);let an=this.tiles[Ws];if(!an&&(Es>1&&console.time("creation"),an=this.tiles[Ws]=Lo(Qt,or,gr,Mr,Jr),this.tileCoords.push({z:or,x:gr,y:Mr}),Es)){Es>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",or,gr,Mr,an.numFeatures,an.numPoints,an.numSimplified),console.timeEnd("creation"));const io=`z${or}`;this.stats[io]=(this.stats[io]||0)+1,this.total++}if(an.source=Qt,Ir==null){if(or===Jr.indexMaxZoom||an.numPoints<=Jr.indexMaxPoints)continue}else{if(or===Jr.maxZoom||or===Ir)continue;if(Ir!=null){const io=Ir-or;if(gr!==zr>>io||Mr!==_i>>io)continue}}if(an.source=null,Qt.length===0)continue;Es>1&&console.time("clipping");const $s=.5*Jr.buffer/Jr.extent,In=.5-$s,An=.5+$s,Tn=1+$s;let Yn=null,El=null,Bl=null,Rl=null,Hl=Gl(Qt,hs,gr-$s,gr+An,0,an.minX,an.maxX,Jr),$a=Gl(Qt,hs,gr+In,gr+Tn,0,an.minX,an.maxX,Jr);Qt=null,Hl&&(Yn=Gl(Hl,hs,Mr-$s,Mr+An,1,an.minY,an.maxY,Jr),El=Gl(Hl,hs,Mr+In,Mr+Tn,1,an.minY,an.maxY,Jr),Hl=null),$a&&(Bl=Gl($a,hs,Mr-$s,Mr+An,1,an.minY,an.maxY,Jr),Rl=Gl($a,hs,Mr+In,Mr+Tn,1,an.minY,an.maxY,Jr),$a=null),Es>1&&console.timeEnd("clipping"),Vr.push(Yn||[],or+1,2*gr,2*Mr),Vr.push(El||[],or+1,2*gr,2*Mr+1),Vr.push(Bl||[],or+1,2*gr+1,2*Mr),Vr.push(Rl||[],or+1,2*gr+1,2*Mr+1)}}getTile(Qt,or,gr){Qt=+Qt,or=+or,gr=+gr;const Mr=this.options,{extent:Ir,debug:zr}=Mr;if(Qt<0||Qt>24)return null;const _i=1<<Qt,Vr=qo(Qt,or=or+_i&_i-1,gr);if(this.tiles[Vr])return oo(this.tiles[Vr],Ir);zr>1&&console.log("drilling down to z%d-%d-%d",Qt,or,gr);let Jr,Es=Qt,hs=or,Ws=gr;for(;!Jr&&Es>0;)Es--,hs>>=1,Ws>>=1,Jr=this.tiles[qo(Es,hs,Ws)];return Jr&&Jr.source?(zr>1&&(console.log("found parent tile z%d-%d-%d",Es,hs,Ws),console.time("drilling down")),this.splitTile(Jr.source,Es,hs,Ws,Qt,or,gr),zr>1&&console.timeEnd("drilling down"),this.tiles[Vr]?oo(this.tiles[Vr],Ir):null):null}}function qo(Hr,Qt,or){return 32*((1<<Hr)*or+Qt)+Hr}function wn(Hr,Qt){const or=Hr.tileID.canonical;if(!this._geoJSONIndex)return void Qt(null,null);const gr=this._geoJSONIndex.getTile(or.z,or.x,or.y);if(!gr)return void Qt(null,null);const Mr=Jr=>Jr.tags&&"3d_elevation_id"in Jr.tags&&"source"in Jr.tags&&Jr.tags.source==="elevation",Ir=gr.features.filter(Jr=>Mr(Jr));let zr={_geojsonTileLayer:gr.features};Ir.length>0&&(zr={_geojsonTileLayer:gr.features.filter(Jr=>!Mr(Jr)),hd_road_elevation:Ir});const _i=new Ms(zr),Vr=function(Jr){const Es=new c.bt;for(const hs of Object.keys(Jr))Es.writeMessage(3,yn,{name:hs,features:Jr[hs]});return Es.finish()}(zr).buffer;Qt(null,{vectorTile:_i,rawData:Vr})}class Nl extends dr{constructor(Qt,or,gr,Mr,Ir,zr,_i){super(Qt,or,gr,Mr,Ir,wn,_i),zr&&(this.loadGeoJSON=zr),this._dynamicIndex=new jr}loadData(Qt,or){const gr=Qt&&Qt.request,Mr=gr&&gr.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(Qt,(Ir,zr)=>{if(Ir||!zr)return or(Ir);if(typeof zr!="object")return or(new Error(`Input data given to '${Qt.source}' is not a valid GeoJSON object.`));{try{if(Qt.filter){const Vr=c.U(Qt.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Vr.result==="error")throw new Error(Vr.value.map(Jr=>`${Jr.key}: ${Jr.message}`).join(", "));zr.features=zr.features.filter(Jr=>Vr.value.evaluate({zoom:0},Jr))}Qt.dynamic?(zr.type==="Feature"&&(zr={type:"FeatureCollection",features:[zr]}),Qt.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(zr.features,this.loaded),Qt.cluster&&(zr.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=Qt.cluster?new Ro(function({superclusterOptions:Vr,clusterProperties:Jr}){if(!Jr||!Vr)return Vr;const Es={},hs={},Ws={accumulated:null,zoom:0},an={properties:null},$s=Object.keys(Jr);for(const In of $s){const[An,Tn]=Jr[In],Yn=c.U(Tn),El=c.U(typeof An=="string"?[An,["accumulated"],["get",In]]:An);Es[In]=Yn.value,hs[In]=El.value}return Vr.map=In=>{an.properties=In;const An={};for(const Tn of $s)An[Tn]=Es[Tn].evaluate(Ws,an);return An},Vr.reduce=(In,An)=>{an.properties=An;for(const Tn of $s)Ws.accumulated=In[Tn],In[Tn]=hs[Tn].evaluate(Ws,an)},Vr}(Qt)).load(zr.features):Qt.dynamic?this._dynamicIndex:function(Vr,Jr){return new Bu(Vr,Jr)}(zr,Qt.geojsonVtOptions)}catch(Vr){return or(Vr)}const _i={};if(Mr){const Vr=pt(gr);Vr&&(_i.resourceTiming={},_i.resourceTiming[Qt.source]=JSON.parse(JSON.stringify(Vr)))}or(null,_i)}})}reloadTile(Qt,or){const gr=this.loaded;return gr&&gr[Qt.uid]?Qt.partial?or(null,void 0):super.reloadTile(Qt,or):this.loadTile(Qt,or)}loadGeoJSON(Qt,or){if(Qt.request)c.m(Qt.request,or);else{if(typeof Qt.data!="string")return or(new Error(`Input data given to '${Qt.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return or(null,JSON.parse(Qt.data))}catch{return or(new Error(`Input data given to '${Qt.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(Qt,or){try{or(null,this._geoJSONIndex.getClusterExpansionZoom(Qt.clusterId))}catch(gr){or(gr)}}getClusterChildren(Qt,or){try{or(null,this._geoJSONIndex.getChildren(Qt.clusterId))}catch(gr){or(gr)}}getClusterLeaves(Qt,or){try{or(null,this._geoJSONIndex.getLeaves(Qt.clusterId,Qt.limit,Qt.offset))}catch(gr){or(gr)}}}class vp{constructor(Qt,or,gr){this.tileID=new c.aQ(Qt.tileID.overscaledZ,Qt.tileID.wrap,Qt.tileID.canonical.z,Qt.tileID.canonical.x,Qt.tileID.canonical.y),this.tileZoom=Qt.tileZoom,this.uid=Qt.uid,this.zoom=Qt.zoom,this.canonical=Qt.tileID.canonical,this.pixelRatio=Qt.pixelRatio,this.tileSize=Qt.tileSize,this.source=Qt.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=Qt.projection,this.brightness=or,this.worldview=gr}parse(Qt,or,gr,Mr){this.status="parsing";const Ir=new c.aQ(gr.tileID.overscaledZ,gr.tileID.wrap,gr.tileID.canonical.z,gr.tileID.canonical.x,gr.tileID.canonical.y),zr=[],_i=or.familiesBySource[gr.source],Vr=new c.fn(Ir,gr.promoteId);Vr.bucketLayerIDs=[],Vr.is3DTile=!0,c.fC(Qt).then(Jr=>{if(!Jr)return Mr(new Error("Could not parse tile"));const Es=Jr.json.extensionsUsed&&Jr.json.extensionsUsed.includes("MAPBOX_mesh_features")||Jr.json.asset.extras&&Jr.json.asset.extras.MAPBOX_mesh_features,hs=Jr.json.extensionsUsed&&Jr.json.extensionsUsed.includes("EXT_meshopt_compression"),Ws=new c.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const an in _i)for(const $s of _i[an]){const In=$s[0];Vr.bucketLayerIDs.push($s.map(Yn=>c.B(Yn.id,Yn.scope))),In.recalculate(Ws,[]);const An=c.fD(Jr,1/c.d7(gr.tileID.canonical)),Tn=new c.fE($s,An,Ir,Es,hs,this.brightness,Vr,this.worldview);Es||(Tn.needsUpload=!0),zr.push(Tn),Tn.evaluate(In)}this.status="done",Mr(null,{buckets:zr,featureIndex:Vr,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Jr=>Mr(new Error(Jr.message)))}}class cu{constructor(Qt,or,gr,Mr,Ir,zr,_i,Vr){this.actor=Qt,this.layerIndex=or,this.availableImages=gr,this.availableModels=Mr,this.brightness=_i,this.loading={},this.loaded={},this.worldview=Vr}loadTile(Qt,or){const gr=Qt.uid,Mr=this.loading[gr]=new vp(Qt,this.brightness,this.worldview);c.bu(Qt.request,(Ir,zr)=>{const _i=!this.loading[gr];return delete this.loading[gr],_i||Ir?(Mr.status="done",_i||(this.loaded[gr]=Mr),or(Ir)):zr&&zr.byteLength!==0?void Mr.parse(zr,this.layerIndex,Qt,(Vr,Jr)=>{Mr.status="done",this.loaded=this.loaded||{},this.loaded[gr]=Mr,Vr||!Jr?or(Vr):or(null,Jr)}):(Mr.status="done",this.loaded[gr]=Mr,or())})}reloadTile(Qt,or){const gr=this.loaded,Mr=Qt.uid;if(gr&&gr[Mr]){const Ir=gr[Mr];Ir.projection=Qt.projection,Ir.brightness=Qt.brightness;const zr=(_i,Vr)=>{Ir.reloadCallback&&(delete Ir.reloadCallback,this.loadTile(Qt,or)),or(_i,Vr)};Ir.status==="parsing"?Ir.reloadCallback=zr:Ir.status==="done"&&this.loadTile(Qt,or)}}abortTile(Qt,or){const gr=Qt.uid;this.loading[gr]&&delete this.loading[gr],or()}removeTile(Qt,or){const gr=this.loaded,Mr=Qt.uid;gr&&gr[Mr]&&delete gr[Mr],or()}}class bp{constructor(Qt){this.self=Qt,this.actor=new c.fG(Qt,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new c.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=c.cm({name:"mercator"}),this.workerSourceTypes={vector:dr,geojson:Nl,"raster-dem":mr,"raster-array":Dr,"batched-model":cu},this.workerSources={},this.self.registerWorkerSource=(or,gr)=>{if(this.workerSourceTypes[or])throw new Error(`Worker source with name "${or}" already registered.`);this.workerSourceTypes[or]=gr},this.self.registerRTLTextPlugin=or=>{if(c.fH.isParsed())throw new Error("RTL text plugin already registered.");c.fH.setState({pluginStatus:c.fI.parsed,pluginURL:c.fH.getPluginURL()}),c.fH.applyArabicShaping=or.applyArabicShaping,c.fH.processBidirectionalText=or.processBidirectionalText,c.fH.processStyledBidirectionalText=or.processStyledBidirectionalText;for(const gr of this.rtlPluginParsingListeners)gr(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(Qt,or,gr){delete this.layerIndexes[Qt],delete this.availableImages[Qt],delete this.availableModels[Qt],delete this.workerSources[Qt],gr()}checkIfReady(Qt,or,gr){gr()}setReferrer(Qt,or){this.referrer=or}spriteLoaded(Qt,or){this.isSpriteLoaded[Qt]||(this.isSpriteLoaded[Qt]={});const{scope:gr,isLoaded:Mr}=or;if(this.isSpriteLoaded[Qt][gr]=Mr,this.workerSources[Qt]&&this.workerSources[Qt][gr])for(const Ir in this.workerSources[Qt][gr]){const zr=this.workerSources[Qt][gr][Ir];for(const _i in zr){const Vr=zr[_i];Vr instanceof dr&&(Vr.isSpriteLoaded=Mr,Vr.fire(new c.z("isSpriteLoaded")))}}}setImages(Qt,or,gr){this.availableImages[Qt]||(this.availableImages[Qt]={});const{scope:Mr,images:Ir}=or;if(this.availableImages[Qt][Mr]=Ir,this.workerSources[Qt]&&this.workerSources[Qt][Mr]){for(const zr in this.workerSources[Qt][Mr]){const _i=this.workerSources[Qt][Mr][zr];for(const Vr in _i)_i[Vr].availableImages=Ir}gr()}else gr()}setModels(Qt,{scope:or,models:gr},Mr){if(this.availableModels[Qt]||(this.availableModels[Qt]={}),this.availableModels[Qt][or]=gr,this.workerSources[Qt]&&this.workerSources[Qt][or]){for(const Ir in this.workerSources[Qt][or]){const zr=this.workerSources[Qt][or][Ir];for(const _i in zr)zr[_i].availableModels=gr}Mr()}else Mr()}setProjection(Qt,or){this.projections[Qt]=c.cm(or)}setBrightness(Qt,or,gr){this.brightness=or,gr()}setWorldview(Qt,or,gr){this.worldview=or,gr()}setLayers(Qt,or,gr){this.getLayerIndex(Qt,or.scope).replace(or.layers,or.options),gr()}updateLayers(Qt,or,gr){this.getLayerIndex(Qt,or.scope).update(or.layers,or.removedIds,or.options),gr()}loadTile(Qt,or,gr){or.projection=this.projections[Qt]||this.defaultProjection,this.getWorkerSource(Qt,or.type,or.source,or.scope).loadTile(or,gr)}decodeRasterArray(Qt,or,gr){this.getWorkerSource(Qt,or.type,or.source,or.scope).decodeRasterArray(or,gr)}reloadTile(Qt,or,gr){or.projection=this.projections[Qt]||this.defaultProjection,this.getWorkerSource(Qt,or.type,or.source,or.scope).reloadTile(or,gr)}abortTile(Qt,or,gr){this.getWorkerSource(Qt,or.type,or.source,or.scope).abortTile(or,gr)}removeTile(Qt,or,gr){this.getWorkerSource(Qt,or.type,or.source,or.scope).removeTile(or,gr)}removeSource(Qt,or,gr){if(!(this.workerSources[Qt]&&this.workerSources[Qt][or.scope]&&this.workerSources[Qt][or.scope][or.type]&&this.workerSources[Qt][or.scope][or.type][or.source]))return;const Mr=this.workerSources[Qt][or.scope][or.type][or.source];delete this.workerSources[Qt][or.scope][or.type][or.source],Mr.removeSource!==void 0?Mr.removeSource(or,gr):gr()}loadWorkerSource(Qt,or,gr){try{this.self.importScripts(or.url),gr()}catch(Mr){gr(Mr)}}syncRTLPluginState(Qt,or,gr){if(c.fH.isParsed())gr(null,!0);else if(c.fH.isParsing())this.rtlPluginParsingListeners.push(gr);else try{c.fH.setState(or);const Mr=c.fH.getPluginURL();!c.fH.isLoaded()||c.fH.isParsed()||c.fH.isParsing()||Mr==null||(c.fH.setState({pluginStatus:c.fI.parsing,pluginURL:c.fH.getPluginURL()}),this.self.importScripts(Mr),c.fH.isParsed()?gr(null,!0):this.rtlPluginParsingListeners.push(gr))}catch(Mr){gr(Mr)}}setDracoUrl(Qt,or){this.dracoUrl=or}getAvailableImages(Qt,or){this.availableImages[Qt]||(this.availableImages[Qt]={});let gr=this.availableImages[Qt][or];return gr||(gr=[]),gr}getAvailableModels(Qt,or){this.availableModels[Qt]||(this.availableModels[Qt]={});let gr=this.availableModels[Qt][or];return gr||(gr={}),gr}getLayerIndex(Qt,or){this.layerIndexes[Qt]||(this.layerIndexes[Qt]={});let gr=this.layerIndexes[Qt][or];return gr||(gr=this.layerIndexes[Qt][or]=new kt,gr.scope=or),gr}getWorkerSource(Qt,or,gr,Mr){const Ir=this.workerSources;return Ir[Qt]||(Ir[Qt]={}),Ir[Qt][Mr]||(Ir[Qt][Mr]={}),Ir[Qt][Mr][or]||(Ir[Qt][Mr][or]={}),this.isSpriteLoaded[Qt]||(this.isSpriteLoaded[Qt]={}),Ir[Qt][Mr][or][gr]||(Ir[Qt][Mr][or][gr]=new this.workerSourceTypes[or]({send:(zr,_i,Vr,Jr,Es,hs)=>this.actor.send(zr,_i,Vr,Qt,Es,hs),scheduler:this.actor.scheduler},this.getLayerIndex(Qt,Mr),this.getAvailableImages(Qt,Mr),this.getAvailableModels(Qt,Mr),this.isSpriteLoaded[Qt][Mr],void 0,this.brightness,this.worldview)),Ir[Qt][Mr][or][gr]}rasterizeImagesWorker(Qt,or,gr){const Mr=new Map;for(const[Ir,{image:zr,imageVariant:_i}]of or.tasks.entries()){const Vr=this.imageRasterizer.rasterize(_i,zr,or.scope,Qt);Mr.set(Ir,Vr)}gr(void 0,Mr)}removeRasterizedImages(Qt,or,gr){this.imageRasterizer.removeImagesFromCacheByIds(or.imageIds,or.scope,Qt),gr()}enforceCacheSizeLimit(Qt,or){c.fJ(or)}getWorkerPerformanceMetrics(Qt,or,gr){gr(void 0,void 0)}}return c.fF(self)&&(self.worker=new bp(self)),bp}),nt(["./shared"],function(c){var pt="3.17.0";const gt={create:"create",load:"load",fullLoad:"fullLoad"},St={mark(et){performance.mark(et)},measure(et,o,_){performance.measure(et,o,_)}};function kt(et){const o=et.name.split("?")[0];return c.a(o)&&o.includes("mapbox-gl.js")?"javascript":c.a(o)&&o.includes("mapbox-gl.css")?"css":c.b(o)?"fontRange":c.c(o)?"sprite":c.i(o)?"style":c.d(o)?"tilejson":"other"}var At,Nt={},Vt=function(){if(At)return Nt;function et(rt){return!o(rt)}function o(rt){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var lt,ut,dt=new Blob([""],{type:"text/javascript"}),mt=URL.createObjectURL(dt);try{ut=new Worker(mt),lt=!0}catch{lt=!1}return ut&&ut.terminate(),URL.revokeObjectURL(mt),lt}()?function(){var lt=document.createElement("canvas");lt.width=lt.height=1;var ut=lt.getContext("2d");if(!ut)return!1;var dt=ut.getImageData(0,0,1,1);return dt&&dt.width===lt.width}()?(_[ot=rt&&rt.failIfMajorPerformanceCaveat]===void 0&&(_[ot]=function(lt){var ut,dt=function(mt){var Tt=document.createElement("canvas"),Ct=Object.create(et.webGLContextAttributes);return Ct.failIfMajorPerformanceCaveat=mt,Tt.getContext("webgl2",Ct)}(lt);if(!dt)return!1;try{ut=dt.createShader(dt.VERTEX_SHADER)}catch{return!1}return!(!ut||dt.isContextLost())&&(dt.shaderSource(ut,"void main() {}"),dt.compileShader(ut),dt.getShaderParameter(ut,dt.COMPILE_STATUS)===!0)}(ot)),_[ot]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var ot}At=1,Nt.supported=et,Nt.notSupportedReason=o;var _={};return et.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Nt}();function zt(et,o,_){const rt=document.createElement(et);return o!=null&&(rt.className=o),_&&_.appendChild(rt),rt}function Jt(et,o,_){const rt=document.createElementNS("http://www.w3.org/2000/svg",et);for(const ot of Object.keys(o))rt.setAttributeNS(null,ot,String(o[ot]));return _&&_.appendChild(rt),rt}const Dt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,It=Dt&&Dt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Mt;function Ht(){Dt&&It&&(Mt=Dt[It],Dt[It]="none")}function tr(){Dt&&It&&(Dt[It]=Mt)}function er(et){et.preventDefault(),et.stopPropagation(),window.removeEventListener("click",er,!0)}function dr(){window.addEventListener("click",er,!0),window.setTimeout(()=>{window.removeEventListener("click",er,!0)},0)}function mr(et,o){const _=et.getBoundingClientRect();return Yr(et,_,o)}function Ur(et,o){const _=et.getBoundingClientRect(),rt=[];for(let ot=0;ot<o.length;ot++)rt.push(Yr(et,_,o[ot]));return rt}function Dr(et){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&et.button===2&&et.ctrlKey?0:et.button}function Yr(et,o,_){const rt=et.offsetWidth===o.width?1:et.offsetWidth/o.width;return new c.P((_.clientX-o.left)*rt,(_.clientY-o.top)*rt)}const es="01",ms="NO_ACCESS_TOKEN";class Ms{constructor(o,_,rt){this._transformRequestFn=o,this._customAccessToken=_,this._silenceAuthErrors=!!rt,this._createSkuToken()}_createSkuToken(){const o=function(){let _="";for(let rt=0;rt<10;rt++)_+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",es,_].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,_){return this._transformRequestFn&&this._transformRequestFn(o,_)||{url:o}}normalizeStyleURL(o,_){if(!c.h(o))return o;const rt=xr(o);return rt.params.push(`sdk=js-${pt}`),rt.path=`/styles/v1${rt.path}`,this._makeAPIURL(rt,this._customAccessToken||_)}normalizeGlyphsURL(o,_){if(!c.h(o))return o;const rt=xr(o);return rt.path=`/fonts/v1${rt.path}`,this._makeAPIURL(rt,this._customAccessToken||_)}normalizeModelURL(o,_){if(!c.h(o))return o;const rt=xr(o);return rt.path=`/models/v1${rt.path}`,this._makeAPIURL(rt,this._customAccessToken||_)}normalizeSourceURL(o,_,rt,ot){if(!c.h(o))return o;const lt=xr(o);return lt.path=`/v4/${lt.authority}.json`,lt.params.push("secure"),rt&&lt.params.push(`language=${rt}`),ot&&lt.params.push(`worldview=${ot}`),this._makeAPIURL(lt,this._customAccessToken||_)}normalizeIconsetURL(o,_){const rt=xr(o);return c.h(o)?(rt.path=`/styles/v1${rt.path}/iconset.pbf`,this._makeAPIURL(rt,this._customAccessToken||_)):jr(rt)}normalizeSpriteURL(o,_,rt,ot){const lt=xr(o);return c.h(o)?(lt.path=`/styles/v1${lt.path}/sprite${_}${rt}`,this._makeAPIURL(lt,this._customAccessToken||ot)):(lt.path+=`${_}${rt}`,jr(lt))}normalizeTileURL(o,_,rt){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!c.h(o))return o;const ot=xr(o);ot.path=ot.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${_||rt&&ot.authority!=="raster"&&rt===512?"@2x":""}${c.k.supported?".webp":"$1"}`),ot.authority==="raster"?ot.path=`/${c.e.RASTER_URL_PREFIX}${ot.path}`:ot.authority==="rasterarrays"?ot.path=`/${c.e.RASTERARRAYS_URL_PREFIX}${ot.path}`:ot.authority==="3dtiles"?ot.path=`/${c.e.TILES3D_URL_PREFIX}${ot.path}`:(ot.path=ot.path.replace(/^.+\/v4\//,"/"),ot.path=`/${c.e.TILE_URL_VERSION}${ot.path}`);const lt=this._customAccessToken||function(ut){for(const dt of ut){const mt=dt.match(/^access_token=(.*)$/);if(mt)return mt[1]}return null}(ot.params)||c.e.ACCESS_TOKEN;return c.e.REQUIRE_ACCESS_TOKEN&&lt&&this._skuToken&&ot.params.push(`sku=${this._skuToken}`),this._makeAPIURL(ot,lt)}canonicalizeTileURL(o,_){const rt=xr(o);if(!rt.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!rt.path.match(/\.[\w]+$/))return o;let ot="mapbox://";rt.path.match(/^\/raster\/v1\//)?ot+=`raster/${rt.path.replace(`/${c.e.RASTER_URL_PREFIX}/`,"")}`:rt.path.match(/^\/rasterarrays\/v1\//)?ot+=`rasterarrays/${rt.path.replace(`/${c.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:ot+=`tiles/${rt.path.replace(`/${c.e.TILE_URL_VERSION}/`,"")}`;let lt=rt.params;return _&&(lt=lt.filter(ut=>!ut.match(/^access_token=/))),lt.length&&(ot+=`?${lt.join("&")}`),ot}canonicalizeTileset(o,_){const rt=!!_&&c.h(_),ot=[];for(const lt of o.tiles||[])c.j(lt)?ot.push(this.canonicalizeTileURL(lt,rt)):ot.push(lt);return ot}_makeAPIURL(o,_){const rt="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",ot=xr(c.e.API_URL);if(o.protocol=ot.protocol,o.authority=ot.authority,o.protocol==="http"){const lt=o.params.indexOf("secure");lt>=0&&o.params.splice(lt,1)}if(ot.path!=="/"&&(o.path=`${ot.path}${o.path}`),!c.e.REQUIRE_ACCESS_TOKEN)return jr(o);if(_=_||c.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!_)throw new Error(`An API access token is required to use Mapbox GL. ${rt}`);if(_[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${rt}`)}return o.params=o.params.filter(lt=>lt.indexOf("access_token")===-1),o.params.push(`access_token=${_||""}`),jr(o)}}const Kr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function xr(et){const o=et.match(Kr);if(!o)throw new Error("Unable to parse URL object");return{protocol:o[1],authority:o[2],path:o[3]||"/",params:o[4]?o[4].split("&"):[]}}function jr(et){const o=et.params.length?`?${et.params.join("&")}`:"";return`${et.protocol}://${et.authority}${et.path}${o}`}const rr="mapbox.eventData";function ar(et){if(!et)return null;const o=et.split(".");if(!o||o.length!==3)return null;try{return JSON.parse(c.l(o[1]))}catch{return null}}class $r{constructor(o){this.type=o,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(o){const _=ar(c.e.ACCESS_TOKEN);let rt="";return rt=_&&_.u?c.f(_.u):c.e.ACCESS_TOKEN||"",o?`${rr}.${o}:${rt}`:`${rr}:${rt}`}fetchEventData(){const o=c.s("localStorage"),_=this.getStorageKey(),rt=this.getStorageKey("uuid"),ot=this.getStorageKey("uuidTimestamp");if(o)try{const lt=localStorage.getItem(_);lt&&(this.eventData=JSON.parse(lt));const ut=localStorage.getItem(rt);ut&&(this.anonId=ut);const dt=localStorage.getItem(ot);dt&&(this.anonIdTimestamp=Number(dt));const mt=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<mt)&&this.refreshUUID()}catch{c.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=c.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const o=c.s("localStorage"),_=this.getStorageKey(),rt=this.getStorageKey("uuid"),ot=this.getStorageKey("uuidTimestamp"),lt=this.anonId,ut=this.anonIdTimestamp;if(o&&lt)try{localStorage.setItem(rt,lt),Object.keys(this.eventData).length>=1&&localStorage.setItem(_,JSON.stringify(this.eventData)),ut&&localStorage.setItem(ot,ut.toString())}catch{c.w("Unable to write to LocalStorage")}}processRequests(o){}postEvent(o,_,rt,ot){if(!c.e.EVENTS_URL)return;const lt=xr(c.e.EVENTS_URL);lt.params.push(`access_token=${ot||c.e.ACCESS_TOKEN||""}`);const ut={event:this.type,created:new Date(o).toISOString()},dt=_?Object.assign(ut,_):ut,mt={url:jr(lt),headers:{"Content-Type":"text/plain"},body:JSON.stringify([dt])};this.pendingRequest=c.p(mt,Tt=>{this.pendingRequest=null,rt(Tt),this.saveEventData(),this.processRequests(ot)})}queueRequest(o,_){this.queue.push(o),this.processRequests(_)}}class Ar extends $r{constructor(o){super("metrics"),o&&(this.data=o)}postMetricsEvent(o){if(!c.e.EVENTS_URL||!o&&!c.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID();const _=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:_},o)}processRequests(o){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:_,payload:rt}=this.queue.shift();this.postEvent(_,rt,()=>{},o)}}const Xr=new class extends $r{constructor(et){super("appUserTurnstile"),this._customAccessToken=et}postTurnstileEvent(et,o){c.e.EVENTS_URL&&c.e.ACCESS_TOKEN&&Array.isArray(et)&&et.some(_=>c.h(_)||c.j(_))&&this.queueRequest(Date.now(),o)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const o=ar(c.e.ACCESS_TOKEN),_=o?o.u:c.e.ACCESS_TOKEN;let rt=_!==this.eventData.tokenU;c.v(this.anonId)||(this.refreshUUID(),rt=!0);const ot=this.queue.shift();if(this.eventData.lastSuccess){const lt=new Date(this.eventData.lastSuccess),ut=new Date(ot),dt=(ot-this.eventData.lastSuccess)/864e5;rt=rt||dt>=1||dt<-1||lt.getDate()!==ut.getDate()}else rt=!0;rt?this.postEvent(ot,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pt,skuId:es,"enabled.telemetry":!1,userId:this.anonId},lt=>{lt||(this.eventData.lastSuccess=ot,this.eventData.tokenU=_)},et):this.processRequests()}},us=Xr.postTurnstileEvent.bind(Xr),Wr=new class extends $r{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(et,o,_,rt){this.skuToken=o,this.errorCb=rt,c.e.EVENTS_URL&&(_||c.e.ACCESS_TOKEN?this.queueRequest({id:et,timestamp:Date.now()},_):this.errorCb(new Error(ms)))}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:_}=this.queue.shift();o&&this.success[o]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),c.v(this.anonId)||this.refreshUUID(),this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:pt,skuId:es,skuToken:this.skuToken,userId:this.anonId},rt=>{rt?this.errorCb(rt):o&&(this.success[o]=!0)},et))}remove(){this.errorCb=null}},Vs=Wr.postMapLoadEvent.bind(Wr),yn=new class extends $r{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(et){let o=this.mapInstanceIdMap.get(et);return o||(o=c.u(),this.mapInstanceIdMap.set(et,o)),o}getEventId(et){const o=this.eventIdPerMapInstanceMap.get(et)||0;return this.eventIdPerMapInstanceMap.set(et,o+1),o}postStyleLoadEvent(et,o){const{map:_,style:rt,importedStyles:ot}=o;if(!c.e.EVENTS_URL||!et&&!c.e.ACCESS_TOKEN)return;const lt=this.getMapInstanceId(_),ut={mapInstanceId:lt,eventId:this.getEventId(lt),style:rt};ot.length&&(ut.importedStyles=ot),this.queueRequest({timestamp:Date.now(),payload:ut},et)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,payload:_}=this.queue.shift();this.postEvent(o,_,()=>{},et)}},_n=yn.postStyleLoadEvent.bind(yn),zo=new Ar({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Cn=zo.postMetricsEvent.bind(zo),On=new Ar({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),qr=On.postMetricsEvent.bind(On),Zs=new class extends $r{constructor(){super("gljs.performance")}postPerformanceEvent(et,o){c.e.EVENTS_URL&&(et||c.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:o},et)}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:o,performanceData:_}=this.queue.shift(),rt=function(ot){const lt=performance.getEntriesByType("resource"),ut=performance.getEntriesByType("mark"),dt=function($t){const Zt={};if($t){for(const qt in $t)if(qt!=="other")for(const sr of $t[qt]){const ir=`${qt}ResolveRangeMin`,cr=`${qt}ResolveRangeMax`,pr=`${qt}RequestCount`,ur=`${qt}RequestCachedCount`;Zt[ir]=Math.min(Zt[ir]||1/0,sr.startTime),Zt[cr]=Math.max(Zt[cr]||-1/0,sr.responseEnd);const Cr=wr=>{Zt[wr]===void 0&&(Zt[wr]=0),++Zt[wr]};sr.transferSize!==void 0&&sr.transferSize===0&&Cr(ur),Cr(pr)}}return Zt}(function($t,Zt){const qt={};if($t)for(const sr of $t){const ir=Zt(sr);qt[ir]===void 0&&(qt[ir]=[]),qt[ir].push(sr)}return qt}(lt,kt)),mt=window.devicePixelRatio,Tt=navigator.connection||navigator.mozConnection||navigator.webkitConnection,Ct=Tt?Tt.effectiveType:void 0,Ut={counters:[],metadata:[],attributes:[]},Bt=($t,Zt,qt)=>{qt!=null&&$t.push({name:Zt,value:qt.toString()})};for(const $t in dt)Bt(Ut.counters,$t,dt[$t]);if(ot.interactionRange[0]!==1/0&&ot.interactionRange[1]!==-1/0&&(Bt(Ut.counters,"interactionRangeMin",ot.interactionRange[0]),Bt(Ut.counters,"interactionRangeMax",ot.interactionRange[1])),ut)for(const $t of Object.values(gt)){const Zt=ut.find(qt=>qt.name===$t);Zt&&Bt(Ut.counters,$t,Zt.startTime)}return Bt(Ut.counters,"visibilityHidden",ot.visibilityHidden),Bt(Ut.attributes,"style",function($t){if($t)for(const Zt of $t){const qt=Zt.name.split("?")[0];if(c.i(qt)){const sr=qt.split("/").slice(-2);if(sr.length===2)return`mapbox://styles/${sr[0]}/${sr[1]}`}}}(lt)),Bt(Ut.attributes,"terrainEnabled",ot.terrainEnabled?"true":"false"),Bt(Ut.attributes,"fogEnabled",ot.fogEnabled?"true":"false"),Bt(Ut.attributes,"projection",ot.projection),Bt(Ut.attributes,"zoom",ot.zoom),Bt(Ut.metadata,"devicePixelRatio",mt),Bt(Ut.metadata,"connectionEffectiveType",Ct),Bt(Ut.metadata,"navigatorUserAgent",navigator.userAgent),Bt(Ut.metadata,"screenWidth",window.screen.width),Bt(Ut.metadata,"screenHeight",window.screen.height),Bt(Ut.metadata,"windowWidth",window.innerWidth),Bt(Ut.metadata,"windowHeight",window.innerHeight),Bt(Ut.metadata,"mapWidth",ot.width/mt),Bt(Ut.metadata,"mapHeight",ot.height/mt),Bt(Ut.metadata,"webglRenderer",ot.renderer),Bt(Ut.metadata,"webglVendor",ot.vendor),Bt(Ut.metadata,"sdkVersion",pt),Bt(Ut.metadata,"sdkIdentifier","mapbox-gl-js"),Ut}(_);for(const ot of rt.metadata);for(const ot of rt.counters);for(const ot of rt.attributes);this.postEvent(o,rt,()=>{},et)}},Os=Zs.postPerformanceEvent.bind(Zs),Us=new class extends $r{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(et,o,_,rt){if(!c.e.API_URL||!c.e.SESSION_PATH)return;const ot=xr(c.e.API_URL+c.e.SESSION_PATH);ot.params.push(`sku=${o||""}`),ot.params.push(`access_token=${rt||c.e.ACCESS_TOKEN||""}`);const lt={url:jr(ot),headers:{"Content-Type":"text/plain"}};this.pendingRequest=c.g(lt,ut=>{this.pendingRequest=null,_(ut),this.saveEventData(),this.processRequests(rt)})}getSessionAPI(et,o,_,rt){this.skuToken=o,this.errorCb=rt,c.e.SESSION_PATH&&c.e.API_URL&&(_||c.e.ACCESS_TOKEN?this.queueRequest({id:et,timestamp:Date.now()},_):this.errorCb(new Error(ms)))}processRequests(et){if(this.pendingRequest||this.queue.length===0)return;const{id:o,timestamp:_}=this.queue.shift();o&&this.success[o]||this.getSession(_,this.skuToken,rt=>{rt?this.errorCb(rt):o&&(this.success[o]=!0)},et)}remove(){this.errorCb=null}},Nn=Us.getSessionAPI.bind(Us),cn=new Set;function Bn(et,o){o?cn.add(et):cn.delete(et)}class Pn{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(o,_){this._updatedSourceCaches[o]=_,this.setDirty()}discardSourceCacheUpdate(o){delete this._updatedSourceCaches[o]}updateLayer(o){const _=o.scope;this._updatedLayers[_]=this._updatedLayers[_]||new Set,this._updatedLayers[_].add(o.id),this.setDirty()}removeLayer(o){const _=o.scope;this._removedLayers[_]=this._removedLayers[_]||{},this._updatedLayers[_]=this._updatedLayers[_]||new Set,this._removedLayers[_][o.id]=o,this._updatedLayers[_].delete(o.id),this._updatedPaintProps.delete(o.fqid),this.setDirty()}getRemovedLayer(o){return this._removedLayers[o.scope]?this._removedLayers[o.scope][o.id]:null}discardLayerRemoval(o){this._removedLayers[o.scope]&&delete this._removedLayers[o.scope][o.id]}getLayerUpdatesByScope(){const o={};for(const _ in this._updatedLayers)o[_]=o[_]||{},o[_].updatedIds=Array.from(this._updatedLayers[_].values());for(const _ in this._removedLayers)o[_]=o[_]||{},o[_].removedIds=Object.keys(this._removedLayers[_]);return o}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(o){this._updatedPaintProps.add(o.fqid),this.setDirty()}getUpdatedImages(o){return this._updatedImages[o]?Array.from(this._updatedImages[o].values()):[]}updateImage(o,_){this._updatedImages[_]=this._updatedImages[_]||new Set,this._updatedImages[_].add(c.I.toString(o)),this.setDirty()}resetUpdatedImages(o){this._updatedImages[o]&&this._updatedImages[o].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ro(et){const{userImage:o}=et;return!!(o&&o.render&&o.render())&&(et.data.replace(new Uint8Array(o.data.buffer)),!0)}class Ho extends c.E{constructor(o){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=o,o!=="raster"&&c.r()&&(this.imageRasterizerDispatcher=new c.D(c.t(),this,"Image Rasterizer Worker",1))}addScope(o){this.loaded.set(o,!1),this.imageProviders.set(o,new Map),this.images.set(o,new Map),this.updatedImages.set(o,new Set),this.callbackDispatchedThisFrame.set(o,new Set),this.patterns.set(o,new Map),this.atlasImage.set(o,new c.q({width:1,height:1}))}removeScope(o){this.loaded.delete(o),this.imageProviders.delete(o),this.images.delete(o),this.updatedImages.delete(o),this.callbackDispatchedThisFrame.delete(o),this.patterns.delete(o),this.atlasImage.delete(o);const _=this.atlasTexture.get(o);_&&(_.destroy(),this.atlasTexture.delete(o))}addImageProvider(o,_){this.imageProviders.has(_)||this.imageProviders.set(_,new Map),this.imageProviders.get(_).set(o.id,o)}removeImageProvider(o,_){this.imageProviders.has(_)&&this.imageProviders.get(_).delete(o)}getPendingImageProviders(){const o=[];for(const _ of this.imageProviders.values())for(const rt of _.values())rt.hasPendingRequests()&&o.push(rt);return o}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new c.x),this._imageRasterizer}isLoaded(){for(const o of this.loaded.keys())if(!this.loaded.get(o))return!1;return!0}setLoaded(o,_){if(this.loaded.get(_)!==o&&(this.loaded.set(_,o),o)){for(const{ids:rt,callback:ot}of this.requestors)this._notify(rt,_,ot);this.requestors=[]}}hasImage(o,_){return!!this.getImage(o,_)}getImage(o,_){return this.images.get(_).get(o.toString())}addImage(o,_,rt){this._validate(o,rt)&&this.images.get(_).set(o.toString(),rt)}_validate(o,_){let rt=!0;return this._validateStretch(_.stretchX,_.data&&_.data.width)||(this.fire(new c.y(new Error(`Image "${o.name}" has invalid "stretchX" value`))),rt=!1),this._validateStretch(_.stretchY,_.data&&_.data.height)||(this.fire(new c.y(new Error(`Image "${o.name}" has invalid "stretchY" value`))),rt=!1),this._validateContent(_.content,_)||(this.fire(new c.y(new Error(`Image "${o.name}" has invalid "content" value`))),rt=!1),rt}_validateStretch(o,_){if(!o)return!0;let rt=0;for(const ot of o){if(ot[0]<rt||ot[1]<ot[0]||_<ot[1])return!1;rt=ot[1]}return!0}_validateContent(o,_){return o?o.length!==4||!_.usvg&&(o[0]<0||_.data.width<o[0]||o[1]<0||_.data.height<o[1]||o[2]<0||_.data.width<o[2]||o[3]<0||_.data.height<o[3])?!1:!(o[2]<o[0]||o[3]<o[1]):!0}updateImage(o,_,rt){const ot=this.images.get(_).get(o.toString());rt.version=ot.version+1,this.images.get(_).set(o.toString(),rt),this.updatedImages.get(_).add(o),this.removeFromImageRasterizerCache(o,_)}clearUpdatedImages(o){this.updatedImages.get(o).clear()}removeFromImageRasterizerCache(o,_){this.spriteFormat!=="raster"&&(c.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[o],scope:_}):this.imageRasterizer.removeImagesFromCacheByIds([o],_))}removeImage(o,_){const rt=this.images.get(_),ot=rt.get(o.toString());rt.delete(o.toString()),this.patterns.get(_).delete(o.toString()),this.removeFromImageRasterizerCache(o,_),ot.userImage&&ot.userImage.onRemove&&ot.userImage.onRemove()}listImages(o){return Array.from(this.images.get(o).keys()).map(_=>c.I.from(_))}getImages(o,_,rt){const ot=[],lt=[],ut=this.imageProviders.get(_);for(const Ct of o){if(!Ct.iconsetId){ot.push(Ct);continue}const Ut=ut.get(Ct.iconsetId);Ut&&(this.getImage(Ct,_)?lt.push(Ct):Ut.addPendingRequest(Ct))}if(ot.length===0)return void this._notify(lt,_,rt);let dt=!0;const mt=!!this.loaded.get(_),Tt=this.images.get(_);if(!mt)for(const Ct of ot)Tt.has(Ct.toString())||(dt=!1);mt||dt?this._notify(ot,_,rt):this.requestors.push({ids:ot,scope:_,callback:rt})}rasterizeImages(o,_){const rt=new Map,{tasks:ot,scope:lt}=o;for(const[ut,dt]of ot.entries()){const mt=this.getImage(dt.id,lt);mt&&rt.set(ut,{image:mt,imageVariant:dt})}this._rasterizeImages(lt,rt,_)}_rasterizeImages(o,_,rt){if(c.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:_,scope:o},rt);else{const ot=new Map;for(const[lt,{image:ut,imageVariant:dt}]of _.entries())ot.set(lt,this.imageRasterizer.rasterize(dt,ut,o,0));rt(void 0,ot)}}getUpdatedImages(o){return this.updatedImages.get(o)||new Set}_notify(o,_,rt){const ot=this.images.get(_),lt=new Map;for(const ut of o){if(!ot.get(ut.toString())){if(ut.iconsetId)continue;this.fire(new c.z("styleimagemissing",{id:ut.name}))}const dt=ot.get(ut.toString());if(!dt){c.w(`Image "${ut.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const mt={data:dt.usvg?null:dt.data.clone(),pixelRatio:dt.pixelRatio,sdf:dt.sdf,usvg:dt.usvg,version:dt.version,stretchX:dt.stretchX,stretchY:dt.stretchY,content:dt.content,hasRenderCallback:!!(dt.userImage&&dt.userImage.render)};dt.usvg&&Object.assign(mt,{width:dt.icon.usvg_tree.width,height:dt.icon.usvg_tree.height}),lt.set(c.I.toString(ut),mt)}rt(null,lt)}getPixelSize(o){const{width:_,height:rt}=this.atlasImage.get(o);return{width:_,height:rt}}getPattern(o,_,rt){const ot=o.toString(),lt=this.patterns.get(_),ut=lt.get(ot),dt=this.getImage(o,_);if(!dt)return null;if(ut){if(ut.position.version===dt.version)return ut.position;ut.position.version=dt.version}else{if(dt.usvg&&!dt.data){const mt=this.getPatternInFlightId(ot,_);if(this.patternsInFlight.has(mt))return null;this.patternsInFlight.add(mt);const Tt=new c.A(o).scaleSelf(c.o.devicePixelRatio),Ct=new Map([[Tt.toString(),{image:dt,imageVariant:Tt}]]);return this._rasterizeImages(_,Ct,(Ut,Bt)=>this.storePatternImage(Tt,_,dt,rt,Bt)),null}this.storePattern(o,_,dt)}return this._updatePatternAtlas(_,rt),lt.get(ot).position}getPatternInFlightId(o,_){return c.B(o,_)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(o,_,rt,ot,lt){const ut=o.toString(),dt=lt?lt.get(ut):void 0;dt&&(rt.data=dt,this.storePattern(o.id,_,rt),this._updatePatternAtlas(_,ot),this.patternsInFlight.delete(this.getPatternInFlightId(o.id.toString(),_)))}storePattern(o,_,rt){const ot={w:rt.data.width+2*c.C,h:rt.data.height+2*c.C,x:0,y:0},lt=new c.F(ot,rt,c.C);this.patterns.get(_).set(o.toString(),{bin:ot,position:lt})}destroyAtlasTextures(){for(const o of this.atlasTexture.values())o&&o.destroy();this.atlasTexture.clear()}bind(o,_){const rt=o.gl;let ot=this.atlasTexture.get(_);ot?this.dirty&&(ot.update(this.atlasImage.get(_)),this.dirty=!1):(ot=new c.T(o,this.atlasImage.get(_),rt.RGBA8),this.atlasTexture.set(_,ot)),ot.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}_updatePatternAtlas(o,_){const rt=this.patterns.get(o),ot=Array.from(rt.values()).map(({bin:Tt})=>Tt),{w:lt,h:ut}=c.G(ot),dt=this.atlasImage.get(o);dt.resize({width:lt||1,height:ut||1});const mt=this.images.get(o);for(const[Tt,{bin:Ct,position:Ut}]of rt.entries()){let Bt=Ut.padding;const $t=Ct.x+Bt,Zt=Ct.y+Bt,qt=mt.get(Tt).data,sr=qt.width,ir=qt.height;Bt=Bt>1?Bt-1:Bt,c.q.copy(qt,dt,{x:0,y:0},{x:$t,y:Zt},{width:sr,height:ir},_),c.q.copy(qt,dt,{x:0,y:ir-Bt},{x:$t,y:Zt-Bt},{width:sr,height:Bt},_),c.q.copy(qt,dt,{x:0,y:0},{x:$t,y:Zt+ir},{width:sr,height:Bt},_),c.q.copy(qt,dt,{x:sr-Bt,y:0},{x:$t-Bt,y:Zt},{width:Bt,height:ir},_),c.q.copy(qt,dt,{x:0,y:0},{x:$t+sr,y:Zt},{width:Bt,height:ir},_),c.q.copy(qt,dt,{x:sr-Bt,y:ir-Bt},{x:$t-Bt,y:Zt-Bt},{width:Bt,height:Bt},_),c.q.copy(qt,dt,{x:0,y:ir-Bt},{x:$t+sr,y:Zt-Bt},{width:Bt,height:Bt},_),c.q.copy(qt,dt,{x:0,y:0},{x:$t+sr,y:Zt+ir},{width:Bt,height:Bt},_),c.q.copy(qt,dt,{x:sr-Bt,y:0},{x:$t-Bt,y:Zt+ir},{width:Bt,height:Bt},_)}this.dirty=!0}beginFrame(){for(const o of this.images.keys())this.callbackDispatchedThisFrame.set(o,new Set)}dispatchRenderCallbacks(o,_){const rt=this.images.get(_);for(const ot of o){if(this.callbackDispatchedThisFrame.get(_).has(ot.toString()))continue;this.callbackDispatchedThisFrame.get(_).add(ot.toString());const lt=rt.get(ot.toString());Ro(lt)&&this.updateImage(ot,_,lt)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Zn(et){const o=et.value,_=et.valueSpec,rt=et.style,ot=et.styleSpec,lt=et.key,ut=et.arrayElementValidator||_o;if(!Array.isArray(o))return[new c.V(lt,o,`array expected, ${c.K(o)} found`)];if(_.length&&o.length!==_.length)return[new c.V(lt,o,`array length ${_.length} expected, length ${o.length} found`)];if(_["min-length"]&&o.length<_["min-length"])return[new c.V(lt,o,`array length at least ${_["min-length"]} expected, length ${o.length} found`)];let dt={type:_.value,values:_.values,minimum:_.minimum,maximum:_.maximum,function:void 0};ot.$version<7&&(dt.function=_.function),c.H(_.value)&&(dt=_.value);let mt=[];for(let Tt=0;Tt<o.length;Tt++)mt=mt.concat(ut({array:o,arrayIndex:Tt,value:o[Tt],valueSpec:dt,style:rt,styleSpec:ot,key:`${lt}[${Tt}]`},!0));return mt}function Qo(et){const o=et.key,_=et.value,rt=et.valueSpec;if(!c.L(_))return[new c.V(o,_,`number expected, ${c.K(_)} found`)];if(_!=_)return[new c.V(o,_,"number expected, NaN found")];if("minimum"in rt){let ot=rt.minimum;if(Array.isArray(rt.minimum)&&(ot=rt.minimum[et.arrayIndex]),_<ot)return[new c.V(o,_,`${_} is less than the minimum value ${ot}`)]}if("maximum"in rt){let ot=rt.maximum;if(Array.isArray(rt.maximum)&&(ot=rt.maximum[et.arrayIndex]),_>ot)return[new c.V(o,_,`${_} is greater than the maximum value ${ot}`)]}return[]}function Wo(et){const o=et.key,_=et.value;if(!c.H(_))return[new c.V(o,_,`object expected, ${c.K(_)} found`)];const rt=et.valueSpec,ot=c.J(_.type);let lt,ut,dt,mt={};const Tt=ot!=="categorical"&&_.property===void 0,Ct=!Tt,Ut=function(qt){const sr=qt.stops;return Array.isArray(sr)&&Array.isArray(sr[0])&&c.H(sr[0][0])}(_),Bt=Ol({key:et.key,value:et.value,valueSpec:et.styleSpec.function,style:et.style,styleSpec:et.styleSpec,objectElementValidators:{stops:function(qt){if(ot==="identity")return[new c.V(qt.key,qt.value,'identity function may not have a "stops" property')];let sr=[];const ir=qt.value;return sr=sr.concat(Zn({key:qt.key,value:ir,valueSpec:qt.valueSpec,style:qt.style,styleSpec:qt.styleSpec,arrayElementValidator:$t})),Array.isArray(ir)&&ir.length===0&&sr.push(new c.V(qt.key,ir,"array must have at least one stop")),sr},default:function(qt){return _o({key:qt.key,value:qt.value,valueSpec:rt,style:qt.style,styleSpec:qt.styleSpec})}}});return ot==="identity"&&Tt&&Bt.push(new c.V(et.key,et.value,'missing required property "property"')),ot==="identity"||_.stops||Bt.push(new c.V(et.key,et.value,'missing required property "stops"')),ot==="exponential"&&rt.expression&&!c.M(rt)&&Bt.push(new c.V(et.key,et.value,"exponential functions not supported")),et.styleSpec.$version>=8&&(Ct&&!c.N(rt)?Bt.push(new c.V(et.key,et.value,"property functions not supported")):Tt&&!c.O(rt)&&Bt.push(new c.V(et.key,et.value,"zoom functions not supported"))),ot!=="categorical"&&!Ut||_.property!==void 0||Bt.push(new c.V(et.key,et.value,'"property" property is required')),Bt;function $t(qt){let sr=[];const ir=qt.value,cr=qt.key;if(!Array.isArray(ir))return[new c.V(cr,ir,`array expected, ${c.K(ir)} found`)];if(ir.length!==2)return[new c.V(cr,ir,`array length 2 expected, length ${ir.length} found`)];if(Ut){if(!c.H(ir[0]))return[new c.V(cr,ir,`object expected, ${c.K(ir[0])} found`)];const pr=ir[0];if(pr.zoom===void 0)return[new c.V(cr,ir,"object stop key must have zoom")];if(pr.value===void 0)return[new c.V(cr,ir,"object stop key must have value")];const ur=c.J(pr.zoom);if(typeof ur!="number")return[new c.V(cr,pr.zoom,"stop zoom values must be numbers")];if(dt&&dt>ur)return[new c.V(cr,pr.zoom,"stop zoom values must appear in ascending order")];ur!==dt&&(dt=ur,ut=void 0,mt={}),sr=sr.concat(Ol({key:`${cr}[0]`,value:ir[0],valueSpec:{zoom:{}},style:qt.style,styleSpec:qt.styleSpec,objectElementValidators:{zoom:Qo,value:Zt}}))}else sr=sr.concat(Zt({key:`${cr}[0]`,value:ir[0],style:qt.style,styleSpec:qt.styleSpec},ir));return c.Q(c.S(ir[1]))?sr.concat([new c.V(`${cr}[1]`,ir[1],"expressions are not allowed in function stops.")]):sr.concat(_o({key:`${cr}[1]`,value:ir[1],valueSpec:rt,style:qt.style,styleSpec:qt.styleSpec}))}function Zt(qt,sr){const ir=c.K(qt.value),cr=c.J(qt.value),pr=qt.value!==null?qt.value:sr;if(lt){if(ir!==lt)return[new c.V(qt.key,pr,`${ir} stop domain type must match previous stop domain type ${lt}`)]}else lt=ir;if(ir!=="number"&&ir!=="string"&&ir!=="boolean"&&typeof cr!="number"&&typeof cr!="string"&&typeof cr!="boolean")return[new c.V(qt.key,pr,"stop domain value must be a number, string, or boolean")];if(ir!=="number"&&ot!=="categorical"){let ur=`number expected, ${ir} found`;return c.N(rt)&&ot===void 0&&(ur+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new c.V(qt.key,pr,ur)]}return ot!=="categorical"||ir!=="number"||typeof cr=="number"&&isFinite(cr)&&Math.floor(cr)===cr?ot!=="categorical"&&ir==="number"&&typeof cr=="number"&&typeof ut=="number"&&ut!==void 0&&cr<ut?[new c.V(qt.key,pr,"stop domain values must appear in ascending order")]:(ut=cr,ot==="categorical"&&cr in mt?[new c.V(qt.key,pr,"stop domain values must be unique")]:(mt[cr]=!0,[])):[new c.V(qt.key,pr,`integer expected, found ${String(cr)}`)]}}function uo(et){const o=(et.expressionContext==="property"?c.W:c.U)(c.S(et.value),et.valueSpec);if(o.result==="error")return o.value.map(rt=>new c.V(`${et.key}${rt.key}`,et.value,rt.message));const _=o.value.expression||o.value._styleExpression.expression;if(et.expressionContext==="property"&&et.propertyKey==="text-font"&&!_.outputDefined())return[new c.V(et.key,et.value,`Invalid data expression for "${et.propertyKey}". Output values must be contained as literals within the expression.`)];if(et.expressionContext==="property"&&et.propertyType==="layout"&&!c.Z(_))return[new c.V(et.key,et.value,'"feature-state" data expressions are not supported with layout properties.')];if(et.expressionContext==="filter")return eo(_,et);if(et.expressionContext==="appearance")return to(_,et);if(et.expressionContext&&et.expressionContext.indexOf("cluster")===0){if(!c.X(_,["zoom","feature-state"]))return[new c.V(et.key,et.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(et.expressionContext==="cluster-initial"&&!c.Y(_))return[new c.V(et.key,et.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function eo(et,o){const _=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(o.valueSpec&&o.valueSpec.expression)for(const ot of o.valueSpec.expression.parameters)_.delete(ot);if(_.size===0)return[];const rt=[];return et instanceof c._&&_.has(et.name)?[new c.V(o.key,o.value,`["${et.name}"] expression is not supported in a filter for a ${o.object.type} layer with id: ${o.object.id}`)]:(et.eachChild(ot=>{rt.push(...eo(ot,o))}),rt)}function to(et,o){const _=new Set;if(o.valueSpec&&o.valueSpec.expression)for(const ot of o.valueSpec.expression.parameters)_.add(ot);if(_.size===0)return[];const rt=[];return et instanceof c._&&!_.has(et.name)?[new c.V(o.key,o.value,`["${et.name}"] is not an allowed parameter`)]:(et.eachChild(ot=>{rt.push(...to(ot,o))}),rt)}function Io(et){const o=et.key,_=et.value,rt=et.valueSpec,ot=[];return Array.isArray(rt.values)?rt.values.indexOf(c.J(_))===-1&&ot.push(new c.V(o,_,`expected one of [${rt.values.join(", ")}], ${JSON.stringify(_)} found`)):Object.keys(rt.values).indexOf(c.J(_))===-1&&ot.push(new c.V(o,_,`expected one of [${Object.keys(rt.values).join(", ")}], ${JSON.stringify(_)} found`)),ot}function ou(et){return c.a2(c.S(et.value))?uo(Object.assign({},et,{expressionContext:"filter",valueSpec:et.styleSpec[`filter_${et.layerType||"fill"}`]})):Dl(et)}function Dl(et){const o=et.value,_=et.key;if(!Array.isArray(o))return[new c.V(_,o,`array expected, ${c.K(o)} found`)];if(o.length<1)return[new c.V(_,o,"filter array must have at least 1 element")];const rt=et.styleSpec;let ot=Io({key:`${_}[0]`,value:o[0],valueSpec:rt.filter_operator});const lt=()=>{o.length>=2&&(c.a0(o[1])||ot.push(new c.V(`${_}[1]`,o[1],`string expected, ${c.K(o[1])} found`)));for(let ut=2;ut<o.length;ut++)c.J(o[1])==="$type"?ot=ot.concat(Io({key:`${_}[${ut}]`,value:o[ut],valueSpec:rt.geometry_type})):c.a0(o[ut])||c.L(o[ut])||c.$(o[ut])||ot.push(new c.V(`${_}[${ut}]`,o[ut],`string, number, or boolean expected, ${c.K(o[ut])} found.`))};switch(c.J(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&c.J(o[1])==="$type"&&ot.push(new c.V(_,o,`"$type" cannot be use with operator "${o[0]}"`)),o.length!==3&&ot.push(new c.V(_,o,`filter array for operator "${o[0]}" must have 3 elements`)),lt();break;case"==":case"!=":o.length!==3&&ot.push(new c.V(_,o,`filter array for operator "${o[0]}" must have 3 elements`)),lt();break;case"in":case"!in":lt();break;case"any":case"all":case"none":for(let ut=1;ut<o.length;ut++)ot=ot.concat(Dl({key:`${_}[${ut}]`,value:o[ut],style:et.style,styleSpec:et.styleSpec}));break;case"has":case"!has":o.length!==2?ot.push(new c.V(_,o,`filter array for "${o[0]}" operator must have 2 elements`)):c.a0(o[1])||ot.push(new c.V(`${_}[1]`,o[1],`string expected, ${c.K(o[1])} found`))}return ot}function Jl(et,o){const _=et.key,rt=et.style,ot=et.layer,lt=et.styleSpec,ut=et.value,dt=et.objectKey,mt=lt[`${o}_${et.layerType}`];if(!mt)return[];const Tt=dt.match(/^(.*)-use-theme$/);if(Tt&&mt[Tt[1]])return c.Q(c.S(ut))?[].concat(_o({key:_,value:ut,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:rt,styleSpec:lt,expressionContext:"property",propertyType:o,propertyKey:dt})):_o({key:_,value:ut,valueSpec:{type:"string"},style:rt,styleSpec:lt});const Ct=dt.match(/^(.*)-transition$/);if(o==="paint"&&Ct&&mt[Ct[1]]&&mt[Ct[1]].transition)return _o({key:_,value:ut,valueSpec:lt.transition,style:rt,styleSpec:lt});const Ut=et.valueSpec||mt[dt];if(!Ut)return[new c.a3(_,ut,`unknown property "${dt}"`)];let Bt;if(c.a0(ut)&&c.N(Ut)&&!Ut.tokens&&(Bt=/^{([^}]+)}$/.exec(ut))){const Zt=`\`{ "type": "identity", "property": ${Bt?JSON.stringify(Bt[1]):'"_"'} }\``;return[new c.V(_,ut,`"${dt}" does not support interpolation syntax
Use an identity property function instead: ${Zt}.`)]}const $t=[];if(et.layerType==="symbol")dt!=="text-field"||!rt||rt.glyphs||rt.imports||$t.push(new c.V(_,ut,'use of "text-field" requires a style "glyphs" property')),dt==="text-font"&&c.a4(c.S(ut))&&c.J(ut.type)==="identity"&&$t.push(new c.V(_,ut,'"text-font" does not support identity functions'));else if(et.layerType==="model"&&o==="paint"&&ot&&ot.layout&&ot.layout.hasOwnProperty("model-id")&&c.N(Ut)&&(c.a5(Ut)||c.O(Ut))){const Zt=c.W(c.S(ut),Ut).value,qt="expression"in Zt&&Zt.expression||"_styleExpression"in Zt&&Zt._styleExpression&&Zt._styleExpression.expression;qt&&!c.X(qt,["measure-light"])&&(dt==="model-emissive-strength"&&c.Y(qt)&&c.Z(qt)||$t.push(new c.V(_,ut,`${dt} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return $t.concat(_o({key:et.key,value:ut,valueSpec:Ut,style:rt,styleSpec:lt,expressionContext:"property",propertyType:o,propertyKey:dt}))}function Ju(et){return Jl(et,"paint")}function zu(et){return Jl(et,"layout")}function vu(et){let o=[];const _=et.value,rt=et.key,ot=et.style,lt=et.styleSpec;if(!c.H(_))return[new c.V(rt,_,"object expected")];_.type||_.ref||o.push(new c.V(rt,_,'either "type" or "ref" is required'));let ut=c.J(_.type);const dt=c.J(_.ref);if(_.id){const mt=c.J(_.id);for(let Tt=0;Tt<et.arrayIndex;Tt++){const Ct=ot.layers[Tt];c.J(Ct.id)===mt&&o.push(new c.V(rt,_.id,`duplicate layer id "${mt}", previously used at line ${Ct.id.__line__}`))}}if("ref"in _){let mt;["type","source","source-layer","filter","layout"].forEach(Tt=>{Tt in _&&o.push(new c.V(rt,_[Tt],`"${Tt}" is prohibited for ref layers`))}),ot.layers.forEach(Tt=>{c.J(Tt.id)===dt&&(mt=Tt)}),mt?mt.ref?o.push(new c.V(rt,_.ref,"ref cannot reference another ref layer")):ut=c.J(mt.type):typeof dt=="string"&&o.push(new c.V(rt,_.ref,`ref layer "${dt}" not found`))}else if(ut!=="background"&&ut!=="sky"&&ut!=="slot")if(_.source)if(c.a0(_.source)){const mt=ot.sources&&ot.sources[_.source],Tt=mt&&c.J(mt.type);mt?Tt==="vector"&&ut==="raster"?o.push(new c.V(rt,_.source,`layer "${_.id}" requires a raster source`)):Tt==="raster"&&ut!=="raster"?o.push(new c.V(rt,_.source,`layer "${_.id}" requires a vector source`)):Tt!=="vector"||_["source-layer"]?Tt==="raster-dem"&&ut!=="hillshade"?o.push(new c.V(rt,_.source,"raster-dem source can only be used with layer type 'hillshade'.")):Tt!=="raster-array"||["raster","raster-particle"].includes(ut)?ut==="line"&&_.paint&&(_.paint["line-gradient"]||_.paint["line-trim-offset"])&&Tt==="geojson"&&!mt.lineMetrics?o.push(new c.V(rt,_,`layer "${_.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):ut==="raster-particle"&&Tt!=="raster-array"&&o.push(new c.V(rt,_.source,`layer "${_.id}" requires a 'raster-array' source.`)):o.push(new c.V(rt,_.source,"raster-array source can only be used with layer type 'raster'.")):o.push(new c.V(rt,_,`layer "${_.id}" must specify a "source-layer"`)):o.push(new c.V(rt,_.source,`source "${_.source}" not found`))}else o.push(new c.V(`${rt}.source`,_.source,'"source" must be a string'));else o.push(new c.V(rt,_,'missing required property "source"'));return o=o.concat(Ol({key:rt,value:_,valueSpec:lt.layer,style:et.style,styleSpec:et.styleSpec,objectElementValidators:{"*":()=>[],type:()=>_o({key:`${rt}.type`,value:_.type,valueSpec:lt.layer.type,style:et.style,styleSpec:et.styleSpec,object:_,objectKey:"type"}),filter:mt=>ou(Object.assign({layerType:ut},mt)),layout:mt=>Ol({layer:_,key:mt.key,value:mt.value,valueSpec:{},style:mt.style,styleSpec:mt.styleSpec,objectElementValidators:{"*":Tt=>zu(Object.assign({layerType:ut},Tt))}}),paint:mt=>Ol({layer:_,key:mt.key,value:mt.value,valueSpec:{},style:mt.style,styleSpec:mt.styleSpec,objectElementValidators:{"*":Tt=>Ju(Object.assign({layerType:ut,layer:_},Tt))}}),appearances(mt){const Tt=Zn({key:mt.key,value:mt.value,valueSpec:mt.valueSpec,style:mt.style,styleSpec:mt.styleSpec,arrayElementValidator:Bt=>function($t){const{key:Zt,layer:qt,layerType:sr}=$t,ir=c.J($t.value),cr=c.J(ir.name),pr=c.J(ir.condition),ur=Ol({key:Zt,value:ir,valueSpec:$t.styleSpec.appearance,style:$t.style,styleSpec:$t.styleSpec,objectElementValidators:{condition:Cr=>function(wr){const Tr=[];return Tr.push(...uo({key:wr.key,value:wr.object.condition,valueSpec:c.a6.appearance.condition,expressionContext:"appearance"})),Tr}(Object.assign({layer:qt,layerType:sr},Cr)),properties:Cr=>function(wr){const Tr=[],{styleSpec:br,layer:yr,layerType:Pr}=wr,Or=br[`paint_${Pr}`],Nr=br[`layout_${Pr}`],ts=wr.object[wr.objectKey];for(const rs in ts){const cs=rs in Or?"paint":rs in Nr?"layout":void 0;if(!cs){Tr.push(new c.V(wr.key,rs,`unknown property "${rs}" for layer type "${Pr}"`));continue}const Ss=Object.assign({},wr,{key:`${wr.key}.${rs}`,object:ts,objectKey:rs,layer:yr,layerType:Pr,value:ts[rs],valueSpec:cs==="paint"?Or[rs]:Nr[rs]});Tr.push(...Jl(Ss,cs))}return Tr}(Object.assign({layer:qt,layerType:sr},Cr))}});return cr!=="hidden"&&pr===void 0&&ur.push(new c.V($t.key,"name",'Appearance with name different than "hidden" must have a condition')),ur}(Object.assign({layerType:ut,layer:_},Bt))}),Ct=Array.isArray(mt.value)?mt.value:[],Ut=new Set;return Ct.forEach((Bt,$t)=>{const Zt=c.J(Bt.name);if(Zt)if(Ut.has(Zt)){const qt=c.J(_.id);Tt.push(new c.V(mt.key,Zt,`Duplicated appearance name "${Zt}" for layer "${qt}"`))}else Ut.add(Zt)}),Tt}}})),o}function Vo({key:et,value:o}){return c.a0(o)?[]:[new c.V(et,o,`string expected, ${c.K(o)} found`)]}const Gl={promoteId:function et({key:o,value:_}){if(c.a0(_))return Vo({key:o,value:_});if(Array.isArray(_)){const ot=[],lt=c.S(_),ut=c.U(lt);return ut.result==="error"&&ut.value.forEach(dt=>{ot.push(new c.V(`${o}${dt.key}`,null,`${dt.message}`))}),c.X(ut.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||ot.push(new c.V(`${o}`,null,"promoteId expression should be only feature dependent")),ot}if(!c.H(_))return[new c.V(o,_,`string, expression or object expected, "${c.K(_)}" found`)];const rt=[];for(const ot in _)rt.push(...et({key:`${o}.${ot}`,value:_[ot]}));return rt}};function fu(et){const o=et.value,_=et.key,rt=et.styleSpec,ot=et.style;if(!c.H(o))return[new c.V(_,o,`object expected, ${c.K(o)} found`)];if(!("type"in o))return[new c.V(_,o,'"type" is required')];const lt=c.J(o.type);let ut=[];switch(["vector","raster","raster-dem","raster-array"].includes(lt)&&("url"in o||"tiles"in o||ut.push(new c.a3(_,o,'Either "url" or "tiles" is required.'))),lt){case"vector":case"raster":case"raster-dem":case"raster-array":return ut=ut.concat(Ol({key:_,value:o,valueSpec:rt[`source_${lt.replace("-","_")}`],style:et.style,styleSpec:rt,objectElementValidators:Gl})),ut;case"geojson":if(ut=Ol({key:_,value:o,valueSpec:rt.source_geojson,style:ot,styleSpec:rt,objectElementValidators:Gl}),"cluster"in o&&"clusterProperties"in o){if(!c.H(o.clusterProperties))return[new c.V(`${_}.clusterProperties`,o,`object expected, ${c.K(o)} found`)];for(const dt in o.clusterProperties){const mt=o.clusterProperties[dt];if(!Array.isArray(mt))return[new c.V(`${_}.clusterProperties.${dt}`,mt,"array expected")];const[Tt,Ct]=mt,Ut=typeof Tt=="string"?[Tt,["accumulated"],["get",dt]]:Tt;ut.push(...uo({key:`${_}.${dt}.map`,value:Ct,expressionContext:"cluster-map"})),ut.push(...uo({key:`${_}.${dt}.reduce`,value:Ut,expressionContext:"cluster-reduce"}))}}return ut;case"video":return Ol({key:_,value:o,valueSpec:rt.source_video,style:ot,styleSpec:rt});case"image":return Ol({key:_,value:o,valueSpec:rt.source_image,style:ot,styleSpec:rt});case"canvas":return[new c.V(_,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${_}.type`,value:o.type,valueSpec:{values:ju(rt)}})}}function ju(et){return et.source.reduce((o,_)=>{const rt=et[_];return rt.type.type==="enum"&&(o=o.concat(Object.keys(rt.type.values||{}))),o},[])}function au(et){const o=et.value,_=et.styleSpec,rt=_.light,ot=et.style;if(o===void 0)return[];if(!c.H(o))return[new c.V("light",o,`object expected, ${c.K(o)} found`)];let lt=[];for(const ut in o){const dt=ut.match(/^(.*)-transition$/),mt=ut.match(/^(.*)-use-theme$/);lt=lt.concat(mt&&rt[mt[1]]?_o({key:ut,value:o[ut],valueSpec:{type:"string"},style:ot,styleSpec:_}):dt&&rt[dt[1]]&&rt[dt[1]].transition?_o({key:ut,value:o[ut],valueSpec:_.transition,style:ot,styleSpec:_}):rt[ut]?_o({key:ut,value:o[ut],valueSpec:rt[ut],style:ot,styleSpec:_}):[new c.V(ut,o[ut],`unknown property "${ut}"`)])}return lt}function pu(et){const o=et.value;if(!o)return[];const _=et.key;if(!c.H(o))return[new c.V(_,o,`object expected, ${c.K(o)} found`)];let rt=[];const ot=et.styleSpec,lt=ot["light-3d"],ut=et.style,dt=et.style.lights;for(const Ct of["type","id"])if(!(Ct in o))return rt=rt.concat([new c.V(_,o,`missing property "${Ct}"`)]),rt;if(!c.a0(o.type))return rt=rt.concat([new c.V(`${_}.type`,o.type,"string expected")]),rt;if(dt)for(let Ct=0;Ct<et.arrayIndex;Ct++){const Ut=c.J(o.type),Bt=dt[Ct];c.J(Bt.type)===Ut&&rt.push(new c.V(_,o.id,`duplicate light type "${o.type}", previously defined at line ${Bt.id.__line__}`))}const mt=`properties_light_${o.type}`;if(!(mt in ot))return rt=rt.concat([new c.V(`${_}.type`,o,`Invalid light type ${o.type}`)]),rt;const Tt=ot[mt];for(const Ct in o)if(Ct==="properties"){const Ut=o[Ct];if(!c.H(Ut))return rt=rt.concat([new c.V("properties",Ut,`object expected, ${c.K(Ut)} found`)]),rt;for(const Bt in Ut){const $t=Bt.match(/^(.*)-transition$/),Zt=Bt.match(/^(.*)-use-theme$/);rt=rt.concat(Zt&&Tt[Zt[1]]?_o({key:Ct,value:Ut[Bt],valueSpec:{type:"string"},style:ut,styleSpec:ot}):$t&&Tt[$t[1]]&&Tt[$t[1]].transition?_o({key:Ct,value:o[Ct],valueSpec:ot.transition,style:ut,styleSpec:ot}):Tt[Bt]?_o({key:Bt,value:Ut[Bt],valueSpec:Tt[Bt],style:ut,styleSpec:ot}):[new c.a3(et.key,Ut[Bt],`unknown property "${Bt}"`)])}}else rt=rt.concat(lt[Ct]?_o({key:Ct,value:o[Ct],valueSpec:lt[Ct],style:ut,styleSpec:ot}):[new c.a3(Ct,o[Ct],`unknown property "${Ct}"`)]);return rt}function Il(et){const o=et.value,_=et.key,rt=et.style,ot=et.styleSpec,lt=ot.terrain;if(o==null)return[];if(!c.H(o))return[new c.V("terrain",o,`object expected, ${c.K(o)} found`)];let ut=[];for(const dt in o){const mt=dt.match(/^(.*)-transition$/),Tt=dt.match(/^(.*)-use-theme$/);ut=ut.concat(Tt&&lt[Tt[1]]?_o({key:dt,value:o[dt],valueSpec:{type:"string"},style:rt,styleSpec:ot}):mt&&lt[mt[1]]&&lt[mt[1]].transition?_o({key:dt,value:o[dt],valueSpec:ot.transition,style:rt,styleSpec:ot}):lt[dt]?_o({key:dt,value:o[dt],valueSpec:lt[dt],style:rt,styleSpec:ot}):[new c.a3(dt,o[dt],`unknown property "${dt}"`)])}if(o.source)if(c.a0(o.source)){const dt=rt.sources&&rt.sources[o.source],mt=dt&&c.J(dt.type);dt?mt!=="raster-dem"&&ut.push(new c.V(`${_}.source`,o.source,`terrain cannot be used with a source of type ${mt}, it only be used with a "raster-dem" source type`)):ut.push(new c.V(`${_}.source`,o.source,`source "${o.source}" not found`))}else ut.push(new c.V(`${_}.source`,o.source,"source must be a string"));else ut.push(new c.V(_,o,'terrain is missing required property "source"'));return ut}function Ou(et){const o=et.value,_=et.style,rt=et.styleSpec,ot=rt.fog;if(o===void 0)return[];if(!c.H(o))return[new c.V("fog",o,`object expected, ${c.K(o)} found`)];let lt=[];for(const ut in o){const dt=ut.match(/^(.*)-transition$/),mt=ut.match(/^(.*)-use-theme$/);lt=lt.concat(mt&&ot[mt[1]]?_o({key:ut,value:o[ut],valueSpec:{type:"string"},style:_,styleSpec:rt}):dt&&ot[dt[1]]&&ot[dt[1]].transition?_o({key:ut,value:o[ut],valueSpec:rt.transition,style:_,styleSpec:rt}):ot[ut]?_o({key:ut,value:o[ut],valueSpec:ot[ut],style:_,styleSpec:rt}):[new c.a3(ut,o[ut],`unknown property "${ut}"`)])}return lt}const Zu={"*":()=>[],array:Zn,boolean:function(et){const o=et.value,_=et.key;return c.$(o)?[]:[new c.V(_,o,`boolean expected, ${c.K(o)} found`)]},number:Qo,color:function({key:et,value:o}){return c.a0(o)?c.a1.parseCSSColor(o)===null?[new c.V(et,o,`color expected, "${o}" found`)]:[]:[new c.V(et,o,`color expected, ${c.K(o)} found`)]},enum:Io,filter:ou,function:Wo,layer:vu,object:Ol,source:fu,model:c.a7,light:au,"light-3d":pu,terrain:Il,fog:Ou,string:Vo,formatted:function(et){return Vo(et).length===0?[]:uo(et)},resolvedImage:function(et){return Vo(et).length===0?[]:uo(et)},projection:function(et){const o=et.value,_=et.styleSpec,rt=_.projection,ot=et.style;if(c.H(o)){let lt=[];for(const ut in o)lt=lt.concat(_o({key:ut,value:o[ut],valueSpec:rt[ut],style:ot,styleSpec:_}));return lt}return c.a0(o)?[]:[new c.V("projection",o,`object or string expected, ${c.K(o)} found`)]},import:function(et){const o=et.key,{value:_,styleSpec:rt}=et;if(!c.H(_))return[new c.V(o,_,"import must be an object")];const{data:ot,...lt}=_;Object.defineProperty(lt,"__line__",{value:_.__line__,enumerable:!1});let ut=Ol(Object.assign({},et,{value:lt,valueSpec:rt.import}));return c.J(lt.id)===""&&ut.push(new c.V(`${et.key}.id`,lt,"import id can't be an empty string")),ot&&(ut=ut.concat(Uo(ot,rt,{key:`${et.key}.data`}))),ut},iconset:function(et){const o=et.value,_=et.key,rt=et.styleSpec,ot=et.style;if(!c.H(o))return[new c.V(_,o,"object expected")];if(!o.type)return[new c.V(_,o,'"type" is required')];const lt=c.J(o.type);let ut=[];if(ut=ut.concat(Ol({key:_,value:o,valueSpec:rt[`iconset_${lt}`],style:ot,styleSpec:rt})),function(dt,mt){return!(dt!=="source"||!mt.source)}(lt,o)){const dt=ot.sources&&ot.sources[o.source],mt=dt&&c.J(dt.type);dt?mt!=="raster-array"&&ut.push(new c.V(_,o.source,`iconset cannot be used with a source of type ${String(mt)}, it only be used with a "raster-array" source type`)):ut.push(new c.V(_,o.source,`source "${o.source}" not found`))}return ut}};function _o(et,o=!1){const _=et.value,rt=et.valueSpec,ot=et.styleSpec;if(rt.expression){if(c.a4(c.J(_)))return Wo(et);if(c.Q(c.S(_)))return uo(et)}if(rt.type&&Zu[rt.type]){const lt=Zu[rt.type](et);return o===!0&&lt.length>0&&Array.isArray(et.value)?uo(et):lt}return Ol(Object.assign({},et,{valueSpec:rt.type?ot[rt.type]:rt}))}function Ol(et){const o=et.key,_=et.value,rt=et.valueSpec||{},ot=et.objectElementValidators||{},lt=et.style,ut=et.styleSpec;if(!c.H(_))return[new c.V(o,_,`object expected, ${c.K(_)} found`)];let dt=[];for(const mt in _){const Tt=mt.split(".")[0];let Ct;ot[Tt]?Ct=ot[Tt]:rt[Tt]?Ct=_o:ot["*"]?Ct=ot["*"]:rt["*"]&&(Ct=_o),Ct?dt=dt.concat(Ct({key:(o&&`${o}.`)+mt,value:_[mt],valueSpec:rt[Tt]||rt["*"],style:lt,styleSpec:ut,object:_,objectKey:mt},_)):dt.push(new c.a3(o,_[mt],`unknown property "${mt}"`))}for(const mt in rt){if(ot[mt])continue;const Tt=rt[mt];Tt.required&&Tt.default===void 0&&_[mt]===void 0&&dt.push(new c.V(o,_,`missing required property "${mt}"`))}return dt}function oo({key:et,value:o}){const _=Vo({key:et,value:o});if(_.length)return _;const rt=o;return rt.indexOf("{fontstack}")===-1&&_.push(new c.V(et,o,'"glyphs" url must include a "{fontstack}" token')),rt.indexOf("{range}")===-1&&_.push(new c.V(et,o,'"glyphs" url must include a "{range}" token')),_}function Uo(et,o=c.a6,_={}){return Ol({key:_.key||"",value:et,valueSpec:Object.assign(o.$root,{"*":{type:"*"}}),styleSpec:o,style:et,objectElementValidators:{glyphs:oo}})}function Lo(et,o=c.a6){return or(Uo(et,o))}const lu=et=>or(fu(et)),ps=et=>or(au(et)),Wl=et=>or(pu(et)),Bu=et=>or(Il(et)),qo=et=>or(Ou(et)),wn=et=>or(function(o){const _=o.value,rt=o.style,ot=o.styleSpec,lt=ot.snow;if(_===void 0)return[];if(!c.H(_))return[new c.V("snow",_,`object expected, ${c.K(_)} found`)];let ut=[];for(const dt in _){const mt=dt.match(/^(.*)-transition$/);ut=ut.concat(mt&&lt[mt[1]]&&lt[mt[1]].transition?_o({key:dt,value:_[dt],valueSpec:ot.transition,style:rt,styleSpec:ot}):lt[dt]?_o({key:dt,value:_[dt],valueSpec:lt[dt],style:rt,styleSpec:ot}):[new c.a3(dt,_[dt],`unknown property "${dt}"`)])}return ut}(et)),Nl=et=>or(function(o){const _=o.value,rt=o.style,ot=o.styleSpec,lt=ot.rain;if(_===void 0)return[];if(!c.H(_))return[new c.V("rain",_,`object expected, ${c.K(_)} found`)];let ut=[];for(const dt in _){const mt=dt.match(/^(.*)-transition$/);ut=ut.concat(mt&&lt[mt[1]]&&lt[mt[1]].transition?_o({key:dt,value:_[dt],valueSpec:ot.transition,style:rt,styleSpec:ot}):lt[dt]?_o({key:dt,value:_[dt],valueSpec:lt[dt],style:rt,styleSpec:ot}):[new c.a3(dt,_[dt],`unknown property "${dt}"`)])}return ut}(et)),vp=et=>or(vu(et)),cu=et=>or(ou(et)),bp=et=>or(Ju(et)),Hr=et=>or(zu(et)),Qt=et=>or(c.a7(et));function or(et){return et.slice().sort((o,_)=>o.line&&_.line?o.line-_.line:0)}function gr(et,o){let _=!1;if(o&&o.length)for(const rt of o)rt instanceof c.a3?c.w(rt.message):(et.fire(new c.y(new Error(rt.message))),_=!0);return _}const Mr=c.a6.light;let Ir;class zr extends c.E{constructor(o,_="flat"){super(),this._transitionable=new c.a8(Ir||(Ir=new c.a9({anchor:new c.aa(Mr.anchor),position:new c.ab(Mr.position),color:new c.aa(Mr.color),intensity:new c.aa(Mr.intensity)}))),this.setLight(o,_),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,_,rt={}){this._validate(ps,o,rt)||(this._transitionable.setTransitionOrValue(o),this.id=_)}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,_,rt){return(!rt||rt.validate!==!1)&&gr(this,o.call(Lo,Object.assign({value:_,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}const _i=c.a6.terrain;let Vr=class extends c.E{constructor(et,o,_,rt,ot){super(),this.scope=_,this._transitionable=new c.a8(new c.a9({source:new c.aa(_i.source),exaggeration:new c.aa(_i.exaggeration)}),_,rt),this._transitionable.setTransitionOrValue(et,rt),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=o,this.worldview=ot}get(){return this._transitionable.serialize()}set(et,o){this._transitionable.setTransitionOrValue(et,o)}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}getExaggeration(et){return this._transitioning.possiblyEvaluate(new c.ac(et,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const et=this._transitionable._values.exaggeration;if(!et)return null;const o=et.value.expression;if(!o)return null;let _=-1,rt=-1,ot=1;for(const lt of o.zoomStops)ot=o.evaluate(new c.ac(lt,{worldview:this.worldview})),ot>.01?(_=lt,rt=-1):rt=lt;return ot<.01&&_>0&&rt>_?[_,rt]:null}isZoomDependent(){const et=this._transitionable._values.exaggeration;return et!=null&&et.value!=null&&et.value.expression!=null&&et.value.expression instanceof c.ad}};const Jr=45,Es=65,hs=.05;function Ws(et,o,_,rt){const ot=c.ah(Jr,Es,_),[lt,ut]=an(et,rt);let dt=1-Math.min(1,Math.exp((o-lt)/(ut-lt)*-6));return dt*=dt*dt,dt=Math.min(1,1.00747*dt),dt*ot*et.alpha}function an(et,o){const _=.5/Math.tan(.5*o);return[et.range[0]+_,et.range[1]+_]}function $s(et,o,_,rt,ot){const lt=c.af([],[o,_,rt],ot.mercatorFogMatrix);return Ws(et,c.ag(lt),ot.pitch,ot._fov)}function In(et,o,_,rt,ot,lt,ut){const dt=[[_,rt,0],[ot,rt,0],[ot,lt,0],[_,lt,0]];let mt=Number.MAX_VALUE,Tt=-Number.MAX_VALUE;for(const Ct of dt){const Ut=c.af([],Ct,o),Bt=c.ag(Ut);mt=Math.min(mt,Bt),Tt=Math.max(Tt,Bt)}return[Ws(et,mt,ut.pitch,ut._fov),Ws(et,Tt,ut.pitch,ut._fov)]}const An=c.a6.fog;class Tn extends c.E{constructor(o,_,rt,ot){super();const lt=new c.a9({range:new c.aa(An.range),color:new c.aa(An.color),"color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new c.aa(An["high-color"]),"high-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new c.aa(An["space-color"]),"space-color-use-theme":new c.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new c.aa(An["horizon-blend"]),"star-intensity":new c.aa(An["star-intensity"]),"vertical-range":new c.aa(An["vertical-range"])});this._transitionable=new c.a8(lt,rt,new Map(ot)),this.set(o,ot),this._transitioning=this._transitionable.untransitioned(),this._transform=_,this.properties=new c.ai(lt),this.scope=rt}get state(){const o=this._transform,_=o.projection.name==="globe",rt=c.aj(o.zoom),ot=this.properties.get("range"),lt=[.5,3];return{range:_?[c.ak(lt[0],ot[0],rt),c.ak(lt[1],ot[1],rt)]:ot,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,_,rt={}){if(this._validate(qo,o,rt))return;const ot=Object.assign({},o);for(const lt of Object.keys(An))ot[lt]===void 0&&(ot[lt]=An[lt].default);this._options=ot,this._transitionable.setTransitionOrValue(this._options,_)}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const _=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:c.ah(Jr,Es,o))*_.a}getOpacityAtLatLng(o,_){return this._transform.projection.supportsFog?function(rt,ot,lt){const ut=c.ae.fromLngLat(ot),dt=lt.elevation?lt.elevation.getAtPointOrZero(ut):0;return $s(rt,ut.x,ut.y,dt,lt)}(this.state,o,_):0}getOpacityForTile(o){if(!this._transform.projection.supportsFog)return[1,1];const _=this._transform.calculateFogTileMatrix(o.toUnwrapped());return In(this.state,_,0,0,c.al,c.al,this._transform)}getOpacityForBounds(o,_,rt,ot,lt){return this._transform.projection.supportsFog?In(this.state,o,_,rt,ot,lt,this._transform):[1,1]}getFovAdjustedRange(o){return this._transform.projection.supportsFog?an(this.state,o):[0,1]}isVisibleOnFrustum(o){if(!this._transform.projection.supportsFog)return!1;const _=[4,5,6,7];for(const rt of _){const ot=o.points[rt];let lt;if(ot[2]>=0)lt=ot;else{const ut=o.points[rt-4];lt=c.am(ut,ot,ut[2]/(ut[2]-ot[2]))}if($s(this.state,lt[0],lt[1],0,this._transform)>=hs)return!0}return!1}updateConfig(o){this._transitionable.setTransitionOrValue(this._options,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,_,rt){return(!rt||rt.validate!==!1)&&gr(this,o.call(Lo,Object.assign({value:_,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}}let Yn,El,Bl,Rl,Hl=class extends c.E{constructor(et,o,_,rt){super();const ot=Yn||(Yn=new c.a9({density:new c.aa(c.a6.snow.density),intensity:new c.aa(c.a6.snow.intensity),color:new c.aa(c.a6.snow.color),opacity:new c.aa(c.a6.snow.opacity),vignette:new c.aa(c.a6.snow.vignette),"vignette-color":new c.aa(c.a6.snow["vignette-color"]),"center-thinning":new c.aa(c.a6.snow["center-thinning"]),direction:new c.aa(c.a6.snow.direction),"flake-size":new c.aa(c.a6.snow["flake-size"])}));this._transitionable=new c.a8(ot,_,new Map(rt)),this.set(et,rt),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(ot),this.scope=_}get state(){const et=this.properties.get("opacity"),o=this.properties.get("color"),_=this.properties.get("direction"),rt=c.an(_[0]),ot=-Math.max(c.an(_[1]),.01),lt=[Math.cos(rt)*Math.cos(ot),Math.sin(rt)*Math.cos(ot),Math.sin(ot)],ut=this.properties.get("vignette"),dt=this.properties.get("vignette-color");return dt.a=ut,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(o.r,o.g,o.b,o.a*et),direction:lt,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:dt}}get(){return this._transitionable.serialize()}set(et,o,_={}){if(this._validate(wn,et,_))return;const rt=Object.assign({},et),ot=c.a6.snow;for(const lt of Object.keys(ot))rt[lt]===void 0&&(rt[lt]=ot[lt].default);this._options=rt,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(et){this._transitionable.setTransitionOrValue(this._options,new Map(et))}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}_validate(et,o,_){return(!_||_.validate!==!1)&&gr(this,et.call(Lo,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}},$a=class extends c.E{constructor(et,o,_,rt){super();const ot=El||(El=new c.a9({density:new c.aa(c.a6.rain.density),intensity:new c.aa(c.a6.rain.intensity),color:new c.aa(c.a6.rain.color),opacity:new c.aa(c.a6.rain.opacity),vignette:new c.aa(c.a6.rain.vignette),"vignette-color":new c.aa(c.a6.rain["vignette-color"]),"center-thinning":new c.aa(c.a6.rain["center-thinning"]),direction:new c.aa(c.a6.rain.direction),"droplet-size":new c.aa(c.a6.rain["droplet-size"]),"distortion-strength":new c.aa(c.a6.rain["distortion-strength"])}));this._transitionable=new c.a8(ot,_,new Map(rt)),this.set(et,rt),this._transitioning=this._transitionable.untransitioned(),this.properties=new c.ai(ot),this.scope=_}get state(){const et=this.properties.get("opacity"),o=this.properties.get("color"),_=this.properties.get("direction"),rt=c.an(_[0]),ot=-Math.max(c.an(_[1]),.01),lt=[Math.cos(rt)*Math.cos(ot),Math.sin(rt)*Math.cos(ot),Math.sin(ot)],ut=this.properties.get("vignette-color");return ut.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new c.ao(o.r,o.g,o.b,o.a*et),direction:lt,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:ut}}get(){return this._transitionable.serialize()}set(et,o,_={}){if(this._validate(Nl,et,_))return;const rt=Object.assign({},et),ot=c.a6.rain;for(const lt of Object.keys(ot))rt[lt]===void 0&&(rt[lt]=ot[lt].default);this._options=rt,this._transitionable.setTransitionOrValue(this._options,o)}updateConfig(et){this._transitionable.setTransitionOrValue(this._options,new Map(et))}updateTransitions(et){this._transitioning=this._transitionable.transitioned(et,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(et){this.properties=this._transitioning.possiblyEvaluate(et)}_validate(et,o,_){return(!_||_.validate!==!1)&&gr(this,et.call(Lo,Object.assign({value:o,style:{glyphs:!0,sprite:!0},styleSpec:c.a6})))}};class io extends c.E{constructor(o,_,rt,ot){super(),this.scope=rt,this._options=o,this.properties=new c.ai(_),this._transitionable=new c.a8(_,rt,new Map(ot)),this._transitionable.setTransitionOrValue(o.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(o){this._transitionable.setTransitionOrValue(this._options.properties,new Map(o))}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(o,_){this._options=o,this._transitionable.setTransitionOrValue(o.properties,_)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class xl{constructor(o,_,rt){this.screenBounds=o,this.cameraPoint=rt.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,rt)}static createFromScreenPoints(o,_){let rt,ot;if(o instanceof c.P||typeof o[0]=="number"){const lt=c.P.convert(o);rt=[lt],ot=_.isPointAboveHorizon(lt)}else{const lt=c.P.convert(o[0]),ut=c.P.convert(o[1]),dt=lt.add(ut)._div(2);rt=[lt,ut],ot=c.aq(lt,ut).every(mt=>_.isPointAboveHorizon(mt))&&_.isPointAboveHorizon(dt)}return new xl(rt,ot,_)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return c.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const _=this.screenBounds[0],rt=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],ot=c.aq(_,rt,0,!1);return this.cameraPoint.y>rt.y&&(this.cameraPoint.x>_.x&&this.cameraPoint.x<rt.x?ot.splice(3,0,this.cameraPoint):this.cameraPoint.x>=rt.x?ot[2]=this.cameraPoint:this.cameraPoint.x<=_.x&&(ot[3]=this.cameraPoint)),c.ar(ot,o)}bufferedCameraGeometryGlobe(o){const _=this.screenBounds[0],rt=this.screenBounds.length===1?this.screenBounds[0].add(new c.P(1,1)):this.screenBounds[1],ot=c.aq(_,rt,o),lt=this.cameraPoint.clone();switch(3*((lt.y>_.y)+(lt.y>rt.y))+((lt.x>_.x)+(lt.x>rt.x))){case 0:ot[0]=lt,ot[4]=lt.clone();break;case 1:ot.splice(1,0,lt);break;case 2:ot[1]=lt;break;case 3:ot.splice(4,0,lt);break;case 5:ot.splice(2,0,lt);break;case 6:ot[3]=lt;break;case 7:ot.splice(3,0,lt);break;case 8:ot[2]=lt}return ot}containsTile(o,_,rt,ot=0){const lt=Math.max(o.queryPadding,o.evaluateQueryRenderedFeaturePadding())/_._pixelsPerMercatorPixel+1,ut=rt?this._bufferedCameraMercator(lt,_):this._bufferedScreenMercator(lt,_);let dt=o.tileID.wrap+(ut.unwrapped?ot:0);const mt=ut.polygon.map(sr=>c.as(o.tileTransform,sr,dt));if(!c.at(mt,0,0,c.al,c.al))return;dt=o.tileID.wrap+(this.screenGeometryMercator.unwrapped?ot:0);const Tt=this.screenGeometryMercator.polygon.map(sr=>c.au(o.tileTransform,sr,dt)),Ct=Tt.map(sr=>new c.P(sr[0],sr[1])),Ut=_.getFreeCameraOptions().position||new c.ae(0,0,0),Bt=c.au(o.tileTransform,Ut,dt),$t=Tt.map(sr=>{const ir=c.av(sr,sr,Bt);return c.aw(ir,ir),new c.ax(Bt,ir)}),Zt=c.ay(o,1,_.zoom)*_._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:Ct,tilespaceRays:$t,bufferedTilespaceGeometry:mt,bufferedTilespaceBounds:(qt=c.az(mt),qt.min.x=c.aA(qt.min.x,0,c.al),qt.min.y=c.aA(qt.min.y,0,c.al),qt.max.x=c.aA(qt.max.x,0,c.al),qt.max.y=c.aA(qt.max.y,0,c.al),qt),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:Zt};var qt}_bufferedScreenMercator(o,_){const rt=Cl(o);if(this._screenRaycastCache[rt])return this._screenRaycastCache[rt];{let ot;return ot=_.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(o),_):{polygon:this.bufferedScreenGeometry(o).map(lt=>_.pointCoordinate3D(lt)),unwrapped:!0},this._screenRaycastCache[rt]=ot,ot}}_bufferedCameraMercator(o,_){const rt=Cl(o);if(this._cameraRaycastCache[rt])return this._cameraRaycastCache[rt];{let ot;return ot=_.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(o),_):{polygon:this.bufferedCameraGeometry(o).map(lt=>_.pointCoordinate3D(lt)),unwrapped:!0},this._cameraRaycastCache[rt]=ot,ot}}_projectAndResample(o,_){const rt=function(lt,ut){const dt=c.aB([],ut.pixelMatrix,ut.globeMatrix),mt=[0,-c.aD,0,1],Tt=[0,c.aD,0,1],Ct=[0,0,0,1];c.aC(mt,mt,dt),c.aC(Tt,Tt,dt),c.aC(Ct,Ct,dt);const Ut=new c.P(mt[0]/mt[3],mt[1]/mt[3]),Bt=new c.P(Tt[0]/Tt[3],Tt[1]/Tt[3]),$t=c.aE(lt,Ut)&&mt[3]<Ct[3],Zt=c.aE(lt,Bt)&&Tt[3]<Ct[3];if(!$t&&!Zt)return null;const qt=function(Tr,br,yr){for(let Pr=1;Pr<Tr.length;Pr++){const Or=Gn(br.pointCoordinate3D(Tr[Pr-1]).x),Nr=Gn(br.pointCoordinate3D(Tr[Pr]).x);if(yr<0){if(Or<Nr)return{idx:Pr,t:-Or/(Nr-1-Or)}}else if(Nr<Or)return{idx:Pr,t:(1-Or)/(Nr+1-Or)}}return null}(lt,ut,$t?-1:1);if(!qt)return null;const{idx:sr,t:ir}=qt;let cr=sr>1?Do(lt.slice(0,sr),ut):[],pr=sr<lt.length?Do(lt.slice(sr),ut):[];cr=cr.map(Tr=>new c.P(Gn(Tr.x),Tr.y)),pr=pr.map(Tr=>new c.P(Gn(Tr.x),Tr.y));const ur=[...cr];ur.length===0&&ur.push(pr[pr.length-1]);const Cr=c.ak(ur[ur.length-1].y,(pr.length===0?cr[0]:pr[0]).y,ir);let wr;return wr=$t?[new c.P(0,Cr),new c.P(0,0),new c.P(1,0),new c.P(1,Cr)]:[new c.P(1,Cr),new c.P(1,1),new c.P(0,1),new c.P(0,Cr)],ur.push(...wr),pr.length===0?ur.push(cr[0]):ur.push(...pr),{polygon:ur.map(Tr=>new c.ae(Tr.x,Tr.y)),unwrapped:!1}}(o,_);if(rt)return rt;const ot=function(lt,ut){let dt=!1,mt=-1/0,Tt=0;for(let Ut=0;Ut<lt.length-1;Ut++)lt[Ut].x>mt&&(mt=lt[Ut].x,Tt=Ut);for(let Ut=0;Ut<lt.length-1;Ut++){const Bt=(Tt+Ut)%(lt.length-1),$t=lt[Bt],Zt=lt[Bt+1];Math.abs($t.x-Zt.x)>.5&&($t.x<Zt.x?($t.x+=1,Bt===0&&(lt[lt.length-1].x+=1)):(Zt.x+=1,Bt+1===lt.length-1&&(lt[0].x+=1)),dt=!0)}const Ct=c.aF(ut.center.lng);return dt&&Ct<Math.abs(Ct-1)&&lt.forEach(Ut=>{Ut.x-=1}),{polygon:lt,unwrapped:dt}}(Do(o,_).map(lt=>new c.P(Gn(lt.x),lt.y)),_);return{polygon:ot.polygon.map(lt=>new c.ae(lt.x,lt.y)),unwrapped:ot.unwrapped}}}function Do(et,o){return c.aG(et,_=>{const rt=o.pointCoordinate3D(_);_.x=rt.x,_.y=rt.y},1/256)}function Gn(et){return et<0?1+et%1:et%1}function Cl(et){return 100*et|0}function xu(et,o,_,rt,ot){const lt=function(dt,mt){if(dt)return ot(dt);if(mt){if(et.url&&mt.tiles&&et.tiles&&delete et.tiles,mt.variants){if(!Array.isArray(mt.variants))return ot(new Error("variants must be an array"));for(const Ct of mt.variants){if(Ct==null||typeof Ct!="object"||Ct.constructor!==Object)return ot(new Error("variant must be an object"));if(!Array.isArray(Ct.capabilities))return ot(new Error("capabilities must be an array"));if(Ct.capabilities.length===1&&Ct.capabilities[0]==="meshopt"){mt=Object.assign(mt,Ct);break}}}const Tt=c.aH(Object.assign({},mt,et),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);Tt.tiles=o.canonicalizeTileset(Tt,et.url),ot(null,Tt)}},ut=function(dt,mt,Tt){if(!dt)return null;if(!mt&&!Tt)return dt;Tt=Tt||dt.worldview_default;const Ct=Object.values(dt.language||{});if(Ct.length===0)return null;const Ut=Object.values(dt.worldview||{});if(Ut.length===0)return null;const Bt=Ct.every(Zt=>Zt===mt),$t=Ut.every(Zt=>Zt===Tt);return Bt&&$t?dt:mt in(dt.language_options||{})||Tt in(dt.worldview_options||{})?null:dt.language_options&&dt.worldview_options?dt:null}(et.data,_,rt);return ut?c.o.frame(()=>lt(null,ut)):et.url?c.m(o.transformRequest(o.normalizeSourceURL(et.url,null,_,rt),c.R.Source),lt):c.o.frame(()=>{const{data:dt,...mt}=et;lt(null,mt)})}function bu(et,o){const _=Math.pow(2,o.z),rt=Math.floor(c.aF(et.getWest())*_),ot=Math.floor(c.aJ(et.getNorth())*_),lt=Math.ceil(c.aF(et.getEast())*_),ut=Math.ceil(c.aJ(et.getSouth())*_);return o.x>=rt&&o.x<lt&&o.y>=ot&&o.y<ut}class Vu{constructor(o,_,rt){this.bounds=o?c.aI.convert(this.validateBounds(o)):null,this.minzoom=_||0,this.maxzoom=rt||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}addExtraBounds(o){if(o){this.extraBounds||(this.extraBounds=[]);for(const _ of o)this.extraBounds.push(c.aI.convert(this.validateBounds(_)))}}contains(o){if(o.z>this.maxzoom||o.z<this.minzoom||this.bounds&&!bu(this.bounds,o))return!1;if(!this.extraBounds)return!0;for(const _ of this.extraBounds)if(bu(_,o))return!0;return!1}static fromTileJSON(o){if(!o.bounds&&!o.extra_bounds)return null;const _=new Vu(o.bounds,o.minzoom,o.maxzoom);return _.addExtraBounds(o.extra_bounds),_}}class Zm extends c.E{constructor(o,_,rt,ot){if(super(),this.id=o,this.dispatcher=rt,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,c.aH(_,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},_),this._collectResourceTiming=!!_.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(ot),this._tileWorkers={},this._deduped=new c.aK}load(o){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const _=Array.isArray(this.map._language)?this.map._language.join():this.map._language,rt=this.map.getWorldview();this._tileJSONRequest=xu(this._options,this.map._requestManager,_,rt,(ot,lt)=>{if(this._tileJSONRequest=null,this._loaded=!0,ot)_&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${_}`),rt&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${rt}`),this.fire(new c.y(ot));else if(lt){if(Object.assign(this,lt),this.hasWorldviews=!!lt.worldview_options,lt.worldview_default&&(this.worldviewDefault=lt.worldview_default),lt.vector_layers){this.vectorLayers=lt.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const ut of lt.vector_layers)this.vectorLayerIds.push(ut.id),lt.worldview&&lt.worldview[ut.source]&&this.localizableLayerIds.add(ut.id)}this.tileBounds=Vu.fromTileJSON(lt),us(lt.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}o&&o(ot)})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(o,_){const rt=o.tileID.canonical.url(this.tiles,this.scheme),ot=this.map._requestManager.normalizeTileURL(rt),lt=this.map._requestManager.transformRequest(ot,c.R.Tile),ut=this.map.style?this.map.style.getLut(this.scope):null,dt=ut?{image:ut.image.clone()}:null,mt={request:lt,data:void 0,uid:o.uid,tileID:o.tileID,tileZoom:o.tileZoom,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,lut:dt,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:o.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:o.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&c.h(rt)&&(mt.localizableLayerIds=this.localizableLayerIds),mt.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired")o.state==="loading"?o.reloadCallback=_:o.request=o.actor.send("reloadTile",mt,Tt.bind(this));else if(o.actor=this._tileWorkers[ot]=this._tileWorkers[ot]||this.dispatcher.getActor(),this.dispatcher.ready)o.request=o.actor.send("loadTile",mt,Tt.bind(this),void 0,!0);else{const Ct=c.aL.call({deduped:this._deduped},mt,(Ut,Bt)=>{if(Ut||!Bt)Tt.call(this,Ut);else{const $t=c.aM(Bt.responseHeaders);mt.data={rawData:Bt.rawData.slice(0),expires:$t.expires,cacheControl:$t.cacheControl},o.actor&&o.actor.send("loadTile",mt,Tt.bind(this),void 0,!0)}},!0);o.request={cancel:Ct}}function Tt(Ct,Ut){return delete o.request,o.aborted?_(null):Ct&&Ct instanceof c.aN&&Ct.status!==404?_(Ct):(Ut&&Ut.resourceTiming&&(o.resourceTiming=Ut.resourceTiming),this.map._refreshExpiredTiles&&Ut&&o.setExpiryData(Ut),o.loadVectorData(Ut,this.map.painter),c.aO(this.dispatcher),_(null,Ut),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,_){o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope}),o.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class uu extends c.E{constructor(o,_,rt,ot){super(),this.id=o,this.dispatcher=rt,this.setEventedParent(ot),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},_),Object.assign(this,c.aH(_,["url","scheme","tileSize"]))}load(o){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const _=this.map.getWorldview();this._tileJSONRequest=xu(this._options,this.map._requestManager,null,_,(rt,ot)=>{this._tileJSONRequest=null,this._loaded=!0,rt?this.fire(new c.y(rt)):ot&&(Object.assign(this,ot),ot.raster_layers&&(this.rasterLayers=ot.raster_layers,this.rasterLayerIds=this.rasterLayers.map(lt=>lt.id)),this.tileBounds=Vu.fromTileJSON(ot),us(ot.tiles),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),o&&o(rt)})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}reload(){this.cancelTileJSONRequest();const o=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(o))}setTiles(o){return this._options.tiles=o,this.reload(),this}setUrl(o){return this.url=o,this._options.url=o,this.reload(),this}onRemove(o){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,_){const rt=c.o.devicePixelRatio>=2,ot=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),rt,this.tileSize);o.request=c.n(this.map._requestManager.transformRequest(ot,c.R.Tile),(lt,ut,dt)=>{if(delete o.request,o.aborted)return o.state="unloaded",_(null);if(lt)return o.state="errored",_(lt);if(!ut)return _(null);const mt=c.aM(dt);this.map._refreshExpiredTiles&&o.setExpiryData(mt),o.setTexture(ut,this.map.painter),o.state="loaded",c.aO(this.dispatcher),_(null)})}abortTile(o,_){o.request&&(o.request.cancel(),delete o.request),_&&_()}unloadTile(o,_){o.texture&&o.texture instanceof c.T?(o.destroy(!1),o.texture&&o.texture instanceof c.T&&this.map.painter.saveTileTexture(o.texture)):o.destroy(),_&&_()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function _h([et,o],_,rt,{scaled:ot=!0}={}){const{tileSize:lt,buffer:ut}=rt,{x:dt,y:mt,z:Tt}=_;if(!isFinite(dt)||!isFinite(mt)||!isFinite(Tt))throw new Error("Invalid MRT header");const Ct=2**Tt,Ut=Ct*c.aF(et),Bt=Ct*c.aJ(o);return function([$t,Zt],qt,{scaled:sr=!0}={}){if(!qt)throw new Error("bandView is undefined");const{data:ir,tileSize:cr,buffer:pr,offset:ur,scale:Cr,dimension:wr}=qt;if($t<-pr||$t>cr+pr||Zt<-pr||Zt>cr+pr)throw new Error(`Point (${$t}, ${Zt}) out of bounds for tileSize=${cr}, buffer=${pr}`);const Tr=(Zt+pr)*(cr+2*pr)+($t+pr);if(new Uint32Array(ir.buffer)[Tr]===4294967295)return null;let br=[];br=sr?[]:new qt.data.constructor(wr);for(let yr=0;yr<wr;yr++)br[yr]=Math.round(1e12*(ir[wr*Tr+yr]*Cr+ur))/1e12;return br}([Math.min(Math.max(-ut,Math.floor((Ut-dt)*lt)),lt-1+ut),Math.min(Math.max(-ut,Math.floor((Bt-mt)*lt)),lt-1+ut)],rt,{scaled:ot})}class Cu extends uu{constructor(o,_,rt,ot){super(o,_,rt,ot),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},_)}triggerRepaint(o){const _=this.map.painter._terrain,rt=this.map.style.getSourceCache(this.id);_&&_.enabled&&rt&&_._clearRenderCacheForTile(rt.id,o.tileID),this.map.triggerRepaint()}loadTile(o,_){const rt=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),ot=this.map._requestManager.transformRequest(rt,c.R.Tile),lt={request:ot,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};o.source=this.id,o.scope=this.scope,o.requestParams=ot,o.actor||(o.actor=this.dispatcher.getActor());const ut=(dt,mt,Tt)=>{if(delete o.request,o.aborted)return o.state="unloaded",_(null);if(dt)return dt.name==="AbortError"?void 0:(o.state="errored",_(dt));if(this.map._refreshExpiredTiles&&mt){const Ct=c.aM(Tt);o.setExpiryData(Ct)}if(this.partial&&o.state!=="expired")o.state="empty";else if(!this.partial){if(!mt)return _(null);o.state="loaded",o._isHeaderLoaded=!0,o._mrt=mt}_(null)};o.request=this.partial?o.fetchHeader(void 0,ut.bind(this)):o.actor.send("loadTile",lt,ut.bind(this),void 0,!0)}abortTile(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(o,_){const rt=o.texturePerLayer;if(o.flushAllQueues(),rt.size){o.destroy(!1);for(const ot of rt.values())this.map.painter.saveTileTexture(ot)}else o.destroy()}prepareTile(o,_,rt,ot){o._isHeaderLoaded&&(o.state!=="empty"&&(o.state="reloading"),o.fetchBandForRender(_,rt,ot,(lt,ut)=>{if(lt)return o.state="errored",this.fire(new c.y(lt)),void this.triggerRepaint(o);ut&&(o._isHeaderLoaded=!0,o.setTexturePerLayer(rt,ut,this.map.painter),o.state="loaded",this.triggerRepaint(o))}))}getInitialBand(o){if(!this.rasterLayers)return 0;const _=this.rasterLayers.find(({id:lt})=>lt===o),rt=_&&_.fields,ot=rt&&rt.bands&&rt.bands;return ot?ot[0]:0}getTextureDescriptor(o,_,rt){if(!o)return;const ot=_.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!ot)return;let lt=null;_ instanceof c.aR?lt=_.paint.get("raster-array-band"):_ instanceof c.aS&&(lt=_.paint.get("raster-particle-array-band"));const ut=lt||this.getInitialBand(ot);if(ut==null)return;if(!o.textureDescriptorPerLayer.get(_.id))return void this.prepareTile(o,ot,_.id,ut);if(o.updateNeeded(_.id,ut)&&!rt)return;const dt=o.textureDescriptorPerLayer.get(_.id);return Object.assign({},dt,{texture:o.texturePerLayer.get(_.id)})}getImages(o,_){const rt=new Map;for(const ot of o)for(const lt of _){const[ut,dt]=lt.split("/"),mt=ot.getLayer(ut);if(!mt||!mt.hasBand(dt)||!mt.hasDataForBand(dt))continue;const{bytes:Tt,tileSize:Ct,buffer:Ut}=mt.getBandView(dt),Bt=Ct+2*Ut,$t={data:new c.q({width:Bt,height:Bt},Tt),pixelRatio:2,sdf:!1,usvg:!1,version:0};rt.set(lt,$t)}return rt}queryRasterArrayValueByBandId(o,_,rt){const ot=_._mrt;return new Promise(lt=>{const ut={},dt=new Set;for(const[mt,Tt]of Object.entries(ot.layers)){if(rt.layerName&&mt!==rt.layerName)continue;const Ct={};ut[mt]=Ct;for(const{bands:Ut}of Tt.dataIndex)for(const Bt of Ut)rt.bands&&!rt.bands.includes(Bt)||(dt.add(c.B(mt,Bt)),_.fetchBand(mt,null,Bt,$t=>{c.o.frame(()=>{Ct[Bt]=$t?null:_h([o.lng,o.lat],ot,Tt.getBandView(Bt)),dt.delete(c.B(mt,Bt)),dt.size===0&&lt(ut)})},!1))}dt.size===0&&lt(ut)})}_loadTileForQuery(o,_){if(this._loadTileLoaded[o.uid])return void _(null,o._mrt);if(this._loadTilePending[o.uid])return void this._loadTilePending[o.uid].push(_);this._loadTilePending[o.uid]=[_];const rt=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),ot=this.map._requestManager.transformRequest(rt,c.R.Tile);o.actor.send("loadTile",{request:ot,uid:o.uid,tileID:o.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(lt,ut,dt)=>{if(lt)return this._loadTilePending[o.uid].forEach(mt=>mt(lt,null)),void delete this._loadTilePending[o.uid];if(!ut)return this._loadTilePending[o.uid].forEach(mt=>mt(null,null)),void delete this._loadTilePending[o.uid];if(this.map._refreshExpiredTiles&&ut){const mt=c.aM(dt);o.setExpiryData(mt)}o._mrt=ut,o._isHeaderLoaded=!0,o.state="loaded",this._loadTilePending[o.uid].forEach(mt=>mt(null,ut)),this._loadTileLoaded[o.uid]=!0,delete this._loadTilePending[o.uid]},void 0,!0)}queryRasterArrayValueByAllBands(o,_,rt){return new Promise((ot,lt)=>{this._loadTileForQuery(_,(ut,dt)=>{ut?lt(ut):ot(dt?this.queryRasterArrayValueByBandId(o,_,rt):null)})})}queryRasterArrayValue(o,_){const rt=c.aT.convert(o),ot=this.findLoadedParent(rt);return ot&&ot._mrt?_.bands||!this.partial?this.queryRasterArrayValueByBandId(rt,ot,_):this.queryRasterArrayValueByAllBands(rt,ot,_):Promise.resolve(null)}findLoadedParent(o){const _=c.ae.fromLngLat(o,this.map.transform.tileSize),rt=this.maxzoom+1,ot=1<<rt,lt=Math.floor(_.x),ut=Math.floor((_.x-lt)*ot),dt=Math.floor(_.y*ot),mt=this.map.style.getSourceCache(this.id),Tt=new c.aQ(rt,lt,rt,ut,dt);return mt.findLoadedParent(Tt,this.minzoom)}}const Mp={vector:Zm,raster:uu,"raster-dem":class extends uu{constructor(et,o,_,rt){super(et,o,_,rt),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(et,o){const _=this.map._requestManager.normalizeTileURL(et.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function rt(ot,lt){ot&&(et.state="errored",o(ot)),lt&&(et.dem=lt,et.dem.onDeserialize(),et.needsHillshadePrepare=!0,et.needsDEMTextureUpload=!0,et.state="loaded",o(null))}et.request=c.n(this.map._requestManager.transformRequest(_,c.R.Tile),(function(ot,lt,ut){if(delete et.request,et.aborted)et.state="unloaded",o(null);else if(ot)et.state="errored",o(ot);else if(lt){const dt=c.aM(ut);this.map._refreshExpiredTiles&&et.setExpiryData(dt);const mt=ImageBitmap&&lt instanceof ImageBitmap&&c.r(),Tt=1-(lt.width-c.aP(lt.width))/2;Tt<1||et.neighboringTiles||(et.neighboringTiles=this._getNeighboringTiles(et.tileID));const Ct=mt?lt:c.o.getImageData(lt,Tt),Ut={uid:et.uid,tileID:et.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:Ct,encoding:this.encoding,padding:Tt};et.actor&&et.state!=="expired"||(et.actor=this.dispatcher.getActor(),et.actor.send("loadTile",Ut,rt.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(et){const o=et.canonical,_=Math.pow(2,o.z),rt=(o.x-1+_)%_,ot=o.x===0?et.wrap-1:et.wrap,lt=(o.x+1+_)%_,ut=o.x+1===_?et.wrap+1:et.wrap,dt={};return dt[new c.aQ(et.overscaledZ,ot,o.z,rt,o.y).key]={backfilled:!1},dt[new c.aQ(et.overscaledZ,ut,o.z,lt,o.y).key]={backfilled:!1},o.y>0&&(dt[new c.aQ(et.overscaledZ,ot,o.z,rt,o.y-1).key]={backfilled:!1},dt[new c.aQ(et.overscaledZ,et.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},dt[new c.aQ(et.overscaledZ,ut,o.z,lt,o.y-1).key]={backfilled:!1}),o.y+1<_&&(dt[new c.aQ(et.overscaledZ,ot,o.z,rt,o.y+1).key]={backfilled:!1},dt[new c.aQ(et.overscaledZ,et.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},dt[new c.aQ(et.overscaledZ,ut,o.z,lt,o.y+1).key]={backfilled:!1}),dt}},"raster-array":Cu,geojson:class extends c.E{constructor(et,o,_,rt){super(),this.id=et,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=_.getActor(),this.setEventedParent(rt),this._data=o.data,this._options=Object.assign({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.minzoom!==void 0&&(this.minzoom=o.minzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const ot=c.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*ot,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*ot,extent:c.al,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:c.al,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*ot,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter,dynamic:o.dynamic},o.workerOptions)}onAdd(et){this.map=et,this.setData(this._data)}setData(et){return this._data=et,this._updateWorkerData(),this}updateData(et){if(!this._options.dynamic)return this.fire(new c.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof et!="string"&&(et.type==="Feature"&&(et={type:"FeatureCollection",features:[et]}),et.type!=="FeatureCollection"))return this.fire(new c.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof et!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const o=new Map;for(const _ of this._data.features)o.set(_.id,_);for(const _ of et.features)o.set(_.id,_);this._data.features=[...o.values()]}else this._data=et;return this._updateWorkerData(!0),this}getClusterExpansionZoom(et,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:et,source:this.id,scope:this.scope},o),this}getClusterChildren(et,o){return this.actor.send("geojson.getClusterChildren",{clusterId:et,source:this.id,scope:this.scope},o),this}getClusterLeaves(et,o,_,rt){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:et,limit:o,offset:_},rt),this}_updateWorkerData(et=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.z("dataloading",{dataType:"source"})),this._loaded=!1;const o=Object.assign({append:et},this.workerOptions);o.scope=this.scope;const _=this._data;typeof _=="string"?(o.request=this.map._requestManager.transformRequest(c.o.resolveURL(_),c.R.Source),o.request.collectResourceTiming=this._collectResourceTiming):o.data=JSON.stringify(_),this._pendingLoad=this.actor.send(`${this.type}.loadData`,o,(rt,ot)=>{if(this._loaded=!0,this._pendingLoad=null,rt)this.fire(new c.y(rt));else{const lt={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&ot&&ot.resourceTiming&&ot.resourceTiming[this.id]&&(lt.resourceTiming=ot.resourceTiming[this.id]),et&&(this._partialReload=!0),this.fire(new c.z("data",lt)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(et),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const et=c.B(this.id,this.scope);this.map.style.clearSource(et),this._updateWorkerData()}loadTile(et,o){const _=et.actor?"reloadTile":"loadTile";et.actor=this.actor;const rt=this.map.style?this.map.style.getLut(this.scope):null,ot=rt?{image:rt.image.clone()}:null,lt=this._partialReload,ut={type:this.type,uid:et.uid,tileID:et.tileID,tileZoom:et.tileZoom,zoom:et.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:ot,scope:this.scope,pixelRatio:c.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:et.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:lt,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};et.request=this.actor.send(_,ut,(dt,mt)=>lt&&!mt?(et.state="loaded",o(null)):(delete et.request,et.destroy(!1),et.aborted?o(null):dt?o(dt):(et.loadVectorData(mt,this.map.painter,_==="reloadTile"),o(null))),void 0,_==="loadTile")}abortTile(et){et.request&&(et.request.cancel(),delete et.request),et.aborted=!0}unloadTile(et,o){this.actor.send("removeTile",{uid:et.uid,type:this.type,source:this.id,scope:this.scope}),et.destroy()}onRemove(et){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends c.aU{constructor(et,o,_,rt){super(et,o,_,rt),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const et=this.options;this.urls=[];for(const o of et.urls)this.urls.push(this.map._requestManager.transformRequest(o,c.R.Source).url);c.aV(this.urls,(o,_)=>{this._loaded=!0,o?this.fire(new c.y(o)):_&&(this.video=_,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(et){if(this.video){const o=this.video.seekable;et<o.start(0)||et>o.end(0)?this.fire(new c.y(new c.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=et}}getVideo(){return this.video}onAdd(et){this.map||(this.map=et,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const et=this.map.painter.context,o=et.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new c.T(et,this.video,o.RGBA8),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(et)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:c.aU,model:c.aX,"batched-model":class extends c.E{constructor(et,o,_,rt){super(),this.type="batched-model",this.id=et,this.tileSize=512,this._options=o,this.tiles=this._options.tiles,this.maxzoom=o.maxzoom||19,this.minzoom=o.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=_,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(rt)}onAdd(et){this.map=et,this.load()}reload(){this.cancelTileJSONRequest();const et=c.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(et))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(et){this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map.getWorldview();this._tileJSONRequest=xu(this._options,this.map._requestManager,o,_,(rt,ot)=>{this._tileJSONRequest=null,this._loaded=!0,rt?(o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new c.y(rt))):ot&&(Object.assign(this,ot),ot.bounds&&(this.tileBounds=new Vu(ot.bounds,this.minzoom,this.maxzoom)),us(ot.tiles,this.map._requestManager._customAccessToken),this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))),et&&et(rt)})}hasTransition(){return!1}hasTile(et){return!this.tileBounds||this.tileBounds.contains(et.canonical)}loaded(){return this._loaded}loadTile(et,o){const _=this.map._requestManager.normalizeTileURL(et.tileID.canonical.url(this.tiles,this.scheme)),rt={request:this.map._requestManager.transformRequest(_,c.R.Tile),data:void 0,uid:et.uid,tileID:et.tileID,tileZoom:et.tileZoom,zoom:et.tileID.overscaledZ,tileSize:this.tileSize*et.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:et.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:c.o.devicePixelRatio,promoteId:this.promoteId};if(et.actor&&et.state!=="expired")if(et.state==="loading")et.reloadCallback=o;else{if(et.buckets){const lt=Object.values(et.buckets);for(const ut of lt)ut.dirty=!0;return void(et.state="loaded")}et.request=et.actor.send("reloadTile",rt,ot.bind(this))}else et.actor=this.dispatcher.getActor(),et.request=et.actor.send("loadTile",rt,ot.bind(this),void 0,!0);function ot(lt,ut){return et.aborted?o(null):lt&&lt.status!==404?o(lt):(this.map._refreshExpiredTiles&&ut&&et.setExpiryData(ut),et.loadModelData(ut,this.map.painter),et.state="loaded",void o(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends c.aU{constructor(et,o,_,rt){super(et,o,_,rt),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(ot=>!Array.isArray(ot)||ot.length!==2||ot.some(lt=>typeof lt!="number"))||this.fire(new c.y(new c.V(`sources.${et}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.y(new c.V(`sources.${et}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new c.y(new c.V(`sources.${et}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof HTMLCanvasElement||this.fire(new c.y(new c.V(`sources.${et}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.y(new c.V(`sources.${et}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(et){this.map=et,this.load(),this.canvas&&this.animate&&this.play()}onRemove(et){this.pause()}prepare(){let et=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,et=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,et=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?!et&&!this._playing||this.texture instanceof c.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.T(o,this.canvas,o.gl.RGBA8,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const et of[this.canvas.width,this.canvas.height])if(isNaN(et)||et<=0)return!0;return!1}},custom:class extends c.E{constructor(et,o,_,rt){super(),this.id=et,this.type="custom",this._dataType="raster",this._dispatcher=_,this._implementation=o,this.setEventedParent(rt),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vu(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.clearTiles=this._clearTiles.bind(this),o.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,c.aH(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(et){this.map=et,this._loaded=!1,this.fire(new c.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(et),this.load()}onRemove(et){this._implementation.onRemove&&this._implementation.onRemove(et)}hasTile(et){if(this._implementation.hasTile){const{x:o,y:_,z:rt}=et.canonical;return this._implementation.hasTile({x:o,y:_,z:rt})}return!this.tileBounds||this.tileBounds.contains(et.canonical)}loadTile(et,o){const{x:_,y:rt,z:ot}=et.tileID.canonical,lt=new AbortController;et.request=Promise.resolve(this._implementation.loadTile({x:_,y:rt,z:ot},{signal:lt.signal})).then((function(ut){return delete et.request,et.aborted?(et.state="unloaded",o(null)):ut===void 0?(et.state="errored",o(null)):ut===null?(this.loadTileData(et,{width:this.tileSize,height:this.tileSize,data:null}),et.state="loaded",o(null)):function(dt){return dt instanceof ImageData||dt instanceof HTMLCanvasElement||dt instanceof ImageBitmap||dt instanceof HTMLImageElement}(ut)?(this.loadTileData(et,ut),et.state="loaded",void o(null)):(et.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(ut=>{ut.name!=="AbortError"&&(et.state="errored",o(ut))}),et.request.cancel=()=>lt.abort()}loadTileData(et,o){et.setTexture(o,this.map.painter)}unloadTile(et,o){if(et.texture&&et.texture instanceof c.T?(et.destroy(!1),et.texture&&et.texture instanceof c.T&&this.map.painter.saveTileTexture(et.texture)):et.destroy(),this._implementation.unloadTile){const{x:_,y:rt,z:ot}=et.tileID.canonical;this._implementation.unloadTile({x:_,y:rt,z:ot})}o&&o()}abortTile(et,o){et.request&&et.request.cancel&&(et.request.cancel(),delete et.request),o&&o()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(et=>({x:et.canonical.x,y:et.canonical.y,z:et.canonical.z}))}_clearTiles(){const et=c.B(this.id,this.scope);this.map.style.clearSource(et)}_update(){this.fire(new c.z("data",{dataType:"source",sourceDataType:"content"}))}}},ru=function(et,o,_,rt){const ot=new Mp[o.type](et,o,_,rt);if(ot.id!==et)throw new Error(`Expected Source id to be ${et} instead of ${ot.id}`);return c.aY(["load","abort","unload","serialize","prepare"],ot),ot};function Xm(et,o,_=""){return`${_}:${o.id||""}:${o.layer.id}:${function(rt){if("layerId"in rt)return`layer:${rt.layerId}`;{const{featuresetId:ot,importId:lt}=rt;return`featureset:${ot}${lt?`:import:${lt}`:""}`}}(et.target)}`}function bx(et,o,_,rt=""){if(et.uniqueFeatureID){const ot=Xm(et,o,rt);if(_.has(ot))return!0;_.add(ot)}return!1}function l0(et,o,_,rt,ot=!1){const lt=o.sourceCache.transform,ut=o.sourceCache.tilesIn(et,o.has3DLayers,ot);ut.sort(ly);const dt=[];for(const mt of ut){const Tt=mt.tile.queryRenderedFeatures(o,mt,_,rt,lt,ot);Object.keys(Tt).length&&dt.push({wrappedTileID:mt.tile.tileID.wrapped().key,queryResults:Tt})}for(const mt in o.layers){const Tt=o.layers[mt];if(Tt.styleLayer){const Ct=Tt.styleLayer.queryRenderedFeatures(et,o.sourceCache,rt);Object.keys(Ct).length&&dt.push({wrappedTileID:0,queryResults:Ct})}}return dt.length===0?{}:function(mt){const Tt={},Ct={};for(const Ut of mt){const Bt=Ut.queryResults,$t=Ut.wrappedTileID,Zt=Ct[$t]=Ct[$t]||{};for(const qt in Bt){const sr=Bt[qt],ir=Zt[qt]=Zt[qt]||{},cr=Tt[qt]=Tt[qt]||[];for(const pr of sr)ir[pr.featureIndex]||(ir[pr.featureIndex]=!0,cr.push(pr))}}return Tt}(dt)}function c0(et,o,_,rt,ot,lt){const ut={},dt=rt.queryRenderedSymbols(et),mt=[];for(const Tt of Object.keys(dt).map(Number))mt.push(ot[Tt]);mt.sort(ly);for(const Tt of mt){const Ct=Tt.featureIndex.lookupSymbolFeatures(dt[Tt.bucketInstanceId],Tt.bucketIndex,Tt.sourceLayerIndex,o,_,lt);for(const Ut in Ct){const Bt=ut[Ut]=ut[Ut]||[],$t=Ct[Ut];$t.sort((Zt,qt)=>{const sr=Tt.featureSortOrder;if(sr){const ir=sr.indexOf(Zt.featureIndex);return sr.indexOf(qt.featureIndex)-ir}return qt.featureIndex-Zt.featureIndex});for(const Zt of $t)Bt.push(Zt)}}return ut}function u0(et,o){const _=et.getRenderableIds().map(lt=>et.getTileByID(lt)),rt=[],ot={};for(let lt=0;lt<_.length;lt++){const ut=_[lt],dt=ut.tileID.canonical.key;ot[dt]||(ot[dt]=!0,ut.querySourceFeatures(rt,o))}return rt}function ly(et,o){const _=et.tileID,rt=o.tileID;return _.overscaledZ-rt.overscaledZ||_.canonical.y-rt.canonical.y||_.wrap-rt.wrap||_.canonical.x-rt.canonical.x}function Fp(et,o){const _={};if(!o)return _;for(const rt of et){const ot=rt.layerIds.map(lt=>o.getLayer(lt)).filter(Boolean);if(ot.length!==0){rt.layers=ot,rt.stateDependentLayerIds&&(rt.stateDependentLayers=rt.stateDependentLayerIds.map(lt=>ot.filter(ut=>ut.id===lt)[0]));for(const lt of ot)_[lt.fqid]=rt}}return _}const Uu=32,wp=33,Ep=new Uint16Array(8184);for(let et=0;et<2046;et++){let o=et+2,_=0,rt=0,ot=0,lt=0,ut=0,dt=0;for(1&o?ot=lt=ut=Uu:_=rt=dt=Uu;(o>>=1)>1;){const Tt=_+ot>>1,Ct=rt+lt>>1;1&o?(ot=_,lt=rt,_=ut,rt=dt):(_=ot,rt=lt,ot=ut,lt=dt),ut=Tt,dt=Ct}const mt=4*et;Ep[mt+0]=_,Ep[mt+1]=rt,Ep[mt+2]=ot,Ep[mt+3]=lt}const cp=new Uint16Array(2178),Lp=new Uint8Array(1089),Em=new Uint16Array(1089);function Km(et){return et===0?-.03125:et===32?.03125:0}const h0={type:2,extent:c.al,loadGeometry:()=>[[new c.P(0,0),new c.P(c.al+1,0),new c.P(c.al+1,c.al+1),new c.P(0,c.al+1),new c.P(0,0)]]};class Ym{constructor(o,_,rt,ot,lt,ut){this.tileID=o,this.uid=c.b2(),this.uses=0,this.tileSize=_,this.tileZoom=rt,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=lt,ot&&ot.style&&(this._lastUpdatedBrightness=ot.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",ot&&ot.transform&&(this.projection=ot.transform.projection),this.worldview=ut,this._hasAppearances=null}registerFadeDuration(o){const _=o+this.timeAdded;_<c.o.now()||this.fadeEndTime&&_<this.fadeEndTime||(this.fadeEndTime=_)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=c.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(o,_,rt){if(this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=Fp(o.buckets,_.style),this.hasSymbolBuckets=!1;for(const ot in this.buckets){const lt=this.buckets[ot];if(lt instanceof c.b4){if(this.hasSymbolBuckets=!0,!rt)break;lt.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const ot in this.buckets){const lt=this.buckets[ot];if(lt instanceof c.b4&&lt.hasRTLText){this.hasRTLText=!0,c.b5();break}}this.queryPadding=0;for(const ot in this.buckets){const lt=this.buckets[ot],ut=_.style.getOwnLayer(ot);if(!ut)continue;const dt=ut.queryRadius(lt);this.queryPadding=Math.max(this.queryPadding,dt)}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage),o.lineAtlas&&(this.lineAtlas=o.lineAtlas),this._lastUpdatedBrightness=o.brightness}else this.collisionBoxArray=new c.b3}unloadVectorData(){if(this.hasData()){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(o,_,rt){o&&(o.resourceTiming&&(this.resourceTiming=o.resourceTiming),this.buckets=Object.assign({},this.buckets,Fp(o.buckets,_.style)),o.featureIndex&&(this.latestFeatureIndex=o.featureIndex))}getBucket(o){return this.buckets[o.fqid]}upload(o,_){for(const lt in this.buckets){const ut=this.buckets[lt];if(ut.uploadPending()){let dt={},mt=[],Tt={zoom:0,pitch:0,brightness:0,worldview:""};if(_){if(_.style){mt=_.style.listImages();const Ct=ut.layers[0],Ut=Ct.sourceLayer||"_geojsonTileLayer",Bt=_.style.getLayerSourceCache(Ct);Bt&&(dt=Bt._state.getState(Ut,void 0))}Tt={zoom:_.transform.zoom||0,pitch:_.transform.pitch||0,brightness:_.style.getBrightness()||0,worldview:_.worldview||""}}ut.upload(o,this.tileID.canonical,dt,mt,Tt)}}const rt=o.gl,ot=this.imageAtlas;ot&&!ot.uploaded&&(this.imageAtlasTexture=new c.T(o,ot.image,rt.RGBA8,{useMipmap:!!ot.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new c.T(o,this.glyphAtlasImage,rt.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new c.T(o,this.lineAtlas.image,rt.R8),this.lineAtlas.uploaded=!0)}prepare(o,_,rt){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture,rt),!_||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const ot=_.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(_)),(this._lastUpdatedBrightness||ot||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&ot&&Math.abs(this._lastUpdatedBrightness-ot)<.001||(this.updateBuckets(_,this._lastUpdatedBrightness!==ot),this._lastUpdatedBrightness=ot))}evaluateQueryRenderedFeaturePadding(){let o=0;for(const _ in this.buckets){const rt=this.buckets[_];rt.evaluateQueryRenderedFeaturePadding&&(o=Math.max(o,rt.evaluateQueryRenderedFeaturePadding()))}return o}queryRenderedFeatures(o,_,rt,ot,lt,ut){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const dt=this.evaluateQueryRenderedFeaturePadding(),mt=function(Tt,Ct){const Ut=c.bq([],[.5*Tt.width,.5*-Tt.height,1]);return c.br(Ut,Ut,[1,-1,0]),c.aB(Ut,Ut,Tt.calculateProjMatrix(Ct.toUnwrapped())),Float32Array.from(Ut)}(lt,this.tileID);return this.latestFeatureIndex.query(o,{tilespaceGeometry:_,pixelPosMatrix:mt,transform:ot,availableImages:rt,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:dt})}querySourceFeatures(o,_){const rt=this.latestFeatureIndex;if(!rt||!rt.rawTileData)return;const ot=rt.loadVTLayers(),lt=_?_.sourceLayer:"",ut=ot._geojsonTileLayer||ot[lt];if(!ut)return;const dt=c.b6(_&&_.filter),{z:mt,x:Tt,y:Ct}=this.tileID.canonical,Ut={z:mt,x:Tt,y:Ct};for(let Bt=0;Bt<ut.length;Bt++){const $t=ut.feature(Bt);if(dt.needGeometry){const sr=c.b7($t,!0);if(!dt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),sr,this.tileID.canonical))continue}else if(!dt.filter(new c.ac(this.tileID.overscaledZ,{worldview:this.worldview}),$t))continue;const Zt=rt.getId($t,lt),qt=new c.b8($t,mt,Tt,Ct,Zt);qt.tile=Ut,o.push(qt)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(o){const _=this.expirationTime;if(o.cacheControl){const rt=c.b9(o.cacheControl);rt["max-age"]&&(this.expirationTime=Date.now()+1e3*rt["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const rt=Date.now();let ot=!1;if(this.expirationTime>rt)ot=!1;else if(_)if(this.expirationTime<_)ot=!0;else{const lt=this.expirationTime-_;lt?this.expirationTime=rt+Math.max(lt,3e4):ot=!0}else ot=!0;ot?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(o){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&o&&this.updateBuckets(o)}hasAppearances(o){for(const _ in this.buckets)if(o.style.hasLayer(_)&&this.buckets[_].layers.some(rt=>rt.appearances&&rt.appearances.length>0))return!0;return!1}updateBuckets(o,_){if(!this.latestFeatureIndex||!o.style)return;const rt=o.style.listImages(),ot=o.style.getBrightness();for(const lt in this.buckets){if(!o.style.hasLayer(lt))continue;const ut=this.buckets[lt],dt=ut.layers[0],mt=dt.sourceLayer||"_geojsonTileLayer",Tt=o.style.getLayerSourceCache(dt);let Ct={};Tt&&(Ct=Tt._state.getState(mt,void 0));const Ut=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Bt=Object.keys(Ct).length>0&&!_;ut.hasAppearances=ut.layers.some(qt=>qt.appearances&&qt.appearances.length>0);const $t=Bt?ut.stateDependentLayers:ut.layers;if(Bt&&ut.stateDependentLayers.length!==0||_){const qt=this.latestFeatureIndex.loadVTLayers();ut.update(Ct,qt[mt],rt,Ut,$t,_,ot)}if(Bt&&ut.stateDependentLayers.length!==0||_||ut.hasAppearances){const qt={zoom:o.transform.zoom,pitch:o.transform.pitch,brightness:o.style.getBrightness()||0,worldview:o.worldview};ut.updateAppearances(this.tileID.canonical,Ct,rt,qt)}(ut instanceof c.ba||ut instanceof c.bb)&&o._terrain&&o._terrain.enabled&&Tt&&ut.uploadPending()&&o._terrain._clearRenderCacheForTile(Tt.id,this.tileID);const Zt=o&&o.style&&o.style.getOwnLayer(lt);Zt&&(this.queryPadding=Math.max(this.queryPadding,Zt.queryRadius(ut)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<c.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=c.o.now()+o}setTexture(o,_){const rt=_.context,ot=rt.gl;this.texture=this.texture||_.getTileTexture(o.width),this.texture&&this.texture instanceof c.T?this.texture.update(o):(this.texture=new c.T(rt,o,ot.RGBA8,{useMipmap:!0}),this.texture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE))}setDependencies(o,_){const rt={};for(const ot of _)rt[ot]=!0;this.dependencies[o]=rt}hasDependency(o,_){for(const rt of o){const ot=this.dependencies[rt];if(ot){for(const lt of _)if(ot[lt])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(o,_){if(!_||_.name==="mercator"||this._tileDebugBuffer)return;const rt=c.bc(h0,this.tileID.canonical,this.tileTransform)[0],ot=new c.bd,lt=new c.be;for(let ut=0;ut<rt.length;ut++){const{x:dt,y:mt}=rt[ut];ot.emplaceBack(dt,mt),lt.emplaceBack(ut)}lt.emplaceBack(0),this._tileDebugIndexBuffer=o.createIndexBuffer(lt),this._tileDebugBuffer=o.createVertexBuffer(ot,c.bf.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,ot.length,lt.length)}_makeTileBoundsBuffers(o,_){if(this._tileBoundsBuffer||!_||_.name==="mercator")return;const rt=c.bc(h0,this.tileID.canonical,this.tileTransform)[0];let ot,lt;if(this.isRaster){const ut=function(dt,mt){const Tt=c.aZ(dt,mt),Ct=Math.pow(2,dt.z);for(let sr=0;sr<wp;sr++)for(let ir=0;ir<wp;ir++){const cr=c.a_((dt.x+(ir+Km(ir))/Uu)/Ct),pr=c.a$((dt.y+(sr+Km(sr))/Uu)/Ct),ur=mt.project(cr,pr),Cr=sr*wp+ir;cp[2*Cr+0]=Math.round((ur.x*Tt.scale-Tt.x)*c.al),cp[2*Cr+1]=Math.round((ur.y*Tt.scale-Tt.y)*c.al)}Lp.fill(0),Em.fill(0);for(let sr=2045;sr>=0;sr--){const ir=4*sr,cr=Ep[ir+0],pr=Ep[ir+1],ur=Ep[ir+2],Cr=Ep[ir+3],wr=cr+ur>>1,Tr=pr+Cr>>1,br=wr+Tr-pr,yr=Tr+cr-wr,Pr=pr*wp+cr,Or=Cr*wp+ur,Nr=Tr*wp+wr,ts=Math.hypot((cp[2*Pr+0]+cp[2*Or+0])/2-cp[2*Nr+0],(cp[2*Pr+1]+cp[2*Or+1])/2-cp[2*Nr+1])>=16;Lp[Nr]=Lp[Nr]||(ts?1:0),sr<1022&&(Lp[Nr]=Lp[Nr]||Lp[(pr+yr>>1)*wp+(cr+br>>1)]||Lp[(Cr+yr>>1)*wp+(ur+br>>1)])}const Ut=new c.b1,Bt=new c.b0;let $t=0;function Zt(sr,ir){const cr=ir*wp+sr;return Em[cr]===0&&(Ut.emplaceBack(cp[2*cr+0],cp[2*cr+1],sr*c.al/Uu,ir*c.al/Uu),Em[cr]=++$t),Em[cr]-1}function qt(sr,ir,cr,pr,ur,Cr){const wr=sr+cr>>1,Tr=ir+pr>>1;if(Math.abs(sr-ur)+Math.abs(ir-Cr)>1&&Lp[Tr*wp+wr])qt(ur,Cr,sr,ir,wr,Tr),qt(cr,pr,ur,Cr,wr,Tr);else{const br=Zt(sr,ir),yr=Zt(cr,pr),Pr=Zt(ur,Cr);Bt.emplaceBack(br,yr,Pr)}}return qt(0,0,Uu,Uu,Uu,0),qt(Uu,Uu,0,0,0,Uu),{vertices:Ut,indices:Bt}}(this.tileID.canonical,_);ot=ut.vertices,lt=ut.indices}else{ot=new c.b1,lt=new c.b0;for(const{x:dt,y:mt}of rt)ot.emplaceBack(dt,mt,0,0);const ut=c.bh(ot.int16.subarray(0,4*ot.length),void 0,4);for(let dt=0;dt<ut.length;dt+=3)lt.emplaceBack(ut[dt],ut[dt+1],ut[dt+2])}this._tileBoundsBuffer=o.createVertexBuffer(ot,c.bi.members),this._tileBoundsIndexBuffer=o.createIndexBuffer(lt),this._tileBoundsSegments=c.bg.simpleSegment(0,0,ot.length,lt.length)}_makeGlobeTileDebugBuffers(o,_){const rt=_.projection;if(!rt||rt.name!=="globe"||_.freezeTileCoverage)return;const ot=this.tileID.canonical,lt=c.bj(ot,_),ut=c.bk(lt),dt=c.aj(_.zoom);let mt;dt>0&&(mt=c.bl(new Float64Array(16),_.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(o,ot,_,ut,mt,dt),this._makeGlobeTileDebugTextBuffer(o,ot,_,ut,mt,dt)}_globePoint(o,_,rt,ot,lt,ut,dt){let mt=c.bm(o,_,rt);if(ut){const Tt=1<<rt.z,Ct=c.aF(ot.center.lng),Ut=c.aJ(ot.center.lat),Bt=(rt.x+.5)/Tt-Ct;let $t=0;Bt>.5?$t=-1:Bt<-.5&&($t=1);let Zt=(o/c.al+rt.x)/Tt+$t,qt=(_/c.al+rt.y)/Tt;Zt=(Zt-Ct)*ot._pixelsPerMercatorPixel+Ct,qt=(qt-Ut)*ot._pixelsPerMercatorPixel+Ut;const sr=[Zt*ot.worldSize,qt*ot.worldSize,0];c.af(sr,sr,ut),mt=c.bn(mt,sr,dt)}return c.af(mt,mt,lt)}_makeGlobeTileDebugBorderBuffer(o,_,rt,ot,lt,ut){const dt=new c.bd,mt=new c.be,Tt=new c.bo,Ct=(Bt,$t,Zt,qt,sr)=>{const ir=(Zt-Bt)/(sr-1),cr=(qt-$t)/(sr-1),pr=dt.length;for(let ur=0;ur<sr;ur++){const Cr=Bt+ur*ir,wr=$t+ur*cr;dt.emplaceBack(Cr,wr);const Tr=this._globePoint(Cr,wr,_,rt,ot,lt,ut);Tt.emplaceBack(Tr[0],Tr[1],Tr[2]),mt.emplaceBack(pr+ur)}},Ut=c.al;Ct(0,0,Ut,0,16),Ct(Ut,0,Ut,Ut,16),Ct(Ut,Ut,0,Ut,16),Ct(0,Ut,0,0,16),this._tileDebugIndexBuffer=o.createIndexBuffer(mt),this._tileDebugBuffer=o.createVertexBuffer(dt,c.bf.members),this._globeTileDebugBorderBuffer=o.createVertexBuffer(Tt,c.bp.members),this._tileDebugSegments=c.bg.simpleSegment(0,0,dt.length,mt.length)}_makeGlobeTileDebugTextBuffer(o,_,rt,ot,lt,ut){const dt=c.al/4,mt=new c.bd,Tt=new c.b0,Ct=new c.bo,Ut=25;Tt.reserve(32),mt.reserve(Ut),Ct.reserve(Ut);const Bt=($t,Zt)=>Ut*$t+Zt;for(let $t=0;$t<Ut;$t++){const Zt=$t*dt;for(let qt=0;qt<Ut;qt++){const sr=qt*dt;mt.emplaceBack(sr,Zt);const ir=this._globePoint(sr,Zt,_,rt,ot,lt,ut);Ct.emplaceBack(ir[0],ir[1],ir[2])}}for(let $t=0;$t<4;$t++)for(let Zt=0;Zt<4;Zt++){const qt=Bt($t,Zt),sr=Bt($t,Zt+1),ir=Bt($t+1,Zt),cr=Bt($t+1,Zt+1);Tt.emplaceBack(qt,sr,ir),Tt.emplaceBack(ir,sr,cr)}this._tileDebugTextIndexBuffer=o.createIndexBuffer(Tt),this._tileDebugTextBuffer=o.createVertexBuffer(mt,c.bf.members),this._globeTileDebugTextBuffer=o.createVertexBuffer(Ct,c.bp.members),this._tileDebugTextSegments=c.bg.simpleSegment(0,0,Ut,32)}destroy(o=!0){for(const _ in this.buckets)this.buckets[_].destroy(o);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),o&&this.texture&&this.texture instanceof c.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof c.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}c.bs.setPbf(c.bt);class d0 extends Ym{constructor(o,_,rt,ot,lt){super(o,_,rt,ot,lt),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(o){return this._mrt&&this._mrt.getLayer(o)}setTexturePerLayer(o,_,rt){const ot=rt.context,lt=ot.gl;let ut=this.texturePerLayer.get(o)||rt.getTileTexture(_.width);ut&&ut instanceof c.T?ut.update(_,{premultiply:!1}):ut=new c.T(ot,_,lt.RGBA8,{premultiply:!1}),this.texturePerLayer.has(o)||this.texturePerLayer.set(o,ut)}flushQueues(o){const _=this._workQueuePerLayer.get(o)||[],rt=this._fetchQueuePerLayer.get(o)||[];for(;_.length;)_.pop()();for(;rt.length;)rt.pop()()}flushAllQueues(){for(const o of this._workQueuePerLayer.keys()){const _=this._workQueuePerLayer.get(o)||[];for(;_.length;)_.pop()()}for(const o of this._fetchQueuePerLayer.keys()){const _=this._fetchQueuePerLayer.get(o)||[];for(;_.length;)_.pop()()}}fetchHeader(o=16384,_){const rt=this._mrt=new c.bs(30),ot=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(o-1)}});return this.entireBuffer=null,this.request=c.bu(ot,(lt,ut,dt)=>{if(lt)_(lt);else try{const mt=rt.getHeaderLength(ut);if(mt>o)return void(this.request=this.fetchHeader(mt,_));rt.parseHeader(ut),this._isHeaderLoaded=!0;let Tt=0;for(const Ct of Object.values(rt.layers))Tt=Math.max(Tt,Ct.dataIndex[Ct.dataIndex.length-1].lastByte);ut.byteLength>=Tt&&(this.entireBuffer=ut),_(null,this.entireBuffer||ut,dt)}catch(mt){_(mt)}}),this.request}fetchBandForRender(o,_,rt,ot){this.fetchBand(o,_,rt,lt=>{if(lt)return void ot(lt);this.updateTextureDescriptor(o,_,rt);const ut=this.textureDescriptorPerLayer.get(_);ot(null,ut?ut.img:null)})}fetchBand(o,_,rt,ot,lt=!0){const ut=this._mrt;if(!this._isHeaderLoaded||!ut)return void ot(new Error("Tile header is not ready"));const dt=this.actor;if(!dt)return void ot(new Error("Can't fetch tile band without an actor"));let mt;const Tt=c.B(String(rt),c.B(this.tileID.key,o));let Ct=this._taskQueue.get(Tt);Ct?Ct.add(ot):(Ct=new Set,Ct.add(ot),this._taskQueue.set(Tt,Ct));const Ut=(qt,sr)=>{mt.complete(qt,sr),qt?ot(qt):(Ct.forEach(ir=>ir(null,sr)),this._taskQueue.delete(Tt))},Bt=(qt,sr)=>{if(qt)return ot(qt);const ir=dt.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:sr,task:mt},Ut,void 0,!0);if(_!==null){const cr=this._workQueuePerLayer.get(_)||[];cr.push(()=>{ir&&ir.cancel(),mt.cancel()}),this._workQueuePerLayer.has(_)||this._workQueuePerLayer.set(_,cr)}};let $t;try{$t=ut.getLayer(o)}catch(qt){if(this.state==="reloading")return;throw qt}if(!$t)return void ot(new Error(`Unknown sourceLayer "${o}"`));if($t.hasDataForBand(rt))return Ct.forEach(qt=>qt(null,null)),void this._taskQueue.delete(Tt);const Zt=$t.getDataRange([rt]);if(mt=ut.createDecodingTask(Zt),!mt||mt.tasks.length)if(_!==null&&this.flushQueues(_),this.entireBuffer)Bt(null,this.entireBuffer.slice(Zt.firstByte,Zt.lastByte+1));else{const qt=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Zt.firstByte}-${Zt.lastByte}`}}),sr=c.bu(qt,Bt);if(_!==null){const ir=this._fetchQueuePerLayer.get(_)||[];ir.push(()=>{sr.cancel(),mt.cancel()}),this._fetchQueuePerLayer.has(_)||this._fetchQueuePerLayer.set(_,ir)}}}updateNeeded(o,_){return(!this.textureDescriptorPerLayer.get(o)||this.textureDescriptorPerLayer.get(o).band!==_||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(o,_,rt){if(!this._mrt)return;const ot=this._mrt.getLayer(o);if(!ot||!ot.hasBand(rt)||!ot.hasDataForBand(rt))return;const{bytes:lt,tileSize:ut,buffer:dt,offset:mt,scale:Tt}=ot.getBandView(rt),Ct=ut+2*dt,Ut=new c.q({width:Ct,height:Ct},lt),Bt=this.texturePerLayer.get(_);Bt&&Bt instanceof c.T&&Bt.update(Ut,{premultiply:!1}),this.textureDescriptorPerLayer.set(_,{layer:o,band:rt,img:Ut,buffer:dt,offset:mt,tileSize:ut,format:ot.pixelFormat,mix:[Tt,256*Tt,65536*Tt,16777216*Tt]})}destroy(o=!1){if(super.destroy(o),delete this._mrt,!o)for(const _ of this.texturePerLayer.values())_&&_ instanceof c.T&&_.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Q1{constructor(o,_){this.max=o,this.onRemove=_,this.reset()}reset(){for(const o in this.data)for(const _ of this.data[o])_.timeout&&clearTimeout(_.timeout),this.onRemove(_.value);return this.data={},this.order=[],this}add(o,_,rt){const ot=o.wrapped().key;this.data[ot]===void 0&&(this.data[ot]=[]);const lt={value:_,timeout:void 0};if(rt!==void 0&&(lt.timeout=setTimeout(()=>{this.remove(o,lt)},rt)),this.data[ot].push(lt),this.order.push(ot),this.order.length>this.max){const ut=this._getAndRemoveByKey(this.order[0]);ut&&this.onRemove(ut)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const _=this.data[o].shift();return _.timeout&&clearTimeout(_.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),_.value}getByKey(o){const _=this.data[o];return _?_[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,_){if(!this.has(o))return this;const rt=o.wrapped().key,ot=_===void 0?0:this.data[rt].indexOf(_),lt=this.data[rt][ot];return this.data[rt].splice(ot,1),lt.timeout&&clearTimeout(lt.timeout),this.data[rt].length===0&&delete this.data[rt],this.onRemove(lt.value),this.order.splice(this.order.indexOf(rt),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}filter(o){const _=[];for(const rt in this.data)for(const ot of this.data[rt])o(ot.value)||_.push(ot);for(const rt of _)this.remove(rt.value.tileID,rt)}}class cy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,_,rt){const ot=String(_);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][ot]=this.stateChanges[o][ot]||{},Object.assign(this.stateChanges[o][ot],rt),this.deletedStates[o]===null){this.deletedStates[o]={};for(const lt in this.state[o])lt!==ot&&(this.deletedStates[o][lt]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][ot]===null){this.deletedStates[o][ot]={};for(const lt in this.state[o][ot])rt[lt]||(this.deletedStates[o][ot][lt]=null)}else for(const lt in rt)this.deletedStates[o]&&this.deletedStates[o][ot]&&this.deletedStates[o][ot][lt]===null&&delete this.deletedStates[o][ot][lt]}removeFeatureState(o,_,rt){if(this.deletedStates[o]===null)return;const ot=String(_);if(this.deletedStates[o]=this.deletedStates[o]||{},rt&&_!==void 0)this.deletedStates[o][ot]!==null&&(this.deletedStates[o][ot]=this.deletedStates[o][ot]||{},this.deletedStates[o][ot][rt]=null);else if(_!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][ot])for(rt in this.deletedStates[o][ot]={},this.stateChanges[o][ot])this.deletedStates[o][ot][rt]=null;else this.deletedStates[o][ot]=null;else this.deletedStates[o]=null}getState(o,_){const rt=this.state[o]||{},ot=this.stateChanges[o]||{},lt=this.deletedStates[o];if(lt===null)return{};if(_!==void 0){const dt=String(_),mt=Object.assign({},rt[dt],ot[dt]);if(lt){const Tt=lt[_];if(Tt===null)return{};for(const Ct in Tt)delete mt[Ct]}return mt}const ut=Object.assign({},rt,ot);if(lt)for(const dt in lt)delete ut[dt];return ut}initializeTileState(o,_){o.refreshFeatureState(_)}coalesceChanges(o,_){const rt={};for(const ot in this.stateChanges){this.state[ot]=this.state[ot]||{};const lt={};for(const ut in this.stateChanges[ot])this.state[ot][ut]||(this.state[ot][ut]={}),Object.assign(this.state[ot][ut],this.stateChanges[ot][ut]),lt[ut]=this.state[ot][ut];rt[ot]=lt}for(const ot in this.deletedStates){this.state[ot]=this.state[ot]||{};const lt={};if(this.deletedStates[ot]===null)for(const ut in this.state[ot])lt[ut]={},this.state[ot][ut]={};else for(const ut in this.deletedStates[ot]){if(this.deletedStates[ot][ut]===null)this.state[ot][ut]={};else if(this.state[ot][ut])for(const dt of Object.keys(this.deletedStates[ot][ut]))delete this.state[ot][ut][dt];lt[ut]=this.state[ot][ut]}rt[ot]=rt[ot]||{},Object.assign(rt[ot],lt)}if(this.stateChanges={},this.deletedStates={},Object.keys(rt).length!==0)for(const ot in o)o[ot].refreshFeatureState(_)}}class Xu extends c.E{constructor(o,_,rt){super(),this.id=o,this._onlySymbols=rt,_.on("data",ot=>{ot.dataType==="source"&&ot.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&ot.dataType==="source"&&ot.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),_.on("error",()=>{this._sourceErrored=!0}),this._source=_,this._tiles={},this._cache=new Q1(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new cy,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(o){this.map=o,this._minTileCacheSize=this._minTileCacheSize===void 0&&o?o._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&o?o._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const o in this._tiles)if(!this._tiles[o].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(o,_){return o.isSymbolTile=this._onlySymbols,o.isExtraShadowCaster=this._shadowCasterTiles[o.tileID.key],this._source.loadTile(o,_)}_unloadTile(o){if(this._source.unloadTile)return this._source.unloadTile(o)}_abortTile(o){if(this._source.abortTile)return this._source.abortTile(o)}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const _ in this._tiles){const rt=this._tiles[_];rt.upload(o,this.map?this.map.painter:void 0),rt.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(f0).map(o=>o.key)}getRenderableIds(o,_){const rt=[];for(const ot in this._tiles)this._isIdRenderable(+ot,o,_)&&rt.push(this._tiles[ot]);return o?rt.sort((ot,lt)=>{const ut=ot.tileID,dt=lt.tileID,mt=new c.P(ut.canonical.x,ut.canonical.y)._rotate(this.transform.angle),Tt=new c.P(dt.canonical.x,dt.canonical.y)._rotate(this.transform.angle);return ut.overscaledZ-dt.overscaledZ||Tt.y-mt.y||Tt.x-mt.x}).map(ot=>ot.tileID.key):rt.map(ot=>ot.tileID).sort(f0).map(ot=>ot.key)}hasRenderableParent(o){const _=this.findLoadedParent(o,0);return!!_&&this._isIdRenderable(_.tileID.key)}_isIdRenderable(o,_,rt){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(_||!this._tiles[o].holdingForFade())&&(rt||!this._shadowCasterTiles[o])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(+o,"reloading")}}_reloadTile(o,_){const rt=this._tiles[o];rt&&(rt.state!=="loading"&&(rt.state=_),this._loadTile(rt,this._tileLoaded.bind(this,rt,o,_)))}_tileLoaded(o,_,rt,ot,lt){if(ot){if(o.state="errored",ot.status!==404)this._source.fire(new c.y(ot,{tile:o}));else{if(this._source.fire(new c.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:o})),!(o.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const dt=this.map.painter.terrain;this.update(this.transform,dt.getScaledDemTileSize(),!0),dt.resetTileLookupCache(this.id)}else this.update(this.transform)}return}o.timeAdded=c.o.now(),rt==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(_,o),this._source.type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null);let ut=new Map;lt&&lt.responseHeaders&&(ut=lt.responseHeaders),this._source.fire(new c.z("data",{dataType:"source",tile:o,coord:o.tileID,sourceCacheId:this.id,responseHeaders:ut}))}_backfillDEM(o){const _=this.getRenderableIds();for(let ot=0;ot<_.length;ot++){const lt=_[ot];if(o.neighboringTiles&&o.neighboringTiles[lt]){const ut=this.getTileByID(lt);rt(o,ut),rt(ut,o)}}function rt(ot,lt){if(!ot.dem||ot.dem.borderReady)return;ot.needsHillshadePrepare=!0,ot.needsDEMTextureUpload=!0;let ut=lt.tileID.canonical.x-ot.tileID.canonical.x;const dt=lt.tileID.canonical.y-ot.tileID.canonical.y,mt=Math.pow(2,ot.tileID.canonical.z),Tt=lt.tileID.key;ut===0&&dt===0||Math.abs(dt)>1||(Math.abs(ut)>1&&(Math.abs(ut+mt)===1?ut+=mt:Math.abs(ut-mt)===1&&(ut-=mt)),lt.dem&&ot.dem&&(ot.dem.backfillBorder(lt.dem,ut,dt),ot.neighboringTiles&&ot.neighboringTiles[Tt]&&(ot.neighboringTiles[Tt].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,_,rt,ot){for(const lt in this._tiles){let ut=this._tiles[lt];if(ot[lt]||!ut.hasData()||ut.tileID.overscaledZ<=_||ut.tileID.overscaledZ>rt)continue;let dt=ut.tileID;for(;ut&&ut.tileID.overscaledZ>_+1;){const Tt=ut.tileID.scaledTo(ut.tileID.overscaledZ-1);ut=this._tiles[Tt.key],ut&&ut.hasData()&&(dt=Tt)}let mt=dt;for(;mt.overscaledZ>_;)if(mt=mt.scaledTo(mt.overscaledZ-1),o[mt.key]){ot[dt.key]=dt;break}}}findLoadedParent(o,_){if(o.key in this._loadedParentTiles){const rt=this._loadedParentTiles[o.key];return rt&&rt.tileID.overscaledZ>=_?rt:null}for(let rt=o.overscaledZ-1;rt>=_;rt--){const ot=o.scaledTo(rt),lt=this._getLoadedTile(ot);if(lt)return lt}}_getLoadedTile(o){const _=this._tiles[o.key];return _&&_.hasData()?_:this._cache.getByKey(this._source.reparseOverscaled?o.wrapped().key:o.canonical.key)}updateCacheSize(o,_){_=_||this._source.tileSize;const rt=Math.ceil(o.width/_)+1,ot=Math.ceil(o.height/_)+1,lt=Math.floor(rt*ot*5),ut=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,lt):lt,dt=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,ut):ut;this._cache.setMaxSize(dt)}handleWrapJump(o){const _=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,_){const rt={};for(const ot in this._tiles){const lt=this._tiles[ot];lt.tileID=lt.tileID.unwrapTo(lt.tileID.wrap+_),rt[lt.tileID.key]=lt}this._tiles=rt;for(const ot in this._timers)clearTimeout(this._timers[ot]),delete this._timers[ot];for(const ot in this._tiles)this._setTileReloadTimer(+ot,this._tiles[ot])}}update(o,_,rt,ot,lt){if(this.transform=o,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!rt)return;this.updateCacheSize(o,_),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const ut=this._source.type==="batched-model";let dt,mt=this._source.maxzoom;const Tt=this.map&&this.map.painter?this.map.painter._terrain:null;if(Tt&&Tt.sourceCache===this&&Tt.attenuationRange()){const Bt=Tt.attenuationRange()[0],$t=Math.floor(Bt)-Math.log2(Tt.getDemUpscale());mt>$t&&(mt=$t)}if(this.used||this.usedForTerrain){if(this._source.tileID)dt=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(Bt=>new c.aQ(Bt.canonical.z,Bt.wrap,Bt.canonical.z,Bt.canonical.x,Bt.canonical.y));else if(this.tileCoverLift!==0){const Bt=o.clone();Bt.tileCoverLift=this.tileCoverLift,dt=Bt.coveringTiles({tileSize:_||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:mt,roundZoom:this._source.roundZoom&&!rt,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:ut}),this._source.minzoom<=1&&o.projection.name==="globe"&&(dt.push(new c.aQ(1,0,1,0,0)),dt.push(new c.aQ(1,0,1,1,0)),dt.push(new c.aQ(1,0,1,0,1)),dt.push(new c.aQ(1,0,1,1,1)))}else if(dt=o.coveringTiles({tileSize:_||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:mt,roundZoom:this._source.roundZoom&&!rt,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:ut}),this._source.hasTile){const Bt=this._source.hasTile.bind(this._source);dt=dt.filter($t=>Bt($t))}}else dt=[];if(dt.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Qm(this._source.type)){const Bt=o.coveringZoomLevel({tileSize:_||this._source.tileSize,roundZoom:this._source.roundZoom&&!rt}),$t=Math.min(Bt,this._source.maxzoom);if(ut){const Zt=o.extendTileCover(dt,$t);for(const qt of Zt)dt.push(qt)}else if(lt){const Zt=o.extendTileCoverToNearPlane(dt,this.transform.getFrustum($t),$t);for(const qt of Zt)dt.push(qt)}else if(this.castsShadows&&ot){const Zt=o.extendTileCover(dt,$t,ot,16);for(const qt of Zt)this._shadowCasterTiles[qt.key]=!0,dt.push(qt)}}const Ct=this._updateRetainedTiles(dt);if(Qm(this._source.type)&&dt.length!==0){const Bt={},$t={},Zt=Object.keys(Ct);for(const sr of Zt){const ir=Ct[sr],cr=this._tiles[sr];if(!cr||cr.fadeEndTime&&cr.fadeEndTime<=c.o.now())continue;const pr=this.findLoadedParent(ir,Math.max(ir.overscaledZ-Xu.maxOverzooming,this._source.minzoom));pr&&(this._addTile(pr.tileID),Bt[pr.tileID.key]=pr.tileID),$t[sr]=ir}const qt=dt[dt.length-1].overscaledZ;for(const sr in this._tiles){const ir=this._tiles[sr];if(Ct[sr]||!ir.hasData())continue;let cr=ir.tileID;for(;cr.overscaledZ>qt;){cr=cr.scaledTo(cr.overscaledZ-1);const pr=this._tiles[cr.key];if(pr&&pr.hasData()&&$t[cr.key]){Ct[sr]=ir.tileID;break}}}for(const sr in Bt)Ct[sr]||(this._coveredTiles[sr]=!0,Ct[sr]=Bt[sr])}for(const Bt in Ct)this._tiles[Bt].clearFadeHold();const Ut=c.bv(this._tiles,Ct);for(const Bt of Ut){const $t=this._tiles[Bt];$t.hasSymbolBuckets&&!$t.holdingForFade()?$t.setHoldDuration(this.map._fadeDuration):$t.hasSymbolBuckets&&!$t.symbolFadeFinished()||this._removeTile(+Bt)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(+o)}_updateRetainedTiles(o){const _={};if(o.length===0)return _;const rt={},ot=o.reduce((Tt,Ct)=>Math.min(Tt,Ct.overscaledZ),1/0),lt=o[0].overscaledZ,ut=Math.max(lt-Xu.maxOverzooming,this._source.minzoom),dt=Math.max(lt+Xu.maxUnderzooming,this._source.minzoom),mt={};for(const Tt of o){const Ct=this._addTile(Tt);_[Tt.key]=Tt,Ct.hasData()||ot<this._source.maxzoom&&(mt[Tt.key]=Tt)}this._retainLoadedChildren(mt,ot,dt,_);for(const Tt of o){let Ct=this._tiles[Tt.key];if(Ct.hasData())continue;if(Tt.canonical.z>=this._source.maxzoom){const Bt=Tt.children(this._source.maxzoom)[0],$t=this.getTile(Bt);if($t&&$t.hasData()){_[Bt.key]=Bt;continue}}else{const Bt=Tt.children(this._source.maxzoom);if(_[Bt[0].key]&&_[Bt[1].key]&&_[Bt[2].key]&&_[Bt[3].key])continue}let Ut=Ct.wasRequested();for(let Bt=Tt.overscaledZ-1;Bt>=ut;--Bt){const $t=Tt.scaledTo(Bt);if(rt[$t.key]||(rt[$t.key]=!0,Ct=this.getTile($t),!Ct&&Ut&&(Ct=this._addTile($t)),Ct&&(_[$t.key]=$t,Ut=Ct.wasRequested(),Ct.hasData())))break}}return _}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const _=[];let rt,ot=this._tiles[o].tileID;for(;ot.overscaledZ>0;){if(ot.key in this._loadedParentTiles){rt=this._loadedParentTiles[ot.key];break}_.push(ot.key);const lt=ot.scaledTo(ot.overscaledZ-1);if(rt=this._getLoadedTile(lt),rt)break;ot=lt}for(const lt of _)this._loadedParentTiles[lt]=rt}}_addTile(o){let _=this._tiles[o.key];if(_)return _.isExtraShadowCaster!==!0||this._shadowCasterTiles[o.key]||this._reloadTile(o.key,"reloading"),_;_=this._cache.getAndRemove(o),_&&(this._setTileReloadTimer(o.key,_),_.tileID=o,this._state.initializeTileState(_,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,_)));const rt=!!_;if(!rt){const ot=this.map?this.map.painter:null,lt=this._source.tileSize*o.overscaleFactor();_=this._source.type==="raster-array"?new d0(o,lt,this.transform.tileZoom,ot,this._isRaster):new Ym(o,lt,this.transform.tileZoom,ot,this._isRaster,this._source.worldview),this._loadTile(_,this._tileLoaded.bind(this,_,o.key,_.state))}return _.uses++,this._tiles[o.key]=_,rt||this._source.fire(new c.z("dataloading",{tile:_,coord:_.tileID,dataType:"source"})),_}_setTileReloadTimer(o,_){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const rt=_.getExpiryTimeout();rt&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},rt))}_removeTile(o){const _=this._tiles[o];_&&(_.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),_.uses>0||(_.hasData()&&_.state!=="reloading"||_.state==="empty"?this._cache.add(_.tileID,_,_.getExpiryTimeout()):(_.aborted=!0,this._abortTile(_),this._unloadTile(_))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(+o);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(o,_,rt){const ot=[],lt=this.transform;if(!lt)return ot;const ut=lt.projection.name==="globe",dt=c.aF(lt.center.lng);for(const mt in this._tiles){const Tt=this._tiles[mt];if(rt&&Tt.clearQueryDebugViz(),Tt.holdingForFade())continue;let Ct;if(ut){const Ut=Tt.tileID.canonical;if(Ut.z===0){const Bt=[Math.abs(c.aA(dt,...Kp(Ut,-1))-dt),Math.abs(c.aA(dt,...Kp(Ut,1))-dt)];Ct=[0,2*Bt.indexOf(Math.min(...Bt))-1]}else{const Bt=[Math.abs(c.aA(dt,...Kp(Ut,-1))-dt),Math.abs(c.aA(dt,...Kp(Ut,0))-dt),Math.abs(c.aA(dt,...Kp(Ut,1))-dt)];Ct=[Bt.indexOf(Math.min(...Bt))-1]}}else Ct=[0];for(const Ut of Ct){const Bt=o.containsTile(Tt,lt,_,Ut);Bt&&ot.push(Bt)}}return ot}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(o){return this._getRenderableCoordinates(o)}_getRenderableCoordinates(o,_){const rt=this.getRenderableIds(o,_).map(lt=>this._tiles[lt].tileID),ot=this.transform.projection.name==="globe";for(const lt of rt)lt.projMatrix=this.transform.calculateProjMatrix(lt.toUnwrapped()),lt.expandedProjMatrix=ot?this.transform.calculateProjMatrix(lt.toUnwrapped(),!1,!0):lt.projMatrix;return rt}sortCoordinatesByDistance(o){const _=o.slice(),rt=this.transform._camera.position,ot=this.transform._camera.forward(),lt={};for(const ut of _){const dt=1/(1<<ut.canonical.z);lt[ut.key]=((ut.canonical.x+.5)*dt+ut.wrap-rt[0])*ot[0]+((ut.canonical.y+.5)*dt-rt[1])*ot[1]-rt[2]*ot[2]}return _.sort((ut,dt)=>lt[ut.key]-lt[dt.key]),_}hasTransition(){if(this._source.hasTransition())return!0;if(Qm(this._source.type))for(const o in this._tiles){const _=this._tiles[o];if(_.fadeEndTime!==void 0&&_.fadeEndTime>=c.o.now())return!0}return!1}setFeatureState(o,_,rt){this._state.updateState(o=o||"_geojsonTileLayer",_,rt)}removeFeatureState(o,_,rt){this._state.removeFeatureState(o=o||"_geojsonTileLayer",_,rt)}getFeatureState(o,_){return this._state.getState(o=o||"_geojsonTileLayer",_)}setDependencies(o,_,rt){const ot=this._tiles[o];ot&&ot.setDependencies(_,rt)}reloadTilesForDependencies(o,_){for(const rt in this._tiles)this._tiles[rt].hasDependency(o,_)&&this._reloadTile(+rt,"reloading");this._cache.filter(rt=>!rt.hasDependency(o,_))}_preloadTiles(o,_){if(!this._sourceLoaded){const mt=()=>{this._sourceLoaded&&(this._source.off("data",mt),this._preloadTiles(o,_))};return void this._source.on("data",mt)}const rt=new Map,ot=Array.isArray(o)?o:[o],lt=this.map.painter.terrain,ut=this.usedForTerrain&&lt?lt.getScaledDemTileSize():this._source.tileSize;for(const mt of ot){const Tt=mt.coveringTiles({tileSize:ut,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const Ct of Tt)rt.set(Ct.key,Ct);this.usedForTerrain&&mt.updateElevation(!1)}const dt=Array.from(rt.values());c.bw(dt,(mt,Tt)=>{const Ct=new Ym(mt,this._source.tileSize*mt.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(Ct,Ut=>{this._source.type==="raster-dem"&&Ct.dem&&this._backfillDEM(Ct),Tt(Ut,Ct)})},_)}}function f0(et,o){const _=Math.abs(2*et.wrap)-+(et.wrap<0),rt=Math.abs(2*o.wrap)-+(o.wrap<0);return et.overscaledZ-o.overscaledZ||rt-_||o.canonical.y-et.canonical.y||o.canonical.x-et.canonical.x}function Qm(et){return et==="raster"||et==="image"||et==="video"||et==="custom"}function Kp(et,o){const _=1<<et.z;return[et.x/_+o,(et.x+1)/_+o]}Xu.maxOverzooming=10,Xu.maxUnderzooming=3;class KE{constructor(o){this.style=o,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const o=!1,_=!1;for(const rt in this.style._mergedLayers){const ot=this.style._mergedLayers[rt];if(ot.type==="fill-extrusion"||ot.type==="building")this.layers.push({layer:ot,visible:o,visibilityChanged:_});else if(ot.type==="model"){const lt=this.style.getLayerSource(ot);lt&&lt.type==="batched-model"&&this.layers.push({layer:ot,visible:o,visibilityChanged:_})}}}onNewFrame(o){this.layersGotHidden=!1;for(const _ of this.layers){const rt=_.layer;let ot=!1;rt.type==="fill-extrusion"?ot=!rt.isHidden(o)&&rt.paint.get("fill-extrusion-opacity")>0:rt.type==="building"?ot=!rt.isHidden(o)&&rt.paint.get("building-opacity")>0:rt.type==="model"&&(ot=!rt.isHidden(o)&&rt.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!ot&&_.visible,_.visible=ot}}updateZOffset(o,_){this.currentBuildingBuckets=[];for(const ot of this.layers){const lt=ot.layer,ut=this.style.getLayerSourceCache(lt);let dt=1;lt.type==="fill-extrusion"?dt=ot.visible?lt.paint.get("fill-extrusion-vertical-scale"):0:lt.type==="building"&&(dt=ot.visible?lt.paint.get("building-vertical-scale"):0);let mt=ut?ut.getTile(_):null;if(!mt&&ut)for(const Tt in ut._tiles){const Ct=ut._tiles[Tt];if(_.canonical.isChildOf(Ct.tileID.canonical)){mt=Ct;break}}this.currentBuildingBuckets.push({bucket:mt?mt.getBucket(lt):null,tileID:mt?mt.tileID:_,verticalScale:dt})}o.hasAnyZOffset=!1;let rt=!1;for(let ot=0;ot<o.symbolInstances.length;ot++){const lt=o.symbolInstances.get(ot),ut=lt.zOffset,dt=this._getHeightAtTileOffset(_,lt.tileAnchorX,lt.tileAnchorY);lt.zOffset=dt!==Number.NEGATIVE_INFINITY?dt:ut,rt||ut===lt.zOffset||(rt=!0),o.hasAnyZOffset||lt.zOffset===0||(o.hasAnyZOffset=!0)}rt&&(o.zOffsetBuffersNeedUpload=!0,o.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(o,_,rt,ot){let lt=_,ut=rt;if(o.canonical.z!==ot.canonical.z){const dt=ot.canonical,mt=1/(1<<o.canonical.z-dt.z);lt=(_+o.canonical.x*c.al)*mt-dt.x*c.al|0,ut=(rt+o.canonical.y*c.al)*mt-dt.y*c.al|0}return{tileX:lt,tileY:ut}}_getHeightAtTileOffset(o,_,rt){let ot,lt;for(let ut=0;ut<this.layers.length;++ut){const dt=this.layers[ut].layer;if(dt.type!=="fill-extrusion"&&dt.type!=="building")continue;const{bucket:mt,tileID:Tt,verticalScale:Ct}=this.currentBuildingBuckets[ut];if(!mt)continue;const{tileX:Ut,tileY:Bt}=this._mapCoordToOverlappingTile(o,_,rt,Tt),$t=mt.getHeightAtTileCoord(Ut,Bt);$t&&$t.height!==void 0&&($t.hidden?ot=$t.height:lt=Math.max($t.height*Ct,lt||0))}if(lt!==void 0)return lt;for(let ut=0;ut<this.layers.length;++ut){const dt=this.layers[ut];if(dt.layer.type!=="model"||!dt.visible)continue;const{bucket:mt,tileID:Tt}=this.currentBuildingBuckets[ut];if(!mt)continue;const{tileX:Ct,tileY:Ut}=this._mapCoordToOverlappingTile(o,_,rt,Tt),Bt=mt.getHeightAtTileCoord(Ct,Ut);if(Bt&&!Bt.hidden)return Bt.height===void 0&&ot!==void 0?Math.min(Bt.maxHeight,ot)*Bt.verticalScale:Bt.height?Bt.height*Bt.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function J1(et,o){const _={};for(const rt in et)rt!=="ref"&&(_[rt]=et[rt]);return c.bx.forEach(rt=>{rt in o&&(_[rt]=o[rt])}),_}function uy(et){et=et.slice();const o=Object.create(null);for(let _=0;_<et.length;_++)o[et[_].id]=et[_];for(let _=0;_<et.length;_++)"ref"in et[_]&&(et[_]=J1(et[_],o[et[_].ref]));return et}const so={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function p0(et,o,_){_.push({command:so.addSource,args:[et,o[et]]})}function tv(et,o,_){o.push({command:so.removeSource,args:[et]}),_[et]=!0}function _b(et,o,_,rt){tv(et,_,rt),p0(et,o,_)}function ew(et,o,_){let rt;for(rt in et[_])if(et[_].hasOwnProperty(rt)&&rt!=="data"&&!c.by(et[_][rt],o[_][rt]))return!1;for(rt in o[_])if(o[_].hasOwnProperty(rt)&&rt!=="data"&&!c.by(et[_][rt],o[_][rt]))return!1;return!0}function Sm(et,o,_,rt,ot,lt){let ut;for(ut in o=o||{},et=et||{})et.hasOwnProperty(ut)&&(c.by(et[ut],o[ut])||_.push({command:lt,args:[rt,ut,o[ut],ot]}));for(ut in o)o.hasOwnProperty(ut)&&!et.hasOwnProperty(ut)&&(c.by(et[ut],o[ut])||_.push({command:lt,args:[rt,ut,o[ut],ot]}))}function hy(et){return et.id}function dy(et,o){return et[o.id]=o,et}function rv(et,o,_){const rt=o.createTileMatrix(et,et.worldSize,_.toUnwrapped());return c.aB(new Float32Array(16),et.projMatrix,rt)}function m0(et,o,_){if(o.projection.name===_.projection.name)return et.projMatrix;const rt=_.clone();return rt.setProjection(o.projection),rv(rt,o.getProjection(),et)}function Dp(et,o,_){return o.name===_.projection.name?et.projMatrix:rv(_,o,et)}class fy{constructor(o,_){this.reset(o,_)}reset(o,_){this.points=o||[],this._distances=[0];for(let rt=1;rt<this.points.length;rt++)this._distances[rt]=this._distances[rt-1]+this.points[rt].dist(this.points[rt-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(_||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=c.aA(o,0,1);let _=1,rt=this._distances[_];const ot=o*this.paddedLength+this.padding;for(;rt<ot&&_<this._distances.length;)rt=this._distances[++_];const lt=_-1,ut=this._distances[lt],dt=rt-ut,mt=dt>0?(ot-ut)/dt:0;return this.points[lt].mult(1-mt).add(this.points[_].mult(mt))}}class iv{constructor(o,_,rt){const ot=this.boxCells=[],lt=this.circleCells=[];this.xCellCount=Math.ceil(o/rt),this.yCellCount=Math.ceil(_/rt);for(let ut=0;ut<this.xCellCount*this.yCellCount;ut++)ot.push([]),lt.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=_,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/_,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,_,rt,ot,lt){this._forEachCell(_,rt,ot,lt,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(_),this.bboxes.push(rt),this.bboxes.push(ot),this.bboxes.push(lt)}insertCircle(o,_,rt,ot){this._forEachCell(_-ot,rt-ot,_+ot,rt+ot,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(_),this.circles.push(rt),this.circles.push(ot)}_insertBoxCell(o,_,rt,ot,lt,ut){this.boxCells[lt].push(ut)}_insertCircleCell(o,_,rt,ot,lt,ut){this.circleCells[lt].push(ut)}_query(o,_,rt,ot,lt,ut){if(rt<0||o>this.width||ot<0||_>this.height)return!lt&&[];const dt=[];if(o<=0&&_<=0&&this.width<=rt&&this.height<=ot){if(lt)return!0;for(let mt=0;mt<this.boxKeys.length;mt++)dt.push({key:this.boxKeys[mt],x1:this.bboxes[4*mt],y1:this.bboxes[4*mt+1],x2:this.bboxes[4*mt+2],y2:this.bboxes[4*mt+3]});for(let mt=0;mt<this.circleKeys.length;mt++){const Tt=this.circles[3*mt],Ct=this.circles[3*mt+1],Ut=this.circles[3*mt+2];dt.push({key:this.circleKeys[mt],x1:Tt-Ut,y1:Ct-Ut,x2:Tt+Ut,y2:Ct+Ut})}return ut?dt.filter(ut):dt}return this._forEachCell(o,_,rt,ot,this._queryCell,dt,{hitTest:lt,seenUids:{box:{},circle:{}}},ut),lt?dt.length>0:dt}_queryCircle(o,_,rt,ot,lt){const ut=o-rt,dt=o+rt,mt=_-rt,Tt=_+rt;if(dt<0||ut>this.width||Tt<0||mt>this.height)return!ot&&[];const Ct=[];return this._forEachCell(ut,mt,dt,Tt,this._queryCellCircle,Ct,{hitTest:ot,circle:{x:o,y:_,radius:rt},seenUids:{box:{},circle:{}}},lt),ot?Ct.length>0:Ct}query(o,_,rt,ot,lt){return this._query(o,_,rt,ot,!1,lt)}hitTest(o,_,rt,ot,lt){return this._query(o,_,rt,ot,!0,lt)}hitTestCircle(o,_,rt,ot){return this._queryCircle(o,_,rt,!0,ot)}_queryCell(o,_,rt,ot,lt,ut,dt,mt){const Tt=dt.seenUids,Ct=this.boxCells[lt];if(Ct!==null){const Bt=this.bboxes;for(const $t of Ct)if(!Tt.box[$t]){Tt.box[$t]=!0;const Zt=4*$t;if(o<=Bt[Zt+2]&&_<=Bt[Zt+3]&&rt>=Bt[Zt+0]&&ot>=Bt[Zt+1]&&(!mt||mt(this.boxKeys[$t]))){if(dt.hitTest)return ut.push(!0),!0;ut.push({key:this.boxKeys[$t],x1:Bt[Zt],y1:Bt[Zt+1],x2:Bt[Zt+2],y2:Bt[Zt+3]})}}}const Ut=this.circleCells[lt];if(Ut!==null){const Bt=this.circles;for(const $t of Ut)if(!Tt.circle[$t]){Tt.circle[$t]=!0;const Zt=3*$t;if(this._circleAndRectCollide(Bt[Zt],Bt[Zt+1],Bt[Zt+2],o,_,rt,ot)&&(!mt||mt(this.circleKeys[$t]))){if(dt.hitTest)return ut.push(!0),!0;{const qt=Bt[Zt],sr=Bt[Zt+1],ir=Bt[Zt+2];ut.push({key:this.circleKeys[$t],x1:qt-ir,y1:sr-ir,x2:qt+ir,y2:sr+ir})}}}}}_queryCellCircle(o,_,rt,ot,lt,ut,dt,mt){const Tt=dt.circle,Ct=dt.seenUids,Ut=this.boxCells[lt];if(Ut!==null){const $t=this.bboxes;for(const Zt of Ut)if(!Ct.box[Zt]){Ct.box[Zt]=!0;const qt=4*Zt;if(this._circleAndRectCollide(Tt.x,Tt.y,Tt.radius,$t[qt+0],$t[qt+1],$t[qt+2],$t[qt+3])&&(!mt||mt(this.boxKeys[Zt])))return ut.push(!0),!0}}const Bt=this.circleCells[lt];if(Bt!==null){const $t=this.circles;for(const Zt of Bt)if(!Ct.circle[Zt]){Ct.circle[Zt]=!0;const qt=3*Zt;if(this._circlesCollide($t[qt],$t[qt+1],$t[qt+2],Tt.x,Tt.y,Tt.radius)&&(!mt||mt(this.circleKeys[Zt])))return ut.push(!0),!0}}}_forEachCell(o,_,rt,ot,lt,ut,dt,mt){const Tt=this._convertToXCellCoord(o),Ct=this._convertToYCellCoord(_),Ut=this._convertToXCellCoord(rt),Bt=this._convertToYCellCoord(ot);for(let $t=Tt;$t<=Ut;$t++)for(let Zt=Ct;Zt<=Bt;Zt++)if(lt.call(this,o,_,rt,ot,this.xCellCount*Zt+$t,ut,dt,mt))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,_,rt,ot,lt,ut){const dt=ot-o,mt=lt-_,Tt=rt+ut;return Tt*Tt>dt*dt+mt*mt}_circleAndRectCollide(o,_,rt,ot,lt,ut,dt){const mt=(ut-ot)/2,Tt=Math.abs(o-(ot+mt));if(Tt>mt+rt)return!1;const Ct=(dt-lt)/2,Ut=Math.abs(_-(lt+Ct));if(Ut>Ct+rt)return!1;if(Tt<=mt||Ut<=Ct)return!0;const Bt=Tt-mt,$t=Ut-Ct;return Bt*Bt+$t*$t<=rt*rt}}const Tm={unknown:0,flipRequired:1,flipNotRequired:2},Jm=Math.tan(85*Math.PI/180);function Au(et,o,_,rt,ot,lt,ut){const dt=c.bC();if(_)if(lt.name==="globe"){const mt=c.bD(ot,o);c.aB(dt,dt,mt)}else{const mt=c.bE([],ut);dt[0]=mt[0],dt[1]=mt[1],dt[4]=mt[2],dt[5]=mt[3],rt||c.bB(dt,dt,ot.angle)}else c.aB(dt,ot.labelPlaneMatrix,et);return dt}function g0(et,o,_,rt,ot,lt,ut){const dt=Au(et,o,_,rt,ot,lt,ut);return lt.name==="globe"&&_||(dt[2]=dt[6]=dt[10]=dt[14]=0),dt}function py(et,o,_,rt,ot,lt,ut){if(_){if(lt.name==="globe"){const dt=Au(et,o,_,rt,ot,lt,ut);return c.bl(dt,dt),c.aB(dt,et,dt),dt}{const dt=c.bz(et),mt=c.bA([]);return mt[0]=ut[0],mt[1]=ut[1],mt[4]=ut[2],mt[5]=ut[3],c.aB(dt,dt,mt),rt||c.bB(dt,dt,-ot.angle),dt}}return ot.glCoordMatrix}function up(et,o,_,rt){const ot=[et,o,_,1];_?c.aC(ot,ot,rt):nn(ot,ot,rt);const lt=ot[3];return ot[0]/=lt,ot[1]/=lt,ot[2]/=lt,ot}function vo(et,o){return Math.min(.5+et/o*.5,1.5)}function tw(et,o){const _=et[0]/et[3],rt=et[1]/et[3];return _>=-o[0]&&_<=o[0]&&rt>=-o[1]&&rt<=o[1]}function rw(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct=1){const Ut=_.transform,Bt=rt?et.textSizeData:et.iconSizeData,$t=c.bK(Bt,_.transform.zoom,Ct),Zt=Ut.projection.name==="globe",qt=[256/_.width*2+1,256/_.height*2+1],sr=rt?et.text.dynamicLayoutVertexArray:et.icon.dynamicLayoutVertexArray;sr.clear();let ir=null;Zt&&(ir=rt?et.text.globeExtVertexArray:et.icon.globeExtVertexArray);const cr=et.lineVertexArray,pr=rt?et.text.placedSymbolArray:et.icon.placedSymbolArray,ur=_.transform.width/_.transform.height;let Cr,wr=!1;for(let Tr=0;Tr<pr.length;Tr++){const br=pr.get(Tr),{numGlyphs:yr,writingMode:Pr}=br;if(Pr!==c.bL.vertical||wr||Cr===c.bL.horizontal||(wr=!0),Cr=Pr,(br.hidden||Pr===c.bL.vertical)&&!wr){Sp(yr,sr);continue}wr=!1;const Or=new c.P(br.tileAnchorX,br.tileAnchorY),Nr=et.elevationType==="road",ts=!!Ut.elevation||Nr;let{x:rs,y:cs,z:Ss}=Ut.projection.projectTilePoint(Or.x,Or.y,Tt.canonical),Zr=null;if(ts){const Gs=Nr?et.getElevationFeatureForText(Tr):null;Zr={getElevation:mt,elevation:Ut.elevation,elevationFeature:Gs};const[ln,En,Hn]=mt(Or,Ut.elevation,Gs);rs+=ln,cs+=En,Ss+=Hn}const Fr=[rs,cs,Ss,1];if(c.aC(Fr,Fr,o),!tw(Fr,qt)){Sp(yr,sr);continue}const ns=Fr[3],Qr=vo(_.transform.getCameraToCenterDistance(Ut.projection),ns),gs=c.bM(Bt,$t,br),ks=ut?gs/Qr:gs*Qr,Bs=up(rs,cs,Ss,ot);if(Bs[3]<=0){Sp(yr,sr);continue}let js={};const Ts=c.an(et.layers[0].layout.get("text-max-angle")),Js=Math.cos(Ts),Ks=ut?null:Zr,Ns=sv(br,ks,!1,dt,o,ot,lt,et.glyphOffsetArray,cr,sr,ir,Bs,Or,js,ur,Ks,Ut.projection,Tt,ut,Js);wr=Ns.useVertical,Ks&&Ns.needsFlipping&&(js={}),(Ns.notEnoughRoom||wr||Ns.needsFlipping&&sv(br,ks,!0,dt,o,ot,lt,et.glyphOffsetArray,cr,sr,ir,Bs,Or,js,ur,Ks,Ut.projection,Tt,ut,Js).notEnoughRoom)&&Sp(yr,sr)}rt?(et.text.dynamicLayoutVertexBuffer.updateData(sr),ir&&et.text.globeExtVertexBuffer&&et.text.globeExtVertexBuffer.updateData(ir)):(et.icon.dynamicLayoutVertexBuffer.updateData(sr),ir&&et.icon.globeExtVertexBuffer&&et.icon.globeExtVertexBuffer.updateData(ir))}function iw(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr){const{lineStartIndex:ir,glyphStartIndex:cr,segment:pr}=dt,ur=cr+dt.numGlyphs,Cr=ir+dt.lineLength,wr=o.getoffsetX(cr),Tr=o.getoffsetX(ur-1),br=wx(et*wr,_,rt,ot,lt,ut,pr,ir,Cr,mt,Tt,Ct,Ut,Bt,!0,$t,Zt,qt,sr);if(!br)return null;const yr=wx(et*Tr,_,rt,ot,lt,ut,pr,ir,Cr,mt,Tt,Ct,Ut,Bt,!0,$t,Zt,qt,sr);return yr?{first:br,last:yr}:null}function pn(et,o,_,rt){return et===c.bL.horizontal&&Math.abs(rt)>Math.abs(_)?{useVertical:!0}:et===c.bL.vertical?rt>0?{needsFlipping:!0}:null:o!==Tm.unknown&&function(ot,lt){return ot===0||Math.abs(lt/ot)>Jm}(_,rt)?o===Tm.flipRequired?{needsFlipping:!0}:null:_<0?{needsFlipping:!0}:null}function sv(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr){const ur=o/24,Cr=et.lineOffsetX*ur,wr=et.lineOffsetY*ur,{lineStartIndex:Tr,glyphStartIndex:br,numGlyphs:yr,segment:Pr,writingMode:Or,flipState:Nr}=et,ts=Tr+et.lineLength,rs=cs=>{if(Ct){const[ns,Qr,gs]=cs.up,ks=Tt.length;c.bN(Ct,ks+0,ns,Qr,gs),c.bN(Ct,ks+1,ns,Qr,gs),c.bN(Ct,ks+2,ns,Qr,gs),c.bN(Ct,ks+3,ns,Qr,gs)}const[Ss,Zr,Fr]=cs.point;c.bO(Tt,Ss,Zr,Fr,cs.angle)};if(yr>1){const cs=iw(ur,dt,Cr,wr,_,Ut,Bt,et,mt,lt,$t,qt,!1,sr,ir,cr,pr);if(!cs)return{notEnoughRoom:!0};if(rt&&!_){let[Ss,Zr,Fr]=cs.first.point,[ns,Qr,gs]=cs.last.point;[Ss,Zr]=up(Ss,Zr,Fr,ut),[ns,Qr]=up(ns,Qr,gs,ut);const ks=pn(Or,Nr,(ns-Ss)*Zt,Qr-Zr);if(et.flipState=ks&&ks.needsFlipping?Tm.flipRequired:Tm.flipNotRequired,ks)return ks}rs(cs.first);for(let Ss=br+1;Ss<br+yr-1;Ss++){const Zr=wx(ur*dt.getoffsetX(Ss),Cr,wr,_,Ut,Bt,Pr,Tr,ts,mt,lt,$t,qt,!1,!1,sr,ir,cr,pr);if(!Zr)return Tt.length-=4*(Ss-br),{notEnoughRoom:!0};rs(Zr)}rs(cs.last)}else{if(rt&&!_){const Ss=up(Bt.x,Bt.y,0,ot),Zr=Tr+Pr+1,Fr=new c.P(mt.getx(Zr),mt.gety(Zr)),ns=up(Fr.x,Fr.y,0,ot),Qr=ns[3]>0?ns:hp(Bt,Fr,Ss,1,ot,void 0,sr,ir.canonical),gs=pn(Or,Nr,(Qr[0]-Ss[0])*Zt,Qr[1]-Ss[1]);if(et.flipState=gs&&gs.needsFlipping?Tm.flipRequired:Tm.flipNotRequired,gs)return gs}const cs=wx(ur*dt.getoffsetX(br),Cr,wr,_,Ut,Bt,Pr,Tr,ts,mt,lt,$t,qt,!1,!1,sr,ir,cr,pr);if(!cs)return{notEnoughRoom:!0};rs(cs)}return{}}function my(et,o,_,rt,ot){const{x:lt,y:ut,z:dt}=rt.projectTilePoint(et.x,et.y,o);if(!ot)return up(lt,ut,dt,_);const[mt,Tt,Ct]=ot.getElevation(et,ot.elevation,ot.elevationFeature);return up(lt+mt,ut+Tt,dt+Ct,_)}function hp(et,o,_,rt,ot,lt,ut,dt){const mt=my(et.sub(o)._unit()._add(et),dt,ot,ut,lt);return c.av(mt,_,mt),c.aw(mt,mt),c.bH(mt,_,mt,rt)}function wx(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr){const pr=rt?et-o:et+o;let ur=pr>0?1:-1,Cr=0;rt&&(ur*=-1,Cr=Math.PI),ur<0&&(Cr+=Math.PI);let wr=dt+ut+(ur>0?0:1)|0,Tr=ot,br=ot,yr=0,Pr=0;const Or=Math.abs(pr),Nr=[],ts=[];let rs=lt,cs=rs,Ss=c.bF([]);const Zr=()=>hp(cs,rs,br,Or-yr+1,Ct,Bt,qt,sr.canonical);for(;yr+Pr<=Or;){if(wr+=ur,wr<dt||wr>=mt)return null;if(br=Tr,cs=rs,Nr.push(br),$t&&ts.push(cs),rs=new c.P(Tt.getx(wr),Tt.gety(wr)),Tr=Ut[wr],!Tr){const Ks=my(rs,sr.canonical,Ct,qt,Bt);Tr=Ks[3]>0?Ut[wr]=Ks:Zr()}yr+=Pr;const Ts=c.av([],Tr,br),Js=c.bG(br,Tr);if(_&&Js>0&&Pr>0&&c.bJ(Ss,Ts)/(Pr*Js)<cr)return null;Pr=Js,Ss=Ts}Zt&&Bt&&(Ut[wr]&&(Tr=Zr(),Pr=c.bG(br,Tr),Ss=c.av([],Tr,br)),Ut[wr]=Tr);const Fr=(Or-yr)/Pr,ns=rs.sub(cs)._mult(Fr)._add(cs),Qr=c.bH([],br,Ss,Fr);let gs=[0,0,1],ks=Ss[0],Bs=Ss[1];if(ir&&(gs=qt.upVector(sr.canonical,ns.x,ns.y),gs[0]!==0||gs[1]!==0||gs[2]!==1)){const Ts=[gs[2],0,-gs[0]],Js=c.bI([],gs,Ts);c.aw(Ts,Ts),c.aw(Js,Js),ks=c.bJ(Ss,Ts),Bs=c.bJ(Ss,Js)}if(_){const Ts=c.bI([],gs,Ss);c.aw(Ts,Ts),c.bH(Qr,Qr,Ts,_*ur)}const js=Cr+Math.atan2(Bs,ks);return Nr.push(Qr),$t&&ts.push(ns),{point:Qr,angle:js,path:Nr,tilePath:ts,up:gs}}function Sp(et,o){const _=o.length,rt=_+4*et;o.resize(rt),o.float32.fill(-1/0,4*_,4*rt)}function nn(et,o,_){const rt=o[0],ot=o[1];return et[0]=_[0]*rt+_[4]*ot+_[12],et[1]=_[1]*rt+_[5]*ot+_[13],et[3]=_[3]*rt+_[7]*ot+_[15],et}const Kn=100;class So{constructor(o,_,rt=new iv(o.width+200,o.height+200,25),ot=new iv(o.width+200,o.height+200,25)){this.transform=o,this.grid=rt,this.ignoredGrid=ot,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+Kn,this.screenBottomBoundary=o.height+Kn,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=_}placeCollisionBox(o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut){let Bt=rt.projectedAnchorX,$t=rt.projectedAnchorY,Zt=rt.projectedAnchorZ;const qt=rt.tileAnchorX,sr=rt.tileAnchorY,ir=rt.elevation,cr=rt.tileID,pr=o.getProjection();if(ir&&cr){const[ts,rs,cs]=pr.upVector(cr.canonical,rt.tileAnchorX,rt.tileAnchorY),Ss=pr.upVectorScale(cr.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Bt+=ts*ir*Ss,$t+=rs*ir*Ss,Zt+=cs*ir*Ss}const ur=o.projection.name==="globe",Cr=o.projection.name==="globe"?c.aj(this.transform.zoom):0;if(cr&&ur&&Cr<1&&!ut){const ts=1<<cr.canonical.z,rs=c.bP(qt,sr);c.bQ(rs,rs,1/c.al),c.bR(rs,rs,c.bP(cr.canonical.x,cr.canonical.y)),c.bQ(rs,rs,1/ts),c.bS(rs,rs,c.bP(ot[0],ot[1])),rs[0]=c.bT(rs[0],-.5,.5),c.bQ(rs,rs,c.al);const cs=c.bU(rs[0],rs[1],c.al/(2*Math.PI),1);c.aC(cs,cs,lt),Bt=c.ak(Bt,cs[0],Cr),$t=c.ak($t,cs[1],Cr),Zt=c.ak(Zt,cs[2],Cr)}const wr=this.projectAndGetPerspectiveRatio(Ct,Bt,$t,Zt,rt.tileID,pr.name==="globe"||!!ir||this.transform.pitch>0,pr),Tr=Tt*wr.perspectiveRatio,br=(rt.x1*_+dt.x-rt.padding)*Tr+wr.point.x,yr=(rt.y1*_+dt.y-rt.padding)*Tr+wr.point.y,Pr=(rt.x2*_+dt.x+rt.padding)*Tr+wr.point.x,Or=(rt.y2*_+dt.y+rt.padding)*Tr+wr.point.y,Nr=wr.perspectiveRatio<=.55||wr.occluded;return!this.isInsideGrid(br,yr,Pr,Or)||!mt&&this.grid.hitTest(br,yr,Pr,Or,Ut)||Nr?{box:[],offscreen:!1,occluded:wr.occluded}:{box:[br,yr,Pr,Or],offscreen:this.isOffscreen(br,yr,Pr,Or),occluded:!1}}placeCollisionCircles(o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr){const ir=[],cr=this.transform.elevation,pr=o.getProjection(),ur=o.elevationType==="road",Cr=!!cr||ur,wr=c.bV.getAtTileOffsetFunc(sr,this.transform.center.lat,this.transform.worldSize,pr),Tr=new c.P(rt.tileAnchorX,rt.tileAnchorY),br=new c.P(rt.tileAnchorX,rt.tileAnchorY);let{x:yr,y:Pr,z:Or}=pr.projectTilePoint(br.x,br.y,sr.canonical),Nr=null;if(Cr){const Js=ur?o.getElevationFeatureForText(ot):null;Nr={getElevation:wr,elevation:cr,elevationFeature:Js};const[Ks,Ns,Gs]=wr(Tr,cr,Js);yr+=Ks,Pr+=Ns,Or+=Gs}const ts=pr.name==="globe",rs=this.projectAndGetPerspectiveRatio(mt,yr,Pr,Or,sr,ts||!!cr||this.transform.pitch>0,pr),{perspectiveRatio:cs}=rs,Ss=(Bt?dt/cs:dt*cs)/c.bY,Zr=up(yr,Pr,Or,Tt),Fr=rt.lineOffsetX*Ss,ns=rt.lineOffsetY*Ss,Qr=c.an(o.layers[0].layout.get("text-max-angle")),gs=Math.cos(Qr),ks=rs.signedDistanceFromCamera>0?iw(Ss,ut,Fr,ns,ur&&rt.flipState===1,Zr,br,rt,lt,Tt,{},Cr&&!Bt?Nr:null,Bt&&Cr,pr,sr,Bt,gs):null;let Bs=!1,js=!1,Ts=!0;if(ks&&!rs.occluded){const Js=.5*Zt*cs+qt,Ks=new c.P(-100,-100),Ns=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Gs=new fy,{first:ln,last:En}=ks,Hn=ln.path.length;let ho=[];for(let bn=Hn-1;bn>=1;bn--)ho.push(ln.path[bn]);for(let bn=1;bn<En.path.length;bn++)ho.push(En.path[bn]);const en=2.5*Js;Ct&&(ho=ho.map(([bn,mo,To],bo)=>(Cr&&!ts&&(To=wr(bo<Hn-1?ln.tilePath[Hn-1-bo]:En.tilePath[bo-Hn+2],cr,Nr.elevationFeature)[2]),up(bn,mo,To,Ct))),ho.some(bn=>bn[3]<=0)&&(ho=[]));let ao=[];if(ho.length>0){let bn=1/0,mo=-1/0,To=1/0,bo=-1/0;for(const no of ho)bn=Math.min(bn,no[0]),To=Math.min(To,no[1]),mo=Math.max(mo,no[0]),bo=Math.max(bo,no[1]);mo>=Ks.x&&bn<=Ns.x&&bo>=Ks.y&&To<=Ns.y&&(ao=[ho.map(no=>new c.P(no[0],no[1]))],(bn<Ks.x||mo>Ns.x||To<Ks.y||bo>Ns.y)&&(ao=c.bW(ao,Ks.x,Ks.y,Ns.x,Ns.y)))}for(const bn of ao){Gs.reset(bn,.25*Js);let mo=0;mo=Gs.length<=.5*Js?1:Math.ceil(Gs.paddedLength/en)+1;for(let To=0;To<mo;To++){const bo=To/Math.max(mo-1,1),no=Gs.lerp(bo),kn=no.x+Kn,po=no.y+Kn;ir.push(kn,po,Js,0);const yl=kn-Js,Ko=po-Js,go=kn+Js,Jn=po+Js;if(Ts=Ts&&this.isOffscreen(yl,Ko,go,Jn),js=js||this.isInsideGrid(yl,Ko,go,Jn),!_&&this.grid.hitTestCircle(kn,po,Js,$t)&&(Bs=!0,!Ut))return{circles:[],offscreen:!1,collisionDetected:Bs,occluded:!1}}}}return{circles:!Ut&&Bs||!js?[]:ir,offscreen:Ts,collisionDetected:Bs,occluded:rs.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const _=[];let rt=1/0,ot=1/0,lt=-1/0,ut=-1/0;for(const Ct of o){const Ut=new c.P(Ct.x+Kn,Ct.y+Kn);rt=Math.min(rt,Ut.x),ot=Math.min(ot,Ut.y),lt=Math.max(lt,Ut.x),ut=Math.max(ut,Ut.y),_.push(Ut)}const dt=this.grid.query(rt,ot,lt,ut).concat(this.ignoredGrid.query(rt,ot,lt,ut)),mt={},Tt={};for(const Ct of dt){const Ut=Ct.key;if(mt[Ut.bucketInstanceId]===void 0&&(mt[Ut.bucketInstanceId]={}),mt[Ut.bucketInstanceId][Ut.featureIndex])continue;const Bt=[new c.P(Ct.x1,Ct.y1),new c.P(Ct.x2,Ct.y1),new c.P(Ct.x2,Ct.y2),new c.P(Ct.x1,Ct.y2)];c.bX(_,Bt)&&(mt[Ut.bucketInstanceId][Ut.featureIndex]=!0,Tt[Ut.bucketInstanceId]===void 0&&(Tt[Ut.bucketInstanceId]=[]),Tt[Ut.bucketInstanceId].push(Ut.featureIndex))}return Tt}insertCollisionBox(o,_,rt,ot,lt){(_?this.ignoredGrid:this.grid).insert({bucketInstanceId:rt,featureIndex:ot,collisionGroupID:lt},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,_,rt,ot,lt){const ut=_?this.ignoredGrid:this.grid,dt={bucketInstanceId:rt,featureIndex:ot,collisionGroupID:lt};for(let mt=0;mt<o.length;mt+=4)ut.insertCircle(dt,o[mt],o[mt+1],o[mt+2])}projectAndGetPerspectiveRatio(o,_,rt,ot,lt,ut,dt){const mt=[_,rt,ot,1];let Tt=!1;ot||this.transform.pitch>0?(c.aC(mt,mt,o),this.fogState&&lt&&dt.name!=="globe"&&(Tt=function(Bt,$t,Zt,qt,sr,ir){const cr=ir.calculateFogTileMatrix(sr),pr=[$t,Zt,qt];return c.af(pr,pr,cr),Ws(Bt,c.ag(pr),ir.pitch,ir._fov)}(this.fogState,_,rt,ot,lt.toUnwrapped(),this.transform)>.9)):nn(mt,mt,o);const Ct=mt[3];return{point:new c.P((mt[0]/Ct+1)/2*this.transform.width+Kn,(-mt[1]/Ct+1)/2*this.transform.height+Kn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(dt)/Ct*.5,1.5),signedDistanceFromCamera:Ct,occluded:ut&&mt[2]>Ct||Tt}}isOffscreen(o,_,rt,ot){return rt<Kn||o>=this.screenRightBoundary||ot<Kn||_>this.screenBottomBoundary}isInsideGrid(o,_,rt,ot){return rt>=0&&o<this.gridRightBoundary&&ot>=0&&_<this.gridBottomBoundary}getViewportMatrix(){const o=c.bA([]);return c.br(o,o,[-100,-100,0]),o}}class $u{constructor(o,_,rt,ot){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?_:-_))):ot&&rt?1:0,this.placed=rt}isHidden(){return this.opacity===0&&!this.placed}}class Np{constructor(o,_,rt,ot,lt,ut=!1){this.text=new $u(o?o.text:null,_,rt,lt),this.icon=new $u(o?o.icon:null,_,ot,lt),this.clipped=ut}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class yo{constructor(o,_,rt,ot=!1){this.text=o,this.icon=_,this.skipFade=rt,this.clipped=ot}}class x0{constructor(){this.invProjMatrix=c.bC(),this.viewportMatrix=c.bC(),this.circles=[]}}class gy{constructor(o,_,rt,ot,lt){this.bucketInstanceId=o,this.featureIndex=_,this.sourceLayerIndex=rt,this.bucketIndex=ot,this.tileID=lt}}class xy{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const _=++this.maxGroupID;this.collisionGroups[o]={ID:_,predicate:rt=>rt.collisionGroupID===_}}return this.collisionGroups[o]}}function wu(et,o,_,rt,ot){const{horizontalAlign:lt,verticalAlign:ut}=c.c1(et),dt=-(lt-.5)*o,mt=-(ut-.5)*_,Tt=c.c2(et,rt);return new c.P(dt+Tt[0]*ot,mt+Tt[1]*ot)}function Vl(et,o,_,rt,ot){const lt=new c.P(et,o);return _&&lt._rotate(rt?ot:-ot),lt}class YE{constructor(o,_,rt,ot,lt,ut){this.transform=o.clone(),this.projection=o.projection.name,this.collisionIndex=new So(this.transform,lt),this.buildingIndex=ut,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=_,this.retainedQueryData={},this.collisionGroups=new xy(rt),this.collisionCircleArrays={},this.prevPlacement=ot,ot&&(ot.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(o,_,rt,ot,lt=1){const ut=rt.getBucket(_),dt=rt.latestFeatureIndex;if(!ut||!dt||_.fqid!==ut.layerIds[0])return;const mt=ut.layers[0].layout,Tt=ut.layers[0].paint,Ct=rt.collisionBoxArray,Ut=Math.pow(2,this.transform.zoom-rt.tileID.overscaledZ),Bt=rt.tileSize/c.al,$t=rt.tileID.toUnwrapped();this.transform.setProjection(ut.projection);const Zt=(qt=rt.tileID,sr=ut.getProjection(),ir=this.transform,sr.name===this.projection?ir.calculateProjMatrix(qt.toUnwrapped()):rv(ir,sr,qt));var qt,sr,ir;const cr=mt.get("text-pitch-alignment")==="map",pr=mt.get("text-rotation-alignment")==="map";_.compileFilter(_.options);const ur=_.dynamicFilter(),Cr=_.dynamicFilterNeedsFeature(),wr=this.transform.calculatePixelsToTileUnitsMatrix(rt),Tr=g0(Zt,rt.tileID.canonical,cr,pr,this.transform,ut.getProjection(),wr);let br=null;const yr=ut.getProjection().createInversionMatrix(this.transform,rt.tileID.canonical);if(cr){const Fr=py(Zt,rt.tileID.canonical,cr,pr,this.transform,ut.getProjection(),wr);br=c.aB([],this.transform.labelPlaneMatrix,Fr)}let Pr=null;ur&&rt.latestFeatureIndex&&(Pr={unwrappedTileID:$t,dynamicFilter:ur,dynamicFilterNeedsFeature:Cr}),this.retainedQueryData[ut.bucketInstanceId]=new gy(ut.bucketInstanceId,dt,ut.sourceLayerIndex,ut.index,rt.tileID);const[Or,Nr]=ut.layers[0].layout.get("text-size-scale-range"),ts=c.aA(lt,Or,Nr),[rs,cs]=mt.get("icon-size-scale-range"),Ss=c.aA(lt,rs,cs),Zr={bucket:ut,layout:mt,paint:Tt,posMatrix:Zt,invMatrix:yr,mercatorCenter:[c.aF(this.transform.center.lng),c.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Tr,labelToScreenMatrix:br,clippingData:Pr,scale:Ut,textPixelRatio:Bt,holdingForFade:rt.holdingForFade(),collisionBoxArray:Ct,partiallyEvaluatedTextSize:c.bK(ut.textSizeData,this.transform.zoom,ts),partiallyEvaluatedIconSize:c.bK(ut.iconSizeData,this.transform.zoom,Ss),collisionGroup:this.collisionGroups.get(ut.sourceID),latestFeatureIndex:rt.latestFeatureIndex};if(ot)for(const Fr of ut.sortKeyRanges){const{sortKey:ns,symbolInstanceStart:Qr,symbolInstanceEnd:gs}=Fr;o.push({sortKey:ns,symbolInstanceStart:Qr,symbolInstanceEnd:gs,parameters:Zr})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:ut.symbolInstances.length,parameters:Zr})}attemptAnchorPlacement(o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr,ur,Cr){const{textOffset0:wr,textOffset1:Tr,crossTileID:br}=qt,yr=[wr,Tr],Pr=wu(o,ut,dt,yr,mt),Or=this.collisionIndex.placeCollisionBox(ir,mt,_,rt,ot,lt,Vl(Pr.x,Pr.y,Tt,Ct,this.transform.angle),Zt,Ut,Bt,$t.predicate);if(pr){const Nr=ir.getSymbolInstanceIconSize(Cr,this.transform.zoom,qt.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ir,Nr,pr,rt,ot,lt,Vl(Pr.x,Pr.y,Tt,Ct,this.transform.angle),Zt,Ut,Bt,$t.predicate).box.length===0)return}if(Or.box.length>0){let Nr;return this.prevPlacement&&this.prevPlacement.variableOffsets[br]&&this.prevPlacement.placements[br]&&this.prevPlacement.placements[br].text&&(Nr=this.prevPlacement.variableOffsets[br].anchor),this.variableOffsets[br]={textOffset:yr,width:ut,height:dt,anchor:o,textScale:mt,prevAnchor:Nr},this.markUsedJustification(ir,o,qt,cr),ir.allowVerticalPlacement&&(this.markUsedOrientation(ir,cr,qt),this.placedOrientations[br]=cr),{shift:Pr,placedGlyphBoxes:Or}}}placeLayerBucketPart(o,_,rt,ot,lt=1){const{bucket:ut,layout:dt,paint:mt,posMatrix:Tt,textLabelPlaneMatrix:Ct,labelToScreenMatrix:Ut,clippingData:Bt,textPixelRatio:$t,mercatorCenter:Zt,invMatrix:qt,holdingForFade:sr,collisionBoxArray:ir,partiallyEvaluatedTextSize:cr,partiallyEvaluatedIconSize:pr,collisionGroup:ur,latestFeatureIndex:Cr}=o.parameters,wr=dt.get("text-optional"),Tr=dt.get("icon-optional"),br=dt.get("text-allow-overlap"),yr=dt.get("icon-allow-overlap"),Pr=dt.get("text-rotation-alignment")==="map",Or=dt.get("icon-rotation-alignment")==="map",Nr=dt.get("text-pitch-alignment")==="map",ts=mt.get("symbol-z-offset"),rs=dt.get("symbol-elevation-reference")==="sea",cs=dt.get("symbol-placement"),[Ss,Zr]=dt.get("text-size-scale-range"),[Fr,ns]=dt.get("icon-size-scale-range"),Qr=c.aA(lt,Ss,Zr),gs=c.aA(lt,Fr,ns),ks=dt.get("text-variable-anchor"),Bs=Pr&&cs!=="point",js=Or&&cs!=="point",Ts=ks&&ut.hasTextData(),Js=ut.hasIconTextFit()&&Ts&&ut.hasIconData();this.transform.setProjection(ut.projection);const Ks=Ts||Bs,Ns=js||Js;let Gs=br&&(yr||!ut.hasIconData()||Tr),ln=yr&&(br||!ut.hasTextData()||wr);const En=!ts.isConstant();!ut.collisionArrays&&ir&&ut.deserializeCollisionBoxes(ir),rt&&ot&&ut.updateCollisionDebugBuffers(this.transform.zoom,ir,Qr,gs);const Hn=(en,ao,bn)=>{const{crossTileID:mo,numVerticalGlyphVertices:To}=en;let bo=null;if(Bt&&Bt.dynamicFilterNeedsFeature||En){const Tl=this.retainedQueryData[ut.bucketInstanceId];bo=Cr.loadFeature({featureIndex:en.featureIndex,bucketIndex:Tl.bucketIndex,sourceLayerIndex:Tl.sourceLayerIndex,layoutVertexArrayOffset:0});const Ml=bo.properties?bo.properties.worldview:null;if(ut.localizable&&ut.worldview&&typeof Ml=="string")if(Ml==="all")bo.properties.$localized=!0;else{if(!Ml.split(",").includes(ut.worldview))return;bo.properties.$localized=!0,bo.properties.worldview=ut.worldview}}if(Bt&&!(0,Bt.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:ut.worldview},bo,this.retainedQueryData[ut.bucketInstanceId].tileID.canonical,new c.P(en.tileAnchorX,en.tileAnchorY),this.transform.calculateDistanceTileData(Bt.unwrappedTileID)))return this.placements[mo]=new yo(!1,!1,!1,!0),void _.add(mo);const no=ts.evaluate(bo,{});if(_.has(mo))return;if(sr)return void(this.placements[mo]=new yo(!1,!1,!1));let kn=!1,po=!1,yl=!0,Ko=!1,go=!1,Jn=null,Mn={box:null,offscreen:null,occluded:null},Zo={box:null},Al=null,xa=null,ko=null,Lu=0,yu=0,Kl=0;bn.textFeatureIndex?Lu=bn.textFeatureIndex:en.useRuntimeCollisionCircles&&(Lu=en.featureIndex),bn.verticalTextFeatureIndex&&(yu=bn.verticalTextFeatureIndex);const Su=ut.elevationFeatures?ut.elevationFeatures[en.elevationFeatureIndex]:void 0,Tu=Tl=>{Tl.tileID=this.retainedQueryData[ut.bucketInstanceId].tileID;const Ml=this.transform.elevation;Tl.elevation=rs?no:no+c.bV.getAtTileOffset(Tl.tileID,new c.P(Tl.tileAnchorX,Tl.tileAnchorY),Ml,Su),Tl.elevation+=en.zOffset},mu=bn.textBox;if(mu){Tu(mu);const Tl=Mo=>{let zl=c.bL.horizontal;if(ut.allowVerticalPlacement&&!Mo&&this.prevPlacement){const _l=this.prevPlacement.placedOrientations[mo];_l&&(this.placedOrientations[mo]=_l,zl=_l,this.markUsedOrientation(ut,zl,en))}return zl},Ml=(Mo,zl)=>{if(ut.allowVerticalPlacement&&To>0&&bn.verticalTextBox){for(const _l of ut.writingModes)if(_l===c.bL.vertical?(Mn=zl(),Zo=Mn):Mn=Mo(),Mn&&Mn.box&&Mn.box.length)break}else Mn=Mo()};if(ks){let Mo=ks;if(this.prevPlacement&&this.prevPlacement.variableOffsets[mo]){const _a=this.prevPlacement.variableOffsets[mo];Mo.indexOf(_a.anchor)>0&&(Mo=Mo.filter(_p=>_p!==_a.anchor),Mo.unshift(_a.anchor))}const zl=(_a,_p,Hy)=>{const Pp=ut.getSymbolInstanceTextSize(cr,en,this.transform.zoom,ao),Wy=(_a.x2-_a.x1)*Pp+2*_a.padding,Wx=(_a.y2-_a.y1)*Pp+2*_a.padding,Wp=en.hasIconTextFit&&!yr?_p:null;Wp&&Tu(Wp);let hm={box:[],offscreen:!1,occluded:!1};const qx=br?2*Mo.length:Mo.length;for(let Vm=0;Vm<qx;++Vm){const dm=this.attemptAnchorPlacement(Mo[Vm%Mo.length],_a,Zt,qt,Ks,Wy,Wx,Pp,Pr,Nr,$t,Tt,ur,Vm>=Mo.length,en,ao,ut,Hy,Wp,cr,pr);if(dm&&(hm=dm.placedGlyphBoxes,hm&&hm.box&&hm.box.length)){kn=!0,Jn=dm.shift;break}}return hm};Ml(()=>zl(mu,bn.iconBox,c.bL.horizontal),()=>{const _a=bn.verticalTextBox;return _a&&Tu(_a),ut.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&To>0&&_a?zl(_a,bn.verticalIconBox,c.bL.vertical):{box:null,offscreen:null,occluded:null}}),Mn&&(kn=Mn.box,yl=Mn.offscreen,Ko=Mn.occluded);const _l=Tl(!(!Mn||!Mn.box));if(!kn&&this.prevPlacement){const _a=this.prevPlacement.variableOffsets[mo];_a&&(this.variableOffsets[mo]=_a,this.markUsedJustification(ut,_a.anchor,en,_l))}}else{const Mo=(zl,_l)=>{const _a=ut.getSymbolInstanceTextSize(cr,en,this.transform.zoom,ao),_p=this.collisionIndex.placeCollisionBox(ut,_a,zl,Zt,qt,Ks,new c.P(0,0),br,$t,Tt,ur.predicate);return _p&&_p.box&&_p.box.length&&(this.markUsedOrientation(ut,_l,en),this.placedOrientations[mo]=_l),_p};Ml(()=>Mo(mu,c.bL.horizontal),()=>{const zl=bn.verticalTextBox;return ut.allowVerticalPlacement&&To>0&&zl?(Tu(zl),Mo(zl,c.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Tl(!!(Mn&&Mn.box&&Mn.box.length))}}if(Al=Mn,kn=Al&&Al.box&&Al.box.length>0,yl=Al&&Al.offscreen,Ko=Al&&Al.occluded,en.useRuntimeCollisionCircles){const Tl=en.centerJustifiedTextSymbolIndex>=0?en.centerJustifiedTextSymbolIndex:en.verticalPlacedTextSymbolIndex,Ml=ut.text.placedSymbolArray.get(Tl),Mo=c.bM(ut.textSizeData,cr,Ml),zl=dt.get("text-padding");xa=this.collisionIndex.placeCollisionCircles(ut,br,Ml,Tl,ut.lineVertexArray,ut.glyphOffsetArray,Mo,Tt,Ct,Ut,rt,Nr,ur.predicate,en.collisionCircleDiameter*Mo/c.bY,zl,this.retainedQueryData[ut.bucketInstanceId].tileID),kn=br||xa.circles.length>0&&!xa.collisionDetected,yl=yl&&xa.offscreen,Ko=xa.occluded}if(bn.iconFeatureIndex&&(Kl=bn.iconFeatureIndex),bn.iconBox){const Tl=Ml=>{Tu(Ml);const Mo=en.hasIconTextFit&&Jn?Vl(Jn.x,Jn.y,Pr,Nr,this.transform.angle):new c.P(0,0),zl=ut.getSymbolInstanceIconSize(pr,this.transform.zoom,en.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(ut,zl,Ml,Zt,qt,Ns,Mo,yr,$t,Tt,ur.predicate)};Zo&&Zo.box&&Zo.box.length&&bn.verticalIconBox?(ko=Tl(bn.verticalIconBox),po=ko.box.length>0):(ko=Tl(bn.iconBox),po=ko.box.length>0),yl=yl&&ko.offscreen,go=ko.occluded}const rp=wr||en.numHorizontalGlyphVertices===0&&To===0,yp=Tr||en.numIconVertices===0;if(rp||yp?yp?rp||(po=po&&kn):kn=po&&kn:po=kn=po&&kn,kn&&Al&&Al.box&&this.collisionIndex.insertCollisionBox(Al.box,dt.get("text-ignore-placement"),ut.bucketInstanceId,Zo&&Zo.box&&yu?yu:Lu,ur.ID),po&&ko&&this.collisionIndex.insertCollisionBox(ko.box,dt.get("icon-ignore-placement"),ut.bucketInstanceId,Kl,ur.ID),xa&&(kn&&this.collisionIndex.insertCollisionCircles(xa.circles,dt.get("text-ignore-placement"),ut.bucketInstanceId,Lu,ur.ID),rt)){const Tl=ut.bucketInstanceId;let Ml=this.collisionCircleArrays[Tl];Ml===void 0&&(Ml=this.collisionCircleArrays[Tl]=new x0);for(let Mo=0;Mo<xa.circles.length;Mo+=4)Ml.circles.push(xa.circles[Mo+0]),Ml.circles.push(xa.circles[Mo+1]),Ml.circles.push(xa.circles[Mo+2]),Ml.circles.push(xa.collisionDetected?1:0)}const Wu=ut.projection.name!=="globe";Gs=Gs&&(Wu||!Ko),ln=ln&&(Wu||!go),this.placements[mo]=new yo(kn||Gs,po||ln,yl||ut.justReloaded),_.add(mo)},ho=this.retainedQueryData[ut.bucketInstanceId].tileID;if(ut.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(ut,ho),ut.elevationType==="road"&&ut.updateRoadElevation(ho.canonical),ut.updateZOffset(),ut.sortFeaturesByY){const en=ut.getSortedSymbolIndexes(this.transform.angle);for(let ao=en.length-1;ao>=0;--ao){const bn=en[ao];Hn(ut.symbolInstances.get(bn),bn,ut.collisionArrays[bn])}ut.hasAnyZOffset&&c.w(`${ut.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(ut.hasAnyZOffset){const en=ut.getSortedIndexesByZOffset();for(let ao=0;ao<en.length;++ao){const bn=en[ao];Hn(ut.symbolInstances.get(bn),bn,ut.collisionArrays[bn])}}else for(let en=o.symbolInstanceStart;en<o.symbolInstanceEnd;en++)Hn(ut.symbolInstances.get(en),en,ut.collisionArrays[en]);if(rt&&ut.bucketInstanceId in this.collisionCircleArrays){const en=this.collisionCircleArrays[ut.bucketInstanceId];c.bl(en.invProjMatrix,Tt),en.viewportMatrix=this.collisionIndex.getViewportMatrix()}ut.justReloaded=!1}markUsedJustification(o,_,rt,ot){const{leftJustifiedTextSymbolIndex:lt,centerJustifiedTextSymbolIndex:ut,rightJustifiedTextSymbolIndex:dt,verticalPlacedTextSymbolIndex:mt,crossTileID:Tt}=rt,Ct=c.c3(_),Ut=ot===c.bL.vertical?mt:Ct==="left"?lt:Ct==="center"?ut:Ct==="right"?dt:-1;lt>=0&&(o.text.placedSymbolArray.get(lt).crossTileID=Ut>=0&&lt!==Ut?0:Tt),ut>=0&&(o.text.placedSymbolArray.get(ut).crossTileID=Ut>=0&&ut!==Ut?0:Tt),dt>=0&&(o.text.placedSymbolArray.get(dt).crossTileID=Ut>=0&&dt!==Ut?0:Tt),mt>=0&&(o.text.placedSymbolArray.get(mt).crossTileID=Ut>=0&&mt!==Ut?0:Tt)}markUsedOrientation(o,_,rt){const ot=_===c.bL.horizontal||_===c.bL.horizontalOnly?_:0,lt=_===c.bL.vertical?_:0,{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:dt,rightJustifiedTextSymbolIndex:mt,verticalPlacedTextSymbolIndex:Tt}=rt,Ct=o.text.placedSymbolArray;ut>=0&&(Ct.get(ut).placedOrientation=ot),dt>=0&&(Ct.get(dt).placedOrientation=ot),mt>=0&&(Ct.get(mt).placedOrientation=ot),Tt>=0&&(Ct.get(Tt).placedOrientation=lt)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const _=this.prevPlacement;let rt=!1;this.prevZoomAdjustment=_?_.zoomAdjustment(this.transform.zoom):0;const ot=_?_.symbolFadeChange(o):1,lt=_?_.opacities:{},ut=_?_.variableOffsets:{},dt=_?_.placedOrientations:{};for(const mt in this.placements){const Tt=this.placements[mt],Ct=lt[mt];Ct?(this.opacities[mt]=new Np(Ct,ot,Tt.text,Tt.icon,null,Tt.clipped),rt=rt||Tt.text!==Ct.text.placed||Tt.icon!==Ct.icon.placed):(this.opacities[mt]=new Np(null,ot,Tt.text,Tt.icon,Tt.skipFade,Tt.clipped),rt=rt||Tt.text||Tt.icon)}for(const mt in lt){const Tt=lt[mt];if(!this.opacities[mt]){const Ct=new Np(Tt,ot,!1,!1);Ct.isHidden()||(this.opacities[mt]=Ct,rt=rt||Tt.text.placed||Tt.icon.placed)}}for(const mt in ut)this.variableOffsets[mt]||!this.opacities[mt]||this.opacities[mt].isHidden()||(this.variableOffsets[mt]=ut[mt]);for(const mt in dt)this.placedOrientations[mt]||!this.opacities[mt]||this.opacities[mt].isHidden()||(this.placedOrientations[mt]=dt[mt]);rt?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=_?_.lastPlacementChangeTime:o)}updateLayerOpacities(o,_,rt,ot){ot&&(this.lastReplacementSourceUpdateTime=ot.updateTime);const lt=new Set;for(const ut of _){const dt=ut.getBucket(o);dt&&ut.latestFeatureIndex&&o.fqid===dt.layerIds[0]&&(this.updateBucketOpacities(dt,lt,ut,ut.collisionBoxArray,rt,ot,ut.tileID,o.scope),dt.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(dt,ut.tileID),dt.elevationType==="road"&&dt.updateRoadElevation(ut.tileID.canonical),dt.updateZOffset())}}updateBucketOpacities(o,_,rt,ot,lt,ut,dt,mt){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const Tt=o.layers[0].layout,Ct=o.layers[0].paint,Ut=!!o.layers[0].dynamicFilter(),Bt=new Np(null,0,!1,!1,!0),$t=Tt.get("text-allow-overlap"),Zt=Tt.get("icon-allow-overlap"),qt=Tt.get("text-variable-anchor"),sr=Tt.get("text-rotation-alignment")==="map",ir=Tt.get("text-pitch-alignment")==="map",cr=Ct.get("symbol-z-offset"),pr=Tt.get("symbol-elevation-reference")==="sea",ur=!cr.isConstant(),Cr=new Np(null,0,$t&&(Zt||!o.hasIconData()||Tt.get("icon-optional")),Zt&&($t||!o.hasTextData()||Tt.get("text-optional")),!0);!o.collisionArrays&&ot&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(ot);const wr=(br,yr,Pr)=>{for(let Or=0;Or<yr/4;Or++)br.opacityVertexArray.emplaceBack(Pr)};let Tr=0;ut&&o.updateReplacement(dt,ut);for(let br=0;br<o.symbolInstances.length;br++){const yr=o.symbolInstances.get(br),{numHorizontalGlyphVertices:Pr,numVerticalGlyphVertices:Or,crossTileID:Nr,numIconVertices:ts,tileAnchorX:rs,tileAnchorY:cs}=yr;let Ss=null;const Zr=this.retainedQueryData[o.bucketInstanceId];ur&&yr&&Zr&&(Ss=rt.latestFeatureIndex.loadFeature({featureIndex:yr.featureIndex,bucketIndex:Zr.bucketIndex,sourceLayerIndex:Zr.sourceLayerIndex,layoutVertexArrayOffset:0}));const Fr=cr.evaluate(Ss,{}),ns=_.has(Nr);let Qr=this.opacities[Nr];ns?Qr=Bt:Qr||(Qr=Cr,this.opacities[Nr]=Qr),_.add(Nr);const gs=Pr>0||Or>0,ks=ts>0,Bs=this.placedOrientations[Nr],js=Bs===c.bL.vertical,Ts=Bs===c.bL.horizontal||Bs===c.bL.horizontalOnly;!gs&&!ks||Qr.isHidden()||Tr++;let Js=!1;if((gs||ks)&&ut)for(const Ks of o.activeReplacements){if(c.bZ(Ks,lt,c.b_.Symbol,mt)||Ks.min.x>rs||rs>Ks.max.x||Ks.min.y>cs||cs>Ks.max.y)continue;const Ns=c.b$(rs,cs,dt.canonical,Ks.footprintTileId.canonical);if(Js=c.c0(Ns,Ks.footprint),Js)break}if(gs){const Ks=Js?_g:Iu(Qr.text);wr(o.text,Pr,js?_g:Ks),wr(o.text,Or,Ts?_g:Ks);const Ns=Qr.text.isHidden(),{leftJustifiedTextSymbolIndex:Gs,centerJustifiedTextSymbolIndex:ln,rightJustifiedTextSymbolIndex:En,verticalPlacedTextSymbolIndex:Hn}=yr,ho=o.text.placedSymbolArray,en=Ns||js?1:0;Gs>=0&&(ho.get(Gs).hidden=en),ln>=0&&(ho.get(ln).hidden=en),En>=0&&(ho.get(En).hidden=en),Hn>=0&&(ho.get(Hn).hidden=Ns||Ts?1:0);const ao=this.variableOffsets[Nr];ao&&this.markUsedJustification(o,ao.anchor,yr,Bs);const bn=this.placedOrientations[Nr];bn&&(this.markUsedJustification(o,"left",yr,bn),this.markUsedOrientation(o,bn,yr))}if(ks){const Ks=Js?_g:Iu(Qr.icon),{placedIconSymbolIndex:Ns,verticalPlacedIconSymbolIndex:Gs}=yr,ln=o.icon.placedSymbolArray,En=Qr.icon.isHidden()?1:0;Ns>=0&&(wr(o.icon,ts,js?_g:Ks),ln.get(Ns).hidden=En),Gs>=0&&(wr(o.icon,yr.numVerticalIconVertices,Ts?_g:Ks),ln.get(Gs).hidden=En)}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ks=o.collisionArrays[br];if(Ks){let Ns=new c.P(0,0),Gs=!0;if(Ks.textBox||Ks.verticalTextBox){if(qt){const En=this.variableOffsets[Nr];En?(Ns=wu(En.anchor,En.width,En.height,En.textOffset,En.textScale),sr&&Ns._rotate(ir?this.transform.angle:-this.transform.angle)):Gs=!1}Ut&&(Gs=!Qr.clipped),Ks.textBox&&Rm(o.textCollisionBox.collisionVertexArray,Qr.text.placed,!Gs||js,Fr,pr,Ns.x,Ns.y),Ks.verticalTextBox&&Rm(o.textCollisionBox.collisionVertexArray,Qr.text.placed,!Gs||Ts,Fr,pr,Ns.x,Ns.y)}const ln=Gs&&!!(!Ts&&Ks.verticalIconBox);Ks.iconBox&&Rm(o.iconCollisionBox.collisionVertexArray,Qr.icon.placed,ln,Fr,pr,yr.hasIconTextFit?Ns.x:0,yr.hasIconTextFit?Ns.y:0),Ks.verticalIconBox&&Rm(o.iconCollisionBox.collisionVertexArray,Qr.icon.placed,!ln,Fr,pr,yr.hasIconTextFit?Ns.x:0,yr.hasIconTextFit?Ns.y:0)}}}if(o.fullyClipped=Tr===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const br=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=br.invProjMatrix,o.placementViewportMatrix=br.viewportMatrix,o.collisionCircleArray=br.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,_){const rt=this.zoomAtLastRecencyCheck===_?1-this.zoomAdjustment(_):1;return this.zoomAtLastRecencyCheck=_,this.commitTime+this.fadeDuration*rt>o}isStale(){return this.stale}setStale(){this.stale=!0}}function Rm(et,o,_,rt,ot,lt,ut){et.emplaceBack(o?1:0,_?1:0,lt||0,ut||0,rt,ot?1:0),et.emplaceBack(o?1:0,_?1:0,lt||0,ut||0,rt,ot?1:0),et.emplaceBack(o?1:0,_?1:0,lt||0,ut||0,rt,ot?1:0),et.emplaceBack(o?1:0,_?1:0,lt||0,ut||0,rt,ot?1:0)}const nv=Math.pow(2,25),yy=Math.pow(2,24),y0=Math.pow(2,17),ov=Math.pow(2,16),_0=Math.pow(2,9),Pu=Math.pow(2,8),Yp=Math.pow(2,1);function Iu(et){if(et.opacity===0&&!et.placed)return 0;if(et.opacity===1&&et.placed)return 4294967295;const o=et.placed?1:0,_=Math.floor(127*et.opacity);return _*nv+o*yy+_*y0+o*ov+_*_0+o*Pu+_*Yp+o}const _g=0;class Ex{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(o,_,rt,ot,lt,ut){const dt=this._bucketParts;for(;this._currentTileIndex<o.length;)if(_.getBucketParts(dt,ot,o[this._currentTileIndex],this._sortAcrossTiles,ut),this._currentTileIndex++,lt())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,dt.sort((mt,Tt)=>mt.sortKey-Tt.sortKey));this._currentPartIndex<dt.length;){const mt=dt[this._currentPartIndex];if(_.placeLayerBucketPart(mt,this._seenCrossTileIDs,rt,mt.symbolInstanceStart===0,ut),this._currentPartIndex++,lt())return!0}return!1}}class iu{constructor(o,_,rt,ot,lt,ut,dt,mt,Tt){this.placement=new YE(o,lt,ut,dt,mt,Tt),this._currentPlacementIndex=_.length-1,this._forceFullPlacement=rt,this._showCollisionBoxes=ot,this._done=!1}isDone(){return this._done}continuePlacement(o,_,rt,ot,lt){const ut=c.o.now(),dt=()=>{const mt=c.o.now()-ut;return!this._forceFullPlacement&&mt>2};for(;this._currentPlacementIndex>=0;){const mt=_[o[this._currentPlacementIndex]],Tt=this.placement.collisionIndex.transform.zoom;if(mt.type==="symbol"&&mt.visibility!=="none"&&(!mt.minzoom||mt.minzoom<=Tt)&&(!mt.maxzoom||mt.maxzoom>Tt)){const Ct=mt,Ut=Ct.layout.get("symbol-z-elevate"),Bt=Ct.layout.get("symbol-sort-key").constantOr(1)!==void 0,$t=Ct.layout.get("symbol-z-order"),Zt=$t==="viewport-y"||$t==="auto"&&!($t!=="viewport-y"&&Bt),qt=Ct.layout.get("text-allow-overlap")||Ct.layout.get("icon-allow-overlap")||Ct.layout.get("text-ignore-placement")||Ct.layout.get("icon-ignore-placement"),sr=Zt&&qt,ir=this._inProgressLayer=this._inProgressLayer||new Ex(Ct),cr=c.B(mt.source,mt.scope);if(ir.continuePlacement(Ut||sr?ot[cr]:rt[cr],this.placement,this._showCollisionBoxes,mt,dt,lt))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const dp=512/c.al/2;class Qp{constructor(o,_,rt){this.tileID=o,this.bucketInstanceId=rt,this.index=new c.c4(_.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const ot=o.canonical.x*c.al,lt=o.canonical.y*c.al;for(let ut=0;ut<_.length;ut++){const{key:dt,crossTileID:mt,tileAnchorX:Tt,tileAnchorY:Ct}=_.get(ut),Ut=Math.floor((ot+Tt)*dp),Bt=Math.floor((lt+Ct)*dp);this.index.add(Ut,Bt),this.keys.push(dt),this.crossTileIDs.push(mt)}this.index.finish()}findMatches(o,_,rt){const ot=this.tileID.canonical.z<_.canonical.z?1:Math.pow(2,this.tileID.canonical.z-_.canonical.z),lt=dp/Math.pow(2,_.canonical.z-this.tileID.canonical.z),ut=_.canonical.x*c.al,dt=_.canonical.y*c.al;for(let mt=0;mt<o.length;mt++){const Tt=o.get(mt);if(Tt.crossTileID)continue;const{key:Ct,tileAnchorX:Ut,tileAnchorY:Bt}=Tt,$t=Math.floor((ut+Ut)*lt),Zt=Math.floor((dt+Bt)*lt),qt=this.index.range($t-ot,Zt-ot,$t+ot,Zt+ot).sort((sr,ir)=>sr-ir);for(const sr of qt){const ir=this.crossTileIDs[sr];if(this.keys[sr]===Ct&&!rt.has(ir)){rt.add(ir),Tt.crossTileID=ir;break}}}}}class _c{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class av{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const _=Math.round((o-this.lng)/360);if(_!==0)for(const rt in this.indexes){const ot=this.indexes[rt],lt={};for(const ut in ot){const dt=ot[ut];dt.tileID=dt.tileID.unwrapTo(dt.tileID.wrap+_),lt[dt.tileID.key]=dt}this.indexes[rt]=lt}this.lng=o}addBucket(o,_,rt){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===_.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let lt=0;lt<_.symbolInstances.length;lt++)_.symbolInstances.get(lt).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]=new Set);const ot=this.usedCrossTileIDs[o.overscaledZ];for(const lt in this.indexes){const ut=this.indexes[lt];if(Number(lt)>o.overscaledZ)for(const dt in ut){const mt=ut[dt];mt.tileID.isChildOf(o)&&mt.findMatches(_.symbolInstances,o,ot)}else{const dt=ut[o.scaledTo(Number(lt)).key];dt&&dt.findMatches(_.symbolInstances,o,ot)}}for(let lt=0;lt<_.symbolInstances.length;lt++){const ut=_.symbolInstances.get(lt);ut.crossTileID||(ut.crossTileID=rt.generate(),ot.add(ut.crossTileID))}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new Qp(o,_.symbolInstances,_.bucketInstanceId),!0}removeBucketCrossTileIDs(o,_){for(const rt of _.crossTileIDs)this.usedCrossTileIDs[o].delete(rt)}removeStaleBuckets(o){let _=!1;for(const rt in this.indexes){const ot=this.indexes[rt];for(const lt in ot)o[ot[lt].bucketInstanceId]||(this.removeBucketCrossTileIDs(rt,ot[lt]),delete ot[lt],_=!0)}return _}}class Tp{constructor(){this.layerIndexes={},this.crossTileIDs=new _c,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,_,rt,ot){let lt=this.layerIndexes[o.fqid];lt===void 0&&(lt=this.layerIndexes[o.fqid]=new av);let ut=!1;const dt={};ot.name!=="globe"&&lt.handleWrapJump(rt);for(const mt of _){const Tt=mt.getBucket(o);Tt&&o.fqid===Tt.layerIds[0]&&(Tt.bucketInstanceId||(Tt.bucketInstanceId=++this.maxBucketInstanceId),lt.addBucket(mt.tileID,Tt,this.crossTileIDs)&&(ut=!0),dt[Tt.bucketInstanceId]=!0)}return lt.removeStaleBuckets(dt)&&(ut=!0),ut}pruneUnusedLayers(o){const _={};o.forEach(rt=>{_[rt]=!0});for(const rt in this.layerIndexes)_[rt]||delete this.layerIndexes[rt]}}const zp=771;class jn{constructor(o,_,rt,ot){this.blendFunction=o,this.blendColor=_.toNonPremultipliedRenderColor(null),this.mask=rt,this.blendEquation=ot}}jn.Replace=[1,0,1,0],jn.disabled=new jn(jn.Replace,c.ao.transparent,[!1,!1,!1,!1]),jn.unblended=new jn(jn.Replace,c.ao.transparent,[!0,!0,!0,!0]),jn.alphaBlended=new jn([1,zp,1,zp],c.ao.transparent,[!0,!0,!0,!0]),jn.alphaBlendedNonPremultiplied=new jn([770,zp,770,zp],c.ao.transparent,[!0,!0,!0,!0]),jn.multiply=new jn([774,0,774,0],c.ao.transparent,[!0,!0,!0,!0]),jn.additive=new jn([1,1,1,1],c.ao.transparent,[!0,!0,!0,!0]);class tn{constructor(o,_,rt){this.func=o,this.mask=_,this.range=rt}}tn.ReadOnly=!1,tn.ReadWrite=!0,tn.disabled=new tn(519,tn.ReadOnly,[0,1]);const v0=7680;class gn{constructor(o,_,rt,ot,lt,ut){this.test=o,this.ref=_,this.mask=rt,this.fail=ot,this.depthFail=lt,this.pass=ut}}gn.disabled=new gn({func:519,mask:0},0,0,v0,v0,v0);const Sx=1029,b0=2305;class mn{constructor(o,_,rt){this.enable=o,this.mode=_,this.frontFace=rt}}function Op(et,o){const _=c.ca(et,3);c.cc(et,o),c.cg(et,3,_)}function lv(et,o){const _=c.c7([]);return c.c8(_,_,-o),c.c9(_,_,-et),_}function w0(et,o){const _=[et[0],et[1],0],rt=[o[0],o[1],0];if(c.ag(_)>=1e-15){const ut=c.aw([],_);c.c5(rt,ut,c.bJ(rt,ut)),o[0]=rt[0],o[1]=rt[1]}const ot=c.bI([],o,et);if(c.c6(ot)<1e-15)return null;const lt=Math.atan2(-ot[1],ot[0]);return lv(Math.atan2(Math.sqrt(et[0]*et[0]+et[1]*et[1]),-et[2]),lt)}mn.disabled=new mn(!1,Sx,b0),mn.backCCW=new mn(!0,Sx,b0),mn.backCW=new mn(!0,Sx,2304),mn.frontCW=new mn(!0,1028,2304),mn.frontCCW=new mn(!0,1028,b0);class ku{constructor(o,_){this.position=o,this.orientation=_}get position(){return this._position}set position(o){if(o){const _=o instanceof c.ae?o:new c.ae(o[0],o[1],o[2]);this._renderWorldCopies&&(_.x=c.bT(_.x,0,1)),this._position=_}else this._position=null}lookAtPoint(o,_,rt){if(this.orientation=null,!this.position)return;const ot=this.position,lt=rt||(this._elevation?this._elevation.getAtPointOrZero(c.ae.fromLngLat(o)):0),ut=c.ae.fromLngLat(o,lt),dt=[ut.x-ot.x,ut.y-ot.y,ut.z-ot.z];_||(_=[0,0,1]),_[2]=Math.abs(_[2]),this.orientation=w0(dt,_)}setPitchBearing(o,_){this.orientation=lv(c.an(o),c.an(-_))}}class E0{constructor(o,_){this._transform=c.bA([]),this.orientation=_,this.position=o}get mercatorPosition(){const o=this.position;return new c.ae(o[0],o[1],o[2])}get position(){const o=c.ca(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var _;o&&c.cg(this._transform,3,[(_=o)[0],_[1],_[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||c.c7([]),o&&Op(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),_=this.right();return{bearing:Math.atan2(-_[1],_[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,_){this._orientation=lv(o,_),Op(this._transform,this._orientation)}forward(){const o=c.ca(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=c.ca(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=c.ca(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,_){const rt=new Float64Array(16);return c.bl(rt,this.getWorldToCamera(o,_)),rt}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(o,_,rt){const ot=this.position;c.c5(ot,ot,-o);const lt=new Float64Array(16);return c.bq(lt,[rt,rt,rt]),c.br(lt,lt,ot),lt[10]*=_,lt}getWorldToCamera(o,_){const rt=new Float64Array(16),ot=new Float64Array(4),lt=this.position;return c.cb(ot,this._orientation),c.c5(lt,lt,-o),c.cc(rt,ot),c.br(rt,rt,lt),rt[1]*=-1,rt[5]*=-1,rt[9]*=-1,rt[13]*=-1,rt[8]*=_,rt[9]*=_,rt[10]*=_,rt[11]*=_,rt}getCameraToClipPerspective(o,_,rt,ot){const lt=new Float64Array(16);return c.cd(lt,o,_,rt,ot),lt}getCameraToClipOrthographic(o,_,rt,ot,lt,ut){const dt=new Float64Array(16);return c.ce(dt,o,_,rt,ot,lt,ut),dt}getDistanceToElevation(o,_=!1){const rt=o===0?0:c.cf(o,_?c.a$(this.position[1]):this.position[1]),ot=this.forward();return(rt-this.position[2])/ot[2]}clone(){return new E0([...this.position],[...this.orientation])}}const hu={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class S0{constructor(o=0,_=0,rt=0,ot=0){if(isNaN(o)||o<0||isNaN(_)||_<0||isNaN(rt)||rt<0||isNaN(ot)||ot<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=_,this.left=rt,this.right=ot}interpolate(o,_,rt){return _.top!=null&&o.top!=null&&(this.top=c.ak(o.top,_.top,rt)),_.bottom!=null&&o.bottom!=null&&(this.bottom=c.ak(o.bottom,_.bottom,rt)),_.left!=null&&o.left!=null&&(this.left=c.ak(o.left,_.left,rt)),_.right!=null&&o.right!=null&&(this.right=c.ak(o.right,_.right,rt)),this}getCenter(o,_){const rt=c.aA((this.left+o-this.right)/2,0,o),ot=c.aA((this.top+_-this.bottom)/2,0,_);return new c.P(rt,ot)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new S0(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Rp=15;class cv{constructor(o,_,rt,ot,lt,ut,dt){this.tileSize=512,this._renderWorldCopies=lt===void 0||lt,this._minZoom=o||0,this._maxZoom=_||22,this._minPitch=rt??0,this._maxPitch=ot??60,this.setProjection(ut),this.setMaxBounds(dt),this.width=0,this.height=0,this._center=new c.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new S0,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new E0,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const o=new cv(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.mercatorFromTransition=this.mercatorFromTransition,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o.frustumCorners=this.frustumCorners,o._allowWorldUnderZoom=this._allowWorldUnderZoom,o}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Rp}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(o,_=!1){const rt=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||rt)&&this._updateCameraOnTerrain(),(o||rt)&&this._constrainCamera(_),this._calcMatrices()}getProjection(){return c.aH(this.projection,["name","center","parallels"])}setProjection(o){this.projectionOptions=o||{name:"mercator"};const _=this.projection?this.getProjection():void 0;this.projection=c.cm(this.projectionOptions);const rt=this.getProjection(),ot=!c.by(_,rt);return ot&&this._calcMatrices(),this.mercatorFromTransition=!1,ot}setOrthographicProjectionAtLowPitch(o){return this._orthographicProjectionAtLowPitch!==o&&(this._orthographicProjectionAtLowPitch=o,this._calcMatrices(),!0)}setMercatorFromTransition(){const o=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.cm({name:"mercator"});const _=o!==this.projection.name;return _&&this._calcMatrices(),_}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return c.bT(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const _=-o*Math.PI/180;this.angle!==_&&(this._unmodified=!1,this.angle=_,this._calcMatrices(),this.rotationMatrix=c.cn(),c.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const _=c.aA(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==_&&(this._unmodified=!1,this._pitch=_,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=c.an(o),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const o=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/o)}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const _=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==_&&(this._unmodified=!1,this._setZoom(_),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(o){this._tileCoverLift!==o&&(this._tileCoverLift=o)}_updateCameraOnTerrain(){const o=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,_=this.elevation&&o===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||o===Number.NEGATIVE_INFINITY&&(!_||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const rt=this._elevation;_||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&rt.exaggeration()&&this._centerAltitudeValidForExaggeration!==rt.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*rt.exaggeration(),this._centerAltitudeValidForExaggeration=rt.exaggeration()):(this._centerAltitude=o||0,this._centerAltitudeValidForExaggeration=rt.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const o=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(o)}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,_=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],rt=this.horizonLineFromTop();let ot=0,lt=0;for(let ut=0;ut<_.length;ut++){const dt=new c.P(_[ut][0]*this.width,rt+_[ut][1]*(this.height-rt)),mt=o.pointCoordinate(dt);if(!mt)continue;const Tt=1/Math.hypot(mt[0]-this._camera.position[0],mt[1]-this._camera.position[1]);ot+=mt[3]*Tt,lt+=Tt}return lt===0?NaN:ot/lt}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,_=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),rt=this.pixelsPerMeter/this.worldSize*_,ot=this._mercatorZfromZoom(o),lt=this._mercatorZfromZoom(this._maxZoom),ut=Math.max(ot-rt,lt);this._setZoom(this._zoomFromMercatorZ(ut))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}equals(o){const _=this.elevation,rt=o.elevation,ot=_!=null!=(rt!=null)||_&&rt&&_.exaggeration()!==rt.exaggeration();return this.width===o.width&&this.height===o.height&&this.center.lng===o.center.lng&&this.center.lat===o.center.lat&&this.zoom===o.zoom&&this.bearing===o.bearing&&this.pitch===o.pitch&&this.fov===o.fov&&this.projection.name===o.projection.name&&this._edgeInsets.equals(o.padding)&&!ot}computeZoomRelativeTo(o){const _=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let rt;rt=o.z<this._camera.position[2]?[_.x,_.y,_.z]:[o.x,o.y,o.z];const ot=c.ag(c.av([],this._camera.position,rt));return c.aA(this._zoomFromMercatorZ(ot),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let _=!1;if(o.orientation&&!c.cp(o.orientation,this._camera.orientation)&&(_=this._setCameraOrientation(o.orientation)),o.position){const rt=[o.position.x,o.position.y,o.position.z];c.cq(rt,this._camera.position)||(this._setCameraPosition(rt),_=!0)}_&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,_=new ku;return _.position=new c.ae(o[0],o[1],o[2]),_.orientation=this._camera.orientation,_._elevation=this.elevation,_._renderWorldCopies=this.renderWorldCopies,_}_setCameraOrientation(o){if(!c.cr(o))return!1;c.cs(o,o);const _=c.ct([],[0,0,-1],o),rt=c.ct([],[0,-1,0],o);if(rt[2]<0)return!1;const ot=w0(_,rt);return!!ot&&(this._camera.orientation=ot,!0)}_setCameraPosition(o){const _=this.zoomScale(this.minZoom)*this.tileSize,rt=this.zoomScale(this.maxZoom)*this.tileSize,ot=this.cameraToCenterDistance;o[2]=c.aA(o[2],ot/rt,ot/_),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,_,rt){this._unmodified=!1,this._edgeInsets.interpolate(o,_,rt),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const _=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,_)}getVisibleUnwrappedCoordinates(o){const _=[new c.cu(0,o)];if(this.renderWorldCopies){const rt=this.pointCoordinate(new c.P(0,0)),ot=this.pointCoordinate(new c.P(this.width,0)),lt=this.pointCoordinate(new c.P(this.width,this.height)),ut=this.pointCoordinate(new c.P(0,this.height)),dt=Math.floor(Math.min(rt.x,ot.x,lt.x,ut.x)),mt=Math.floor(Math.max(rt.x,ot.x,lt.x,ut.x)),Tt=1;for(let Ct=dt-Tt;Ct<=mt+Tt;Ct++)Ct!==0&&_.push(new c.cu(Ct,o))}return _}isLODDisabled(o){return(!o||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(o,_,rt,ot){let lt=[];const ut=rt!=null,dt=!ut;if(dt&&this.zoom<_||ut&&rt[0]===0&&rt[1]===0)return lt;const mt=new Set,Tt=(Ut,Bt,$t,Zt,qt)=>{const sr=c.cY(Bt,Ut,$t,Zt,qt);mt.has(sr)||(lt.push(new c.aQ(Ut,Bt,$t,Zt,qt)),mt.add(sr))};for(let Ut=0;Ut<o.length;Ut++){const Bt=o[Ut];if(dt&&Bt.canonical.z!==_||ut&&ot!==void 0&&ot>Bt.canonical.z)continue;const $t=Bt.canonical,Zt=Bt.overscaledZ,qt=Bt.wrap,sr=1<<$t.z,ir=$t.x+1<sr,cr=$t.x>0,pr=$t.y+1<sr,ur=$t.y>0,Cr=Bt.wrap-(cr?0:1),wr=Bt.wrap+(ir?0:1),Tr=cr?$t.x-1:sr-1,br=ir?$t.x+1:0;if(ut)rt[0]<0?(Tt(Zt,wr,$t.z,br,$t.y),rt[1]<0&&pr&&(Tt(Zt,qt,$t.z,$t.x,$t.y+1),Tt(Zt,wr,$t.z,br,$t.y+1)),rt[1]>0&&ur&&(Tt(Zt,qt,$t.z,$t.x,$t.y-1),Tt(Zt,wr,$t.z,br,$t.y-1))):rt[0]>0?(Tt(Zt,Cr,$t.z,Tr,$t.y),rt[1]<0&&pr&&(Tt(Zt,qt,$t.z,$t.x,$t.y+1),Tt(Zt,Cr,$t.z,Tr,$t.y+1)),rt[1]>0&&ur&&(Tt(Zt,qt,$t.z,$t.x,$t.y-1),Tt(Zt,Cr,$t.z,Tr,$t.y-1))):rt[1]<0&&pr?Tt(Zt,qt,$t.z,$t.x,$t.y+1):ur&&Tt(Zt,qt,$t.z,$t.x,$t.y-1);else{const yr=Bt.visibleQuadrants;1&yr&&(Tt(Zt,Cr,$t.z,Tr,$t.y),ur&&(Tt(Zt,qt,$t.z,$t.x,$t.y-1),Tt(Zt,Cr,$t.z,Tr,$t.y-1))),2&yr&&(Tt(Zt,wr,$t.z,br,$t.y),ur&&(Tt(Zt,qt,$t.z,$t.x,$t.y-1),Tt(Zt,wr,$t.z,br,$t.y-1))),4&yr&&(Tt(Zt,Cr,$t.z,Tr,$t.y),pr&&(Tt(Zt,qt,$t.z,$t.x,$t.y+1),Tt(Zt,Cr,$t.z,Tr,$t.y+1))),8&yr&&(Tt(Zt,wr,$t.z,br,$t.y),pr&&(Tt(Zt,qt,$t.z,$t.x,$t.y+1),Tt(Zt,wr,$t.z,br,$t.y+1)))}}const Ct=[];for(const Ut of lt)lt.some(Bt=>Ut.isChildOf(Bt))||Ct.push(Ut);if(lt=Ct.filter(Ut=>!o.some(Bt=>!!(Ut.overscaledZ<_&&Bt.isChildOf(Ut))||Ut.equals(Bt)||Ut.isChildOf(Bt))),dt){const Ut=1<<_,Bt=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),$t=[Ut*Bt.x,Ut*Bt.y],Zt=4,qt=Zt*Zt;lt=lt.filter(sr=>{const ir=sr.canonical.x+.5-$t[0],cr=sr.canonical.y+.5-$t[1];return ir*ir+cr*cr<qt})}return lt}extendTileCoverToNearPlane(o,_,rt){const ot=[],lt=new Set;for(const cr of o)lt.add(cr.key);const ut=(cr,pr,ur,Cr,wr)=>{const Tr=c.cY(pr,cr,ur,Cr,wr);lt.has(Tr)||(ot.push(new c.aQ(cr,pr,ur,Cr,wr)),lt.add(Tr))},dt=o.reduce((cr,pr)=>Math.max(cr,pr.overscaledZ),rt),mt=1<<rt,Tt=[new c.P(0,0),new c.P(c.al,0),new c.P(c.al,c.al),new c.P(0,c.al)],Ct=new c.P(0,0),Ut=new c.P(0,0),Bt=(cr,pr)=>{const ur=Math.floor(cr[0]),Cr=Math.floor(cr[1]),wr=(cr[0]-ur)*c.al,Tr=(cr[1]-Cr)*c.al,br=Math.floor(pr[0]),yr=Math.floor(pr[1]),Pr=(pr[0]-br)*c.al,Or=(pr[1]-yr)*c.al;for(let Nr=-1;Nr<=1;Nr++){const ts=ur+Nr;if(!(ts<0||ts>=mt)){Ct.x=wr-Nr*c.al,Ut.x=Pr-(ts-br)*c.al;for(let rs=-1;rs<=1;rs++){const cs=Cr+rs;Ct.y=Tr-rs*c.al,Ut.y=Or-(cs-yr)*c.al,c.cZ(Ct,Ut,Tt)&&ut(dt,0,rt,ts,cs)}}}},$t=_.points,Zt=$t[c.cv],qt=$t[c.cw],sr=this._projectToGround(Zt,$t[c.cx]),ir=this._projectToGround(qt,$t[c.cy]);return Bt(Zt,sr),Bt(qt,ir),ot}_projectToGround(o,_){return c.cz(c.cA(),o,_,o[2]/(o[2]-_[2]))}coveringTiles(o){let _=this.coveringZoomLevel(o);const rt=_,ot=this.elevation&&this.elevation.exaggeration(),lt=ot&&!o.isTerrainDEM,ut=this.projection.name==="mercator";if(o.minzoom!==void 0&&_<o.minzoom)return[];o.maxzoom!==void 0&&_>o.maxzoom&&(_=o.maxzoom);const dt=this.locationCoordinate(this.center),mt=this.center.lat,Tt=1<<_,Ct=[Tt*dt.x,Tt*dt.y,0],Ut=this.projection.name==="globe",Bt=!Ut,$t=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,_,Bt),Zt=Ut?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),qt=Tt*c.cf(1,this.center.lat),sr=this._camera.position[2]/c.cf(1,this.center.lat),ir=[Tt*Zt.x,Tt*Zt.y,sr*(Bt?1:qt)],cr=Ut||ot,pr=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),ur=this.isLODDisabled(!0)?_:0;let Cr;if(this._elevation&&o.isTerrainDEM)Cr=1e4*this._elevation.exaggeration();else if(this._elevation){const Fr=this._elevation.getMinMaxForVisibleTiles();Cr=Fr?Fr.max:this._centerAltitude}else Cr=this._centerAltitude;const wr=o.isTerrainDEM?-Cr:this._elevation?this._elevation.getMinElevationBelowMSL():0,Tr=this.projection.isReprojectedInTileSpace?c.cC(this):1,br=Fr=>{const Qr=new c.ae(Fr.x+25e-6,Fr.y,Fr.z),gs=new c.ae(Fr.x,Fr.y+25e-6,Fr.z),ks=Fr.toLngLat(),Bs=Qr.toLngLat(),js=gs.toLngLat(),Ts=this.locationCoordinate(ks),Js=this.locationCoordinate(Bs),Ks=this.locationCoordinate(js),Ns=Math.hypot(Js.x-Ts.x,Js.y-Ts.y),Gs=Math.hypot(Ks.x-Ts.x,Ks.y-Ts.y);return Math.sqrt(Ns*Gs)*Tr/25e-6},yr=Fr=>{const ns=Cr,Qr=wr;return{aabb:c.cF(this,Tt,0,0,0,Fr,Qr,ns,this.projection),zoom:0,x:0,y:0,minZ:Qr,maxZ:ns,wrap:Fr,fullyVisible:!1}},Pr=[];let Or=[];const Nr=_,ts=o.reparseOverscaled?rt:_,rs=(sr-this._centerAltitude)*qt,cs=Fr=>{if(!this._elevation||!Fr.tileID||!ut)return;const ns=this._elevation.getMinMaxForTile(Fr.tileID),Qr=Fr.aabb;ns?(Qr.min[2]=ns.min,Qr.max[2]=ns.max,Qr.center[2]=(Qr.min[2]+Qr.max[2])/2):(Fr.shouldSplit=Zr(Fr),Fr.shouldSplit||(Qr.min[2]=Qr.max[2]=Qr.center[2]=this._centerAltitude))},Ss=(Fr,ns)=>{if(.707*ns<Fr)return 1;const Qr=ns/Fr;return Qr/(1.4144271570014144+(Math.pow(1.1,Qr-1.4144271570014144+1)-1)/(1.1-1)-1)},Zr=Fr=>{if(Fr.zoom<ur)return!0;if(Fr.zoom===Nr)return!1;if(Fr.shouldSplit!=null)return Fr.shouldSplit;const ns=Fr.aabb.distanceX(ir),Qr=Fr.aabb.distanceY(ir);let gs=rs,ks=1;if(Ut){gs=Fr.aabb.distanceZ(ir);const Gs=Math.pow(2,Fr.zoom),ln=c.a$((Fr.y+1)/Gs),En=c.a$(Fr.y/Gs),Hn=Math.min(Math.max(mt,ln),En),ho=c.d1(Hn)/c.d1(mt);if(ks=Hn===mt?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ho/this._mercatorScaleRatio),this.zoom<=c.c_&&Fr.zoom===Nr-1&&ho>=.9)return!0}else if(lt&&(gs=Fr.aabb.distanceZ(ir)*qt),this.projection.isReprojectedInTileSpace&&rt<=5){const Gs=Math.pow(2,Fr.zoom),ln=br(new c.ae((Fr.x+.5)/Gs,(Fr.y+.5)/Gs));ks=ln>.85?1:ln}if(!ut&&!Ut){const Gs=Math.sqrt(ns*ns+Qr*Qr+gs*gs);let ln=(1<<Nr-Fr.zoom)*pr*ks;return ln*=Ss(Math.max(gs,rs),Gs),Gs<ln}let Bs=Number.MAX_VALUE,js=0;const Ts=Fr.aabb.getCorners(),Js=[];for(const Gs of Ts){c.av(Js,Gs,ir),Ut||(lt?Js[2]*=qt:Js[2]=rs);const ln=c.bJ(Js,this._camera.forward());ln<Bs&&(Bs=ln,js=Math.abs(Js[2]))}let Ks=(1<<Nr-Fr.zoom)*pr*ks;if(Ks*=Ss(Math.max(js,rs),Bs),Bs<Ks)return!0;const Ns=Fr.aabb.closestPoint(Ct);return Ns[0]===Ct[0]&&Ns[1]===Ct[1]};if(this.renderWorldCopies)for(let Fr=1;Fr<=3;Fr++)Pr.push(yr(-Fr)),Pr.push(yr(Fr));for(Pr.push(yr(0));Pr.length>0;){const Fr=Pr.pop(),ns=Fr.x,Qr=Fr.y;let gs=Fr.fullyVisible;const ks=()=>this.projection.name==="globe"&&(Fr.y===0||Fr.y===(1<<Fr.zoom)-1);if(!gs){let Bs=cr?Fr.aabb.intersects($t):Fr.aabb.intersectsFlat($t);if(Bs===0&&ks()){const js=new c.cD(Fr.zoom,ns,Qr);Bs=c.cE(this,Tt,js,!0).intersects($t)}if(Bs===0)continue;gs=Bs===2}if(Fr.zoom!==Nr&&Zr(Fr))for(let Bs=0;Bs<4;Bs++){const js=(ns<<1)+Bs%2,Ts=(Qr<<1)+(Bs>>1),Js={aabb:ut?Fr.aabb.quadrant(Bs):c.cF(this,Tt,Fr.zoom+1,js,Ts,Fr.wrap,Fr.minZ,Fr.maxZ,this.projection),zoom:Fr.zoom+1,x:js,y:Ts,wrap:Fr.wrap,fullyVisible:gs,tileID:void 0,shouldSplit:void 0,minZ:Fr.minZ,maxZ:Fr.maxZ};lt&&!Ut&&(Js.tileID=new c.aQ(Fr.zoom+1===Nr?ts:Fr.zoom+1,Fr.wrap,Fr.zoom+1,js,Ts),cs(Js)),Pr.push(Js)}else{const Bs=Fr.zoom===Nr?ts:Fr.zoom;if(o.minzoom&&o.minzoom>Bs)continue;let js=0;if(!gs){let Ns=cr?Fr.aabb.intersectsPrecise($t):Fr.aabb.intersectsPreciseFlat($t);if(Ns===0&&ks()){const Gs=new c.cD(Fr.zoom,ns,Qr);Ns=c.cE(this,Tt,Gs,!0).intersectsPrecise($t)}if(Ns===0)continue;if(o.calculateQuadrantVisibility)if($t.containsPoint(Fr.aabb.center))js=15;else for(let Gs=0;Gs<4;Gs++)Fr.aabb.quadrant(Gs).intersects($t)!==0&&(js|=1<<Gs)}const Ts=Ct[0]-(.5+ns+(Fr.wrap<<Fr.zoom))*(1<<_-Fr.zoom),Js=Ct[1]-.5-Qr,Ks=Fr.tileID?Fr.tileID:new c.aQ(Bs,Fr.wrap,Fr.zoom,ns,Qr);o.calculateQuadrantVisibility&&(Ks.visibleQuadrants=js),Or.push({tileID:Ks,distanceSq:Ts*Ts+Js*Js})}}if(this.fogCullDistSq){const Fr=this.fogCullDistSq,ns=this.horizonLineFromTop();Or=Or.filter(Qr=>{const gs=[0,0,0,1],ks=[c.al,c.al,0,1],Bs=this.calculateFogTileMatrix(Qr.tileID.toUnwrapped());c.aC(gs,gs,Bs),c.aC(ks,ks,Bs);const js=c.cG([],gs,ks),Ts=c.cH([],gs,ks),Js=c.c$(js,Ts);if(Js===0)return!0;let Ks=!1;const Ns=this._elevation;if(Ns&&Js>Fr&&ns!==0){const Gs=this.calculateProjMatrix(Qr.tileID.toUnwrapped());let ln;o.isTerrainDEM||(ln=Ns.getMinMaxForTile(Qr.tileID)),ln||(ln={min:wr,max:Cr});const En=c.cI(this.rotation),Hn=[En[0]*c.al,En[1]*c.al,ln.max];c.af(Hn,Hn,Gs),Ks=(1-Hn[1])*this.height*.5<ns}return Js<Fr||Ks})}return Or.sort((Fr,ns)=>Fr.distanceSq-ns.distanceSq).map(Fr=>Fr.tileID)}resize(o,_){this.width=o,this.height=_,this.pixelsToGLUnits=[2/o,-2/_],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log2(o)}project(o){const _=c.aA(o.lat,-c.cJ,c.cJ),rt=this.projection.project(o.lng,_);return new c.P(rt.x*this.worldSize,rt.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(o,_){let rt,ot;const lt=this.centerPoint;if(this.projection.name==="globe"){const dt=this.worldSize;rt=(_.x-lt.x)/dt,ot=(_.y-lt.y)/dt}else{const dt=this.pointCoordinate(_),mt=this.pointCoordinate(lt);rt=dt.x-mt.x,ot=dt.y-mt.y}const ut=this.locationCoordinate(o);this.setLocation(new c.ae(ut.x-rt,ut.y-ot))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o,_){return this.projection.locationPoint(this,o,_)}locationPoint3D(o,_){return this.projection.locationPoint(this,o,_,!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o,_){return this.coordinateLocation(this.pointCoordinate3D(o,_))}locationCoordinate(o,_){const rt=_?c.cf(_,o.lat):void 0,ot=this.projection.project(o.lng,o.lat);return new c.ae(ot.x,ot.y,rt)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,_){const rt=_??this._centerAltitude,ot=[o.x,o.y,0,1],lt=[o.x,o.y,1,1];c.aC(ot,ot,this.pixelMatrixInverse),c.aC(lt,lt,this.pixelMatrixInverse);const ut=lt[3];c.cK(ot,ot,1/ot[3]),c.cK(lt,lt,1/ut);const dt=ot[2],mt=lt[2];return{p0:ot,p1:lt,t:dt===mt?0:(rt-dt)/(mt-dt)}}screenPointToMercatorRay(o){const _=[o.x,o.y,0,1],rt=[o.x,o.y,1,1];return c.aC(_,_,this.pixelMatrixInverse),c.aC(rt,rt,this.pixelMatrixInverse),c.cK(_,_,1/_[3]),c.cK(rt,rt,1/rt[3]),_[2]=c.cf(_[2],this._center.lat)*this.worldSize,rt[2]=c.cf(rt[2],this._center.lat)*this.worldSize,c.cK(_,_,1/this.worldSize),c.cK(rt,rt,1/this.worldSize),new c.ax([_[0],_[1],_[2]],c.aw([],c.av([],rt,_)))}rayIntersectionCoordinate(o){const{p0:_,p1:rt,t:ot}=o,lt=c.cf(_[2],this._center.lat),ut=c.cf(rt[2],this._center.lat);return new c.ae(c.ak(_[0],rt[0],ot)/this.worldSize,c.ak(_[1],rt[1],ot)/this.worldSize,c.ak(lt,ut,ot))}pointCoordinate(o,_=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,_)}pointCoordinate3D(o,_){if(!this.elevation)return this.pointCoordinate(o,_);let rt=this.projection.pointCoordinate3D(this,o.x,o.y);if(rt)return new c.ae(rt[0],rt[1],rt[2]);let ot=0,lt=this.horizonLineFromTop();if(o.y>lt)return this.pointCoordinate(o,_);const ut=.02*lt,dt=o.clone();for(let mt=0;mt<10&&lt-ot>ut;mt++){dt.y=c.ak(ot,lt,.66);const Tt=this.projection.pointCoordinate3D(this,dt.x,dt.y);Tt?(lt=dt.y,rt=Tt):ot=dt.y}return rt?new c.ae(rt[0],rt[1],rt[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){return this.projection.isPointAboveHorizon(this,o)}isPointOnSurface(o){if(o.y<0||o.y>this.height||o.x<0||o.x>this.width)return!1;if(this.elevation||this.zoom>=c.cL)return!this.isPointAboveHorizon(o);const _=this.pointCoordinate(o);return _.y>=0&&_.y<=1}_coordinatePoint(o,_){const rt=_&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,ot=[o.x*this.worldSize,o.y*this.worldSize,rt+o.toAltitude(),1];return c.aC(ot,ot,this.pixelMatrix),ot[3]>0?new c.P(ot[0]/ot[3],ot[1]/ot[3]):new c.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:o,left:_}=this._edgeInsets,rt=this.height-this._edgeInsets.bottom,ot=this.width-this._edgeInsets.right,lt=this.pointLocation3D(new c.P(_,o)),ut=this.pointLocation3D(new c.P(ot,o)),dt=this.pointLocation3D(new c.P(ot,rt)),mt=this.pointLocation3D(new c.P(_,rt));let Tt=Math.min(lt.lng,ut.lng,dt.lng,mt.lng),Ct=Math.max(lt.lng,ut.lng,dt.lng,mt.lng),Ut=Math.min(lt.lat,ut.lat,dt.lat,mt.lat),Bt=Math.max(lt.lat,ut.lat,dt.lat,mt.lat);const $t=Math.pow(2,-this.zoom)/16*270,Zt=this.projection.name==="globe"?1:4,qt=(sr,ir,cr,pr,ur)=>{const Cr=(sr+cr)/2,wr=(ir+pr)/2,Tr=new c.P(Cr,wr),{lng:br,lat:yr}=this.pointLocation3D(Tr),Pr=Math.max(0,Tt-br,Ut-yr,br-Ct,yr-Bt);Tt=Math.min(Tt,br),Ct=Math.max(Ct,br),Ut=Math.min(Ut,yr),Bt=Math.max(Bt,yr),(ur<Zt||Pr>$t)&&(qt(sr,ir,Cr,wr,ur+1),qt(Cr,wr,cr,pr,ur+1))};if(qt(_,o,ot,o,1),qt(ot,o,ot,rt,1),qt(ot,rt,_,rt,1),qt(_,rt,_,o,1),this.projection.name==="globe"){const[sr,ir]=c.cM(this);sr?(Bt=90,Ct=180,Tt=-180):ir&&(Ut=-90,Ct=180,Tt=-180)}return new c.aI(new c.aT(Tt,Ut),new c.aT(Ct,Bt))}_getBoundsRectangular(o,_){const{top:rt,left:ot}=this._edgeInsets,lt=this.height-this._edgeInsets.bottom,ut=this.width-this._edgeInsets.right,dt=new c.P(ot,rt),mt=new c.P(ut,rt),Tt=new c.P(ut,lt),Ct=new c.P(ot,lt);let Ut=this.pointCoordinate(dt,o),Bt=this.pointCoordinate(mt,o);const $t=this.pointCoordinate(Tt,_),Zt=this.pointCoordinate(Ct,_),qt=(sr,ir)=>(ir.y-sr.y)/(ir.x-sr.x);return Ut.y>1&&Bt.y>=0?Ut=new c.ae((1-Zt.y)/qt(Zt,Ut)+Zt.x,1):Ut.y<0&&Bt.y<=1&&(Ut=new c.ae(-Zt.y/qt(Zt,Ut)+Zt.x,0)),Bt.y>1&&Ut.y>=0?Bt=new c.ae((1-$t.y)/qt($t,Bt)+$t.x,1):Bt.y<0&&Ut.y<=1&&(Bt=new c.ae(-$t.y/qt($t,Bt)+$t.x,0)),new c.aI().extend(this.coordinateLocation(Ut)).extend(this.coordinateLocation(Bt)).extend(this.coordinateLocation(Zt)).extend(this.coordinateLocation($t))}_getBoundsRectangularTerrain(){const o=this.elevation;if(!o.visibleDemTiles.length||o.isUsingMockSource())return this._getBoundsRectangular(0,0);const _=o.visibleDemTiles.reduce((rt,ot)=>{if(ot.dem){const lt=ot.dem.tree;rt.min=Math.min(rt.min,lt.minimums[0]),rt.max=Math.max(rt.max,lt.maximums[0])}return rt},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(_.min*o.exaggeration(),_.max*o.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(o=!0){const _=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,rt=this.height/2-_*(1-this._horizonShift);return o?Math.max(0,rt):rt}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-c.cJ,this.maxLat=c.cJ,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.aF(this.minLng)*this.tileSize,this.worldMaxX=c.aF(this.maxLng)*this.tileSize,this.worldMinY=c.aJ(this.maxLat)*this.tileSize,this.worldMaxY=c.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,_){return this.projection.createTileMatrix(this,_,o)}calculateDistanceTileData(o){const _=o.key,rt=this._distanceTileDataCache;if(rt[_])return rt[_];const ot=o.canonical,lt=1/this.height,ut=this.cameraWorldSize,dt=ut/this.zoomScale(ot.z),mt=(ot.x+Math.pow(2,ot.z)*o.wrap)*dt,Tt=ot.y*dt,Ct=this.point;Ct.x*=ut/this.worldSize,Ct.y*=ut/this.worldSize;const Ut=this.angle,Bt=Math.sin(-Ut),$t=-Math.cos(-Ut);return rt[_]={bearing:[Bt,$t],center:[(Ct.x-mt)*lt,(Ct.y-Tt)*lt],scale:dt/c.al*lt},rt[_]}calculateFogTileMatrix(o){const _=o.key,rt=this._fogTileMatrixCache;if(rt[_])return rt[_];const ot=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,o);return c.aB(ot,this.worldToFogMatrix,ot),rt[_]=new Float32Array(ot),rt[_]}calculateProjMatrix(o,_=!1,rt=!1){const ot=o.key;let lt;if(lt=rt?this._expandedProjMatrixCache:_?this._alignedProjMatrixCache:this._projMatrixCache,lt[ot])return lt[ot];const ut=this.calculatePosMatrix(o,this.worldSize);let dt;return dt=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:rt?this.expandedFarZProjMatrix:_?this.alignedProjMatrix:this.projMatrix,c.aB(ut,dt,ut),lt[ot]=new Float32Array(ut),lt[ot]}calculatePixelsToTileUnitsMatrix(o){const _=o.tileID.key,rt=this._pixelsToTileUnitsCache;if(rt[_])return rt[_];const ot=c.cN(o,this);return rt[_]=ot,rt[_]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const o=1/this.worldSize,_=c.bq([],[o,o,o]);return c.aB(_,_,this.globeMatrix),_}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const o=this._elevation;this._updateCameraState();const _=c.cf(1,this._center.lat)*this.worldSize,rt=this._computeCameraPosition(_),ot=this._camera.forward(),lt=c.cf(1,this._center.lat);rt[2]/=lt,ot[2]/=lt,c.aw(ot,ot);const ut=o.raycast(rt,ot,o.exaggeration());if(ut){const dt=c.bH([],rt,ot,ut),mt=new c.ae(dt[0],dt[1],c.cf(dt[2],c.a$(dt[1]))),Tt=(mt.z+c.ag([mt.x-rt[0],mt.y-rt[1],mt.z-rt[2]*lt]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Tt),this._centerAltitude=mt.toAltitude(),this._center=this.coordinateLocation(mt),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(o=!1){if(!this._elevation)return;const _=this._elevation,rt=c.cf(1,this._center.lat)*this.worldSize,ot=this._computeCameraPosition(rt),lt=_.getAtPointOrZero(new c.ae(...ot)),ut=this.pixelsPerMeter/this.worldSize*lt,dt=this._minimumHeightOverTerrain(),mt=ot[2]-ut;if(mt<=dt)if(mt<0||o){const Tt=this.locationCoordinate(this._center,this._centerAltitude),Ct=[ot[0],ot[1],Tt.z-ot[2]],Ut=c.ag(Ct);Ct[2]-=(dt-mt)/this._pixelsPerMercatorPixel;const Bt=c.ag(Ct);if(Bt===0)return;c.c5(Ct,Ct,Ut/Bt*this._pixelsPerMercatorPixel),this._camera.position=[ot[0],ot[1],Tt.z*this._pixelsPerMercatorPixel-Ct[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||o){const Bt=this.center;return Bt.lat=c.aA(Bt.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!o)&&(Bt.lng=c.aA(Bt.lng,this.minLng,this.maxLng)),this.center=Bt,void(this._constraining=!1)}const _=this._unmodified,{x:rt,y:ot}=this.point;let lt=0,ut=rt,dt=ot;const mt=this.width/2,Tt=this.height/2,Ct=this.worldMinY*this.scale,Ut=this.worldMaxY*this.scale;if(ot-Tt<Ct&&(dt=Ct+Tt),ot+Tt>Ut&&(dt=Ut-Tt),Ut-Ct<this.height&&(lt=Math.max(lt,this.height/(Ut-Ct)),dt=(Ut+Ct)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Bt=this.worldMinX*this.scale,$t=this.worldMaxX*this.scale,Zt=this.worldSize/2-(Bt+$t)/2;ut=(rt+Zt+this.worldSize)%this.worldSize-Zt,ut-mt<Bt&&(ut=Bt+mt),ut+mt>$t&&(ut=$t-mt),$t-Bt<this.width&&(lt=Math.max(lt,this.width/($t-Bt)),ut=($t+Bt)/2)}ut===rt&&dt===ot||this._allowWorldUnderZoom||(this.center=this.unproject(new c.P(ut,dt))),lt&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(lt)),this._constrainCamera(),this._unmodified=_,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,_=this.projection.name==="globe",rt=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=c.cf(1,this.center.lat)/c.cf(1,c.d2));const ot=c.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,ot),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const lt=this.projection.zAxisUnit==="meters"?rt:1,ut=this._camera.getWorldToCamera(this.worldSize,lt);let dt;const mt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(mt[8]=2*-o.x/this.width,mt[9]=2*o.y/this.height,this.isOrthographic){let yr=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Pr=yr*this.aspect,Or=-Pr,Nr=-yr;Pr-=o.x,Or-=o.x,yr+=o.y,Nr+=o.y,dt=this._camera.getCameraToClipOrthographic(Or,Pr,Nr,yr,this._nearZ,this._farZ),((ts,rs,cs,Ss)=>{for(let Zr=0;Zr<16;Zr++)ts[Zr]=c.ak(rs[Zr],cs[Zr],Ss)})(dt,dt,mt,c.d0(this.pitch>=Rp?1:this.pitch/Rp))}else dt=mt;const Tt=c.cP([],mt,ut);let Ct=c.cP([],dt,ut);if(this.projection.isReprojectedInTileSpace){const yr=this.locationCoordinate(this.center),Pr=c.bA([]);c.br(Pr,Pr,[yr.x*this.worldSize,yr.y*this.worldSize,0]),c.aB(Pr,Pr,c.cQ(this)),c.br(Pr,Pr,[-yr.x*this.worldSize,-yr.y*this.worldSize,0]),c.aB(Ct,Ct,Pr),c.aB(Tt,Tt,Pr),this.inverseAdjustmentMatrix=c.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=c.cS([],Ct,[this.worldSize,this.worldSize,this.worldSize/lt,1]),this.projMatrix=Ct,this.invProjMatrix=c.bl(new Float64Array(16),this.projMatrix),_){const yr=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);yr[8]=2*-o.x/this.width,yr[9]=2*o.y/this.height,this.expandedFarZProjMatrix=c.cP([],yr,ut)}else this.expandedFarZProjMatrix=this.projMatrix;const Ut=c.bl([],dt);this.frustumCorners=c.cT.fromInvProjectionMatrix(Ut,this.horizonLineFromTop(),this.height),this.cameraFrustum=c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!_);const Bt=new Float32Array(16);c.bA(Bt),c.cS(Bt,Bt,[1,-1,1]),c.cU(Bt,Bt,this._pitch),c.bB(Bt,Bt,this.angle);const $t=c.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=c.bz($t);const Zt=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$t[8]=2*-o.x/this.width,$t[9]=2*(o.y+Zt)/this.height,this.skyboxMatrix=c.aB(Bt,$t,Bt);const qt=this.point,sr=qt.x,ir=qt.y,cr=this.width%2/2,pr=this.height%2/2,ur=Math.cos(this.angle),Cr=Math.sin(this.angle),wr=sr-Math.round(sr)+ur*cr+Cr*pr,Tr=ir-Math.round(ir)+ur*pr+Cr*cr,br=new Float64Array(Ct);if(c.br(br,br,[wr>.5?wr-1:wr,Tr>.5?Tr-1:Tr,0]),this.alignedProjMatrix=br,Ct=c.bC(),c.cS(Ct,Ct,[this.width/2,-this.height/2,1]),c.br(Ct,Ct,[1,-1,0]),this.labelPlaneMatrix=Ct,Ct=c.bC(),c.cS(Ct,Ct,[1,-1,1]),c.br(Ct,Ct,[-1,-1,0]),c.cS(Ct,Ct,[2/this.width,2/this.height,1]),this.glCoordMatrix=Ct,this.pixelMatrix=c.aB(new Float64Array(16),this.labelPlaneMatrix,Tt),this._calcFogMatrices(),this._distanceTileDataCache={},Ct=c.bl(new Float64Array(16),this.pixelMatrix),!Ct)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=Ct,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=c.cV(this);const yr=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.af(yr,yr,ut),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=Ct;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSizeForFog,_=this.cameraPixelsPerMeter,rt=this._camera.position,ot=1/this.height/this._pixelsPerMercatorPixel,lt=[o,o,_];c.c5(lt,lt,ot),c.c5(rt,rt,-1),c.cW(rt,rt,lt);const ut=c.bC();c.br(ut,ut,rt),c.cS(ut,ut,lt),this.mercatorFogMatrix=ut,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,_,ot)}_computeCameraPosition(o){const _=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,rt=this._camera.forward(),ot=this.point,lt=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*_-o/this.worldSize*this._centerAltitude;return[ot.x/this.worldSize-rt[0]*lt,ot.y/this.worldSize-rt[1]*lt,o/this.worldSize*this._centerAltitude-rt[2]*lt]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const _=this._maxCameraBoundsDistance()*Math.cos(this._pitch),rt=this._camera.position[2],ot=o[2];let lt=1;this.projection.wrap&&(this.center=this.center.wrap()),ot>0&&(lt=Math.min((_-rt)/ot,1)),this._camera.position=c.bH([],this._camera.position,o,lt),this._updateStateFromCamera()}_updateStateFromCamera(){const o=this._camera.position,_=this._camera.forward(),{pitch:rt,bearing:ot}=this._camera.getPitchBearing(),lt=c.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,ut=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.an(this._maxPitch)),dt=Math.max((o[2]-lt)/Math.cos(rt),ut),mt=this._zoomFromMercatorZ(dt);c.bH(o,o,_,dt),this._pitch=c.aA(rt,c.an(this.minPitch),c.an(this.maxPitch)),this.angle=c.bT(ot,-Math.PI,Math.PI),this._setZoom(c.aA(mt,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.ae(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,o)*this.tileSize))}zoomFromMercatorZAdjusted(o){let _=0,rt=c.cL,ot=0,lt=1/0;for(;rt-_>1e-6&&rt>_;){const ut=_+.5*(rt-_),dt=this.tileSize*Math.pow(2,ut),mt=this.getCameraToCenterDistance(this.projection,ut,dt),Tt=this.scaleZoom(mt/(Math.max(0,o)*this.tileSize)),Ct=Math.abs(ut-Tt);Ct<lt&&(lt=Ct,ot=ut),ut<Tt?_=ut:rt=ut}return ot}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(o,_){const rt=Math.min(o.x,_.x),ot=Math.max(o.x,_.x),lt=Math.min(o.y,_.y),ut=Math.max(o.y,_.y);if(lt<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const dt=[new c.P(rt,lt),new c.P(ot,ut),new c.P(rt,ut),new c.P(ot,lt)],mt=this.renderWorldCopies?-3:0,Tt=this.renderWorldCopies?4:1;for(const Ct of dt){const Ut=this.pointRayIntersection(Ct);if(Ut.t<0)return!0;const Bt=this.rayIntersectionCoordinate(Ut);if(Bt.x<mt||Bt.y<0||Bt.x>Tt||Bt.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.P(0,0),new c.P(this.width,this.height))}zoomDeltaToMovement(o,_){const rt=c.ag(c.av([],this._camera.position,o)),ot=this._zoomFromMercatorZ(rt)+_;return rt-this._mercatorZfromZoom(ot)}getCameraPoint(){if(this.projection.name==="globe"){const o=function([_,rt,ot],lt){const ut=[_,rt,ot,1];c.aC(ut,ut,lt);const dt=ut[3]=Math.max(ut[3],1e-6);return ut[0]/=dt,ut[1]/=dt,ut[2]/=dt,ut}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.P(o[0],o[1])}{const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,o))}}getCameraToCenterDistance(o,_=this.zoom,rt=this.worldSize){const ot=c.cO(o,_,this.width,this.height,1024),lt=o.pixelSpaceConversion(this.center.lat,rt,ot);let ut=.5/Math.tan(.5*this._fov)*this.height*lt;return this.isOrthographic&&(ut=c.ak(1,ut,c.d0(this.pitch>=Rp?1:this.pitch/Rp))),ut}getWorldToCameraMatrix(){const o=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&c.aB(o,o,this.globeMatrix),o}getFrustum(o){return c.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,this.projection.zAxisUnit==="meters")}}const Cm=(et,o)=>{if(o>0&&et.terrain&&c.w("Cutoff is currently disabled on terrain"),o<=0||et.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const _=et.transform,rt=Math.max(Math.abs(_._zoom-(et.minCutoffZoom-1)),1),ot=_.isLODDisabled(!1)?c.ah(60,45,_.pitch):c.ah(30,15,_.pitch),lt=_._farZ-_._nearZ,ut=o*_.height,dt=((1-(mt=ot))*_.cameraToCenterDistance+mt*(_._farZ+ut))*rt;var mt;return{shouldRenderCutoff:ot<1,uniformValues:{u_cutoff_params:[_._nearZ,_._farZ,(dt-_._nearZ)/lt,(dt-ut-_._nearZ)/lt]}}},fp=2048;class _y{constructor(o,_){this.aabb=o,this.lastCascade=_}}class QE{add(o,_){const rt=this.receivers[o.key];rt!==void 0?(rt.aabb.min[0]=Math.min(rt.aabb.min[0],_.min[0]),rt.aabb.min[1]=Math.min(rt.aabb.min[1],_.min[1]),rt.aabb.min[2]=Math.min(rt.aabb.min[2],_.min[2]),rt.aabb.max[0]=Math.max(rt.aabb.max[0],_.max[0]),rt.aabb.max[1]=Math.max(rt.aabb.max[1],_.max[1]),rt.aabb.max[2]=Math.max(rt.aabb.max[2],_.max[2])):this.receivers[o.key]=new _y(_,null)}clear(){this.receivers={}}get(o){return this.receivers[o.key]}computeRequiredCascades(o,_,rt){const ot=c.d9.fromPoints(o.points);let lt=0;for(const ut in this.receivers){const dt=this.receivers[ut];if(!dt||!ot.intersectsAabb(dt.aabb))continue;dt.aabb.min=ot.closestPoint(dt.aabb.min),dt.aabb.max=ot.closestPoint(dt.aabb.max);const mt=dt.aabb.getCorners();for(let Tt=0;Tt<rt.length;Tt++){let Ct=!0;for(const Ut of mt){const Bt=[Ut[0]*_,Ut[1]*_,Ut[2]];if(c.af(Bt,Bt,rt[Tt].matrix),Bt[0]<-1||Bt[0]>1||Bt[1]<-1||Bt[1]>1){Ct=!1;break}}if(dt.lastCascade=Tt,lt=Math.max(lt,Tt),Ct)break}}return lt+1}}class Tx{constructor(o){this.painter=o,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new QE,this._depthMode=new tn(o.context.gl.LEQUAL,tn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const o of this._cascades)o.texture.destroy(),o.framebuffer.destroy();this._cascades=[]}updateShadowParameters(o,_){const rt=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!_||!_.properties)return;const ot=_.properties.get("shadow-intensity");if(!_.shadowsEnabled()||ot<=0||(this._shadowLayerCount=rt.style.order.reduce((Zt,qt)=>{const sr=rt.style._mergedLayers[qt];return Zt+(sr.hasShadowPass()&&!sr.isHidden(o.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const lt=rt.context,ut=fp,dt=fp;if(this._cascades.length===0||fp!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Zt=0;Zt<2;++Zt){const qt=rt._shadowMapDebug,sr=lt.gl,ir=lt.createFramebuffer(ut,dt,qt?1:0,"texture"),cr=new c.T(lt,{width:ut,height:dt,data:null},sr.DEPTH_COMPONENT16);if(ir.depthAttachment.set(cr.texture),qt){const pr=new c.T(lt,{width:ut,height:dt,data:null},sr.RGBA8);ir.colorAttachment0.set(pr.texture)}this._cascades.push({framebuffer:ir,texture:cr,matrix:[],far:0,boundingSphereRadius:0,frustum:new c.cB,scale:0})}}this.shadowDirection=by(_);let mt=0;if(o.elevation){const Zt=o.elevation,qt=[1e4,-1e4];Zt.visibleDemTiles.filter(sr=>sr.dem).forEach(sr=>{const ir=sr.dem.tree;qt[0]=Math.min(qt[0],ir.minimums[0]),qt[1]=Math.max(qt[1],ir.maximums[0])}),qt[0]!==1e4&&(mt=(qt[1]-qt[0])*Zt.exaggeration())}const Tt=1.5*o.cameraToCenterDistance,Ct=3*Tt,Ut=new Float64Array(16);for(let Zt=0;Zt<this._cascades.length;++Zt){const qt=this._cascades[Zt];let sr=o.height/50,ir=1;Zt===0?ir=Tt:(sr=Tt,ir=Ct);const[cr,pr]=Am(o,this.shadowDirection,sr,ir,fp,mt);qt.scale=o.scale,qt.matrix=cr,qt.boundingSphereRadius=pr,c.bl(Ut,qt.matrix),qt.frustum=c.cB.fromInvProjectionMatrix(Ut,1,0,!0),qt.far=ir}const Bt=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[Bt].far,this._cascades[Bt].far],this._uniformValues.u_shadow_intensity=ot,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=fp,this._uniformValues.u_shadowmap_0=hu.ShadowMap0,this._uniformValues.u_shadowmap_1=hu.ShadowMap0+1,this._groundShadowTiles=rt.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const $t=rt.transform.elevation;for(const Zt of this._groundShadowTiles){let qt={min:0,max:0};if($t){const sr=$t.getMinMaxForTile(Zt);sr&&(qt=sr)}this.addShadowReceiver(Zt.toUnwrapped(),qt.min,qt.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(o){this._enabled=o}drawShadowPass(o,_){if(!this.enabled)return;const rt=this.painter,ot=rt.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(rt.transform.getFrustum(0),rt.transform.worldSize,this._cascades),ot.viewport.set([0,0,fp,fp]);for(let lt=0;lt<this._numCascadesToRender;++lt){rt.currentShadowCascade=lt,ot.bindFramebuffer.set(this._cascades[lt].framebuffer.framebuffer),ot.clear({color:c.ao.white,depth:1});for(const ut of o.order){const dt=o._mergedLayers[ut];if(!dt.hasShadowPass()||dt.isHidden(rt.transform.zoom))continue;const mt=o.getLayerSourceCache(dt),Tt=mt?_[mt.id]:void 0;(dt.type==="model"||Tt&&Tt.length)&&rt.renderLayer(rt,mt,dt,Tt)}}rt.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const o=this.painter,_=o.style,rt=o.context,ot=rt.gl,lt=_.directionalLight,ut=_.ambientLight;if(!lt||!ut)return;const dt=[],mt=Cm(o,o.longestCutoffRange);mt.shouldRenderCutoff&&dt.push("RENDER_CUTOFF"),dt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&dt.push("NORMAL_OFFSET");const Tt=Jp(_,lt,ut),Ct=new tn(ot.LEQUAL,tn.ReadOnly,o.depthRangeFor3D),Ut=new gn({func:ot.EQUAL,mask:255},0,255,ot.KEEP,ot.KEEP,ot.KEEP);for(const Bt of this._groundShadowTiles){const $t=Bt.toUnwrapped(),Zt=o.isTileAffectedByFog(Bt),qt=o.getOrCreateProgram("groundShadow",{defines:dt,overrideFog:Zt});this.setupShadows($t,qt),o.uploadCommonUniforms(rt,qt,$t,null,mt);const sr={u_matrix:o.transform.calculateProjMatrix($t),u_ground_shadow_factor:Tt};qt.draw(o,ot.TRIANGLES,Ct,Ut,jn.multiply,mn.disabled,sr,"ground_shadow",o.tileExtentBuffer,o.quadTriangleIndexBuffer,o.tileExtentSegments,null,o.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?jn.unblended:jn.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(o){const _=this.painter.transform,rt=_.calculatePosMatrix(o,_.worldSize);return c.aB(rt,this._cascades[this.painter.currentShadowCascade].matrix,rt),Float32Array.from(rt)}calculateShadowPassMatrixFromMatrix(o){const _=c.bz(o);return c.aB(_,this._cascades[this.painter.currentShadowCascade].matrix,o),_}setupShadows(o,_,rt){if(!this.enabled)return;const ot=this.painter.transform,lt=this.painter.context,ut=lt.gl,dt=this._uniformValues,mt=new Float64Array(16),Tt=ot.calculatePosMatrix(o,ot.worldSize);for(let Ct=0;Ct<this._cascades.length;Ct++)c.aB(mt,this._cascades[Ct].matrix,Tt),dt[Ct===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(mt),lt.activeTexture.set(ut.TEXTURE0+hu.ShadowMap0+Ct),this._cascades[Ct].texture.bindExtraParam(ut.LINEAR,ut.LINEAR,ut.CLAMP_TO_EDGE,ut.CLAMP_TO_EDGE,ut.GREATER);if(this.useNormalOffset=!!rt,this.useNormalOffset){const Ct=c.d7(o.canonical),Ut=2/ot.tileSize*c.al/fp,Bt=Ut*this._cascades[0].boundingSphereRadius,$t=Ut*this._cascades[this._cascades.length-1].boundingSphereRadius,Zt=(rt==="vector-tile"?1:3)*function(qt,sr,ir,cr,pr){const ur=c.aA((qt-22)/-22,0,1);return .125*(1-ur)+4*ur}(ot.zoom);dt.u_shadow_normal_offset=[Ct,Bt*Zt,$t*Zt],dt.u_shadow_bias=[1e-4,.0012,.012]}else dt.u_shadow_bias=[36e-5,.0012,.012];_.setShadowUniformValues(lt,dt)}setupShadowsFromMatrix(o,_,rt=!1){if(!this.enabled)return;const ot=this.painter.context,lt=ot.gl,ut=this._uniformValues,dt=new Float64Array(16);for(let mt=0;mt<2;mt++)c.aB(dt,this._cascades[mt].matrix,o),ut[mt===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(dt),ot.activeTexture.set(lt.TEXTURE0+hu.ShadowMap0+mt),this._cascades[mt].texture.bindExtraParam(lt.LINEAR,lt.LINEAR,lt.CLAMP_TO_EDGE,lt.CLAMP_TO_EDGE,lt.GREATER);this.useNormalOffset=rt,rt?(ut.u_shadow_normal_offset=[1,3,3],ut.u_shadow_bias=[6e-5,.0012,.012]):ut.u_shadow_bias=[36e-5,.0012,.012],_.setShadowUniformValues(ot,ut)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(o,_,rt,ot){if(ot[2]>=0)return{};const lt=function(mt,Tt,Ct){const Ut=Ct/(1<<mt.canonical.z);return new c.d9([mt.canonical.x*Ut+mt.wrap*Ct,mt.canonical.y*Ut+mt.wrap*Ct,0],[(mt.canonical.x+1)*Ut+mt.wrap*Ct,(mt.canonical.y+1)*Ut+mt.wrap*Ct,Tt])}(o,_,rt).getCorners(),ut=_/-ot[2];ot[0]<0?(c.d8(lt[0],lt[0],[ot[0]*ut,0,0]),c.d8(lt[3],lt[3],[ot[0]*ut,0,0])):ot[0]>0&&(c.d8(lt[1],lt[1],[ot[0]*ut,0,0]),c.d8(lt[2],lt[2],[ot[0]*ut,0,0])),ot[1]<0?(c.d8(lt[0],lt[0],[0,ot[1]*ut,0]),c.d8(lt[1],lt[1],[0,ot[1]*ut,0])):ot[1]>0&&(c.d8(lt[2],lt[2],[0,ot[1]*ut,0]),c.d8(lt[3],lt[3],[0,ot[1]*ut,0]));const dt={};return dt.vertices=lt,dt.planes=[vy(lt[1],lt[0],lt[4]),vy(lt[2],lt[1],lt[5]),vy(lt[3],lt[2],lt[6]),vy(lt[0],lt[3],lt[7])],dt}addShadowReceiver(o,_,rt){this._receivers.add(o,c.d9.fromTileIdAndHeight(o,_,rt))}getMaxCascadeForTile(o){const _=this._receivers.get(o);return _&&_.lastCascade?_.lastCascade:0}}function vy(et,o,_){const rt=c.av([],_,o),ot=c.av([],et,o),lt=c.bI([],rt,ot),ut=c.ag(lt);return ut===0?[0,0,1,0]:(c.c5(lt,lt,1/ut),[lt[0],lt[1],lt[2],-c.bJ(lt,o)])}function by(et){const o=et.properties.get("direction"),_=c.d4(o.x,o.y,o.z);_[2]=c.aA(_[2],0,75);const rt=c.d6([_[0],_[1],_[2]]);return c.d5(rt.x,rt.y,rt.z)}function Jp(et,o,_){const rt=o.properties.get("color-use-theme")==="none",ot=o.properties.get("color"),lt=o.properties.get("intensity"),ut=o.properties.get("direction"),dt=[ut.x,ut.y,ut.z],mt=_.properties.get("color-use-theme")==="none",Tt=_.properties.get("color"),Ct=_.properties.get("intensity"),Ut=Math.max(c.bJ([0,0,1],dt),0),Bt=[0,0,0];c.c5(Bt,Tt.toPremultipliedRenderColor(mt?null:et.getLut(o.scope)).toArray01Linear().slice(0,3),Ct);const $t=[0,0,0];return c.c5($t,ot.toPremultipliedRenderColor(rt?null:et.getLut(_.scope)).toArray01Linear().slice(0,3),Ut*lt),c.db([Bt[0]>0?Bt[0]/(Bt[0]+$t[0]):0,Bt[1]>0?Bt[1]/(Bt[1]+$t[1]):0,Bt[2]>0?Bt[2]/(Bt[2]+$t[2]):0])}function Am(et,o,_,rt,ot,lt){const ut=et.zoom,dt=et.scale,mt=et.worldSize,Tt=1/mt,Ct=et.aspect,Ut=Math.sqrt(1+Ct*Ct)*Math.tan(.5*et.fovX),Bt=Ut*Ut,$t=rt-_,Zt=rt+_;let qt,sr;Bt>$t/Zt?(qt=rt,sr=rt*Ut):(qt=.5*Zt*(1+Bt),sr=.5*Math.sqrt($t*$t+2*(rt*rt+_*_)*Bt+Zt*Zt*Bt*Bt));const ir=et.projection.pixelsPerMeter(et.center.lat,mt),cr=et._camera.getCameraToWorldMercator(),pr=[0,0,-qt*Tt];c.af(pr,pr,cr);let ur=sr*Tt;const Cr=et._edgeInsets;if(!(Cr.left===0&&Cr.top===0&&Cr.right===0&&Cr.bottom===0||Cr.left===Cr.right&&Cr.top===Cr.bottom)){const gs=et._camera.getWorldToCamera(et.worldSize,et.projection.zAxisUnit==="meters"?ir:1),ks=et._camera.getCameraToClipPerspective(et._fov,et.width/et.height,_,rt);ks[8]=2*-et.centerOffset.x/et.width,ks[9]=2*et.centerOffset.y/et.height;const Bs=new Float64Array(16);c.cP(Bs,ks,gs);const js=new Float64Array(16);c.bl(js,Bs);const Ts=c.cB.fromInvProjectionMatrix(js,mt,ut,!0);for(const Js of Ts.points){const Ks=((wr=Js)[0]/=dt,wr[1]/=dt,wr[2]=c.cf(wr[2],et._center.lat),wr);ur=Math.max(ur,c.c6(c.da([],pr,Ks)))}}var wr;ur*=ot/(ot-1);const Tr=Math.acos(o[2]),br=Math.atan2(-o[0],-o[1]),yr=new E0;yr.position=pr,yr.setPitchBearing(Tr,br);const Pr=yr.getWorldToCamera(mt,ir),Or=ur*mt,Nr=Math.min(et._mercatorZfromZoom(17)*mt*-2,-2*Or),ts=yr.getCameraToClipOrthographic(-Or,Or,-Or,Or,Nr,(Or+lt*ir)/o[2]),rs=new Float64Array(16);c.aB(rs,ts,Pr);const cs=c.d5(Math.floor(1e6*pr[0])/1e6*mt,Math.floor(1e6*pr[1])/1e6*mt,0),Ss=.5*ot,Zr=[0,0,0];c.af(Zr,cs,rs),c.c5(Zr,Zr,Ss);const Fr=[Math.floor(Zr[0]),Math.floor(Zr[1]),Math.floor(Zr[2])],ns=[0,0,0];c.av(ns,Zr,Fr),c.c5(ns,ns,-1/Ss);const Qr=new Float64Array(16);return c.bA(Qr),c.br(Qr,Qr,ns),c.aB(rs,Qr,rs),[rs,Or]}class JE extends c.E{constructor(o){super(),this.requestManager=o,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(o,_){return c.dc(this.requestManager.transformRequest(_,c.R.Model).url).then(rt=>{if(!rt)return;const ot=c.dd(rt),lt=new c.de(o,_,void 0,void 0,ot);return lt.computeBoundsAndApplyParent(),lt}).catch(rt=>{if(rt&&rt.status===404)return null;this.fire(new c.y(new Error(`Could not load model ${o} from ${_}: ${rt.message}`)))})}load(o,_,rt={forceReload:!1}){this.models[_]||(this.models[_]={});const ot=Object.keys(o),lt=[],ut=[];for(const dt of ot){const mt=o[dt];this.hasURLBeenRequested(mt)&&!rt.forceReload||(this.modelByURL[mt]={modelId:dt,scope:_},lt.push(this.loadModel(dt,mt)),ut.push(dt)),this.models[_][dt]||(this.models[_][dt]={model:null,numReferences:1})}this.numModelsLoading[_]=(this.numModelsLoading[_]||0)+ut.length,Promise.allSettled(lt).then(dt=>{for(let mt=0;mt<dt.length;mt++){const{status:Tt}=dt[mt];if(Tt==="rejected")continue;const{value:Ct}=dt[mt];this.models[_][ut[mt]]||(this.models[_][ut[mt]]={model:null,numReferences:1}),this.models[_][ut[mt]].model=Ct}this.numModelsLoading[_]-=ut.length,this.fire(new c.z("data",{dataType:"style"}))}).catch(dt=>{this.fire(new c.y(new Error(`Could not load models: ${dt.message}`)))})}isLoaded(){for(const o in this.numModelsLoading)if(this.numModelsLoading[o]>0)return!1;return!0}hasModel(o,_,rt={exactIdMatch:!1}){return!!(rt.exactIdMatch?this.getModel(o,_):this.getModelByURL(this.modelUris[_][o]))}getModel(o,_){return this.models[_]||(this.models[_]={}),this.models[_][o]?this.models[_][o].model:void 0}getModelByURL(o){if(!o)return null;const _=this.modelByURL[o];return _?this.models[_.scope][_.modelId].model:null}hasModelBeenAdded(o,_){return this.models[_]&&this.models[_][o]!==void 0}getModelURIs(o){return this.modelUris[o]||{}}addModel(o,_,rt){this.models[rt]||(this.models[rt]={}),this.modelUris[rt]||(this.modelUris[rt]={});const ot=this.requestManager.normalizeModelURL(_);if((this.hasModel(o,rt,{exactIdMatch:!0})||this.hasModelBeenAdded(o,rt))&&this.modelUris[rt][o]===ot)this.models[rt][o].numReferences++;else if(this.hasURLBeenRequested(ot)){const{scope:lt,modelId:ut}=this.modelByURL[ot];this.models[lt][ut].numReferences++}else this.modelUris[rt][o]=ot,this.load({[o]:this.modelUris[rt][o]},rt)}addModelURLs(o,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const rt=this.modelUris[_];for(const ot in o)rt[ot]=this.requestManager.normalizeModelURL(o[ot])}reloadModels(o){this.load(this.modelUris[o],o,{forceReload:!0})}addModelsFromBucket(o,_){this.models[_]||(this.models[_]={}),this.modelUris[_]||(this.modelUris[_]={});const rt={};for(const ot of o)this.hasModel(ot,_,{exactIdMatch:!0})||this.hasURLBeenRequested(ot)?this.models[_][ot].numReferences++:this.modelUris[_][ot]&&!this.hasURLBeenRequested(ot)?rt[ot]=this.modelUris[_][ot]:!this.hasURLBeenRequested(ot)&&c.df(ot,!1)&&(this.modelUris[_][ot]=this.requestManager.normalizeModelURL(ot),rt[ot]=this.modelUris[_][ot]);this.load(rt,_)}hasURLBeenRequested(o){return this.modelByURL[o]!==void 0}removeModel(o,_,rt=!1,ot=!1){if(this.models[_]&&this.models[_][o]&&(this.models[_][o].numReferences--,this.models[_][o].numReferences===0||ot)){const lt=this.modelUris[_][o];rt||delete this.modelUris[_][o],delete this.modelByURL[lt];const ut=this.models[_][o].model;if(!ut)return;delete this.models[_][o],ut.destroy()}}destroy(){for(const o of Object.keys(this.models))for(const _ of Object.keys(this.models[o])){const rt=this.models[o][_].model;delete this.models[o][_],rt&&rt.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(o){return this.models[o]||(this.models[o]={}),Object.keys(this.models[o])}upload(o,_){this.models[_]||(this.models[_]={});for(const rt in this.models[_])this.models[_][rt].model&&this.models[_][rt].model.upload(o.context)}}const uv=c.a6.colorTheme,e2=new c.a9({data:new c.aa(uv.data)});function sw(et){if(!et.metadata||!et.metadata.content_area)return;const o=c.o.devicePixelRatio,{left:_,top:rt,width:ot,height:lt}=et.metadata.content_area,ut=_*o,dt=rt*o;return[ut,dt,ut+ot*o,dt+lt*o]}function nw(et){if(et)return et.map(([o,_])=>[o*c.o.devicePixelRatio,_*c.o.devicePixelRatio])}class hv{constructor(o,_,rt){this.id=o,this.scope=_,this.sourceCache=rt,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(o){this.missingRequests.has(o.name)||this.pendingRequests.has(o.name)||this.pendingRequests.add(o.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const o=new Map;if(!this.sourceCache.loaded())return o;const _=this.sourceCache.getVisibleCoordinates();if(_.length===0)return o;const rt=this.sourceCache.getSource();if(!(rt instanceof Cu))return o;const ot=_.map(ut=>this.sourceCache.getTile(ut)),lt=rt.getImages(ot,Array.from(this.pendingRequests));for(const[ut,dt]of lt)o.set(c.I.from({name:ut,iconsetId:this.id}),dt),this.pendingRequests.delete(ut);for(const ut of this.pendingRequests)this.missingRequests.add(ut);return this.pendingRequests.clear(),o}}const jm=(et,o)=>gr(et,o&&o.filter(_=>_.identifier!=="source.canvas")),ow=c.aH(so,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),aw=c.aH(so,["setCenter","setZoom","setBearing","setPitch"]),T0=new Set(["background","sky","slot","custom"]),Pm={version:8,layers:[],sources:{}},wy={duration:300,delay:0};class pp extends c.E{constructor(o,_={}){super(),this.map=o,this.scope=_.scope||"",this.globalId=null,this.fragments=[],this.importDepth=_.importDepth||0,this.importsCache=_.importsCache||new Map,this.resolvedImports=_.resolvedImports||new Set,this.transition=Object.assign({},wy),this._buildingIndex=new KE(this),this.crossTileSymbolIndex=new Tp,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=_.styleChanges||new Pn,this._hasDataDrivenEmissive=!1,this.dispatcher=_.dispatcher?_.dispatcher:new c.D(c.dh(),this),_.imageManager?this.imageManager=_.imageManager:(this.imageManager=new Ho(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=_.glyphManager?_.glyphManager:new c.di(o._requestManager,_.localFontFamily?c.dj.all:_.localIdeographFontFamily?c.dj.ideographs:c.dj.none,_.localFontFamily||_.localIdeographFontFamily),_.modelManager?this.modelManager=_.modelManager:(this.modelManager=new JE(o._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=_.configOptions?_.configOptions:new Map,this._configDependentLayers=_.configDependentLayers?_.configDependentLayers:new Set,this._indoorDependentLayers=_.indoorDependentLayers?_.indoorDependentLayers:new Set,this._config=_.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:_.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=_.initialConfig,this.dispatcher.broadcast("setReferrer",c.dk());const rt=this;this._rtlTextPluginCallback=pp.registerForPluginStateChange(ot=>{rt.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ot.pluginStatus,pluginURL:ot.pluginURL},(lt,ut)=>{if(c.dl(lt),ut&&ut.every(dt=>dt))for(const dt in rt._sourceCaches){const mt=rt._sourceCaches[dt],Tt=mt.getSource().type;Tt!=="vector"&&Tt!=="geojson"||mt.reload()}})}),this.on("data",ot=>{if(ot.dataType!=="source"||ot.sourceDataType!=="metadata")return;const lt=this.getOwnSource(ot.sourceId);if(lt&&lt.vectorLayerIds)for(const ut in this._layers){const dt=this._layers[ut];dt.source===lt.id&&this._validateLayer(dt)}})}load(o){return o?(typeof o=="string"?this.loadURL(o):this.loadJSON(o),this):this}_getGlobalId(o){if(!o)return null;if(typeof o=="string"){if(c.h(o))return o;const _=c.dm(o);if(!_.startsWith("http"))try{return new URL(_,location.href).toString()}catch{return _}return _}return`json://${c.dn(JSON.stringify(o))}`}_diffStyle(o,_,rt){this.globalId=this._getGlobalId(o);const ot=(lt,ut)=>{try{ut(null,this.setState(lt,rt))}catch(dt){ut(dt,!1)}};if(typeof o=="string"){const lt=this.map._requestManager.normalizeStyleURL(o),ut=this.map._requestManager.transformRequest(lt,c.R.Style);c.m(ut,(dt,mt)=>{dt?this.fire(new c.y(dt)):mt&&ot(mt,_)})}else typeof o=="object"&&ot(o,_)}loadURL(o,_={}){this.fire(new c.z("dataloading",{dataType:"style"}));const rt=typeof _.validate=="boolean"?_.validate:!c.h(o);this.globalId=this._getGlobalId(o),o=this.map._requestManager.normalizeStyleURL(o,_.accessToken),this.resolvedImports.add(o);const ot=this.importsCache.get(o);if(ot)return this._load(ot,rt);const lt=this.map._requestManager.transformRequest(o,c.R.Style);this._request=c.m(lt,(ut,dt)=>{if(this._request=null,ut)this.fire(new c.y(ut));else if(dt)return this.importsCache.set(o,dt),this._load(dt,rt)})}loadJSON(o,_={}){this.fire(new c.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(o),this._request=c.o.frame(()=>{this._request=null,this._load(o,_.validate!==!1)})}loadEmpty(){this.fire(new c.z("dataloading",{dataType:"style"})),this._load(Pm,!1)}_loadImports(o,_,rt){if(this.importDepth>=4)return c.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const ot=[];for(const lt of o){const ut=this._createFragmentStyle(lt),dt=new Promise(Ct=>{ut.once("style.import.load",Ct),ut.once("error",Ct)}).then(()=>this.mergeAll());if(ot.push(dt),this.resolvedImports.has(lt.url)){ut.loadEmpty();continue}const mt=lt.data||this.importsCache.get(lt.url);mt?(ut.loadJSON(mt,{validate:_}),this._isInternalStyle(mt)&&(ut.globalId=null)):lt.url?ut.loadURL(lt.url,{validate:_}):ut.loadEmpty();const Tt={style:ut,id:lt.id,config:lt.config};if(rt){const Ct=this.fragments.findIndex(({id:Ut})=>Ut===rt);this.fragments=this.fragments.slice(0,Ct).concat(Tt).concat(this.fragments.slice(Ct))}else this.fragments.push(Tt)}return Promise.allSettled(ot)}getImportGlobalIds(o=this,_=new Set){for(const rt of o.fragments)rt.style.globalId&&_.add(rt.style.globalId),this.getImportGlobalIds(rt.style,_);return[..._.values()]}_createFragmentStyle(o){const _=this.scope?c.B(o.id,this.scope):o.id;let rt;const ot=this._initialConfig&&this._initialConfig[_];(o.config||ot)&&(rt=Object.assign({},o.config,ot));const lt=new pp(this.map,{scope:_,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:rt,configOptions:this.options,colorThemeOverride:o["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return lt.setEventedParent(this.map,{style:lt}),lt}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(o){return this.isRootStyle()&&(o.fragment||!!o.schema&&o.fragment!==!1)}_load(o,_){if(this._isInternalStyle(o)){const lt=Object.assign({},Pm,{imports:[{id:"basemap",data:o,url:""}]},o.center?{center:o.center}:{},o.bearing?{bearing:o.bearing}:{},o.pitch?{pitch:o.pitch}:{},o.zoom?{zoom:o.zoom}:{},o.light?{light:o.light}:{});return this._importedAsBasemap=!0,void this._load(lt,_)}if(this.updateConfig(this._config,o.schema),_&&jm(this,Lo(o)))return;this._loaded=!0,this.stylesheet=c.dp(o);const rt=()=>{for(const mt in o.sources)this.addSource(mt,o.sources[mt],{validate:!1,isInitialLoad:!0});if(o.iconsets)for(const mt in o.iconsets)this.addIconset(mt,o.iconsets[mt]);o.sprite?this._loadIconset(o.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&o.glyphs&&this.glyphManager.setURL(o.glyphs);const lt=uy(this.stylesheet.layers);if(this._order=lt.map(mt=>mt.id),this.stylesheet.light&&c.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const mt=this.stylesheet.lights[0];this.light=new zr(mt.properties,mt.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new zr(this.stylesheet.light)),this._layers={};for(const mt of lt){const Tt=c.du(mt,this.scope,this._styleColorTheme.lut,this.options);Tt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(Tt.fqid),Tt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(Tt.fqid),this._hasAppearances=this._hasAppearances||Tt.getAppearances().length!==0,Tt.setEventedParent(this,{layer:{id:Tt.id}}),this._layers[Tt.id]=Tt;const Ct=this.getOwnLayerSourceCache(Tt),Ut=!!this.directionalLight&&this.directionalLight.shadowsEnabled();Ct&&Tt.canCastShadows()&&Ut&&(Ct.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const ut=this.stylesheet.terrain;ut&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(ut,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new c.z("data",{dataType:"style"}));const dt=this.isRootStyle();o.imports?this._loadImports(o.imports,_).then(()=>{this._reloadImports(),this.fire(new c.z(dt?"style.load":"style.import.load"))}).catch(mt=>{this.fire(new c.y(new Error("Failed to load imports",mt))),this.fire(new c.z(dt?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new c.z(dt?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const ot=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(ot){const lt=this._evaluateColorThemeData(ot);this._loadColorTheme(lt).then(()=>{rt()}).catch(ut=>{c.w(`Couldn't load color theme from the stylesheet: ${ut}`),rt()})}else this._styleColorTheme.lut=null,rt()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(o=>o.style.hasAppearances())}mergeAll(){let o,_,rt,ot,lt,ut,dt,mt,Tt,Ct;const Ut={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(Bt=>{if(Bt.stylesheet){if(Bt.light!=null&&(o=Bt.light),Bt.stylesheet.lights)for(const $t of Bt.stylesheet.lights)$t.type==="ambient"&&Bt.ambientLight!=null&&(_=Bt.ambientLight),$t.type==="directional"&&Bt.directionalLight!=null&&(rt=Bt.directionalLight);ot=this._prioritizeTerrain(ot,Bt.terrain,Bt.stylesheet.terrain),Bt.stylesheet.fog&&Bt.fog!=null&&(lt=Bt.fog),Bt.stylesheet.snow&&Bt.snow!=null&&(ut=Bt.snow),Bt.stylesheet.rain&&Bt.rain!=null&&(dt=Bt.rain),Bt.stylesheet.camera!=null&&(Ct=Bt.stylesheet.camera),Bt.stylesheet.projection!=null&&(mt=Bt.stylesheet.projection),Bt.stylesheet.transition!=null&&(Tt=Bt.stylesheet.transition),Ut[Bt.scope]=Bt._styleColorTheme}}),this.light=o,this.ambientLight=_,this.directionalLight=rt,this.fog=lt,this.snow=ut,this.rain=dt,this._styleColorThemeForScope=Ut,ot===null?delete this.terrain:this.terrain=ot,this.camera=Ct||{"camera-projection":"perspective"},this.projection=mt||{name:"mercator"},this.transition=Object.assign({},wy,Tt),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(o){const _=rt=>{for(const ot of rt.fragments)_(ot.style);o(rt)};_(this)}_prioritizeTerrain(o,_,rt){const ot=o&&o.drapeRenderMode===0;return rt===null?_&&_.drapeRenderMode===0?_:ot?o:null:_!=null&&(!o||ot||_&&_.drapeRenderMode===1)?_:o}mergeTerrain(){let o;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(_=>{o=this._prioritizeTerrain(o,_.terrain,_.stylesheet.terrain)}),o===null?delete this.terrain:this.terrain=o}mergeProjection(){let o;this.forEachFragmentStyle(_=>{_.stylesheet.projection!=null&&(o=_.stylesheet.projection)}),this.projection=o||{name:"mercator"}}mergeSources(){const o={},_={},rt={};this.forEachFragmentStyle(ot=>{for(const lt in ot._sourceCaches){const ut=c.B(lt,ot.scope);o[ut]=ot._sourceCaches[lt]}for(const lt in ot._otherSourceCaches){const ut=c.B(lt,ot.scope);_[ut]=ot._otherSourceCaches[lt]}for(const lt in ot._symbolSourceCaches){const ut=c.B(lt,ot.scope);rt[ut]=ot._symbolSourceCaches[lt]}}),this._mergedSourceCaches=o,this._mergedOtherSourceCaches=_,this._mergedSymbolSourceCaches=rt}mergeIndoor(){this.forEachFragmentStyle(o=>{if(o.stylesheet&&o.stylesheet.indoor)for(const _ of Object.values(o.stylesheet.indoor)){const rt=_,ot=c.B(rt.sourceId,o.scope);this._mergedIndoor[ot]=new Set(rt.sourceLayers||[])}})}mergeLayers(){const o={},_=[],rt={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(ut=>{for(const dt of ut._order){const mt=ut._layers[dt];if(mt.type==="slot"){const Tt=c.dq(dt);if(o[Tt])continue;o[Tt]=[]}mt.slot&&o[mt.slot]?o[mt.slot].push(mt):_.push(mt)}}),this._mergedOrder=[];let ot=-1;const lt=(ut=[])=>{for(const dt of ut)if(dt.type==="slot"){const mt=c.dq(dt.id);o[mt]&&lt(o[mt]),this._mergedSlots.push(mt)}else{const mt=c.B(dt.id,dt.scope);this._mergedOrder.push(mt),rt[mt]=dt,dt.is3D(!!this.terrain)&&(this._has3DLayers=!0,ot=this._mergedOrder.length-1),dt.type==="circle"&&(this._hasCircleLayers=!0),dt.type==="symbol"&&(this._hasSymbolLayers=!0),dt.type==="clip"&&(this._clipLayerPresent=!0)}};if(lt(_),this._has3DLayers){const ut={};for(let dt=0;dt<this._mergedOrder.length;++dt){const mt=this._mergedOrder[dt];ut[mt]=dt===ot?1:dt<ot?rt[mt].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((dt,mt)=>ut[dt]-ut[mt])}this._mergedLayers=rt,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(o){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,o),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(o){return o.data?function(_,rt,ot,lt){const ut=Object.assign({},rt);for(const mt of Object.keys(uv))ut[mt]===void 0&&(ut[mt]=uv[mt].default);const dt=new c.a8(e2,_,new Map(ot));return dt.setTransitionOrValue(ut,ot),dt.untransitioned().possiblyEvaluate(new c.ac(0,{worldview:void 0}))}(this.scope,o,this.options).get("data"):null}_loadColorTheme(o){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const _=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((rt,ot)=>{const lt="data:image/png;base64,";if(!o||o.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void rt();let ut=o;ut.startsWith(lt)||(ut=lt+ut);const dt=c.I.from("mapbox-reserved-lut"),mt=new Image;mt.src=ut,mt.onerror=()=>{this._styleColorTheme.lutLoading=!1,ot(new Error("Failed to load image data"))},mt.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==_)return void rt();this._styleColorTheme.lutLoading=!1;const{width:Tt,height:Ct,data:Ut}=c.o.getImageData(mt);if(Ct>32)return void ot(new Error("The height of the image must be less than or equal to 32 pixels."));if(Tt!==Ct*Ct)return void ot(new Error("The width of the image must be equal to the height squared."));this.getImage(dt)&&this.removeImage(dt),this.addImage(dt,{data:new c.q({width:Tt,height:Ct},Ut),pixelRatio:1,sdf:!1,usvg:!1,version:0});const Bt=this.imageManager.getImage(dt,this.scope);Bt?(this._styleColorTheme.lut={image:Bt.data,data:o},rt()):ot(new Error("Missing LUT image."))}})}getLut(o){const _=this._styleColorThemeForScope[o];return _?_.lut:null}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(o){this._spriteRequest=function(_,rt,ot){let lt,ut,dt;const mt=c.o.devicePixelRatio>1?"@2x":"";let Tt=c.m(rt.transformRequest(rt.normalizeSpriteURL(_,mt,".json"),c.R.SpriteJSON),(Bt,$t)=>{Tt=null,dt||(dt=Bt,lt=$t,Ut())}),Ct=c.n(rt.transformRequest(rt.normalizeSpriteURL(_,mt,".png"),c.R.SpriteImage),(Bt,$t)=>{Ct=null,dt||(dt=Bt,ut=$t,Ut())});function Ut(){if(dt)ot(dt);else if(lt&&ut){const Bt=c.o.getImageData(ut),$t={};for(const Zt in lt){const{width:qt,height:sr,x:ir,y:cr,sdf:pr,pixelRatio:ur,stretchX:Cr,stretchY:wr,content:Tr}=lt[Zt],br=new c.q({width:qt,height:sr});c.q.copy(Bt,br,{x:ir,y:cr},{x:0,y:0},{width:qt,height:sr},null),$t[Zt]={data:br,pixelRatio:ur!==void 0?ur:1,sdf:pr!==void 0&&pr,stretchX:Cr,stretchY:wr,content:Tr,usvg:!1,version:0}}ot(null,$t)}}return{cancel(){Tt&&(Tt.cancel(),Tt=null),Ct&&(Ct.cancel(),Ct=null)}}}(o,this.map._requestManager,(_,rt)=>{if(this._spriteRequest=null,_)this.fire(new c.y(_));else if(rt){const ot=new Map;for(const lt in rt)ot.set(c.I.from(lt),rt[lt]);this.addImages(ot)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))})}addIconset(o,_){if(_.type==="sprite")return void this._loadSprite(_.url);const rt=this.getOwnSourceCache(_.source);if(!rt)return void this.fire(new c.y(new Error(`Source "${_.source}" as specified by iconset "${o}" does not exist and cannot be used as an iconset source`)));const ot=rt.getSource();if(ot.type!=="raster-array")return void this.fire(new c.y(new Error(`Source "${_.source}" as specified by iconset "${o}" is not a "raster-array" source and cannot be used as an iconset source`)));ot.partial=!1;const lt=new hv(o,this.scope,rt);this.imageManager.addImageProvider(lt,this.scope)}removeIconset(o){this.imageManager.removeImageProvider(o,this.scope)}_loadIconset(o){if(!c.h(o)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(o);const _=this.map._spriteFormat==="auto";var rt,ot;this._spriteRequest=(ot=(lt,ut)=>{if(this._spriteRequest=null,lt)_?this._loadSprite(o):this.fire(new c.y(lt));else if(ut){const dt=new Map;for(const mt in ut)dt.set(c.I.from(mt),ut[mt]);this.addImages(dt)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new c.z("data",{dataType:"style"}))},c.bu((rt=this.map._requestManager).transformRequest(rt.normalizeIconsetURL(o),c.R.Iconset),(lt,ut)=>{if(lt)return void ot(lt);const dt={},mt=c.dg(new c.bt(ut));for(const Tt of mt.icons){const Ct={version:1,pixelRatio:c.o.devicePixelRatio,content:sw(Tt),stretchX:Tt.metadata?nw(Tt.metadata.stretch_x_areas):void 0,stretchY:Tt.metadata?nw(Tt.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:Tt};dt[Tt.name]=Ct}ot(null,dt)}))}_validateLayer(o){const _=this.getOwnSource(o.source);if(!_)return;const rt=o.sourceLayer;rt&&(_.type==="geojson"||_.vectorLayerIds&&_.vectorLayerIds.indexOf(rt)===-1)&&this.fire(new c.y(new Error(`Source layer "${rt}" does not exist on source "${_.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:o}of this.fragments)if(!o.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((o,_)=>{const rt=this.fragments[_];return rt&&rt.style&&(o.data=rt.style.serialize()),o})}_serializeSources(){const o={};for(const _ in this._sourceCaches){const rt=this._sourceCaches[_].getSource();o[rt.id]||(o[rt.id]=rt.serialize())}return o}_serializeLayers(o){const _=[];for(const rt of o){const ot=this._layers[rt];ot&&ot.type!=="custom"&&_.push(ot.serialize())}return _}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const o in this._mergedLayers){const _=this._mergedLayers[o];if(_._transitionablePaint&&_._transitionablePaint._values){const rt=_._transitionablePaint._values["line-emissive-strength"];if(rt&&rt.value&&rt.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(o){return o?this.order:this._mergedOrder}isLayerDraped(o){return!!this.terrain&&o.isDraped(this.getLayerSourceCache(o))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(o){const _=this.getOwnLayer(o);if(_)return _;this.fire(new c.y(new Error(`The layer '${o}' does not exist in the map's style.`)))}_checkSource(o){const _=this.getOwnSource(o);if(_)return _;this.fire(new c.y(new Error(`The source '${o}' does not exist in the map's style.`)))}precompilePrograms(o,_){const rt=this.map.painter;if(rt)for(let ot=o.minzoom||0;ot<(o.maxzoom||25.5);ot++){const lt=o.getProgramIds();if(lt)for(const ut of lt){const dt=o.getDefaultProgramParams(ut,_.zoom,this._styleColorTheme.lut);dt&&(rt.style=this,this.fog&&(rt._fogVisible=!0,dt.overrideFog=!0,rt.getOrCreateProgram(ut,dt)),rt._fogVisible=!1,dt.overrideFog=!1,rt.getOrCreateProgram(ut,dt),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(dt.overrideRtt=!0,rt.getOrCreateProgram(ut,dt)))}}}update(o){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(o),this.directionalLight&&this.directionalLight.recalculate(o);const _=this.calculateLightsBrightness();o.brightness=_||0,_!==this._brightness&&(this._brightness=_,this.dispatcher.broadcast("setBrightness",_)),o.worldview!==this._worldview&&(this._worldview=o.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const rt=this._changes.isDirty();let ot=!1;if(this._changes.isDirty()){const dt=this._changes.getLayerUpdatesByScope();for(const mt in dt){const{updatedIds:Tt,removedIds:Ct}=dt[mt];(Tt||Ct)&&(this._updateWorkerLayers(mt,Tt,Ct),ot=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(o),this.light&&this.light.updateTransitions(o),this.ambientLight&&this.ambientLight.updateTransitions(o),this.directionalLight&&this.directionalLight.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this.snow&&this.snow.updateTransitions(o),this.rain&&this.rain.updateTransitions(o),this._changes.reset()}const lt={};for(const dt in this._mergedSourceCaches){const mt=this._mergedSourceCaches[dt];lt[dt]=mt.used,mt.used=!1,mt.tileCoverLift=0}for(const dt of this._mergedOrder){const mt=this._mergedLayers[dt];if(mt.visibility!=="none"&&mt.recalculate(o,this._availableImages),!mt.isHidden(o.zoom)){const Tt=this.getLayerSourceCache(mt);Tt&&(Tt.used=!0,Tt.tileCoverLift=Math.max(Tt.tileCoverLift,mt.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(mt,o)}):this.precompilePrograms(mt,o))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&ot&&this.mergeLayers();const ut=this.imageManager.getPendingImageProviders();for(const dt of ut)dt.sourceCache.used=!0;for(const dt in lt){const mt=this._mergedSourceCaches[dt];lt[dt]!==mt.used&&mt.getSource().fire(new c.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:mt.getSource().id}))}this.light&&this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.snow&&this.snow.recalculate(o),this.rain&&this.rain.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),rt&&this.fire(new c.z("data",{dataType:"style"}))}updateImageProviders(){const o=this.imageManager.getPendingImageProviders();for(const _ of o){const rt=_.resolvePendingRequests(),ot=this.getFragmentStyle(_.scope);ot&&ot.addImages(rt)}}_updateTilesForChangedImages(){const o={};for(const _ in this._mergedSourceCaches){const rt=this._mergedSourceCaches[_].getSource().scope;o[rt]=o[rt]||this._changes.getUpdatedImages(rt),o[rt].length!==0&&this._mergedSourceCaches[_].reloadTilesForDependencies(["icons","patterns"],o[rt])}for(const _ in o)this._changes.resetUpdatedImages(_)}_updateWorkerLayers(o,_,rt){const ot=this.getFragmentStyle(o);ot&&this.dispatcher.broadcast("updateLayers",{layers:_?ot._serializeLayers(_):[],scope:o,removedIds:rt||[],options:ot.options})}setState(o,_){if(this._checkLoaded(),jm(this,Lo(o)))return!1;(o=c.dp(o)).layers=uy(o.layers);const rt=function(ut,dt){if(!ut)return[{command:so.setStyle,args:[dt]}];let mt=[];try{if(!c.by(ut.version,dt.version))return[{command:so.setStyle,args:[dt]}];if(c.by(ut.center,dt.center)||mt.push({command:so.setCenter,args:[dt.center]}),c.by(ut.zoom,dt.zoom)||mt.push({command:so.setZoom,args:[dt.zoom]}),c.by(ut.bearing,dt.bearing)||mt.push({command:so.setBearing,args:[dt.bearing]}),c.by(ut.pitch,dt.pitch)||mt.push({command:so.setPitch,args:[dt.pitch]}),c.by(ut.sprite,dt.sprite)||mt.push({command:so.setSprite,args:[dt.sprite]}),c.by(ut.glyphs,dt.glyphs)||mt.push({command:so.setGlyphs,args:[dt.glyphs]}),c.by(ut.imports,dt.imports)||function($t=[],Zt=[],qt){Zt=Zt||[];const sr=($t=$t||[]).map(hy),ir=Zt.map(hy),cr=$t.reduce(dy,{}),pr=Zt.reduce(dy,{}),ur=sr.slice();let Cr,wr,Tr,br;for(Cr=0,wr=0;Cr<sr.length;Cr++)Tr=sr[Cr],pr.hasOwnProperty(Tr)?wr++:(qt.push({command:so.removeImport,args:[Tr]}),ur.splice(ur.indexOf(Tr,wr),1));for(Cr=0,wr=0;Cr<ir.length;Cr++)Tr=ir[ir.length-1-Cr],ur[ur.length-1-Cr]!==Tr&&(cr.hasOwnProperty(Tr)?(qt.push({command:so.removeImport,args:[Tr]}),ur.splice(ur.lastIndexOf(Tr,ur.length-wr),1)):wr++,br=ur[ur.length-Cr],qt.push({command:so.addImport,args:[pr[Tr],br]}),ur.splice(ur.length-Cr,0,Tr));for(const yr of Zt){const Pr=cr[yr.id];Pr&&(delete Pr.data,c.by(Pr,yr)||qt.push({command:so.updateImport,args:[yr.id,yr]}))}}(ut.imports,dt.imports,mt),c.by(ut.transition,dt.transition)||mt.push({command:so.setTransition,args:[dt.transition]}),c.by(ut.light,dt.light)||mt.push({command:so.setLight,args:[dt.light]}),c.by(ut.fog,dt.fog)||mt.push({command:so.setFog,args:[dt.fog]}),c.by(ut.snow,dt.snow)||mt.push({command:so.setSnow,args:[dt.snow]}),c.by(ut.rain,dt.rain)||mt.push({command:so.setRain,args:[dt.rain]}),c.by(ut.projection,dt.projection)||mt.push({command:so.setProjection,args:[dt.projection]}),c.by(ut.lights,dt.lights)||mt.push({command:so.setLights,args:[dt.lights]}),c.by(ut.camera,dt.camera)||mt.push({command:so.setCamera,args:[dt.camera]}),c.by(ut.iconsets,dt.iconsets)||function($t,Zt,qt){let sr;for(sr in Zt=Zt||{},$t=$t||{})$t.hasOwnProperty(sr)&&(Zt.hasOwnProperty(sr)||qt.push({command:so.removeIconset,args:[sr]}));for(sr in Zt){if(!Zt.hasOwnProperty(sr))continue;const ir=Zt[sr];$t.hasOwnProperty(sr)?c.by($t[sr],ir)||(qt.push({command:so.removeIconset,args:[sr]}),qt.push({command:so.addIconset,args:[sr,ir]})):qt.push({command:so.addIconset,args:[sr,ir]})}}(ut.iconsets,dt.iconsets,mt),!c.by(ut["color-theme"],dt["color-theme"]))return[{command:so.setStyle,args:[dt]}];const Tt={},Ct=[];(function($t,Zt,qt,sr){let ir;for(ir in Zt=Zt||{},$t=$t||{})$t.hasOwnProperty(ir)&&(Zt.hasOwnProperty(ir)||tv(ir,qt,sr));for(ir in Zt){if(!Zt.hasOwnProperty(ir))continue;const cr=Zt[ir];$t.hasOwnProperty(ir)?c.by($t[ir],cr)||($t[ir].type==="geojson"&&cr.type==="geojson"&&ew($t,Zt,ir)?qt.push({command:so.setGeoJSONSourceData,args:[ir,cr.data]}):_b(ir,Zt,qt,sr)):p0(ir,Zt,qt)}})(ut.sources,dt.sources,Ct,Tt);const Ut=[];ut.layers&&ut.layers.forEach($t=>{$t.source&&Tt[$t.source]?mt.push({command:so.removeLayer,args:[$t.id]}):Ut.push($t)});let Bt=ut.terrain;Bt&&Tt[Bt.source]&&(mt.push({command:so.setTerrain,args:[void 0]}),Bt=void 0),mt=mt.concat(Ct),c.by(Bt,dt.terrain)||mt.push({command:so.setTerrain,args:[dt.terrain]}),function($t,Zt,qt){Zt=Zt||[];const sr=($t=$t||[]).map(hy),ir=Zt.map(hy),cr=$t.reduce(dy,{}),pr=Zt.reduce(dy,{}),ur=sr.slice(),Cr=Object.create(null);let wr,Tr,br,yr,Pr,Or,Nr;for(wr=0,Tr=0;wr<sr.length;wr++)br=sr[wr],pr.hasOwnProperty(br)?Tr++:(qt.push({command:so.removeLayer,args:[br]}),ur.splice(ur.indexOf(br,Tr),1));for(wr=0,Tr=0;wr<ir.length;wr++)br=ir[ir.length-1-wr],ur[ur.length-1-wr]!==br&&(cr.hasOwnProperty(br)?(qt.push({command:so.removeLayer,args:[br]}),ur.splice(ur.lastIndexOf(br,ur.length-Tr),1)):Tr++,Or=ur[ur.length-wr],qt.push({command:so.addLayer,args:[pr[br],Or]}),ur.splice(ur.length-wr,0,br),Cr[br]=!0);for(wr=0;wr<ir.length;wr++)if(br=ir[wr],yr=cr[br],Pr=pr[br],!Cr[br]&&!c.by(yr,Pr))if(c.by(yr.source,Pr.source)&&c.by(yr["source-layer"],Pr["source-layer"])&&c.by(yr.type,Pr.type)){for(Nr in Sm(yr.layout,Pr.layout,qt,br,null,so.setLayoutProperty),Sm(yr.paint,Pr.paint,qt,br,null,so.setPaintProperty),c.by(yr.slot,Pr.slot)||qt.push({command:so.setSlot,args:[br,Pr.slot]}),c.by(yr.filter,Pr.filter)||qt.push({command:so.setFilter,args:[br,Pr.filter]}),c.by(yr.minzoom,Pr.minzoom)&&c.by(yr.maxzoom,Pr.maxzoom)||qt.push({command:so.setLayerZoomRange,args:[br,Pr.minzoom,Pr.maxzoom]}),yr)yr.hasOwnProperty(Nr)&&Nr!=="layout"&&Nr!=="paint"&&Nr!=="filter"&&Nr!=="metadata"&&Nr!=="minzoom"&&Nr!=="maxzoom"&&Nr!=="slot"&&(Nr.indexOf("paint.")===0?Sm(yr[Nr],Pr[Nr],qt,br,Nr.slice(6),so.setPaintProperty):c.by(yr[Nr],Pr[Nr])||qt.push({command:so.setLayerProperty,args:[br,Nr,Pr[Nr]]}));for(Nr in Pr)Pr.hasOwnProperty(Nr)&&!yr.hasOwnProperty(Nr)&&Nr!=="layout"&&Nr!=="paint"&&Nr!=="filter"&&Nr!=="metadata"&&Nr!=="minzoom"&&Nr!=="maxzoom"&&Nr!=="slot"&&(Nr.indexOf("paint.")===0?Sm(yr[Nr],Pr[Nr],qt,br,Nr.slice(6),so.setPaintProperty):c.by(yr[Nr],Pr[Nr])||qt.push({command:so.setLayerProperty,args:[br,Nr,Pr[Nr]]}))}else qt.push({command:so.removeLayer,args:[br]}),Or=ur[ur.lastIndexOf(br)+1],qt.push({command:so.addLayer,args:[Pr,Or]})}(Ut,dt.layers,mt)}catch(Tt){console.warn("Unable to compute style diff:",Tt),mt=[{command:so.setStyle,args:[dt]}]}return mt}(this.serialize(),o).filter(ut=>!(ut.command in aw));if(rt.length===0)return!1;const ot=rt.filter(ut=>!(ut.command in ow));if(ot.length>0)throw new Error(`Unimplemented: ${ot.map(ut=>ut.command).join(", ")}.`);const lt=[];return rt.forEach(ut=>{lt.push(this[ut.command](...ut.args))}),_&&Promise.all(lt).then(_).catch(_),this.stylesheet=o,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(o){if(o.size===0)return this;for(const[_,rt]of o.entries()){if(this.getImage(_))return this.fire(new c.y(new Error(`An image with the name "${_.name}" already exists.`)));this.imageManager.addImage(_,this.scope,rt),this._changes.updateImage(_,this.scope)}return this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this}addImage(o,_){return this.getImage(o)?this.fire(new c.y(new Error(`An image with the name "${o.name}" already exists.`))):(this.imageManager.addImage(o,this.scope,_),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this)}updateImage(o,_,rt=!1){this.imageManager.updateImage(o,this.scope,_),rt&&(this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})))}getImage(o){return this.imageManager.getImage(o,this.scope)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o,this.scope),this._changes.updateImage(o,this.scope),this._updateWorkerImages(),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(o){return this.modelManager.addModelURLs(o,this.getActualScope()),this._updateWorkerModels(),this.fire(new c.z("data",{dataType:"style"})),this}addModel(o,_,rt={}){return this._checkLoaded(),this._validate(Qt,`models.${o}`,_,null,rt)||(this.modelManager.addModel(o,_,this.getActualScope()),this.fire(new c.z("data",{dataType:"style"}))),this}hasModel(o){return this.modelManager.hasModel(o,this.getActualScope())}removeModel(o){return this.hasModel(o)?(this.modelManager.removeModel(o,this.getActualScope(),!1,!0),this.fire(new c.z("data",{dataType:"style"})),this):this.fire(new c.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(o,_,rt={}){if(this._checkLoaded(),this.getOwnSource(o)!==void 0)throw new Error(`There is already a source with ID "${o}".`);if(!_.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(_).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(_.type)>=0&&this._validate(lu,`sources.${o}`,_,null,rt))return;this.map&&this.map._collectResourceTiming&&(_.collectResourceTiming=!0);const ot=ru(o,_,this.dispatcher,this);ot.scope=this.scope,ot.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(ot.id),source:ot.serialize(),sourceId:ot.id}));const lt=ut=>{const dt=(ut?"symbol:":"other:")+ot.id,mt=c.B(dt,this.scope),Tt=this._sourceCaches[dt]=new Xu(mt,ot,ut);(ut?this._symbolSourceCaches:this._otherSourceCaches)[ot.id]=Tt,Tt.onAdd(this.map)};lt(!1),_.type!=="vector"&&_.type!=="geojson"||lt(!0),ot.onAdd&&ot.onAdd(this.map),rt.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(o){this._checkLoaded();const _=this.getOwnSource(o);if(!_)throw new Error("There is no source with this ID");for(const ot in this._layers)if(this._layers[ot].source===o)return this.fire(new c.y(new Error(`Source "${o}" cannot be removed while layer "${ot}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===o)return this.fire(new c.y(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const ot=Object.entries(this.stylesheet.iconsets).find(([lt,ut])=>ut.type==="source"&&ut.source===o);if(ot)return this.fire(new c.y(new Error(`Source "${o}" cannot be removed while iconset "${ot[0]}" is using it.`)))}const rt=this.getOwnSourceCaches(o);for(const ot of rt){const lt=c.dq(ot.id);delete this._sourceCaches[lt],this._changes.discardSourceCacheUpdate(ot.id),ot.fire(new c.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:ot.getSource().id})),ot.setEventedParent(null),ot.clearTiles()}return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],this.mergeSources(),_.setEventedParent(null),_.onRemove&&_.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(o,_){this._checkLoaded(),this.getOwnSource(o).setData(_),this._changes.setDirty()}getOwnSource(o){const _=this.getOwnSourceCache(o);return _&&_.getSource()}getOwnSources(){const o=[];for(const _ in this._otherSourceCaches){const rt=this.getOwnSourceCache(_);rt&&o.push(rt.getSource())}return o}areTilesLoaded(){const o=this._mergedSourceCaches;for(const _ in o){const rt=o[_]._tiles;for(const ot in rt){const lt=rt[ot];if(lt.state!=="loaded"&&lt.state!=="errored")return!1}}return!0}setLights(o){if(this._checkLoaded(),!o)return delete this.ambientLight,void delete this.directionalLight;const _=this._getTransitionParameters();for(const lt of o){if(this._validate(Wl,"lights",lt))return;switch(lt.type){case"ambient":if(this.ambientLight){const ut=this.ambientLight;ut.set(lt),ut.updateTransitions(_)}else this.ambientLight=new io(lt,Bl||(Bl=new c.a9({color:new c.aa(c.a6.properties_light_ambient.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const ut=this.directionalLight;ut.set(lt),ut.updateTransitions(_)}else this.directionalLight=new io(lt,Rl||(Rl=new c.a9({direction:new c.ap(c.a6.properties_light_directional.direction),color:new c.aa(c.a6.properties_light_directional.color),"color-use-theme":new c.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new c.aa(c.a6.properties_light_directional.intensity),"cast-shadows":new c.aa(c.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new c.aa(c.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new c.aa(c.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const rt=Object.assign(_,{worldview:this.map.getWorldview()}),ot=new c.ac(this.z||0,rt);this.ambientLight&&this.ambientLight.recalculate(ot),this.directionalLight&&this.directionalLight.recalculate(ot),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const o=this.directionalLight,_=this.ambientLight;if(!o||!_)return;const rt=Bt=>.2126*(Bt[0]<=.03928?Bt[0]/12.92:Math.pow((Bt[0]+.055)/1.055,2.4))+.7152*(Bt[1]<=.03928?Bt[1]/12.92:Math.pow((Bt[1]+.055)/1.055,2.4))+.0722*(Bt[2]<=.03928?Bt[2]/12.92:Math.pow((Bt[2]+.055)/1.055,2.4)),ot=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),lt=o.properties.get("intensity"),ut=o.properties.get("direction"),dt=1-c.d4(ut.x,ut.y,ut.z)[2]/90,mt=rt(ot)*lt*dt,Tt=_.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),Ct=_.properties.get("intensity"),Ut=rt(Tt)*Ct;return Number(((mt+Ut)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const o=[];return this.directionalLight&&o.push(this.directionalLight.get()),this.ambientLight&&o.push(this.ambientLight.get()),o}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(o){if(o==null||o===""&&this.isRootStyle())return this;if(c.dr(o)){const _=c.ds(o),rt=this.fragments.find(({id:lt})=>lt===_);if(!rt)return;const ot=c.dq(o);return rt.style.getFragmentStyle(ot)}{const _=this.fragments.find(({id:rt})=>rt===o);return _?_.style:void 0}}setFeaturesetSelectors(o){if(!o)return;const _={},rt=(ot,lt="")=>`${ot}::${lt}`;this._featuresetSelectors={};for(const ot in o){const lt=this._featuresetSelectors[ot]=[];for(const ut of o[ot].selectors){if(ut.featureNamespace){const mt=this.getOwnLayer(ut.layer);if(!mt){c.w(`Layer is undefined for selector: ${ut.layer}`);continue}const Tt=rt(mt.source,mt.sourceLayer);if(Tt in _&&_[Tt]!==ut.featureNamespace){c.w(`"featureNamespace ${ut.featureNamespace} of featureset ${ot}'s selector is not associated to the same source, skip this selector`);continue}_[Tt]=ut.featureNamespace}let dt;if(ut.properties)for(const mt in ut.properties){const Tt=c.U(ut.properties[mt]);Tt.result==="success"&&(dt=dt||{},dt[mt]=Tt.value)}lt.push({layerId:ut.layer,namespace:ut.featureNamespace,properties:dt,uniqueFeatureID:ut._uniqueFeatureID})}}}getFeaturesetDescriptors(o){const _=this.getFragmentStyle(o);if(!_||!_.stylesheet.featuresets)return[];const rt=[];for(const ot in _.stylesheet.featuresets)rt.push({featuresetId:ot,importId:_.scope?_.scope:void 0});return rt}getFeaturesetLayers(o,_){const rt=this.getFragmentStyle(_),ot=rt.stylesheet.featuresets;if(!ot||!ot[o])return this.fire(new c.y(new Error(`The featureset '${o}' does not exist in the map's style and cannot be queried.`))),[];const lt=[];for(const ut of ot[o].selectors){const dt=rt.getOwnLayer(ut.layer);dt&&lt.push(dt)}return lt}getConfigProperty(o,_){const rt=this.getFragmentStyle(o);if(!rt)return null;const ot=c.B(_,rt.scope),lt=rt.options.get(ot),ut=lt?lt.value||lt.default:null;return ut?ut.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(o,_){const rt=c.B(o,_);return this._mergedIndoor[rt]}setIndoorData(o,_){this.map.indoor.setIndoorData(_)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(o,_,rt){const ot=this.getFragmentStyle(o);if(!ot)return;const lt=ot.stylesheet.schema;if(!lt||!lt[_])return;const ut=c.U(rt);if(ut.result!=="success")return void jm(this,ut.value);const dt=ut.value.expression,mt=c.B(_,ot.scope),Tt=ot.options.get(mt);if(!Tt)return;let Ct;const{minValue:Ut,maxValue:Bt,stepValue:$t,type:Zt,values:qt}=lt[_],sr=c.U(lt[_].default);sr.result==="success"&&(Ct=sr.value.expression),Ct?(this.options.set(mt,Object.assign({},Tt,{value:dt,default:Ct,minValue:Ut,maxValue:Bt,stepValue:$t,type:Zt,values:qt})),this.updateConfigDependencies(_)):this.fire(new c.y(new Error(`No schema defined for the config option "${_}" in the "${o}" fragment.`)))}getConfig(o){const _=this.getFragmentStyle(o);if(!_)return null;const rt=_.stylesheet.schema;if(!rt)return null;const ot={};for(const lt in rt){const ut=c.B(lt,_.scope),dt=_.options.get(ut),mt=dt?dt.value||dt.default:null;ot[lt]=mt?mt.serialize():null}return ot}setConfig(o,_){const rt=this.getFragmentStyle(o);rt&&(rt.updateConfig(_,rt.stylesheet.schema),this.updateConfigDependencies())}getSchema(o){const _=this.getFragmentStyle(o);return _?_.stylesheet.schema:null}setSchema(o,_){const rt=this.getFragmentStyle(o);rt&&(rt.stylesheet.schema=_,rt.updateConfig(rt._config,_),this.updateConfigDependencies())}updateConfig(o,_){if(this._config=o,o||_)if(_)for(const rt in _){let ot,lt;const ut=c.U(_[rt].default);if(ut.result==="success"&&(ot=ut.value.expression),o&&o[rt]!==void 0){const Bt=c.U(o[rt]);Bt.result==="success"&&(lt=Bt.value.expression)}const{minValue:dt,maxValue:mt,stepValue:Tt,type:Ct,values:Ut}=_[rt];if(ot){const Bt=c.B(rt,this.scope);this.options.set(Bt,{default:ot,value:lt,minValue:dt,maxValue:mt,stepValue:Tt,type:Ct,values:Ut})}else this.fire(new c.y(new Error(`No schema defined for config option "${rt}".`)))}else this.fire(new c.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(o,_=()=>!0){for(const rt of o){const ot=this.getLayer(rt);ot&&_(ot)&&(ot.possiblyEvaluateVisibility(),this._updateLayer(ot),this._changes.setDirty())}}updateConfigDependencies(o){this._updateLayers(this._configDependentLayers,_=>!o||_.expressionDependencies.configDependencies.has(o)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(_=>{const rt=_._styleColorTheme.colorThemeOverride?_._styleColorTheme.colorThemeOverride:_._styleColorTheme.colorTheme;if(rt){const ot=_._evaluateColorThemeData(rt);(!_._styleColorTheme.lut&&ot!==""||_._styleColorTheme.lut&&ot!==_._styleColorTheme.lut.data)&&_.setColorTheme(rt)}}),this._changes.setDirty()}addLayer(o,_,rt={}){this._checkLoaded();const ot=o.id;if(this._layers[ot])return void this.fire(new c.y(new Error(`Layer with id "${ot}" already exists on this map`)));let lt;if(o.type==="custom"){if(jm(this,c.dt(o)))return;lt=c.du(o,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof o.source=="object"&&(this.addSource(ot,o.source),o=c.dp(o),o=Object.assign(o,{source:ot})),this._validate(vp,`layers.${ot}`,o,{arrayIndex:-1},rt))return;lt=c.du(o,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(lt),lt.setEventedParent(this,{layer:{id:ot}})}const ut=c.B(lt.source,lt.scope);lt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(ut),lt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(ut);let dt=this._order.length;if(_){const Ut=this._order.indexOf(_);if(Ut===-1)return void this.fire(new c.y(new Error(`Layer with id "${_}" does not exist on this map.`)));lt.slot===this._layers[_].slot?dt=Ut:c.w(`Layer with id "${_}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(dt,0,ot),this._layerOrderChanged=!0,this._layers[ot]=lt;const mt=this.getOwnLayerSourceCache(lt),Tt=!!this.directionalLight&&this.directionalLight.shadowsEnabled();mt&&lt.canCastShadows()&&Tt&&(mt.castsShadows=!0);const Ct=this._changes.getRemovedLayer(lt);if(Ct&&lt.source&&mt&&lt.type!=="custom"){this._changes.discardLayerRemoval(lt);const Ut=c.B(lt.source,lt.scope);Ct.type!==lt.type?this._changes.updateSourceCache(Ut,"clear"):(this._changes.updateSourceCache(Ut,"reload"),mt.pause())}this._updateLayer(lt),lt.onAdd&&lt.onAdd(this.map),lt.scope=this.scope,this.mergeLayers()}moveLayer(o,_){this._checkLoaded();const rt=this._checkLayer(o);if(!rt||o===_)return;const ot=this._order.indexOf(o);this._order.splice(ot,1);let lt=this._order.length;if(_){const ut=this._order.indexOf(_);if(ut===-1)return void this.fire(new c.y(new Error(`Layer with id "${_}" does not exist on this map.`)));rt.slot===this._layers[_].slot?lt=ut:c.w(`Layer with id "${_}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(lt,0,o),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(o){this._checkLoaded();const _=this._checkLayer(o);if(!_)return;_.setEventedParent(null);const rt=this._order.indexOf(o);this._order.splice(rt,1),delete this._layers[o],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(_.fqid),this._indoorDependentLayers.delete(_.fqid),this._changes.removeLayer(_);const ot=this.getOwnLayerSourceCache(_);if(ot&&ot.castsShadows){let lt=!1;for(const ut in this._layers)if(this._layers[ut].source===_.source&&this._layers[ut].canCastShadows()){lt=!0;break}ot.castsShadows=lt}_.onRemove&&_.onRemove(this.map),this.mergeLayers()}getOwnLayer(o){return this._layers[o]}hasLayer(o){return o in this._mergedLayers}hasLayerType(o){for(const _ in this._layers)if(this._layers[_].type===o)return!0;return!1}setLayerZoomRange(o,_,rt){this._checkLoaded();const ot=this._checkLayer(o);ot&&(ot.minzoom===_&&ot.maxzoom===rt||(_!=null&&(ot.minzoom=_),rt!=null&&(ot.maxzoom=rt),this._updateLayer(ot)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(o,_){this._checkLoaded();const rt=this._checkLayer(o);rt&&rt.slot!==_&&(rt.slot=_,this._updateLayer(rt))}setFilter(o,_,rt={}){this._checkLoaded();const ot=this._checkLayer(o);if(ot&&!c.by(ot.filter,_))return _==null?(ot.filter=void 0,void this._updateLayer(ot)):void(this._validate(cu,`layers.${ot.id}.filter`,_,{layerType:ot.type},rt)||(ot.filter=c.dp(_),this._updateLayer(ot)))}getFilter(o){const _=this._checkLayer(o);if(_)return c.dp(_.filter)}setLayoutProperty(o,_,rt,ot={}){this._checkLoaded();const lt=this._checkLayer(o);if(lt&&!c.by(lt.getLayoutProperty(_),rt)){if(rt!=null&&(!ot||ot.validate!==!1)&&jm(lt,Hr.call(Lo,{key:`layers.${o}.layout.${_}`,layerType:lt.type,objectKey:_,value:rt,styleSpec:c.a6,style:{glyphs:!0,sprite:!0}})))return;lt.setLayoutProperty(_,rt),lt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(lt.fqid),lt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(lt.fqid),this._updateLayer(lt)}}setLayerProperty(o,_,rt,ot={}){this._checkLoaded();const lt=this._checkLayer(o);lt&&(_==="appearances"?(lt.setAppearances(rt),this._changes.setDirty()):lt.isPaintProperty(_)?this.setPaintProperty(o,_,rt,ot):this.setLayoutProperty(o,_,rt,ot))}getLayoutProperty(o,_){const rt=this._checkLayer(o);if(rt)return rt.getLayoutProperty(_)}setPaintProperty(o,_,rt,ot={}){this._checkLoaded();const lt=this._checkLayer(o);if(!lt||c.by(lt.getPaintProperty(_),rt)||rt!=null&&(!ot||ot.validate!==!1)&&jm(lt,bp.call(Lo,{key:`layers.${o}.paint.${_}`,layerType:lt.type,objectKey:_,value:rt,styleSpec:c.a6})))return;const ut=lt.setPaintProperty(_,rt);lt.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(lt.fqid),lt.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(lt.fqid),ut&&this._updateLayer(lt),this._changes.updatePaintProperties(lt)}getPaintProperty(o,_){const rt=this._checkLayer(o);if(rt)return rt.getPaintProperty(_)}setFeatureState(o,_){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:mt,importId:Tt}=o.target,Ct=this.getFragmentStyle(Tt),Ut=Ct.getFeaturesetLayers(mt);for(const{source:Bt,sourceLayer:$t}of Ut)Ct.setFeatureState({id:o.id,source:Bt,sourceLayer:$t},_)}else if("layerId"in o.target){const{layerId:mt}=o.target,Tt=this.getLayer(mt);this.setFeatureState({id:o.id,source:Tt.source,sourceLayer:Tt.sourceLayer},_)}return}const rt=o.source,ot=o.sourceLayer,lt=this._checkSource(rt);if(!lt)return;const ut=lt.type;if(ut==="geojson"&&ot)return void this.fire(new c.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(ut==="vector"&&!ot)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided.")));const dt=this.getOwnSourceCaches(rt);for(const mt of dt)mt.setFeatureState(ot,o.id,_)}removeFeatureState(o,_){if(this._checkLoaded(),"target"in o){if("featuresetId"in o.target){const{featuresetId:mt,importId:Tt}=o.target,Ct=this.getFragmentStyle(Tt),Ut=Ct.getFeaturesetLayers(mt);for(const{source:Bt,sourceLayer:$t}of Ut)Ct.removeFeatureState({id:o.id,source:Bt,sourceLayer:$t},_)}else if("layerId"in o.target){const{layerId:mt}=o.target,Tt=this.getLayer(mt);this.removeFeatureState({id:o.id,source:Tt.source,sourceLayer:Tt.sourceLayer},_)}return}const rt=o.source,ot=this._checkSource(rt);if(!ot)return;const lt=ot.type,ut=lt==="vector"?o.sourceLayer:void 0;if(lt==="vector"&&!ut)return void this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(_&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new c.y(new Error("A feature id is required to remove its specific state property.")));const dt=this.getOwnSourceCaches(rt);for(const mt of dt)mt.removeFeatureState(ut,o.id,_)}getFeatureState(o){if(this._checkLoaded(),"target"in o){let lt;if("featuresetId"in o.target){const{featuresetId:ut,importId:dt}=o.target,mt=this.getFragmentStyle(dt),Tt=mt.getFeaturesetLayers(ut);for(const{source:Ct,sourceLayer:Ut}of Tt){const Bt=mt.getFeatureState({id:o.id,source:Ct,sourceLayer:Ut});if(Bt&&!lt)lt=Bt;else if(!c.by(lt,Bt))return void this.fire(new c.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in o.target){const{layerId:ut}=o.target,dt=this.getLayer(ut);lt=this.getFeatureState({id:o.id,source:dt.source,sourceLayer:dt.sourceLayer})}return lt}const _=o.source,rt=o.sourceLayer,ot=this._checkSource(_);if(ot){if(ot.type!=="vector"||rt)return o.id===void 0&&this.fire(new c.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(_)[0].getFeatureState(rt,o.id);this.fire(new c.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(o){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,o),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const o=this.getTerrain(),_=o&&this.terrain&&this.terrain.scope===this.scope?o:this.stylesheet.terrain;return c.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:_,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},rt=>rt!==void 0)}_updateFilteredLayers(o){for(const _ of Object.values(this._mergedLayers))o(_)&&this._updateLayer(_)}_updateLayer(o){this._changes.updateLayer(o);const _=this.getLayerSourceCache(o),rt=c.B(o.source,o.scope),ot=this._changes.getUpdatedSourceCaches();o.source&&!ot[rt]&&_&&_.getSource().type!=="raster"&&(this._changes.updateSourceCache(rt,"reload"),_.pause()),o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const _=dt=>this._mergedLayers[dt].is3D(!!this.terrain),rt=this.order,ot={},lt=[];for(let dt=rt.length-1;dt>=0;dt--){const mt=rt[dt];if(_(mt)){ot[mt]=dt;for(const Tt of o){const Ct=Tt[mt];if(Ct)for(const Ut of Ct)lt.push(Ut)}}}lt.sort((dt,mt)=>mt.intersectionZ-dt.intersectionZ);const ut=[];for(let dt=rt.length-1;dt>=0;dt--){const mt=rt[dt];if(_(mt))for(let Tt=lt.length-1;Tt>=0;Tt--){const Ct=lt[Tt].feature;if(Ct.layer&&ot[Ct.layer.id]<dt)break;ut.push(Ct),lt.pop()}else for(const Tt of o){const Ct=Tt[mt];if(Ct)for(const Ut of Ct)ut.push(Ut.feature)}}return ut}queryRasterValue(o,_,rt){const ot=this.getOwnSource(o);return ot?ot.type!=="raster-array"?(this.fire(new c.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):ot.queryRasterArrayValue(_,rt):(this.fire(new c.y(new Error(`Source with id "${o}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(o,_,rt){let ot;_&&!Array.isArray(_)&&_.filter&&(this._validate(cu,"queryRenderedFeatures.filter",_.filter,null,_),ot=c.b6(_.filter));const lt={},ut=Ct=>{if(T0.has(Ct.type))return;const Ut=this.getOwnLayerSourceCache(Ct),Bt=lt[Ut.id]=lt[Ut.id]||{sourceCache:Ut,layers:{},has3DLayers:!1};Ct.is3D(!!this.terrain)&&(Bt.has3DLayers=!0),Bt.layers[Ct.fqid]=Bt.layers[Ct.fqid]||{styleLayer:Ct,targets:[]},Bt.layers[Ct.fqid].targets.push({filter:ot})};if(_&&_.layers){if(!Array.isArray(_.layers))return this.fire(new c.y(new Error("parameters.layers must be an Array."))),[];for(const Ct of _.layers){const Ut=this._layers[Ct];if(!Ut)return this.fire(new c.y(new Error(`The layer '${Ct}' does not exist in the map's style and cannot be queried for features.`))),[];ut(Ut)}}else for(const Ct in this._layers)ut(this._layers[Ct]);const dt=this._queryRenderedFeatures(o,lt,rt),mt=this._flattenAndSortRenderedFeatures(dt),Tt=[];for(const Ct of mt)c.dw(Ct.layer.id)===this.scope&&Tt.push(Ct);return Tt}queryRenderedFeatureset(o,_,rt){let ot;_&&!Array.isArray(_)&&_.filter&&(this._validate(cu,"queryRenderedFeatures.filter",_.filter,null,_),ot=c.b6(_.filter));const lt="mock",ut=[];if(_&&_.target)ut.push(Object.assign({},_,{targetId:lt,filter:ot}));else{const Ct=this.getFeaturesetDescriptors();for(const Ut of Ct)ut.push({targetId:lt,filter:ot,target:Ut});for(const{style:Ut}of this.fragments){const Bt=Ut.getFeaturesetDescriptors();for(const $t of Bt)ut.push({targetId:lt,filter:ot,target:$t})}}const dt=this.queryRenderedTargets(o,ut,rt),mt=[],Tt=new Set;for(const Ct of dt)for(const Ut of Ct.variants[lt])bx(Ut,Ct,Tt)||mt.push(new c.dx(Ct,Ut));return mt}queryRenderedTargets(o,_,rt){const ot={},lt=(dt,mt,Tt,Ct)=>{const Ut=ot[mt.id]=ot[mt.id]||{sourceCache:mt,layers:{},has3DLayers:!1};if(Ut.layers[dt.fqid]=Ut.layers[dt.fqid]||{styleLayer:dt,targets:[]},dt.is3D(!!this.terrain)&&(Ut.has3DLayers=!0),!Ct)return Tt.uniqueFeatureID=!1,void Ut.layers[dt.fqid].targets.push(Tt);Ut.layers[dt.fqid].targets.push(Object.assign({},Tt,{namespace:Ct.namespace,properties:Ct.properties,uniqueFeatureID:Ct.uniqueFeatureID}))};for(const dt of _)if("featuresetId"in dt.target){const{featuresetId:mt,importId:Tt}=dt.target,Ct=this.getFragmentStyle(Tt);if(!Ct||!Ct._featuresetSelectors)continue;const Ut=Ct._featuresetSelectors[mt];if(!Ut){this.fire(new c.y(new Error(`The featureset '${mt}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const Bt of Ut){const $t=Ct.getOwnLayer(Bt.layerId);$t&&!T0.has($t.type)&&lt($t,Ct.getOwnLayerSourceCache($t),dt,Bt)}}else if("layerId"in dt.target){const{layerId:mt}=dt.target,Tt=this.getLayer(mt);if(!Tt||T0.has(Tt.type))continue;lt(Tt,this.getLayerSourceCache(Tt),dt)}const ut=this._queryRenderedFeatures(o,ot,rt);return this._flattenAndSortRenderedFeatures(ut)}_queryRenderedFeatures(o,_,rt){const ot=[],lt=!!this.map._showQueryGeometry,ut=xl.createFromScreenPoints(o,rt);for(const dt in _){const mt=l0(ut,_[dt],this._availableImages,rt,lt);Object.keys(mt).length&&ot.push(mt)}if(this.placement)for(const dt in _){if(!_[dt].sourceCache._onlySymbols)continue;const mt=c0(ut.screenGeometry,_[dt],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(mt).length&&ot.push(mt)}return ot}querySourceFeatures(o,_){const rt=_&&_.filter;rt&&this._validate(cu,"querySourceFeatures.filter",rt,null,_);let ot=[];const lt=this.getOwnSourceCaches(o);for(const ut of lt)ot=ot.concat(u0(ut,_));return ot}addSourceType(o,_,rt){return pp.getSourceType(o)?rt(new Error(`A source type called "${o}" already exists.`)):(pp.setSourceType(o,_),_.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:_.workerSourceURL},rt):rt(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(o,_,rt={}){this._checkLoaded();const ot=this.light.getLight();let lt=!1;for(const dt in o)if(!c.by(o[dt],ot[dt])){lt=!0;break}if(!lt)return;const ut=this._getTransitionParameters();this.light.setLight(o,_,rt),this.light.updateTransitions(ut)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=c.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&c.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(o,_=1){if(this._checkLoaded(),!o)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),_===0&&delete this.terrain,o===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let rt=o;const ot=!("source"in o)||o.source==null;if(_===1){if(this.disableElevatedTerrain)return;if("source"in rt&&typeof rt.source=="object"){const dt="terrain-dem-src";this.addSource(dt,rt.source),rt=c.dp(rt),rt=Object.assign(rt,{source:dt})}const lt=Object.assign({},rt),ut={};if(this.terrain&&ot){lt.source=this.terrain.get().source;const dt=this.terrain?this.getFragmentStyle(this.terrain.scope):null;dt&&(ut.style=dt.serialize())}if(this._validate(Bu,"terrain",lt,ut))return}if(!this.terrain||this.terrain.scope!==this.scope&&!ot||this.terrain&&_!==this.terrain.drapeRenderMode){if(!rt)return;this._createTerrain(rt,_),this.fire(new c.z("data",{dataType:"style"}))}else{const lt=this.terrain,ut=lt.get();for(const dt of Object.keys(c.a6.terrain))!rt.hasOwnProperty(dt)&&c.a6.terrain[dt].default&&(rt[dt]=c.a6.terrain[dt].default);for(const dt in o)if(!c.by(o[dt],ut[dt])){lt.set(o,this.options),this.stylesheet.terrain=o;const mt=this._getTransitionParameters({duration:0});lt.updateTransitions(mt),this.fire(new c.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const _=this.fog=new Tn(o,this.map.transform,this.scope,this.options);this.stylesheet.fog=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}_createSnow(o){const _=this.snow=new Hl(o,this.map.transform,this.scope,this.options);this.stylesheet.snow=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}_createRain(o){const _=this.rain=new $a(o,this.map.transform,this.scope,this.options);this.stylesheet.rain=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const _=this.fog;if(!c.by(_.get(),o)){_.set(o,this.options),this.stylesheet.fog=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}}else this._createFog(o);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(o){if(this._checkLoaded(),!o)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const _=this.snow;if(!c.by(_.get(),o)){_.set(o,this.options),this.stylesheet.snow=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}}else this._createSnow(o);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(o){if(this._checkLoaded(),!o)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const _=this.rain;if(!c.by(_.get(),o)){_.set(o,this.options),this.stylesheet.rain=_.get();const rt=this._getTransitionParameters({duration:0});_.updateTransitions(rt)}}else this._createRain(o);this._markersNeedUpdate=!0}_reloadColorTheme(){const o=()=>{for(const ot in this._layers)this._layers[ot].lut=this._styleColorTheme.lut;for(const ot in this._sourceCaches)this._sourceCaches[ot].clearTiles()},_=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!_)return this._styleColorTheme.lut=null,void o();const rt=this._evaluateColorThemeData(_);this._loadColorTheme(rt).then(()=>{this.fire(new c.z("colorthemeset")),o()}).catch(ot=>{c.w(`Couldn't set color theme: ${ot}`)})}setColorTheme(o){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&c.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=o,this._reloadColorTheme()}setImportColorTheme(o,_){const rt=this.getFragmentStyle(o);rt&&(rt._styleColorTheme.colorThemeOverride=_,rt._reloadColorTheme())}_getTransitionParameters(o){return{now:c.o.now(),transition:Object.assign(this.transition,o)}}updateDrapeFirstLayers(){if(!this.terrain)return;const o=[],_=[];for(const rt of this._mergedOrder)this.isLayerDraped(this._mergedLayers[rt])?o.push(rt):_.push(rt);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(..._)}_createTerrain(o,_){const rt=this.terrain=new Vr(o,_,this.scope,this.options,this.map.getWorldview());_===1&&(this.stylesheet.terrain=o),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const ot=this._getTransitionParameters({duration:0});rt.updateTransitions(ot)}_force3DLayerUpdate(){for(const o in this._layers){const _=this._layers[o];_.type==="fill-extrusion"&&this._updateLayer(_)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const _=this._layers[o];_.type==="symbol"&&this._updateLayer(_)}}_validate(o,_,rt,ot,lt={}){if(lt&&lt.validate===!1)return!1;const ut=Object.assign({},this.serialize());return jm(this,o.call(Lo,Object.assign({key:_,style:ut,value:rt,styleSpec:c.a6},ot)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._mergedLayers)this._mergedLayers[o].setEventedParent(null);for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles(),this._mergedSourceCaches[o].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(o){const _=this.getSourceCaches(o);for(const rt of _)rt.clearTiles()}clearSources(){for(const o in this._mergedSourceCaches)this._mergedSourceCaches[o].clearTiles()}clearLayers(){for(const o in this._mergedLayers){const _=this._mergedLayers[o];_._clear&&_._clear()}}reloadSource(o){const _=this.getSourceCaches(o);for(const rt of _)rt.resume(),rt.reload()}reloadSources(){for(const o of this.getSources())o.reload&&o.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(o=>{o.modelManager.reloadModels(o.scope)})}updateSources(o){let _;this.directionalLight&&(_=by(this.directionalLight));const rt=new Set,ot=new Set;for(const lt in this._mergedLayers){const ut=this._mergedLayers[lt];ut.type==="building"&&rt.add(ut.source),ut.hasElevation()&&!ot.has(ut.source)&&ot.add(ut.source)}for(const lt in this._mergedSourceCaches){const ut=this._mergedSourceCaches[lt],dt=ot.has(ut._source.id);rt.has(ut._source.id)&&(ut._source.reparseOverscaled=!1),ut.update(o,void 0,void 0,_,dt)}}_generateCollisionBoxes(){for(const o in this._sourceCaches){const _=this._sourceCaches[o];_.resume(),_.reload()}}_updatePlacement(o,_,rt,ot,lt,ut,dt=!1){let mt=!1,Tt=!1;const Ct={},Ut={};for(const qt of this._mergedOrder){const sr=this._mergedLayers[qt];if(sr.type!=="symbol")continue;const ir=c.B(sr.source,sr.scope);let cr=Ct[ir];if(!cr){const ur=this.getLayerSourceCache(sr);if(!ur)continue;const Cr=ur.getRenderableIds(!0).map(wr=>ur.getTileByID(wr));Ut[ir]=Cr.slice(),cr=Ct[ir]=Cr.sort((wr,Tr)=>Tr.tileID.overscaledZ-wr.tileID.overscaledZ||(wr.tileID.isLessThan(Tr.tileID)?-1:1))}const pr=this.crossTileSymbolIndex.addLayer(sr,cr,_.center.lng,_.projection);mt=mt||pr}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),dt=dt||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new c.z("neworder"));const Bt=!!(this.placement&&!_.equals(this.placement.transform)),$t=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!ut||this.placement.lastReplacementSourceUpdateTime!==ut.updateTime)),Zt=(Bt||$t||mt||this.placement&&this.placement.isStale())&&ot===0;if((dt||!this.pauseablePlacement||Zt||ot!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.o.now(),_.zoom))&&(this.pauseablePlacement=new iu(_,this._mergedOrder,dt||ot===0,rt,ot,lt,this.placement,this.fog&&_.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,Ct,Ut,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.o.now()),Tt=!0),mt&&this.pauseablePlacement.placement.setStale()),Tt||mt){this._buildingIndex.onNewFrame(_.zoom);for(let qt=0;qt<this._mergedOrder.length;qt++){const sr=this._mergedLayers[this._mergedOrder[qt]];if(sr.type!=="symbol"||sr.visibility==="none")continue;const ir=this.isLayerClipped(sr);this.placement.updateLayerOpacities(sr,Ct[c.B(sr.source,sr.scope)],qt,ir?ut:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.o.now())}}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}addImport(o,_){this._checkLoaded();const rt=this.stylesheet.imports=this.stylesheet.imports||[];if(rt.findIndex(({id:lt})=>lt===o.id)!==-1)return void this.fire(new c.y(new Error(`Import with id '${o.id}' already exists in the map's style.`)));if(!_)return rt.push(o),this._loadImports([o],!0);const ot=rt.findIndex(({id:lt})=>lt===_);return ot===-1&&this.fire(new c.y(new Error(`Import with id "${_}" does not exist on this map.`))),this.stylesheet.imports=rt.slice(0,ot).concat(o).concat(rt.slice(ot)),this._loadImports([o],!0,_)}updateImport(o,_){this._checkLoaded();const rt=this.stylesheet.imports||[],ot=this.getImportIndex(o);return ot===-1?this:typeof _=="string"?(this.setImportUrl(o,_),this):(_.url&&_.url!==rt[ot].url&&this.setImportUrl(o,_.url),c.by(_.config,rt[ot].config)||this.setImportConfig(o,_.config,_.data.schema),c.by(_.data,rt[ot].data)||this.setImportData(o,_.data),this)}moveImport(o,_){this._checkLoaded();let rt=this.stylesheet.imports||[];const ot=this.getImportIndex(o);if(ot===-1)return this;const lt=this.getImportIndex(_);if(lt===-1)return this;const ut=rt[ot],dt=this.fragments[ot];return rt=rt.filter(({id:mt})=>mt!==o),this.fragments=this.fragments.filter(({id:mt})=>mt!==o),this.stylesheet.imports=rt.slice(0,lt).concat(ut).concat(rt.slice(lt)),this.fragments=this.fragments.slice(0,lt).concat(dt).concat(this.fragments.slice(lt)),this.mergeLayers(),this}setImportUrl(o,_){this._checkLoaded();const rt=this.stylesheet.imports||[],ot=this.getImportIndex(o);if(ot===-1)return this;rt[ot].url=_;const lt=this.fragments[ot];return lt.style=this._createFragmentStyle(rt[ot]),lt.style.on("style.import.load",()=>this.mergeAll()),lt.style.loadURL(_),this}setImportData(o,_){this._checkLoaded();const rt=this.getImportIndex(o),ot=this.stylesheet.imports||[];return rt===-1?this:_?(this.fragments[rt].style.setState(_),this._reloadImports(),this):(delete ot[rt].data,this.setImportUrl(o,ot[rt].url))}setImportConfig(o,_,rt){this._checkLoaded();const ot=this.getImportIndex(o),lt=this.stylesheet.imports||[];if(ot===-1)return this;_?lt[ot].config=_:delete lt[ot].config;const ut=this.fragments[ot];rt&&ut.style.stylesheet&&(ut.style.stylesheet.schema=rt);const dt=ut.style.stylesheet&&ut.style.stylesheet.schema;return ut.config=_,ut.style.updateConfig(_,dt),this.updateConfigDependencies(),this}removeImport(o){this._checkLoaded();const _=this.stylesheet.imports||[],rt=this.getImportIndex(o);rt!==-1&&(_.splice(rt,1),this.fragments[rt].style._remove(),this.fragments.splice(rt,1),this._reloadImports())}getImportIndex(o){const _=(this.stylesheet.imports||[]).findIndex(rt=>rt.id===o);return _===-1&&this.fire(new c.y(new Error(`Import '${o}' does not exist in the map's style and cannot be updated.`))),_}getLayer(o){return this._mergedLayers[o]}getSources(){const o=[];for(const _ in this._mergedOtherSourceCaches){const rt=this._mergedOtherSourceCaches[_];rt&&o.push(rt.getSource())}return o}getSource(o,_){const rt=this.getSourceCache(o,_);return rt&&rt.getSource()}getLayerSource(o){const _=this.getLayerSourceCache(o);return _&&_.getSource()}getSourceCache(o,_){const rt=c.B(o,_);return this._mergedOtherSourceCaches[rt]}getLayerSourceCache(o){const _=c.B(o.source,o.scope);return o.type==="symbol"?this._mergedSymbolSourceCaches[_]:this._mergedOtherSourceCaches[_]}getSourceCaches(o){if(o==null)return Object.values(this._mergedSourceCaches);const _=[];return this._mergedOtherSourceCaches[o]&&_.push(this._mergedOtherSourceCaches[o]),this._mergedSymbolSourceCaches[o]&&_.push(this._mergedSymbolSourceCaches[o]),_}updateSourceCaches(){const o=this._changes.getUpdatedSourceCaches();for(const _ in o){const rt=o[_];rt==="reload"?this.reloadSource(_):rt==="clear"&&this.clearSource(_)}}updateLayers(o){const _=this._changes.getUpdatedPaintProperties();for(const rt of _){const ot=this.getLayer(rt);ot&&ot.updateTransitions(o)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(o){this.stylesheet.glyphs=o,this.glyphManager.setURL(o)}getImages(o,_,rt){this.imageManager.getImages(_.images,_.scope,rt),this._updateTilesForChangedImages();const ot=ut=>{if(ut){const dt=_.images.map(mt=>c.I.toString(mt));ut.setDependencies(_.tileID.key,_.type,dt)}},lt=c.B(_.source,_.scope);ot(this._mergedOtherSourceCaches[lt]),ot(this._mergedSymbolSourceCaches[lt]),_.images.some(ut=>ut.iconsetId)&&this.fire(new c.z("data",{dataType:"style"}))}rasterizeImages(o,_,rt){this.imageManager.rasterizeImages(_,rt)}getGlyphs(o,_,rt){this.glyphManager.getGlyphs(_.stacks,rt)}getResource(o,_,rt){return c.dz(_,rt)}getOwnSourceCache(o){return this._otherSourceCaches[o]}getOwnLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}getOwnSourceCaches(o){const _=[];return this._otherSourceCaches[o]&&_.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&_.push(this._symbolSourceCaches[o]),_}_isSourceCacheLoaded(o){const _=this.getOwnSourceCaches(o);return _.length===0?(this.fire(new c.y(new Error(`There is no source with ID '${o}'`))),!1):_.every(rt=>rt.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(o,_){if(!this._clipLayerPresent&&o.type!=="fill-extrusion"&&o.type!=="building")return!1;const rt=o.type==="fill-extrusion"&&(o.sourceLayer==="building"||o.sourceLayer==="procedural_buildings"),ot=o.type==="building";if(o.is3D(!!this.terrain)){if(rt||ot||_&&_.type==="batched-model"||o.type==="model")return!0}else if(o.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(o=>{o.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}pp.getSourceType=function(et){return Mp[et]},pp.setSourceType=function(et,o){Mp[et]=o},pp.registerForPluginStateChange=c.dA;class lw extends c.E{constructor(o){super(),this._style=o,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},c.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(o){o===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=o,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(o){this._activeFloorsVisible=o,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(o){for(const[_,rt]of Object.entries(o.buildings))if(this._buildings[_])for(const ot of rt.floorIds)this._buildings[_].floors[ot]||(this._buildings[_].floors[ot]=rt.floors[ot]);else this._buildings[_]=rt;for(const _ of o.activeFloors)this._activeFloors.add(_);this._updateIndoorSelector()}getIndoorTileOptions(o,_){const rt=this._style.getIndoorSourceLayers(o,_);return rt&&this._indoorState?{sourceLayers:rt,indoorState:this._indoorState}:null}_updateUI(o,_,rt){const ot=function(lt,ut,dt,mt){let Tt=null,Ct=Number.MAX_SAFE_INTEGER;if(mt<16)return null;for(const[Ut,Bt]of Object.entries(lt)){const $t=Bt.center;if($t){const Zt=ut.distanceTo(c.aT.convert($t));Zt<Ct&&dt.contains($t)&&(Ct=Zt,Tt=Ut)}}return Tt}(this._buildings,_,rt,o);ot!==this._closestBuildingId&&(this._closestBuildingId=ot,this._updateIndoorSelector())}_updateIndoorSelector(){const o=this._buildings,_=this._closestBuildingId,rt=_&&o?o[_]:void 0;if(!rt)return void this.fire(new c.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let ot=null;for(const ut of rt.floorIds)if(this._activeFloors&&this._activeFloors.has(ut)){ot=ut;break}const lt=Array.from(rt.floorIds).map(ut=>({id:ut,name:rt.floors[ut].name,zIndex:rt.floors[ut].zIndex})).sort((ut,dt)=>dt.zIndex-ut.zIndex);this.fire(new c.z("selector-update",{selectedFloorId:ot,activeFloorsVisible:this._activeFloorsVisible,floors:lt}))}_updateActiveFloors(){const o=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:o,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Rx=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Cx=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,dv=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,R0="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",_d=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,C0=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ps=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,fv=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,A0=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,j0=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,pv=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ey=/#include\s+"([^"]+)"/g,Bp=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,mv=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,ex=new Set(["ifdef","ifndef","elif","if","defined"]),tx=new Set;km(Rx,tx),km(dv,tx),km(Cx,tx);const Im={"_prelude_fog.vertex.glsl":C0,"_prelude_terrain.vertex.glsl":_d,"_prelude_shadow.vertex.glsl":j0,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ps,"_prelude_shadow.fragment.glsl":pv,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":fv,"_prelude_raster_particle.glsl":A0},P0={};Qn("",_d),Qn(Ps,C0),Qn(pv,j0),Qn(fv,""),Qn(A0,"");const cw=Qn(Cx,dv),I0=Rx,t2=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",I0,cw.fragmentSource].join(`
`),uw=["precision highp float;",I0,cw.vertexSource].join(`
`);var gv={background:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Qn(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Qn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Qn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Qn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Qn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Qn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Qn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Qn(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Qn(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Qn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Qn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Qn(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Qn("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Qn("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Qn(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Qn(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Qn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Qn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,R0),skyboxGradient:Qn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,R0),skyboxCapture:Qn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Qn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Qn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Qn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Qn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Qn("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Qn("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Qn("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Qn("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function km(et,o){const _=et.split(`
`);for(let rt of _){if(rt=rt.trimStart(),rt[0]!=="#"||!rt.includes("if")||rt.startsWith("#endif"))continue;const ot=rt.match(mv);if(ot)for(const lt of ot)ex.has(lt)||o.add(lt)}}function Qn(et,o){const _=new Set,rt=[],ot=[];et=et.replace(Ey,(ut,dt)=>(ot.push(dt),"")),o=o.replace(Ey,(ut,dt)=>(rt.push(dt),""));let lt=new Set(tx);km(et,lt),km(o,lt);for(const ut of[...rt,...ot])P0[ut]||(P0[ut]=new Set,km(Im[ut],P0[ut])),lt=new Set([...lt,...P0[ut]]);return{fragmentSource:et=et.replace(Bp,(ut,dt,mt,Tt,Ct)=>(_.add(Ct),dt==="define"?`
#ifndef HAS_UNIFORM_u_${Ct}
in ${mt} ${Tt} ${Ct};
#else
uniform ${mt} ${Tt} u_${Ct};
#endif
`:dt==="initialize"?`
#ifdef HAS_UNIFORM_u_${Ct}
    ${mt} ${Tt} ${Ct} = u_${Ct};
#endif
`:dt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ct}
    in ${mt} ${Tt} ${Ct};
#endif
`:dt==="initialize-attribute"?"":void 0)),vertexSource:o=o.replace(Bp,(ut,dt,mt,Tt,Ct)=>{const Ut=`MATERIAL_ATTRIBUTE_OFFSET_${Ct}`,Bt=Tt==="float"?"vec2":Tt,$t=`GET_ATTRIBUTE_${Bt}(a_${Ct}, materialInfo, ${Ut})`,Zt=Ct.match(/color/)?"color":Bt;return dt==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${Ct}
in ${mt} ${Tt} a_${Ct};
#endif
`:_.has(Ct)?dt==="define"?`
#ifndef HAS_UNIFORM_u_${Ct}
uniform lowp float u_${Ct}_t;
    #if !defined(${Ut})
        in ${mt} ${Bt} a_${Ct};
    #endif
out ${mt} ${Tt} ${Ct};
#else
uniform ${mt} ${Tt} u_${Ct};
#endif
`:dt==="initialize"?Zt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ct}
    ${Ct} = a_${Ct};
#else
    ${mt} ${Tt} ${Ct} = u_${Ct};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${Ct})
    #ifdef ${Ut}
        ${Ct} = unpack_mix_${Zt}(${$t}, u_${Ct}_t);
    #else
        ${Ct} = unpack_mix_${Zt}(a_${Ct}, u_${Ct}_t);
    #endif
#else
    ${mt} ${Tt} ${Ct} = u_${Ct};
#endif
`:dt==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ct}
    in ${mt} ${Tt} a_${Ct};
    out ${mt} ${Tt} ${Ct};
#endif
`:dt==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${Ct}
    ${Ct} = a_${Ct};
#endif
`:void 0:dt==="define"?`
#ifndef HAS_UNIFORM_u_${Ct}
uniform lowp float u_${Ct}_t;
    #if !defined(${Ut})
        in ${mt} ${Bt} a_${Ct};
    #endif
#else
uniform ${mt} ${Tt} u_${Ct};
#endif
`:dt==="define-instanced"?Zt==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${Ct}0;
in vec4 a_${Ct}1;
in vec4 a_${Ct}2;
in vec4 a_${Ct}3;
#else
uniform ${mt} ${Tt} u_${Ct};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${mt} ${Bt} a_${Ct};
#else
uniform ${mt} ${Tt} u_${Ct};
#endif
`:dt==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${Ct}
    ${mt} ${Tt} ${Ct} = a_${Ct};
#endif
`:Zt==="vec4"?`
#ifndef HAS_UNIFORM_u_${Ct}
    #ifdef ${Ut}
        ${mt} ${Tt} ${Ct} = ${$t};
    #else
        ${mt} ${Tt} ${Ct} = a_${Ct};
    #endif
#else
    ${mt} ${Tt} ${Ct} = u_${Ct};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Ct}
    #ifdef ${Ut}
        ${mt} ${Tt} ${Ct} = unpack_mix_${Zt}(${$t}, u_${Ct}_t);
    #else
        ${mt} ${Tt} ${Ct} = unpack_mix_${Zt}(a_${Ct}, u_${Ct}_t);
    #endif
#else
    ${mt} ${Tt} ${Ct} = u_${Ct};
#endif
`}),usedDefines:lt,vertexIncludes:rt,fragmentIncludes:ot}}class r2{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(o,_,rt,ot,lt,ut,dt,mt){this.context=o;let Tt=this.boundPaintVertexBuffers.length!==ot.length;for(let Ut=0;!Tt&&Ut<ot.length;Ut++)this.boundPaintVertexBuffers[Ut]!==ot[Ut]&&(Tt=!0);let Ct=this.boundDynamicVertexBuffers.length!==dt.length;for(let Ut=0;!Ct&&Ut<dt.length;Ut++)this.boundDynamicVertexBuffers[Ut]!==dt[Ut]&&(Ct=!0);if(!this.vao||this.boundProgram!==_||this.boundLayoutVertexBuffer!==rt||Tt||Ct||this.boundIndexBuffer!==lt||this.boundVertexOffset!==ut)this.freshBind(_,rt,ot,lt,ut,dt,mt);else{o.bindVertexArrayOES.set(this.vao);for(const Ut of dt)Ut&&(Ut.bind(),mt&&Ut.instanceCount&&Ut.setVertexAttribDivisor(o.gl,_,mt));lt&&lt.dynamicDraw&&lt.bind()}}freshBind(o,_,rt,ot,lt,ut,dt){const mt=this.context,Tt=mt.gl;this.vao&&this.destroy(),this.vao=mt.gl.createVertexArray(),mt.bindVertexArrayOES.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=_,this.boundPaintVertexBuffers=rt,this.boundIndexBuffer=ot,this.boundVertexOffset=lt,this.boundDynamicVertexBuffers=ut,_.enableAttributes(Tt,o),_.bind(),_.setVertexAttribPointers(Tt,o,lt);for(const Ct of rt)Ct.enableAttributes(Tt,o),Ct.bind(),Ct.setVertexAttribPointers(Tt,o,lt);for(const Ct of ut)Ct&&(Ct.enableAttributes(Tt,o),Ct.bind(),Ct.setVertexAttribPointers(Tt,o,lt),dt&&Ct.instanceCount&&Ct.setVertexAttribDivisor(Tt,o,dt));ot&&ot.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function i2(et,o){const _=Math.pow(2,o.canonical.z),rt=o.canonical.y;return[new c.ae(0,rt/_).toLngLat().lat,new c.ae(0,(rt+1)/_).toLngLat().lat]}function s2(et,o,_,rt,ot,lt,ut){const dt=et.context,mt=dt.gl,Tt=_.hillshadeFBO;if(!Tt)return;et.prepareDrawTile();const Ct=et.isTileAffectedByFog(o),Ut=[];et.terrain&&et.terrain.renderingToTexture&&et.emissiveMode==="mrt-fallback"&&Ut.push("USE_MRT1");const Bt=et.getOrCreateProgram("hillshade",{overrideFog:Ct,defines:Ut});dt.activeTexture.set(mt.TEXTURE0),mt.bindTexture(mt.TEXTURE_2D,Tt.colorAttachment0.get());const $t=((ir,cr,pr,ur)=>{const Cr=pr.paint.get("hillshade-shadow-color"),wr=pr.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Tr=pr.paint.get("hillshade-highlight-color"),br=pr.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",yr=pr.paint.get("hillshade-accent-color"),Pr=pr.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Or=pr.paint.get("hillshade-emissive-strength");let Nr=c.an(pr.paint.get("hillshade-illumination-direction"));if(pr.paint.get("hillshade-illumination-anchor")==="viewport")Nr-=ir.transform.angle;else if(ir.style&&ir.style.enable3dLights()&&ir.style.directionalLight){const rs=ir.style.directionalLight.properties.get("direction"),cs=c.d4(rs.x,rs.y,rs.z);Nr=c.an(cs[1])}const ts=!ir.options.moving;return{u_matrix:ur||ir.transform.calculateProjMatrix(cr.tileID.toUnwrapped(),ts),u_image:0,u_latrange:i2(0,cr.tileID),u_light:[pr.paint.get("hillshade-exaggeration"),Nr],u_shadow:Cr.toPremultipliedRenderColor(wr?null:pr.lut),u_highlight:Tr.toPremultipliedRenderColor(br?null:pr.lut),u_emissive_strength:Or,u_accent:yr.toPremultipliedRenderColor(Pr?null:pr.lut)}})(et,_,rt,et.terrain?o.projMatrix:null);et.uploadCommonUniforms(dt,Bt,o.toUnwrapped());const{tileBoundsBuffer:Zt,tileBoundsIndexBuffer:qt,tileBoundsSegments:sr}=et.getTileBoundsBuffers(_);Bt.draw(et,mt.TRIANGLES,ot,lt,ut,mn.disabled,$t,rt.id,Zt,qt,sr)}function xv(et,o,_){if(!o.needsDEMTextureUpload)return;const rt=et.context,ot=rt.gl;rt.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||et.getTileTexture(_.stride);const lt=_.getPixels();o.demTexture?o.demTexture.update(lt,{premultiply:!1}):o.demTexture=new c.T(rt,lt,ot.R32F,{premultiply:!1}),o.needsDEMTextureUpload=!1}function n2(et,o,_){const rt=et.context,ot=rt.gl;if(!o.dem)return;const lt=o.dem;if(rt.activeTexture.set(ot.TEXTURE1),xv(et,o,lt),!o.demTexture)return;o.demTexture.bind(ot.NEAREST,ot.CLAMP_TO_EDGE);const ut=lt.dim;rt.activeTexture.set(ot.TEXTURE0);let dt=o.hillshadeFBO;if(!dt){const Bt=new c.T(rt,{width:ut,height:ut,data:null},ot.RGBA8);Bt.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),dt=o.hillshadeFBO=rt.createFramebuffer(ut,ut,1,"renderbuffer"),dt.colorAttachment0.set(Bt.texture)}rt.bindFramebuffer.set(dt.framebuffer),rt.viewport.set([0,0,ut,ut]);const{tileBoundsBuffer:mt,tileBoundsIndexBuffer:Tt,tileBoundsSegments:Ct}=et.getMercatorTileBoundsBuffers(),Ut=[];et.linearFloatFilteringSupported()&&Ut.push("TERRAIN_DEM_FLOAT_FORMAT"),et.terrain&&et.terrain.renderingToTexture&&et.emissiveMode==="mrt-fallback"&&Ut.push("USE_MRT1"),et.getOrCreateProgram("hillshadePrepare",{defines:Ut}).draw(et,ot.TRIANGLES,tn.disabled,gn.disabled,jn.unblended,mn.disabled,((Bt,$t)=>{const Zt=$t.stride,qt=c.bC();return c.ce(qt,0,c.al,-c.al,0,0,1),c.br(qt,qt,[0,-c.al,0]),{u_matrix:qt,u_image:1,u_dimension:[Zt,Zt],u_zoom:Bt.overscaledZ}})(o.tileID,lt),_.id,mt,Tt,Ct),o.needsHillshadePrepare=!1}class Jo{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class o2 extends Jo{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const _=this.current;(o.r!==_.r||o.g!==_.g||o.b!==_.b||o.a!==_.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class hw extends Jo{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class yv extends Jo{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class k0 extends Jo{getDefault(){return[!0,!0,!0,!0]}set(o){const _=this.current;(o[0]!==_[0]||o[1]!==_[1]||o[2]!==_[2]||o[3]!==_[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _v extends Jo{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class rx extends Jo{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ax extends Jo{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const _=this.current;(o.func!==_.func||o.ref!==_.ref||o.mask!==_.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Sy extends Jo{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const _=this.current;(o[0]!==_[0]||o[1]!==_[1]||o[2]!==_[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class jx extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;o?_.enable(_.STENCIL_TEST):_.disable(_.STENCIL_TEST),this.current=o,this.dirty=!1}}class dw extends Jo{getDefault(){return[0,1]}set(o){const _=this.current;(o[0]!==_[0]||o[1]!==_[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class vv extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;o?_.enable(_.DEPTH_TEST):_.disable(_.DEPTH_TEST),this.current=o,this.dirty=!1}}class fw extends Jo{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Px extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;o?_.enable(_.BLEND):_.disable(_.BLEND),this.current=o,this.dirty=!1}}class M0 extends Jo{getDefault(){const o=this.gl;return[o.ONE,o.ZERO,o.ONE,o.ZERO]}set(o){const _=this.current;(o[0]!==_[0]||o[1]!==_[1]||o[2]!==_[2]||o[3]!==_[3]||this.dirty)&&(this.gl.blendFuncSeparate(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class F0 extends Jo{getDefault(){return c.ao.transparent.toNonPremultipliedRenderColor(null)}set(o){const _=this.current;(o.r!==_.r||o.g!==_.g||o.b!==_.b||o.a!==_.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class bv extends Jo{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(o,o),this.current=o,this.dirty=!1)}}class L0 extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;o?_.enable(_.CULL_FACE):_.disable(_.CULL_FACE),this.current=o,this.dirty=!1}}class Ty extends Jo{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class pw extends Jo{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}let mw=class extends Jo{getDefault(){return null}set(et){(et!==this.current||this.dirty)&&(this.gl.useProgram(et),this.current=et,this.dirty=!1)}};class gw extends Jo{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ix extends Jo{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const _=this.current;(o[0]!==_[0]||o[1]!==_[1]||o[2]!==_[2]||o[3]!==_[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class xw extends Jo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.bindFramebuffer(_.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class a2 extends Jo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.bindRenderbuffer(_.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class l2 extends Jo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.bindTexture(_.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class c2 extends Jo{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.bindBuffer(_.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class wv extends Jo{getDefault(){return null}set(o){const _=this.gl;_.bindBuffer(_.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Ev extends Jo{getDefault(){return null}set(o){this.gl&&(o!==this.current||this.dirty)&&(this.gl.bindVertexArray(o),this.current=o,this.dirty=!1)}}class Sv extends Jo{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Tv extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class yw extends Jo{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const _=this.gl;_.pixelStorei(_.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class D0 extends Jo{constructor(o,_){super(o),this.context=o,this.parent=_}getDefault(){return null}}class N0 extends D0{constructor(o,_,rt=0){super(o,_),this.attachmentPoint=o.gl.COLOR_ATTACHMENT0+rt}setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferTexture2D(_.FRAMEBUFFER,this.attachmentPoint,_.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class kx extends D0{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferRenderbuffer(_.FRAMEBUFFER,this.attachment(),_.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Ry extends D0{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const _=this.gl;_.framebufferTexture2D(_.FRAMEBUFFER,this.attachment(),_.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class _w extends kx{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const _f=(et,o,_,rt)=>({u_matrix:et,u_image0:0,u_image1:1,u_skirt_height:o,u_ground_shadow_factor:_,u_emissive_texture_available:rt}),z0=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr)=>({u_proj_matrix:Float32Array.from(et),u_globe_matrix:o,u_normalize_matrix:Float32Array.from(rt),u_merc_matrix:_,u_zoom_transition:ot,u_merc_center:lt,u_image0:0,u_image1:1,u_frustum_tl:ut,u_frustum_tr:dt,u_frustum_br:mt,u_frustum_bl:Tt,u_globe_pos:Ct,u_globe_radius:Ut,u_viewport:Bt,u_grid_matrix:sr?Float32Array.from(sr):new Float32Array(9),u_skirt_height:$t,u_far_z_cutoff:Zt,u_emissive_texture_available:qt});function Cy(et,o){return et!=null&&o!=null&&!(!et.hasData()||!o.hasData())&&et.demTexture!=null&&o.demTexture!=null&&et.tileID.key!==o.tileID.key}const em=new class{constructor(){this.operations={}}newMorphing(et,o,_,rt,ot){if(et in this.operations){const lt=this.operations[et];lt.to.tileID.key!==_.tileID.key&&(lt.queued=_)}else this.operations[et]={startTime:rt,phase:0,duration:ot,from:o,to:_,queued:null}}getMorphValuesForProxy(et){if(!(et in this.operations))return null;const o=this.operations[et];return{from:o.from,to:o.to,phase:o.phase}}update(et){for(const o in this.operations){const _=this.operations[o];for(_.phase=(et-_.startTime)/_.duration;_.phase>=1||!this._validOp(_);)if(!this._nextOp(_,et)){delete this.operations[o];break}}}_nextOp(et,o){return!!et.queued&&(et.from=et.to,et.to=et.queued,et.queued=null,et.phase=0,et.startTime=o,!0)}_validOp(et){return et.from.hasData()&&et.to.hasData()}},O0={0:null,1:"TERRAIN_VERTEX_MORPHING"};function B0(et,o,_){if(o===0)return 0;const rt=o<1&&_===514?.25/o:1;return 6*Math.pow(1.5,22-et)*Math.max(o,1)*rt}function Rv(et,o){const _=1<<et.z;return!o&&(et.x===0||et.x===_-1)||et.y===0||et.y===_-1}function Mx(et,o){if(!et.style||!et.style.enable3dLights())return;const _=et.context,rt=_.gl;_.activeTexture.set(rt.TEXTURE1),o?o.bind(rt.LINEAR,rt.CLAMP_TO_EDGE):et.emptyTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)}const Ay=et=>({u_matrix:et});function jy(et,o,_,rt,ot){if(ot>0){const lt=c.o.now(),ut=(lt-et.timeAdded)/ot,dt=o?(lt-o.timeAdded)/ot:-1,mt=_.getSource(),Tt=rt.coveringZoomLevel({tileSize:mt.tileSize,roundZoom:mt.roundZoom}),Ct=!o||Math.abs(o.tileID.overscaledZ-Tt)>Math.abs(et.tileID.overscaledZ-Tt),Ut=Ct&&et.refreshedUponExpiration?1:c.aA(Ct?ut:1-dt,0,1);return o?{opacity:1,mix:1-Ut,isFading:ut<1}:{opacity:Ut,mix:0,isFading:ut<1}}return{opacity:1,mix:0,isFading:!1}}class V0 extends Xu{constructor(o){const _=ru("mock-dem",{type:"raster-dem",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,_){o.state="loaded",_(null)}}class Cv extends Xu{constructor(o){const _=ru("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},o.style.dispatcher,o.style);super("proxy",_,!1),_.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,_,rt){if(o.freezeTileCoverage)return;this.transform=o;const ot=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((lt,ut)=>{if(lt[ut.key]="",!this._tiles[ut.key]){const dt=new Ym(ut,this._source.tileSize*ut.overscaleFactor(),o.tileZoom,void 0,void 0,this._source.worldview);dt.state="loaded",this._tiles[ut.key]=dt}return lt},{});for(const lt in this._tiles)lt in ot||(this.freeFBO(lt),this._tiles[lt].unloadVectorData(),delete this._tiles[lt])}freeFBO(o){const _=this.proxyCachedFBO[o];if(_!==void 0){const rt=Object.values(_);this.renderCachePool.push(...rt),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Av extends c.aQ{constructor(o,_,rt){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=_,this.projMatrix=rt}}class jv extends c.bV{constructor(o,_){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[rt,ot,lt]=function(mt){const Tt=new c.bd,Ct=new c.b0,Ut=131;Tt.reserve(17161),Ct.reserve(33800);const Bt=c.al/128,$t=c.al+Bt/2,Zt=$t+Bt;for(let sr=-Bt;sr<Zt;sr+=Bt)for(let ir=-Bt;ir<Zt;ir+=Bt){const cr=ir<0||ir>$t||sr<0||sr>$t?24575:0,pr=c.aA(Math.round(ir),0,c.al),ur=c.aA(Math.round(sr),0,c.al);Tt.emplaceBack(pr+cr,ur)}const qt=(sr,ir)=>{const cr=ir*Ut+sr;Ct.emplaceBack(cr+1,cr,cr+Ut),Ct.emplaceBack(cr+Ut,cr+Ut+1,cr+1)};for(let sr=1;sr<129;sr++)for(let ir=1;ir<129;ir++)qt(ir,sr);return[0,129].forEach(sr=>{for(let ir=0;ir<130;ir++)qt(ir,sr),qt(sr,ir)}),[Tt,Ct,32768]}(),ut=o.context;this.gridBuffer=ut.createVertexBuffer(rt,c.bf.members),this.gridIndexBuffer=ut.createIndexBuffer(ot),this.gridSegments=c.bg.simpleSegment(0,0,rt.length,ot.length),this.gridNoSkirtSegments=c.bg.simpleSegment(0,0,rt.length,lt),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Cv(_.map),this.orthoMatrix=c.bC(),c.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,c.al,0,c.al,0,1);const dt=ut.gl;this._overlapStencilMode=new gn({func:dt.GEQUAL,mask:255},0,255,dt.KEEP,dt.KEEP,dt.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=_,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new V0(_.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),this._style=o,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(o,_,rt){if(o&&o.terrain){this._style!==o&&(this.style=o,this._evaluationZoom=void 0);const ot=o.terrain.properties,lt=o.terrain.drapeRenderMode===0,ut=o.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=c.o.now();const dt=o.terrain&&o.terrain.scope,mt=ot.get("source"),Tt=lt?this._mockSourceCache:o.getSourceCache(mt,dt);if(!Tt)return void c.w(`Couldn't find terrain source "${mt}".`);if(this.sourceCache=Tt,this._attenuationRange=o.terrain.getAttenuationRange(),this._exaggeration=ut?this.calculateExaggeration(_):ot.get("exaggeration"),!_.projection.requiresDraping&&ut&&this._exaggeration===0)return void this._disable();this.enabled=!0;const Ct=()=>{this.sourceCache.used&&c.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Ut=this.getScaledDemTileSize();this.sourceCache.update(_,Ut,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,Ct(),this._initializing=!0),Ct(),_.updateElevation(!0,rt),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(_),this._emptyDEMTextureDirty=!0,this._previousZoom=_.zoom}else this._disable()}calculateExaggeration(o){if(this._attenuationRange&&o.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(o.zoom);const _=this._previousCameraAltitude,rt=o.getFreeCameraOptions().position.z/o.pixelsPerMeter*o.worldSize;this._previousCameraAltitude=rt;const ot=_!=null?rt-_:Number.MAX_VALUE;if(Math.abs(ot)<2)return this._exaggeration;const lt=o.zoom,ut=this._style.terrain;if(!this._previousUpdateTimestamp)return ut.getExaggeration(lt);let dt=lt-this._previousZoom;const mt=this._previousUpdateTimestamp;let Tt=lt;this._evaluationZoom!=null&&(Tt=this._evaluationZoom,Math.abs(lt-Tt)>.5&&(dt=.5*(lt-Tt+dt)),dt*ot<0&&(Tt+=dt)),this._evaluationZoom=Tt;const Ct=ut.getExaggeration(Tt),Ut=Ct===ut.getExaggeration(Math.max(0,Tt-.1));if(Ut&&Math.abs(Ct-this._exaggeration)<.01)return Ct;let Bt=Math.min(.1,.00375*(this._updateTimestamp-mt));return(Ut||Ct<.1||Math.abs(dt)<1e-4)&&(Bt=Math.min(.2,4*Bt)),c.ak(this._exaggeration,Ct,Bt)}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(o){o.dataType==="source"&&o.coord?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._mergedSourceCaches)this._style._mergedSourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const _=this.proxySourceCache,rt=this.painter.transform;this._initializing&&(this._initializing=rt._centerAltitude===0&&this.getAtPointOrZero(c.ae.fromLngLat(rt.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const ot=this.proxyCoords=_.getIds().map(mt=>{const Tt=_.getTileByID(mt).tileID;return Tt.projMatrix=rt.calculateProjMatrix(Tt.toUnwrapped()),Tt});(function(mt,Tt){const Ct=Tt.transform.pointCoordinate(Tt.transform.getCameraPoint()),Ut=new c.P(Ct.x,Ct.y);mt.sort((Bt,$t)=>{if($t.overscaledZ-Bt.overscaledZ)return $t.overscaledZ-Bt.overscaledZ;const Zt=new c.P(Bt.canonical.x+(1<<Bt.canonical.z)*Bt.wrap,Bt.canonical.y),qt=new c.P($t.canonical.x+(1<<$t.canonical.z)*$t.wrap,$t.canonical.y),sr=Ut.mult(1<<Bt.canonical.z);return sr.x-=.5,sr.y-=.5,sr.distSqr(Zt)-sr.distSqr(qt)})})(ot,this.painter);const lt=this.proxyToSource||{};this.proxyToSource={},ot.forEach(mt=>{this.proxyToSource[mt.key]={}}),this.terrainTileForTile={};const ut=this._style._mergedSourceCaches;for(const mt in ut){const Tt=ut[mt];if(!Tt.used||(Tt!==this.sourceCache&&this.resetTileLookupCache(Tt.id),this._setupProxiedCoordsForOrtho(Tt,o[mt],lt),Tt.usedForTerrain))continue;const Ct=o[mt];Tt.getSource().reparseOverscaled&&this._assignTerrainTiles(Ct)}this.proxiedCoords[_.id]=ot.map(mt=>new Av(mt,mt.key,this.orthoMatrix)),this._assignTerrainTiles(ot),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(lt),this.renderingToTexture=!1;const dt={};this._visibleDemTiles=[];for(const mt of this.proxyCoords){const Tt=this.terrainTileForTile[mt.key];if(!Tt)continue;const Ct=Tt.tileID.key;Ct in dt||(this._visibleDemTiles.push(Tt),dt[Ct]=Ct)}}_assignTerrainTiles(o){this._initializing||o.forEach(_=>{if(this.terrainTileForTile[_.key])return;const rt=this._findTileCoveringTileID(_,this.sourceCache);rt&&(this.terrainTileForTile[_.key]=rt)})}_prepareDEMTextures(){const o=this.painter.context,_=o.gl;for(const rt in this.terrainTileForTile){const ot=this.terrainTileForTile[rt],lt=ot.dem;!lt||ot.demTexture&&!ot.needsDEMTextureUpload||(o.activeTexture.set(_.TEXTURE1),xv(this.painter,ot,lt))}}_prepareDemTileUniforms(o,_,rt,ot){if(!_||_.demTexture==null)return!1;const lt=o.tileID.canonical,ut=Math.pow(2,_.tileID.canonical.z-lt.z),dt=ot||"";return rt[`u_dem_tl${dt}`]=[lt.x*ut%1,lt.y*ut%1],rt[`u_dem_scale${dt}`]=ut,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let o=0;const _=this._visibleDemTiles.reduce((rt,ot)=>{if(!ot.dem)return rt;const lt=ot.dem.tree.minimums[0];return lt>0&&o++,rt+lt},0);return o?_/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,_=o.gl;o.activeTexture.set(_.TEXTURE2);const rt=this._getLoadedAreaMinimum(),ot=new c.dL({width:1,height:1},new Float32Array([rt]));this._emptyDEMTextureDirty=!1;let lt=this._emptyDEMTexture;return lt?lt.update(ot,{premultiply:!1}):lt=this._emptyDEMTexture=new c.T(o,ot,_.R32F,{premultiply:!1}),lt}setupElevationDraw(o,_,rt){const ot=this.painter.context,lt=ot.gl,ut={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};ut.u_exaggeration=this.exaggeration();let dt=null,mt=null,Tt=1;if(rt&&rt.morphing&&this._useVertexMorphing){const $t=rt.morphing.srcDemTile,Zt=rt.morphing.dstDemTile;Tt=rt.morphing.phase,$t&&Zt&&(this._prepareDemTileUniforms(o,$t,ut,"_prev")&&(mt=$t),this._prepareDemTileUniforms(o,Zt,ut)&&(dt=Zt))}const Ct=$t=>$t&&$t.demTexture&&this.painter.linearFloatFilteringSupported()?lt.LINEAR:lt.NEAREST;let Ut=null;var Bt;if(this.enabled?mt&&dt?(Ut=dt.demTexture,ot.activeTexture.set(lt.TEXTURE4),mt.demTexture.bind(Ct(mt),lt.CLAMP_TO_EDGE),ut.u_dem_lerp=Tt):(dt=this.terrainTileForTile[o.tileID.key],Ut=this._prepareDemTileUniforms(o,dt,ut)?dt.demTexture:this.emptyDEMTexture):Ut=this.emptyDEMTexture,ot.activeTexture.set(lt.TEXTURE2),Ut&&(ut.u_dem_size=(Bt=Ut).size[0]===1?1:Bt.size[0]-2,Ut.bind(Ct(dt),lt.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(rt&&rt.useDepthForOcclusion,_,ut),rt&&rt.useMeterToDem&&dt){const $t=(1<<dt.tileID.canonical.z)*c.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;ut.u_meter_to_dem=$t}if(rt&&rt.labelPlaneMatrixInv&&(ut.u_label_plane_matrix_inv=rt.labelPlaneMatrixInv),_.setTerrainUniformValues(ot,ut),this.painter.transform.projection.name==="globe"){const $t=this.globeUniformValues(this.painter.transform,o.tileID.canonical,rt&&rt.useDenormalizedUpVectorScale);_.setGlobeUniformValues(ot,$t)}}globeUniformValues(o,_,rt){const ot=o.projection;return{u_tile_tl_up:ot.upVector(_,0,0),u_tile_tr_up:ot.upVector(_,c.al,0),u_tile_br_up:ot.upVector(_,c.al,c.al),u_tile_bl_up:ot.upVector(_,0,c.al),u_tile_up_scale:rt?c.dM(1):ot.upVectorScale(_,o.center.lat,o.worldSize).metersToTile}}renderToBackBuffer(o){const _=this.painter,rt=this.painter.context;o.length!==0&&(rt.bindFramebuffer.set(null),rt.viewport.set([0,0,_.width,_.height]),_.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ot,lt,ut,dt,mt){if(ot.transform.projection.name==="globe")(function(Tt,Ct,Ut,Bt,$t){const Zt=Tt.context,qt=Zt.gl;let sr,ir;const cr=Tt.transform,pr=c.dE(Tt,Zt,cr),ur=(ts,rs)=>{if(ir===rs)return;const cs=[O0[rs],"PROJECTION_GLOBE_VIEW"];pr&&cs.push("CUSTOM_ANTIALIASING");const Ss=Tt.isTileAffectedByFog(ts);sr=Tt.getOrCreateProgram("globeRaster",{defines:cs,overrideFog:Ss}),ir=rs},Cr=Tt.colorModeForRenderPass(),wr=new tn(qt.LEQUAL,tn.ReadWrite,Tt.depthRangeFor3D);em.update($t);const Tr=c.dF(cr),br=[c.aF(cr.center.lng),c.aJ(cr.center.lat)],yr=Tt.globeSharedBuffers,Pr=[cr.width*c.o.devicePixelRatio,cr.height*c.o.devicePixelRatio],Or=Float32Array.from(cr.globeMatrix),Nr={useDenormalizedUpVectorScale:!0};{const ts=Tt.transform,rs=B0(ts.zoom,Ct.exaggeration(),Ct.sourceCache._source.tileSize);ir=-1;const cs=qt.TRIANGLES;for(const Ss of Bt){const Zr=Ut.getTile(Ss),Fr=gn.disabled,ns=Ct.prevTerrainTileForTile[Ss.key],Qr=Ct.terrainTileForTile[Ss.key];Cy(ns,Qr)&&em.newMorphing(Ss.key,ns,Qr,$t,250),Mx(Tt,Zr.emissiveTexture),Zt.activeTexture.set(qt.TEXTURE0),Zr.texture&&Zr.texture.bind(qt.LINEAR,qt.CLAMP_TO_EDGE);const gs=em.getMorphValuesForProxy(Ss.key),ks=gs?1:0;gs&&Object.assign(Nr,{morphing:{srcDemTile:gs.from,dstDemTile:gs.to,phase:c.dD(gs.phase)}});const Bs=c.dG(Ss.canonical),js=c.dH(Bs.getCenter().lat),Ts=c.dI(Ss.canonical,Bs,js,ts.worldSize/ts._pixelsPerMercatorPixel),Js=c.bk(c.dJ(Ss.canonical)),Ks=Tt.emissiveMode==="mrt-fallback"?1:0,Ns=z0(ts.expandedFarZProjMatrix,Or,Tr,Js,c.aj(ts.zoom),br,ts.frustumCorners.TL,ts.frustumCorners.TR,ts.frustumCorners.BR,ts.frustumCorners.BL,ts.globeCenterInViewSpace,ts.globeRadius,Pr,rs,ts._farZ,Ks,Ts);if(ur(Ss,ks),sr&&(Ct.setupElevationDraw(Zr,sr,Nr),Tt.uploadCommonUniforms(Zt,sr,Ss.toUnwrapped()),yr)){const[Gs,ln,En]=yr.getGridBuffers(js,rs!==0);sr.draw(Tt,cs,wr,Fr,Cr,mn.backCCW,Ns,"globe_raster",Gs,ln,En)}}}if(yr&&(Tt.renderDefaultNorthPole||Tt.renderDefaultSouthPole)){const ts=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];pr&&ts.push("CUSTOM_ANTIALIASING"),sr=Tt.getOrCreateProgram("globeRaster",{defines:ts});for(const rs of Bt){const{x:cs,y:Ss,z:Zr}=rs.canonical,Fr=Ss===0,ns=Ss===(1<<Zr)-1,[Qr,gs,ks,Bs]=yr.getPoleBuffers(Zr,!1);if(Bs&&(Fr||ns)){const js=Ut.getTile(rs);Mx(Tt,js.emissiveTexture),Zt.activeTexture.set(qt.TEXTURE0),js.texture&&js.texture.bind(qt.LINEAR,qt.CLAMP_TO_EDGE);let Ts=c.dK(Zr,cs,cr);const Js=c.bk(c.dJ(rs.canonical)),Ks=Tt.emissiveMode==="mrt-fallback"?1:0,Ns=(Gs,ln)=>Gs.draw(Tt,qt.TRIANGLES,wr,gn.disabled,Cr,mn.disabled,z0(cr.expandedFarZProjMatrix,Ts,Ts,Js,0,br,cr.frustumCorners.TL,cr.frustumCorners.TR,cr.frustumCorners.BR,cr.frustumCorners.BL,cr.globeCenterInViewSpace,cr.globeRadius,Pr,0,cr._farZ,Ks),"globe_pole_raster",ln,ks,Bs);Ct.setupElevationDraw(js,sr,Nr),Tt.uploadCommonUniforms(Zt,sr,rs.toUnwrapped()),Fr&&Tt.renderDefaultNorthPole&&Ns(sr,Qr),ns&&Tt.renderDefaultSouthPole&&(Ts=c.cS(c.bC(),Ts,[1,-1,1]),Ns(sr,gs))}}}})(ot,lt,ut,dt,mt);else{const Tt=ot.context,Ct=Tt.gl;let Ut,Bt;const $t=ot.shadowRenderer,Zt=Cm(ot,ot.longestCutoffRange),qt=Cr=>{if(Bt===Cr)return;const wr=[];wr.push(O0[Cr]),Zt.shouldRenderCutoff&&wr.push("RENDER_CUTOFF"),$t&&(wr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$t.useNormalOffset&&wr.push("NORMAL_OFFSET")),Ut=ot.getOrCreateProgram("terrainRaster",{defines:wr}),Bt=Cr},sr=ot.colorModeForRenderPass(),ir=new tn(Ct.LEQUAL,tn.ReadWrite,ot.depthRangeFor3D);em.update(mt);const cr=ot.transform,pr=B0(cr.zoom,lt.exaggeration(),lt.sourceCache._source.tileSize);let ur=[0,0,0];if($t){const Cr=ot.style.directionalLight,wr=ot.style.ambientLight;Cr&&wr&&(ur=Jp(ot.style,Cr,wr))}{Bt=-1;const Cr=Ct.TRIANGLES,[wr,Tr]=[lt.gridIndexBuffer,lt.gridSegments];for(const br of dt){const yr=ut.getTile(br),Pr=gn.disabled,Or=lt.prevTerrainTileForTile[br.key],Nr=lt.terrainTileForTile[br.key];Cy(Or,Nr)&&em.newMorphing(br.key,Or,Nr,mt,250),Mx(ot,yr.emissiveTexture),Tt.activeTexture.set(Ct.TEXTURE0),yr.texture&&yr.texture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE);const ts=em.getMorphValuesForProxy(br.key),rs=ts?1:0;let cs;ts&&(cs={morphing:{srcDemTile:ts.from,dstDemTile:ts.to,phase:c.dD(ts.phase)}});const Ss=ot.emissiveMode==="mrt-fallback"?1:0,Zr=_f(br.projMatrix,Rv(br.canonical,cr.renderWorldCopies)?pr/10:pr,ur,Ss);if(qt(rs),!Ut)continue;lt.setupElevationDraw(yr,Ut,cs);const Fr=br.toUnwrapped();$t&&$t.setupShadows(Fr,Ut),ot.uploadCommonUniforms(Tt,Ut,Fr,null,Zt),Ut.draw(ot,Cr,ir,Pr,sr,mn.backCCW,Zr,"terrain_raster",lt.gridBuffer,wr,Tr)}}}}(_,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,_.gpuTimingDeferredRenderEnd(),o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const _=this.painter,rt=this.painter.context,ot=this.proxySourceCache,lt=this.proxiedCoords[ot.id],ut=this._drapedRenderBatches.shift(),dt=_.style.order,mt=[];this._updateFBOs(_.emissiveMode==="mrt-fallback");let Tt=0;for(const Ct of lt){const Ut=ot.getTileByID(Ct.proxyTileKey),Bt=ot.proxyCachedFBO[Ct.key]?ot.proxyCachedFBO[Ct.key][o]:void 0,$t=Bt!==void 0?ot.renderCache[Bt]:this.pool[Tt++],Zt=Bt!==void 0;if(Ut.texture=$t.tex,Ut.emissiveTexture=$t.emissiveTex,Zt&&!$t.dirty){mt.push(Ut.tileID);continue}rt.bindFramebuffer.set($t.fb.framebuffer);const qt=rt.gl;let sr;qt.drawBuffers(_.emissiveMode==="mrt-fallback"?[qt.COLOR_ATTACHMENT0,qt.COLOR_ATTACHMENT1]:[qt.COLOR_ATTACHMENT0]),this.renderedToTile=!1,$t.dirty&&(rt.clear({color:c.ao.transparent,stencil:0}),$t.dirty=!1);for(let ir=ut.start;ir<=ut.end;++ir){const cr=_.style._mergedLayers[dt[ir]];if(cr.isHidden(_.transform.zoom))continue;const pr=_.style.getLayerSourceCache(cr),ur=pr?this.proxyToSource[Ct.key][pr.id]:[Ct];if(!ur)continue;const Cr=ur;rt.viewport.set([0,0,$t.fb.width,$t.fb.height]),sr!==(pr?pr.id:null)&&(this._setupStencil($t,ur,cr,pr),sr=pr?pr.id:null),_.renderLayer(_,pr,cr,Cr)}if(qt.drawBuffers([qt.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const ir of this._pendingGroundEffectLayers){const cr=_.style._mergedLayers[dt[ir]];if(cr.isHidden(_.transform.zoom))continue;const pr=_.style.getLayerSourceCache(cr),ur=pr?this.proxyToSource[Ct.key][pr.id]:[Ct];if(!ur)continue;const Cr=ur;rt.viewport.set([0,0,$t.fb.width,$t.fb.height]),sr!==(pr?pr.id:null)&&(this._setupStencil($t,ur,cr,pr),sr=pr?pr.id:null),_.renderLayer(_,pr,cr,Cr)}this.renderedToTile?($t.dirty=!0,mt.push(Ut.tileID)):Zt||--Tt,Tt===5&&(Tt=0,this.renderToBackBuffer(mt))}return this.renderToBackBuffer(mt),this.renderingToTexture=!1,rt.bindFramebuffer.set(null),rt.viewport.set([0,0,_.width,_.height]),ut.end+1}postRender(){}isLayerOrderingCorrect(o){const _=o.order.length;let rt=-1,ot=_;for(let lt=0;lt<_;++lt)this._style.isLayerDraped(o._mergedLayers[o.order[lt]])?rt=Math.max(rt,lt):ot=Math.min(ot,lt);return ot>rt}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(_=>_.dem).forEach(_=>{o=Math.min(o,_.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,_,rt){if(!this._visibleDemTiles)return null;const ot=this._visibleDemTiles.filter(lt=>lt.dem).map(lt=>{const ut=lt.tileID,dt=1<<ut.overscaledZ,{x:mt,y:Tt}=ut.canonical,Ct=mt/dt,Ut=(mt+1)/dt,Bt=Tt/dt,$t=(Tt+1)/dt;return{minx:Ct,miny:Bt,maxx:Ut,maxy:$t,t:lt.dem.tree.raycastRoot(Ct,Bt,Ut,$t,o,_,rt),tile:lt}});ot.sort((lt,ut)=>(lt.t!==null?lt.t:Number.MAX_VALUE)-(ut.t!==null?ut.t:Number.MAX_VALUE));for(const lt of ot){if(lt.t==null)return null;const ut=lt.tile.dem.tree.raycast(lt.minx,lt.miny,lt.maxx,lt.maxy,o,_,rt);if(ut!=null)return ut}return null}_createFBO(){const o=this.painter.context,_=o.gl,rt=this.drapeBufferSize;o.activeTexture.set(_.TEXTURE0);const ot=new c.T(o,{width:rt[0],height:rt[1],data:null},_.RGBA8);ot.bind(_.LINEAR,_.CLAMP_TO_EDGE);const lt=o.createFramebuffer(rt[0],rt[1],1,null);let ut;return lt.colorAttachment0.set(ot.texture),this._emissiveTexture&&(ut=new c.T(o,{width:rt[0],height:rt[1],data:null},_.R8),ut.bind(_.LINEAR,_.CLAMP_TO_EDGE),lt.createColorAttachment(o,1),lt.colorAttachment1.set(ut.texture)),lt.depthAttachment=new _w(o,lt.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,rt[0],rt[1]),this._stencilRef=0,lt.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):lt.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:lt,tex:ot,emissiveTex:ut,dirty:!1}}_updateFBOs(o){if(this._emissiveTexture!==o){for(const _ of this.pool)this._updateFBO(_,o);for(const _ of this.proxySourceCache.renderCache)this._updateFBO(_,o);this._emissiveTexture=o}}_updateFBO(o,_){const rt=o.fb,ot=this.painter.context,lt=ot.gl,ut=this.drapeBufferSize;if(_){const dt=new c.T(ot,{width:ut[0],height:ut[1],data:null},lt.R8);dt.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),o.emissiveTex=dt,rt.createColorAttachment(ot,1),rt.colorAttachment1.set(dt.texture)}else o.emissiveTex=void 0,rt.removeColorAttachment(ot,1);o.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const o in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const _=this._style._mergedLayers[o],rt=_.isHidden(this.painter.transform.zoom);return _.type==="hillshade"||_.type==="custom"?!rt&&_.shouldRedrape():!rt&&_.hasTransition()})}_clearLineLayersFromRenderCache(){let o=!1;for(const rt of this._style.getSources())if(rt instanceof Zm){o=!0;break}if(!o)return;const _={};for(let rt=0;rt<this._style.order.length;++rt){const ot=this._style._mergedLayers[this._style.order[rt]],lt=this._style.getLayerSourceCache(ot);if(!lt||_[lt.id]||ot.isHidden(this.painter.transform.zoom)||ot.type!=="line")continue;const ut=ot.widthExpression(),dt=ot.emissiveStrengthExpression();if(ut instanceof c.ad||dt instanceof c.ad){_[lt.id]=!0;for(const mt of this.proxyCoords){const Tt=this.proxyToSource[mt.key][lt.id];if(Tt)for(const Ct of Tt)this._clearRenderCacheForTile(lt.id,Ct)}}}}_clearRasterLayersFromRenderCache(){let o=!1;for(const rt in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[rt]._source instanceof uu){o=!0;break}if(!o)return;const _={};for(let rt=0;rt<this._style.order.length;++rt){const ot=this._style._mergedLayers[this._style.order[rt]],lt=this._style.getLayerSourceCache(ot);if(!lt||_[lt.id]||ot.isHidden(this.painter.transform.zoom)||ot.type!=="raster")continue;const ut=ot.paint.get("raster-fade-duration");for(const dt of this.proxyCoords){const mt=this.proxyToSource[dt.key][lt.id];if(mt)for(const Tt of mt){const Ct=jy(lt.getTile(Tt),lt.findLoadedParent(Tt,0),lt,this.painter.transform,ut);(Ct.opacity!==1||Ct.mix!==0)&&this._clearRenderCacheForTile(lt.id,Tt)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const o=this._style.order,_=o.length;if(_===0)return;const rt=[];this._pendingGroundEffectLayers=[];let ot,lt=0,ut=this._style._mergedLayers[o[lt]];for(;!this._style.isLayerDraped(ut)&&ut.isHidden(this.painter.transform.zoom)&&++lt<_;)ut=this._style._mergedLayers[o[lt]];for(;lt<_;++lt){const dt=this._style._mergedLayers[o[lt]];dt.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(dt)?ot===void 0&&(ot=lt):(dt.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(lt),ot!==void 0&&(rt.push({start:ot,end:lt-1}),ot=void 0)))}if(ot!==void 0&&rt.push({start:ot,end:lt-1}),rt.length!==0){const dt=rt[rt.length-1];this._pendingGroundEffectLayers.every(mt=>mt>dt.end)||c.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=rt}_setupRenderCache(o){const _=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,_.renderCache.length>_.renderCachePool.length){const ut=Object.values(_.proxyCachedFBO);_.proxyCachedFBO={};for(let dt=0;dt<ut.length;++dt){const mt=Object.values(ut[dt]);_.renderCachePool.push(...mt)}}return}this._clearRasterLayersFromRenderCache();const rt=this.proxyCoords,ot=this._tilesDirty;for(let ut=rt.length-1;ut>=0;ut--){const dt=rt[ut];if(_.getTileByID(dt.key),_.proxyCachedFBO[dt.key]!==void 0){const mt=o[dt.key],Tt=this.proxyToSource[dt.key];let Ct=0;for(const Ut in Tt){const Bt=Tt[Ut],$t=mt[Ut];if(!$t||$t.length!==Bt.length||Bt.some((Zt,qt)=>Zt!==$t[qt]||ot[Ut]&&ot[Ut].hasOwnProperty(Zt.key))){Ct=-1;break}++Ct}for(const Ut in _.proxyCachedFBO[dt.key])_.renderCache[_.proxyCachedFBO[dt.key][Ut]].dirty=Ct<0||Ct!==Object.values(mt).length}}const lt=[...this._drapedRenderBatches];lt.sort((ut,dt)=>dt.end-dt.start-(ut.end-ut.start));for(const ut of lt)for(const dt of rt){if(_.proxyCachedFBO[dt.key])continue;let mt=_.renderCachePool.pop();mt===void 0&&_.renderCache.length<50&&(mt=_.renderCache.length,_.renderCache.push(this._createFBO())),mt!==void 0&&(_.proxyCachedFBO[dt.key]={},_.proxyCachedFBO[dt.key][ut.start]=mt,_.renderCache[mt].dirty=!0)}this._tilesDirty={}}_setupStencil(o,_,rt,ot){if(!ot||!this._sourceTilesOverlap[ot.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const lt=this.painter.context,ut=lt.gl;if(_.length<=1)return void(this._overlapStencilType=!1);let dt;if(rt.isTileClipped())dt=_.length,this._overlapStencilMode.test={func:ut.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(_[0].overscaledZ>_[_.length-1].overscaledZ))return void(this._overlapStencilType=!1);dt=1,this._overlapStencilMode.test={func:ut.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+dt>255&&(lt.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=dt,this._overlapStencilMode.ref=this._stencilRef,rt.isTileClipped()&&this._renderTileClippingMasks(_,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[o.key]),this._overlapStencilMode):gn.disabled}_renderTileClippingMasks(o,_){const rt=this.painter,ot=this.painter.context,lt=ot.gl;rt._tileClippingMaskIDs={},ot.setColorMode(jn.disabled),ot.setDepthMode(tn.disabled);const ut=rt.getOrCreateProgram("clippingMask");for(const dt of o){const mt=rt._tileClippingMaskIDs[dt.key]=--_;ut.draw(rt,lt.TRIANGLES,tn.disabled,new gn({func:lt.ALWAYS,mask:0},mt,255,lt.KEEP,lt.KEEP,lt.REPLACE),jn.disabled,mn.disabled,Ay(dt.projMatrix),"$clipping",rt.tileExtentBuffer,rt.quadTriangleIndexBuffer,rt.tileExtentSegments)}}pointCoordinate(o){const _=this.painter.transform;if(o.x<0||o.x>_.width||o.y<0||o.y>_.height)return null;const rt=[o.x,o.y,1,1];c.aC(rt,rt,_.pixelMatrixInverse),c.cK(rt,rt,1/rt[3]),rt[0]/=_.worldSize,rt[1]/=_.worldSize;const ot=_._camera.position,lt=c.cf(1,_.center.lat),ut=[ot[0],ot[1],ot[2]/lt,0],dt=c.da([],rt.slice(0,3),ut);c.aw(dt,dt);const mt=this.raycast(ut,dt,this._exaggeration);return mt!==null&&mt?(c.bH(ut,ut,dt,mt),ut[3]=ut[2],ut[2]*=lt,ut):null}_setupProxiedCoordsForOrtho(o,_,rt){if(o.getSource()instanceof c.aU)return this._setupProxiedCoordsForImageSource(o,_,rt);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const ot=this.proxiedCoords[o.id]=[],lt=this.proxyCoords;for(let mt=0;mt<lt.length;mt++){const Tt=lt[mt],Ct=this._findTileCoveringTileID(Tt,o);if(Ct){const Ut=this._createProxiedId(Tt,Ct,rt[Tt.key]&&rt[Tt.key][o.id]);ot.push(Ut),this.proxyToSource[Tt.key][o.id]=[Ut]}}let ut=!1;const dt=new Set;for(let mt=0;mt<_.length;mt++){const Tt=o.getTile(_[mt]);if(!Tt||!Tt.hasData())continue;const Ct=this._findTileCoveringTileID(Tt.tileID,this.proxySourceCache);if(Ct&&Ct.tileID.canonical.z!==Tt.tileID.canonical.z){const Ut=this.proxyToSource[Ct.tileID.key][o.id],Bt=this._createProxiedId(Ct.tileID,Tt,rt[Ct.tileID.key]&&rt[Ct.tileID.key][o.id]);Ut?Ut.splice(Ut.length-1,0,Bt):this.proxyToSource[Ct.tileID.key][o.id]=[Bt];const $t=this.proxyToSource[Ct.tileID.key][o.id];dt.has($t)||dt.add($t),ot.push(Bt),ut=!0}}if(this._sourceTilesOverlap[o.id]=ut,ut&&this._debugParams.sortTilesHiZFirst)for(const mt of dt)mt.sort((Tt,Ct)=>Ct.overscaledZ-Tt.overscaledZ)}_setupProxiedCoordsForImageSource(o,_,rt){if(!o.getSource().loaded())return;const ot=this.proxiedCoords[o.id]=[],lt=this.proxyCoords,ut=o.getSource(),dt=ut.tileID;if(!dt)return;const mt=new c.P(dt.x,dt.y)._div(1<<dt.z),Tt=ut.coordinates.map(c.ae.fromLngLat).reduce((Ut,Bt)=>(Ut.min.x=Math.min(Ut.min.x,Bt.x-mt.x),Ut.min.y=Math.min(Ut.min.y,Bt.y-mt.y),Ut.max.x=Math.max(Ut.max.x,Bt.x-mt.x),Ut.max.y=Math.max(Ut.max.y,Bt.y-mt.y),Ut),{min:new c.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Ct=(Ut,Bt)=>{const $t=Ut.wrap+Ut.canonical.x/(1<<Ut.canonical.z),Zt=Ut.canonical.y/(1<<Ut.canonical.z),qt=c.al/(1<<Ut.canonical.z),sr=Bt.wrap+Bt.canonical.x/(1<<Bt.canonical.z),ir=Bt.canonical.y/(1<<Bt.canonical.z);return $t+qt<sr+Tt.min.x||$t>sr+Tt.max.x||Zt+qt<ir+Tt.min.y||Zt>ir+Tt.max.y};for(let Ut=0;Ut<lt.length;Ut++){const Bt=lt[Ut];for(let $t=0;$t<_.length;$t++){const Zt=o.getTile(_[$t]);if(!Zt||!Zt.hasData()||Ct(Bt,Zt.tileID))continue;const qt=this._createProxiedId(Bt,Zt,rt[Bt.key]&&rt[Bt.key][o.id]),sr=this.proxyToSource[Bt.key][o.id];sr?sr.push(qt):this.proxyToSource[Bt.key][o.id]=[qt],ot.push(qt)}}}_createProxiedId(o,_,rt){let ot=this.orthoMatrix;if(rt){const lt=rt.find(ut=>ut.key===_.tileID.key);if(lt)return lt}if(_.tileID.key!==o.key){const lt=o.canonical.z-_.tileID.canonical.z;let ut,dt,mt;ot=c.bC();const Tt=_.tileID.wrap-o.wrap<<o.overscaledZ;lt>0?(ut=c.al>>lt,dt=ut*((_.tileID.canonical.x<<lt)-o.canonical.x+Tt),mt=ut*((_.tileID.canonical.y<<lt)-o.canonical.y)):(ut=c.al<<-lt,dt=c.al*(_.tileID.canonical.x-(o.canonical.x+Tt<<-lt)),mt=c.al*(_.tileID.canonical.y-(o.canonical.y<<-lt))),c.ce(ot,0,ut,0,ut,0,1),c.br(ot,ot,[dt,mt,0])}return new Av(_.tileID,o.key,ot)}_findTileCoveringTileID(o,_){let rt=_.getTile(o);if(rt&&rt.hasData())return rt;const ot=this._findCoveringTileCache[_.id],lt=ot[o.key];if(rt=lt?_.getTileByID(lt):null,rt&&rt.hasData()||lt===null)return rt;let ut=rt?rt.tileID:o,dt=ut.overscaledZ;const mt=_.getSource().minzoom,Tt=[];if(!lt){const Ut=_.getSource().maxzoom;if(o.canonical.z>=Ut){const Bt=o.canonical.z-Ut;_.getSource().reparseOverscaled?(dt=Math.max(o.canonical.z+2,_.transform.tileZoom),ut=new c.aQ(dt,o.wrap,Ut,o.canonical.x>>Bt,o.canonical.y>>Bt)):Bt!==0&&(dt=Ut,ut=new c.aQ(dt,o.wrap,Ut,o.canonical.x>>Bt,o.canonical.y>>Bt))}ut.key!==o.key&&(Tt.push(ut.key),rt=_.getTile(ut))}const Ct=Ut=>{Tt.forEach(Bt=>{ot[Bt]=Ut}),Tt.length=0};for(dt-=1;dt>=mt&&(!rt||!rt.hasData());dt--){rt&&Ct(rt.tileID.key);const Ut=ut.calculateScaledKey(dt);if(rt=_.getTileByID(Ut),rt&&rt.hasData())break;const Bt=ot[Ut];if(Bt===null)break;Bt===void 0?Tt.push(Ut):rt=_.getTileByID(Bt)}return Ct(rt?rt.tileID.key:null),rt&&rt.hasData()?rt:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,_){let rt=this._tilesDirty[o];rt||(rt=this._tilesDirty[o]={}),rt[_.key]=!0}}function Fx(et,o,_){const rt=function(dt,mt,Tt){const Ct=c.bJ(mt,dt),Ut=c.bJ(Tt,[.2126,.7152,.0722]),Bt=(Zt,qt,sr)=>(1-sr)*Zt+sr*qt,$t=Bt(1-.3*Math.min(Ut,1),1,Math.min(Ct+1,1));return Bt(.92,1,Math.asin(c.aA(mt[2],-1,1))/Math.PI+.5)*$t}(et,[0,0,1],o),ot=[0,0,0];c.c5(ot,_.slice(0,3),rt);const lt=[0,0,0];c.c5(lt,o.slice(0,3),et[2]);const ut=[0,0,0];return c.d8(ut,ot,lt),c.db(ut)}const u2=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],h2=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class bw{static cacheKey(o,_,rt,ot){const lt=[_];ot&&lt.push(ot.cacheKey);for(const ut of rt)o.usedDefines.has(ut)&&lt.push(ut);return lt.join("/")}constructor(o,_,rt,ot,lt,ut){const dt=o.gl;this.program=dt.createProgram(),this.configuration=ot,this.name=_,this.fixedDefines=[...ut];const mt=`#version 300 es
${(ot?ot.defines():[]).concat(ut.map(qt=>`#define ${qt}`)).join(`
`)}`,Tt=[mt,t2];for(const qt of rt.fragmentIncludes)Tt.push(Im[qt]);Tt.push(rt.fragmentSource);const Ct=Tt.join(`
`),Ut=[mt,uw];for(const qt of rt.vertexIncludes)Ut.push(Im[qt]);this.forceManualRenderingForInstanceIDShaders=o.forceManualRenderingForInstanceIDShaders&&rt.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Ut.push("uniform int u_instanceID;"),Ut.push(rt.vertexSource);let Bt=Ut.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(Bt=Bt.replaceAll("gl_InstanceID","u_instanceID"));const $t=dt.createShader(dt.FRAGMENT_SHADER);if(dt.isContextLost())return void(this.failedToCreate=!0);dt.shaderSource($t,Ct),dt.compileShader($t),dt.attachShader(this.program,$t);const Zt=dt.createShader(dt.VERTEX_SHADER);dt.isContextLost()?this.failedToCreate=!0:(dt.shaderSource(Zt,Bt),dt.compileShader(Zt),dt.attachShader(this.program,Zt),this.attributes={},dt.linkProgram(this.program),dt.deleteShader(Zt),dt.deleteShader($t),this.fixedUniforms=lt(o),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=ot?ot.getUniforms(o):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(qt=>({u_instanceID:new c.ch(qt)}))(o)),(ut.includes("TERRAIN")||_.includes("symbol")||_.includes("circle"))&&(this.terrainUniforms=(qt=>({u_dem:new c.ch(qt),u_dem_prev:new c.ch(qt),u_dem_tl:new c.ck(qt),u_dem_scale:new c.cj(qt),u_dem_tl_prev:new c.ck(qt),u_dem_scale_prev:new c.cj(qt),u_dem_size:new c.cj(qt),u_dem_lerp:new c.cj(qt),u_exaggeration:new c.cj(qt),u_depth:new c.ch(qt),u_depth_size_inv:new c.ck(qt),u_depth_range_unpack:new c.ck(qt),u_occluder_half_size:new c.cj(qt),u_occlusion_depth_offset:new c.cj(qt),u_meter_to_dem:new c.cj(qt),u_label_plane_matrix_inv:new c.cl(qt)}))(o)),ut.includes("GLOBE")&&(this.globeUniforms=(qt=>({u_tile_tl_up:new c.ci(qt),u_tile_tr_up:new c.ci(qt),u_tile_br_up:new c.ci(qt),u_tile_bl_up:new c.ci(qt),u_tile_up_scale:new c.cj(qt)}))(o)),ut.includes("FOG")&&(this.fogUniforms=(qt=>({u_fog_matrix:new c.cl(qt),u_fog_range:new c.ck(qt),u_fog_color:new c.d3(qt),u_fog_horizon_blend:new c.cj(qt),u_fog_vertical_limit:new c.ck(qt),u_fog_temporal_offset:new c.cj(qt),u_frustum_tl:new c.ci(qt),u_frustum_tr:new c.ci(qt),u_frustum_br:new c.ci(qt),u_frustum_bl:new c.ci(qt),u_globe_pos:new c.ci(qt),u_globe_radius:new c.cj(qt),u_globe_transition:new c.cj(qt),u_is_globe:new c.ch(qt),u_viewport:new c.ck(qt)}))(o)),ut.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(qt=>({u_cutoff_params:new c.d3(qt)}))(o)),ut.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(qt=>({u_lighting_ambient_color:new c.ci(qt),u_lighting_directional_dir:new c.ci(qt),u_lighting_directional_color:new c.ci(qt),u_ground_radiance:new c.ci(qt)}))(o)),ut.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(qt=>({u_light_matrix_0:new c.cl(qt),u_light_matrix_1:new c.cl(qt),u_fade_range:new c.ck(qt),u_shadow_normal_offset:new c.ci(qt),u_shadow_intensity:new c.cj(qt),u_shadow_texel_size:new c.cj(qt),u_shadow_map_resolution:new c.cj(qt),u_shadow_direction:new c.ci(qt),u_shadow_bias:new c.ci(qt),u_shadowmap_0:new c.ch(qt),u_shadowmap_1:new c.ch(qt)}))(o)))}getAttributeLocation(o,_){let rt=this.attributes[_];return rt===void 0&&(rt=this.attributes[_]=o.getAttribLocation(this.program,_)),rt}setTerrainUniformValues(o,_){if(!this.terrainUniforms)return;const rt=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const ot in _)rt[ot]&&rt[ot].set(this.program,ot,_[ot])}}setGlobeUniformValues(o,_){if(!this.globeUniforms)return;const rt=this.globeUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const ot in _)rt[ot]&&rt[ot].set(this.program,ot,_[ot])}}setFogUniformValues(o,_){if(!this.fogUniforms)return;const rt=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const ot in _)rt[ot].set(this.program,ot,_[ot])}}setCutoffUniformValues(o,_){if(!this.cutoffUniforms)return;const rt=this.cutoffUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const ot in _)rt[ot].set(this.program,ot,_[ot])}}setLightsUniformValues(o,_){if(!this.lightsUniforms)return;const rt=this.lightsUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const ot in _)rt[ot].set(this.program,ot,_[ot])}}setShadowUniformValues(o,_){if(this.failedToCreate||!this.shadowUniforms)return;const rt=this.shadowUniforms;o.program.set(this.program);for(const ot in _)rt[ot].set(this.program,ot,_[ot])}_drawDebugWireframe(o,_,rt,ot,lt,ut,dt,mt,Tt,Ct){const Ut=o.options.wireframe;if(Ut.terrain===!1&&Ut.layers2D===!1&&Ut.layers3D===!1)return;const Bt=o.context;if(!(!(!Ut.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Ut.layers2D||o._terrain&&o._terrain.renderingToTexture||!u2.includes(this.name))||!(!Ut.layers3D||!h2.includes(this.name))))return;const $t=Bt.gl,Zt=o.wireframeDebugCache.getLinesFromTrianglesBuffer(o.frameCounter,lt,Bt);if(!Zt)return;const qt=[...this.fixedDefines,"DEBUG_WIREFRAME"],sr=o.getOrCreateProgram(this.name,{config:this.configuration,defines:qt});Bt.program.set(sr.program);const ir=(ur,Cr,wr)=>{if(Cr[ur]&&wr[ur])for(const Tr in Cr[ur])wr[ur][Tr]&&wr[ur][Tr].set(wr.program,Tr,Cr[ur][Tr].current)};Tt&&Tt.setUniforms(sr.program,Bt,sr.binderUniforms,dt,{zoom:mt}),ir("fixedUniforms",this,sr),ir("terrainUniforms",this,sr),ir("globeUniforms",this,sr),ir("fogUniforms",this,sr),ir("lightsUniforms",this,sr),ir("shadowUniforms",this,sr),Zt.bind(),Bt.setColorMode(new jn([$t.ONE,$t.ONE_MINUS_SRC_ALPHA,$t.ZERO,$t.ONE],c.ao.transparent,[!0,!0,!0,!1])),Bt.setDepthMode(new tn(_.func===$t.LESS?$t.LEQUAL:_.func,tn.ReadOnly,_.range)),Bt.setStencilMode(gn.disabled);const cr=3*ut.primitiveLength*2,pr=3*ut.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ur=Ct||1;for(let Cr=0;Cr<ur;++Cr)sr.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Cr),$t.drawElements($t.LINES,cr,$t.UNSIGNED_SHORT,pr)}else Ct&&Ct>1?$t.drawElementsInstanced($t.LINES,cr,$t.UNSIGNED_SHORT,pr,Ct):$t.drawElements($t.LINES,cr,$t.UNSIGNED_SHORT,pr);lt.bind(),Bt.program.set(this.program),Bt.setDepthMode(_),Bt.setStencilMode(rt),Bt.setColorMode(ot)}checkUniforms(o,_,rt){if(this.fixedDefines.includes(_)){for(const ot of Object.keys(rt))if(!rt[ot].initialized)throw new Error(`Program '${this.name}', from draw '${o}': uniform ${ot} not set but required by ${_} being defined`)}}draw(o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr){const ir=o.context,cr=ir.gl;if(this.failedToCreate)return;ir.program.set(this.program),ir.setDepthMode(rt),ir.setStencilMode(ot),ir.setColorMode(lt),ir.setCullFace(ut);for(const[br,yr]of this.fixedUniformsEntries)yr.set(this.program,br,dt[br]);Zt&&Zt.setUniforms(this.program,ir,this.binderUniforms,Bt,{zoom:$t});const pr={[cr.POINTS]:1,[cr.LINES]:2,[cr.TRIANGLES]:3,[cr.LINE_STRIP]:1}[_];this.checkUniforms(mt,"RENDER_SHADOWS",this.shadowUniforms);const ur=qt||[],Cr=Zt?Zt.getPaintVertexBuffers():[],wr=_===cr.TRIANGLES&&Ct,Tr=sr&&sr>0?1:void 0;for(const br of Ut.get()){const yr=br.vaos||(br.vaos={});if((yr[mt]||(yr[mt]=new r2)).bind(ir,this,Tt,Cr,Ct,br.vertexOffset,ur,Tr),this.forceManualRenderingForInstanceIDShaders){const Pr=sr||1;for(let Or=0;Or<Pr;++Or)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Or),Ct?cr.drawElements(_,br.primitiveLength*pr,cr.UNSIGNED_SHORT,br.primitiveOffset*pr*2):cr.drawArrays(_,br.vertexOffset,br.vertexLength)}else sr&&sr>1?cr.drawElementsInstanced(_,br.primitiveLength*pr,cr.UNSIGNED_SHORT,br.primitiveOffset*pr*2,sr):Ct?cr.drawElements(_,br.primitiveLength*pr,cr.UNSIGNED_SHORT,br.primitiveOffset*pr*2):cr.drawArrays(_,br.vertexOffset,br.vertexLength);wr&&this._drawDebugWireframe(o,rt,ot,lt,Ct,br,Bt,$t,Zt,sr)}}}function ww(et,o,_=0){const rt=Math.pow(2,o.tileID.overscaledZ),ot=o.tileSize*Math.pow(2,et.transform.tileZoom)/rt,lt=ot*(o.tileID.canonical.x+o.tileID.wrap*rt),ut=ot*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture?o.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/c.ay(o,1,et.transform.tileZoom),u_pixel_coord_upper:[lt>>16,ut>>16],u_pixel_coord_lower:[65535&lt,65535&ut],u_pattern_transition:_}}const U0={terrain:0,flat:1},d2=c.bC(),$0=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir)=>{const cr=o.style.light,pr=cr.properties.get("position"),ur=[pr.x,pr.y,pr.z],Cr=c.dO();cr.properties.get("anchor")==="viewport"&&(c.dP(Cr,-o.transform.angle),c.dQ(ur,ur,Cr));const wr=cr.properties.get("color").toPremultipliedRenderColor(null),Tr=o.transform,br={u_matrix:et,u_lightpos:ur,u_lightintensity:cr.properties.get("intensity"),u_lightcolor:[wr.r,wr.g,wr.b],u_vertical_gradient:+_,u_opacity:rt,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:d2,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:U0[Tt],u_base_type:U0[Ct],u_ao:ot,u_edge_radius:lt,u_width_scale:ut,u_flood_light_color:Zt,u_vertical_scale:qt,u_flood_light_intensity:sr,u_ground_shadow_factor:ir};return Tr.projection.name==="globe"&&(br.u_tile_id=[dt.canonical.x,dt.canonical.y,1<<dt.canonical.z],br.u_zoom_transition=Ut,br.u_inv_rot_matrix=$t,br.u_merc_center=Bt,br.u_up_dir=Tr.projection.upVector(new c.cD(0,0,0),Bt[0]*c.al,Bt[1]*c.al),br.u_height_lift=mt),br},Pv=(et,o,_,rt,ot,lt)=>({u_matrix:et,u_edge_radius:o,u_width_scale:_,u_vertical_scale:rt,u_height_type:U0[ot],u_base_type:U0[lt]}),Ew=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir)=>{const cr=$0(et,o,_,rt,ot,lt,ut,dt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,1,[0,0,0]),pr={u_height_factor:-Math.pow(2,dt.overscaledZ)/mt.tileSize/8};return Object.assign(cr,ww(o,mt,ir),pr)},Lx=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct)=>({u_matrix:o,u_opacity:_,u_ao_pass:rt?1:0,u_meter_to_tile:ot,u_ao:lt,u_flood_light_intensity:ut,u_flood_light_color:dt,u_attenuation:mt,u_edge_radius:Tt,u_fb:0,u_fb_size:Ct,u_dynamic_offset:1}),Iv=(et,o,_)=>({u_matrix:et,u_emissive_strength:o,u_ground_shadow_factor:_}),kv=(et,o,_,rt,ot,lt=0)=>Object.assign(Iv(et,o,ot),ww(_,rt,lt)),Sw=(et,o,_,rt)=>({u_matrix:et,u_world:_,u_emissive_strength:o,u_ground_shadow_factor:rt}),Mv=(et,o,_,rt,ot,lt,ut=0)=>Object.assign(kv(et,o,_,rt,lt,ut),{u_world:ot}),Mm=(et,o)=>({u_matrix:et,u_ground_shadow_factor:o}),ix=(et,o,_,rt,ot)=>({u_matrix:et,u_camera_pos:[o[0],o[1],o[2]],u_depth_bias:_,u_height_scale:rt,u_reset_depth:ot}),G0=(et,o,_,rt,ot,lt,ut,dt,mt)=>({u_matrix:et,u_normal_matrix:o,u_opacity:_,u_faux_facade_ao_intensity:rt,u_camera_pos:ot,u_tile_to_meter:lt,u_facade_emissive_chance:ut,u_flood_light_color:dt,u_flood_light_intensity:mt}),Tw=et=>({u_matrix:et}),Fm=et=>({u_matrix:et}),Fv=(et,o,_,rt,ot,lt,ut,dt)=>{const mt=c.al/lt.tileSize;return{u_matrix:et,u_inv_rot_matrix:o,u_camera_to_center_distance:_.getCameraToCenterDistance(dt),u_extrude_scale:[_.pixelsToGLUnits[0]/mt,_.pixelsToGLUnits[1]/mt],u_zoom_transition:rt,u_tile_id:ut,u_merc_center:ot}},Py=(et,o,_=1)=>({u_matrix:et,u_color:o,u_overlay:0,u_overlay_scale:_}),Rw=c.bC(),Cw=(et,o,_,rt,ot,lt,ut)=>{const dt=et.transform,mt=dt.projection.name==="globe",Tt=mt?c.dR(dt.zoom,o.canonical)*dt._pixelsPerMercatorPixel:c.ay(_,1,lt),Ct={u_matrix:o.projMatrix,u_extrude_scale:Tt,u_intensity:ut,u_inv_rot_matrix:Rw,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(mt){Ct.u_inv_rot_matrix=rt,Ct.u_merc_center=ot,Ct.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],Ct.u_zoom_transition=c.aj(dt.zoom);const Ut=ot[0]*c.al,Bt=ot[1]*c.al;Ct.u_up_dir=dt.projection.upVector(new c.cD(0,0,0),Ut,Bt)}return Ct};function H0(et,[o,_,rt,ot],[lt,ut]){if(lt===ut)return[0,0,0,0];const dt=255*(et-1)/(et*(ut-lt));return[o*dt,_*dt,rt*dt,ot*dt]}function W0(et,o,[_,rt]){return _===rt?0:.5/et+(o-_)*(et-1)/(et*(rt-_))}const Aw=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr,ur)=>({u_matrix:et,u_normalize_matrix:o,u_globe_matrix:_,u_merc_matrix:rt,u_grid_matrix:ot,u_tl_parent:lt,u_scale_parent:Tt,u_fade_t:Ct.mix,u_opacity:Ct.opacity*Ut.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Ut.paint.get("raster-brightness-min"),u_brightness_high:Ut.paint.get("raster-brightness-max"),u_saturation_factor:c.dT(Ut.paint.get("raster-saturation")),u_contrast_factor:c.dS(Ut.paint.get("raster-contrast")),u_spin_weights:jw(Ut.paint.get("raster-hue-rotate")),u_perspective_transform:Bt,u_raster_elevation:$t,u_zoom_transition:ut,u_merc_center:dt,u_cutoff_params:mt,u_colorization_mix:H0(c.dU,qt,ir),u_colorization_offset:W0(c.dU,sr,ir),u_color_ramp:Zt,u_texture_offset:[pr/(cr+2*pr),cr/(cr+2*pr)],u_texture_res:[cr+2*pr,cr+2*pr],u_emissive_strength:ur});function jw(et){et*=Math.PI/180;const o=Math.sin(et),_=Math.cos(et);return[(2*_+1)/3,(-Math.sqrt(3)*o-_+1)/3,(Math.sqrt(3)*o-_+1)/3]}const Vp=.05,f2=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut)=>({u_matrix:et,u_normalize_matrix:o,u_globe_matrix:_,u_merc_matrix:rt,u_grid_matrix:ot,u_tl_parent:lt,u_scale_parent:Tt,u_fade_t:Ct.mix,u_opacity:Ct.opacity,u_image0:0,u_image1:1,u_raster_elevation:Ut,u_zoom_transition:ut,u_merc_center:dt,u_cutoff_params:mt}),p2=(et,o,_,rt,ot,lt,ut,dt,mt,Tt)=>({u_particle_texture:et,u_particle_texture_side_len:o,u_tile_offset:_,u_velocity:rt,u_color_ramp:lt,u_velocity_res:ot,u_max_speed:ut,u_uv_offset:dt,u_data_scale:[255*mt[0],255*mt[1]],u_data_offset:Tt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vp,Vp]}),Pw=(et,o,_,rt,ot,lt,ut,dt,mt,Tt)=>({u_particle_texture:et,u_particle_texture_side_len:o,u_velocity:_,u_velocity_res:rt,u_max_speed:ot,u_speed_factor:lt,u_reset_rate:ut,u_rand_seed:Math.random(),u_uv_offset:dt,u_data_scale:[255*mt[0],255*mt[1]],u_data_offset:Tt,u_particle_pos_scale:1.1,u_particle_pos_offset:[Vp,Vp]}),Iw=c.bC(),q0=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr,ur,Cr,wr,Tr)=>{const br=ot.transform,yr={u_is_size_zoom_constant:+(et==="constant"||et==="source"),u_is_size_feature_constant:+(et==="constant"||et==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:br.getCameraToCenterDistance(cr),u_rotate_symbol:+_,u_aspect_ratio:br.width/br.height,u_fade_change:ot.options.fadeDuration?ot.symbolFadeChange:1,u_matrix:lt,u_label_plane_matrix:ut,u_coord_matrix:dt,u_is_text:+Tt,u_elevation_from_sea:mt?1:0,u_pitch_with_map:+rt,u_texsize:Ct,u_texsize_icon:Ut,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Iw,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Iw,u_up_vector:[0,-1,0],u_color_adj_mat:Cr,u_icon_transition:wr||0,u_gamma_scale:rt?ot.transform.getCameraToCenterDistance(cr)*Math.cos(ot.terrain?0:ot.transform._pitch):1,u_device_pixel_ratio:c.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Tr||1,u_ground_shadow_factor:pr,u_inv_matrix:c.bl(c.bC(),ut),u_normal_scale:ur,u_lutTexture:hu.LUT};return cr.name==="globe"&&(yr.u_tile_id=[$t.canonical.x,$t.canonical.y,1<<$t.canonical.z],yr.u_zoom_transition=Zt,yr.u_inv_rot_matrix=sr,yr.u_merc_center=qt,yr.u_camera_forward=br._camera.forward(),yr.u_ecef_origin=c.dV(br.globeMatrix,$t.toUnwrapped()),yr.u_tile_matrix=Float32Array.from(br.globeMatrix),yr.u_up_vector=ir),yr},Iy=(et,o,_,rt)=>({u_matrix:et,u_emissive_strength:o,u_opacity:_,u_color:rt}),Lm=(et,o,_,rt,ot,lt,ut,dt,mt)=>Object.assign(function(Tt,Ct,Ut,Bt,$t,Zt){const{width:qt,height:sr}=Bt.imageManager.getPixelSize(Ct),ir=Math.pow(2,Zt.tileID.overscaledZ),cr=Zt.tileSize*Math.pow(2,Bt.transform.tileZoom)/ir,pr=cr*(Zt.tileID.canonical.x+Zt.tileID.wrap*ir),ur=cr*Zt.tileID.canonical.y;return{u_image:0,u_pattern_tl:Ut.tl,u_pattern_br:Ut.br,u_texsize:[qt,sr],u_pattern_size:Ut.displaySize,u_pattern_units_to_pixels:$t?[Bt.transform.width,-1*Bt.transform.height]:[1/c.ay(Zt,1,Bt.transform.tileZoom),1/c.ay(Zt,1,Bt.transform.tileZoom)],u_pixel_coord_upper:[pr>>16,ur>>16],u_pixel_coord_lower:[65535&pr,65535&ur]}}(0,lt,ut,rt,dt,mt),{u_matrix:et,u_emissive_strength:o,u_opacity:_}),Dx=new Float32Array(c.bA([])),sx=(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t=[0,0,0],Zt,qt,sr)=>{const ir=ot.style.light,cr=ir.properties.get("position"),pr=[-cr.x,-cr.y,cr.z],ur=c.dO();ir.properties.get("anchor")==="viewport"&&(c.dP(ur,-ot.transform.angle),c.dQ(pr,pr,ur));const Cr=Ct.alphaMode==="MASK",wr=ir.properties.get("color").toNonPremultipliedRenderColor(null),Tr=Bt.paint.get("model-ambient-occlusion-intensity"),br=Bt.paint.get("model-color").constantOr(c.ao.white).toNonPremultipliedRenderColor(null);return br.a=Bt.paint.get("model-color-mix-intensity").constantOr(0),sr&&(br.r=sr[0],br.g=sr[1],br.b=sr[2],br.a=sr[3]),qt&&(br.r=qt.color.r,br.g=qt.color.g,br.b=qt.color.b,br.a=qt.colorMix,Ut=qt.emissionStrength,lt*=qt.opacity),{u_matrix:et,u_lighting_matrix:o,u_normal_matrix:_,u_node_matrix:rt||Dx,u_lightpos:pr,u_lightintensity:ir.properties.get("intensity"),u_lightcolor:[wr.r,wr.g,wr.b],u_camera_pos:$t,u_opacity:lt,u_baseTextureIsAlpha:0,u_alphaMask:+Cr,u_alphaCutoff:Ct.alphaCutoff,u_baseColorFactor:ut.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:dt.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:mt,u_roughnessFactor:Tt,u_baseColorTexture:hu.BaseColor,u_metallicRoughnessTexture:hu.MetallicRoughness,u_normalTexture:hu.Normal,u_occlusionTexture:hu.Occlusion,u_emissionTexture:hu.Emission,u_lutTexture:hu.LUT,u_color_mix:br.toArray01(),u_aoIntensity:Tr,u_emissive_strength:Ut,u_occlusionTextureTransform:Zt||[0,0,0,0]}},Lv=(et,o=Dx,_=Dx)=>({u_matrix:et,u_instance:o,u_node_matrix:_}),Z0={fillExtrusion:et=>({u_matrix:new c.cl(et),u_lightpos:new c.ci(et),u_lightintensity:new c.cj(et),u_lightcolor:new c.ci(et),u_vertical_gradient:new c.cj(et),u_opacity:new c.cj(et),u_edge_radius:new c.cj(et),u_width_scale:new c.cj(et),u_ao:new c.ck(et),u_height_type:new c.ch(et),u_base_type:new c.ch(et),u_tile_id:new c.ci(et),u_zoom_transition:new c.cj(et),u_inv_rot_matrix:new c.cl(et),u_merc_center:new c.ck(et),u_up_dir:new c.ci(et),u_height_lift:new c.cj(et),u_flood_light_color:new c.ci(et),u_vertical_scale:new c.cj(et),u_flood_light_intensity:new c.cj(et),u_ground_shadow_factor:new c.ci(et)}),fillExtrusionDepth:et=>({u_matrix:new c.cl(et),u_edge_radius:new c.cj(et),u_width_scale:new c.cj(et),u_vertical_scale:new c.cj(et),u_height_type:new c.ch(et),u_base_type:new c.ch(et)}),fillExtrusionPattern:et=>({u_matrix:new c.cl(et),u_lightpos:new c.ci(et),u_lightintensity:new c.cj(et),u_lightcolor:new c.ci(et),u_vertical_gradient:new c.cj(et),u_height_factor:new c.cj(et),u_edge_radius:new c.cj(et),u_width_scale:new c.cj(et),u_ao:new c.ck(et),u_height_type:new c.ch(et),u_base_type:new c.ch(et),u_tile_id:new c.ci(et),u_zoom_transition:new c.cj(et),u_inv_rot_matrix:new c.cl(et),u_merc_center:new c.ck(et),u_up_dir:new c.ci(et),u_height_lift:new c.cj(et),u_image:new c.ch(et),u_texsize:new c.ck(et),u_pixel_coord_upper:new c.ck(et),u_pixel_coord_lower:new c.ck(et),u_tile_units_to_pixels:new c.cj(et),u_opacity:new c.cj(et),u_pattern_transition:new c.cj(et)}),fillExtrusionGroundEffect:et=>({u_matrix:new c.cl(et),u_opacity:new c.cj(et),u_ao_pass:new c.cj(et),u_meter_to_tile:new c.cj(et),u_ao:new c.ck(et),u_flood_light_intensity:new c.cj(et),u_flood_light_color:new c.ci(et),u_attenuation:new c.cj(et),u_edge_radius:new c.cj(et),u_fb:new c.ch(et),u_fb_size:new c.cj(et),u_dynamic_offset:new c.cj(et)}),fill:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_ground_shadow_factor:new c.ci(et)}),fillPattern:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_image:new c.ch(et),u_texsize:new c.ck(et),u_pixel_coord_upper:new c.ck(et),u_pixel_coord_lower:new c.ck(et),u_tile_units_to_pixels:new c.cj(et),u_ground_shadow_factor:new c.ci(et),u_pattern_transition:new c.cj(et)}),fillOutline:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_world:new c.ck(et),u_ground_shadow_factor:new c.ci(et)}),fillOutlinePattern:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_world:new c.ck(et),u_image:new c.ch(et),u_texsize:new c.ck(et),u_pixel_coord_upper:new c.ck(et),u_pixel_coord_lower:new c.ck(et),u_tile_units_to_pixels:new c.cj(et),u_ground_shadow_factor:new c.ci(et),u_pattern_transition:new c.cj(et)}),building:et=>({u_matrix:new c.cl(et),u_normal_matrix:new c.cl(et),u_opacity:new c.cj(et),u_faux_facade_ao_intensity:new c.cj(et),u_camera_pos:new c.ci(et),u_tile_to_meter:new c.cj(et),u_facade_emissive_chance:new c.cj(et),u_flood_light_color:new c.ci(et),u_flood_light_intensity:new c.cj(et)}),buildingBloom:et=>({u_matrix:new c.cl(et)}),buildingDepth:et=>({u_matrix:new c.cl(et)}),elevatedStructuresDepth:et=>({u_matrix:new c.cl(et),u_depth_bias:new c.cj(et)}),elevatedStructures:et=>({u_matrix:new c.cl(et),u_ground_shadow_factor:new c.ci(et)}),elevatedStructuresDepthReconstruct:et=>({u_matrix:new c.cl(et),u_camera_pos:new c.ci(et),u_depth_bias:new c.cj(et),u_height_scale:new c.cj(et),u_reset_depth:new c.cj(et)}),circle:c.dY,collisionBox:et=>({u_matrix:new c.cl(et),u_inv_rot_matrix:new c.cl(et),u_camera_to_center_distance:new c.cj(et),u_extrude_scale:new c.ck(et),u_zoom_transition:new c.cj(et),u_merc_center:new c.ck(et),u_tile_id:new c.ci(et)}),collisionCircle:et=>({u_matrix:new c.cl(et),u_inv_matrix:new c.cl(et),u_camera_to_center_distance:new c.cj(et),u_viewport_size:new c.ck(et)}),debug:et=>({u_color:new c.dB(et),u_matrix:new c.cl(et),u_overlay:new c.ch(et),u_overlay_scale:new c.cj(et)}),clippingMask:et=>({u_matrix:new c.cl(et)}),heatmap:et=>({u_extrude_scale:new c.cj(et),u_intensity:new c.cj(et),u_matrix:new c.cl(et),u_inv_rot_matrix:new c.cl(et),u_merc_center:new c.ck(et),u_tile_id:new c.ci(et),u_zoom_transition:new c.cj(et),u_up_dir:new c.ci(et)}),heatmapTexture:et=>({u_image:new c.ch(et),u_color_ramp:new c.ch(et),u_opacity:new c.cj(et)}),hillshade:et=>({u_matrix:new c.cl(et),u_image:new c.ch(et),u_latrange:new c.ck(et),u_light:new c.ck(et),u_shadow:new c.dB(et),u_highlight:new c.dB(et),u_emissive_strength:new c.cj(et),u_accent:new c.dB(et)}),hillshadePrepare:et=>({u_matrix:new c.cl(et),u_image:new c.ch(et),u_dimension:new c.ck(et),u_zoom:new c.cj(et)}),line:c.dX,linePattern:c.dW,raster:et=>({u_matrix:new c.cl(et),u_normalize_matrix:new c.cl(et),u_globe_matrix:new c.cl(et),u_merc_matrix:new c.cl(et),u_grid_matrix:new c.dC(et),u_tl_parent:new c.ck(et),u_scale_parent:new c.cj(et),u_fade_t:new c.cj(et),u_opacity:new c.cj(et),u_image0:new c.ch(et),u_image1:new c.ch(et),u_brightness_low:new c.cj(et),u_brightness_high:new c.cj(et),u_saturation_factor:new c.cj(et),u_contrast_factor:new c.cj(et),u_spin_weights:new c.ci(et),u_perspective_transform:new c.ck(et),u_raster_elevation:new c.cj(et),u_zoom_transition:new c.cj(et),u_merc_center:new c.ck(et),u_cutoff_params:new c.d3(et),u_colorization_mix:new c.d3(et),u_colorization_offset:new c.cj(et),u_color_ramp:new c.ch(et),u_texture_offset:new c.ck(et),u_texture_res:new c.ck(et),u_emissive_strength:new c.cj(et)}),rasterParticle:et=>({u_matrix:new c.cl(et),u_normalize_matrix:new c.cl(et),u_globe_matrix:new c.cl(et),u_merc_matrix:new c.cl(et),u_grid_matrix:new c.dC(et),u_tl_parent:new c.ck(et),u_scale_parent:new c.cj(et),u_fade_t:new c.cj(et),u_opacity:new c.cj(et),u_image0:new c.ch(et),u_image1:new c.ch(et),u_raster_elevation:new c.cj(et),u_zoom_transition:new c.cj(et),u_merc_center:new c.ck(et),u_cutoff_params:new c.d3(et)}),rasterParticleTexture:et=>({u_texture:new c.ch(et),u_opacity:new c.cj(et)}),rasterParticleDraw:et=>({u_particle_texture:new c.ch(et),u_particle_texture_side_len:new c.cj(et),u_tile_offset:new c.ck(et),u_velocity:new c.ch(et),u_color_ramp:new c.ch(et),u_velocity_res:new c.ck(et),u_max_speed:new c.cj(et),u_uv_offset:new c.ck(et),u_data_scale:new c.ck(et),u_data_offset:new c.cj(et),u_particle_pos_scale:new c.cj(et),u_particle_pos_offset:new c.ck(et)}),rasterParticleUpdate:et=>({u_particle_texture:new c.ch(et),u_particle_texture_side_len:new c.cj(et),u_velocity:new c.ch(et),u_velocity_res:new c.ck(et),u_max_speed:new c.cj(et),u_speed_factor:new c.cj(et),u_reset_rate:new c.cj(et),u_rand_seed:new c.cj(et),u_uv_offset:new c.ck(et),u_data_scale:new c.ck(et),u_data_offset:new c.cj(et),u_particle_pos_scale:new c.cj(et),u_particle_pos_offset:new c.ck(et)}),symbol:et=>({u_is_size_zoom_constant:new c.ch(et),u_is_size_feature_constant:new c.ch(et),u_size_t:new c.cj(et),u_size:new c.cj(et),u_camera_to_center_distance:new c.cj(et),u_rotate_symbol:new c.ch(et),u_aspect_ratio:new c.cj(et),u_fade_change:new c.cj(et),u_matrix:new c.cl(et),u_label_plane_matrix:new c.cl(et),u_coord_matrix:new c.cl(et),u_is_text:new c.ch(et),u_elevation_from_sea:new c.ch(et),u_pitch_with_map:new c.ch(et),u_texsize:new c.ck(et),u_texsize_icon:new c.ck(et),u_texture:new c.ch(et),u_texture_icon:new c.ch(et),u_gamma_scale:new c.cj(et),u_device_pixel_ratio:new c.cj(et),u_tile_id:new c.ci(et),u_zoom_transition:new c.cj(et),u_inv_rot_matrix:new c.cl(et),u_merc_center:new c.ck(et),u_camera_forward:new c.ci(et),u_tile_matrix:new c.cl(et),u_up_vector:new c.ci(et),u_ecef_origin:new c.ci(et),u_is_halo:new c.ch(et),u_icon_transition:new c.cj(et),u_color_adj_mat:new c.cl(et),u_scale_factor:new c.cj(et),u_ground_shadow_factor:new c.ci(et),u_inv_matrix:new c.cl(et),u_normal_scale:new c.cj(et),u_lutTexture:new c.ch(et)}),background:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_opacity:new c.cj(et),u_color:new c.dB(et)}),backgroundPattern:et=>({u_matrix:new c.cl(et),u_emissive_strength:new c.cj(et),u_opacity:new c.cj(et),u_image:new c.ch(et),u_pattern_tl:new c.ck(et),u_pattern_br:new c.ck(et),u_texsize:new c.ck(et),u_pattern_size:new c.ck(et),u_pixel_coord_upper:new c.ck(et),u_pixel_coord_lower:new c.ck(et),u_pattern_units_to_pixels:new c.ck(et)}),terrainRaster:et=>({u_matrix:new c.cl(et),u_image0:new c.ch(et),u_image1:new c.ch(et),u_skirt_height:new c.cj(et),u_ground_shadow_factor:new c.ci(et),u_emissive_texture_available:new c.cj(et)}),skybox:et=>({u_matrix:new c.cl(et),u_sun_direction:new c.ci(et),u_cubemap:new c.ch(et),u_opacity:new c.cj(et),u_temporal_offset:new c.cj(et)}),skyboxGradient:et=>({u_matrix:new c.cl(et),u_color_ramp:new c.ch(et),u_center_direction:new c.ci(et),u_radius:new c.cj(et),u_opacity:new c.cj(et),u_temporal_offset:new c.cj(et)}),skyboxCapture:et=>({u_matrix_3f:new c.dC(et),u_sun_direction:new c.ci(et),u_sun_intensity:new c.cj(et),u_color_tint_r:new c.d3(et),u_color_tint_m:new c.d3(et),u_luminance:new c.cj(et)}),globeRaster:et=>({u_proj_matrix:new c.cl(et),u_globe_matrix:new c.cl(et),u_normalize_matrix:new c.cl(et),u_merc_matrix:new c.cl(et),u_zoom_transition:new c.cj(et),u_merc_center:new c.ck(et),u_image0:new c.ch(et),u_image1:new c.ch(et),u_grid_matrix:new c.dC(et),u_skirt_height:new c.cj(et),u_far_z_cutoff:new c.cj(et),u_frustum_tl:new c.ci(et),u_frustum_tr:new c.ci(et),u_frustum_br:new c.ci(et),u_frustum_bl:new c.ci(et),u_globe_pos:new c.ci(et),u_globe_radius:new c.cj(et),u_viewport:new c.ck(et),u_emissive_texture_available:new c.cj(et)}),globeAtmosphere:et=>({u_frustum_tl:new c.ci(et),u_frustum_tr:new c.ci(et),u_frustum_br:new c.ci(et),u_frustum_bl:new c.ci(et),u_horizon:new c.cj(et),u_transition:new c.cj(et),u_fadeout_range:new c.cj(et),u_atmosphere_fog_color:new c.d3(et),u_high_color:new c.d3(et),u_space_color:new c.d3(et),u_temporal_offset:new c.cj(et),u_horizon_angle:new c.cj(et)}),model:et=>({u_matrix:new c.cl(et),u_lighting_matrix:new c.cl(et),u_normal_matrix:new c.cl(et),u_node_matrix:new c.cl(et),u_lightpos:new c.ci(et),u_lightintensity:new c.cj(et),u_lightcolor:new c.ci(et),u_camera_pos:new c.ci(et),u_opacity:new c.cj(et),u_baseColorFactor:new c.d3(et),u_emissiveFactor:new c.d3(et),u_metallicFactor:new c.cj(et),u_roughnessFactor:new c.cj(et),u_baseTextureIsAlpha:new c.ch(et),u_alphaMask:new c.ch(et),u_alphaCutoff:new c.cj(et),u_baseColorTexture:new c.ch(et),u_metallicRoughnessTexture:new c.ch(et),u_normalTexture:new c.ch(et),u_occlusionTexture:new c.ch(et),u_emissionTexture:new c.ch(et),u_lutTexture:new c.ch(et),u_color_mix:new c.d3(et),u_aoIntensity:new c.cj(et),u_emissive_strength:new c.cj(et),u_occlusionTextureTransform:new c.d3(et)}),modelDepth:et=>({u_matrix:new c.cl(et),u_instance:new c.cl(et),u_node_matrix:new c.cl(et)}),groundShadow:et=>({u_matrix:new c.cl(et),u_ground_shadow_factor:new c.ci(et)}),stars:et=>({u_matrix:new c.cl(et),u_up:new c.ci(et),u_right:new c.ci(et),u_intensity_multiplier:new c.cj(et)}),snowParticle:et=>({u_modelview:new c.cl(et),u_projection:new c.cl(et),u_time:new c.cj(et),u_cam_pos:new c.ci(et),u_velocityConeAperture:new c.cj(et),u_velocity:new c.cj(et),u_horizontalOscillationRadius:new c.cj(et),u_horizontalOscillationRate:new c.cj(et),u_boxSize:new c.cj(et),u_billboardSize:new c.cj(et),u_simpleShapeParameters:new c.ck(et),u_screenSize:new c.ck(et),u_thinningCenterPos:new c.ck(et),u_thinningShape:new c.ci(et),u_thinningAffectedRatio:new c.cj(et),u_thinningParticleOffset:new c.cj(et),u_particleColor:new c.d3(et),u_direction:new c.ci(et)}),rainParticle:et=>({u_modelview:new c.cl(et),u_projection:new c.cl(et),u_time:new c.cj(et),u_cam_pos:new c.ci(et),u_texScreen:new c.ch(et),u_velocityConeAperture:new c.cj(et),u_velocity:new c.cj(et),u_boxSize:new c.cj(et),u_rainDropletSize:new c.ck(et),u_distortionStrength:new c.cj(et),u_rainDirection:new c.ci(et),u_color:new c.d3(et),u_screenSize:new c.ck(et),u_thinningCenterPos:new c.ck(et),u_thinningShape:new c.ci(et),u_thinningAffectedRatio:new c.cj(et),u_thinningParticleOffset:new c.cj(et),u_shapeDirectionalPower:new c.cj(et),u_shapeNormalPower:new c.cj(et),u_mode:new c.cj(et)}),vignette:et=>({u_vignetteShape:new c.ci(et),u_vignetteColor:new c.d3(et)}),occlusion:et=>({u_matrix:new c.cl(et),u_anchorPos:new c.ci(et),u_screenSizePx:new c.ck(et),u_occluderSizePx:new c.ck(et),u_color:new c.d3(et)})};class Cp{constructor(o,_,rt,ot){this.id=Cp.uniqueIdxCounter,Cp.uniqueIdxCounter++,this.context=o;const lt=o.gl;this.buffer=lt.createBuffer(),this.dynamicDraw=!!rt,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),lt.bufferData(lt.ELEMENT_ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?lt.DYNAMIC_DRAW:lt.STATIC_DRAW),this.dynamicDraw||ot||_.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){this.id=Cp.uniqueIdxCounter,Cp.uniqueIdxCounter++;const _=this.context.gl;this.context.unbindVAO(),this.bind(),_.bufferSubData(_.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Cp.uniqueIdxCounter=0;const Dv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kw{constructor(o,_,rt,ot,lt,ut){this.length=_.length,this.attributes=rt,this.itemSize=_.bytesPerElement,this.dynamicDraw=ot,this.instanceCount=ut,this.context=o;const dt=o.gl;this.buffer=dt.createBuffer(),o.bindVertexBuffer.set(this.buffer),dt.bufferData(dt.ARRAY_BUFFER,_.arrayBuffer,this.dynamicDraw?dt.DYNAMIC_DRAW:dt.STATIC_DRAW),this.dynamicDraw||lt||_.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const _=this.context.gl;this.bind(),_.bufferSubData(_.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,_){for(let rt=0;rt<this.attributes.length;rt++){const ot=_.getAttributeLocation(o,this.attributes[rt].name);ot!==-1&&o.enableVertexAttribArray(ot)}}setVertexAttribPointers(o,_,rt){for(let ot=0;ot<this.attributes.length;ot++){const lt=this.attributes[ot],ut=_.getAttributeLocation(o,lt.name);ut!==-1&&o.vertexAttribPointer(ut,lt.components,o[Dv[lt.type]],!1,this.itemSize,lt.offset+this.itemSize*(rt||0))}}setVertexAttribDivisor(o,_,rt){for(let ot=0;ot<this.attributes.length;ot++){const lt=_.getAttributeLocation(o,this.attributes[ot].name);lt!==-1&&this.instanceCount&&this.instanceCount>0&&o.vertexAttribDivisor(lt,rt)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Mw{constructor(o,_,rt,ot,lt){this.context=o,this.width=_,this.height=rt;const ut=this.framebuffer=o.gl.createFramebuffer();ot>0&&(this.colorAttachment0=new N0(o,ut,0)),ot>1&&(this.colorAttachment1=new N0(o,ut,1)),lt&&(this.depthAttachmentType=lt,this.depthAttachment=lt==="renderbuffer"?new kx(o,ut):new Ry(o,ut))}createColorAttachment(o,_){_===0?this.colorAttachment0=new N0(o,this.framebuffer,0):_===1&&(this.colorAttachment1=new N0(o,this.framebuffer,1))}removeColorAttachment(o,_){const rt=this.context.gl;let ot;_===0?(ot=this.colorAttachment0.get(),this.colorAttachment0=void 0):_===1&&(ot=this.colorAttachment1.get(),this.colorAttachment1=void 0),ot&&rt.deleteTexture(ot)}destroy(){const o=this.context.gl;if(this.colorAttachment0){const _=this.colorAttachment0.get();_&&o.deleteTexture(_)}if(this.colorAttachment1){const _=this.colorAttachment1.get();_&&o.deleteTexture(_)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const _=this.depthAttachment.get();_&&o.deleteRenderbuffer(_)}else{const _=this.depthAttachment.get();_&&o.deleteTexture(_)}o.deleteFramebuffer(this.framebuffer)}}class Nx{constructor(o,_){this.gl=o,this.clearColor=new o2(this),this.clearDepth=new hw(this),this.clearStencil=new yv(this),this.colorMask=new k0(this),this.depthMask=new _v(this),this.stencilMask=new rx(this),this.stencilFunc=new Ax(this),this.stencilOp=new Sy(this),this.stencilTest=new jx(this),this.depthRange=new dw(this),this.depthTest=new vv(this),this.depthFunc=new fw(this),this.blend=new Px(this),this.blendFunc=new M0(this),this.blendColor=new F0(this),this.blendEquation=new bv(this),this.cullFace=new L0(this),this.cullFaceSide=new Ty(this),this.frontFace=new pw(this),this.program=new mw(this),this.activeTexture=new gw(this),this.viewport=new Ix(this),this.bindFramebuffer=new xw(this),this.bindRenderbuffer=new a2(this),this.bindTexture=new l2(this),this.bindVertexBuffer=new c2(this),this.bindElementBuffer=new wv(this),this.bindVertexArrayOES=new Ev(this),this.pixelStoreUnpack=new Sv(this),this.pixelStoreUnpackPremultiplyAlpha=new Tv(this),this.pixelStoreUnpackFlipY=new yw(this),this.options=_?Object.assign({},_):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=o.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=o.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=o.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=_&&!!_.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=o.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=o.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,_,rt){return new Cp(this,o,_,rt)}createVertexBuffer(o,_,rt,ot,lt){return new kw(this,o,_,rt,ot,lt)}createRenderbuffer(o,_,rt){const ot=this.gl,lt=ot.createRenderbuffer();return this.bindRenderbuffer.set(lt),ot.renderbufferStorage(ot.RENDERBUFFER,o,_,rt),this.bindRenderbuffer.set(null),lt}createFramebuffer(o,_,rt,ot){return new Mw(this,o,_,rt,ot)}clear({color:o,depth:_,stencil:rt,colorMask:ot}){const lt=this.gl;let ut=0;o&&(ut|=lt.COLOR_BUFFER_BIT,this.clearColor.set(o.toNonPremultipliedRenderColor(null)),this.colorMask.set(ot||[!0,!0,!0,!0])),_!==void 0&&(ut|=lt.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(_),this.depthMask.set(!0)),rt!==void 0&&(ut|=lt.STENCIL_BUFFER_BIT,this.clearStencil.set(rt),this.stencilMask.set(255)),lt.clear(ut)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){c.by(o.blendFunction,jn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor),o.blendEquation?this.blendEquation.set(o.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(o.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let nx;function Xs(et,o,_,rt,ot,lt,ut){const dt=et.context,mt=dt.gl,Tt=et.transform,Ct=[c.aF(Tt.center.lng),c.aJ(Tt.center.lat)],Ut=_.layout.get("symbol-placement"),Bt=_.layout.get("text-variable-anchor"),$t=_.layout.get("icon-rotation-alignment")==="map",Zt=_.layout.get("text-rotation-alignment")==="map",qt=Ut!=="point",sr=[];let ir=0,cr=0;for(let yr=0;yr<rt.length;yr++){const Pr=rt[yr],Or=o.getTile(Pr),Nr=Or.getBucket(_);if(!Nr)continue;const ts=Nr.getProjection().createInversionMatrix(Tt,Pr.canonical),rs=[],cs=m0(Pr,Nr,Tt),Ss=!ut&&$t&&qt,Zr=ut&&Zt&&qt,Fr=Bt&&Nr.hasTextData(),ns=Nr.hasIconTextFit()&&Fr&&Nr.hasIconData(),Qr=Ss||Zr||ut&&Fr||ns,gs=Nr.projection.name==="globe",ks=gs?c.aj(Tt.zoom):0;gs&&(rs.push("PROJECTION_GLOBE_VIEW"),Qr&&rs.push("PROJECTED_POS_ON_VIEWPORT"));const Bs=et.getOrCreateProgram("collisionBox",{defines:rs});let js=cs;ot[0]===0&&ot[1]===0||(js=et.translatePosMatrix(cs,Or,ot,lt));const Ts=ut?Nr.textCollisionBox:Nr.iconCollisionBox,Js=Nr.collisionCircleArray;if(Js.length>0){const Ns=c.bC(),Gs=js;c.cP(Ns,Nr.placementInvProjMatrix,Tt.glCoordMatrix),c.cP(Ns,Ns,Nr.placementViewportMatrix),sr.push({circleArray:Js,circleOffset:cr,transform:Gs,invTransform:Ns,projection:Nr.getProjection()}),ir+=Js.length/4,cr=ir}if(!Ts)continue;et.terrain&&et.terrain.setupElevationDraw(Or,Bs);const Ks=gs?[Pr.canonical.x,Pr.canonical.y,1<<Pr.canonical.z]:[0,0,0];Bs.draw(et,mt.LINES,tn.disabled,gn.disabled,et.colorModeForRenderPass(),mn.disabled,Fv(js,ts,Tt,ks,Ct,Or,Ks,Nr.getProjection()),_.id,Ts.layoutVertexBuffer,Ts.indexBuffer,Ts.segments,null,Tt.zoom,null,[Ts.collisionVertexBuffer,Ts.collisionVertexBufferExt])}if(!ut||!sr.length)return;const pr=et.getOrCreateProgram("collisionCircle"),ur=new c.dZ;ur.resize(4*ir),ur._trim();let Cr=0;for(const yr of sr)for(let Pr=0;Pr<yr.circleArray.length/4;Pr++){const Or=4*Pr,Nr=yr.circleArray[Or+0],ts=yr.circleArray[Or+1],rs=yr.circleArray[Or+2],cs=yr.circleArray[Or+3];ur.emplace(Cr++,Nr,ts,rs,cs,0),ur.emplace(Cr++,Nr,ts,rs,cs,1),ur.emplace(Cr++,Nr,ts,rs,cs,2),ur.emplace(Cr++,Nr,ts,rs,cs,3)}(!nx||nx.length<2*ir)&&(nx=function(yr){const Pr=2*yr,Or=new c.b0;Or.resize(Pr),Or._trim();for(let Nr=0;Nr<Pr;Nr++){const ts=6*Nr;Or.uint16[ts+0]=4*Nr+0,Or.uint16[ts+1]=4*Nr+1,Or.uint16[ts+2]=4*Nr+2,Or.uint16[ts+3]=4*Nr+2,Or.uint16[ts+4]=4*Nr+3,Or.uint16[ts+5]=4*Nr+0}return Or}(ir));const wr=dt.createIndexBuffer(nx,!0),Tr=dt.createVertexBuffer(ur,c.d_.members,!0);for(const yr of sr){const Pr={u_matrix:yr.transform,u_inv_matrix:yr.invTransform,u_camera_to_center_distance:(br=Tt).getCameraToCenterDistance(yr.projection),u_viewport_size:[br.width,br.height]};pr.draw(et,mt.TRIANGLES,tn.disabled,gn.disabled,et.colorModeForRenderPass(),mn.disabled,Pr,_.id,Tr,wr,c.bg.simpleSegment(0,2*yr.circleOffset,yr.circleArray.length,yr.circleArray.length/2),null,Tt.zoom)}var br;Tr.destroy(),wr.destroy()}const ky=c.bC();function tm(et){const o=et._camera.getWorldToCamera(et.worldSize,1),_=c.aB([],o,et.globeMatrix);c.bl(_,_);const rt=[0,0,0],ot=[0,1,0,0];return c.aC(ot,ot,_),rt[0]=ot[0],rt[1]=ot[1],rt[2]=ot[2],c.aw(rt,rt),rt}function Dm({width:et,height:o,anchor:_,textOffset:rt,textScale:ot},lt){const{horizontalAlign:ut,verticalAlign:dt}=c.c1(_),mt=-(ut-.5)*et,Tt=-(dt-.5)*o,Ct=c.c2(_,rt);return new c.P((mt/ot+Ct[0])*lt,(Tt/ot+Ct[1])*lt)}function un(et,o,_,rt,ot,lt,ut,dt,mt,Tt){const Ct=et.text.placedSymbolArray,Ut=et.text.dynamicLayoutVertexArray,Bt=et.icon.dynamicLayoutVertexArray,$t={},Zt=et.getProjection(),qt=Dp(ut,Zt,ot),sr=ot.elevation,ir=Zt.upVectorScale(ut.canonical,ot.center.lat,ot.worldSize).metersToTile;Ut.clear();for(let cr=0;cr<Ct.length;cr++){const pr=Ct.get(cr),{tileAnchorX:ur,tileAnchorY:Cr,numGlyphs:wr}=pr,Tr=pr.hidden||!pr.crossTileID||et.allowVerticalPlacement&&!pr.placedOrientation?null:rt[pr.crossTileID];if(Tr){let br=0,yr=0,Pr=0;const Or=et.elevationType==="road";if(sr||Or){const Qr=Or?et.getElevationFeatureForText(cr):null,gs=c.bV.getAtTileOffset(ut,new c.P(ur,Cr),sr,Qr),[ks,Bs,js]=Zt.upVector(ut.canonical,ur,Cr);br=gs*ks*ir,yr=gs*Bs*ir,Pr=gs*js*ir}let[Nr,ts,rs,cs]=up(pr.projectedAnchorX+br,pr.projectedAnchorY+yr,pr.projectedAnchorZ+Pr,_?qt:lt);const Ss=vo(ot.getCameraToCenterDistance(Zt),cs);let Zr=c.bM(et.textSizeData,mt,pr)*Ss/c.bY;_&&(Zr*=et.tilePixelRatio/dt);const Fr=Dm(Tr,Zr);_?({x:Nr,y:ts,z:rs}=Zt.projectTilePoint(ur+Fr.x,Cr+Fr.y,ut.canonical),[Nr,ts,rs]=up(Nr+br,ts+yr,rs+Pr,lt)):(o&&Fr._rotate(-ot.angle),Nr+=Fr.x,ts+=Fr.y,rs=0);const ns=et.allowVerticalPlacement&&pr.placedOrientation===c.bL.vertical?Math.PI/2:0;for(let Qr=0;Qr<wr;Qr++)c.bO(Ut,Nr,ts,rs,ns);Tt&&pr.associatedIconIndex>=0&&($t[pr.associatedIconIndex]={x:Nr,y:ts,z:rs,angle:ns})}else Sp(wr,Ut)}if(Tt){Bt.clear();const cr=et.icon.placedSymbolArray;for(let pr=0;pr<cr.length;pr++){const ur=cr.get(pr),{numGlyphs:Cr}=ur,wr=$t[pr];if(ur.hidden||!wr)Sp(Cr,Bt);else{const{x:Tr,y:br,z:yr,angle:Pr}=wr;for(let Or=0;Or<Cr;Or++)c.bO(Bt,Tr,br,yr,Pr)}}et.icon.dynamicLayoutVertexBuffer.updateData(Bt)}et.text.dynamicLayoutVertexBuffer.updateData(Ut)}function My(et,o,_,rt,ot,lt,ut={}){const dt=_.paint.get("icon-translate"),mt=_.paint.get("text-translate"),Tt=_.paint.get("icon-translate-anchor"),Ct=_.paint.get("text-translate-anchor"),Ut=_.layout.get("icon-rotation-alignment"),Bt=_.layout.get("text-rotation-alignment"),$t=_.layout.get("icon-pitch-alignment"),Zt=_.layout.get("text-pitch-alignment"),qt=_.layout.get("icon-keep-upright"),sr=_.layout.get("text-keep-upright"),ir=_.paint.get("icon-color-saturation"),cr=_.paint.get("icon-color-contrast"),pr=_.paint.get("icon-color-brightness-min"),ur=_.paint.get("icon-color-brightness-max"),Cr=_.layout.get("symbol-elevation-reference")==="sea",wr=_.layout.get("icon-image-use-theme")==="none",Tr=et.context,br=Tr.gl,yr=et.transform,Pr=Ut==="map",Or=Bt==="map",Nr=$t==="map",ts=Zt==="map",rs=_.layout.get("symbol-sort-key").constantOr(1)!==void 0;let cs=!1;const Ss=et.depthModeForSublayer(0,tn.ReadOnly),Zr=new tn(et.context.gl.LEQUAL,tn.ReadOnly,et.depthRangeFor3D),Fr=[c.aF(yr.center.lng),c.aJ(yr.center.lat)],ns=_.layout.get("text-variable-anchor"),Qr=yr.projection.name==="globe",gs=[],ks=[0,-1,0];for(const Bs of rt){const js=o.getTile(Bs),Ts=js.getBucket(_);if(!Ts||Ts.projection.name==="mercator"&&Qr||Ts.fullyClipped)continue;const Js=Ts.projection.name==="globe",Ks=Js?c.aj(yr.zoom):0,Ns=Dp(Bs,Ts.getProjection(),yr),Gs=yr.calculatePixelsToTileUnitsMatrix(js),ln=ns&&Ts.hasTextData(),En=Ts.hasIconTextFit()&&ln&&Ts.hasIconData(),Hn=Ts.getProjection().createInversionMatrix(yr,Bs.canonical),ho=(1<<js.tileID.canonical.z)*c.al/et.transform.worldSize,en=go=>{let Jn=[0,0,0];if(go){const Mn=et.style.directionalLight,Zo=et.style.ambientLight;Mn&&Zo&&(Jn=Jp(et.style,Mn,Zo))}return Jn},ao=go=>{yr.depthOcclusionForSymbolsAndCircles&&(_.hasOcclusionOpacityProperties||et.terrain)&&(go.push("DEPTH_D24"),go.push("DEPTH_OCCLUSION"))},bn=go=>{_.lut&&!wr&&(_.lut.texture||(_.lut.texture=new c.d$(et.context,_.lut.image,[_.lut.image.height,_.lut.image.height,_.lut.image.height],Tr.gl.RGBA8)),Tr.activeTexture.set(Tr.gl.TEXTURE0+hu.LUT),_.lut.texture&&_.lut.texture.bind(Tr.gl.LINEAR,Tr.gl.CLAMP_TO_EDGE),go.push("APPLY_LUT_ON_GPU"))},mo=()=>{const go=Pr&&_.layout.get("symbol-placement")!=="point",Jn=[];ao(Jn),bn(Jn);const Mn=go||En,Zo=Ts.elevationType==="road",Al=et.shadowRenderer,xa=Zo&&Nr&&!!Al&&Al.enabled,ko=en(xa),Lu=Zo&&Nr&&!et.terrain?Zr:Ss,yu=_.paint.get("icon-image-cross-fade");et.terrainRenderModeElevated()&&Nr&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Js&&(Jn.push("PROJECTION_GLOBE_VIEW"),Mn&&Jn.push("PROJECTED_POS_ON_VIEWPORT")),yu>0&&Ts.hasAnySecondaryIcon&&Jn.push("ICON_TRANSITION"),!Ts.icon.zOffsetVertexBuffer||Zo&&et.terrain||Jn.push("Z_OFFSET"),ir===0&&cr===0&&pr===0&&ur===1||Jn.push("COLOR_ADJUSTMENT"),Ts.sdfIcons&&Jn.push("RENDER_SDF"),xa&&Jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Zo&&Nr&&!et.terrain&&Ts.icon.orientationVertexBuffer&&Jn.push("ELEVATED_ROADS");const Kl=Ts.icon.programConfigurations.get(_.id),Su=et.getOrCreateProgram("symbol",{config:Kl,defines:Jn}),Tu=js.imageAtlasTexture?js.imageAtlasTexture.size:[0,0],mu=Ts.iconSizeData,rp=c.bK(mu,yr.zoom),yp=Nr||!yr.isOrthographic,Wu=Au(Ns,js.tileID.canonical,Nr,Pr,yr,Ts.getProjection(),Gs),Tl=py(Ns,js.tileID.canonical,Nr,Pr,yr,Ts.getProjection(),Gs),Ml=et.translatePosMatrix(Tl,js,dt,Tt,!0),Mo=et.translatePosMatrix(Ns,js,dt,Tt),zl=Mn?ky:Wu,_l=Pr&&!Nr&&!go;let _a=ks;!Qr&&!yr.mercatorFromTransition||Pr||(_a=tm(yr));const _p=Js?_a:ks,Hy=_.getColorAdjustmentMatrix(ir,cr,pr,ur),Pp=q0(mu.kind,rp,_l,Nr,et,Mo,zl,Ml,Cr,!1,Tu,[0,0],0,Bs,Ks,Fr,Hn,_p,Ts.getProjection(),ko,ho,Hy,yu,null),Wy=js.imageAtlasTexture?js.imageAtlasTexture:null,Wx=_.layout.get("icon-size").constantOr(0)!==1||Ts.iconsNeedLinear,Wp=Ts.sdfIcons||et.options.rotating||et.options.zooming||Wx||yp?br.LINEAR:br.NEAREST,hm=Ts.sdfIcons&&_.paint.get("icon-halo-width").constantOr(1)!==0,qx=et.terrain&&Nr&&go?c.bl(c.bC(),Wu):ky;if(go&&Ts.icon){const Vm=c.bV.getAtTileOffsetFunc(Bs,yr.center.lat,yr.worldSize,Ts.getProjection()),dm=g0(Ns,js.tileID.canonical,Nr,Pr,yr,Ts.getProjection(),Gs),Ip=_.layout.get("icon-size-scale-range"),fm=c.aA(et.scaleFactor,Ip[0],Ip[1]);rw(Ts,Ns,et,!1,dm,Tl,Nr,qt,Vm,Bs,fm)}return{program:Su,buffers:Ts.icon,uniformValues:Pp,atlasTexture:Wy,atlasTextureIcon:null,atlasInterpolation:Wp,atlasInterpolationIcon:null,isSDF:Ts.sdfIcons,hasHalo:hm,depthMode:Lu,tile:js,renderWithShadows:xa,labelPlaneMatrixInv:qx}},To=()=>{const go=Or&&_.layout.get("symbol-placement")!=="point",Jn=[],Mn=go||ns||En,Zo=Ts.elevationType==="road",Al=et.shadowRenderer,xa=Zo&&ts&&!!Al&&Al.enabled,ko=en(xa),Lu=Zo&&ts&&!et.terrain?Zr:Ss;et.terrainRenderModeElevated()&&ts&&Jn.push("PITCH_WITH_MAP_TERRAIN"),Js&&(Jn.push("PROJECTION_GLOBE_VIEW"),Mn&&Jn.push("PROJECTED_POS_ON_VIEWPORT")),!Ts.text.zOffsetVertexBuffer||Zo&&et.terrain||Jn.push("Z_OFFSET"),Ts.iconsInText&&Jn.push("RENDER_TEXT_AND_SYMBOL"),Jn.push("RENDER_SDF"),xa&&Jn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Zo&&ts&&!et.terrain&&Ts.text.orientationVertexBuffer&&Jn.push("ELEVATED_ROADS"),ao(Jn);const yu=Ts.text.programConfigurations.get(_.id),Kl=et.getOrCreateProgram("symbol",{config:yu,defines:Jn});let Su,Tu=[0,0],mu=null;const rp=Ts.textSizeData;Ts.iconsInText&&(Tu=js.imageAtlasTexture?js.imageAtlasTexture.size:[0,0],mu=js.imageAtlasTexture?js.imageAtlasTexture:null,Su=ts||!yr.isOrthographic||et.options.rotating||et.options.zooming||rp.kind==="composite"||rp.kind==="camera"?br.LINEAR:br.NEAREST);const yp=js.glyphAtlasTexture?js.glyphAtlasTexture.size:[0,0],Wu=_.layout.get("text-size-scale-range"),Tl=c.aA(et.scaleFactor,Wu[0],Wu[1]),Ml=c.bK(rp,yr.zoom,Tl),Mo=Au(Ns,js.tileID.canonical,ts,Or,yr,Ts.getProjection(),Gs),zl=py(Ns,js.tileID.canonical,ts,Or,yr,Ts.getProjection(),Gs),_l=et.translatePosMatrix(zl,js,mt,Ct,!0),_a=et.translatePosMatrix(Ns,js,mt,Ct),_p=Mn?ky:Mo,Hy=Or&&!ts&&!go;let Pp=ks;!Qr&&!yr.mercatorFromTransition||Or||(Pp=tm(yr));const Wy=q0(rp.kind,Ml,Hy,ts,et,_a,_p,_l,Cr,!0,yp,Tu,0,Bs,Ks,Fr,Hn,Js?Pp:ks,Ts.getProjection(),ko,ho,null,null,Tl),Wx=js.glyphAtlasTexture?js.glyphAtlasTexture:null,Wp=br.LINEAR,hm=_.paint.get("text-halo-width").constantOr(1)!==0,qx=et.terrain&&ts&&go?c.bl(c.bC(),Mo):ky;if(go&&Ts.text){const Vm=c.bV.getAtTileOffsetFunc(Bs,yr.center.lat,yr.worldSize,Ts.getProjection()),dm=g0(Ns,js.tileID.canonical,ts,Or,yr,Ts.getProjection(),Gs);rw(Ts,Ns,et,!0,dm,zl,ts,sr,Vm,Bs,Tl)}return{program:Kl,buffers:Ts.text,uniformValues:Wy,atlasTexture:Wx,atlasTextureIcon:mu,atlasInterpolation:Wp,atlasInterpolationIcon:Su,isSDF:!0,hasHalo:hm,depthMode:Lu,tile:js,renderWithShadows:xa,labelPlaneMatrixInv:qx}},bo=Ts.icon.segments.get().length,no=Ts.text.segments.get().length,kn=bo&&!ut.onlyText?mo():null,po=no&&!ut.onlyIcons?To():null,yl=_.paint.get("icon-opacity").constantOr(1),Ko=_.paint.get("text-opacity").constantOr(1);if(rs&&Ts.canOverlap){cs=!0;const go=yl&&!ut.onlyText?Ts.icon.segments.get():[],Jn=Ko&&!ut.onlyIcons?Ts.text.segments.get():[];for(const Mn of go)gs.push({segments:new c.bg([Mn]),sortKey:Mn.sortKey,state:kn});for(const Mn of Jn)gs.push({segments:new c.bg([Mn]),sortKey:Mn.sortKey,state:po})}else ut.onlyText||gs.push({segments:yl?Ts.icon.segments:new c.bg([]),sortKey:0,state:kn}),ut.onlyIcons||gs.push({segments:Ko?Ts.text.segments:new c.bg([]),sortKey:0,state:po})}cs&&gs.sort((Bs,js)=>Bs.sortKey-js.sortKey);for(const Bs of gs){const js=Bs.state;if(js)if(et.terrain?et.terrain.setupElevationDraw(js.tile,js.program,{useDepthForOcclusion:yr.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:js.labelPlaneMatrixInv}):et.setupDepthForOcclusion(yr.depthOcclusionForSymbolsAndCircles,js.program),Tr.activeTexture.set(br.TEXTURE0),js.atlasTexture&&js.atlasTexture.bind(js.atlasInterpolation,br.CLAMP_TO_EDGE,!0),js.atlasTextureIcon&&(Tr.activeTexture.set(br.TEXTURE1),js.atlasTextureIcon&&js.atlasTextureIcon.bind(js.atlasInterpolationIcon,br.CLAMP_TO_EDGE,!0)),js.renderWithShadows&&et.shadowRenderer.setupShadows(js.tile.tileID.toUnwrapped(),js.program,"vector-tile"),et.uploadCommonLightUniforms(et.context,js.program),js.hasHalo){const Ts=js.uniformValues;Ts.u_is_halo=1,Nv(js.buffers,Bs.segments,_,et,js.program,js.depthMode,ot,lt,Ts,2),Ts.u_is_halo=0}else{if(js.isSDF){const Ts=js.uniformValues;js.hasHalo&&(Ts.u_is_halo=1,Nv(js.buffers,Bs.segments,_,et,js.program,js.depthMode,ot,lt,Ts,1)),Ts.u_is_halo=0}Nv(js.buffers,Bs.segments,_,et,js.program,js.depthMode,ot,lt,js.uniformValues,1)}}}function Nv(et,o,_,rt,ot,lt,ut,dt,mt,Tt){const Ct=[et.dynamicLayoutVertexBuffer,et.opacityVertexBuffer,et.iconTransitioningVertexBuffer,et.globeExtVertexBuffer,et.zOffsetVertexBuffer,et.orientationVertexBuffer];ot.draw(rt,rt.context.gl.TRIANGLES,lt,ut,dt,mn.disabled,mt,_.id,et.layoutVertexBuffer,et.indexBuffer,o,_.paint,rt.transform.zoom,et.programConfigurations.get(_.id),Ct,Tt)}function Fw(et,o){const _=1<<et.canonical.z,rt=(o.x*_-et.canonical.x-et.wrap*_)*c.al,ot=(o.y*_-et.canonical.y)*c.al,lt=c.e8(o.z,o.y);return c.d5(rt,ot,lt)}function X0(et,o,_,rt,ot){if(!_.layout||_.layout.get("fill-elevation-reference")==="none"||_.paint.get("fill-opacity").constantOr(1)===0)return;const lt=et.context.gl,ut=new tn(et.context.gl.LEQUAL,tn.ReadWrite,et.depthRangeFor3D),dt=new tn(et.context.gl.GREATER,tn.ReadWrite,et.depthRangeFor3D),mt=function($t){let Zt=.01;return $t.isOrthographic&&(Zt=c.ak(1e-4,Zt,c.d0($t.pitch>=Rp?1:$t.pitch/Rp))),2*Zt}(et.transform),Tt=et.transform.getFreeCameraOptions().position,Ct="elevatedStructuresDepthReconstruct",Ut=et.getOrCreateProgram(Ct,{defines:["DEPTH_RECONSTRUCTION"]}),Bt=et.getOrCreateProgram(Ct);for(const $t of rt){const Zt=o.getTile($t),qt=Zt.getBucket(_);if(!qt)continue;const sr=qt.elevatedStructures;if(!sr)continue;const ir=qt.elevationBufferData.heightRange,cr=Fw($t.toUnwrapped(),Tt),pr=et.translatePosMatrix($t.projMatrix,Zt,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));let ur,Cr,wr,Tr;if(ot==="initialize"){if(!ir||ir.min>=1||sr.depthSegments.segments[0].primitiveLength===0)continue;ur=ix(pr,cr,mt,1,0),Cr=ut,wr=sr.depthSegments,Tr=Ut}else if(ot==="reset"){if(!ir||ir.min>=0||sr.maskSegments.segments[0].primitiveLength===0)continue;ur=ix(pr,cr,0,0,1),Cr=dt,wr=sr.maskSegments,Tr=Ut}else if(ot==="geometry"){if(sr.depthSegments.segments[0].primitiveLength===0)continue;ur=ix(pr,cr,mt,1,0),Cr=ut,wr=sr.depthSegments,Tr=Bt}Tr.draw(et,lt.TRIANGLES,Cr,gn.disabled,jn.disabled,mn.disabled,ur,_.id,sr.vertexBuffer,sr.indexBuffer,wr,_.paint,et.transform.zoom)}}function K0(et,o,_,rt){const{painter:ot,sourceCache:lt,layer:ut,coords:dt,colorMode:mt,elevationType:Tt,terrainEnabled:Ct,pass:Ut}=et,Bt=ot.context.gl,$t=ut.paint.get("fill-pattern"),Zt=ut.paint.get("fill-pattern-cross-fade"),qt=$t.constantOr(null);let sr=Tt;Tt!=="road"||o&&!Ct||(sr="none");const ir=sr==="road",cr=et.painter.shadowRenderer,pr=ir&&!!cr&&cr.enabled,ur=new tn(ot.context.gl.LEQUAL,tn.ReadOnly,ot.depthRangeFor3D);let Cr=[0,0,0];if(pr){const yr=ot.style.directionalLight,Pr=ot.style.ambientLight;yr&&Pr&&(Cr=Jp(ot.style,yr,Pr))}const wr=$t&&$t.constantOr(1),Tr=ot.terrain&&ot.terrain.renderingToTexture,br=(yr,Pr)=>{let Or,Nr,ts,rs,cs;Pr?(Or=wr&&!ut.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ts=Bt.LINES):(Or=wr?"fillPattern":"fill",ts=Bt.TRIANGLES);for(const Ss of dt){const Zr=lt.getTile(Ss);if(wr&&!Zr.patternsLoaded())continue;const Fr=Zr.getBucket(ut);if(!Fr)continue;const ns=o?Fr.elevationBufferData:Fr.bufferData;if(ns.isEmpty())continue;ot.prepareDrawTile();const Qr=ns.programConfigurations.get(ut.id),gs=ot.isTileAffectedByFog(Ss),ks=[],Bs=[];ir&&(ks.push("ELEVATED_ROADS"),Bs.push(ns.elevatedLayoutVertexBuffer)),pr&&ks.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Tr&&_&&ks.push("USE_MRT1"),wr&&(ot.context.activeTexture.set(Bt.TEXTURE0),Zr.imageAtlasTexture&&Zr.imageAtlasTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE),Qr.updatePaintBuffers());let js=!1;if(qt&&Zr.imageAtlas){const Gs=Zr.imageAtlas,ln=c.e3.from(qt),En=ln.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),Hn=ln.getSecondary(),ho=Gs.patternPositions.get(En),en=Hn?Gs.patternPositions.get(Hn.scaleSelf(c.o.devicePixelRatio).toString()):null;js=!!ho&&!!en,ho&&Qr.setConstantPatternPositions(ho,en)}Zt>0&&(js||Qr.getPatternTransitionVertexBuffer("fill-pattern"))&&ks.push("FILL_PATTERN_TRANSITION");const Ts=ot.getOrCreateProgram(Or,{config:Qr,overrideFog:gs,defines:ks}),Js=ot.translatePosMatrix(Ss.projMatrix,Zr,ut.paint.get("fill-translate"),ut.paint.get("fill-translate-anchor"));pr&&cr.setupShadows(Zr.tileID.toUnwrapped(),Ts,"vector-tile");const Ks=ut.paint.get("fill-emissive-strength");if(Pr){rs=ns.lineIndexBuffer,cs=ns.lineSegments;const Gs=ot.terrain&&ot.terrain.renderingToTexture?ot.terrain.drapeBufferSize:[Bt.drawingBufferWidth,Bt.drawingBufferHeight];Nr=Or==="fillOutlinePattern"&&wr?Mv(Js,Ks,ot,Zr,Gs,Cr,Zt):Sw(Js,Ks,Gs,Cr)}else rs=ns.indexBuffer,cs=ns.triangleSegments,Nr=wr?kv(Js,Ks,ot,Zr,Cr,Zt):Iv(Js,Ks,Cr);ot.uploadCommonUniforms(ot.context,Ts,Ss.toUnwrapped());let Ns=yr;(Tt==="road"&&!Ct||Tt==="offset")&&(Ns=ur),Ts.draw(ot,ts,Ns,rt||ot.stencilModeForClipping(Ss),mt,mn.disabled,Nr,ut.id,ns.layoutVertexBuffer,rs,cs,ut.paint,ot.transform.zoom,Qr,Bs)}};ot.renderPass===Ut&&br(ot.depthModeForSublayer(1,ot.renderPass==="opaque"?tn.ReadWrite:tn.ReadOnly),!1),sr==="none"&&ot.renderPass==="translucent"&&ut.paint.get("fill-antialias")&&br(ot.depthModeForSublayer(ut.getPaintProperty("fill-outline-color")?2:0,tn.ReadOnly),!0)}function Y0(et,o,_,rt,ot,lt,ut,dt){_.resetLayerRenderingStats(et);const mt=et.context,Tt=mt.gl,Ct=et.transform,Ut=_.paint.get("fill-extrusion-pattern"),Bt=_.paint.get("fill-extrusion-pattern-cross-fade"),$t=Ut.constantOr(null),Zt=Ut.constantOr(1),qt=_.paint.get("fill-extrusion-opacity"),sr=et.style.enable3dLights(),ir=_.paint.get(sr&&!Zt?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),cr=[_.paint.get("fill-extrusion-ambient-occlusion-intensity"),ir],pr=_.layout.get("fill-extrusion-edge-radius"),ur=pr>0&&!_.paint.get("fill-extrusion-rounded-roof"),Cr=ur?0:pr,wr=Ct.projection.name==="globe"?c.eb():0,Tr=Ct.projection.name==="globe",br=Tr?c.aj(Ct.zoom):0,yr=[c.aF(Ct.center.lng),c.aJ(Ct.center.lat)],Pr=_.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Or=_.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Pr?null:_.lut).toArray01().slice(0,3),Nr=_.paint.get("fill-extrusion-flood-light-intensity"),ts=_.paint.get("fill-extrusion-vertical-scale"),rs=_.paint.get("fill-extrusion-line-width").constantOr(1)!==0,cs=_.paint.get("fill-extrusion-height-alignment"),Ss=_.paint.get("fill-extrusion-base-alignment"),Zr=Cm(et,_.paint.get("fill-extrusion-cutoff-fade-range")),Fr=[];let ns;Tr&&Fr.push("PROJECTION_GLOBE_VIEW"),cr[0]>0&&Fr.push("FAUX_AO"),ur&&Fr.push("ZERO_ROOF_RADIUS"),dt&&Fr.push("HAS_CENTROID"),Nr>0&&Fr.push("FLOOD_LIGHT"),Zr.shouldRenderCutoff&&Fr.push("RENDER_CUTOFF"),rs&&Fr.push("RENDER_WALL_MODE");const Qr=et.renderPass==="shadow",gs=et.shadowRenderer,ks=Qr&&!!gs,Bs=Qr?mn.disabled:mn.backCCW;et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!0);let js=[0,0,0];if(gs){const Ks=et.style.directionalLight,Ns=et.style.ambientLight;Ks&&Ns&&(js=Jp(et.style,Ks,Ns)),Qr||(Fr.push("RENDER_SHADOWS","DEPTH_TEXTURE"),gs.useNormalOffset&&Fr.push("NORMAL_OFFSET")),ns=Fr.concat(["SHADOWS_SINGLE_CASCADE"])}const Ts=ks?"fillExtrusionDepth":Zt?"fillExtrusionPattern":"fillExtrusion",Js=_.getLayerRenderingStats();for(const Ks of rt){const Ns=o.getTile(Ks),Gs=Ns.getBucket(_);if(!Gs||Gs.projection.name!==Ct.projection.name)continue;let ln=!1;gs&&(ln=gs.getMaxCascadeForTile(Ks.toUnwrapped())===0);const En=et.isTileAffectedByFog(Ks),Hn=Gs.programConfigurations.get(_.id);let ho=!1;if($t&&Ns.imageAtlas){const no=Ns.imageAtlas,kn=c.e3.from($t),po=kn.getPrimary().scaleSelf(c.o.devicePixelRatio).toString(),yl=kn.getSecondary(),Ko=no.patternPositions.get(po),go=yl?no.patternPositions.get(yl.scaleSelf(c.o.devicePixelRatio).toString()):null;ho=!!Ko&&!!go,Ko&&Hn.setConstantPatternPositions(Ko,go)}Bt>0&&(ho||Hn.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Fr.push("FILL_EXTRUSION_PATTERN_TRANSITION");const en=et.getOrCreateProgram(Ts,{config:Hn,defines:ln?ns:Fr,overrideFog:En});if(et.terrain&&et.terrain.setupElevationDraw(Ns,en,{useMeterToDem:!0}),!Gs.centroidVertexBuffer){const no=en.getAttributeLocation(Tt,"a_centroid_pos");no!==-1&&Tt.vertexAttrib2f(no,0,0)}!Qr&&gs&&gs.setupShadows(Ns.tileID.toUnwrapped(),en,"vector-tile"),Zt&&(et.context.activeTexture.set(Tt.TEXTURE0),Ns.imageAtlasTexture&&Ns.imageAtlasTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),Hn.updatePaintBuffers());const ao=_.paint.get("fill-extrusion-vertical-gradient"),bn=1/Gs.tileToMeter;let mo;if(Qr&&gs){if(im(Ns.tileID,Gs.maxHeight,et))continue;const no=gs.calculateShadowPassMatrixFromTile(Ns.tileID.toUnwrapped());mo=Pv(no,Cr,bn,ts,cs,Ss)}else{const no=et.translatePosMatrix(Ks.expandedProjMatrix,Ns,_.paint.get("fill-extrusion-translate"),_.paint.get("fill-extrusion-translate-anchor")),kn=Ct.projection.createInversionMatrix(Ct,Ks.canonical);mo=Zt?Ew(no,et,ao,qt,cr,Cr,bn,Ks,Ns,wr,cs,Ss,br,yr,kn,Or,ts,Bt):$0(no,et,ao,qt,cr,Cr,bn,Ks,wr,cs,Ss,br,yr,kn,Or,ts,Nr,js)}et.uploadCommonUniforms(mt,en,Ks.toUnwrapped(),null,Zr);let To=Gs.segments;if(Ct.projection.name==="mercator"&&!Qr&&(To=Gs.getVisibleSegments(Ns.tileID,et.terrain,et.transform.getFrustum(0)),!To.get().length))continue;if(Js)if(Qr)for(const no of To.get())Js.numRenderedVerticesInShadowPass+=no.primitiveLength;else for(const no of To.get())Js.numRenderedVerticesInTransparentPass+=no.primitiveLength;const bo=[];(et.terrain||dt)&&bo.push(Gs.centroidVertexBuffer),Tr&&bo.push(Gs.layoutVertexExtBuffer),rs&&bo.push(Gs.wallVertexBuffer),en.draw(et,mt.gl.TRIANGLES,ot,lt,ut,Bs,mo,_.id,Gs.layoutVertexBuffer,Gs.indexBuffer,To,_.paint,et.transform.zoom,Hn,bo)}et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!1)}class zv{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function rm(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr){const ur=o.context,Cr=ur.gl,wr=o.transform,Tr=o.transform.zoom,br=[],yr=et.translate,Pr=et.translateAnchor,Or=et.edgeRadius,Nr=Cm(o,et.cutoffFadeRange);Ct==="clear"?(br.push("CLEAR_SUBPASS"),pr&&(br.push("CLEAR_FROM_TEXTURE"),ur.activeTexture.set(Cr.TEXTURE0),pr.bind(Cr.LINEAR,Cr.CLAMP_TO_EDGE))):Ct==="sdf"?br.push("SDF_SUBPASS"):Ct==="emissive"&&(br.push("USE_MRT1"),ur.activeTexture.set(Cr.TEXTURE0),pr.bind(Cr.LINEAR,Cr.CLAMP_TO_EDGE)),ir&&br.push("HAS_CENTROID"),Nr.shouldRenderCutoff&&br.push("RENDER_CUTOFF");const ts=(rs,cs,Ss,Zr,Fr)=>{let ns=br;cs.groundRadiusBuffer!=null&&(ns=br.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Qr=cs.programConfigurations.get(rt.id),gs=o.isTileAffectedByFog(rs),ks=o.getOrCreateProgram("fillExtrusionGroundEffect",{config:Qr,defines:ns,overrideFog:gs}),Bs=Lx(o,Zr,Ut,Tt,Fr,[Bt,$t*Fr],Zt,qt,sr,Tr>=17?0:Or*Fr,pr?pr.size[0]:0),js=[];ir&&js.push(cs.hiddenByLandmarkVertexBuffer),cs.groundRadiusBuffer!=null&&js.push(cs.groundRadiusBuffer),o.uploadCommonUniforms(ur,ks,rs.toUnwrapped(),null,Nr),ks.draw(o,ur.gl.TRIANGLES,lt,ut,dt,mt,Bs,rt.id,cs.vertexBuffer,cs.indexBuffer,Ss,rt.paint,Tr,Qr,js)};for(const rs of ot){const cs=_.getTile(rs),Ss=cs.getBucket(rt);if(!Ss||Ss.projection.name!==wr.projection.name||!Ss.groundEffect||Ss.groundEffect&&!Ss.groundEffect.hasData())continue;const Zr=Ss.groundEffect,Fr=1/Ss.tileToMeter;{const ns=o.translatePosMatrix(rs.projMatrix,cs,yr,Pr),Qr=Zr.getDefaultSegment();ts(rs,Zr,Qr,ns,Fr)}if(cr)for(let ns=0;ns<4;ns++){const Qr=c.e9[ns](rs),gs=_.getTile(Qr);if(!gs)continue;const ks=gs.getBucket(rt);if(!ks||ks.projection.name!==wr.projection.name||!ks.groundEffect||ks.groundEffect&&!ks.groundEffect.hasData())continue;const Bs=ks.groundEffect;let js,Ts;ns===0?(js=[-c.al,0,0],Ts=1):ns===1?(js=[c.al,0,0],Ts=0):ns===2?(js=[0,-c.al,0],Ts=3):(js=[0,c.al,0],Ts=2);const Js=Bs.regionSegments[Ts];if(!Js)continue;const Ks=new Float32Array(16);c.br(Ks,rs.projMatrix,js),ts(rs,Bs,Js,o.translatePosMatrix(Ks,cs,yr,Pr),Fr)}}}function m2(et,o,_,rt,ot,lt,ut){rt.centroidVertexArray.length===0&&rt.createCentroidsBuffer();const dt=lt?lt.findDEMTileFor(_):null;if(!(dt&&dt.dem||ut))return;lt&&dt&&dt.dem&&rt.selfDEMTileTimestamp!==dt.dem._timestamp&&(rt.borderDoneWithNeighborZ=[-1,-1,-1,-1],rt.selfDEMTileTimestamp=dt.dem._timestamp);const mt=ir=>new c.P(Math.ceil((ir+c.ed)*c.ee),0),Tt=ir=>{const cr=o.getSource().minzoom,pr=Cr=>{const wr=o.getTileByID(Cr);if(wr&&wr.hasData())return wr.getBucket(ot)},ur=[0,-1,1];for(const Cr of ur){if(ir.overscaledZ+Cr<cr)continue;const wr=pr(ir.calculateScaledKey(ir.overscaledZ+Cr));if(wr)return wr}},Ct=[0,0,0],Ut=(ir,cr)=>(Ct[0]=Math.min(ir.min.y,cr.min.y),Ct[1]=Math.max(ir.max.y,cr.max.y),Ct[2]=c.al-cr.min.x>ir.max.x?cr.min.x-c.al:ir.max.x,Ct),Bt=(ir,cr)=>(Ct[0]=Math.min(ir.min.x,cr.min.x),Ct[1]=Math.max(ir.max.x,cr.max.x),Ct[2]=c.al-cr.min.y>ir.max.y?cr.min.y-c.al:ir.max.y,Ct),$t=[(ir,cr)=>Ut(ir,cr),(ir,cr)=>Ut(cr,ir),(ir,cr)=>Bt(ir,cr),(ir,cr)=>Bt(cr,ir)],Zt=(ir,cr,pr,ur,Cr,wr,Tr)=>{if(!lt)return 0;const br=[[wr?pr:ir,wr?ir:pr,0],[wr?pr:cr,wr?cr:pr,0]],yr=Tr<0?c.al+Tr:Tr,Pr=[wr?yr:(ir+cr)/2,wr?(ir+cr)/2:yr,0];return pr===0&&Tr<0||pr!==0&&Tr>0?lt.getForTilePoints(Cr,[Pr],!0,ur):br.push(Pr),lt.getForTilePoints(_,br,!0,dt),Math.max(br[0][2],br[1][2],Pr[2])/lt.exaggeration()};for(let ir=0;ir<4;ir++){const cr=rt.borderFeatureIndices[ir];if(cr.length===0)continue;const pr=c.e9[ir](_),ur=Tt(pr);if(!(ur&&ur instanceof c.ea))continue;const Cr=lt?lt.findDEMTileFor(pr):null;if(!(Cr&&Cr.dem||ut)||(lt&&Cr&&Cr.dem&&rt.borderDEMTileTimestamp[ir]!==Cr.dem._timestamp&&(rt.borderDoneWithNeighborZ[ir]=-1,rt.borderDEMTileTimestamp[ir]=Cr.dem._timestamp),rt.borderDoneWithNeighborZ[ir]===ur.canonical.z))continue;ur.centroidVertexArray.length===0&&ur.createCentroidsBuffer();const wr=(ir<2?1:5)-ir,Tr=ur.borderDoneWithNeighborZ[wr]!==rt.canonical.z,br=ur.borderFeatureIndices[wr];let yr=0;if(rt.canonical.z!==ur.canonical.z){for(const Pr of cr)rt.showCentroid(rt.featuresOnBorder[Pr]);if(Tr)for(const Pr of br)ur.showCentroid(ur.featuresOnBorder[Pr]);rt.borderDoneWithNeighborZ[ir]=ur.canonical.z,ur.borderDoneWithNeighborZ[wr]=rt.canonical.z}for(const Pr of cr){const Or=rt.featuresOnBorder[Pr],Nr=rt.centroidData[Or.centroidDataIndex],ts=Or.borders[ir];let rs;for(;yr<br.length;){rs=ur.featuresOnBorder[br[yr]];const cs=rs.borders[wr];if(cs[1]>ts[0]+3||cs[0]>ts[0]-3)break;ur.showCentroid(rs),yr++}if(rs&&yr<br.length){const cs=yr;let Ss=0;for(;!(rs.borders[wr][0]>ts[1]-3)&&(Ss++,++yr!==br.length);)rs=ur.featuresOnBorder[br[yr]];rs=ur.featuresOnBorder[br[cs]];let Zr=!1;if(Ss>=1){const Qr=rs.borders[wr];Math.abs(ts[0]-Qr[0])<3&&Math.abs(ts[1]-Qr[1])<3&&(Ss=1,Zr=!0,yr=cs+1)}else if(Ss===0){rt.showCentroid(Or);continue}const Fr=ur.centroidData[rs.centroidDataIndex];ut&&Zr&&(((qt=Nr).flags|(sr=Fr).flags)&c.ec?(qt.flags|=c.ec,sr.flags|=c.ec):(qt.flags&=~c.ec,sr.flags&=~c.ec));const ns=Or.intersectsCount()>1||rs.intersectsCount()>1;if(Ss>1)yr=cs,Nr.centroidXY=Fr.centroidXY=new c.P(0,0);else if(Cr&&Cr.dem&&!ns){const Qr=$t[ir](Nr,Fr),gs=ir%2?c.al-1:0,ks=Zt(Qr[0],Math.min(c.al-1,Qr[1]),gs,Cr,pr,ir<2,Qr[2]);Nr.centroidXY=Fr.centroidXY=mt(ks)}else ns?Nr.centroidXY=Fr.centroidXY=new c.P(0,0):(Nr.centroidXY=rt.encodeBorderCentroid(Or),Fr.centroidXY=ur.encodeBorderCentroid(rs));rt.writeCentroidToBuffer(Nr),ur.writeCentroidToBuffer(Fr)}else rt.showCentroid(Or)}rt.borderDoneWithNeighborZ[ir]=ur.canonical.z,ur.borderDoneWithNeighborZ[wr]=rt.canonical.z}var qt,sr;(rt.needsCentroidUpdate||!rt.centroidVertexBuffer&&rt.centroidVertexArray.length!==0)&&rt.uploadCentroid(et)}const Ku=[1,0,0],Ov=[0,1,0],Mu=[0,0,1];function im(et,o,_){const rt=_.transform,ot=_.shadowRenderer;if(!ot)return!0;const lt=et.toUnwrapped(),ut=rt.tileSize*ot._cascades[_.currentShadowCascade].scale;let dt=o;if(rt.elevation){const qt=rt.elevation.getMinMaxForTile(et);qt&&(dt+=qt.max)}const mt=[...ot.shadowDirection];mt[2]=-mt[2];const Tt=ot.computeSimplifiedTileShadowVolume(lt,dt,ut,mt);if(!Tt)return!1;const Ct=[Ku,Ov,Mu,mt,[mt[0],0,mt[2]],[0,mt[1],mt[2]]],Ut=rt.projection.name==="globe",Bt=rt.scaleZoom(ut),$t=c.cB.fromInvProjectionMatrix(rt.invProjMatrix,rt.worldSize,Bt,!Ut),Zt=ot.getCurrentCascadeFrustum();return $t.intersectsPrecise(Tt.vertices,Tt.planes,Ct)===0||Zt.intersectsPrecise(Tt.vertices,Tt.planes,Ct)===0}function Fy(et){const{painter:o,source:_,layer:rt,coords:ot}=et;let lt=et.defines;const ut=o.context,dt=o.renderPass==="shadow",mt=o.renderPass==="light-beam",Tt=o.shadowRenderer,Ct=c.ef(o.transform.center.lat,o.transform.zoom),Ut=Cm(o,rt.paint.get("building-cutoff-fade-range"));Ut.shouldRenderCutoff&&(lt=lt.concat("RENDER_CUTOFF")),et.floodLightIntensity>0&&(lt=lt.concat("FLOOD_LIGHT"));for(const Bt of ot){const $t=_.getTile(Bt),Zt=$t.getBucket(rt);if(!Zt)continue;Tt&&Tt.getMaxCascadeForTile(Bt.toUnwrapped())===0&&(lt=lt.concat("SHADOWS_SINGLE_CASCADE"));const qt=Zt.programConfigurations.get(rt.id);let sr,ir,cr,pr=o.translatePosMatrix(Bt.expandedProjMatrix,$t,[0,0],"map");if(pr=c.cS(c.bC(),pr,[1,1,et.verticalScale]),dt&&Tt){if(im($t.tileID,Zt.maxHeight*Ct,o))continue;let Cr=Tt.calculateShadowPassMatrixFromTile($t.tileID.toUnwrapped());Cr=c.cS(c.bC(),Cr,[1,1,et.verticalScale]),cr=Fm(Cr),sr=ir=o.getOrCreateProgram("buildingDepth",{config:qt,defines:lt,overrideFog:!1})}else if(mt)sr=ir=o.getOrCreateProgram("buildingBloom",{config:qt,defines:lt,overrideFog:!1}),cr=Tw(pr);else{const Cr=o.transform.calculatePosMatrix(Bt.toUnwrapped(),o.transform.worldSize);c.cS(Cr,Cr,[1,1,et.verticalScale]);const wr=c.bC();c.cS(wr,Cr,[1,-1,1/Ct]),c.bl(wr,wr),c.eg(wr,wr);const Tr=o.transform.getFreeCameraOptions().position,br=1<<Bt.canonical.z;if(cr=G0(pr,wr,et.opacity,et.facadeAOIntensity,[((Tr.x-Bt.wrap)*br-Bt.canonical.x)*c.al,(Tr.y*br-Bt.canonical.y)*c.al,Tr.z*br*c.al],Zt.tileToMeter,et.facadeEmissiveChance,et.floodLightColor,et.floodLightIntensity),ir=o.getOrCreateProgram("building",{config:qt,defines:lt,overrideFog:!1}),et.depthOnly===!0)sr=ir;else{const yr=lt.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);sr=o.getOrCreateProgram("building",{config:qt,defines:yr,overrideFog:!1})}Tt&&(Tt.setupShadowsFromMatrix(Cr,ir,!0),sr!==ir&&Tt.setupShadowsFromMatrix(Cr,sr,!0))}const ur=(Cr,wr)=>{if(mt){const Tr=Cr.entranceBloom;wr.draw(o,ut.gl.TRIANGLES,et.depthMode,gn.disabled,et.blendMode,mn.disabled,cr,rt.id,Tr.layoutVertexBuffer,Tr.indexBuffer,Tr.segmentsBucket,rt.paint,o.transform.zoom,qt,[Tr.layoutAttenuationBuffer,Tr.layoutColorBuffer])}else{const Tr=Cr.segmentsBucket;let br=[Cr.layoutNormalBuffer,Cr.layoutCentroidBuffer,Cr.layoutColorBuffer,Cr.layoutFloodLightDataBuffer];Cr.layoutFacadePaintBuffer&&(br=br.concat([Cr.layoutFacadeDataBuffer,Cr.layoutFacadeVerticalRangeBuffer,Cr.layoutFacadePaintBuffer])),wr.draw(o,ut.gl.TRIANGLES,et.depthMode,gn.disabled,et.blendMode,dt?mn.disabled:mn.backCW,cr,rt.id,Cr.layoutVertexBuffer,Cr.indexBuffer,Tr,rt.paint,o.transform.zoom,qt,br)}};o.uploadCommonUniforms(ut,ir,Bt.toUnwrapped(),null,Ut),Zt.buildingWithoutFacade&&ur(Zt.buildingWithoutFacade,ir),Zt.buildingWithFacade&&(sr!==ir&&o.uploadCommonUniforms(ut,sr,Bt.toUnwrapped(),null,Ut),ur(Zt.buildingWithFacade,sr))}}function Q0(et,o,_,rt,ot,lt,ut,dt,mt,Tt,Ct,Ut,Bt){const $t=et.context.gl,Zt=et.depthModeForSublayer(1,tn.ReadOnly,$t.LEQUAL,!0),qt=.1*(1-(sr=Ct))+3*sr;var sr;const ir=et._showOverdrawInspector,cr=Ut,pr=new zv;ir||rm(pr,et,o,_,rt,Zt,new gn({func:$t.ALWAYS,mask:255},255,255,$t.KEEP,$t.KEEP,$t.REPLACE),new jn([$t.ONE,$t.ONE,$t.ONE,$t.ONE],c.ao.transparent,[!1,!1,!1,!0],$t.MIN),mn.disabled,ot,"sdf",lt,ut,dt,mt,Tt,qt,cr,!1);{const ur=ir?gn.disabled:new gn({func:$t.EQUAL,mask:255},255,255,$t.KEEP,$t.DECR,$t.DECR),Cr=ir?et.colorModeForRenderPass():new jn([$t.ONE_MINUS_DST_ALPHA,$t.DST_ALPHA,$t.ONE,$t.ONE],c.ao.transparent,[!0,!0,!0,!0]);rm(pr,et,o,_,rt,Zt,ur,Cr,mn.disabled,ot,"color",lt,ut,dt,mt,Tt,qt,cr,!1)}}function J0(et){return[et[0]*c.eh,et[1]*c.eh,et[2]*c.eh,0]}function Ly(et,o,_,rt,ot,lt,ut,dt,mt){const Tt=rt.getSource(),Ct=_.globeSharedBuffers;if(!Ct)return;let Ut,Bt,$t;if(o&&(Ut=rt.getTile(o)),Tt instanceof c.aU?(Bt=Tt.texture,$t=c.dK(0,0,_.transform)):Ut&&o&&(Bt=Ut.texture,$t=c.dK(o.canonical.z,o.canonical.x,_.transform)),!Bt||!$t)return;et||($t=c.cS(c.bC(),$t,[1,-1,1]));const Zt=_.context,qt=Zt.gl,sr=ot.paint.get("raster-resampling")==="nearest"?qt.NEAREST:qt.LINEAR,ir=_.colorModeForDrapableLayerRenderPass(lt),cr=ut.defines;cr.push("GLOBE_POLES");const pr=new tn(qt.LEQUAL,tn.ReadWrite,_.depthRangeFor3D),ur=Float32Array.from(_.transform.expandedFarZProjMatrix),Cr=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0))));_.terrain&&_.terrain.prepareDrawTile(),Zt.activeTexture.set(qt.TEXTURE0),Bt.bind(sr,qt.CLAMP_TO_EDGE),Zt.activeTexture.set(qt.TEXTURE1),Bt.bind(sr,qt.CLAMP_TO_EDGE),"useMipmap"in Bt&&Zt.extTextureFilterAnisotropic&&_.transform.pitch>20&&qt.texParameterf(qt.TEXTURE_2D,Zt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Zt.extTextureFilterAnisotropicMax);const[wr,Tr,br,yr]=o?Ct.getPoleBuffers(o.canonical.z,!1):Ct.getPoleBuffers(0,!0),Pr=ot.paint.get("raster-elevation");let Or;et?(Or=wr,_.renderDefaultNorthPole=Pr!==0):(Or=Tr,_.renderDefaultSouthPole=Pr!==0);const Nr=J0(ut.mix),ts=((cs,Ss,Zr,Fr,ns,Qr,gs,ks,Bs,js,Ts,Js,Ks)=>Aw(cs,Ss,Zr,new Float32Array(16),new Float32Array(9),[0,0],Fr,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Qr,[0,0],ks,2,js,Ts,Js,1,0,Ks))(ur,Cr,$t,c.aj(_.transform.zoom),0,ot,0,Pr,0,Nr,ut.offset,ut.range,lt),rs=_.getOrCreateProgram("raster",{defines:cr});_.uploadCommonUniforms(Zt,rs,null),rs.draw(_,qt.TRIANGLES,pr,mt,ir,dt,ts,ot.id,Or,br,yr)}function Lw(et){const o=et._nearZ,_=et.projection.farthestPixelDistance(et),rt=_-o,ot=.2*et.height,lt=o+ot;return[o,_,(lt-ot-o)/rt,(lt-o)/rt]}function sm(et,o,_,rt){if(et)return o instanceof Cu&&et instanceof d0?o.getTextureDescriptor(et,_,!0):{texture:et.texture,mix:J0(rt.mix),offset:rt.offset,buffer:0,tileSize:1}}var $o=c.ei([{name:"a_index",type:"Int16",components:1}]);class e_{constructor(o,_,rt,ot){const lt={width:rt[0],height:rt[1],data:null},ut=o.gl;this.targetColorTexture=new c.T(o,lt,ut.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new c.T(o,lt,ut.RGBA8,{useMipmap:!1}),this.context=o,this.updateParticleTexture(_,ot),this.lastInvalidatedAt=0}updateParticleTexture(o,_){if(this.particleTextureDimension===_.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const rt=this.context.gl,ot=_.width*_.height;this.particleTexture0=new c.T(this.context,_,rt.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new c.T(this.context,_,rt.RGBA8,{premultiply:!1,useMipmap:!1});const lt=new c.ej;lt.reserve(ot);for(let ut=0;ut<ot;ut++)lt.emplaceBack(ut);this.particleIndexBuffer=this.context.createVertexBuffer(lt,$o.members,!0),this.particleSegment=c.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=_.width}update(o){return!(this.lastInvalidatedAt<o&&(this.lastInvalidatedAt=c.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Bv(et,o,_){if(!et)return null;const rt=o.getTextureDescriptor(et,_,!0);if(!rt)return null;let{texture:ot,mix:lt,offset:ut,tileSize:dt,buffer:mt,format:Tt}=rt;if(!ot||!Tt)return null;let Ct=!1;return Tt==="uint32"&&(Ct=!0,lt[3]=0,lt=H0(c.ek,lt,[0,_.paint.get("raster-particle-max-speed")]),ut=W0(c.ek,ut,[0,_.paint.get("raster-particle-max-speed")])),{texture:ot,textureOffset:[mt/(dt+2*mt),dt/(dt+2*mt)],tileSize:dt,scalarData:Ct,scale:lt,offset:ut,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[Tt]]}}function Dw(et){const o=et._nearZ,_=et.projection.farthestPixelDistance(et),rt=_-o,ot=.2*et.height,lt=o+ot;return[o,_,(lt-ot-o)/rt,(lt-o)/rt]}const Nw=new c.ao(1,0,0,1),zw=new c.ao(0,1,0,1),Ow=new c.ao(0,0,1,1),ox=new c.ao(1,0,1,1),ax=new c.ao(0,1,1,1);function As(et,o,_,rt,ot,lt){for(let ut=0;ut<_.length;ut++)if(ot){const Tt=new c.ao(rt.r*.8,rt.g*.8,rt.b*.8,1);Fs(et,o,_[ut],rt,-1,-1,lt),Fs(et,o,_[ut],rt,-1,1,lt),Fs(et,o,_[ut],rt,1,1,lt),Fs(et,o,_[ut],rt,1,-1,lt),Fs(et,o,_[ut],Tt,0,0,lt)}else Fs(et,o,_[ut],rt,0,0,lt)}function Fs(et,o,_,rt,ot,lt,ut){const dt=et.context,mt=et.transform,Tt=dt.gl,Ct=mt.projection.name==="globe",Ut=Ct?["PROJECTION_GLOBE_VIEW"]:[];let Bt=c.bz(_.projMatrix);if(Ct&&c.aj(mt.zoom)>0){const Nr=c.bj(_.canonical,mt),ts=c.el(Nr);Bt=c.aB(new Float32Array(16),mt.globeMatrix,ts),c.aB(Bt,mt.projMatrix,Bt)}const $t=c.bC();$t[12]+=2*ot/(c.o.devicePixelRatio*mt.width),$t[13]+=2*lt/(c.o.devicePixelRatio*mt.height),c.aB(Bt,$t,Bt);const Zt=et.getOrCreateProgram("debug",{defines:Ut}),qt=o.getTileByID(_.key);et.terrain&&et.terrain.setupElevationDraw(qt,Zt);const sr=tn.disabled,ir=gn.disabled,cr=et.colorModeForRenderPass(),pr="$debug";dt.activeTexture.set(Tt.TEXTURE0),et.emptyTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE),Ct?qt._makeGlobeTileDebugBuffers(et.context,mt):qt._makeDebugTileBoundsBuffers(et.context,mt.projection);const ur=qt._tileDebugBuffer||et.debugBuffer,Cr=qt._tileDebugIndexBuffer||et.debugIndexBuffer,wr=qt._tileDebugSegments||et.debugSegments;if(Zt.draw(et,Tt.LINE_STRIP,sr,ir,cr,mn.disabled,Py(Bt,rt.toPremultipliedRenderColor(null)),pr,ur,Cr,wr,null,null,null,[qt._globeTileDebugBorderBuffer]),ut){const Nr=qt.latestRawTileData,ts=Math.floor((Nr&&Nr.byteLength||0)/1024);let rs=_.canonical.toString();_.overscaledZ!==_.canonical.z&&(rs+=` => ${_.overscaledZ}`),rs+=` ${qt.state}`,rs+=` ${ts}kb`,function(cs,Ss){cs.initDebugOverlayCanvas();const Zr=cs.debugOverlayCanvas,Fr=cs.context.gl,ns=cs.debugOverlayCanvas.getContext("2d");ns.clearRect(0,0,Zr.width,Zr.height),ns.shadowColor="white",ns.shadowBlur=2,ns.lineWidth=1.5,ns.strokeStyle="white",ns.textBaseline="top",ns.font="bold 36px Open Sans, sans-serif",ns.fillText(Ss,5,5),ns.strokeText(Ss,5,5),cs.debugOverlayTexture.update(Zr),cs.debugOverlayTexture.bind(Fr.LINEAR,Fr.CLAMP_TO_EDGE)}(et,rs)}const Tr=o.getTile(_).tileSize,br=512/Math.min(Tr,512)*(_.overscaledZ/mt.zoom)*.5,yr=qt._tileDebugTextBuffer||et.debugBuffer,Pr=qt._tileDebugTextIndexBuffer||et.quadTriangleIndexBuffer,Or=qt._tileDebugTextSegments||et.debugSegments;Zt.draw(et,Tt.TRIANGLES,sr,ir,jn.alphaBlended,mn.disabled,Py(Bt,c.ao.transparent.toPremultipliedRenderColor(null),br),pr,yr,Pr,Or,null,null,null,[qt._globeTileDebugTextBuffer])}function lx(et,o,_,rt){Gr(et,0,o+_/2,et.transform.width,_,rt)}function Sl(et,o,_,rt){Gr(et,o-_/2,0,_,et.transform.height,rt)}function Gr(et,o,_,rt,ot,lt){const ut=et.context,dt=ut.gl;dt.enable(dt.SCISSOR_TEST),dt.scissor(o*c.o.devicePixelRatio,_*c.o.devicePixelRatio,rt*c.o.devicePixelRatio,ot*c.o.devicePixelRatio),ut.clear({color:lt}),dt.disable(dt.SCISSOR_TEST)}const Bw=c.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:t_}=Bw;function Up(et,o,_,rt){et.emplaceBack(o,_,rt)}class r_{constructor(o){this.vertexArray=new c.em,this.indices=new c.b0,Up(this.vertexArray,-1,-1,1),Up(this.vertexArray,1,-1,1),Up(this.vertexArray,-1,1,1),Up(this.vertexArray,1,1,1),Up(this.vertexArray,-1,-1,-1),Up(this.vertexArray,1,-1,-1),Up(this.vertexArray,-1,1,-1),Up(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,t_),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=c.bg.simpleSegment(0,0,36,12)}}function cx(et,o,_,rt,ot,lt){const ut=et.context.gl,dt=o.paint.get("sky-atmosphere-color"),mt=o.paint.get("sky-atmosphere-halo-color"),Tt=o.paint.get("sky-atmosphere-sun-intensity"),Ct=((Ut,Bt,$t,Zt,qt)=>({u_matrix_3f:Ut,u_sun_direction:Bt,u_sun_intensity:$t,u_color_tint_r:[Zt.r,Zt.g,Zt.b,Zt.a],u_color_tint_m:[qt.r,qt.g,qt.b,qt.a],u_luminance:5e-5}))(c.eo(c.dO(),rt),ot,Tt,dt.toPremultipliedRenderColor(null),mt.toPremultipliedRenderColor(null));ut.framebufferTexture2D(ut.FRAMEBUFFER,ut.COLOR_ATTACHMENT0,ut.TEXTURE_CUBE_MAP_POSITIVE_X+lt,o.skyboxTexture,0),_.draw(et,ut.TRIANGLES,tn.disabled,gn.disabled,jn.unblended,mn.frontCW,Ct,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}const Vw=c.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class zx{constructor(o){const _=new c.ep;_.emplaceBack(-1,1,1,0,0),_.emplaceBack(1,1,1,1,0),_.emplaceBack(1,-1,1,1,1),_.emplaceBack(-1,-1,1,0,1);const rt=new c.b0;rt.emplaceBack(0,1,2),rt.emplaceBack(2,3,0),this.vertexBuffer=o.createVertexBuffer(_,Vw.members),this.indexBuffer=o.createIndexBuffer(rt),this.segments=c.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const g2=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class x2{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Uw{constructor(o){this.colorModeAlphaBlendedWriteRGB=new jn([1,zp,1,zp],c.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new jn([1,0,1,0],c.ao.transparent,[!1,!1,!1,!0]),this.params=new x2,this.updateNeeded=!0}update(o){const _=o.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new zx(_);const rt=this.params.sizeRange,ot=this.params.intensityRange,lt=function(Ct){const Ut=c.eq(30),Bt=[];for(let $t=0;$t<Ct;++$t){const Zt=2*Math.PI*Ut(),qt=Math.acos(1-2*Ut())-.5*Math.PI;Bt.push(c.d5(Math.cos(qt)*Math.cos(Zt),Math.cos(qt)*Math.sin(Zt),Math.sin(qt)))}return Bt}(this.params.starsCount),ut=c.eq(300),dt=new c.er,mt=new c.b0;let Tt=0;for(let Ct=0;Ct<lt.length;++Ct){const Ut=c.c5([],lt[Ct],200),Bt=Math.max(0,1+.01*rt*(1*ut()-.5)),$t=Math.max(0,1+.01*ot*(1*ut()-.5));dt.emplaceBack(Ut[0],Ut[1],Ut[2],-1,-1,Bt,$t),dt.emplaceBack(Ut[0],Ut[1],Ut[2],1,-1,Bt,$t),dt.emplaceBack(Ut[0],Ut[1],Ut[2],1,1,Bt,$t),dt.emplaceBack(Ut[0],Ut[1],Ut[2],-1,1,Bt,$t),mt.emplaceBack(Tt+0,Tt+1,Tt+2),mt.emplaceBack(Tt+0,Tt+2,Tt+3),Tt+=4}this.starsVx=_.createVertexBuffer(dt,g2.members),this.starsIdx=_.createIndexBuffer(mt),this.starsSegments=c.bg.simpleSegment(0,0,dt.length,mt.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(o,_){const rt=o.context,ot=rt.gl,lt=o.transform,ut=new tn(ot.LEQUAL,tn.ReadOnly,[0,1]),dt=c.aj(lt.zoom),mt=o.style.getLut(_.scope),Tt=_.properties.get("color-use-theme")==="none",Ct=_.properties.get("color").toNonPremultipliedRenderColor(Tt?null:mt),Ut=_.properties.get("high-color-use-theme")==="none",Bt=_.properties.get("high-color").toNonPremultipliedRenderColor(Ut?null:mt),$t=_.properties.get("space-color-use-theme")==="none",Zt=_.properties.get("space-color").toNonPremultipliedRenderColor($t?null:mt),qt=5e-4,sr=c.es(_.properties.get("horizon-blend"),0,1,qt,.25),ir=c.dE(o,rt,lt)&&sr===qt?lt.worldSize/(2*Math.PI*1.025)-1:lt.globeRadius,cr=o.frameCounter/1e3%1,pr=c.ag(lt.globeCenterInViewSpace),ur=Math.sqrt(Math.pow(pr,2)-Math.pow(ir,2)),Cr=Math.acos(ur/pr),wr=Tr=>{const br=lt.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Tr&&br.push("ALPHA_PASS");const yr=o.getOrCreateProgram("globeAtmosphere",{defines:br}),Pr=((Nr,ts,rs,cs,Ss,Zr,Fr,ns,Qr,gs,ks,Bs)=>({u_frustum_tl:Nr,u_frustum_tr:ts,u_frustum_br:rs,u_frustum_bl:cs,u_horizon:Ss,u_transition:Zr,u_fadeout_range:Fr,u_atmosphere_fog_color:ns.toArray01(),u_high_color:Qr.toArray01(),u_space_color:gs.toArray01(),u_temporal_offset:ks,u_horizon_angle:Bs}))(lt.frustumCorners.TL,lt.frustumCorners.TR,lt.frustumCorners.BR,lt.frustumCorners.BL,lt.frustumCorners.horizon,dt,sr,Ct,Bt,Zt,cr,Cr);o.uploadCommonUniforms(rt,yr);const Or=this.atmosphereBuffer;Or&&yr.draw(o,ot.TRIANGLES,ut,gn.disabled,Tr?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,mn.backCW,Pr,Tr?"atmosphere_glow_alpha":"atmosphere_glow",Or.vertexBuffer,Or.indexBuffer,Or.segments)};wr(!1),wr(!0)}drawStars(o,_){const rt=c.aA(_.properties.get("star-intensity"),0,1);if(rt===0)return;const ot=o.context,lt=ot.gl,ut=o.transform,dt=o.getOrCreateProgram("stars"),mt=c.c7([]);c.c9(mt,mt,-ut._pitch),c.c8(mt,mt,-ut.angle),c.c9(mt,mt,c.an(ut._center.lat)),c.et(mt,mt,-c.an(ut._center.lng));const Tt=c.cc(new Float32Array(16),mt),Ct=c.aB([],ut.starsProjMatrix,Tt),Ut=c.eo([],Tt),Bt=c.eu([],Ut),$t=[0,1,0];c.dQ($t,$t,Bt),c.c5($t,$t,this.params.sizeMultiplier);const Zt=[1,0,0];c.dQ(Zt,Zt,Bt),c.c5(Zt,Zt,this.params.sizeMultiplier);const qt=(sr=$t,ir=Zt,cr=rt,{u_matrix:Float32Array.from(Ct),u_up:sr,u_right:ir,u_intensity_multiplier:cr});var sr,ir,cr;o.uploadCommonUniforms(ot,dt),this.starsVx&&this.starsIdx&&dt.draw(o,lt.TRIANGLES,tn.disabled,gn.disabled,this.colorModeAlphaBlendedWriteRGB,mn.disabled,qt,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class i_{constructor(){this.visibleTiles=[]}updateBorders(o,_){const rt=[],ot=[],lt=o._getRenderableCoordinates(!1,!0);for(const mt of lt){const Tt=o.getTile(mt);if(!Tt.hasData())continue;const Ct=Tt.getBucket(_);Ct&&(Ct.isEmpty()||(rt.push(mt.key),ot.push({bucket:Ct,tileID:mt.canonical})))}let ut=rt.length!==this.visibleTiles.length;if(!ut){rt.sort();for(let mt=0;mt<rt.length;mt++)if(rt[mt]!==this.visibleTiles[mt]){ut=!0;break}}if(!ut)return;const dt=new Set;this.visibleTiles=rt,ot.sort((mt,Tt)=>mt.tileID.z-Tt.tileID.z||mt.tileID.x-Tt.tileID.x||mt.tileID.y-Tt.tileID.y);for(const mt of ot){const Tt=new Array,Ct=new Array,Ut=mt.bucket;for(const Bt of Ut.featuresOnBorder)dt.has(Bt.featureId)?Ct.push(Bt.footprintIndex):(dt.add(Bt.featureId),Tt.push(Bt.footprintIndex));Ut.updateFootprintHiddenFlags(Tt,c.ev,!1),Ut.updateFootprintHiddenFlags(Ct,c.ev,!0)}}}function s_(et,o){const _=[...et],rt=o.cameraWorldSizeForFog/o.worldSize,ot=c.bA([]);return c.cS(ot,ot,[rt,rt,1]),c.aB(_,ot,_),c.aB(_,o.worldToFogMatrix,_),_}function n_(et,o,_,rt,ot){const lt=_.material,ut=rt.context,{baseColorTexture:dt,metallicRoughnessTexture:mt}=lt.pbrMetallicRoughness,{normalTexture:Tt,occlusionTexture:Ct,emissionTexture:Ut}=lt;function Bt(Zt,qt,sr){if(Zt&&(et.push(qt),ut.activeTexture.set(ut.gl.TEXTURE0+sr),Zt.gfxTexture)){const{minFilter:ir,magFilter:cr,wrapS:pr,wrapT:ur}=Zt.sampler;Zt.gfxTexture.bindExtraParam(ir,cr,pr,ur)}}Bt(dt,"HAS_TEXTURE_u_baseColorTexture",hu.BaseColor),Bt(mt,"HAS_TEXTURE_u_metallicRoughnessTexture",hu.MetallicRoughness),Bt(Tt,"HAS_TEXTURE_u_normalTexture",hu.Normal),Bt(Ct,"HAS_TEXTURE_u_occlusionTexture",hu.Occlusion),Bt(Ut,"HAS_TEXTURE_u_emissionTexture",hu.Emission),ot&&(ot.texture||(ot.texture=new c.d$(rt.context,ot.image,[ot.image.height,ot.image.height,ot.image.height],ut.gl.RGBA8)),ut.activeTexture.set(ut.gl.TEXTURE0+hu.LUT),ot.texture&&ot.texture.bind(ut.gl.LINEAR,ut.gl.CLAMP_TO_EDGE),et.push("APPLY_LUT_ON_GPU")),_.texcoordBuffer&&(et.push("HAS_ATTRIBUTE_a_uv_2f"),o.push(_.texcoordBuffer)),_.colorBuffer&&(et.push(_.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),o.push(_.colorBuffer)),_.normalBuffer&&(et.push("HAS_ATTRIBUTE_a_normal_3f"),o.push(_.normalBuffer)),_.pbrBuffer&&(et.push("HAS_ATTRIBUTE_a_pbr"),et.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),o.push(_.pbrBuffer)),lt.alphaMode!=="OPAQUE"&&lt.alphaMode!=="MASK"||et.push("UNPREMULT_TEXTURE_IN_SHADER"),lt.defined||et.push("DIFFUSE_SHADED");const $t=rt.shadowRenderer;$t&&(et.push("RENDER_SHADOWS","DEPTH_TEXTURE"),$t.useNormalOffset&&et.push("NORMAL_OFFSET"))}function o_(et,o,_,rt,ot,lt){const ut=et.modelOpacity,dt=o.context,mt=new tn(o.context.gl.LEQUAL,et.isLightMesh?tn.ReadOnly:tn.ReadWrite,o.depthRangeFor3D),Tt=o.transform,Ct=et.mesh,Ut=Ct.material,Bt=Ut.pbrMetallicRoughness,$t=o.style.fog;let Zt;Zt=o.transform.projection.zAxisUnit==="pixels"?[...et.nodeModelMatrix]:c.aB([],rt.zScaleMatrix,et.nodeModelMatrix),c.aB(Zt,rt.negCameraPosMatrix,Zt);const qt=c.bl([],Zt);c.eg(qt,qt);const sr=_.paint.get("model-color-use-theme").constantOr("default")==="none",ir=_.paint.get("model-emissive-strength").constantOr(0),cr=sx(new Float32Array(et.worldViewProjection),new Float32Array(Zt),new Float32Array(qt),null,o,ut,Bt.baseColorFactor,Ut.emissiveFactor,Bt.metallicFactor,Bt.roughnessFactor,Ut,ir,_,void 0,void 0,et.materialOverride,et.modelColor),pr={defines:[]},ur=[],Cr=o.shadowRenderer;Cr&&(Cr.useNormalOffset=!1),n_(pr.defines,ur,Ct,o,sr?null:_.lut);let wr=null;if($t){const yr=s_(et.nodeModelMatrix,o.transform);if(wr=new Float32Array(yr),Tt.projection.name!=="globe"){const Pr=Ct.aabb.min,Or=Ct.aabb.max,[Nr,ts]=$t.getOpacityForBounds(yr,Pr[0],Pr[1],Or[0],Or[1]);pr.overrideFog=Nr>=hs||ts>=hs}}const Tr=Cm(o,_.paint.get("model-cutoff-fade-range"));Tr.shouldRenderCutoff&&pr.defines.push("RENDER_CUTOFF");const br=o.getOrCreateProgram("model",pr);o.uploadCommonUniforms(dt,br,null,wr,Tr),o.renderPass!=="shadow"&&Cr&&Cr.setupShadowsFromMatrix(et.nodeModelMatrix,br),br.draw(o,dt.gl.TRIANGLES,mt,ot,lt,Ct.material.doubleSided?mn.disabled:mn.backCCW,cr,_.id,Ct.vertexBuffer,Ct.indexBuffer,Ct.segments,_.paint,o.transform.zoom,void 0,ur)}function Dy(et,o){return et.style._importedAsBasemap?"basemap":o.scope}function ux(et,o,_,rt,ot,lt,ut,dt,mt,Tt){const Ct=et.transform,Ut=!!o.isGeometryBloom&&o.isGeometryBloom;if(Ut&&et.renderPass==="shadow")return;const Bt=Ct.projection.name==="globe"?c.eD(_,Ct):[..._];c.aB(Bt,Bt,o.globalMatrix);const $t=c.aB([],rt,Bt);if(o.meshes)for(const Zt of o.meshes){const qt=dt.get(Zt.material.name);if(qt&&qt.opacity<=0)continue;if(Zt.material.alphaMode!=="BLEND"){ut.push({mesh:Zt,depth:0,modelIndex:ot,worldViewProjection:$t,nodeModelMatrix:Bt,isLightMesh:Ut,materialOverride:qt,modelOpacity:mt,modelColor:Tt});continue}const sr=c.af([],Zt.centroid,$t);!Ct.isOrthographic&&sr[2]<=0||lt.push({mesh:Zt,depth:sr[2],modelIndex:ot,worldViewProjection:$t,nodeModelMatrix:Bt,isLightMesh:Ut,materialOverride:qt,modelOpacity:mt,modelColor:Tt})}if(o.children)for(const Zt of o.children)ux(et,Zt,_,rt,ot,lt,ut,dt,mt,Tt)}function Ap(et,o,_,rt){const ot=_.shadowRenderer;if(!ot)return;const lt=ot.getShadowPassDepthMode(),ut=ot.getShadowPassColorMode(),dt=ot.calculateShadowPassMatrixFromMatrix(o),mt=Lv(dt);_.getOrCreateProgram("modelDepth",{defines:_._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(_,_.context.gl.TRIANGLES,lt,gn.disabled,ut,mn.disabled,mt,rt.id,et.vertexBuffer,et.indexBuffer,et.segments,rt.paint,_.transform.zoom,void 0,void 0)}function $w(et,o,_,rt,ot,lt){for(const ut of ot){const dt=Object.assign({},rt);dt.part=ut;const mt={type:"Unknown",id:o,properties:dt},Tt={orientation:et.paint.get("model-rotation").evaluate(mt,_)};lt.set(ut,Tt)}}function Gw(et,o,_,rt,ot,lt){for(const ut of ot){const dt=Object.assign({},rt);dt.part=ut;const mt={type:"Unknown",id:o,properties:dt},Tt={color:et.paint.get("model-color").evaluate(mt,_),colorMix:et.paint.get("model-color-mix-intensity").evaluate(mt,_),opacity:et.paint.get("model-opacity").evaluate(mt,_),emissionStrength:et.paint.get("model-emissive-strength").evaluate(mt,_)};lt.set(ut,Tt)}}function Hw(et,o,_,rt,ot){let lt=!1;for(const dt of rt)dt.modelOpacity!==1&&(o_(dt,et,o,ot[dt.modelIndex],gn.disabled,jn.disabled),lt=!0);for(const dt of rt)o_(dt,et,o,ot[dt.modelIndex],dt.modelOpacity!==1?et.stencilModeFor3D():gn.disabled,et.colorModeForRenderPass());lt&&et.resetStencilClippingMasks();const ut=jn.additive;for(const dt of _)o_(dt,et,o,ot[dt.modelIndex],gn.disabled,dt.isLightMesh?ut:et.colorModeForRenderPass())}function Ww(et,o,_){const rt=o.updateZoomBasedPaintProperties(),ot=function(lt,ut,dt){let mt,Tt,Ct,Ut=lt.terrain?lt.terrain.exaggeration():0;if(lt.terrain&&Ut>0){const Bt=lt.terrain,$t=Bt.findDEMTileFor(dt);$t&&$t.dem?mt=c.eF.create(Bt,dt,$t):Ut=0}if(Ut===0&&(ut.terrainElevationMin=0,ut.terrainElevationMax=0),Ut===ut.validForExaggeration&&(Ut===0||mt&&mt._demTile&&mt._demTile.tileID===ut.validForDEMTile.id&&mt._dem._timestamp===ut.validForDEMTile.timestamp))return!1;for(const Bt in ut.instancesPerModel){const $t=ut.instancesPerModel[Bt];for(let Zt=0;Zt<$t.instancedDataArray.length;++Zt){const qt=(mt?Ut*mt.getElevationAt(0|$t.instancedDataArray.float32[16*Zt],0|$t.instancedDataArray.float32[16*Zt+1],!0,!0):0)+$t.instancesEvaluatedElevation[Zt];$t.instancedDataArray.float32[16*Zt+6]=qt,Tt=Tt?Math.min(ut.terrainElevationMin,qt):qt,Ct=Ct?Math.max(ut.terrainElevationMax,qt):qt}}return ut.terrainElevationMin=Tt||0,ut.terrainElevationMax=Ct||0,ut.validForExaggeration=Ut,ut.validForDEMTile=mt&&mt._demTile?{id:mt._demTile.tileID,timestamp:mt._dem._timestamp}:{id:void 0,timestamp:0},!0}(et,o,_);(rt||ot)&&(o.uploaded=!1,o.upload(et.context))}const $p={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new c.d9([0,0,0],[c.al,c.al,0])};function Fu(et,o){const _=1<<et.canonical.z,rt=o.getFreeCameraOptions().position,ot=o.elevation,lt=et.canonical.x/_,ut=(et.canonical.x+1)/_,dt=et.canonical.y/_,mt=(et.canonical.y+1)/_;let Tt=o._centerAltitude;if(ot){const $t=ot.getMinMaxForTile(et);$t&&$t.max>Tt&&(Tt=$t.max)}const Ct=c.aA(rt.x,lt,ut)-rt.x,Ut=c.aA(rt.y,dt,mt)-rt.y,Bt=c.cf(Tt,o.center.lat)-rt.z;return o._zoomFromMercatorZ(Math.sqrt(Ct*Ct+Ut*Ut+Bt*Bt))}function qw(et,o,_,rt,ot,lt,ut){const dt=et.context,mt=et.renderPass==="shadow",Tt=et.shadowRenderer,Ct=mt&&Tt?Tt.getShadowPassDepthMode():new tn(dt.gl.LEQUAL,tn.ReadWrite,et.depthRangeFor3D),Ut=et.isTileAffectedByFog(lt),Bt=et.transform.projection.name==="globe";if(_.meshes)for(const $t of _.meshes){const Zt=Bt?[]:["MODEL_POSITION_ON_GPU"],qt=[];let sr,ir,cr;const pr=!Bt&&rt.instancedDataArray.length>20;pr&&Zt.push("INSTANCED_ARRAYS");const ur=Cm(et,o.paint.get("model-cutoff-fade-range"));if(ur.shouldRenderCutoff&&Zt.push("RENDER_CUTOFF"),mt&&Tt)sr=et.getOrCreateProgram("modelDepth",{defines:Zt}),ir=Lv(ut.shadowTileMatrix,ut.shadowTileMatrix,Float32Array.from(_.globalMatrix)),cr=Tt.getShadowPassColorMode();else{n_(Zt,qt,$t,et,o.paint.get("model-color-use-theme").constantOr("default")==="none"?null:o.lut),sr=et.getOrCreateProgram("model",{defines:Zt,overrideFog:Ut});const wr=$t.material,Tr=wr.pbrMetallicRoughness,br=o.paint.get("model-opacity").constantOr(1),yr=o.paint.get("model-emissive-strength").constantOr(0);ir=sx(lt.expandedProjMatrix,Float32Array.from(_.globalMatrix),new Float32Array(16),null,et,br,Tr.baseColorFactor,wr.emissiveFactor,Tr.metallicFactor,Tr.roughnessFactor,wr,yr,o,ot),Tt&&(ut.shadowUniformsInitialized?sr.setShadowUniformValues(dt,Tt.getShadowUniformValues()):(Tt.setupShadows(lt.toUnwrapped(),sr,"model-tile"),ut.shadowUniformsInitialized=!0)),cr=ur.shouldRenderCutoff||br<1||wr.alphaMode!=="OPAQUE"?jn.alphaBlended:jn.unblended}et.uploadCommonUniforms(dt,sr,lt.toUnwrapped(),null,ur);const Cr=$t.material.doubleSided?mn.disabled:mn.backCCW;if(pr)qt.push(rt.instancedDataBuffer),sr.draw(et,dt.gl.TRIANGLES,Ct,gn.disabled,cr,Cr,ir,o.id,$t.vertexBuffer,$t.indexBuffer,$t.segments,o.paint,et.transform.zoom,void 0,qt,rt.instancedDataArray.length);else{const wr=mt?"u_instance":"u_normal_matrix";for(let Tr=0;Tr<rt.instancedDataArray.length;++Tr)ir[wr]=new Float32Array(rt.instancedDataArray.arrayBuffer,64*Tr,16),sr.draw(et,dt.gl.TRIANGLES,Ct,gn.disabled,cr,Cr,ir,o.id,$t.vertexBuffer,$t.indexBuffer,$t.segments,o.paint,et.transform.zoom,void 0,qt)}}if(_.children)for(const $t of _.children)qw(et,o,$t,rt,ot,lt,ut)}const Ny=[1,-1,1];function y2(et,o,_,rt){if(!_.modelManager)return!0;const ot=_.modelManager;if(!_.shadowRenderer)return!0;const lt=_.shadowRenderer,ut=o.aabb;let dt=!0,mt=et.maxHeight;if(mt===0){let Ct=0;for(const Ut in et.instancesPerModel){const Bt=ot.getModel(Ut,rt);Bt?Ct=Math.max(Ct,Math.max(Math.max(Bt.aabb.max[0],Bt.aabb.max[1]),Bt.aabb.max[2])):dt=!1}mt=et.maxScale*Ct*1.41+et.maxVerticalOffset,dt&&(et.maxHeight=mt)}ut.max[2]=mt,ut.min[2]+=et.terrainElevationMin,ut.max[2]+=et.terrainElevationMax,c.af(ut.min,ut.min,o.tileMatrix),c.af(ut.max,ut.max,o.tileMatrix);const Tt=ut.intersects(lt.getCurrentCascadeFrustum());return _.currentShadowCascade===0&&(et.isInsideFirstShadowMapFrustum=Tt===2),Tt===0}function Xo(et,o){const _=et.uniformValues.u_cutoff_params[0],rt=et.uniformValues.u_cutoff_params[1],ot=et.uniformValues.u_cutoff_params[2],lt=et.uniformValues.u_cutoff_params[3];return rt===_||lt===ot?1:c.aA(((o-_)/(rt-_)-ot)/(lt-ot),0,1)}function Vn(et,o,_,rt){if(o.pitch<20)return 1;const ot=o.getWorldToCameraMatrix();c.aB(ot,ot,et);const lt=c.bU(_.min[0],_.min[1],_.min[2],1);let ut=c.aC(c.eG(),lt,ot),dt=ut,mt=ut;lt[1]=_.max[1],ut=c.aC(c.eG(),lt,ot),dt=ut[1]<dt[1]?ut:dt,mt=ut[1]>mt[1]?ut:mt,lt[0]=_.max[0],ut=c.aC(c.eG(),lt,ot),dt=ut[1]<dt[1]?ut:dt,mt=ut[1]>mt[1]?ut:mt,lt[1]=_.min[1],ut=c.aC(c.eG(),lt,ot),dt=ut[1]<dt[1]?ut:dt,mt=ut[1]>mt[1]?ut:mt;const Tt=c.aA(rt[0],0,1),Ct=100*o.pixelsPerMeter*c.aA(rt[1],0,1),Ut=c.aA(rt[2],0,1),Bt=c.eH(c.eG(),dt,mt,Tt),$t=Math.tan(.5*o.fovX),Zt=-Bt[2]*$t;if(Ct===0)return Bt[1]<-Math.abs(Zt)?Ut:1;const qt=(-Math.abs(Zt)-Bt[1])/Ct,sr=(cr,pr,ur)=>(1-ur)*cr+ur*pr,ir=c.aA(sr(1,Ut,qt),Ut,1);return sr(1,ir,c.aA((o.pitch-20)/20,0,1))}class Zw{}class Nm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(o,_,rt){{const Ut=this._storage.get(_.id);if(Ut)return Ut.lastUsedFrameIdx=o,Ut.buf}const ot=rt.gl,lt=ot.getBufferParameter(ot.ELEMENT_ARRAY_BUFFER,ot.BUFFER_SIZE),ut=new ArrayBuffer(lt),dt=new Int16Array(ut);ot.getBufferSubData(ot.ELEMENT_ARRAY_BUFFER,0,new Int16Array(ut));const mt=new c.eJ;for(let Ut=0;Ut<lt/2;Ut+=3){const Bt=dt[Ut],$t=dt[Ut+1],Zt=dt[Ut+2];mt.emplaceBack(Bt,$t),mt.emplaceBack($t,Zt),mt.emplaceBack(Zt,Bt)}const Tt=rt.bindVertexArrayOES.current,Ct=new Zw;return Ct.buf=new Cp(rt,mt),Ct.lastUsedFrameIdx=o,this._storage.set(_.id,Ct),rt.bindVertexArrayOES.set(Tt),Ct.buf}update(o){for(const[_,rt]of this._storage)o-rt.lastUsedFrameIdx>30&&(rt.buf.destroy(),this._storage.delete(_))}destroy(){for(const[o,_]of this._storage)_.buf.destroy(),this._storage.delete(o)}}class Ox{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const Bx=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class om{constructor(o){this.revealStart=11,this.revealRange=2}}const Vv=c.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Uv{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(o,_){const rt=o.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const ut=new c.eK,dt=new c.b0;ut.emplaceBack(-1,-1),ut.emplaceBack(1,-1),ut.emplaceBack(1,1),ut.emplaceBack(-1,1),dt.emplaceBack(0,1,2),dt.emplaceBack(0,2,3),this.vignetteVx=o.context.createVertexBuffer(ut,Vv.members),this.vignetteIdx=o.context.createIndexBuffer(dt)}const ot=c.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){o.uploadCommonUniforms(o.context,rt);const ut={u_vignetteShape:(lt={vignetteShape:[_.start,_.range,Math.pow(10,_.fadePower)],vignetteColor:[_.color.r,_.color.g,_.color.b,_.color.a*_.strength]}).vignetteShape,u_vignetteColor:lt.vignetteColor};rt.draw(o,o.context.gl.TRIANGLES,tn.disabled,gn.disabled,jn.alphaBlended,mn.disabled,ut,"vignette",this.vignetteVx,this.vignetteIdx,ot)}var lt}}class $v{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(o,_){const rt=o.getFreeCameraOptions().position,ot=rt.toAltitude(),lt=rt.toLngLat(),ut=c.an(lt.lng),dt=c.an(lt.lat),mt=o.pixelsPerMeter/_,Tt=ut*c.eM,Ct=c.eM*Math.log(Math.tan(Math.PI/4+dt/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Ut=-this._offsetYPrev+Ct,Bt=-this._elevationPrev+ot;this._accumulatedOffsetX+=(-this._offsetXPrev+Tt)*mt,this._accumulatedOffsetY+=Ut*mt,this._accumulatedElevation+=Bt*mt,this._offsetXPrev=Tt,this._offsetYPrev=Ct,this._elevationPrev=ot}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function a_(et,o){return[-(et[0]-Math.floor(et[0]/o)*o),-(et[1]-Math.floor(et[1]/o)*o),-(et[2]-Math.floor(et[2]/o)*o)]}function ep(et){const o=c.eq(1323123451230),_=[];for(let rt=0;rt<et;++rt){const ot=2*o()-1,lt=2*o()-1,ut=2*o()-1;_.push(c.d5(ot,lt,ut))}return _}function Gu(et,o,_,rt,ot){const lt=c.aA((ot-_)/(rt-_),0,1);return(1-lt)*et+lt*o}class hx{constructor(o){this._movement=new $v,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Uv,this._ppmScaleFactor=o}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(o,_){const rt=o.transform;this._movement.update(rt,this._ppmScaleFactor);const ot=rt.starsProjMatrix,lt=c.c7([]);c.c9(lt,lt,c.an(90)-rt._pitch),c.c8(lt,lt,-rt.angle);const ut=c.cc(new Float32Array(16),lt),dt=c.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),mt=c.eg([],dt),Tt=c.aB([],mt,ut),Ct=Date.now()/1e3;return this._accumulatedTimeFromStart+=(Ct-this._prevTime)*_,this._prevTime=Ct,{projectionMatrix:ot,modelviewMatrix:Tt}}}class l_ extends hx{constructor(o){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new om("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(o){const _=o.context;if(!this.particlesVx){const rt=ep(this.particlesCount),ot=new c.eN,lt=new c.b0;let ut=0;const dt=c.eq(1323123451230);for(let mt=0;mt<rt.length;++mt){const Tt=rt[mt],Ct=[2*dt()-1,dt(),dt(),dt()];ot.emplaceBack(Tt[0],Tt[1],Tt[2],-1,-1,...Ct),ot.emplaceBack(Tt[0],Tt[1],Tt[2],1,-1,...Ct),ot.emplaceBack(Tt[0],Tt[1],Tt[2],1,1,...Ct),ot.emplaceBack(Tt[0],Tt[1],Tt[2],-1,1,...Ct),lt.emplaceBack(ut+0,ut+1,ut+2),lt.emplaceBack(ut+0,ut+2,ut+3),ut+=4}this.particlesVx=_.createVertexBuffer(ot,Bx.members),this.particlesIdx=_.createIndexBuffer(lt)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.rain)return;const _=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},rt=o.transform.zoom;if(_.revealStart>rt)return;const ot=Gu(0,1,_.revealStart,_.revealStart+_.revealRange,rt);if(!this.particlesVx||!this.particlesIdx)return;const lt=structuredClone(this._params);let ut=[-lt.direction.x,lt.direction.y,-100];c.aw(ut,ut);const dt=structuredClone(this._vignetteParams);dt.strength*=ot,lt.overrideStyleParameters||(lt.intensity=o.style.rain.state.density,lt.timeFactor=o.style.rain.state.intensity,lt.color=structuredClone(o.style.rain.state.color),ut=structuredClone(o.style.rain.state.direction),lt.screenThinning.intensity=o.style.rain.state.centerThinning,lt.dropletSizeX=o.style.rain.state.dropletSize[0],lt.dropletSizeYScale=o.style.rain.state.dropletSize[1]/o.style.rain.state.dropletSize[0],lt.distortionStrength=100*o.style.rain.state.distortionStrength,dt.strength=1,dt.color=structuredClone(o.style.rain.state.vignetteColor));const mt=this.updateOnRender(o,lt.timeFactor),Tt=o.context,Ct=Tt.gl,Ut=o.transform;this.screenTexture&&this.screenTexture.size[0]===o.width&&this.screenTexture.size[1]===o.height||(this.screenTexture=new c.T(Tt,{width:o.width,height:o.height,data:null},Ct.RGBA8)),lt.distortionStrength>0&&(Tt.activeTexture.set(Ct.TEXTURE0),this.screenTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE),Ct.copyTexSubImage2D(Ct.TEXTURE_2D,0,0,0,0,0,o.width,o.height));const Bt=o.getOrCreateProgram("rainParticle");o.uploadCommonUniforms(Tt,Bt),Tt.activeTexture.set(Ct.TEXTURE0),this.screenTexture.bind(Ct.LINEAR,Ct.CLAMP_TO_EDGE);const $t=[lt.color.r,lt.color.g,lt.color.b,lt.color.a],Zt=(qt,sr)=>{const ir=a_(this._movement.getPosition(),qt),cr=lt.dropletSizeX,pr=lt.dropletSizeX*lt.dropletSizeYScale,ur=o.width/2,Cr=o.height/2,wr=Gu(0,lt.screenThinning.start,0,1,lt.screenThinning.intensity),Tr=Gu(.001,lt.screenThinning.range,0,1,lt.screenThinning.intensity),br=Gu(0,lt.screenThinning.particleOffset,0,1,lt.screenThinning.intensity),yr=(Pr={modelview:mt.modelviewMatrix,projection:mt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ir,velocityConeAperture:lt.velocityConeAperture,velocity:lt.velocity,boxSize:qt,rainDropletSize:[cr,pr],distortionStrength:lt.distortionStrength,rainDirection:ut,color:$t,screenSize:[Ut.width,Ut.height],thinningCenterPos:[ur,Cr],thinningShape:[wr,Tr,Math.pow(10,lt.screenThinning.fadePower)],thinningAffectedRatio:lt.screenThinning.affectedRatio,thinningParticleOffset:br,shapeDirectionalPower:lt.shapeDirPower,shapeNormalPower:lt.shapeNormalPower,mode:sr?0:1},{u_modelview:Float32Array.from(Pr.modelview),u_projection:Float32Array.from(Pr.projection),u_time:Pr.time,u_cam_pos:Pr.camPos,u_texScreen:0,u_velocityConeAperture:Pr.velocityConeAperture,u_velocity:Pr.velocity,u_boxSize:Pr.boxSize,u_rainDropletSize:Pr.rainDropletSize,u_distortionStrength:Pr.distortionStrength,u_rainDirection:Pr.rainDirection,u_color:Pr.color,u_screenSize:Pr.screenSize,u_thinningCenterPos:Pr.thinningCenterPos,u_thinningShape:Pr.thinningShape,u_thinningAffectedRatio:Pr.thinningAffectedRatio,u_thinningParticleOffset:Pr.thinningParticleOffset,u_shapeDirectionalPower:Pr.shapeDirectionalPower,u_shapeNormalPower:Pr.shapeNormalPower,u_mode:Pr.mode});var Pr;const Or=Math.round(lt.intensity*this.particlesCount),Nr=c.bg.simpleSegment(0,0,4*Or,2*Or);Bt.draw(o,Ct.TRIANGLES,tn.disabled,gn.disabled,jn.alphaBlended,mn.disabled,yr,"rain_particles",this.particlesVx,this.particlesIdx,Nr)};lt.distortionStrength>0&&Zt(lt.boxSize,!0),Zt(lt.boxSize,!1),this._vignette.draw(o,dt)}}const Gv=c.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Hv extends hx{constructor(o){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new om("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(o){const _=o.context;if(!this.particlesVx){const rt=ep(this.particlesCount),ot=new c.eO,lt=new c.b0;let ut=0;const dt=c.eq(1323123451230);for(let mt=0;mt<rt.length;++mt){const Tt=rt[mt],Ct=dt(),Ut=dt(),Bt=dt(),$t=[mt/rt.length,Ct,Ut,Bt],Zt=[dt(),dt()];ot.emplaceBack(Tt[0],Tt[1],Tt[2],-1,-1,...$t,...Zt),ot.emplaceBack(Tt[0],Tt[1],Tt[2],1,-1,...$t,...Zt),ot.emplaceBack(Tt[0],Tt[1],Tt[2],1,1,...$t,...Zt),ot.emplaceBack(Tt[0],Tt[1],Tt[2],-1,1,...$t,...Zt),lt.emplaceBack(ut+0,ut+1,ut+2),lt.emplaceBack(ut+0,ut+2,ut+3),ut+=4}this.particlesVx=_.createVertexBuffer(ot,Gv.members),this.particlesIdx=_.createIndexBuffer(lt)}}draw(o){if(!this._params.overrideStyleParameters&&!o.style.snow)return;const _=structuredClone(this._params);let rt=[-_.direction.x,_.direction.y,-100];c.aw(rt,rt);const ot=structuredClone(this._vignetteParams),lt=_.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},ut=o.transform.zoom;if(lt.revealStart>ut)return;const dt=Gu(0,1,lt.revealStart,lt.revealStart+lt.revealRange,ut);ot.strength*=dt,_.overrideStyleParameters||(_.intensity=o.style.snow.state.density,_.timeFactor=o.style.snow.state.intensity,_.color=structuredClone(o.style.snow.state.color),rt=structuredClone(o.style.snow.state.direction),_.screenThinning.intensity=o.style.snow.state.centerThinning,_.billboardSize=2.79*o.style.snow.state.flakeSize,ot.strength=1,ot.color=structuredClone(o.style.snow.state.vignetteColor));const mt=this.updateOnRender(o,_.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const Tt=o.context,Ct=Tt.gl,Ut=o.transform,Bt=o.getOrCreateProgram("snowParticle");o.uploadCommonUniforms(Tt,Bt),(($t,Zt,qt)=>{const sr=a_(this._movement.getPosition(),$t),ir=Ut.width/2,cr=Ut.height/2,pr=Gu(0,qt.screenThinning.start,0,1,qt.screenThinning.intensity),ur=Gu(.001,qt.screenThinning.range,0,1,qt.screenThinning.intensity),Cr=Gu(0,qt.screenThinning.particleOffset,0,1,qt.screenThinning.intensity),wr=(Tr={modelview:mt.modelviewMatrix,projection:mt.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:sr,velocityConeAperture:qt.velocityConeAperture,velocity:qt.velocity,horizontalOscillationRadius:qt.horizontalOscillationRadius,horizontalOscillationRate:qt.horizontalOscillationRate,boxSize:$t,billboardSize:1*qt.billboardSize,simpleShapeParameters:[qt.shapeFadeStart,qt.shapeFadePower],screenSize:[Ut.width,Ut.height],thinningCenterPos:[ir,cr],thinningShape:[pr,ur,Math.pow(10,qt.screenThinning.fadePower)],thinningAffectedRatio:qt.screenThinning.affectedRatio,thinningParticleOffset:Cr,color:[qt.color.r,qt.color.g,qt.color.b,qt.color.a],direction:rt},{u_modelview:Float32Array.from(Tr.modelview),u_projection:Float32Array.from(Tr.projection),u_time:Tr.time,u_cam_pos:Tr.camPos,u_velocityConeAperture:Tr.velocityConeAperture,u_velocity:Tr.velocity,u_horizontalOscillationRadius:Tr.horizontalOscillationRadius,u_horizontalOscillationRate:Tr.horizontalOscillationRate,u_boxSize:Tr.boxSize,u_billboardSize:Tr.billboardSize,u_simpleShapeParameters:Tr.simpleShapeParameters,u_screenSize:Tr.screenSize,u_thinningCenterPos:Tr.thinningCenterPos,u_thinningShape:Tr.thinningShape,u_thinningAffectedRatio:Tr.thinningAffectedRatio,u_thinningParticleOffset:Tr.thinningParticleOffset,u_particleColor:Tr.color,u_direction:Tr.direction});var Tr;const br=Math.round(qt.intensity*this.particlesCount),yr=c.bg.simpleSegment(0,0,4*br,2*br);this.particlesVx&&this.particlesIdx&&Bt.draw(o,Ct.TRIANGLES,tn.disabled,gn.disabled,jn.alphaBlended,mn.disabled,wr,"snow_particles",this.particlesVx,this.particlesIdx,yr)})(_.boxSize,0,_),this._vignette.draw(o,ot)}}const zm={symbol:function(et,o,_,rt,ot){if(et.renderPass!=="translucent")return;const lt=gn.disabled,ut=et.colorModeForRenderPass(),dt=_.layout.get("text-variable-anchor"),mt=_.layout.get("text-size-scale-range"),Tt=c.aA(et.scaleFactor,mt[0],mt[1]);dt&&function(Bt,$t,Zt,qt,sr,ir,cr,pr){const ur=$t.transform,Cr=sr==="map",wr=ir==="map";for(const Tr of Bt){const br=qt.getTile(Tr),yr=br.getBucket(Zt);if(!yr||!yr.text||!yr.text.segments.get().length)continue;const Pr=c.bK(yr.textSizeData,ur.zoom,pr),Or=Dp(Tr,yr.getProjection(),ur),Nr=ur.calculatePixelsToTileUnitsMatrix(br),ts=Au(Or,br.tileID.canonical,wr,Cr,ur,yr.getProjection(),Nr),rs=yr.hasIconTextFit()&&yr.hasIconData();Pr&&un(yr,Cr,wr,cr,ur,ts,Tr,Math.pow(2,ur.zoom-br.tileID.overscaledZ),Pr,rs)}}(rt,et,_,o,_.layout.get("text-rotation-alignment"),_.layout.get("text-pitch-alignment"),ot,Tt);const Ct=_.paint.get("icon-opacity").constantOr(1)!==0,Ut=_.paint.get("text-opacity").constantOr(1)!==0;_.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(Ct||Ut)?My(et,o,_,rt,lt,ut):(Ct&&My(et,o,_,rt,lt,ut,{onlyIcons:!0}),Ut&&My(et,o,_,rt,lt,ut,{onlyText:!0})),o.map.showCollisionBoxes&&(Xs(et,o,_,rt,_.paint.get("text-translate"),_.paint.get("text-translate-anchor"),!0),Xs(et,o,_,rt,_.paint.get("icon-translate"),_.paint.get("icon-translate-anchor"),!1))},circle:function(et,o,_,rt){if(et.renderPass!=="translucent")return;const ot=_.paint.get("circle-opacity"),lt=_.paint.get("circle-stroke-width"),ut=_.paint.get("circle-stroke-opacity"),dt=_.layout.get("circle-sort-key").constantOr(1)!==void 0,mt=_.paint.get("circle-emissive-strength");if(ot.constantOr(1)===0&&(lt.constantOr(1)===0||ut.constantOr(1)===0))return;const Tt=et.context,Ct=Tt.gl,Ut=et.transform,Bt=!(!et.terrain||!et.terrain.enabled),$t=_.layout.get("circle-elevation-reference"),Zt=et.depthModeForSublayer(0,tn.ReadOnly),qt=new tn(et.context.gl.LEQUAL,tn.ReadOnly,et.depthRangeFor3D),sr=$t==="none"||Bt?Zt:qt,ir=gn.disabled,cr=et.colorModeForDrapableLayerRenderPass(mt),pr=Ut.projection.name==="globe",ur=[c.aF(Ut.center.lng),c.aJ(Ut.center.lat)],Cr=[];for(let Tr=0;Tr<rt.length;Tr++){const br=rt[Tr],yr=o.getTile(br),Pr=yr.getBucket(_);if(!Pr||Pr.projection.name!==Ut.projection.name)continue;const Or=Pr.programConfigurations.get(_.id),Nr=Pr.layoutVertexBuffer,ts=Pr.globeExtVertexBuffer,rs=Pr.indexBuffer,cs=c.e0(_),Ss=[ts],Zr=et.isTileAffectedByFog(br);pr&&cs.push("PROJECTION_GLOBE_VIEW"),cs.push("DEPTH_D24"),et.terrain&&Ut.depthOcclusionForSymbolsAndCircles&&cs.push("DEPTH_OCCLUSION"),Pr.hasElevation&&!et.terrain&&(cs.push("ELEVATED_ROADS"),Ss.push(Pr.elevatedLayoutVertexBuffer));const Fr=et.getOrCreateProgram("circle",{config:Or,defines:cs,overrideFog:Zr}),ns=Ut.projection.createInversionMatrix(Ut,br.canonical),Qr={programConfiguration:Or,program:Fr,layoutVertexBuffer:Nr,dynamicBuffers:Ss,indexBuffer:rs,uniformValues:c.e1(et,br,yr,ns,ur,_),tile:yr};if(dt){const gs=Pr.segments.get();for(const ks of gs)Cr.push({segments:new c.bg([ks]),sortKey:ks.sortKey,state:Qr})}else Cr.push({segments:Pr.segments,sortKey:0,state:Qr})}dt&&Cr.sort((Tr,br)=>Tr.sortKey-br.sortKey);const wr={useDepthForOcclusion:Ut.depthOcclusionForSymbolsAndCircles};for(const Tr of Cr){const{programConfiguration:br,program:yr,layoutVertexBuffer:Pr,dynamicBuffers:Or,indexBuffer:Nr,uniformValues:ts,tile:rs}=Tr.state,cs=Tr.segments;et.terrain&&et.terrain.setupElevationDraw(rs,yr,wr),et.uploadCommonUniforms(Tt,yr,rs.tileID.toUnwrapped()),yr.draw(et,Ct.TRIANGLES,sr,ir,cr,mn.disabled,ts,_.id,Pr,Nr,cs,_.paint,Ut.zoom,br,Or)}},heatmap:function(et,o,_,rt){if(_.paint.get("heatmap-opacity")!==0)if(et.renderPass==="offscreen"){const ot=et.context,lt=ot.gl,ut=gn.disabled,dt=new jn([lt.ONE,lt.ONE,lt.ONE,lt.ONE],c.ao.transparent,[!0,!0,!0,!0]);(function($t,Zt,qt,sr){const ir=$t.gl,cr=Zt.width*sr,pr=Zt.height*sr;$t.activeTexture.set(ir.TEXTURE1),$t.viewport.set([0,0,cr,pr]);let ur=qt.heatmapFbo;if(!ur||ur&&(ur.width!==cr||ur.height!==pr)){ur&&ur.destroy();const Cr=ir.createTexture();ir.bindTexture(ir.TEXTURE_2D,Cr),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_S,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_WRAP_T,ir.CLAMP_TO_EDGE),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MIN_FILTER,ir.LINEAR),ir.texParameteri(ir.TEXTURE_2D,ir.TEXTURE_MAG_FILTER,ir.LINEAR),ur=qt.heatmapFbo=$t.createFramebuffer(cr,pr,1,null),function(wr,Tr,br,yr,Pr,Or){const Nr=wr.gl;Nr.texImage2D(Nr.TEXTURE_2D,0,wr.extRenderToTextureHalfFloat?Nr.RGBA16F:Nr.RGBA,Pr,Or,0,Nr.RGBA,wr.extRenderToTextureHalfFloat?Nr.HALF_FLOAT:Nr.UNSIGNED_BYTE,null),yr.colorAttachment0.set(br)}($t,0,Cr,ur,cr,pr)}else ir.bindTexture(ir.TEXTURE_2D,ur.colorAttachment0.get()),$t.bindFramebuffer.set(ur.framebuffer)})(ot,et,_,et.transform.projection.name==="globe"?.5:.25),ot.clear({color:c.ao.transparent});const mt=et.transform,Tt=mt.projection.name==="globe",Ct=Tt?["PROJECTION_GLOBE_VIEW"]:[],Ut=Tt?mn.frontCCW:mn.disabled,Bt=[c.aF(mt.center.lng),c.aJ(mt.center.lat)];for(let $t=0;$t<rt.length;$t++){const Zt=rt[$t];if(o.hasRenderableParent(Zt))continue;const qt=o.getTile(Zt),sr=qt.getBucket(_);if(!sr||sr.projection.name!==mt.projection.name)continue;const ir=et.isTileAffectedByFog(Zt),cr=sr.programConfigurations.get(_.id),pr=et.getOrCreateProgram("heatmap",{config:cr,defines:Ct,overrideFog:ir}),{zoom:ur}=et.transform;et.terrain&&et.terrain.setupElevationDraw(qt,pr),et.uploadCommonUniforms(ot,pr,Zt.toUnwrapped());const Cr=mt.projection.createInversionMatrix(mt,Zt.canonical);pr.draw(et,lt.TRIANGLES,tn.disabled,ut,dt,Ut,Cw(et,Zt,qt,Cr,Bt,ur,_.paint.get("heatmap-intensity")),_.id,sr.layoutVertexBuffer,sr.indexBuffer,sr.segments,_.paint,et.transform.zoom,cr,Tt?[sr.globeExtVertexBuffer]:null)}ot.viewport.set([0,0,et.width,et.height])}else et.renderPass==="translucent"&&(et.context.setColorMode(et.colorModeForRenderPass()),function(ot,lt){const ut=ot.context,dt=ut.gl,mt=lt.heatmapFbo;if(!mt)return;ut.activeTexture.set(dt.TEXTURE0),dt.bindTexture(dt.TEXTURE_2D,mt.colorAttachment0.get()),ut.activeTexture.set(dt.TEXTURE1);let Tt=lt.colorRampTexture;Tt||(Tt=lt.colorRampTexture=new c.T(ut,lt.colorRamp,dt.RGBA8)),Tt.bind(dt.LINEAR,dt.CLAMP_TO_EDGE),ot.getOrCreateProgram("heatmapTexture").draw(ot,dt.TRIANGLES,tn.disabled,gn.disabled,ot.colorModeForRenderPass(),mn.disabled,((Ct,Ut,Bt,$t)=>({u_image:0,u_color_ramp:1,u_opacity:Ut.paint.get("heatmap-opacity")}))(0,lt),lt.id,ot.viewportBuffer,ot.quadTriangleIndexBuffer,ot.viewportSegments,lt.paint,ot.transform.zoom)}(et,_))},line:function(et,o,_,rt){if(et.renderPass!=="translucent")return;const ot=_.paint.get("line-opacity"),lt=_.paint.get("line-width");if(ot.constantOr(1)===0||lt.constantOr(1)===0)return;const ut=_.paint.get("line-emissive-strength").isConstant(),dt=_.paint.get("line-emissive-strength").constantOr(0),mt=_.paint.get("line-occlusion-opacity"),Tt=_.layout.get("line-elevation-reference"),Ct=_.layout.get("line-width-unit")==="meters",Ut=Tt==="sea",Bt=!(!et.terrain||!et.terrain.enabled),$t=et.context,Zt=$t.gl;if(_.hasElevatedBuckets&&et.transform.projection.name==="globe")return;const qt=_.layout.get("line-cross-slope"),sr=qt!==void 0,ir=qt<1,cr=et.colorModeForDrapableLayerRenderPass(ut?dt:null),pr=et.terrain&&et.terrain.renderingToTexture,ur=pr?1:c.o.devicePixelRatio,Cr=_.paint.get("line-dasharray"),wr=Cr.constantOr(1),Tr=_.layout.get("line-cap"),br=Cr.constantOr(null),yr=Tr.constantOr(null),Pr=_.paint.get("line-pattern"),Or=Pr.constantOr(1),Nr=_.paint.get("line-pattern-cross-fade"),ts=Pr.constantOr(null),rs=_.paint.get("line-opacity").constantOr(1);let cs=!Or&&rs!==1||et.depthOcclusion&&mt>0&&mt<1;const Ss=_.paint.get("line-gradient"),Zr=Or?"linePattern":"line",Fr=c.e2(_);let ns;if(pr&&et.terrain&&et.terrain.clipOrMaskOverlapStencilType()&&(cs=!1),mt!==0&&et.depthOcclusion){const Bs=_.paint._values["line-opacity"];Bs&&Bs.value&&Bs.value.kind==="constant"?ns=Bs.value:c.w(`Occlusion opacity for layer ${_.id} is supported only when line-opacity isn't data-driven.`)}lt.value.kind!=="constant"&&lt.value.isLineProgressConstant===!1&&Fr.push("VARIABLE_LINE_WIDTH"),pr&&(et.emissiveMode!=="dual-source-blending"||ut?et.emissiveMode==="mrt-fallback"&&Fr.push("USE_MRT1"):Fr.push("DUAL_SOURCE_BLENDING"));const Qr=(Bs,js,Ts,Js,Ks,Ns)=>{for(const Gs of Bs){const ln=o.getTile(Gs);if(Or&&!ln.patternsLoaded())continue;const En=ln.getBucket(_);if(!En||En.elevationType!=="none"&&!Ks||En.elevationType==="none"&&Ks)continue;et.prepareDrawTile();const Hn=[...js],ho=et.shadowRenderer,en=En.elevationType==="road"&&!!ho&&ho.enabled;let ao=[0,0,0];if(en){const Mn=et.style.directionalLight,Zo=et.style.ambientLight;Mn&&Zo&&(ao=Jp(et.style,Mn,Zo)),Hn.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const bn=En.programConfigurations.get(_.id);let mo=!1;if(ts&&ln.imageAtlas){const Mn=c.e3.from(ts),Zo=Mn.getPrimary().scaleSelf(ur).toString(),Al=ln.imageAtlas.patternPositions.get(Zo),xa=Mn.getSecondary(),ko=xa?ln.imageAtlas.patternPositions.get(xa.scaleSelf(ur).toString()):null;mo=!!Al&&!!ko,Al&&bn.setConstantPatternPositions(Al,ko)}Nr>0&&(mo||bn.getPatternTransitionVertexBuffer("line-pattern"))&&Hn.push("LINE_PATTERN_TRANSITION");const To=et.isTileAffectedByFog(Gs),bo=et.getOrCreateProgram(Zr,{config:bn,defines:Hn,overrideFog:To});if(!Or&&br&&yr&&ln.lineAtlas){const Mn=ln.lineAtlas.getDash(br,yr);Mn&&bn.setConstantPatternPositions(Mn)}en&&ho.setupShadows(ln.tileID.toUnwrapped(),bo,"vector-tile");let[no,kn]=_.paint.get("line-trim-offset");(yr==="round"||yr==="square")&&no!==kn&&(no===0&&(no-=1),kn===1&&(kn+=1));const po=pr?Gs.projMatrix:null,yl=Ct?1/En.tileToMeter/c.ay(ln,1,et.transform.zoom):1,Ko=Ct?1/En.tileToMeter/c.ay(ln,1,Math.floor(et.transform.zoom)):1,go=Or?c.e4(et,ln,_,po,ur,yl,Ko,[no,kn],ao,Nr):c.e5(et,ln,_,po,En.lineClipsArray.length,ur,yl,Ko,[no,kn],ao);if(Ss){const Mn=En.gradients[_.id];let Zo=Mn.texture;if(_.gradientVersion!==Mn.version){let Al=256;if(_.stepInterpolant){const xa=o.getSource().maxzoom,ko=Gs.canonical.z===xa?Math.ceil(1<<et.transform.maxZoom-Gs.canonical.z):1;Al=c.aA(c.e6(En.maxLineLength/c.al*1024*ko),256,$t.maxTextureSize)}Mn.gradient=c.e7({expression:_.gradientExpression(),evaluationKey:"lineProgress",resolution:Al,image:Mn.gradient||void 0,clips:En.lineClipsArray}),Mn.texture?Mn.texture.update(Mn.gradient):Mn.texture=new c.T($t,Mn.gradient,Zt.RGBA8),Mn.version=_.gradientVersion,Zo=Mn.texture}$t.activeTexture.set(Zt.TEXTURE1),Zo.bind(_.stepInterpolant?Zt.NEAREST:Zt.LINEAR,Zt.CLAMP_TO_EDGE)}wr&&($t.activeTexture.set(Zt.TEXTURE0),ln.lineAtlasTexture&&ln.lineAtlasTexture.bind(Zt.LINEAR,Zt.REPEAT),bn.updatePaintBuffers()),Or&&($t.activeTexture.set(Zt.TEXTURE0),ln.imageAtlasTexture&&ln.imageAtlasTexture.bind(Zt.LINEAR,Zt.CLAMP_TO_EDGE),bn.updatePaintBuffers()),Ks&&!Ut&&et.terrain.setupElevationDraw(ln,bo),et.uploadCommonUniforms($t,bo,Gs.toUnwrapped());const Jn=Mn=>{ns!=null&&(ns.value=rs*mt),bo.draw(et,Zt.TRIANGLES,Ts,Mn,cr,mn.disabled,go,_.id,En.layoutVertexBuffer,En.indexBuffer,En.segments,_.paint,et.transform.zoom,bn,[En.layoutVertexBuffer2,En.patternVertexBuffer,En.zOffsetVertexBuffer]),ns!=null&&(ns.value=rs)};if(cs&&!Ks){const Mn=et.stencilModeForClipping(Gs).ref;Mn===0&&pr&&$t.clear({stencil:0});const Zo={func:Zt.EQUAL,mask:255};go.u_alpha_discard_threshold=.8,Jn(new gn(Zo,Mn,255,Zt.KEEP,Zt.KEEP,Zt.INVERT)),go.u_alpha_discard_threshold=0,Jn(new gn(Zo,Mn,255,Zt.KEEP,Zt.KEEP,Zt.KEEP))}else go.u_alpha_discard_threshold=cs&&Ks&&Ns?.8:0,Jn(Ks?Js:et.stencilModeForClipping(Gs))}};let gs=et.depthModeForSublayer(0,tn.ReadOnly);const ks=new tn(et.depthOcclusion?Zt.GREATER:Zt.LEQUAL,tn.ReadOnly,et.depthRangeFor3D);if(_.hasNonElevatedBuckets){const Bs=!pr&&et.terrain;mt!==0&&Bs?c.w(`Occlusion opacity for layer ${_.id} is supported on terrain only if the layer has line-z-offset enabled.`):Bs?c.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${_.id}.`):Qr(rt,Fr,gs,gn.disabled,!1,!0)}if(_.hasElevatedBuckets){Tt==="hd-road-markup"?Bt||(gs=ks,Fr.push("ELEVATED_ROADS")):(Fr.push("ELEVATED"),gs=ks,sr&&Fr.push(ir?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Ut&&Fr.push("ELEVATION_REFERENCE_SEA"));const Bs=cs?et.stencilModeFor3D():gn.disabled;et.forceTerrainMode=!0,Qr(rt,Fr,gs,Bs,!0,!0),cs&&Qr(rt,Fr,gs,Bs,!0,!1),et.forceTerrainMode=!1}cs&&(et.resetStencilClippingMasks(),pr&&$t.clear({stencil:0})),mt===0||et.depthOcclusion||pr||et.layersWithOcclusionOpacity.push(et.currentLayer)},fill:function(et,o,_,rt){const ot=_.paint.get("fill-color"),lt=_.paint.get("fill-opacity");if(lt.constantOr(1)===0)return;const ut=_.paint.get("fill-emissive-strength"),dt=et.colorModeForDrapableLayerRenderPass(ut),mt=_.paint.get("fill-pattern"),Tt=et.opaquePassEnabledForLayer()&&!mt.constantOr(1)&&ot.constantOr(c.ao.transparent).a===1&&lt.constantOr(0)===1?"opaque":"translucent";let Ct="none";_.layout.get("fill-elevation-reference")!=="none"?Ct="road":_.paint.get("fill-z-offset").constantOr(1)!==0&&(Ct="offset");const Ut=!(!et.terrain||!et.terrain.enabled),Bt={painter:et,sourceCache:o,layer:_,coords:rt,colorMode:dt,elevationType:Ct,terrainEnabled:Ut,pass:Tt};if(et.renderPass==="shadow")return void(et.shadowRenderer&&Ct==="road"&&!Ut&&function(Zt){const{painter:qt,sourceCache:sr,layer:ir,coords:cr}=Zt,pr=qt.context.gl,ur=Zt.painter.shadowRenderer;for(const Cr of cr){const wr=sr.getTile(Cr),Tr=wr.getBucket(ir);if(!Tr)continue;const br=Tr.elevatedStructures;if(!br||!br.shadowCasterSegments||br.shadowCasterSegments.segments[0].primitiveLength===0)continue;qt.prepareDrawTile();const yr=Tr.bufferData.programConfigurations.get(ir.id),Pr=qt.isTileAffectedByFog(Cr),Or=qt.getOrCreateProgram("elevatedStructuresDepth",{config:yr,overrideFog:Pr}),Nr=ur.calculateShadowPassMatrixFromTile(wr.tileID.toUnwrapped());qt.uploadCommonUniforms(qt.context,Or,Cr.toUnwrapped());const ts={u_matrix:Nr,u_depth_bias:0};Or.draw(qt,pr.TRIANGLES,ur.getShadowPassDepthMode(),gn.disabled,ur.getShadowPassColorMode(),mn.disabled,ts,ir.id,br.vertexBuffer,br.indexBuffer,br.shadowCasterSegments,ir.paint,qt.transform.zoom,yr)}}(Bt));const $t=et.emissiveMode==="mrt-fallback";if(Ct!=="offset"){if(K0(Bt,!1,$t),Ct==="road"){const Zt=!Ut&&et.renderPass==="translucent";Zt&&X0(et,o,_,rt,"geometry"),K0(Bt,!0,$t,gn.disabled),Zt&&function(qt){const{painter:sr,sourceCache:ir,layer:cr,coords:pr,colorMode:ur}=qt,Cr=sr.context.gl,wr=qt.painter.shadowRenderer,Tr=!!wr&&wr.enabled,br=new tn(sr.context.gl.LEQUAL,tn.ReadOnly,sr.depthRangeFor3D);let yr=[0,0,0];if(Tr){const Or=sr.style.directionalLight,Nr=sr.style.ambientLight;Or&&Nr&&(yr=Jp(sr.style,Or,Nr))}const Pr=Or=>{for(const Nr of pr){const ts=ir.getTile(Nr),rs=ts.getBucket(cr);if(!rs)continue;const cs=rs.elevatedStructures;if(!cs)continue;let Ss,Zr;if(Or?(Ss=cs.renderableBridgeSegments,Zr=cs.bridgeProgramConfigurations.get(cr.id)):(Ss=cs.renderableTunnelSegments,Zr=cs.tunnelProgramConfigurations.get(cr.id)),!Ss||Ss.segments[0].primitiveLength===0)continue;Zr.updatePaintBuffers(),sr.prepareDrawTile();const Fr=sr.isTileAffectedByFog(Nr),ns=[];Tr&&ns.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Qr=sr.getOrCreateProgram("elevatedStructures",{config:Zr,overrideFog:Fr,defines:ns}),gs=sr.translatePosMatrix(Nr.projMatrix,ts,cr.paint.get("fill-translate"),cr.paint.get("fill-translate-anchor"));Tr&&wr.setupShadows(ts.tileID.toUnwrapped(),Qr,"vector-tile");const ks=Mm(gs,yr);sr.uploadCommonUniforms(sr.context,Qr,Nr.toUnwrapped()),Qr.draw(sr,Cr.TRIANGLES,br,gn.disabled,ur,mn.backCCW,ks,cr.id,cs.vertexBuffer,cs.indexBuffer,Ss,cr.paint,sr.transform.zoom,Zr,[cs.vertexBufferNormal])}};Pr(!0),Pr(!1)}(Bt)}}else K0(Bt,!1,$t,et.stencilModeFor3D())},"fill-extrusion":function(et,o,_,rt){const ot=_.paint.get("fill-extrusion-opacity"),lt=et.context,ut=lt.gl,dt=et.terrain,mt=dt&&dt.renderingToTexture;if(ot===0)return;const Tt=et.emissiveMode==="mrt-fallback",Ct=et.conflationActive&&et.style.isLayerClipped(_,o.getSource()),Ut=et.style.order.indexOf(_.fqid);if(Ct&&function(Bt,$t,Zt,qt,sr){for(const ir of qt){const cr=$t.getTile(ir).getBucket(Zt);cr&&(cr.updateReplacement(ir,Bt.replacementSource,sr),cr.uploadCentroid(Bt.context))}}(et,o,_,rt,Ut),dt||Ct)for(const Bt of rt){const $t=o.getTile(Bt).getBucket(_);$t&&m2(et.context,o,Bt,$t,_,dt,Ct)}if(et.renderPass==="shadow"&&et.shadowRenderer){const Bt=et.shadowRenderer;if(dt&&ot<.65&&_._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof c.ad)return;const $t=Bt.getShadowPassDepthMode(),Zt=Bt.getShadowPassColorMode();Y0(et,o,_,rt,$t,gn.disabled,Zt,Ct)}else if(et.renderPass==="translucent"){const Bt=!_.paint.get("fill-extrusion-pattern").constantOr(1),$t=_.paint.get("fill-extrusion-color").constantOr(c.ao.white);if(!mt&&$t.a!==0){const Zt=new tn(et.context.gl.LEQUAL,tn.ReadWrite,et.depthRangeFor3D);ot===1&&Bt?Y0(et,o,_,rt,Zt,gn.disabled,jn.unblended,Ct):(Y0(et,o,_,rt,Zt,gn.disabled,jn.disabled,Ct),Y0(et,o,_,rt,Zt,et.stencilModeFor3D(),et.colorModeForRenderPass(),Ct),et.resetStencilClippingMasks())}if(et.style.enable3dLights()&&Bt&&(!dt&&et.transform.projection.name!=="globe"||mt)){const Zt=_.paint.get("fill-extrusion-opacity"),qt=_.paint.get("fill-extrusion-ambient-occlusion-intensity"),sr=_.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ir=_.paint.get("fill-extrusion-flood-light-intensity"),cr=_.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",pr=_.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(cr?null:_.lut).toArray01().slice(0,3),ur=qt>0&&sr>0,Cr=ir>0,wr=(yr,Pr,Or)=>(1-Or)*yr+Or*Pr,Tr=new zv;Tr.translate=_.paint.get("fill-extrusion-translate"),Tr.translateAnchor=_.paint.get("fill-extrusion-translate-anchor"),Tr.edgeRadius=_.layout.get("fill-extrusion-edge-radius"),Tr.cutoffFadeRange=_.paint.get("fill-extrusion-cutoff-fade-range");const br=yr=>{const Pr=et.depthModeForSublayer(1,tn.ReadOnly,ut.LEQUAL,!0),Or=_.paint.get(yr?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Nr=wr(.1,3,Or),ts=et._showOverdrawInspector;if(!ts){const rs=new gn({func:ut.ALWAYS,mask:255},255,255,ut.KEEP,ut.KEEP,ut.REPLACE),cs=new jn([ut.ONE,ut.ONE,ut.ONE,ut.ONE],c.ao.transparent,[!1,!1,!1,!0],ut.MIN);rm(Tr,et,o,_,rt,Pr,rs,cs,mn.disabled,yr,"sdf",Zt,qt,sr,ir,pr,Nr,Ct,!1)}{const rs=ts?gn.disabled:new gn({func:ut.EQUAL,mask:255},255,255,ut.KEEP,ut.DECR,ut.DECR),cs=ts?et.colorModeForRenderPass():new jn([ut.ONE_MINUS_DST_ALPHA,ut.DST_ALPHA,ut.ONE,ut.ONE],c.ao.transparent,[!0,!0,!0,!0]);rm(Tr,et,o,_,rt,Pr,rs,cs,mn.disabled,yr,"color",Zt,qt,sr,ir,pr,Nr,Ct,!1)}};if(mt){const yr=()=>{const Or=dt.drapeBufferSize[0],Nr=dt.drapeBufferSize[1];let ts=dt.framebufferCopyTexture;return ts&&(!ts||ts.size[0]===Or&&ts.size[1]===Nr)||(ts&&ts.destroy(),ts=dt.framebufferCopyTexture=new c.T(lt,new c.q({width:Or,height:Nr}),ut.RGBA8)),ts.bind(ut.LINEAR,ut.CLAMP_TO_EDGE),ut.copyTexSubImage2D(ut.TEXTURE_2D,0,0,0,0,0,Or,Nr),ts},Pr=(Or,Nr,ts)=>{const rs=et.depthModeForSublayer(1,tn.ReadOnly,ut.LEQUAL,!1),cs=_.paint.get(Or?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ss=wr(.1,3,cs);{const Zr=new jn([ut.ONE,ut.ONE,ut.ONE,ut.ONE],c.ao.transparent,[!1,!1,!1,!0]);rm(Tr,et,o,_,rt,rs,gn.disabled,Zr,mn.disabled,Or,"clear",Zt,qt,sr,ir,pr,Ss,Ct,Nr)}{const Zr=new gn({func:ut.ALWAYS,mask:255},255,255,ut.KEEP,ut.KEEP,ut.REPLACE),Fr=new jn([ut.ONE,ut.ONE,ut.ONE,ut.ONE],c.ao.transparent,[!1,!1,!1,!0],ut.MIN);rm(Tr,et,o,_,rt,rs,Zr,Fr,mn.disabled,Or,"sdf",Zt,qt,sr,ir,pr,Ss,Ct,Nr)}Tt&&!Or&&(ts=yr());{const Zr=Or?ut.ZERO:ut.ONE_MINUS_DST_ALPHA,Fr=new gn({func:ut.EQUAL,mask:255},255,255,ut.KEEP,ut.DECR,ut.DECR),ns=new jn([Zr,ut.DST_ALPHA,ut.ONE_MINUS_DST_ALPHA,ut.ZERO],c.ao.transparent,[!0,!0,!0,!0]);rm(Tr,et,o,_,rt,rs,Fr,ns,mn.disabled,Or,"color",Zt,qt,sr,ir,pr,Ss,Ct,Nr)}if(!Tt||Or){const Zr=new jn([ut.ONE,ut.ONE,ut.ONE,Or?ut.ZERO:ut.ONE],c.ao.transparent,[!1,!1,!1,!0],Or?ut.FUNC_ADD:ut.MAX);rm(Tr,et,o,_,rt,rs,gn.disabled,Zr,mn.disabled,Or,"clear",Zt,qt,sr,ir,pr,Ss,Ct,Nr,ts)}else{ut.drawBuffers([ut.NONE,ut.COLOR_ATTACHMENT1]);const Zr=new gn({func:ut.EQUAL,mask:255},254,255,ut.KEEP,ut.DECR,ut.DECR),Fr=new jn([ut.ONE,ut.ONE,ut.ONE,ut.ONE],c.ao.transparent,[!0,!1,!1,!1],ut.MAX);rm(Tr,et,o,_,rt,rs,Zr,Fr,mn.disabled,Or,"emissive",Zt,qt,sr,ir,pr,Ss,Ct,Nr,ts),ut.drawBuffers([ut.COLOR_ATTACHMENT0])}};if(ur||Cr){let Or;et.prepareDrawTile(),Tt&&!ur||(Or=yr()),ur&&Pr(!0,!1,Or),Cr&&Pr(!1,!0,Or)}}else ur&&br(!0),Cr&&br(!1),(ur||Cr)&&et.resetStencilClippingMasks()}}},building:function(et,o,_,rt){et.currentLayer<et.firstLightBeamLayer&&(et.firstLightBeamLayer=et.currentLayer);const ot=_.paint.get("building-ambient-occlusion-ground-intensity"),lt=_.paint.get("building-ambient-occlusion-ground-radius"),ut=_.paint.get("building-ambient-occlusion-ground-attenuation"),dt=_.paint.get("building-opacity");if(dt<=0)return;let mt=ot>0&&lt>0,Tt=!0;const Ct=_.paint.get("building-vertical-scale");if(Ct<=0)return;et.shadowRenderer||(Tt=!1);const Ut=et.conflationActive&&et.style.isLayerClipped(_,o.getSource()),Bt=et.style.order.indexOf(_.fqid);if(function($t,Zt,qt,sr,ir,cr){for(const pr of cr){const ur=Zt.getTile(pr).getBucket(qt);ur&&(ir&&ur.updateReplacement(pr,$t.replacementSource,sr),ur.uploadUpdatedIndexBuffer($t.context))}}(et,o,_,Bt,Ut,rt),function($t,Zt,qt,sr){for(const ir of sr){const cr=Zt.getTile(ir).getBucket(qt);cr&&cr.needsEvaluation()&&cr.uploadUpdatedColorBuffer($t.context)}}(et,o,_,rt),_.resetLayerRenderingStats(et),et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!0),et.renderPass==="shadow"&&et.shadowRenderer){const $t=et.shadowRenderer,Zt=[],qt=$t.getShadowPassDepthMode();Fy({painter:et,source:o,layer:_,coords:rt,defines:Zt,blendMode:$t.getShadowPassColorMode(),depthMode:qt,opacity:dt,verticalScale:Ct,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(et.renderPass==="translucent"){let $t=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];Tt&&($t=$t.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),et.shadowRenderer&&et.shadowRenderer.useNormalOffset&&($t=$t.concat("NORMAL_OFFSET"));const Zt=_.paint.get("building-facade-emissive-chance"),qt=_.paint.get("building-ambient-occlusion-intensity"),sr=_.paint.get("building-flood-light-intensity"),ir=_.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",cr=_.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(ir?null:_.lut).toArray01().slice(0,3),pr=_.paint.get("building-flood-light-ground-attenuation"),ur=sr>0,Cr=new tn(et.context.gl.LEQUAL,tn.ReadWrite,et.depthRangeFor3D);dt<1&&Fy({painter:et,source:o,layer:_,coords:rt,defines:$t,blendMode:jn.disabled,depthMode:Cr,opacity:dt,verticalScale:Ct,facadeEmissiveChance:Zt,facadeAOIntensity:qt,floodLightIntensity:sr,floodLightColor:cr,depthOnly:!0});const wr=et.colorModeForRenderPass();Fy({painter:et,source:o,layer:_,coords:rt,defines:$t,blendMode:wr,depthMode:Cr,opacity:dt,verticalScale:Ct,facadeEmissiveChance:Zt,facadeAOIntensity:qt,floodLightIntensity:sr,floodLightColor:cr}),mt&&Q0(et,o,_,rt,!0,dt,ot,lt,sr,cr,ut,Ut),ur&&Q0(et,o,_,rt,!1,dt,ot,lt,sr,cr,pr,Ut)}else if(et.renderPass==="light-beam"){const $t=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Zt=new tn(et.context.gl.LEQUAL,tn.ReadOnly,et.depthRangeFor3D);Fy({painter:et,source:o,layer:_,coords:rt,defines:$t,blendMode:jn.alphaBlended,depthMode:Zt,opacity:dt,verticalScale:Ct,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}et.shadowRenderer&&(et.shadowRenderer.useNormalOffset=!1),et.resetStencilClippingMasks()},hillshade:function(et,o,_,rt){if(et.renderPass!=="offscreen"&&et.renderPass!=="translucent"||et.style.disableElevatedTerrain)return;const ot=et.context,lt=et.terrain&&et.terrain.renderingToTexture,[ut,dt]=et.renderPass!=="translucent"||lt?[{},rt]:et.stencilConfigForOverlap(rt);for(const mt of dt){const Tt=o.getTile(mt);if(Tt.needsHillshadePrepare&&et.renderPass==="offscreen")n2(et,Tt,_);else if(et.renderPass==="translucent"){const Ct=et.depthModeForSublayer(0,tn.ReadOnly),Ut=_.paint.get("hillshade-emissive-strength"),Bt=et.colorModeForDrapableLayerRenderPass(Ut),$t=lt&&et.terrain?et.terrain.stencilModeForRTTOverlap(mt):ut[mt.overscaledZ];s2(et,mt,Tt,_,Ct,$t,Bt)}}ot.viewport.set([0,0,et.width,et.height]),et.resetStencilClippingMasks()},raster:function(et,o,_,rt,ot,lt){if(et.renderPass!=="translucent"||_.paint.get("raster-opacity")===0)return;const ut=et.transform.projection.name==="globe",dt=_.paint.get("raster-elevation")!==0,mt=dt&&ut;if(et.renderElevatedRasterBackface&&!mt)return;const Tt=et.context,Ct=Tt.gl,Ut=o.getSource(),Bt=function(wr,Tr,br,yr,Pr){const Or=Tr.paint.get("raster-color"),Nr=wr.type==="raster-array",ts=[],rs=Tr.paint.get("raster-resampling"),cs=Tr.paint.get("raster-color-mix");let Ss=Tr.paint.get("raster-color-range");const Zr=[cs[0],cs[1],cs[2],0],Fr=cs[3];let ns=rs==="nearest"?yr.NEAREST:yr.LINEAR;if(Nr&&(ts.push("RASTER_ARRAY"),Or||ts.push("RASTER_COLOR"),rs==="linear"&&ts.push("RASTER_ARRAY_LINEAR"),ns=yr.NEAREST,!Ss&&wr.rasterLayers)){const Qr=wr.rasterLayers.find(({id:gs})=>gs===Tr.sourceLayer);Qr&&Qr.fields&&Qr.fields.range&&(Ss=Qr.fields.range)}if(Ss=Ss||[0,1],Or){ts.push("RASTER_COLOR"),br.activeTexture.set(yr.TEXTURE2),Tr.updateColorRamp(Ss);let Qr=Tr.colorRampTexture;Qr||(Qr=Tr.colorRampTexture=new c.T(br,Tr.colorRamp,yr.RGBA8)),Qr.bind(yr.LINEAR,yr.CLAMP_TO_EDGE)}return Pr&&ts.push("USE_MRT1"),{mix:Zr,range:Ss,offset:Fr,defines:ts,resampling:ns}}(Ut,_,Tt,Ct,et.terrain&&et.terrain.renderingToTexture&&et.emissiveMode==="mrt-fallback");if(Ut instanceof c.aU&&!rt.length&&!ut)return;const $t=_.paint.get("raster-emissive-strength"),Zt=et.colorModeForDrapableLayerRenderPass($t),qt=et.terrain&&et.terrain.renderingToTexture,sr=!et.options.moving,ir=_.paint.get("raster-resampling")==="nearest"?Ct.NEAREST:Ct.LINEAR;if(Ut instanceof c.aU&&!rt.length&&(Ut.onNorthPole||Ut.onSouthPole)){const wr=dt?et.stencilModeFor3D():gn.disabled;return void Ly(!!Ut.onNorthPole,null,et,o,_,$t,Bt,mn.disabled,wr)}if(!rt.length)return;const[cr,pr]=Ut instanceof c.aU||qt?[{},rt]:et.stencilConfigForOverlap(rt),ur=pr[pr.length-1].overscaledZ;mt&&Bt.defines.push("PROJECTION_GLOBE_VIEW"),dt&&Bt.defines.push("RENDER_CUTOFF");const Cr=(wr,Tr,br)=>{for(const yr of wr){const Pr=yr.toUnwrapped(),Or=o.getTile(yr);if(qt&&(!Or||!Or.hasData()))continue;Tt.activeTexture.set(Ct.TEXTURE0);const Nr=sm(Or,Ut,_,Bt);if(!Nr||!Nr.texture)continue;const{texture:ts,mix:rs,offset:cs,tileSize:Ss,buffer:Zr}=Nr;let Fr,ns;qt?(Fr=tn.disabled,ns=yr.projMatrix):dt?(Fr=new tn(Ct.LEQUAL,tn.ReadWrite,et.depthRangeFor3D),ns=ut?Float32Array.from(et.transform.expandedFarZProjMatrix):et.transform.calculateProjMatrix(Pr,sr)):(Fr=et.depthModeForSublayer(yr.overscaledZ-ur,_.paint.get("raster-opacity")===1?tn.ReadWrite:tn.ReadOnly,Ct.LESS),ns=et.transform.calculateProjMatrix(Pr,sr));const Qr=et.terrain&&qt?et.terrain.stencilModeForRTTOverlap(yr):cr[yr.overscaledZ],gs=lt?0:_.paint.get("raster-fade-duration");Or.registerFadeDuration(gs);const ks=o.findLoadedParent(yr,0),Bs=jy(Or,ks,o,et.transform,gs);let js,Ts;!Bs.isFading&&Or.refreshedUponExpiration&&(Or.refreshedUponExpiration=!1),et.terrain&&et.terrain.prepareDrawTile(),Tt.activeTexture.set(Ct.TEXTURE0),ts.bind(ir,Ct.CLAMP_TO_EDGE),Tt.activeTexture.set(Ct.TEXTURE1),ks?(ks.texture&&ks.texture.bind(ir,Ct.CLAMP_TO_EDGE),js=Math.pow(2,ks.tileID.overscaledZ-Or.tileID.overscaledZ),Ts=[Or.tileID.canonical.x*js%1,Or.tileID.canonical.y*js%1]):ts.bind(ir,Ct.CLAMP_TO_EDGE),"useMipmap"in ts&&Tt.extTextureFilterAnisotropic&&et.transform.pitch>20&&Ct.texParameterf(Ct.TEXTURE_2D,Tt.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Tt.extTextureFilterAnisotropicMax);const Js=et.transform;let Ks;const Ns=dt?Lw(Js):[0,0,0,0];let Gs,ln,En,Hn,ho,en=0;if(mt&&Ut instanceof c.aU&&Ut.coordinates.length>3)Gs=Float32Array.from(c.bk(c.dJ(new c.cD(0,0,0)))),ln=Float32Array.from(Js.globeMatrix),En=Float32Array.from(c.dF(Js)),Hn=[c.aF(Js.center.lng),c.aJ(Js.center.lat)],Ks=Ut.elevatedGlobePerspectiveTransform,ho=Ut.elevatedGlobeGridMatrix||new Float32Array(9);else if(mt){const To=c.dG(yr.canonical);en=c.dH(To.getCenter().lat),Gs=Float32Array.from(c.bk(c.dJ(yr.canonical))),ln=Float32Array.from(Js.globeMatrix),En=Float32Array.from(c.dF(Js)),Hn=[c.aF(Js.center.lng),c.aJ(Js.center.lat)],Ks=[0,0],ho=Float32Array.from(c.dI(yr.canonical,To,en,Js.worldSize/Js._pixelsPerMercatorPixel))}else Ks=Ut instanceof c.aU?Ut.perspectiveTransform:[0,0],Gs=new Float32Array(16),ln=new Float32Array(9),En=new Float32Array(16),Hn=[0,0],ho=new Float32Array(9);const ao=Aw(ns,Gs,ln,En,ho,Ts||[0,0],c.aj(et.transform.zoom),Hn,Ns,js||1,Bs,_,Ks,dt?_.paint.get("raster-elevation"):0,2,rs,cs,Bt.range,Ss,Zr,$t),bn=et.isTileAffectedByFog(yr),mo=et.getOrCreateProgram("raster",{defines:Bt.defines,overrideFog:bn});if(et.uploadCommonUniforms(Tt,mo,Pr),Ut instanceof c.aU){const To=Ut.elevatedGlobeVertexBuffer,bo=Ut.elevatedGlobeIndexBuffer;if(qt||!ut)Ut.boundsBuffer&&Ut.boundsSegments&&mo.draw(et,Ct.TRIANGLES,Fr,gn.disabled,Zt,mn.disabled,ao,_.id,Ut.boundsBuffer,et.quadTriangleIndexBuffer,Ut.boundsSegments);else if(To&&bo){const no=Js.zoom<=c.c_?Ut.elevatedGlobeSegments:Ut.getSegmentsForLongitude(Js.center.lng);no&&mo.draw(et,Ct.TRIANGLES,Fr,gn.disabled,Zt,Tr,ao,_.id,To,bo,no)}}else if(mt){Fr=new tn(Ct.LEQUAL,tn.ReadOnly,et.depthRangeFor3D);const To=et.globeSharedBuffers;if(To){const[bo,no,kn]=To.getGridBuffers(en,!1);mo.draw(et,Ct.TRIANGLES,Fr,br||Qr,et.colorModeForRenderPass(),Tr,ao,_.id,bo,no,kn)}}else{const{tileBoundsBuffer:To,tileBoundsIndexBuffer:bo,tileBoundsSegments:no}=et.getTileBoundsBuffers(Or);mo.draw(et,Ct.TRIANGLES,Fr,Qr,Zt,mn.disabled,ao,_.id,To,bo,no)}}if(!(Ut instanceof c.aU)&&mt)for(const yr of wr){const Pr=yr.canonical.y===(1<<yr.canonical.z)-1;yr.canonical.y===0&&Ly(!0,yr,et,o,_,$t,Bt,Tr,br||gn.disabled),Pr&&Ly(!1,yr,et,o,_,$t,Bt,Tr===mn.frontCW?mn.backCW:mn.frontCW,br||gn.disabled)}};mt?Cr(pr,et.renderElevatedRasterBackface?mn.backCW:mn.frontCW,et.stencilModeFor3D()):Cr(pr,mn.disabled,void 0),et.resetStencilClippingMasks()},"raster-particle":function(et,o,_,rt,ot,lt){et.renderPass==="offscreen"&&function(ut,dt,mt,Tt){if(!Tt.length)return;const Ct=ut.context,Ut=Ct.gl,Bt=dt.getSource();if(!(Bt instanceof Cu))return;const $t=Math.ceil(Math.sqrt(mt.paint.get("raster-particle-count")));let Zt=mt.particlePositionRGBAImage;if(!Zt||Zt.width!==$t){const pr=function(ur){const Cr=ur*ur,wr=new Uint8Array(4*Cr),Tr=function(yr){return yr|=0,yr=Math.imul(2747636419^yr,2654435769),yr=Math.imul(yr^yr>>>16,2654435769),((yr=Math.imul(yr^yr>>>16,2654435769))>>>0)/4294967296},br=1/1.1;for(let yr=0;yr<Cr;yr++){const Pr=br*(Tr(2*yr+0)+Vp),Or=br*(Tr(2*yr+1)+Vp),Nr=255*Pr%1,ts=255*Or%1,rs=Nr,cs=Or-ts/255,Ss=ts;wr[4*yr+0]=255*(Pr-Nr/255),wr[4*yr+1]=255*rs,wr[4*yr+2]=255*cs,wr[4*yr+3]=255*Ss}return wr}($t);Zt=mt.particlePositionRGBAImage=new c.q({width:$t,height:$t},pr)}let qt=mt.particleFramebuffer;qt?qt.width!==$t&&(qt.destroy(),qt=mt.particleFramebuffer=Ct.createFramebuffer($t,$t,1,null)):qt=mt.particleFramebuffer=Ct.createFramebuffer($t,$t,1,null);const sr=[];for(const pr of Tt){const ur=dt.getTile(pr);if(!(ur instanceof d0))continue;const Cr=Bv(ur,Bt,mt);if(!Cr)continue;const wr=[ur.tileSize,ur.tileSize];let Tr=mt.tileFramebuffer;Tr||(Tr=mt.tileFramebuffer=Ct.createFramebuffer(wr[0],wr[1],1,null));let br=ur.rasterParticleState;br||(br=ur.rasterParticleState=new e_(Ct,pr,wr,Zt));const yr=br.update(mt.lastInvalidatedAt);br.particleTextureDimension!==$t&&br.updateParticleTexture(pr,Zt);const Pr=br.targetColorTexture;br.targetColorTexture=br.backgroundColorTexture,br.backgroundColorTexture=Pr;const Or=br.particleTexture0;br.particleTexture0=br.particleTexture1,br.particleTexture1=Or,sr.push([pr,Cr,br,yr])}if(sr.length===0)return;const ir=c.o.now(),cr=mt.previousDrawTimestamp?.001*(ir-mt.previousDrawTimestamp):.0167;if(mt.previousDrawTimestamp=ir,mt.hasColorMap()){Ct.activeTexture.set(Ut.TEXTURE0+2);let pr=mt.colorRampTexture;pr||(pr=mt.colorRampTexture=new c.T(Ct,mt.colorRamp,Ut.RGBA8)),pr.bind(Ut.LINEAR,Ut.CLAMP_TO_EDGE)}Ct.bindFramebuffer.set(mt.tileFramebuffer.framebuffer),function(pr,ur,Cr){const wr=pr.context,Tr=wr.gl,br=ur.tileFramebuffer;wr.activeTexture.set(Tr.TEXTURE0);const yr={u_texture:0,u_opacity:1.05*(Or=ur.paint.get("raster-particle-fade-opacity-factor"))/(Or+.05)},Pr=pr.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Or;for(const Nr of Cr){const[,,ts,rs]=Nr;br.colorAttachment0.set(ts.targetColorTexture.texture),wr.viewport.set([0,0,br.width,br.height]),wr.clear({color:c.ao.transparent}),rs&&(ts.backgroundColorTexture.bind(Tr.NEAREST,Tr.CLAMP_TO_EDGE),Pr.draw(pr,Tr.TRIANGLES,tn.disabled,gn.disabled,jn.alphaBlended,mn.disabled,yr,ur.id,pr.viewportBuffer,pr.quadTriangleIndexBuffer,pr.viewportSegments))}}(ut,mt,sr),function(pr,ur,Cr,wr){const Tr=pr.context,br=Tr.gl,yr=Cr.tileFramebuffer,Pr=pr.transform.projection.name==="globe",Or=Cr.paint.get("raster-particle-max-speed");for(const Nr of wr){const[ts,rs,cs]=Nr;Tr.activeTexture.set(br.TEXTURE0+0),rs.texture.bind(br.LINEAR,br.CLAMP_TO_EDGE),yr.colorAttachment0.set(cs.targetColorTexture.texture);const Ss=pr.getOrCreateProgram("rasterParticleDraw",{defines:rs.defines,overrideFog:!1});Tr.activeTexture.set(br.TEXTURE0+1);const Zr=rs.scalarData?[]:[0,1,2,3].map(Qr=>c.e9[Qr](ts));Zr.push(ts);const Fr=ts.canonical.x,ns=ts.canonical.y;for(const Qr of Zr){const gs=ur.getTile(Pr?Qr.wrapped():Qr);if(!gs)continue;const ks=gs.rasterParticleState;if(!ks)continue;const Bs=Qr.canonical.x+(1<<Qr.canonical.z)*(Qr.wrap-ts.wrap),js=Qr.canonical.y;ks.particleTexture0.bind(br.NEAREST,br.CLAMP_TO_EDGE);const Ts=p2(1,ks.particleTexture0.size[0],[Bs-Fr,js-ns],0,rs.texture.size,2,Or,rs.textureOffset,rs.scale,rs.offset);Ss.draw(pr,br.POINTS,tn.disabled,gn.disabled,jn.alphaBlended,mn.disabled,Ts,Cr.id,ks.particleIndexBuffer,void 0,ks.particleSegment)}}}(ut,dt,mt,sr),Ct.bindFramebuffer.set(mt.particleFramebuffer.framebuffer),function(pr,ur,Cr,wr){const Tr=pr.context,br=Tr.gl,yr=ur.paint.get("raster-particle-max-speed"),Pr=wr*ur.paint.get("raster-particle-speed-factor")*.15,Or=function(ts){return Math.pow(ts,6)}(.01+1*ur.paint.get("raster-particle-reset-rate-factor")),Nr=ur.particleFramebuffer;Tr.viewport.set([0,0,Nr.width,Nr.height]);for(const ts of Cr){const[,rs,cs]=ts;Tr.activeTexture.set(br.TEXTURE0+0),rs.texture.bind(br.LINEAR,br.CLAMP_TO_EDGE),Tr.activeTexture.set(br.TEXTURE0+1);const Ss=cs.particleTexture0;Ss.bind(br.NEAREST,br.CLAMP_TO_EDGE);const Zr=Pw(1,Ss.size[0],0,rs.texture.size,yr,Pr,Or,rs.textureOffset,rs.scale,rs.offset);Nr.colorAttachment0.set(cs.particleTexture1.texture),Tr.clear({color:c.ao.transparent}),pr.getOrCreateProgram("rasterParticleUpdate",{defines:rs.defines}).draw(pr,br.TRIANGLES,tn.disabled,gn.disabled,jn.unblended,mn.disabled,Zr,ur.id,pr.viewportBuffer,pr.quadTriangleIndexBuffer,pr.viewportSegments)}}(ut,mt,sr,cr)}(et,o,_,rt),et.renderPass==="translucent"&&(function(ut,dt,mt,Tt,Ct){const Ut=ut.context,Bt=Ut.gl,$t=dt.getSource().tileSize,Zt=5*(1-c.ah(c.cL,c.cL+1,ut.transform.zoom))*$t+mt.paint.get("raster-particle-elevation"),qt=!ut.options.moving,sr=ut.transform.projection.name==="globe";if(!Tt.length)return;const[ir,cr]=ut.stencilConfigForOverlap(Tt),pr=[];sr&&pr.push("PROJECTION_GLOBE_VIEW");const ur=ut.stencilModeFor3D();for(const Cr of cr){const wr=Cr.toUnwrapped(),Tr=dt.getTile(Cr);if(!Tr.rasterParticleState)continue;const br=Tr.rasterParticleState,yr=100;Tr.registerFadeDuration(yr);const Pr=dt.findLoadedParent(Cr,0),Or=jy(Tr,Pr,dt,ut.transform,yr);let Nr,ts;ut.terrain&&ut.terrain.prepareDrawTile(),Ut.activeTexture.set(Bt.TEXTURE0),br.targetColorTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE),Ut.activeTexture.set(Bt.TEXTURE1),Pr&&Pr.rasterParticleState?(Pr.rasterParticleState.targetColorTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE),Nr=Math.pow(2,Pr.tileID.overscaledZ-Tr.tileID.overscaledZ),ts=[Tr.tileID.canonical.x*Nr%1,Tr.tileID.canonical.y*Nr%1]):br.targetColorTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE);const rs=sr?Float32Array.from(ut.transform.expandedFarZProjMatrix):ut.transform.calculateProjMatrix(wr,qt),cs=ut.transform,Ss=Dw(cs),Zr=c.dG(Cr.canonical),Fr=c.dH(Zr.getCenter().lat);let ns,Qr,gs,ks,Bs;sr?(ns=Float32Array.from(c.bk(c.dJ(Cr.canonical))),Qr=Float32Array.from(cs.globeMatrix),gs=Float32Array.from(c.dF(cs)),ks=[c.aF(cs.center.lng),c.aJ(cs.center.lat)],Bs=Float32Array.from(c.dI(Cr.canonical,Zr,Fr,cs.worldSize/cs._pixelsPerMercatorPixel))):(ns=new Float32Array(16),Qr=new Float32Array(9),gs=new Float32Array(16),ks=[0,0],Bs=new Float32Array(9));const js=f2(rs,ns,Qr,gs,Bs,ts||[0,0],c.aj(ut.transform.zoom),ks,Ss,Nr||1,Or,Zt),Ts=ut.isTileAffectedByFog(Cr),Js=ut.getOrCreateProgram("rasterParticle",{defines:pr,overrideFog:Ts});if(ut.uploadCommonUniforms(Ut,Js,wr),sr){const Ks=new tn(Bt.LEQUAL,tn.ReadOnly,ut.depthRangeFor3D),Ns=0,Gs=ut.globeSharedBuffers;if(Gs){const[ln,En,Hn]=Gs.getGridBuffers(Fr,Ns!==0);Js.draw(ut,Bt.TRIANGLES,Ks,ur,jn.alphaBlended,ut.renderElevatedRasterBackface?mn.frontCCW:mn.backCCW,js,mt.id,ln,En,Hn)}}else{const Ks=ut.depthModeForSublayer(0,tn.ReadOnly),Ns=ir[Cr.overscaledZ],{tileBoundsBuffer:Gs,tileBoundsIndexBuffer:ln,tileBoundsSegments:En}=ut.getTileBoundsBuffers(Tr);Js.draw(ut,Bt.TRIANGLES,Ks,Ns,jn.alphaBlended,mn.disabled,js,mt.id,Gs,ln,En)}}ut.resetStencilClippingMasks()}(et,o,_,rt),et.style.map.triggerRepaint())},background:function(et,o,_,rt){const ot=_.paint.get("background-color"),lt=_.paint.get("background-color-use-theme").constantOr("default")==="none",ut=_.paint.get("background-opacity"),dt=_.paint.get("background-emissive-strength"),mt=_.paint.get("background-pitch-alignment")==="viewport";if(ut===0)return;const Tt=et.context,Ct=Tt.gl,Ut=et.transform,Bt=Ut.tileSize,$t=_.paint.get("background-pattern");let Zt;if($t!==void 0&&($t===null||(Zt=et.imageManager.getPattern(c.I.from($t.toString()),_.scope,et.style.getLut(_.scope)),!Zt)))return;const qt=!$t&&ot.a===1&&ut===1&&et.opaquePassEnabledForLayer()?"opaque":"translucent";if(et.renderPass!==qt)return;const sr=gn.disabled,ir=et.depthModeForSublayer(0,qt==="opaque"?tn.ReadWrite:tn.ReadOnly),cr=et.colorModeForDrapableLayerRenderPass(dt),pr=$t?"backgroundPattern":"background";let ur,Cr=rt;Cr||(ur=et.getBackgroundTiles(),Cr=Object.values(ur).map(Tr=>Tr.tileID)),$t&&(Tt.activeTexture.set(Ct.TEXTURE0),et.imageManager.bind(et.context,_.scope));const wr=[];if(et.terrain&&et.terrain.renderingToTexture&&et.emissiveMode==="mrt-fallback"&&wr.push("USE_MRT1"),mt){const Tr=et.getOrCreateProgram(pr,{overrideFog:!1,overrideRtt:!0,defines:wr}),br=new Float32Array(c.bA([])),yr=new c.aQ(0,0,0,0,0),Pr=$t?Lm(br,dt,ut,et,0,_.scope,Zt,mt,{tileID:yr,tileSize:Bt}):Iy(br,dt,ut,ot.toPremultipliedRenderColor(lt?null:_.lut));Tr.draw(et,Ct.TRIANGLES,ir,sr,cr,mn.disabled,Pr,_.id,et.viewportBuffer,et.quadTriangleIndexBuffer,et.viewportSegments)}else for(const Tr of Cr){const br=et.isTileAffectedByFog(Tr),yr=et.getOrCreateProgram(pr,{overrideFog:br,defines:wr}),Pr=Tr.toUnwrapped(),Or=rt?Tr.projMatrix:et.transform.calculateProjMatrix(Pr);et.prepareDrawTile();const Nr=o?o.getTile(Tr):ur?ur[Tr.key]:new Ym(Tr,Bt,Ut.zoom,et),ts=$t?Lm(Or,dt,ut,et,0,_.scope,Zt,mt,{tileID:Tr,tileSize:Bt}):Iy(Or,dt,ut,ot.toPremultipliedRenderColor(lt?null:_.lut));et.uploadCommonUniforms(Tt,yr,Pr);const{tileBoundsBuffer:rs,tileBoundsIndexBuffer:cs,tileBoundsSegments:Ss}=et.getTileBoundsBuffers(Nr);yr.draw(et,Ct.TRIANGLES,ir,sr,cr,mn.disabled,ts,_.id,rs,cs,Ss)}},sky:function(et,o,_){const rt=et._atmosphere?c.aj(et.transform.zoom):1,ot=_.paint.get("sky-opacity")*rt;if(ot===0)return;const lt=et.context,ut=_.paint.get("sky-type"),dt=new tn(lt.gl.LEQUAL,tn.ReadOnly,[0,1]),mt=et.frameCounter/1e3%1;ut==="atmosphere"?et.renderPass==="offscreen"?_.needsSkyboxCapture(et)&&(function(Tt,Ct,Ut,Bt){const $t=Tt.context,Zt=$t.gl;let qt=Ct.skyboxFbo;if(!qt){qt=Ct.skyboxFbo=$t.createFramebuffer(32,32,1,null),Ct.skyboxGeometry=new r_($t),Ct.skyboxTexture=$t.gl.createTexture(),Zt.bindTexture(Zt.TEXTURE_CUBE_MAP,Ct.skyboxTexture),Zt.texParameteri(Zt.TEXTURE_CUBE_MAP,Zt.TEXTURE_WRAP_S,Zt.CLAMP_TO_EDGE),Zt.texParameteri(Zt.TEXTURE_CUBE_MAP,Zt.TEXTURE_WRAP_T,Zt.CLAMP_TO_EDGE),Zt.texParameteri(Zt.TEXTURE_CUBE_MAP,Zt.TEXTURE_MIN_FILTER,Zt.LINEAR),Zt.texParameteri(Zt.TEXTURE_CUBE_MAP,Zt.TEXTURE_MAG_FILTER,Zt.LINEAR);for(let pr=0;pr<6;++pr)Zt.texImage2D(Zt.TEXTURE_CUBE_MAP_POSITIVE_X+pr,0,Zt.RGBA,32,32,0,Zt.RGBA,Zt.UNSIGNED_BYTE,null)}$t.bindFramebuffer.set(qt.framebuffer),$t.viewport.set([0,0,32,32]);const sr=Ct.getCenter(Tt,!0),ir=Tt.getOrCreateProgram("skyboxCapture"),cr=new Float64Array(16);c.bA(cr),c.en(cr,cr,.5*-Math.PI),cx(Tt,Ct,ir,cr,sr,0),c.bA(cr),c.en(cr,cr,.5*Math.PI),cx(Tt,Ct,ir,cr,sr,1),c.bA(cr),c.cU(cr,cr,.5*-Math.PI),cx(Tt,Ct,ir,cr,sr,2),c.bA(cr),c.cU(cr,cr,.5*Math.PI),cx(Tt,Ct,ir,cr,sr,3),c.bA(cr),cx(Tt,Ct,ir,cr,sr,4),c.bA(cr),c.en(cr,cr,Math.PI),cx(Tt,Ct,ir,cr,sr,5),$t.viewport.set([0,0,Tt.width,Tt.height])}(et,_),_.markSkyboxValid(et)):et.renderPass==="sky"&&function(Tt,Ct,Ut,Bt,$t){const Zt=Tt.context,qt=Zt.gl,sr=Tt.transform,ir=Tt.getOrCreateProgram("skybox");Zt.activeTexture.set(qt.TEXTURE0),qt.bindTexture(qt.TEXTURE_CUBE_MAP,Ct.skyboxTexture);const cr=((pr,ur,Cr,wr,Tr)=>({u_matrix:pr,u_sun_direction:ur,u_cubemap:0,u_opacity:wr,u_temporal_offset:Tr}))(sr.skyboxMatrix,Ct.getCenter(Tt,!1),0,Bt,$t);Tt.uploadCommonUniforms(Zt,ir),ir.draw(Tt,qt.TRIANGLES,Ut,gn.disabled,Tt.colorModeForRenderPass(),mn.backCW,cr,"skybox",Ct.skyboxGeometry.vertexBuffer,Ct.skyboxGeometry.indexBuffer,Ct.skyboxGeometry.segment)}(et,_,dt,ot,mt):ut==="gradient"&&et.renderPass==="sky"&&function(Tt,Ct,Ut,Bt,$t){const Zt=Tt.context,qt=Zt.gl,sr=Tt.transform,ir=Tt.getOrCreateProgram("skyboxGradient");Ct.skyboxGeometry||(Ct.skyboxGeometry=new r_(Zt)),Zt.activeTexture.set(qt.TEXTURE0);let cr=Ct.colorRampTexture;cr||(cr=Ct.colorRampTexture=new c.T(Zt,Ct.colorRamp,qt.RGBA8)),cr.bind(qt.LINEAR,qt.CLAMP_TO_EDGE);const pr=((ur,Cr,wr,Tr,br)=>({u_matrix:ur,u_color_ramp:0,u_center_direction:Cr,u_radius:c.an(wr),u_opacity:Tr,u_temporal_offset:br}))(sr.skyboxMatrix,Ct.getCenter(Tt,!1),Ct.paint.get("sky-gradient-radius"),Bt,$t);Tt.uploadCommonUniforms(Zt,ir),ir.draw(Tt,qt.TRIANGLES,Ut,gn.disabled,Tt.colorModeForRenderPass(),mn.backCW,pr,"skyboxGradient",Ct.skyboxGeometry.vertexBuffer,Ct.skyboxGeometry.indexBuffer,Ct.skyboxGeometry.segment)}(et,_,dt,ot,mt)},custom:function(et,o,_,rt){const ot=et.context,lt=_.implementation;if(!et.transform.projection.unsupportedLayers||!et.transform.projection.unsupportedLayers.includes("custom")||et.terrain&&(et.terrain.renderingToTexture||et.renderPass==="offscreen")&&_.isDraped(o)){if(et.renderPass==="offscreen"){const ut=lt.prerender;if(ut){if(et.setCustomLayerDefaults(),ot.setColorMode(et.colorModeForRenderPass()),et.transform.projection.name==="globe"){const dt=et.transform.pointMerc;ut.call(lt,ot.gl,et.transform.customLayerMatrix(),et.transform.getProjection(),et.transform.globeToMercatorMatrix(),c.aj(et.transform.zoom),[dt.x,dt.y],et.transform.pixelsPerMeterRatio)}else ut.call(lt,ot.gl,et.transform.customLayerMatrix());ot.setDirty(),et.setBaseState()}}else if(et.renderPass==="translucent"){if(et.terrain&&et.terrain.renderingToTexture){const dt=lt.renderToTile;if(dt){const mt=rt[0].canonical,Tt={x:mt.x+rt[0].wrap*(lt.wrapTileId?0:1<<mt.z),y:mt.y,z:mt.z};ot.setDepthMode(tn.disabled),ot.setStencilMode(gn.disabled),ot.setColorMode(et.colorModeForRenderPass()),et.setCustomLayerDefaults(),dt.call(lt,ot.gl,Tt),ot.setDirty(),et.setBaseState()}return}et.setCustomLayerDefaults(),ot.setColorMode(et.colorModeForRenderPass()),ot.setStencilMode(gn.disabled);const ut=lt.renderingMode==="3d"?new tn(et.context.gl.LEQUAL,tn.ReadWrite,et.depthRangeFor3D):et.depthModeForSublayer(0,tn.ReadOnly);if(ot.setDepthMode(ut),et.transform.projection.name==="globe"){const dt=et.transform.pointMerc;lt.render(ot.gl,et.transform.customLayerMatrix(),et.transform.getProjection(),et.transform.globeToMercatorMatrix(),c.aj(et.transform.zoom),[dt.x,dt.y],et.transform.pixelsPerMeterRatio)}else lt.render(ot.gl,et.transform.customLayerMatrix());ot.setDirty(),et.setBaseState(),ot.bindFramebuffer.set(null)}}else c.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(et,o,_,rt){if(et.renderPass==="opaque")return;const ot=_.paint.get("model-opacity").constantOr(1),lt=_.paint.get("model-elevation-reference"),ut=lt==="ground",dt=lt==="ground";if(ot===0)return;const mt=_.paint.get("model-cast-shadows");if(et.renderPass==="shadow"&&(!mt||et.terrain&&ot<.65&&_._transitionablePaint._values["model-opacity"].value.expression instanceof c.ad))return;const Tt=et.shadowRenderer,Ct=_.paint.get("model-receive-shadows");Tt&&(Tt.useNormalOffset=!0,Ct||(Tt.enabled=!1));const Ut=()=>{Tt&&(Tt.useNormalOffset=!0,Ct||(Tt.enabled=!0))},Bt=o.getSource();if(et.renderPass==="light-beam"&&Bt.type!=="batched-model")return;if(Bt.type==="vector"||Bt.type==="geojson")return function(ur,Cr,wr,Tr,br){const yr=ur.transform,Pr=yr.projection.name==="globe",Or=yr.getFreeCameraOptions().position;if(!ur.modelManager)return;const Nr=ur.modelManager;wr.modelManager=Nr;const ts=ur.shadowRenderer;if(!wr._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const rs=wr._unevaluatedLayout._values["model-id"],cs=Object.assign({},wr.layout.get("model-id").parameters),Ss=ur.style.order.indexOf(wr.fqid),Zr=wr.paint.get("model-opacity").constantOr(1);for(const Fr of Tr){const ns=Cr.getTile(Fr).getBucket(wr);if(!ns||ns.projection.name!==yr.projection.name)continue;const Qr=ns.getModelUris();if(Qr&&!ns.modelsRequested&&(Nr.addModelsFromBucket(Qr,br),ns.modelsRequested=!0),Pr)cs.zoom=Fr.overscaledZ;else{const Ns=Fu(Fr,yr);cs.zoom=Ns}const gs=rs.possiblyEvaluate(cs);if(Ww(ur,ns,Fr),$p.shadowUniformsInitialized=!1,$p.useSingleShadowCascade=!!ts&&ts.getMaxCascadeForTile(Fr.toUnwrapped())===0,ur.renderPass==="shadow"&&ts){if(ur.currentShadowCascade===1&&ns.isInsideFirstShadowMapFrustum)continue;const Ns=yr.calculatePosMatrix(Fr.toUnwrapped(),yr.worldSize);if($p.tileMatrix.set(Ns),$p.shadowTileMatrix=Float32Array.from(ts.calculateShadowPassMatrixFromMatrix(Ns)),$p.aabb.min=[0,0,0],$p.aabb.max[0]=$p.aabb.max[1]=c.al,$p.aabb.max[2]=0,y2(ns,$p,ur,wr.scope))continue}const ks=1<<Fr.canonical.z,Bs=[((Or.x-Fr.wrap)*ks-Fr.canonical.x)*c.al,(Or.y*ks-Fr.canonical.y)*c.al,Or.z*ks*c.al];ur.conflationActive&&Object.keys(ns.instancesPerModel).length>0&&ur.style.isLayerClipped(wr,Cr.getSource())&&ns.updateReplacement(Fr,ur.replacementSource,Ss,wr.scope)&&(ns.uploaded=!1,ns.upload(ur.context));let js=0;const Ts=new Array,Js=new Array,Ks=new Array;for(let Ns in ns.instancesPerModel){const Gs=ns.instancesPerModel[Ns];Gs.features.length>0&&!Pr&&(Ns=gs.evaluate(Gs.features[0].feature,{}));const ln=Nr.getModel(Ns,br);if(ln||Nr.hasURLBeenRequested(Ns)||ns.modelUris.includes(Ns)||(ns.modelUris.push(Ns),ns.modelsRequested=!1),ln&&ln.uploaded)if(Pr){const En=c.c5([],[Or.x,Or.y,Or.z],ur.transform.worldSize);c.ew(En,En);for(let Hn=0;Hn<Gs.instancedDataArray.length;++Hn){const ho=[0,0,0],en=[1,1,1],ao=c.ex(),bn=Gs.tileCoordinatesForInstance(Hn),mo=Gs.transformForInstance(Hn);c.ey(en,mo),c.ez(ao,mo),c.eA(ho,ao);const To=Gs.translationForInstance(Hn),bo=new c.aT(0,0);c.eB(ns.canonical,bo,bn.x,bn.y);const no=c.bC();c.eC(no,ln,ur.transform,bo,ho,en,To,!0,!1,!1);const kn=Gs.colorForInstance(Hn),po=c.bA([]),yl=c.ef(bo.lat,ur.transform.zoom),Ko=c.bq([],[1,1,1/yl]);c.br(po,po,En),Ks.push({zScaleMatrix:Ko,negCameraPosMatrix:po});for(const go of ln.nodes)ux(ur,go,no,ur.transform.expandedFarZProjMatrix,js,Ts,Js,ln.materialOverrides,Zr,kn);++js}}else for(const En of ln.nodes)qw(ur,wr,En,Gs,Bs,Fr,$p)}if(Pr)if(ur.renderPass==="shadow"){for(const Ns of Js)Ap(Ns.mesh,Ns.nodeModelMatrix,ur,wr);for(const Ns of Ts)Ap(Ns.mesh,Ns.nodeModelMatrix,ur,wr)}else Hw(ur,wr,Ts,Js,Ks)}}(et,o,_,rt,Dy(et,_)),void Ut();if(!Bt.loaded())return;if(Bt.type==="batched-model")return function(ur,Cr,wr,Tr){wr.resetLayerRenderingStats(ur);const br=ur.context,yr=ur.transform,Pr=ur.style.fog,Or=ur.shadowRenderer;if(yr.projection.name!=="mercator")return void c.w(`Drawing 3D landmark models for ${yr.projection.name} projection is not yet implemented`);const Nr=ur.transform.getFreeCameraOptions().position,ts=c.c5([],[Nr.x,Nr.y,Nr.z],ur.transform.worldSize),rs=c.ew([],ts),cs=c.bA([]),Ss=c.ef(yr.center.lat,yr.zoom),Zr=c.bq([],[1,1,1/Ss]);c.br(cs,cs,rs);const Fr=wr.paint.get("model-opacity").constantOr(1),ns=new tn(br.gl.LEQUAL,tn.ReadWrite,ur.depthRangeFor3D),Qr=new tn(br.gl.LEQUAL,tn.ReadOnly,ur.depthRangeFor3D),gs=new c.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ks=ur.renderPass==="shadow",Bs=ks&&Or?Or.getCurrentCascadeFrustum():yr.getFrustum(yr.scaleZoom(yr.worldSize)),js=wr.paint.get("model-front-cutoff"),Ts=js[2]<1,Js=Cm(ur,wr.paint.get("model-cutoff-fade-range")),Ks=wr.getLayerRenderingStats();(function(Ns,Gs,ln,En){const Hn=Ns.terrain?Ns.terrain.exaggeration():0,ho=Ns.transform.zoom;for(const en of En){const ao=Gs.getTile(en).getBucket(ln);ao&&(ao.setFilter(ln.filter),Ns.conflationActive&&ao.updateReplacement(en,Ns.replacementSource),ao.evaluateTransform(Ns,ln),Ns.terrain&&Hn>0&&ao.elevationUpdate(Ns.terrain,Hn,en,ln.source),ao.needsReEvaluation(Ns,ho,ln)&&ao.evaluate(ln))}})(ur,Cr,wr,Tr),function(){let Ns,Gs,ln;Ts?(Ns=Tr.length-1,Gs=-1,ln=-1):(Ns=0,Gs=Tr.length,ln=1);const En=new Float64Array(16),Hn=c.cA(),ho=new c.P(0,0);for(let en=Ns;en!==Gs;en+=ln){const ao=Tr[en],bn=Cr.getTile(ao).getBucket(wr);if(!bn||!bn.uploaded)continue;let mo=!1;Or&&(mo=Or.getMaxCascadeForTile(ao.toUnwrapped())===0);const To=yr.calculatePosMatrix(ao.toUnwrapped(),yr.worldSize),bo=bn.modelTraits;!ks&&Ts&&(c.bl(En,To),c.af(Hn,ts,En),ho.x=Hn[0],ho.y=Hn[1]);const no=[];bn.setFilter(wr.filter);for(const kn of bn.getNodesInfo()){if(kn.hiddenByReplacement||!kn.node.meshes)continue;const po=kn.node;let yl=0;ur.terrain&&po.elevation&&(yl=po.elevation*ur.terrain.exaggeration());const Ko=(()=>{const Su=kn.aabb;return gs.min=[...Su.min],gs.max=[...Su.max],gs.min[2]+=yl,gs.max[2]+=yl,c.af(gs.min,gs.min,To),c.af(gs.max,gs.max,To),gs})(),go=kn.evaluatedScale;if(go[0]<=1&&go[1]<=1&&go[2]<=1&&Ko.intersects(Bs)===0)continue;if(!ks&&Ts){const Su=.16666666666666666;kn.cameraCollisionOpacity=ts[0]>Ko.min[0]&&ts[0]<Ko.max[0]&&ts[1]>Ko.min[1]&&ts[1]<Ko.max[1]&&ts[2]*Ss<Ko.max[2]&&po.footprint&&c.c0(ho,po.footprint)?Math.max(kn.cameraCollisionOpacity-Su,0):Math.min(1,kn.cameraCollisionOpacity+Su)}const Jn=[...To],Mn=1/c.d7(ao.canonical),Zo=po.anchor?po.anchor[0]:0,Al=po.anchor?po.anchor[1]:0;c.br(Jn,Jn,[Zo*(go[0]-1)+kn.evaluatedTranslation[0]*Mn,Al*(go[1]-1)+kn.evaluatedTranslation[1]*Mn,yl+kn.evaluatedTranslation[2]]),c.cq(go,c.eE)||c.cS(Jn,Jn,go);const xa=c.aB([],Jn,po.globalMatrix),ko=c.aB([],yr.expandedFarZProjMatrix,xa),Lu=c.aB([],yr.expandedFarZProjMatrix,Jn),yu=c.aC([],[Zo,Al,yl,1],ko)[2];po.hidden=!1;let Kl=Fr;ks||(Ts&&(Kl*=kn.cameraCollisionOpacity,Kl*=Vn(Jn,yr,kn.aabb,js)),Kl*=Xo(Js,yu)),Kl!==0?no.push({nodeInfo:kn,depth:yu,opacity:Kl,wvpForNode:ko,wvpForTile:Lu,nodeModelMatrix:xa,tileModelMatrix:Jn}):po.hidden=!0}ks||no.sort((kn,po)=>!Ts||kn.opacity===1&&po.opacity===1?kn.depth<po.depth?-1:1:kn.opacity===1?-1:po.opacity===1?1:kn.depth>po.depth?-1:1);for(const kn of no){const po=kn.nodeInfo,yl=po.node;let Ko=c.aB([],Zr,kn.tileModelMatrix);c.aB(Ko,cs,Ko);const go=c.bl([],Ko);c.eg(go,go),c.cS(go,go,Ny),Ko=c.aB(Ko,Ko,yl.globalMatrix);const Jn=ur.renderPass==="light-beam",Mn=wr.paint.get("model-color-use-theme").constantOr("default")==="none",Zo=bo&c.eI.HasMapboxMeshFeatures,Al=Zo?0:po.evaluatedRMEA[0][2];for(let xa=0;xa<yl.meshes.length;++xa){const ko=yl.meshes[xa],Lu=xa===yl.lightMeshIndex;let yu=kn.wvpForNode;if(Lu){if(!Jn&&!ur.terrain&&ur.shadowRenderer){ur.currentLayer<ur.firstLightBeamLayer&&(ur.firstLightBeamLayer=ur.currentLayer);continue}yu=kn.wvpForTile}else if(Jn)continue;const Kl={defines:[]},Su=[];if(!ks&&Or&&(Or.useNormalOffset=!!ko.normalBuffer),n_(Kl.defines,Su,ko,ur,Mn?null:wr.lut),Zo||Kl.defines.push("DIFFUSE_SHADED"),mo&&Kl.defines.push("SHADOWS_SINGLE_CASCADE"),Ks&&(ks?Ks.numRenderedVerticesInShadowPass+=ko.vertexArray.length:Ks.numRenderedVerticesInTransparentPass+=ko.vertexArray.length),ks){Ap(ko,kn.nodeModelMatrix,ur,wr);continue}let Tu=null;if(Pr){const Ml=s_(kn.nodeModelMatrix,ur.transform);if(Tu=new Float32Array(Ml),yr.projection.name!=="globe"){const Mo=ko.aabb.min,zl=ko.aabb.max,[_l,_a]=Pr.getOpacityForBounds(Ml,Mo[0],Mo[1],zl[0],zl[1]);Kl.overrideFog=_l>=hs||_a>=hs}}const mu=ko.material;let rp;mu.occlusionTexture&&mu.occlusionTexture.offsetScale&&(rp=mu.occlusionTexture.offsetScale,Kl.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const yp=ur.getOrCreateProgram("model",Kl);!ks&&Or&&Or.setupShadowsFromMatrix(kn.tileModelMatrix,yp,Or.useNormalOffset),ur.uploadCommonUniforms(br,yp,null,Tu);const Wu=mu.pbrMetallicRoughness;Wu.metallicFactor=.9,Wu.roughnessFactor=.5;const Tl=sx(new Float32Array(yu),new Float32Array(Ko),new Float32Array(go),new Float32Array(yl.globalMatrix),ur,kn.opacity,Wu.baseColorFactor,mu.emissiveFactor,Wu.metallicFactor,Wu.roughnessFactor,mu,Al,wr,[0,0,0],rp);!Lu&&(po.hasTranslucentParts||kn.opacity<1)&&yp.draw(ur,br.gl.TRIANGLES,ns,gn.disabled,jn.disabled,mn.backCCW,Tl,wr.id,ko.vertexBuffer,ko.indexBuffer,ko.segments,wr.paint,ur.transform.zoom,void 0,Su),yp.draw(ur,br.gl.TRIANGLES,Lu?Qr:ns,gn.disabled,Lu||kn.opacity<1||po.hasTranslucentParts?jn.alphaBlended:jn.unblended,mn.backCCW,Tl,wr.id,ko.vertexBuffer,ko.indexBuffer,ko.segments,wr.paint,ur.transform.zoom,void 0,Su)}}}}()}(et,o,_,rt),void Ut();if(Bt.type!=="model")return;const $t=Bt.getModels(),Zt=[],qt=et.transform.getFreeCameraOptions().position,sr=c.c5([],[qt.x,qt.y,qt.z],et.transform.worldSize);c.ew(sr,sr);const ir=[],cr=[];let pr=0;for(const ur of $t){const Cr=o.getFeatureState("",ur.id),wr={type:"Unknown",id:ur.id,properties:ur.featureProperties},Tr=_.paint.get("model-rotation").evaluate(wr,Cr),br=_.paint.get("model-scale").evaluate(wr,Cr),yr=_.paint.get("model-translation").evaluate(wr,Cr),Pr=_.paint.get("model-opacity").evaluate(wr,Cr);$w(_,ur.id,Cr,ur.featureProperties,ur.nodeOverrideNames,ur.nodeOverrides),Gw(_,ur.id,Cr,ur.featureProperties,ur.materialOverrideNames,ur.materialOverrides),ur.nodeOverrides.size>0&&ur.computeBoundsAndApplyParent(),ur.computeModelMatrix(et,Tr,br,yr,dt,ut,!1);const Or=c.bA([]),Nr=c.ef(ur.position.lat,et.transform.zoom),ts=c.bq([],[1,1,1/Nr]);c.br(Or,Or,sr),Zt.push({zScaleMatrix:ts,negCameraPosMatrix:Or});for(const rs of ur.nodes)ux(et,rs,ur.matrix,et.transform.expandedFarZProjMatrix,pr,ir,cr,ur.materialOverrides,Pr);pr++}if(ir.sort((ur,Cr)=>Cr.depth-ur.depth),et.renderPass!=="shadow")Hw(et,_,ir,cr,Zt),Ut();else{for(const ur of cr)Ap(ur.mesh,ur.nodeModelMatrix,et,_);for(const ur of ir)Ap(ur.mesh,ur.nodeModelMatrix,et,_);Ut()}}},c_={line:function(et,o,_){if(et.hasElevatedBuckets=!1,et.hasNonElevatedBuckets=!1,et._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||et._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(o){const rt=o.getVisibleCoordinates();for(const ot of rt){const lt=o.getTile(ot).getBucket(et);if(lt&&(lt.elevationType!=="none"?et.hasElevatedBuckets=!0:et.hasNonElevatedBuckets=!0,et.hasElevatedBuckets&&et.hasNonElevatedBuckets))break}}}else et.hasNonElevatedBuckets=!0},model:function(et,o,_){const rt=o.getSource();if(!rt.loaded())return;if(rt.type==="vector"||rt.type==="geojson")return void(_.modelManager&&_.modelManager.upload(_,Dy(_,et)));if(rt.type==="batched-model"||rt.type!=="model")return;const ot=rt.getModels();for(const lt of ot)lt.upload(_.context)},raster:function(et,o,_){const rt=o.getSource();if(!(rt instanceof Cu&&rt.loaded()))return;const ot=et.sourceLayer||rt.rasterLayerIds&&rt.rasterLayerIds[0];if(!ot)return;const lt=et.paint.get("raster-array-band")||rt.getInitialBand(ot);if(lt==null)return;const ut=o.getIds().map(dt=>o.getTileByID(dt));for(const dt of ut)dt.updateNeeded(et.id,lt)&&rt.prepareTile(dt,ot,et.id,lt)},"raster-particle":function(et,o,_){const rt=o.getSource();if(!(rt instanceof Cu&&rt.loaded()))return;const ot=et.sourceLayer||rt.rasterLayerIds&&rt.rasterLayerIds[0];if(!ot)return;const lt=et.paint.get("raster-particle-array-band")||rt.getInitialBand(ot);if(lt==null)return;const ut=o.getIds().map(dt=>o.getTileByID(dt));for(const dt of ut)dt.updateNeeded(et.id,lt)&&rt.prepareTile(dt,ot,et.id,lt)}},tp={fill:X0},u_={fill:function(et,o,_,rt){if(!_.layout||_.layout.get("fill-elevation-reference")==="none"||_.paint.get("fill-opacity").constantOr(1)===0)return;const ot=et.context.gl,lt=new tn(ot.LEQUAL,tn.ReadOnly,et.depthRangeFor3D),ut=new gn({func:ot.ALWAYS,mask:255},255,255,ot.KEEP,ot.KEEP,ot.REPLACE),dt=et.transform.getFreeCameraOptions().position,mt=et.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const Tt of rt){const Ct=o.getTile(Tt),Ut=Ct.getBucket(_);if(!Ut)continue;const Bt=Ut.elevatedStructures;if(!Bt||Bt.depthSegments.segments[0].primitiveLength===0)continue;const $t=Fw(Tt.toUnwrapped(),dt),Zt=et.translatePosMatrix(Tt.projMatrix,Ct,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor")),qt=ix(Zt,$t,0,1,0);mt.draw(et,ot.TRIANGLES,lt,ut,jn.disabled,mn.disabled,qt,_.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.depthSegments,_.paint,et.transform.zoom)}}};class h_{constructor(o,_,rt,ot,lt){this.context=new Nx(o,_),this.transform=rt,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=c.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const ut=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const mt of ut)this._debugParams.enabledLayers[mt]=!0;for(const mt of ut);this.occlusionParams=new Ox,this.setup(),this.numSublayers=Xu.maxUnderzooming+Xu.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new c.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Tx(this),this._wireframeDebugCache=new Nm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const dt=new c.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new c.T(this.context,dt,o.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=ot,this.worldview=lt,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(o,_){const rt=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(rt||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jv(this,o));const ot=this._terrain;this.transform.elevation=rt?ot:null,ot.update(o,this.transform,_),this.transform.elevation&&!ot.enabled&&(this.transform.elevation=null)}_updateFog(o){const _=o.fog;if(!_||this.transform.projection.name==="globe"||_.getOpacity(this.transform.pitch)<1||_.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[rt,ot]=_.getFovAdjustedRange(this.transform._fov);if(rt>ot)return void(this.transform.fogCullDistSq=null);const lt=rt+.78*(ot-rt);this.transform.fogCullDistSq=lt*lt}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(o){o&&!this._terrain&&(this._terrain=new jv(this,this.style)),this._forceTerrainMode=o}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(o,_){if(this.width=o*c.o.devicePixelRatio,this.height=_*c.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const rt of this.style.order)this.style._mergedLayers[rt].resize()}setup(){const o=this.context,_=new c.bd;_.emplaceBack(0,0),_.emplaceBack(c.al,0),_.emplaceBack(0,c.al),_.emplaceBack(c.al,c.al),this.tileExtentBuffer=o.createVertexBuffer(_,c.bf.members),this.tileExtentSegments=c.bg.simpleSegment(0,0,4,2);const rt=new c.bd;rt.emplaceBack(0,0),rt.emplaceBack(c.al,0),rt.emplaceBack(0,c.al),rt.emplaceBack(c.al,c.al),this.debugBuffer=o.createVertexBuffer(rt,c.bf.members),this.debugSegments=c.bg.simpleSegment(0,0,4,5);const ot=new c.bd;ot.emplaceBack(-1,-1),ot.emplaceBack(1,-1),ot.emplaceBack(-1,1),ot.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(ot,c.bf.members),this.viewportSegments=c.bg.simpleSegment(0,0,4,2);const lt=new c.b1;lt.emplaceBack(0,0,0,0),lt.emplaceBack(c.al,0,c.al,0),lt.emplaceBack(0,c.al,0,c.al),lt.emplaceBack(c.al,c.al,c.al,c.al),this.mercatorBoundsBuffer=o.createVertexBuffer(lt,c.bi.members),this.mercatorBoundsSegments=c.bg.simpleSegment(0,0,4,2);const ut=new c.b0;ut.emplaceBack(0,1,2),ut.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(ut);const dt=new c.be;for(const Tt of[0,1,3,2,0])dt.emplaceBack(Tt);this.debugIndexBuffer=o.createIndexBuffer(dt),this.emptyTexture=new c.T(o,new c.q({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA8),this.identityMat=c.bC();const mt=this.context.gl;this.stencilClearMode=new gn({func:mt.ALWAYS,mask:0},0,255,mt.ZERO,mt.ZERO,mt.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,o.TRIANGLES,tn.disabled,this.stencilClearMode,jn.disabled,mn.disabled,Ay(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(o,_,rt){if(!_||this.currentStencilSource===_.id||!o.isTileClipped()||!rt||rt.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let dt=!1;for(const mt of rt)if(this._tileClippingMaskIDs[mt.key]===void 0){dt=!0;break}if(!dt)return}this.currentStencilSource=_.id;const ot=this.context,lt=ot.gl;this.nextStencilID+rt.length>256&&this.clearStencil(),ot.setColorMode(jn.disabled),ot.setDepthMode(tn.disabled);const ut=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const dt of rt){const mt=_.getTile(dt),Tt=this._tileClippingMaskIDs[dt.key]=this.nextStencilID++,{tileBoundsBuffer:Ct,tileBoundsIndexBuffer:Ut,tileBoundsSegments:Bt}=this.getTileBoundsBuffers(mt);ut.draw(this,lt.TRIANGLES,tn.disabled,new gn({func:lt.ALWAYS,mask:0},Tt,255,lt.KEEP,lt.KEEP,lt.REPLACE),jn.disabled,mn.disabled,Ay(dt.projMatrix),"$clipping",Ct,Ut,Bt)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,_=this.context.gl;return new gn({func:_.NOTEQUAL,mask:255},o,255,_.KEEP,_.KEEP,_.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const _=this.context.gl;return new gn({func:_.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,_.KEEP,_.KEEP,_.REPLACE)}stencilConfigForOverlap(o){const _=this.context.gl,rt=o.sort((ut,dt)=>dt.overscaledZ-ut.overscaledZ),ot=rt[rt.length-1].overscaledZ,lt=rt[0].overscaledZ-ot+1;if(lt>1){this.currentStencilSource=void 0,this.nextStencilID+lt>256&&this.clearStencil();const ut={};for(let dt=0;dt<lt;dt++)ut[dt+ot]=new gn({func:_.GEQUAL,mask:255},dt+this.nextStencilID,255,_.KEEP,_.KEEP,_.REPLACE);return this.nextStencilID+=lt,[ut,rt]}return[{[ot]:gn.disabled},rt]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new jn([o.CONSTANT_COLOR,o.ONE,o.CONSTANT_COLOR,o.ONE],new c.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jn.unblended:jn.alphaBlended}colorModeForDrapableLayerRenderPass(o){const _=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?o!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new jn([_.ONE,_.ONE_MINUS_SRC_ALPHA,_.CONSTANT_ALPHA,_.ONE_MINUS_SRC_ALPHA],new c.ao(0,0,0,o??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new jn([_.ONE,_.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,_.ONE_MINUS_SRC_ALPHA],c.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(o,_,rt,ot=!1){if(this.depthOcclusion)return new tn(this.context.gl.GREATER,tn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!ot)return tn.disabled;const lt=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new tn(rt||this.context.gl.LEQUAL,_,[lt,lt])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const o=this.context.gl,_=Math.ceil(this.width),rt=Math.ceil(this.height),ot=this.context.bindFramebuffer.get(),lt=o.getParameter(o.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===_&&this.depthFBO.height===rt||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),_!==0&&rt!==0&&(this.depthFBO=new Mw(this.context,_,rt,0,"texture"),this.depthTexture=new c.T(this.context,{width:_,height:rt,data:null},o.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(ot),o.bindTexture(o.TEXTURE_2D,lt),this.depthFBO&&(o.bindFramebuffer(o.READ_FRAMEBUFFER,null),o.bindFramebuffer(o.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),o.blitFramebuffer(0,0,_,rt,0,0,_,rt,o.DEPTH_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((o,_)=>o+_/this._fpsHistory.length,0))}render(o,_){const rt=c.o.now();this._dt=rt-this._timeStamp,this._timeStamp=rt,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=o.map.repaint,this.style=o,this.options=_;const ot=this.style._mergedLayers,lt=!(!this.terrain||!this.terrain.enabled),ut=()=>this.style._getOrder(lt).filter(Zr=>{const Fr=ot[Zr];return!(Fr.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Fr.type]});let dt=ut(),mt=!1,Tt=!1,Ct=null,Ut=0,Bt=!1;for(const Zr of dt){const Fr=ot[Zr];Fr.visibility!=="none"&&(Fr.type==="circle"?mt=!0:Fr.type==="building"?(Ct=Fr,++Ut):Fr.type==="symbol"&&(Fr.hasOcclusionOpacityProperties?Tt=!0:mt=!0))}this.updateEmissiveMode();let $t=dt.map(Zr=>ot[Zr]);const Zt=this.style._mergedSourceCaches;this.imageManager=o.imageManager,this.modelManager=o.modelManager,this.symbolFadeChange=o.placement.symbolFadeChange(c.o.now()),this.imageManager.beginFrame();for(const Zr in Zt){const Fr=Zt[Zr];Fr.used&&(Fr.prepare(this.context),Fr.getSource().usedInConflation&&++Ut)}let qt=!1;for(const Zr of $t)Zr.isHidden(this.transform.zoom)||(Zr.type==="clip"&&(qt=!0),this.prepareLayer(Zr));const sr={},ir={},cr={},pr={},ur={};for(const Zr in Zt){const Fr=Zt[Zr];sr[Zr]=Fr.getVisibleCoordinates(),ir[Zr]=sr[Zr].slice().reverse(),cr[Zr]=Fr.getVisibleCoordinates(!0).reverse(),pr[Zr]=Fr.getShadowCasterCoordinates(),ur[Zr]=Fr.sortCoordinatesByDistance(sr[Zr])}const Cr=Zr=>{const Fr=this.style.getLayerSourceCache(Zr);return Fr&&Fr.used?Fr.getSource():null};if(Ut||qt||this._clippingActiveLastFrame){const Zr=[],Fr=[];let ns=0;for(const Qr of $t)this.isSourceForClippingOrConflation(Qr,Cr(Qr))&&(Zr.push(Qr),Fr.push(ns)),ns++;if(Zr&&(qt||Zr.length>1)||this._clippingActiveLastFrame){qt=!1;const Qr=[];for(let gs=0;gs<Zr.length;gs++){const ks=Zr[gs],Bs=Fr[gs],js=this.style.getLayerSourceCache(ks);if(!js||!js.used||!js.getSource().usedInConflation&&ks.type!=="clip"&&ks.type!=="building")continue;let Ts=c.eQ,Js=c.b_.None;const Ks=[];let Ns=!0;if(ks.type==="building")Ts=c.eS;else if(ks.type==="clip"){Ts=Bs;for(const Gs of ks.layout.get("clip-layer-types"))Js|=Gs==="model"?c.b_.Model:Gs==="symbol"?c.b_.Symbol:c.b_.FillExtrusion;for(const Gs of ks.layout.get("clip-layer-scope"))Ks.push(Gs);ks.isHidden(this.transform.zoom)?Ns=!1:qt=!0}Ns&&Qr.push({layer:ks.fqid,cache:js,order:Ts,clipMask:Js,clipScope:Ks})}this.replacementSource.setSources(Qr),Bt=!0}}this._clippingActiveLastFrame=qt,Bt||this.replacementSource.clear(),this.conflationActive=Bt,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Zr=0;Zr<$t.length;Zr++){const Fr=$t[Zr];if(Fr.visibility==="none")continue;const ns=Fr.cutoffRange();if(this.longestCutoffRange=Math.max(ns,this.longestCutoffRange),ns>0){const Qr=Cr(Fr);Qr&&(this.minCutoffZoom=Math.max(Qr.minzoom,this.minCutoffZoom)),Fr.minzoom&&(this.minCutoffZoom=Math.max(Fr.minzoom,this.minCutoffZoom))}Fr.is3D(lt)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Zr),this._lastOcclusionLayer=Zr)}const wr=this.style&&this.style.fog;wr?(this._fogVisible=wr.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=wr.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(cr),this.opaquePassCutoff=0,dt=ut(),$t=dt.map(Zr=>ot[Zr]));const Tr=this._shadowRenderer;if(Tr){Tr.updateShadowParameters(this.transform,this.style.directionalLight);for(const Zr in Zt)for(const Fr of sr[Zr]){let ns={min:0,max:0};this.terrain&&(ns=this.terrain.getMinMaxForTile(Fr)||ns),Tr.addShadowReceiver(Fr.toUnwrapped(),ns.min,ns.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new c.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Uw(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const br=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),yr=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(br&&!this._snow&&(this._snow=new Hv(this)),!br&&this._snow&&(this._snow.destroy(),delete this._snow),yr&&!this._rain&&(this._rain=new l_(this)),!yr&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),Ct){this.buildingTileBorderManager||(this.buildingTileBorderManager=new i_);const Zr=this.style.getLayerSourceCache(Ct);this.buildingTileBorderManager.updateBorders(Zr,Ct)}if(!cn.has(this.context.gl))return;this.renderPass="offscreen";for(const Zr of $t){const Fr=o.getLayerSourceCache(Zr);if(!Zr.hasOffscreenPass()||Zr.isHidden(this.transform.zoom))continue;const ns=Fr?ir[Fr.id]:void 0;(Zr.type==="custom"||Zr.type==="raster"||Zr.type==="raster-particle"||Zr.isSky()||ns&&ns.length)&&this.renderLayer(this,Fr,Zr,ns)}this.depthRangeFor3D=[0,1-($t.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,pr)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Pr=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Or=(()=>{if(_.showOverdrawInspector)return c.ao.black;const Zr=this.style.fog;if(Zr&&this.transform.projection.supportsFog){const Fr=this.style.getLut(Zr.scope);if(!Pr){const ns=Zr.properties.get("color-use-theme")==="none",Qr=Zr.properties.get("color").toNonPremultipliedRenderColor(ns?null:Fr).toArray01();return new c.ao(...Qr)}if(Pr){const ns=Zr.properties.get("space-color-use-theme")==="none",Qr=Zr.properties.get("space-color").toNonPremultipliedRenderColor(ns?null:Fr).toArray01();return new c.ao(...Qr)}}return c.ao.transparent})();if(this.context.clear({color:Or,depth:1}),this.clearStencil(),this._showOverdrawInspector=_.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pr&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=dt.length-1;this.currentLayer>=0;this.currentLayer--){const Zr=$t[this.currentLayer],Fr=o.getLayerSourceCache(Zr);if(Zr.isSky())continue;const ns=Fr?(Zr.is3D(lt)?ur:ir)[Fr.id]:void 0;this._renderTileClippingMasks(Zr,Fr,ns),this.renderLayer(this,Fr,Zr,ns)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Pr&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||c.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<dt.length;this.currentLayer++){const Zr=$t[this.currentLayer],Fr=o.getLayerSourceCache(Zr);Zr.isSky()&&this.renderLayer(this,Fr,Zr,Fr?ir[Fr.id]:void 0)}function Nr(Zr,Fr){let ns;return Fr&&(ns=(Zr.type==="symbol"?cr:Zr.is3D(lt)?ur:ir)[Fr.id]),ns}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<dt.length;){const Zr=$t[this.currentLayer];if(Zr.type==="raster"||Zr.type==="raster-particle"){const Fr=o.getLayerSourceCache(Zr);this.renderLayer(this,Fr,Zr,Nr(Zr,Fr))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ts=0;Tr&&(ts=Tr.getShadowCastingLayerCount());let rs=!1,cs=-1;for(let Zr=0;Zr<dt.length;++Zr){const Fr=$t[Zr];Fr.isHidden(this.transform.zoom)||Fr.is3D(lt)&&(cs=Zr)}Tt&&cs===-1&&(mt=!0);let Ss=!1;for(;this.currentLayer<dt.length;){const Zr=$t[this.currentLayer],Fr=o.getLayerSourceCache(Zr);if(Zr.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Zr)){if(Zr.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Ss&&Zr.is3D(lt)&&!lt){const ns=this.currentLayer,Qr=gs=>{for(this.currentLayer=0;this.currentLayer<$t.length;this.currentLayer++){const ks=$t[this.currentLayer];if(tp[ks.type]){const Bs=this.style.getLayerSourceCache(ks);tp[ks.type](this,Bs,ks,Nr(ks,Bs),gs)}}};Qr("initialize"),Qr("reset"),this.currentLayer=ns,Ss=!0}if(mt&&!rs&&this.terrain&&!this.transform.isOrthographic&&(rs=!0,this.blitDepth()),Tt&&cs!==-1&&this.currentLayer===cs+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Zr,Fr,Fr?sr[Fr.id]:void 0),this.renderLayer(this,Fr,Zr,Nr(Zr,Fr)),!this.terrain&&Tr&&ts>0&&Zr.hasShadowPass()&&--ts==0){{this.clearStencil(),this.resetStencilClippingMasks();const ns=this.currentLayer;for(this.currentLayer=0;this.currentLayer<$t.length;this.currentLayer++){const Qr=$t[this.currentLayer];if(u_[Qr.type]){const gs=this.style.getLayerSourceCache(Qr);u_[Qr.type](this,gs,Qr,Nr(Qr,gs))}}this.currentLayer=ns}if(Tr.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ns=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ns;this.currentLayer++){const Qr=$t[this.currentLayer];if(!Qr.hasLightBeamPass())continue;const gs=o.getLayerSourceCache(Qr);this.renderLayer(this,gs,Qr,gs?ir[gs.id]:void 0)}this.currentLayer=ns,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ns=this.currentLayer;this.depthOcclusion=!0;for(const Qr of this.layersWithOcclusionOpacity){this.currentLayer=Qr;const gs=$t[this.currentLayer],ks=o.getLayerSourceCache(gs),Bs=ks?ir[ks.id]:void 0;this.terrain||this._renderTileClippingMasks(gs,ks,ks?sr[ks.id]:void 0),this.renderLayer(this,ks,gs,Bs)}this.depthOcclusion=!1,this.currentLayer=ns,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Zr=null;$t.forEach(Fr=>{const ns=o.getLayerSourceCache(Fr);ns&&!Fr.isHidden(this.transform.zoom)&&ns.getVisibleCoordinates().length&&(!Zr||Zr.getSource().maxzoom<ns.getSource().maxzoom)&&(Zr=ns)}),Zr&&this.options.showTileBoundaries&&As(this,Zr,Zr.getVisibleCoordinates(),c.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&As(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new c.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Zr){const Fr=Zr.transform.padding;lx(Zr,Zr.transform.height-(Fr.top||0),3,Nw),lx(Zr,Fr.bottom||0,3,zw),Sl(Zr,Fr.left||0,3,Ow),Sl(Zr,Zr.transform.width-(Fr.right||0),3,ox);const ns=Zr.transform.centerPoint;(function(Qr,gs,ks,Bs){Gr(Qr,gs-1,ks-10,2,20,Bs),Gr(Qr,gs-10,ks-1,20,2,Bs)})(Zr,ns.x,Zr.transform.height-ns.y,ax)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Bt||(this.conflationActive=!1)}prepareLayer(o){this.gpuTimingStart(o);const{unsupportedLayers:_}=this.transform.projection,rt=!_||!_.includes(o.type);if(c_[o.type]&&(rt||this.terrain&&o.type==="custom")){const ot=this.style.getLayerSourceCache(o);c_[o.type](o,ot,this)}this.gpuTimingEnd()}renderLayer(o,_,rt,ot){rt.isHidden(this.transform.zoom)||(rt.type==="background"||rt.type==="sky"||rt.type==="custom"||rt.type==="model"||rt.type==="raster"||rt.type==="raster-particle"||ot&&ot.length)&&(this.id=rt.id,this.gpuTimingStart(rt),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(rt.type)&&(!o.terrain||rt.type!=="custom")||rt.type==="clip"||zm[rt.type](o,_,rt,ot,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const _=this.context.extTimerQuery,rt=this.context.gl;let ot=this.gpuTimers[o.id];ot||(ot=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:rt.createQuery()}),ot.calls++,rt.beginQuery(_.TIME_ELAPSED_EXT,ot.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const o=this.context.extTimerQuery,_=this.context.gl,rt=_.createQuery();this.deferredRenderGpuTimeQueries.push(rt),_.beginQuery(o.TIME_ELAPSED_EXT,rt)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}collectDeferredRenderGpuQueries(){const o=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],o}queryGpuTimers(o){const _={};for(const rt in o){const ot=o[rt],lt=this.context.extTimerQuery,ut=lt.getQueryParameter(ot.query,this.context.gl.QUERY_RESULT)/1e6;lt.deleteQueryEXT(ot.query),_[rt]=ut}return _}queryGpuTimeDeferredRender(o){if(!this.options.gpuTimingDeferredRender)return 0;const _=this.context.gl;let rt=0;for(const ot of o)rt+=_.getQueryParameter(ot,_.QUERY_RESULT)/1e6,_.deleteQuery(ot);return rt}translatePosMatrix(o,_,rt,ot,lt){if(!rt[0]&&!rt[1])return o;const ut=lt?ot==="map"?this.transform.angle:0:ot==="viewport"?-this.transform.angle:0;if(ut){const Tt=Math.sin(ut),Ct=Math.cos(ut);rt=[rt[0]*Ct-rt[1]*Tt,rt[0]*Tt+rt[1]*Ct]}const dt=[lt?rt[0]:c.ay(_,rt[0],this.transform.zoom),lt?rt[1]:c.ay(_,rt[1],this.transform.zoom),0],mt=new Float32Array(16);return c.br(mt,o,dt),mt}saveTileTexture(o){if(o.context!==this.context)return;const _=o.size[0],rt=this._tileTextures[_];rt?rt.push(o):this._tileTextures[_]=[o]}getTileTexture(o){const _=this._tileTextures[o];return _&&_.length>0?_.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(o,_,rt){const ot=rt===void 0?this.terrain&&this.terrain.renderingToTexture:rt,lt=[];return this.style&&this.style.enable3dLights()&&(o==="globeRaster"||o==="terrainRaster"?(lt.push("LIGHTING_3D_MODE"),lt.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):ot||lt.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||lt.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(lt.push("TERRAIN"),this.linearFloatFilteringSupported()&&lt.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&lt.push("GLOBE"),!this._fogVisible||ot||_!==void 0&&!_||lt.push("FOG","FOG_DITHERING"),ot&&lt.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&lt.push("OVERDRAW_INSPECTOR"),lt}getOrCreateProgram(o,_){this.cache=this.cache||{};const rt=_&&_.defines||[],ot=_&&_.config,lt=this.currentGlobalDefines(o,_&&_.overrideFog,_&&_.overrideRtt).concat(rt),ut=bw.cacheKey(gv[o],o,lt,ot);return this.cache[ut]||(this.cache[ut]=new bw(this.context,o,gv[o],ot,Z0[o],lt)),this.cache[ut]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(o,_){if(this.style.enable3dLights()){const rt=this.style.directionalLight,ot=this.style.ambientLight;if(rt&&ot){const lt=((ut,dt,mt)=>{const Tt=ut.properties.get("direction"),Ct=ut.properties.get("color-use-theme")==="none",Ut=ut.properties.get("color").toNonPremultipliedRenderColor(Ct?null:mt.getLut(ut.scope)).toArray01(),Bt=ut.properties.get("intensity"),$t=dt.properties.get("color-use-theme")==="none",Zt=dt.properties.get("color").toNonPremultipliedRenderColor($t?null:mt.getLut(dt.scope)).toArray01(),qt=dt.properties.get("intensity"),sr=[Tt.x,Tt.y,Tt.z],ir=c.dN(Zt,qt),cr=c.dN(Ut,Bt);return{u_lighting_ambient_color:ir,u_lighting_directional_dir:sr,u_lighting_directional_color:cr,u_ground_radiance:Fx(sr,cr,ir)}})(rt,ot,this.style);_.setLightsUniformValues(o,lt)}}}uploadCommonUniforms(o,_,rt,ot,lt){if(this.uploadCommonLightUniforms(o,_),this.terrain&&this.terrain.renderingToTexture)return;const ut=this.style.fog;if(ut){const dt=ut.getOpacity(this.transform.pitch),mt=((Tt,Ct,Ut,Bt,$t,Zt,qt,sr,ir,cr,pr,ur)=>{const Cr=Tt.transform,wr=Ct.properties.get("color-use-theme")==="none",Tr=Ct.properties.get("color").toNonPremultipliedRenderColor(wr?null:Tt.style.getLut(Ct.scope)).toArray01();Tr[3]=Bt;const br=Tt.frameCounter/1e3%1,[yr,Pr]=Ct.properties.get("vertical-range");return{u_fog_matrix:Ut?Cr.calculateFogTileMatrix(Ut):ur||Tt.identityMat,u_fog_range:Ct.getFovAdjustedRange(Cr._fov),u_fog_color:Tr,u_fog_horizon_blend:Ct.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(yr,Pr),Pr],u_fog_temporal_offset:br,u_frustum_tl:$t,u_frustum_tr:Zt,u_frustum_br:qt,u_frustum_bl:sr,u_globe_pos:ir,u_globe_radius:cr,u_viewport:pr,u_globe_transition:c.aj(Cr.zoom),u_is_globe:+(Cr.projection.name==="globe")}})(this,ut,rt,dt,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.o.devicePixelRatio,this.transform.height*c.o.devicePixelRatio],ot);_.setFogUniformValues(o,mt)}lt&&_.setCutoffUniformValues(o,lt.uniformValues)}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){const o=this.canvasCopy();o&&(this.frameCopies.push(o),this.tileLoaded=!1)}canvasCopy(){const o=this.context.gl,_=o.createTexture();return o.bindTexture(o.TEXTURE_2D,_),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),_}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,_=this._backgroundTiles={},rt=this.transform.coveringTiles({tileSize:512});for(const ot of rt)_[ot.key]=o[ot.key]||new Ym(ot,512,this.transform.tileZoom,this,void 0,this.worldview);return _}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(o,_){return!(!o.is3D(!(!this.terrain||!this.terrain.enabled))||o.type!=="clip"&&o.type!=="building"&&(o.minzoom&&o.minzoom>this.transform.zoom||(this.style._clipLayerPresent||o.sourceLayer!=="building"&&o.sourceLayer!=="procedural_buildings")&&(!_||_.type!=="batched-model")))}isTileAffectedByFog(o){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let _=this._cachedTileFogOpacities[o.key];return _||(this._cachedTileFogOpacities[o.key]=_=this.style.fog.getOpacityForTile(o)),_[0]>=hs||_[1]>=hs}setupDepthForOcclusion(o,_,rt){const ot=this.context,lt=ot.gl,ut=!!rt;var dt;rt||(rt={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),ot.activeTexture.set(lt.TEXTURE3),o&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE),rt.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],rt.u_depth_range_unpack=[2/((dt=this.depthRangeFor3D)[1]-dt[0]),-1-2*dt[0]/(dt[1]-dt[0])],rt.u_occluder_half_size=.5*this.occlusionParams.occluderSize,rt.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(lt.NEAREST,lt.CLAMP_TO_EDGE),ot.activeTexture.set(lt.TEXTURE0),ut||_.setTerrainUniformValues(ot,rt)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const o=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=o?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function d_(et,o){let _=!1,rt=null;const ot=()=>{rt=null,_&&(et(),rt=setTimeout(ot,o),_=!1)};return()=>(_=!0,rt||ot(),rt)}class Wv{constructor(o){this._hashName=o&&encodeURIComponent(o),c.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=d_(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const o=this._map;if(!o)return"";const _=Zl(o);if(this._hashName){const rt=this._hashName;let ot=!1;const lt=location.hash.slice(1).split("&").map(ut=>{const dt=ut.split("=")[0];return dt===rt?(ot=!0,`${dt}=${_}`):ut}).filter(ut=>ut);return ot||lt.push(`${rt}=${_}`),`#${lt.join("&")}`}return`#${_}`}_getCurrentHash(){const o=location.hash.replace("#","");if(this._hashName){let _;return o.split("&").map(rt=>rt.split("=")).forEach(rt=>{rt[0]===this._hashName&&(_=rt)}),(_&&_[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const _=this._getCurrentHash();if(_.length>=3&&!_.some(rt=>isNaN(Number(rt)))){const rt=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(_[3]||0):o.getBearing();return o.jumpTo({center:[+_[2],+_[1]],zoom:+_[0],bearing:rt,pitch:+(_[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Zl(et,o){const _=et.getCenter(),rt=Math.round(100*et.getZoom())/100,ot=Math.ceil((rt*Math.LN2+Math.log(512/360/.5))/Math.LN10),lt=Math.pow(10,ot),ut=Math.round(_.lng*lt)/lt,dt=Math.round(_.lat*lt)/lt,mt=et.getBearing(),Tt=et.getPitch();let Ct=o?`/${ut}/${dt}/${rt}`:`${rt}/${dt}/${ut}`;return(mt||Tt)&&(Ct+="/"+Math.round(10*mt)/10),Tt&&(Ct+=`/${Math.round(Tt)}`),Ct}const Vx={linearity:.3,easing:c.eT(0,0,.3,1)},qv=Object.assign({deceleration:2500,maxSpeed:1400},Vx),Zv=Object.assign({deceleration:20,maxSpeed:1400},Vx),dx=Object.assign({deceleration:1e3,maxSpeed:360},Vx),Xv=Object.assign({deceleration:1e3,maxSpeed:90},Vx);class Kv{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.o.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,_=c.o.now();for(;o.length>0&&_-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const _={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:lt}of this._inertiaBuffer)_.zoom+=lt.zoomDelta||0,_.bearing+=lt.bearingDelta||0,_.pitch+=lt.pitchDelta||0,lt.panDelta&&_.pan._add(lt.panDelta),lt.around&&(_.around=lt.around),lt.pinchAround&&(_.pinchAround=lt.pinchAround);const rt=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,ot={};if(_.pan.mag()){const lt=Gp(_.pan.mag(),rt,Object.assign({},qv,o||{}));ot.offset=_.pan.mult(lt.amount/_.pan.mag()),ot.center=this._map.transform.center,Ux(ot,lt)}if(_.zoom){const lt=Gp(_.zoom,rt,Zv);ot.zoom=this._map.transform.zoom+lt.amount,Ux(ot,lt)}if(_.bearing){const lt=Gp(_.bearing,rt,dx);ot.bearing=this._map.transform.bearing+c.aA(lt.amount,-179,179),Ux(ot,lt)}if(_.pitch){const lt=Gp(_.pitch,rt,Xv);ot.pitch=this._map.transform.pitch+lt.amount,Ux(ot,lt)}if(ot.zoom||ot.bearing){const lt=_.pinchAround===void 0?_.around:_.pinchAround;ot.around=lt?this._map.unproject(lt):this._map.getCenter()}return this.clear(),ot.noMoveStart=!0,ot}}function Ux(et,o){(!et.duration||et.duration<o.duration)&&(et.duration=o.duration,et.easing=o.easing)}function Gp(et,o,_){const{maxSpeed:rt,linearity:ot,deceleration:lt}=_,ut=c.aA(et*ot/(o/1e3),-rt,rt),dt=Math.abs(ut)/(lt*ot);return{easing:_.easing,duration:1e3*dt,amount:ut*(dt/2)}}class Hu extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,_,rt,ot={}){const lt=mr(_.getCanvasContainer(),rt),ut=_.unproject(lt);super(o,Object.assign({point:lt,lngLat:ut,originalEvent:rt},ot)),this._defaultPrevented=!1,this.target=_}}class Om extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,_,rt){const ot=o==="touchend"?rt.changedTouches:rt.touches,lt=Ur(_.getCanvasContainer(),ot),ut=lt.map(mt=>_.unproject(mt)),dt=lt.reduce((mt,Tt,Ct,Ut)=>mt.add(Tt.div(Ut.length)),new c.P(0,0));super(o,{points:lt,point:dt,lngLats:ut,lngLat:_.unproject(dt),originalEvent:rt}),this._defaultPrevented=!1}}class Yv extends c.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,_){super("wheel",{originalEvent:_}),this._defaultPrevented=!1}}class f_{constructor(o,_){this._map=o,this._clickTolerance=_.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Yv(this._map,o))}mousedown(o,_){return this._mousedownPos=_,this._firePreventable(new Hu(o.type,this._map,o))}mouseup(o){this._map.fire(new Hu(o.type,this._map,o))}preclick(o){const _=new MouseEvent("preclick",o);this._map.fire(new Hu(_.type,this._map,_))}click(o,_){this._mousedownPos&&this._mousedownPos.dist(_)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Hu(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Hu(o.type,this._map,o))}mouseover(o){this._map.fire(new Hu(o.type,this._map,o))}mouseout(o){this._map.fire(new Hu(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Om(o.type,this._map,o))}touchmove(o){this._map.fire(new Om(o.type,this._map,o))}touchend(o){this._map.fire(new Om(o.type,this._map,o))}touchcancel(o){this._map.fire(new Om(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qv{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Hu(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Hu("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Hu(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class p_{constructor(o,_){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=_.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,_){this.isEnabled()&&o.shiftKey&&o.button===0&&(Ht(),this._startPos=this._lastPos=_,this._active=!0)}mousemoveWindow(o,_){if(!this._active)return;const rt=_,ot=this._startPos,lt=this._lastPos;if(!ot||!lt||lt.equals(rt)||!this._box&&rt.dist(ot)<this._clickTolerance)return;this._lastPos=rt,this._box||(this._box=zt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const ut=Math.min(ot.x,rt.x),dt=Math.max(ot.x,rt.x),mt=Math.min(ot.y,rt.y),Tt=Math.max(ot.y,rt.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${ut}px,${mt}px)`,this._box.style.width=dt-ut+"px",this._box.style.height=Tt-mt+"px")})}mouseupWindow(o,_){if(!this._active)return;const rt=this._startPos,ot=_;if(rt&&o.button===0){if(this.reset(),dr(),rt.x!==ot.x||rt.y!==ot.y)return this._map.fire(new c.z("boxzoomend",{originalEvent:o})),{cameraAnimation:lt=>lt.fitScreenCoordinates(rt,ot,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tr(),delete this._startPos,delete this._lastPos}_fireEvent(o,_){return this._map.fire(new c.z(o,{originalEvent:_}))}}function m_(et,o){const _={};for(let rt=0;rt<et.length;rt++)_[et[rt].identifier]=o[rt];return _}class Xw{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,_,rt){(this.centroid||rt.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),rt.length===this.numTouches&&(this.centroid=function(ot){const lt=new c.P(0,0);for(const ut of ot)lt._add(ut);return lt.div(ot.length)}(_),this.touches=m_(rt,_)))}touchmove(o,_,rt){if(this.aborted||!this.centroid)return;const ot=m_(rt,_);for(const lt in this.touches){const ut=ot[lt];(!ut||ut.dist(this.touches[lt])>30)&&(this.aborted=!0)}}touchend(o,_,rt){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),rt.length===0){const ot=!this.aborted&&this.centroid;if(this.reset(),ot)return ot}}}class g_{constructor(o){this.singleTap=new Xw(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,_,rt){this.singleTap.touchstart(o,_,rt)}touchmove(o,_,rt){this.singleTap.touchmove(o,_,rt)}touchend(o,_,rt){const ot=this.singleTap.touchend(o,_,rt);if(ot){const lt=o.timeStamp-this.lastTime<500,ut=!this.lastTap||this.lastTap.dist(ot)<30;if(lt&&ut||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=ot,this.count===this.numTaps)return this.reset(),ot}}}class Kw{constructor(){this._zoomIn=new g_({numTouches:1,numTaps:2}),this._zoomOut=new g_({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,_,rt){this._zoomIn.touchstart(o,_,rt),this._zoomOut.touchstart(o,_,rt)}touchmove(o,_,rt){this._zoomIn.touchmove(o,_,rt),this._zoomOut.touchmove(o,_,rt)}touchend(o,_,rt){const ot=this._zoomIn.touchend(o,_,rt),lt=this._zoomOut.touchend(o,_,rt);return ot?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ut=>ut.easeTo({duration:300,zoom:ut.getZoom()+1,around:ut.unproject(ot)},{originalEvent:o})}):lt?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ut=>ut.easeTo({duration:300,zoom:ut.getZoom()-1,around:ut.unproject(lt)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Yw={0:1,2:2},Jv={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class x_{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,_){return!1}_move(o,_){return{}}mousedown(o,_){if(this._lastPoint)return;const rt=Dr(o);this._correctButton(o,rt)&&(this._lastPoint=_,this._eventButton=rt)}mousemoveWindow(o,_){const rt=this._lastPoint;if(rt){if(o.preventDefault(),this._eventButton!=null&&function(ot,lt){const ut=Yw[lt];return ot.buttons===void 0||(ot.buttons&ut)!==ut}(o,this._eventButton))this.reset();else if(this._moved||!(_.dist(rt)<this._clickTolerance))return this._moved=!0,this._lastPoint=_,this._move(rt,_)}}mouseupWindow(o){this._lastPoint&&Dr(o)===this._eventButton&&(this._moved&&dr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qw extends x_{mousedown(o,_){super.mousedown(o,_),this._lastPoint&&(this._active=!0)}_correctButton(o,_){return _===0&&!o.ctrlKey}_move(o,_){return{around:_,panDelta:_.sub(o)}}}class e1 extends x_{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Jv[o.pitchRotateKey]:void 0}_correctButton(o,_){return this._pitchRotateKey?_===0&&o[this._pitchRotateKey]:_===0&&o.ctrlKey||_===2}_move(o,_){const rt=.8*(_.x-o.x);if(rt)return this._active=!0,{bearingDelta:rt}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class t1 extends x_{constructor(o){super(o),this._pitchRotateKey=o.pitchRotateKey?Jv[o.pitchRotateKey]:void 0}_correctButton(o,_){return this._pitchRotateKey?_===0&&o[this._pitchRotateKey]:_===0&&o.ctrlKey||_===2}_move(o,_){const rt=-.5*(_.y-o.y);if(rt)return this._active=!0,{pitchDelta:rt}}contextmenu(o){this._pitchRotateKey||o.preventDefault()}}class Jw{constructor(o,_){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=_.clickTolerance||1,this.reset(),c.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}touchstart(o,_,rt){return this._calculateTransform(o,_,rt)}touchmove(o,_,rt){if(this._active&&!(rt.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(rt.length===1&&!c.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.cancelable&&o.preventDefault(),this._calculateTransform(o,_,rt)}}touchend(o,_,rt){this._calculateTransform(o,_,rt),this._active&&rt.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,_,rt){rt.length>0&&(this._active=!0);const ot=m_(rt,_),lt=new c.P(0,0),ut=new c.P(0,0);let dt=0;for(const Tt in ot){const Ct=ot[Tt],Ut=this._touches[Tt];Ut&&(lt._add(Ct),ut._add(Ct.sub(Ut)),dt++,ot[Tt]=Ct)}if(this._touches=ot,dt<this._minTouches||!ut.mag())return;const mt=ut.div(dt);return this._sum._add(mt),this._sum.mag()<this._clickTolerance?void 0:{around:lt.div(dt),panDelta:mt}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class y_{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,_,rt){return{}}touchstart(o,_,rt){this._firstTwoTouches||rt.length<2||(this._firstTwoTouches=[rt[0].identifier,rt[1].identifier],this._start([_[0],_[1]]))}touchmove(o,_,rt){const ot=this._firstTwoTouches;if(!ot)return;o.preventDefault();const[lt,ut]=ot,dt=zy(rt,_,lt),mt=zy(rt,_,ut);if(!dt||!mt)return;const Tt=this._aroundCenter?null:dt.add(mt).div(2);return this._move([dt,mt],Tt,o)}touchend(o,_,rt){if(!this._firstTwoTouches)return;const[ot,lt]=this._firstTwoTouches,ut=zy(rt,_,ot),dt=zy(rt,_,lt);ut&&dt||(this._active&&dr(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zy(et,o,_){for(let rt=0;rt<et.length;rt++)if(et[rt].identifier===_)return o[rt]}function eE(et,o){return Math.log2(et/o)}class _2 extends y_{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,_){const rt=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(eE(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:eE(this._distance,rt),pinchAround:_}}}function tE(et,o){return 180*et.angleWith(o)/Math.PI}class ga extends y_{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,_){const rt=this._vector;if(this._vector=o[0].sub(o[1]),rt&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:tE(this._vector,rt),pinchAround:_}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const _=25/(Math.PI*this._minDiameter)*360,rt=this._startVector;if(!rt)return!1;const ot=tE(o,rt);return Math.abs(ot)<_}}function __(et){return Math.abs(et.y)>Math.abs(et.x)}class v2 extends y_{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,__(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,_,rt){const ot=this._lastPoints;if(!ot)return;const lt=o[0].sub(ot[0]),ut=o[1].sub(ot[1]);return this._map._cooperativeGestures&&!c.eU()&&rt.touches.length<3||(this._valid=this.gestureBeginsVertically(lt,ut,rt.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(lt.y+ut.y)/2*-.5})}gestureBeginsVertically(o,_,rt){if(this._valid!==void 0)return this._valid;const ot=o.mag()>=2,lt=_.mag()>=2;if(!ot&&!lt)return;if(!ot||!lt)return this._firstMove==null&&(this._firstMove=rt),rt-this._firstMove<100&&void 0;const ut=o.y>0==_.y>0;return __(o)&&__(_)&&ut}}const b2={panStep:100,bearingStep:15,pitchStep:10};class w2{constructor(){const o=b2;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let _=0,rt=0,ot=0,lt=0,ut=0;switch(o.keyCode){case 61:case 107:case 171:case 187:_=1;break;case 189:case 109:case 173:_=-1;break;case 37:o.shiftKey?rt=-1:(o.preventDefault(),lt=-1);break;case 39:o.shiftKey?rt=1:(o.preventDefault(),lt=1);break;case 38:o.shiftKey?ot=1:(o.preventDefault(),ut=-1);break;case 40:o.shiftKey?ot=-1:(o.preventDefault(),ut=1);break;default:return}return this._rotationDisabled&&(rt=0,ot=0),{cameraAnimation:dt=>{const mt=dt.getZoom();dt.easeTo({duration:300,easeId:"keyboardHandler",easing:Oy,zoom:_?Math.round(mt)+_*(o.shiftKey?2:1):mt,bearing:dt.getBearing()+rt*this._bearingStep,pitch:dt.getPitch()+ot*this._pitchStep,offset:[-lt*this._panStep,-ut*this._panStep],center:dt.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Oy(et){return et*(2-et)}const r1=4.000244140625,i1=1/450;class v_{constructor(o,_){this._map=o,this._el=o.getCanvasContainer(),this._handler=_,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=i1,c.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||c.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let _=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const rt=c.o.now(),ot=rt-(this._lastWheelEventTime||0);this._lastWheelEventTime=rt,_!==0&&_%r1==0?this._type="wheel":_!==0&&Math.abs(_)<4?this._type="trackpad":ot>400?(this._type=null,this._lastValue=_,this._timeout=window.setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(ot*_)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,_+=this._lastValue)),o.shiftKey&&_&&(_/=4),this._type&&(this._lastWheelEvent=o,this._delta-=_,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const _=mr(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:_,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform;this._type==="wheel"&&o.projection.wrap&&(o._center.lng>=180||o._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const _=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const Tt=this._type==="wheel"&&Math.abs(this._delta)>r1?this._wheelZoomRate:this._defaultZoomRate;let Ct=2/(1+Math.exp(-Math.abs(this._delta*Tt)));this._delta<0&&Ct!==0&&(Ct=1/Ct);const Ut=_(),Bt=Math.pow(2,Ut),$t=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):Bt;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom($t*Ct))),this._type==="wheel"&&(this._startZoom=Ut,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const rt=typeof this._targetZoom=="number"?this._targetZoom:_(),ot=this._startZoom,lt=this._easing;let ut,dt=!1;if(this._type==="wheel"&&ot&&lt){const Tt=Math.min((c.o.now()-this._lastWheelEventTime)/200,1),Ct=lt(Tt);ut=c.ak(ot,rt,Ct),Tt<1?this._frameId||(this._frameId=!0):dt=!0}else ut=rt,dt=!0;this._active=!0,dt&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let mt=ut-_();return mt*this._lastDelta<0&&(mt=0),{noInertia:!0,needsRenderFrame:!dt,zoomDelta:mt,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let _=c.eV;if(this._prevEase){const rt=this._prevEase,ot=(c.o.now()-rt.start)/rt.duration,lt=rt.easing(ot+.01)-rt.easing(ot),ut=.27/Math.sqrt(lt*lt+1e-4)*.01,dt=Math.sqrt(.0729-ut*ut);_=c.eT(ut,dt,.25,1)}return this._prevEase={start:c.o.now(),duration:o,easing:_},_}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=zt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class am{constructor(o,_){this._clickZoom=o,this._tapZoom=_}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class b_{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,_){return o.preventDefault(),{cameraAnimation:rt=>{rt.easeTo({duration:300,zoom:rt.getZoom()+(o.shiftKey?-1:1),around:rt.unproject(_)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xl{constructor(){this._tap=new g_({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,_,rt){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?rt.length>0&&(this._swipePoint=_[0],this._swipeTouch=rt[0].identifier):this._tap.touchstart(o,_,rt))}touchmove(o,_,rt){if(this._tapTime){if(this._swipePoint){if(rt[0].identifier!==this._swipeTouch)return;const ot=_[0],lt=ot.y-this._swipePoint.y;return this._swipePoint=ot,o.preventDefault(),this._active=!0,{zoomDelta:lt/128}}}else this._tap.touchmove(o,_,rt)}touchend(o,_,rt){this._tapTime?this._swipePoint&&rt.length===0&&this.reset():this._tap.touchend(o,_,rt)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hp{constructor(o,_,rt){this._el=o,this._mousePan=_,this._touchPan=rt}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class By{constructor(o,_,rt){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=_,this._mousePitch=rt}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class w_{constructor(o,_,rt,ot){this._el=o,this._touchZoom=_,this._touchRotate=rt,this._tapDragZoom=ot,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vy=et=>et.zoom||et.drag||et.pitch||et.rotate;class E2 extends c.z{}class Uy{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,_){const rt=c.av([],_,o);this.radius=c.ag(rt[2]<0?c.eX([],rt,this.constants):[rt[0],rt[1],0])}projectRay(o){c.eX(o,o,this.constants),c.aw(o,o),c.eY(o,o,this.constants);const _=c.c5([],o,this.radius);if(_[2]>0){const rt=c.c5([],[0,0,1],c.bJ(_,[0,0,1])),ot=c.c5([],c.aw([],[_[0],_[1],0]),this.radius),lt=c.d8([],_,c.c5([],c.av([],c.d8([],ot,rt),_),2));_[0]=lt[0],_[1]=lt[1]}return _}}function E_(et){return et.panDelta&&et.panDelta.mag()||et.zoomDelta||et.bearingDelta||et.pitchDelta}class S2{constructor(o,_){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Kv(o),this._bearingSnap=_.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Uy,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(_),c.aY(["handleEvent","handleWindowEvent"],this);const rt=this._el;this._listeners=[[rt,"touchstart",{passive:!0}],[rt,"touchmove",{passive:!1}],[rt,"touchend",void 0],[rt,"touchcancel",void 0],[rt,"mousedown",void 0],[rt,"mousemove",void 0],[rt,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[rt,"mouseover",void 0],[rt,"mouseout",void 0],[rt,"dblclick",void 0],[rt,"click",void 0],[rt,"keydown",{capture:!1}],[rt,"keyup",void 0],[rt,"wheel",{passive:!1}],[rt,"contextmenu",void 0],[window,"blur",void 0]];for(const[ot,lt,ut]of this._listeners){const dt=ot===document?this.handleWindowEvent:this.handleEvent;ot.addEventListener(lt,dt,ut)}}destroy(){for(const[o,_,rt]of this._listeners){const ot=o===document?this.handleWindowEvent:this.handleEvent;o.removeEventListener(_,ot,rt)}}_addDefaultHandlers(o){const _=this._map,rt=_.getCanvasContainer();this._add("mapEvent",new f_(_,o));const ot=_.boxZoom=new p_(_,o);this._add("boxZoom",ot);const lt=new Kw,ut=new b_;_.doubleClickZoom=new am(ut,lt),this._add("tapZoom",lt),this._add("clickZoom",ut);const dt=new Xl;this._add("tapDragZoom",dt);const mt=_.touchPitch=new v2(_);this._add("touchPitch",mt);const Tt=new e1(o),Ct=new t1(o);_.dragRotate=new By(o,Tt,Ct),this._add("mouseRotate",Tt,["mousePitch"]),this._add("mousePitch",Ct,["mouseRotate"]);const Ut=new Qw(o),Bt=new Jw(_,o);_.dragPan=new Hp(rt,Ut,Bt),this._add("mousePan",Ut),this._add("touchPan",Bt,["touchZoom","touchRotate"]);const $t=new ga,Zt=new _2;_.touchZoomRotate=new w_(rt,Zt,$t,dt),this._add("touchRotate",$t,["touchPan","touchZoom"]),this._add("touchZoom",Zt,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Qv(_));const qt=_.scrollZoom=new v_(_,this);this._add("scrollZoom",qt,["mousePan"]);const sr=_.keyboard=new w2;this._add("keyboard",sr);for(const ir of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[ir]&&_[ir].enable(o[ir])}_add(o,_,rt){this._handlers.push({handlerName:o,handler:_,allowed:rt}),this._handlersById[o]=_}stop(o){if(!this._updatingCamera){for(const{handler:_}of this._handlers)_.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vy(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(o,_,rt){for(const ot in o)if(ot!==rt&&(!_||_.indexOf(ot)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const _=[];for(const rt of o)this._el.contains(rt.target)&&_.push(rt);return _}handleEvent(o,_){this._updatingCamera=!0;const rt=o.type==="renderFrame",ot=rt?void 0:o,lt={needsRenderFrame:!1},ut={},dt={},mt=o.touches?this._getMapTouches(o.touches):void 0,Tt=mt?Ur(this._el,mt):rt?void 0:mr(this._el,o);for(const{handlerName:Bt,handler:$t,allowed:Zt}of this._handlers){if(!$t.isEnabled())continue;let qt;this._blockedByActive(dt,Zt,Bt)?$t.reset():$t[_||o.type]&&(qt=$t[_||o.type](o,Tt,mt),this.mergeHandlerResult(lt,ut,qt,Bt,ot),qt&&qt.needsRenderFrame&&this._triggerRenderFrame()),(qt||$t.isActive())&&(dt[Bt]=$t)}const Ct={};for(const Bt in this._previousActiveHandlers)dt[Bt]||(Ct[Bt]=ot);this._previousActiveHandlers=dt,(Object.keys(Ct).length||E_(lt))&&(this._changes.push([lt,ut,Ct]),this._triggerRenderFrame()),(Object.keys(dt).length||E_(lt))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Ut}=lt;Ut&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Ut(this._map))}mergeHandlerResult(o,_,rt,ot,lt){if(!rt)return;Object.assign(o,rt);const ut={handlerName:ot,originalEvent:rt.originalEvent||lt};rt.zoomDelta!==void 0&&(_.zoom=ut),rt.panDelta!==void 0&&(_.drag=ut),rt.pitchDelta!==void 0&&(_.pitch=ut),rt.bearingDelta!==void 0&&(_.rotate=ut)}_applyChanges(){const o={},_={},rt={};for(const[ot,lt,ut]of this._changes)ot.panDelta&&(o.panDelta=(o.panDelta||new c.P(0,0))._add(ot.panDelta)),ot.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+ot.zoomDelta),ot.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+ot.bearingDelta),ot.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+ot.pitchDelta),ot.around!==void 0&&(o.around=ot.around),ot.aroundCoord!==void 0&&(o.aroundCoord=ot.aroundCoord),ot.pinchAround!==void 0&&(o.pinchAround=ot.pinchAround),ot.noInertia&&(o.noInertia=ot.noInertia),Object.assign(_,lt),Object.assign(rt,ut);this._updateMapTransform(o,_,rt),this._changes=[]}_updateMapTransform(o,_,rt){const ot=this._map,lt=ot.transform,ut=cr=>[cr.x,cr.y,cr.z];if((cr=>{const pr=this._eventsInProgress.drag;return pr&&!this._handlersById[pr.handlerName].isActive()})()&&!E_(o)){const cr=lt.zoom;lt.cameraElevationReference="sea",this._originalZoom!=null&&lt._orthographicProjectionAtLowPitch&&lt.projection.name!=="globe"&&lt.pitch===0?(lt.cameraElevationReference="ground",lt.zoom=this._originalZoom):(lt.recenterOnTerrain(),lt.cameraElevationReference="ground"),cr!==lt.zoom&&this._map._update(!0)}if(lt._isCameraConstrained&&ot._stop(!0),!E_(o))return void this._fireEvents(_,rt,!0);let{panDelta:dt,zoomDelta:mt,bearingDelta:Tt,pitchDelta:Ct,around:Ut,aroundCoord:Bt,pinchAround:$t}=o;lt._isCameraConstrained&&(mt>0&&(mt=0),lt._isCameraConstrained=!1),$t!==void 0&&(Ut=$t),(mt||(cr=>_[cr]&&!this._eventsInProgress[cr])("drag"))&&Ut&&(this._dragOrigin=ut(lt.pointCoordinate3D(Ut)),this._originalZoom=lt.zoom,this._trackingEllipsoid.setup(lt._camera.position,this._dragOrigin)),lt.cameraElevationReference="sea",ot._stop(!0),Ut=Ut||ot.transform.centerPoint,Tt&&(lt.bearing+=Tt),Ct&&(lt.pitch+=Ct),lt._updateCameraState();const Zt=[0,0,0];if(dt)if(lt.projection.name==="mercator"){const cr=this._trackingEllipsoid.projectRay(lt.screenPointToMercatorRay(Ut).dir),pr=this._trackingEllipsoid.projectRay(lt.screenPointToMercatorRay(Ut.sub(dt)).dir);Zt[0]=pr[0]-cr[0],Zt[1]=pr[1]-cr[1]}else{const cr=lt.pointCoordinate(Ut);if(lt.projection.name==="globe"){dt=dt.rotate(-lt.angle);const pr=lt._pixelsPerMercatorPixel/lt.worldSize;Zt[0]=-dt.x*c.eW(c.a$(cr.y))*pr,Zt[1]=-dt.y*c.eW(lt.center.lat)*pr}else{const pr=lt.pointCoordinate(Ut.sub(dt));cr&&pr&&(Zt[0]=pr.x-cr.x,Zt[1]=pr.y-cr.y)}}const qt=lt.zoom,sr=[0,0,0];if(mt){const cr=ut(Bt||lt.pointCoordinate3D(Ut)),pr={dir:c.aw([],c.av([],cr,lt._camera.position))};if(pr.dir[2]<0){const ur=lt.zoomDeltaToMovement(cr,mt);c.c5(sr,pr.dir,ur)}}const ir=c.d8(Zt,Zt,sr);lt._translateCameraConstrained(ir),mt&&Math.abs(lt.zoom-qt)>1e-4&&lt.recenterOnTerrain(),lt.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(_,rt,!0)}_fireEvents(o,_,rt){const ot=Vy(this._eventsInProgress),lt=Vy(o),ut={};for(const Ct in o){const{originalEvent:Ut}=o[Ct];this._eventsInProgress[Ct]||(ut[`${Ct}start`]=Ut),this._eventsInProgress[Ct]=o[Ct]}!ot&&lt&&this._fireEvent("movestart",lt.originalEvent);for(const Ct in ut)this._fireEvent(Ct,ut[Ct]);lt&&this._fireEvent("move",lt.originalEvent);for(const Ct in o){const{originalEvent:Ut}=o[Ct];this._fireEvent(Ct,Ut)}const dt={};let mt;for(const Ct in this._eventsInProgress){const{handlerName:Ut,originalEvent:Bt}=this._eventsInProgress[Ct];this._handlersById[Ut].isActive()||(delete this._eventsInProgress[Ct],mt=_[Ut]||Bt,dt[`${Ct}end`]=mt)}for(const Ct in dt)this._fireEvent(Ct,dt[Ct]);const Tt=Vy(this._eventsInProgress);if(rt&&(ot||lt)&&!Tt){this._updatingCamera=!0;const Ct=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ut=Bt=>Bt!==0&&-this._bearingSnap<Bt&&Bt<this._bearingSnap;Ct?(Ut(Ct.bearing||this._map.getBearing())&&(Ct.bearing=0),this._map.easeTo(Ct,{originalEvent:mt})):(this._map.fire(new c.z("moveend",{originalEvent:mt})),Ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,_){this._map.fire(new c.z(o,_?{originalEvent:_}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new E2("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const S_="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class s1 extends c.E{constructor(o,_){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=_.bearingSnap,this._respectPrefersReducedMotion=_.respectPrefersReducedMotion!==!1,c.aY(["_renderFrameCallback"],this)}getCenter(){return new c.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(o,_){return this.jumpTo({center:o},_)}panBy(o,_,rt){return o=c.P.convert(o).mult(-1),this.panTo(this.transform.center,Object.assign({offset:o},_),rt)}panTo(o,_,rt){return this.easeTo(Object.assign({center:o},_),rt)}getZoom(){return this.transform.zoom}setZoom(o,_){return this.jumpTo({zoom:o},_),this}zoomTo(o,_,rt){return this.easeTo(Object.assign({zoom:o},_),rt)}zoomIn(o,_){return this.zoomTo(this.getZoom()+1,o,_),this}zoomOut(o,_){return this.zoomTo(this.getZoom()-1,o,_),this}getBearing(){return this.transform.bearing}setBearing(o,_){return this.jumpTo({bearing:o},_),this}getPadding(){return this.transform.padding}setPadding(o,_){return this.jumpTo({padding:o},_),this}rotateTo(o,_,rt){return this.easeTo(Object.assign({bearing:o},_),rt)}resetNorth(o,_){return this.rotateTo(0,Object.assign({duration:1e3},o),_),this}resetNorthPitch(o,_){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},o),_),this}snapToNorth(o,_){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,_):this}getPitch(){return this.transform.pitch}setPitch(o,_){return this.jumpTo({pitch:o},_),this}cameraForBounds(o,_){o=c.aI.convert(o);const rt=_&&_.bearing||0,ot=_&&_.pitch||0,lt=o.getNorthWest(),ut=o.getSouthEast();return this._cameraForBounds(this.transform,lt,ut,rt,ot,_)}_extendPadding(o){const _={top:0,right:0,bottom:0,left:0};return o==null?Object.assign({},_,this.transform.padding):typeof o=="number"?{top:o,bottom:o,right:o,left:o}:Object.assign({},_,o)}_extendCameraOptions(o){return(o=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=this._extendPadding(o.padding),o}_minimumAABBFrustumDistance(o,_){const rt=_.max[0]-_.min[0],ot=_.max[1]-_.min[1];return rt/ot>o.aspect?rt/(2*Math.tan(.5*o.fovX)*o.aspect):ot/(2*Math.tan(.5*o.fovY)*o.aspect)}_cameraForBoundsOnGlobe(o,_,rt,ot,lt,ut){const dt=o.clone(),mt=this._extendCameraOptions(ut);dt.bearing=ot,dt.pitch=lt;const Tt=c.aT.convert(_),Ct=c.aT.convert(rt),Ut=.5*(Tt.lat+Ct.lat),Bt=.5*(Tt.lng+Ct.lng),$t=c.eZ(Ut,Bt),Zt=c.aw([],$t),qt=c.aw([],c.bI([],Zt,[0,1,0])),sr=c.bI([],qt,Zt),ir=[qt[0],qt[1],qt[2],0,sr[0],sr[1],sr[2],0,Zt[0],Zt[1],Zt[2],0,0,0,0,1],cr=[$t,c.eZ(Tt.lat,Tt.lng),c.eZ(Ct.lat,Tt.lng),c.eZ(Ct.lat,Ct.lng),c.eZ(Tt.lat,Ct.lng),c.eZ(Ut,Tt.lng),c.eZ(Ut,Ct.lng),c.eZ(Tt.lat,Bt),c.eZ(Ct.lat,Bt)];let pr=c.d9.fromPoints(cr.map(Qr=>[c.bJ(qt,Qr),c.bJ(sr,Qr),c.bJ(Zt,Qr)]));const ur=c.af([],pr.center,ir);c.e_(ur)===0&&c.e$(ur,0,0,1),c.aw(ur,ur),c.c5(ur,ur,c.aD),dt.center=c.f0(ur);const Cr=dt.getWorldToCameraMatrix(),wr=c.bl(new Float64Array(16),Cr);pr=c.d9.applyTransform(pr,c.aB([],Cr,ir));const Tr=this._extendAABB(pr,dt,mt,ot);if(!Tr)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pr=Tr,c.af(ur,ur,Cr);const br=.5*(pr.max[2]-pr.min[2]),yr=this._minimumAABBFrustumDistance(dt,pr),Pr=c.c5([],[0,0,1],br),Or=c.d8(Pr,ur,Pr),Nr=yr+(dt.pitch===0?0:c.bG(ur,Or)),ts=dt.globeCenterInViewSpace,rs=c.av([],ur,[ts[0],ts[1],ts[2]]);c.aw(rs,rs),c.c5(rs,rs,Nr);const cs=c.d8([],ur,rs);c.af(cs,cs,wr);const Ss=c.eM/c.aD,Zr=c.ag(cs),Fr=c.cf(Math.max(Zr*Ss-c.eM,Number.EPSILON),0),ns=Math.min(dt.zoomFromMercatorZAdjusted(Fr),mt.maxZoom);return ns>.5*(c.c_+c.cL)?(dt.setProjection({name:"mercator"}),dt.zoom=ns,this._cameraForBounds(dt,_,rt,ot,lt,ut)):{center:dt.center,zoom:ns,bearing:ot,pitch:lt}}_extendAABB(o,_,rt,ot){const lt=.5*((rt.padding.left||0)+(rt.padding.right||0)),ut=.5*((rt.padding.top||0)+(rt.padding.bottom||0)),dt=ut,mt=lt,Tt=lt,Ct=ut,Ut=_.width-(mt+Tt),Bt=_.height-(dt+Ct),$t=c.av([],o.max,o.min),Zt=Math.min(Ut/$t[0],Bt/$t[1]),qt=Math.min(_.scaleZoom(_.scale*Zt),rt.maxZoom);if(isNaN(qt))return null;const sr=_.scale/_.zoomScale(qt),ir=new c.d9([o.min[0]-mt*sr,o.min[1]-Ct*sr,o.min[2]],[o.max[0]+Tt*sr,o.max[1]+dt*sr,o.max[2]]),cr=(typeof rt.offset.x=="number"&&typeof rt.offset.y=="number"?new c.P(rt.offset.x,rt.offset.y):c.P.convert(rt.offset)).rotate(-c.an(ot));return ir.center[0]-=cr.x*sr,ir.center[1]+=cr.y*sr,ir}queryTerrainElevation(o,_){const rt=this.transform.elevation;return rt?(_=Object.assign({},{exaggerated:!0},_),rt.getAtPoint(c.ae.fromLngLat(o),null,_.exaggerated)):null}_cameraForBounds(o,_,rt,ot,lt,ut){if(o.projection.name==="globe")return this._cameraForBoundsOnGlobe(o,_,rt,ot,lt,ut);const dt=o.clone(),mt=this._extendCameraOptions(ut);dt.bearing=ot,dt.pitch=lt;const Tt=c.aT.convert(_),Ct=c.aT.convert(rt),Ut=new c.aT(Tt.lng,Ct.lat),Bt=new c.aT(Ct.lng,Tt.lat),$t=dt.project(Tt),Zt=dt.project(Ct),qt=this.queryTerrainElevation(Tt),sr=this.queryTerrainElevation(Ct),ir=this.queryTerrainElevation(Ut),cr=this.queryTerrainElevation(Bt),pr=[[$t.x,$t.y,Math.min(qt||0,sr||0,ir||0,cr||0)],[Zt.x,Zt.y,Math.max(qt||0,sr||0,ir||0,cr||0)]];let ur=c.d9.fromPoints(pr);const Cr=dt.getWorldToCameraMatrix(),wr=c.bl(new Float64Array(16),Cr);ur=c.d9.applyTransform(ur,Cr);const Tr=this._extendAABB(ur,dt,mt,ot);if(!Tr)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ur=Tr;const br=.5*c.av([],ur.max,ur.min)[2],yr=this._minimumAABBFrustumDistance(dt,ur),Pr=[0,0,1,0];c.aC(Pr,Pr,Cr),c.f1(Pr,Pr);const Or=c.c5([],Pr,yr+br),Nr=c.d8([],ur.center,Or);c.af(ur.center,ur.center,wr),c.af(Nr,Nr,wr);const ts=dt.unproject(new c.P(ur.center[0],ur.center[1])),rs=c.f2(dt.projection,ts),cs=Math.pow(2,rs),Ss=Math.min(dt._zoomFromMercatorZ(Nr[2]*dt.pixelsPerMeter*cs/dt.worldSize),mt.maxZoom);return dt.mercatorFromTransition&&Ss<.5*(c.c_+c.cL)?(dt.setProjection({name:"globe"}),dt.zoom=Ss,this._cameraForBounds(dt,_,rt,ot,lt,ut)):{center:ts,zoom:Ss,bearing:ot,pitch:lt}}fitBounds(o,_,rt){const ot=this.cameraForBounds(o,_);return this._fitInternal(ot,_,rt)}fitScreenCoordinates(o,_,rt,ot,lt){const ut=c.P.convert(o),dt=c.P.convert(_),mt=new c.P(Math.min(ut.x,dt.x),Math.min(ut.y,dt.y)),Tt=new c.P(Math.max(ut.x,dt.x),Math.max(ut.y,dt.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(ut,dt))return this;const Ct=this.transform.pointLocation3D(mt),Ut=this.transform.pointLocation3D(Tt),Bt=this.transform.pointLocation3D(new c.P(mt.x,Tt.y)),$t=this.transform.pointLocation3D(new c.P(Tt.x,mt.y)),Zt=[Math.min(Ct.lng,Ut.lng,Bt.lng,$t.lng),Math.min(Ct.lat,Ut.lat,Bt.lat,$t.lat)],qt=[Math.max(Ct.lng,Ut.lng,Bt.lng,$t.lng),Math.max(Ct.lat,Ut.lat,Bt.lat,$t.lat)],sr=ot&&ot.pitch?ot.pitch:this.getPitch(),ir=this._cameraForBounds(this.transform,Zt,qt,rt,sr,ot);return this._fitInternal(ir,ot,lt)}_fitInternal(o,_,rt){return o?(_=Object.assign(o,_)).linear?this.easeTo(_,rt):this.flyTo(_,rt):this}jumpTo(o,_){this.stop();const rt=o.preloadOnly?this.transform.clone():this.transform;let ot=!1,lt=!1,ut=!1;"zoom"in o&&rt.zoom!==+o.zoom&&(ot=!0,rt.zoom=+o.zoom),o.center!==void 0&&(rt.center=c.aT.convert(o.center)),"bearing"in o&&rt.bearing!==+o.bearing&&(lt=!0,rt.bearing=+o.bearing),"pitch"in o&&rt.pitch!==+o.pitch&&(ut=!0,rt.pitch=+o.pitch);const dt=typeof o.padding=="number"?this._extendPadding(o.padding):o.padding;if(o.padding!=null&&!rt.isPaddingEqual(dt))if(o.retainPadding===!1){const mt=rt.clone();mt.padding=dt,rt.setLocationAtPoint(rt.center,mt.centerPoint)}else rt.padding=dt;return o.preloadOnly?(this._preloadTiles(rt),this):(this.fire(new c.z("movestart",_)).fire(new c.z("move",_)),ot&&this.fire(new c.z("zoomstart",_)).fire(new c.z("zoom",_)).fire(new c.z("zoomend",_)),lt&&this.fire(new c.z("rotatestart",_)).fire(new c.z("rotate",_)).fire(new c.z("rotateend",_)),ut&&this.fire(new c.z("pitchstart",_)).fire(new c.z("pitch",_)).fire(new c.z("pitchend",_)),this.fire(new c.z("moveend",_)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.w(S_),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,_){const rt=this.transform;if(!rt.projection.supportsFreeCamera)return c.w(S_),this;this.stop();const ot=rt.zoom,lt=rt.pitch,ut=rt.bearing;rt.setFreeCameraOptions(o);const dt=ot!==rt.zoom,mt=lt!==rt.pitch,Tt=ut!==rt.bearing;return this.fire(new c.z("movestart",_)).fire(new c.z("move",_)),dt&&this.fire(new c.z("zoomstart",_)).fire(new c.z("zoom",_)).fire(new c.z("zoomend",_)),Tt&&this.fire(new c.z("rotatestart",_)).fire(new c.z("rotate",_)).fire(new c.z("rotateend",_)),mt&&this.fire(new c.z("pitchstart",_)).fire(new c.z("pitch",_)).fire(new c.z("pitchend",_)),this.fire(new c.z("moveend",_)),this}easeTo(o,_){this._stop(!1,o.easeId),((o=Object.assign({offset:[0,0],duration:500,easing:c.eV},o)).animate===!1||this._prefersReducedMotion(o))&&(o.duration=0);const rt=this.transform,ot=this.getZoom(),lt=this.getBearing(),ut=this.getPitch(),dt=this.getPadding(),mt="zoom"in o?+o.zoom:ot,Tt="bearing"in o?this._normalizeBearing(o.bearing,lt):lt,Ct="pitch"in o?+o.pitch:ut,Ut=this._extendPadding(o.padding),Bt=c.P.convert(o.offset);let $t,Zt,qt;if(rt.projection.name==="globe"){const Pr=c.ae.fromLngLat(rt.center),Or=Bt.rotate(-rt.angle);Pr.x+=Or.x/rt.worldSize,Pr.y+=Or.y/rt.worldSize;const Nr=Pr.toLngLat(),ts=c.aT.convert(o.center||Nr);this._normalizeCenter(ts),$t=rt.centerPoint.add(Or),Zt=new c.P(Pr.x,Pr.y).mult(rt.worldSize),qt=new c.P(c.aF(ts.lng),c.aJ(ts.lat)).mult(rt.worldSize).sub(Zt)}else{$t=rt.centerPoint.add(Bt);const Pr=rt.pointLocation($t),Or=c.aT.convert(o.center||Pr);this._normalizeCenter(Or),Zt=rt.project(Pr),qt=rt.project(Or).sub(Zt)}const sr=rt.zoomScale(mt-ot);let ir,cr;o.around&&(ir=c.aT.convert(o.around),cr=rt.locationPoint(ir));const pr=this._zooming||mt!==ot,ur=this._rotating||lt!==Tt,Cr=this._pitching||Ct!==ut,wr=!rt.isPaddingEqual(Ut),Tr=o.retainPadding===!1?rt.clone():rt,br=Pr=>Or=>{if(pr&&(Pr.zoom=c.ak(ot,mt,Or)),ur&&(Pr.bearing=c.ak(lt,Tt,Or)),Cr&&(Pr.pitch=c.ak(ut,Ct,Or)),wr&&(Tr.interpolatePadding(dt,Ut,Or),$t=Tr.centerPoint.add(Bt)),ir)Pr.setLocationAtPoint(ir,cr);else{const Nr=Pr.zoomScale(Pr.zoom-ot),ts=mt>ot?Math.min(2,sr):Math.max(.5,sr),rs=Math.pow(ts,1-Or),cs=Pr.unproject(Zt.add(qt.mult(Or*rs)).mult(Nr));Pr.setLocationAtPoint(Pr.renderWorldCopies?cs.wrap():cs,$t)}return o.preloadOnly||this._fireMoveEvents(_),Pr};if(o.preloadOnly){const Pr=this._emulate(br,o.duration,rt);return this._preloadTiles(Pr),this}const yr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pr,this._rotating=ur,this._pitching=Cr,this._padding=wr,this._easeId=o.easeId,this._prepareEase(_,o.noMoveStart,yr),this._ease(br(rt),Pr=>{rt.cameraElevationReference==="sea"&&rt.recenterOnTerrain(),this._afterEase(_,Pr)},o),this}_prepareEase(o,_,rt={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),_||rt.moving||this.fire(new c.z("movestart",o)),this._zooming&&!rt.zooming&&this.fire(new c.z("zoomstart",o)),this._rotating&&!rt.rotating&&this.fire(new c.z("rotatestart",o)),this._pitching&&!rt.pitching&&this.fire(new c.z("pitchstart",o))}_fireMoveEvents(o){this.fire(new c.z("move",o)),this._zooming&&this.fire(new c.z("zoom",o)),this._rotating&&this.fire(new c.z("rotate",o)),this._pitching&&this.fire(new c.z("pitch",o))}_afterEase(o,_){if(this._easeId&&_&&this._easeId===_)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const rt=this._zooming,ot=this._rotating,lt=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,rt&&this.fire(new c.z("zoomend",o)),ot&&this.fire(new c.z("rotateend",o)),lt&&this.fire(new c.z("pitchend",o)),this.fire(new c.z("moveend",o))}flyTo(o,_){if(this._prefersReducedMotion(o)){const Qr=c.aH(o,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Qr,_)}this.stop(),o=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:c.eV},o);const rt=this.transform,ot=this.getZoom(),lt=this.getBearing(),ut=this.getPitch(),dt=this.getPadding(),mt="zoom"in o?c.aA(+o.zoom,rt.minZoom,rt.maxZoom):ot,Tt="bearing"in o?this._normalizeBearing(o.bearing,lt):lt,Ct="pitch"in o?+o.pitch:ut,Ut=this._extendPadding(o.padding),Bt=rt.zoomScale(mt-ot),$t=c.P.convert(o.offset);let Zt=rt.centerPoint.add($t);const qt=rt.pointLocation(Zt),sr=c.aT.convert(o.center||qt);this._normalizeCenter(sr);const ir=rt.project(qt),cr=rt.project(sr).sub(ir);let pr=o.curve;const ur=Math.max(rt.width,rt.height),Cr=ur/Bt,wr=cr.mag();if("minZoom"in o){const Qr=c.aA(Math.min(o.minZoom,ot,mt),rt.minZoom,rt.maxZoom),gs=ur/rt.zoomScale(Qr-ot);pr=Math.sqrt(gs/wr*2)}const Tr=pr*pr;function br(Qr){const gs=(Cr*Cr-ur*ur+(Qr?-1:1)*Tr*Tr*wr*wr)/(2*(Qr?Cr:ur)*Tr*wr);return Math.log(Math.sqrt(gs*gs+1)-gs)}function yr(Qr){return(Math.exp(Qr)-Math.exp(-Qr))/2}function Pr(Qr){return(Math.exp(Qr)+Math.exp(-Qr))/2}const Or=br(0);let Nr=function(Qr){return Pr(Or)/Pr(Or+pr*Qr)},ts=function(Qr){return ur*((Pr(Or)*(yr(gs=Or+pr*Qr)/Pr(gs))-yr(Or))/Tr)/wr;var gs},rs=(br(1)-Or)/pr;if(Math.abs(wr)<1e-6||!isFinite(rs)){if(Math.abs(ur-Cr)<1e-6)return this.easeTo(o,_);const Qr=Cr<ur?-1:1;rs=Math.abs(Math.log(Cr/ur))/pr,ts=function(){return 0},Nr=function(gs){return Math.exp(Qr*pr*gs)}}o.duration="duration"in o?+o.duration:1e3*rs/("screenSpeed"in o?+o.screenSpeed/pr:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const cs=lt!==Tt,Ss=Ct!==ut,Zr=!rt.isPaddingEqual(Ut),Fr=o.retainPadding===!1?rt.clone():rt,ns=Qr=>gs=>{const ks=gs*rs,Bs=1/Nr(ks);Qr.zoom=gs===1?mt:ot+Qr.scaleZoom(Bs),cs&&(Qr.bearing=c.ak(lt,Tt,gs)),Ss&&(Qr.pitch=c.ak(ut,Ct,gs)),Zr&&(Fr.interpolatePadding(dt,Ut,gs),Zt=Fr.centerPoint.add($t));const js=gs===1?sr:Qr.unproject(ir.add(cr.mult(ts(ks))).mult(Bs));return Qr.setLocationAtPoint(Qr.renderWorldCopies?js.wrap():js,Zt),Qr._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(_),Qr};if(o.preloadOnly){const Qr=this._emulate(ns,o.duration,rt);return this._preloadTiles(Qr),this}return this._zooming=!0,this._rotating=cs,this._pitching=Ss,this._padding=Zr,this._prepareEase(_,!1),this._ease(ns(rt),()=>this._afterEase(_),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(o){}_cancelRenderFrame(o){}_stop(o,_){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const rt=this._onEaseEnd;this._onEaseEnd=void 0,rt.call(this,_)}if(!o){const rt=this.handlers;rt&&rt.stop(!1)}return this}_ease(o,_,rt){rt.animate===!1||rt.duration===0?(o(1),_()):(this._easeStart=c.o.now(),this._easeOptions=rt,this._onEaseFrame=o,this._onEaseEnd=_,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((c.o.now()-this._easeStart)/this._easeOptions.duration,1),_=this._onEaseFrame;_&&_(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,_){o=c.bT(o,-180,180);const rt=Math.abs(o-_);return Math.abs(o-360-_)<rt&&(o-=360),Math.abs(o+360-_)<rt&&(o+=360),o}_normalizeCenter(o){const _=this.transform;if(_.maxBounds||_.projection.name!=="globe"&&!_.renderWorldCopies)return;const rt=o.lng-_.center.lng;o.lng+=rt>180?-360:rt<-180?360:0}_prefersReducedMotion(o){return this._respectPrefersReducedMotion&&c.o.prefersReducedMotion&&!(o&&o.essential)}_emulate(o,_,rt){const ot=Math.ceil(15*_/1e3),lt=[],ut=o(rt.clone());for(let dt=0;dt<=ot;dt++){const mt=ut(dt/ot);lt.push(mt.clone())}return lt}_preloadTiles(o,_){}}class $y{constructor(o={}){this.options=o,c.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const _=this.options&&this.options.compact,rt=o._getUIString("AttributionControl.ToggleAttribution");this._map=o,this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=zt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",rt);const ot=zt("span","mapboxgl-ctrl-icon",this._compactButton);return ot.setAttribute("aria-hidden","true"),ot.setAttribute("title",rt),this._innerContainer=zt("div","mapboxgl-ctrl-attrib-inner",this._container),_&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),_===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const _=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.e.ACCESS_TOKEN}];if(o){const rt=_.reduce((ot,lt,ut)=>(lt.value&&(ot+=`${lt.key}=${lt.value}${ut<_.length-1?"&":""}`),ot),"?");o.href=`${c.e.FEEDBACK_URL}/${rt}#${Zl(this._map,!0)}`,o.rel="noopener nofollow"}}_updateData(o){!o||(o.dataType!=="source"||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility")&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const ot=this._map.style.stylesheet;this.styleOwner=ot.owner,this.styleId=ot.id}const _=this._map.style._mergedSourceCaches;for(const ot in _){const lt=_[ot];if(lt.used){const ut=lt.getSource();ut.attribution&&o.indexOf(ut.attribution)<0&&o.push(ut.attribution)}}o.sort((ot,lt)=>ot.length-lt.length),o=o.filter((ot,lt)=>{for(let ut=lt+1;ut<o.length;ut++)if(o[ut].indexOf(ot)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const rt=o.map(ot=>function(lt){const ut=new DOMParser().parseFromString(lt,"text/html");return Array.from(ut.body.querySelectorAll("*")).forEach(dt=>{const mt=dt.textContent||"";if(dt.tagName!=="A")return void dt.replaceWith(ut.createTextNode(mt));const Tt=dt.getAttribute("href");if(!Tt||!/^(https?:|mailto:)/i.test(Tt))return void dt.replaceWith(ut.createTextNode(mt));const Ct=ut.createElement("a");Ct.href=Tt,Ct.textContent=mt,Ct.rel="noopener nofollow";const Ut=dt.getAttribute("class");Ut&&(Ct.className=Ut),dt.replaceWith(Ct)}),ut.body.innerHTML}(ot)).join(" | ");rt!==this._attribHTML&&(this._attribHTML=rt,o.length?(this._innerContainer.innerHTML=rt,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Gy{constructor(){c.aY(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=zt("div","mapboxgl-ctrl");const _=zt("a","mapboxgl-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://www.mapbox.com/",_.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),_.setAttribute("rel","noopener nofollow"),this._container.appendChild(_),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const _ in o){const rt=o[_].getSource();if(rt.hasOwnProperty("mapbox_logo")&&!rt.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const _=o[0];this._map.getCanvasContainer().offsetWidth<250?_.classList.add("mapboxgl-compact"):_.classList.remove("mapboxgl-compact")}}}class $x{constructor(){c.aY(["_onIndoorUpdate"],this)}onAdd(o){return this._map=o,this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",_=>this._onIndoorUpdate(_)),this._container}_createButton(o,_){const rt=zt("button",o,this._container);return rt.type="button",rt.addEventListener("click",_),rt}_createSeparator(){return zt("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(o,_){this._map&&(o.setAttribute("aria-label",_),o.textContent=_)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(o){if(!o||!o.floors)return this._model=o,void(this._container.style.display="none");const _=this._model;this._model=o,this._container.style.display="inline-block",this._container.style.borderRadius="8px",_&&Array.from(this._container.children).forEach(rt=>rt.remove()),o.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(o.floors,o.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const o=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const _=this._map;this._model&&_&&_._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});zt("span","mapboxgl-ctrl-icon",o).setAttribute("aria-hidden","true"),o.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&o.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(o),this._createSeparator()}_updateBuildingsButtonState(){const o=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");o&&this._model&&(this._model.activeFloorsVisible?o.classList.remove("mapboxgl-ctrl-level-button-selected"):o.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(o,_){for(let rt=0;rt<o.length;rt++){const ot=o[rt],lt=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(ot.id)});this._setButtonTitle(lt,ot.zIndex.toString()),this._model&&ot.id===this._model.selectedFloorId&&_&&lt.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(lt),rt<o.length-1&&this._createSeparator()}}}class lm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const _=++this._id;return this._queue.push({callback:o,id:_,cancelled:!1}),_}remove(o){const _=this._currentlyRunning,rt=_?this._queue.concat(_):this._queue;for(const ot of rt)if(ot.id===o)return void(ot.cancelled=!0)}run(o=0){const _=this._currentlyRunning=this._queue;this._queue=[];for(const rt of _)if(!rt.cancelled&&(rt.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class cm{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const _=c.dD((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-_)+this._end*_}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,_,rt){this._start=this.getValue(_),this._end=o,this._startTime=_,this._endTime=_+rt}}const um={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Bm extends c.z{constructor(o,_,rt,ot){const{point:lt,lngLat:ut,originalEvent:dt,target:mt}=o;super(o.type,{point:lt,lngLat:ut,originalEvent:dt,target:mt}),this.preventDefault=()=>{o.preventDefault()},this.id=_,this.interaction=rt,this.feature=ot}}class jp{constructor(o){this.map=o,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(o,_){if(this.typeById.has(o))throw new Error(`Interaction id "${o}" already exists.`);const rt=_.filter;let ot=_.type;rt&&this.filters.set(o,c.b6(rt)),ot==="mouseover"&&(ot="mouseenter"),ot==="mouseout"&&(ot="mouseleave");const lt=this.interactionsByType.get(ot)||new Map;ot==="mouseenter"||ot==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(o,_)):lt.size===0&&this.map.on(ot,this.handleType),lt.size===0&&this.interactionsByType.set(ot,lt),lt.set(o,_),this.typeById.set(o,ot)}get(o){const _=this.typeById.get(o);if(!_)return;const rt=this.interactionsByType.get(_);return rt?rt.get(o):void 0}remove(o){const _=this.typeById.get(o);if(!_)return;this.typeById.delete(o),this.filters.delete(o);const rt=this.interactionsByType.get(_);rt&&(rt.delete(o),_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.delete(o),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):rt.size===0&&this.map.off(_,this.handleType))}queryTargets(o,_){const rt=[];for(const[ot,lt]of _)lt.target&&rt.push({targetId:ot,target:lt.target,filter:this.filters.get(ot)});return this.map.style.queryRenderedTargets(o,rt,this.map.transform)}handleMove(o){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const _=this.queryTargets(o.point,Array.from(this.delegatedInteractions).reverse());_.length&&(o.type="mouseenter",this.handleType(o,_));const rt=new Map;for(const[ot,{feature:lt}]of this.prevHoveredFeatures)this.hoveredFeatures.has(ot)||rt.set(lt.id,lt);rt.size&&(o.type="mouseleave",this.handleType(o,Array.from(rt.values())))}handleOut(o){const _=Array.from(this.hoveredFeatures.values()).map(({feature:rt})=>rt);_.length&&(o.type="mouseleave",this.handleType(o,_)),this.hoveredFeatures.clear()}handleType(o,_){const rt=o.type==="mouseenter";if(rt&&!this.interactionsByType.has(o.type))return void c.w("mouseenter interaction required for mouseleave to work.");const ot=Array.from(this.interactionsByType.get(o.type)).reverse(),lt=!!_;_=_||this.queryTargets(o.point,ot);let ut=!1;const dt=new Set;for(const mt of _){for(const[Tt,Ct]of ot){if(!Ct.target)continue;const Ut=mt.variants?mt.variants[Tt]:null;if(Ut){for(const Bt of Ut){if(bx(Bt,mt,dt,Tt))continue;const $t=new c.dx(mt,Bt),Zt=Xm(Bt,mt,Tt);lt&&$t.id!==void 0&&($t.state=this.map.getFeatureState($t));const qt=rt?this.prevHoveredFeatures.get(Zt):null,sr=new Bm(o,Tt,Ct,$t),ir=qt?qt.stop:Ct.handler(sr);if(rt&&this.hoveredFeatures.set(Zt,{feature:mt,stop:ir}),ir!==!1){ut=!0;break}}if(ut)break}}if(ut)break}if(!ut)for(const[mt,Tt]of ot){const{handler:Ct,target:Ut}=Tt;if(!Ut&&Ct(new Bm(o,mt,Tt,null))!==!1)break}}}function T2(et,o){if(Array.isArray(et)&&Array.isArray(o)){const _=new Set(et),rt=new Set(o);return _.size===rt.size&&et.every(ot=>rt.has(ot))}return c.by(et,o)}const R2={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},C2={showCompass:!0,showZoom:!0,visualizePitch:!1};class A2{constructor(o,_,rt=!1){this._clickTolerance=10,this.element=_,this.mouseRotate=new e1({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,rt&&(this.mousePitch=new t1({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),c.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),_.addEventListener("mousedown",this.mousedown),_.addEventListener("touchstart",this.touchstart,{passive:!1}),_.addEventListener("touchmove",this.touchmove),_.addEventListener("touchend",this.touchend),_.addEventListener("touchcancel",this.reset)}down(o,_){this.mouseRotate.mousedown(o,_),this.mousePitch&&this.mousePitch.mousedown(o,_),Ht()}move(o,_){const rt=this.map,ot=this.mouseRotate.mousemoveWindow(o,_),lt=ot&&ot.bearingDelta;if(lt&&rt.setBearing(rt.getBearing()+lt),this.mousePitch){const ut=this.mousePitch.mousemoveWindow(o,_),dt=ut&&ut.pitchDelta;dt&&rt.setPitch(rt.getPitch()+dt)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(Object.assign({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),mr(this.element,o)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,mr(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Ur(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=Ur(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function n1(et,o,_){if(et=new c.aT(et.lng,et.lat),o){const rt=new c.aT(et.lng-360,et.lat),ot=new c.aT(et.lng+360,et.lat),lt=360*Math.ceil(Math.abs(et.lng-_.center.lng)/360),ut=_.locationPoint3D(et).distSqr(o),dt=o.x<0||o.y<0||o.x>_.width||o.y>_.height;_.locationPoint3D(rt).distSqr(o)<ut&&(dt||Math.abs(rt.lng-_.center.lng)<lt)?et=rt:_.locationPoint3D(ot).distSqr(o)<ut&&(dt||Math.abs(ot.lng-_.center.lng)<lt)&&(et=ot)}for(;Math.abs(et.lng-_.center.lng)>180;){const rt=_.locationPoint3D(et);if(rt.x>=0&&rt.y>=0&&rt.x<=_.width&&rt.y<=_.height)break;et.lng>_.center.lng?et.lng-=360:et.lng+=360}return et}const Eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},mp={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class T_ extends c.E{constructor(o,_){super(),(o instanceof HTMLElement||_)&&(o=Object.assign({element:o},_)),c.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:rt="center",color:ot="#3FB1CE",scale:lt=1,draggable:ut=!1,clickTolerance:dt=0,rotation:mt=mp.rotation,rotationAlignment:Tt=mp.rotationAlignment,pitchAlignment:Ct=mp.pitchAlignment,occludedOpacity:Ut=mp.occludedOpacity,altitude:Bt=mp.altitude}=o||{};this._anchor=rt,this._color=ot,this._scale=lt,this._draggable=ut,this._clickTolerance=dt,this._rotation=mt,this._rotationAlignment=Tt,this._pitchAlignment=Ct,this._occludedOpacity=Ut,this._altitude=Bt,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),o&&o.element?(this._element=o.element,this._offset=c.P.convert(o&&o.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=c.P.convert(o&&o.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",qt=>{qt.preventDefault()}),this._element.addEventListener("mousedown",qt=>{qt.preventDefault()});const $t=this._element.classList;for(const qt in Eu)$t.remove(`mapboxgl-marker-anchor-${qt}`);$t.add(`mapboxgl-marker-anchor-${this._anchor}`);const Zt=o&&o.className?o.className.trim().split(/\s+/):[];$t.add(...Zt),this._popup=null}_createDefaultMarker(){const o=zt("div"),_=Jt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},o);if(this._altitude===0){const rt=Jt("radialGradient",{id:"shadowGradient"},Jt("defs",{},_));Jt("stop",{offset:"10%","stop-opacity":.4},rt),Jt("stop",{offset:"100%","stop-opacity":.05},rt),Jt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},_)}return Jt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},_),Jt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},_),Jt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},_),o}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=c.aT.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(o){return o===this._altitude||(this._defaultMarker&&(this._altitude===0&&o!==0||this._altitude!==0&&o===0)&&(this._element=this._createDefaultMarker()),this._altitude=o||mp.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const ot=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ot,-1*(38.1-13.5+ot)],"bottom-right":[-ot,-1*(38.1-13.5+ot)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,o._marker=this,o._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const _=o.code,rt=o.charCode||o.keyCode;_!=="Space"&&_!=="Enter"&&rt!==32&&rt!==13||this.togglePopup()}_onMapClick(o){const _=o.originalEvent.target,rt=this._element;this._popup&&(_===rt||rt.contains(_))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const o=this._map,_=this._pos;if(!o||!_)return!1;const rt=o.unproject(_,this._altitude),ot=o.getFreeCameraOptions();if(!ot.position)return!1;const lt=ot.position.toLngLat();return lt.distanceTo(rt)<.9*lt.distanceTo(this._lngLat)}_evaluateOpacity(){const o=this._map;if(!o)return;const _=this._pos;if(!_||_.x<0||_.x>o.transform.width||_.y<0||_.y>o.transform.height)return void this._clearFadeTimer();const rt=o.unproject(_,this._altitude);let ot;o._showingGlobe()&&c.f5(o.transform,this._lngLat)?ot=0:(ot=1-o._queryFogOpacity(rt),o.transform._terrainEnabled()&&o.getTerrain()&&this._behindTerrain()&&(ot*=this._occludedOpacity)),this._element.style.opacity=`${ot}`,this._element.style.pointerEvents=ot>0?"auto":"none",this._popup&&this._popup._setOpacity(ot),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o||!this._map)return;const _=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${o.x}px,${o.y}px)
            ${Eu[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${_.x}px,${_.y}px)
        `}_calculateXYTransform(){const o=this._pos,_=this._map,rt=this.getPitchAlignment();if(!_||!o||rt!=="map")return"";if(!_._showingGlobe()){const mt=_.getPitch();return mt?`rotateX(${mt}deg)`:""}const ot=c.cX(c.f6(_.transform,this._lngLat)),lt=o.sub(c.f7(_.transform)),ut=Math.abs(lt.x)+Math.abs(lt.y);if(ut===0)return"";const dt=ot/ut;return`rotateX(${-lt.y*dt}deg) rotateY(${lt.x*dt}deg)`}_calculateZTransform(){const o=this._pos,_=this._map;if(!_||!o)return"";let rt=0;const ot=this.getRotationAlignment();if(ot==="map")if(_._showingGlobe()){const lt=_.project(new c.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),ut=_.project(new c.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(lt);rt=c.cX(Math.atan2(ut.y,ut.x))-90}else rt=-_.getBearing();else if(ot==="horizon"){const lt=c.ah(4,6,_.getZoom()),ut=c.f7(_.transform);ut.y+=lt*_.transform.height;const dt=o.sub(ut),mt=c.cX(Math.atan2(dt.y,dt.x));rt=(mt>90?mt-270:mt+90)*(1-lt)}return rt+=this._rotation,rt?`rotateZ(${rt}deg)`:""}_update(o){cancelAnimationFrame(this._updateFrameId);const _=this._map;_&&(_.transform.renderWorldCopies&&(this._lngLat=n1(this._lngLat,this._pos,_.transform)),this._pos=_.project(this._lngLat,this._altitude),o===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),_._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(_._showingGlobe()||_.getTerrain()||_.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=c.P.convert(o),this._update(),this}addClassName(o){return this._element.classList.add(o),this}removeClassName(o){return this._element.classList.remove(o),this}toggleClassName(o){return this._element.classList.toggle(o)}_onMove(o){const _=this._map;if(!_)return;const rt=this._pointerdownPos,ot=this._positionDelta;if(rt&&ot){if(!this._isDragging){const lt=this._clickTolerance||_._clickTolerance;if(o.point.dist(rt)<lt)return;this._isDragging=!0}this._pos=o.point.sub(ot),this._lngLat=_.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.z("dragstart"))),this.fire(new c.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new c.z("dragend")),this._state="inactive"}_addDragHandler(o){const _=this._map,rt=this._pos;_&&rt&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(rt),this._pointerdownPos=o.point,this._state="pending",_.on("mousemove",this._onMove),_.on("touchmove",this._onMove),_.once("mouseup",this._onUp),_.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const _=this._map;return _&&(o?(_.on("mousedown",this._addDragHandler),_.on("touchstart",this._addDragHandler)):(_.off("mousedown",this._addDragHandler),_.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||mp.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||mp.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o||mp.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(o){return this._occludedOpacity=o||mp.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const j2={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Gx={maxWidth:100,unit:"metric"},o1={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},gp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},xp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function fx(et=new c.P(0,0),o="bottom"){if(typeof et=="number"){const _=Math.round(Math.sqrt(.5*Math.pow(et,2)));switch(o){case"top":return new c.P(0,et);case"top-left":return new c.P(_,_);case"top-right":return new c.P(-_,_);case"bottom":return new c.P(0,-et);case"bottom-left":return new c.P(_,-_);case"bottom-right":return new c.P(-_,-_);case"left":return new c.P(et,0);case"right":return new c.P(-et,0)}return new c.P(0,0)}return et instanceof c.P||Array.isArray(et)?c.P.convert(et):c.P.convert(et[o]||[0,0])}return{version:pt,supported:Vt.supported,setRTLTextPlugin:c.fb,getRTLTextPluginStatus:c.fa,Map:class extends s1{constructor(et){St.mark(gt.create);const o=et;if((et=Object.assign({},R2,et)).minZoom!=null&&et.maxZoom!=null&&et.minZoom>et.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(et.minPitch!=null&&et.maxPitch!=null&&et.minPitch>et.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(et.minPitch!=null&&et.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(et.maxPitch!=null&&et.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(et.antialias&&c.f3(window)&&(et.antialias=!1,c.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new cv(et.minZoom,et.maxZoom,et.minPitch,et.maxPitch,et.renderWorldCopies,null,null),et),this._repaint=!!et.repaint,this._interactive=et.interactive,this._minTileCacheSize=et.minTileCacheSize,this._maxTileCacheSize=et.maxTileCacheSize,this._failIfMajorPerformanceCaveat=et.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=et.preserveDrawingBuffer,this._antialias=et.antialias,this._trackResize=et.trackResize,this._bearingSnap=et.bearingSnap,this._refreshExpiredTiles=et.refreshExpiredTiles,this._fadeDuration=et.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=et.crossSourceCollisions,this._collectResourceTiming=et.collectResourceTiming,this._language=this._parseLanguage(et.language),this._worldview=et.worldview,this._renderTaskQueue=new lm,this._domRenderTaskQueue=new lm,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.b2(),this._locale=Object.assign({},um,et.locale),this._clickTolerance=et.clickTolerance,this._cooperativeGestures=et.cooperativeGestures,this._performanceMetricsCollection=et.performanceMetricsCollection,this._tessellationStep=et.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=et.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cm(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=et.scaleFactor,this._requestManager=new Ms(et.transformRequest,et.accessToken,et.testMode),this._silenceAuthErrors=!!et.testMode,this._contextCreateOptions=et.contextCreateOptions?Object.assign({},et.contextCreateOptions):{},typeof et.container=="string"){const _=document.getElementById(et.container);if(!_)throw new Error(`Container '${et.container.toString()}' not found.`);this._container=_}else{if(!(et.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=et.container}if(this._container.childNodes.length>0&&c.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),et.maxBounds&&this.setMaxBounds(et.maxBounds),this._spriteFormat=et.spriteFormat,c.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new S2(this,et),this._localFontFamily=et.localFontFamily,this._localIdeographFontFamily=et.localIdeographFontFamily,(et.style||!et.testMode)&&this.setStyle(et.style||c.e.DEFAULT_STYLE,{config:et.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),et.projection&&this.setProjection(et.projection),et.hash&&(this._hash=new Wv(typeof et.hash=="string"&&et.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){o.center==null&&o.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:et.center,zoom:et.zoom,bearing:et.bearing,pitch:et.pitch});const _=et.bounds;_&&(this.resize(),this.fitBounds(_,Object.assign({},et.fitBoundsOptions,{duration:0})))}this.resize(),et.attributionControl&&this.addControl(new $y({customAttribution:et.customAttribution})),this._logoControl=new Gy,this.addControl(this._logoControl,et.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",_=>{this._update(_.dataType==="style"),this.fire(new c.z(`${_.dataType}data`,_))}),this.on("dataloading",_=>{this.fire(new c.z(`${_.dataType}dataloading`,_))}),this._interactions=new jp(this)}_getMapId(){return this._mapId}addControl(et,o){if(o===void 0&&(o=et.getDefaultPosition?et.getDefaultPosition():"top-right"),!et||!et.onAdd)return this.fire(new c.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const _=et.onAdd(this);this._controls.push(et);const rt=this._controlPositions[o];return o.indexOf("bottom")!==-1?rt.insertBefore(_,rt.firstChild):rt.appendChild(_),this}removeControl(et){if(!et||!et.onRemove)return this.fire(new c.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(et);return o>-1&&this._controls.splice(o,1),et.onRemove(this),this}hasControl(et){return this._controls.indexOf(et)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(et){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new c.z("movestart",et)).fire(new c.z("move",et)),this.fire(new c.z("resize",et)),o&&this.fire(new c.z("moveend",et)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(et){return this.transform.setMaxBounds(c.aI.convert(et)),this._update()}setMinZoom(et){if((et=et??-2)>=-2&&et<=this.transform.maxZoom)return this.transform.minZoom=et,this._update(),this.getZoom()<et?this.setZoom(et):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(et){if((et=et??22)>=this.transform.minZoom)return this.transform.maxZoom=et,this._update(),this.getZoom()>et?this.setZoom(et):this.fire(new c.z("zoomstart")).fire(new c.z("zoom")).fire(new c.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(et){if((et=et??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(et>=0&&et<=this.transform.maxPitch)return this.transform.minPitch=et,this._update(),this.getPitch()<et?this.setPitch(et):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(et){if((et=et??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(et>=this.transform.minPitch)return this.transform.maxPitch=et,this._update(),this.getPitch()>et?this.setPitch(et):this.fire(new c.z("pitchstart")).fire(new c.z("pitch")).fire(new c.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(et){return this._scaleFactor=et,this.painter.scaleFactor=et,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(o=>o.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(et){return this.transform.renderWorldCopies=et,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(et){return et==="auto"?navigator.language:Array.isArray(et)?et.length===0?void 0:et.map(o=>o==="auto"?navigator.language:o):et}setLanguage(et){const o=this._parseLanguage(et);if(!this.style||o===this._language)return this;this._language=o,this.style.reloadSources();for(const _ of this._controls)_._setLanguage&&_._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(et){return this.style&&et!==this._worldview?(this._worldview=et,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(et){return this._lazyInitEmptyStyle(),et?typeof et=="string"&&(et={name:et}):et=null,this._useExplicitProjection=!!et,this._prioritizeAndUpdateProjection(et,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const et=this.transform,o=et.projection.name;let _;o==="globe"&&et.zoom>=c.cL?(et.setMercatorFromTransition(),_=!0):o==="mercator"&&et.zoom<c.cL&&(et.setProjection({name:"globe"}),_=!0),_&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(et,o){return this._updateProjection(et||o||{name:"mercator"})}_updateProjection(et){let o;const _=this.transform.mercatorFromTransition;o=et.name==="globe"&&this.transform.zoom>=c.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(et),this.style.applyProjectionUpdate();const rt=this.transform.getProjection().name==="mercator"&&_!==this.transform.mercatorFromTransition;return(o||rt)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(et,o){return this.transform.locationPoint3D(c.aT.convert(et),o)}unproject(et,o){return this.transform.pointLocation3D(c.P.convert(et),o)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(et,o,_){const rt=ot=>{let lt=[];if(Array.isArray(o)){const ut=o.filter(dt=>this.getLayer(dt));lt=ut.length?this.queryRenderedFeatures(ot,{layers:ut}):[]}else lt=this.queryRenderedFeatures(ot,{target:o});return lt};if(et==="mouseenter"||et==="mouseover"){let ot=!1;return{listener:_,targets:o,delegates:{mousemove:ut=>{const dt=rt(ut.point);dt.length?ot||(ot=!0,_.call(this,new Hu(et,this,ut.originalEvent,{features:dt}))):ot=!1},mouseout:()=>{ot=!1}}}}if(et==="mouseleave"||et==="mouseout"){let ot=!1;return{listener:_,targets:o,delegates:{mousemove:dt=>{rt(dt.point).length?ot=!0:ot&&(ot=!1,_.call(this,new Hu(et,this,dt.originalEvent)))},mouseout:dt=>{ot&&(ot=!1,_.call(this,new Hu(et,this,dt.originalEvent)))}}}}{const ot=lt=>{const ut=rt(lt.point);ut.length&&(lt.features=ut,_.call(this,lt),delete lt.features)};return{listener:_,targets:o,delegates:{[et]:ot}}}}on(et,o,_){if(typeof o=="function"||_===void 0)return super.on(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const rt=this._createDelegatedListener(et,o,_);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[et]=this._delegatedListeners[et]||[],this._delegatedListeners[et].push(rt);for(const ot in rt.delegates)this.on(ot,rt.delegates[ot]);return this}once(et,o,_){if(typeof o=="function"||_===void 0)return super.once(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const rt=this._createDelegatedListener(et,o,_);for(const ot in rt.delegates)this.once(ot,rt.delegates[ot]);return this}off(et,o,_){if(typeof o=="function"||_===void 0)return super.off(et,o);if(typeof o=="string"&&(o=[o]),!this._areTargetsValid(o))return this;const rt=this._delegatedListeners?this._delegatedListeners[et]:void 0;return rt&&(ot=>{for(let lt=0;lt<ot.length;lt++){const ut=ot[lt];if(ut.listener===_&&T2(ut.targets,o)){for(const dt in ut.delegates)this.off(dt,ut.delegates[dt]);return ot.splice(lt,1),this}}})(rt),this}queryRenderedFeatures(et,o){if(!this.style)return[];if(et===void 0||et instanceof c.P||Array.isArray(et)||o!==void 0||(o=et,et=void 0),et=et||[[0,0],[this.transform.width,this.transform.height]],!o){const lt=this.style.queryRenderedFeatures(et,void 0,this.transform),ut=this.style.queryRenderedFeatureset(et,void 0,this.transform);return lt.concat(ut)}let _=!0;if(o.target&&(_=this._isTargetValid(o.target),_&&!o.layers))return this.style.queryRenderedFeatureset(et,o,this.transform);let rt=!0;if(o.layers&&Array.isArray(o.layers)){for(const lt of o.layers)if(!this._isValidId(lt)){rt=!1;break}if(rt&&!o.target)return this.style.queryRenderedFeatures(et,o,this.transform)}let ot=[];return rt&&(ot=ot.concat(this.style.queryRenderedFeatures(et,o,this.transform))),_&&(ot=ot.concat(this.style.queryRenderedFeatureset(et,o,this.transform))),ot}querySourceFeatures(et,o){return!et||typeof et=="string"&&!this._isValidId(et)?[]:this.style.querySourceFeatures(et,o)}queryRasterValue(et,o,_){return this._isValidId(et)?this.style.queryRasterValue(et,o,_):Promise.resolve(null)}isPointOnSurface(et){const{name:o}=this.transform.projection;return o!=="globe"&&o!=="mercator"&&c.w(`${o} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.P.convert(et))}addInteraction(et,o){return this._interactions.add(et,o),this}removeInteraction(et){return this._interactions.remove(et),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(et){return this._cooperativeGestures=et,this}setStyle(et,o){return o=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o),this.style&&et&&o.diff!==!1&&o.localFontFamily===this._localFontFamily&&o.localIdeographFontFamily===this._localIdeographFontFamily&&!o.config?(this.style._diffStyle(et,(_,rt)=>{if(_){const ot=typeof _=="string"?_:_ instanceof Error?_.message:_.error;c.w(`Unable to perform style diff: ${ot}. Rebuilding the style from scratch.`),this._updateStyle(et,o)}else rt&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(et,o))}_getUIString(et){const o=this._locale[et];if(o==null)throw new Error(`Missing UI string '${et}'`);return o}_updateStyle(et,o){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),et){const _=Object.assign({},o);o&&o.config&&(_.initialConfig=o.config,delete _.config),this.style=new pp(this,_).load(et),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new pp(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.w("There is no style added to the map."),!1)}_isValidId(et){return et==null?(this.fire(new c.y(new Error("IDs can't be empty."))),!1):!c.dr(et)||(this.fire(new c.y(new Error(`IDs can't contain special symbols: "${et}".`))),!1)}_isTargetValid(et){return"featuresetId"in et?this._isValidId("importId"in et?et.importId:et.featuresetId):"layerId"in et&&this._isValidId(et.layerId)}_areTargetsValid(et){if(Array.isArray(et)){for(const o of et)if(!this._isValidId(o))return!1;return!0}return this._isTargetValid(et)}addSource(et,o){return this._isValidId(et)?(this._lazyInitEmptyStyle(),this.style.addSource(et,o),this._update(!0)):this}isSourceLoaded(et){return!!this._isValidId(et)&&!!this.style&&this.style._isSourceCacheLoaded(et)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(et,o,_){this._lazyInitEmptyStyle(),this.style.addSourceType(et,o,_)}removeSource(et){return this._isValidId(et)?(this.style.removeSource(et),this._updateTerrain(),this._update(!0)):this}getSource(et){return this._isValidId(et)?this.style.getOwnSource(et):null}addImage(et,o,{pixelRatio:_=1,sdf:rt=!1,stretchX:ot,stretchY:lt,content:ut}={}){this._lazyInitEmptyStyle();const dt=c.I.from(et);if(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap){const{width:mt,height:Tt,data:Ct}=c.o.getImageData(o);this.style.addImage(dt,{data:new c.q({width:mt,height:Tt},Ct),pixelRatio:_,stretchX:ot,stretchY:lt,content:ut,sdf:rt,version:0,usvg:!1})}else if(o.width===void 0||o.height===void 0)this.fire(new c.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:mt,height:Tt}=o,Ct=o;this.style.addImage(dt,{data:new c.q({width:mt,height:Tt},new Uint8Array(Ct.data)),pixelRatio:_,stretchX:ot,stretchY:lt,content:ut,sdf:rt,usvg:!1,version:0,userImage:Ct}),Ct.onAdd&&Ct.onAdd(this,et)}}updateImage(et,o){this._lazyInitEmptyStyle();const _=c.I.from(et),rt=this.style.getImage(_);if(!rt)return void this.fire(new c.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const ot=o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap?c.o.getImageData(o):o,{width:lt,height:ut,data:dt}=ot;if(lt===void 0||ut===void 0)return void this.fire(new c.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(lt!==(rt.usvg?rt.icon.usvg_tree.width:rt.data.width)||ut!==(rt.usvg?rt.icon.usvg_tree.height:rt.data.height))return void this.fire(new c.y(new Error(`The width and height of the updated image (${lt}, ${ut})
                must be that same as the previous version of the image
                (${rt.data.width}, ${rt.data.height})`)));const mt=!(o instanceof HTMLImageElement||ImageBitmap&&o instanceof ImageBitmap);let Tt=!1;rt.usvg?(rt.data=new c.q({width:lt,height:ut},new Uint8Array(dt)),rt.usvg=!1,rt.icon=void 0,Tt=!0):rt.data.replace(dt,mt),this.style.updateImage(_,rt,Tt)}hasImage(et){return et?!!this.style&&!!this.style.getImage(c.I.from(et)):(this.fire(new c.y(new Error("Missing required image id"))),!1)}removeImage(et){this.style.removeImage(c.I.from(et))}loadImage(et,o){c.n(this._requestManager.transformRequest(et,c.R.Image),(_,rt)=>{o(_,rt instanceof HTMLImageElement?c.o.getImageData(rt):rt)})}listImages(){return this.style.listImages().map(et=>et.name)}addModel(et,o){this._lazyInitEmptyStyle(),this.style.addModel(et,o)}hasModel(et){return et?this.style.hasModel(et):(this.fire(new c.y(new Error("Missing required model id"))),!1)}removeModel(et){this.style.removeModel(et)}listModels(){return this.style.listModels()}addLayer(et,o){return this._isValidId(et.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(et,o),this._update(!0)):this}getSlot(et){const o=this.getLayer(et);return o&&o.slot||null}setSlot(et,o){return this.style.setSlot(et,o),this.style.mergeLayers(),this._update(!0)}addImport(et,o){return this.style.addImport(et,o).catch(_=>this.fire(new c.y(new Error("Failed to add import",_)))),this}updateImport(et,o){return typeof o!="string"&&o.id!==et?(this.removeImport(et),this.addImport(o)):(this.style.updateImport(et,o),this._update(!0))}removeImport(et){return this.style.removeImport(et),this}moveImport(et,o){return this.style.moveImport(et,o),this._update(!0)}moveLayer(et,o){return this._isValidId(et)?(this.style.moveLayer(et,o),this._update(!0)):this}removeLayer(et){return this._isValidId(et)?(this.style.removeLayer(et),this._update(!0)):this}getLayer(et){if(!this._isValidId(et))return null;const o=this.style.getOwnLayer(et);return o?o.type==="custom"?o.implementation:o.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(et,o,_){return this._isValidId(et)?(this.style.setLayerZoomRange(et,o,_),this._update(!0)):this}setFilter(et,o,_={}){return this._isValidId(et)?(this.style.setFilter(et,o,_),this._update(!0)):this}getFilter(et){return this._isValidId(et)?this.style.getFilter(et):null}setPaintProperty(et,o,_,rt={}){return this._isValidId(et)?(this.style.setPaintProperty(et,o,_,rt),this._update(!0)):this}getPaintProperty(et,o){return this._isValidId(et)?this.style.getPaintProperty(et,o):null}setLayoutProperty(et,o,_,rt={}){return this._isValidId(et)?(this.style.setLayoutProperty(et,o,_,rt),this._update(!0)):this}getLayoutProperty(et,o){return this._isValidId(et)?this.style.getLayoutProperty(et,o):null}setLayerProperty(et,o,_,rt={}){return this._isValidId(et)?(o==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(et,o,_,rt),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(et){return this.style.setGlyphsUrl(et),this._update(!0)}getSchema(et){return this.style.getSchema(et)}setSchema(et,o){return this.style.setSchema(et,o),this._update(!0)}getConfig(et){return this.style.getConfig(et)}setConfig(et,o){return this.style.setConfig(et,o),this._update(!0)}getConfigProperty(et,o){return this.style.getConfigProperty(et,o)}setConfigProperty(et,o,_){return this.style.setConfigProperty(et,o,_),this._update(!0)}getFeaturesetDescriptors(et){return this.style.getFeaturesetDescriptors(et)}setLights(et){if(this._lazyInitEmptyStyle(),et&&et.length===1&&et[0].type==="flat"){const o=et[0];o.properties?this.style.setFlatLight(o.properties,o.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(et),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const et=this.style.getLights()||[];return et.length===0&&et.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),et}setLight(et,o={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:et}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(et){return this._lazyInitEmptyStyle(),!et&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(et),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(et){return this._lazyInitEmptyStyle(),this.style.setFog(et),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(et){return this._lazyInitEmptyStyle(),this.style.setSnow(et),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(et){return this._lazyInitEmptyStyle(),this.style.setRain(et),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(et){return this._lazyInitEmptyStyle(),this.style.setColorTheme(et),this._update(!0)}setImportColorTheme(et,o){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(et,o),this._update(!0)}setCamera(et){return this.style.setCamera(et),this._triggerCameraUpdate(et)}_triggerCameraUpdate(et){return this._update(this.transform.setOrthographicProjectionAtLowPitch(et["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(et){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.aT.convert(et),this.transform):0}setFeatureState(et,o){return et.source&&!this._isValidId(et.source)?this:(this.style.setFeatureState(et,o),this._update())}removeFeatureState(et,o){return et.source&&!this._isValidId(et.source)?this:(this.style.removeFeatureState(et,o),this._update())}getFeatureState(et){return et.source&&!this._isValidId(et.source)?null:this.style.getFeatureState(et)}_selectIndoorFloor(et){this.indoor.selectFloor(et)}_setIndoorActiveFloorsVisibility(et){this.indoor.setActiveFloorsVisibility(et)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new $x),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const et=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let _,rt,ot,lt=this._container;for(;lt&&(!rt||!ot);){const ut=window.getComputedStyle(lt).transform;ut&&ut!=="none"&&(_=ut.match(/matrix.*\((.+)\)/)[1].split(", "),_[0]&&_[0]!=="0"&&_[0]!=="1"&&(rt=_[0]),_[3]&&_[3]!=="0"&&_[3]!=="1"&&(ot=_[3])),lt=lt.parentElement}this._containerWidth=rt?Math.abs(et/rt):et,this._containerHeight=ot?Math.abs(o/ot):o}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&c.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new lw(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const et=this._container;et.classList.add("mapboxgl-map"),(this._missingCSSCanary=zt("div","mapboxgl-canary",et)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=zt("div","mapboxgl-canvas-container",et);this._canvas=zt("canvas","mapboxgl-canvas",o),this._interactive&&(o.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const _=this._controlContainer=zt("div","mapboxgl-control-container",et),rt=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(ot=>{rt[ot]=zt("div",`mapboxgl-ctrl-${ot}`,_)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(et,o){const _=c.o.devicePixelRatio||1;this._canvas.width=_*Math.ceil(et),this._canvas.height=_*Math.ceil(o),this._canvas.style.width=`${et}px`,this._canvas.style.height=`${o}px`}_addMarker(et){this._markers.push(et)}_removeMarker(et){const o=this._markers.indexOf(et);o!==-1&&this._markers.splice(o,1)}_addPopup(et){this._popups.push(et)}_removePopup(et){const o=this._popups.indexOf(et);o!==-1&&this._popups.splice(o,1)}_setupPainter(){const et=Object.assign({},Vt.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",et);o?(Bn(o,!0),this.painter=new h_(o,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),c.k.testSupport(o)):this.fire(new c.y(new Error("Failed to initialize WebGL")))}_contextLost(et){et.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.z("webglcontextlost",{originalEvent:et}))}_contextRestored(et){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new c.z("webglcontextrestored",{originalEvent:et}))}_onMapScroll(et){if(et.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(et){return this.style?(this._styleDirty=this._styleDirty||et,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(et){return this._update(),this._renderTaskQueue.add(et)}_cancelRenderFrame(et){this._renderTaskQueue.remove(et)}_requestDomTask(et){!this.loaded()||this.loaded()&&!this.isMoving()?et():this._domRenderTaskQueue.add(et)}_render(et){let o;this.fire(new c.z("renderstart")),++this._frameId;const _=this.painter.context.extTimerQuery,rt=c.o.now(),ot=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(o=ot.createQuery(),ot.beginQuery(_.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(et),this._domRenderTaskQueue.run(et),this._removed)return;this._updateProjectionTransition();const lt=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const Tt=this.transform.zoom,Ct=this.transform.pitch,Ut=c.o.now(),Bt=new c.ac(Tt,{now:Ut,fadeDuration:lt,pitch:Ct,transition:this.style.transition,worldview:this._worldview});this.style.update(Bt)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let ut=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),ut=this._updateAverageElevation(rt),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):ut=this._updateAverageElevation(rt);const dt=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,lt,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),dt&&(this._placementDirty=dt.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:lt,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,St.mark(gt.load),this.fire(new c.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),o){const Tt=c.o.now()-rt;ot.endQuery(_.TIME_ELAPSED_EXT),setTimeout(()=>{const Ct=ot.getQueryParameter(o,ot.QUERY_RESULT)/1e6;ot.deleteQuery(o),this.fire(new c.z("gpu-timing-frame",{cpuTime:Tt,gpuTime:Ct}))},50)}if(this.listens("gpu-timing-layer")){const Tt=this.painter.collectGpuTimers();setTimeout(()=>{const Ct=this.painter.queryGpuTimers(Tt);this.fire(new c.z("gpu-timing-layer",{layerTimes:Ct}))},50)}if(this.listens("gpu-timing-deferred-render")){const Tt=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const Ct=this.painter.queryGpuTimeDeferredRender(Tt);this.fire(new c.z("gpu-timing-deferred-render",{gpuTime:Ct}))},50)}const mt=this._sourcesDirty||this._styleDirty||this._placementDirty||ut;if(mt||this._repaint)this.triggerRepaint();else{const Tt=this.idle();if(Tt&&(ut=this._updateAverageElevation(rt,!0)),ut)this.triggerRepaint();else if(this._triggerFrame(!1),Tt&&(this.fire(new c.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const Ct=this._calculateSpeedIndex();this.fire(new c.z("speedindexcompleted",{speedIndex:Ct})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||mt||(this._fullyLoaded=!0,St.mark(gt.fullLoad),this._performanceMetricsCollection&&Os(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(et){for(const o of this._markers)et&&!this.getRenderWorldCopies()&&(o._lngLat=o._lngLat.wrap()),o._update();for(const o of this._popups)!et||this.getRenderWorldCopies()||o._trackPointer||(o._lngLat=o._lngLat.wrap()),o._update()}_updateAverageElevation(et,o=!1){const _=ot=>(this.transform.averageElevation=ot,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&_(0);const rt=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(rt||(o||et-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(et)){const ot=this.transform.averageElevation;let lt=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(lt)?lt=0:this._averageElevationLastSampledAt=et;const ut=Math.abs(ot-lt);if(ut>1){if(this._isInitialLoad||rt)return this._averageElevation.jumpTo(lt),_(lt);this._averageElevation.easeTo(lt,et,300)}else if(ut>1e-4)return this._averageElevation.jumpTo(lt),_(lt)}return!!this._averageElevation.isEasing(et)&&_(this._averageElevation.getValue(et))}_authenticate(){Nn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,et=>{if(et&&(et.message===ms||et.status===401)){const o=this.painter.context.gl;Bn(o,!1),this._logoControl instanceof Gy&&this._logoControl._updateLogo(),o&&o.clear(o.DEPTH_BUFFER_BIT|o.COLOR_BUFFER_BIT|o.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Vs(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&_n(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Cn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){qr(this._requestManager._customAccessToken)}_updateTerrain(){const et=this._isDragging();this.painter.updateTerrain(this.style,et)}_calculateSpeedIndex(){const et=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const _=this.painter.context.gl,rt=_.createFramebuffer();function ot(lt){_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_2D,lt,0);const ut=new Uint8Array(_.drawingBufferWidth*_.drawingBufferHeight*4);return _.readPixels(0,0,_.drawingBufferWidth,_.drawingBufferHeight,_.RGBA,_.UNSIGNED_BYTE,ut),ut}return _.bindFramebuffer(_.FRAMEBUFFER,rt),this._canvasPixelComparison(ot(et),o.canvasCopies.map(ot),o.timeStamps)}_canvasPixelComparison(et,o,_){let rt=_[1]-_[0];const ot=et.length/4;for(let lt=0;lt<o.length;lt++){const ut=o[lt];let dt=0;for(let mt=0;mt<ut.length;mt+=4)ut[mt]===et[mt]&&ut[mt+1]===et[mt+1]&&ut[mt+2]===et[mt+2]&&ut[mt+3]===et[mt+3]&&(dt+=1);rt+=(_[lt+2]-_[lt+1])*(1-dt/ot)}return rt}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const et=this.painter.context.gl.getExtension("WEBGL_lose_context");et&&et.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),cn.delete(this.painter.context.gl),Us.remove(),Wr.remove(),this._removed=!0,this.fire(new c.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(et){this._renderNextFrame=this._renderNextFrame||et,this.style&&!this._frame&&(this._frame=c.o.frame(o=>{const _=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,_&&this._render(o)}))}_preloadTiles(et){const o=this.style?this.style.getSourceCaches():[];return c.bw(o,(_,rt)=>_._preloadTiles(et,rt),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(et){this._trackResize&&this.resize({originalEvent:et})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(et){this._showTileBoundaries!==et&&(this._showTileBoundaries=et,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(et){this._showParseStatus!==et&&(this._showParseStatus=et,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(et){this._showTerrainWireframe!==et&&(this._showTerrainWireframe=et,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(et){this._showLayers2DWireframe!==et&&(this._showLayers2DWireframe=et,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(et){this._showLayers3DWireframe!==et&&(this._showLayers3DWireframe=et,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(et){this._speedIndexTiming!==et&&(this._speedIndexTiming=et,this._update())}get showPadding(){return!!this._showPadding}set showPadding(et){this._showPadding!==et&&(this._showPadding=et,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(et){this._showCollisionBoxes!==et&&(this._showCollisionBoxes=et,this.style&&et?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(et){this._showOverdrawInspector!==et&&(this._showOverdrawInspector=et,this._update())}get repaint(){return!!this._repaint}set repaint(et){this._repaint!==et&&(this._repaint=et,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(et){this._vertices=et,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(et){this._showTileAABBs!==et&&(this._showTileAABBs=et,et&&this._update())}_setCacheLimits(et,o){c.f4(et,o)}get version(){return pt}},NavigationControl:class{constructor(et={}){this.options=Object.assign({},C2,et),this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(c.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),zt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),zt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const _=this._map;_&&(this.options.visualizePitch?_.resetNorthPitch({},{originalEvent:o}):_.resetNorth({},{originalEvent:o}))}),this._compassIcon=zt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const et=this._map;if(!et)return;const o=et.getZoom(),_=o===et.getMaxZoom(),rt=o===et.getMinZoom();this._zoomInButton.disabled=_,this._zoomOutButton.disabled=rt,this._zoomInButton.setAttribute("aria-disabled",_.toString()),this._zoomOutButton.setAttribute("aria-disabled",rt.toString())}_rotateCompassArrow(){const et=this._map;if(!et)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(et.transform.pitch*(Math.PI/180)),.5)}) rotateX(${et.transform.pitch}deg) rotateZ(${et.transform.angle*(180/Math.PI)}deg)`:`rotate(${et.transform.angle*(180/Math.PI)}deg)`;et._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(et){return this._map=et,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),et.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&et.on("pitch",this._rotateCompassArrow),et.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new A2(et,this._compass,this.options.visualizePitch)),this._container}onRemove(){const et=this._map;et&&(this._container.remove(),this.options.showZoom&&et.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&et.off("pitch",this._rotateCompassArrow),et.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(et,o){const _=zt("button",et,this._container);return _.type="button",_.addEventListener("click",o),_}_setButtonTitle(et,o){if(!this._map)return;const _=this._map._getUIString(`NavigationControl.${o}`);et.setAttribute("aria-label",_),et.firstElementChild&&et.firstElementChild.setAttribute("title",_)}},GeolocateControl:class extends c.E{constructor(et={}){super();const o=navigator.geolocation;this.options=Object.assign({geolocation:o},j2,et),c.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=d_(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(et){return this._map=et,this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(et){const o=(_=!!this.options.geolocation)=>{this._supportsGeolocation=_,et(_)};this._supportsGeolocation!==void 0?et(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(_=>o(_.state!=="denied")).catch(()=>o()):o()}_isOutOfMapMaxBounds(et){const o=this._map.getMaxBounds(),_=et.coords;return!!o&&(_.longitude<o.getWest()||_.longitude>o.getEast()||_.latitude<o.getSouth()||_.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(et){if(this._map){if(this._isOutOfMapMaxBounds(et))return this._setErrorState(),this.fire(new c.z("outofmaxbounds",et)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=et,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(et),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(et),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("geolocate",Object.assign({coords:et.coords,timestamp:et.timestamp},et.toJSON?{toJSON:et.toJSON.bind(et)}:{}))),this._finish()}}_updateCamera(et){const o=new c.aT(et.coords.longitude,et.coords.latitude),_=et.coords.accuracy,rt=this._map.getBearing(),ot=Object.assign({bearing:rt},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(_),ot,{geolocateSource:!0})}_updateMarker(et){if(et){const o=new c.aT(et.coords.longitude,et.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=et.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const et=this._map.transform,o=c.cf(1,et._center.lat)*et.worldSize,_=Math.ceil(2*this._accuracy*o);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(et){if(this._map){if(this.options.trackUserLocation)if(et.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(et.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new c.z("error",et)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(et){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=zt("button","mapboxgl-ctrl-geolocate",this._container),zt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",et===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=zt("div","mapboxgl-user-location"),this._dotElement.appendChild(zt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(zt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new T_({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=zt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new T_({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.z("trackuserlocationend")))})}}_onDeviceOrientation(et){this._userLocationDotMarker&&(et.webkitCompassHeading?this._heading=et.webkitCompassHeading:et.absolute===!0&&(this._heading=-1*et.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let et;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(et={maximumAge:6e5,timeout:0},this._noTimeout=!0):(et=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,et),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const et=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&et()}).catch(console.error):et()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:$y,ScaleControl:class{constructor(et={}){this.options=Object.assign({},Gx,et),c.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const et=this.options.maxWidth||100,o=this._map,_=o._containerHeight/2,rt=o._containerWidth/2-et/2,ot=o.unproject([rt,_]),lt=o.unproject([rt+et,_]),ut=ot.distanceTo(lt);if(this.options.unit==="imperial"){const dt=3.2808*ut;dt>5280?this._setScale(et,dt/5280,"mile"):this._setScale(et,dt,"foot")}else this.options.unit==="nautical"?this._setScale(et,ut/1852,"nautical-mile"):ut>=1e3?this._setScale(et,ut/1e3,"kilometer"):this._setScale(et,ut,"meter")}_setScale(et,o,_){this._map._requestDomTask(()=>{const rt=function(lt){const ut=Math.pow(10,`${Math.floor(lt)}`.length-1);let dt=lt/ut;return dt=dt>=10?10:dt>=5?5:dt>=3?3:dt>=2?2:dt>=1?1:function(mt){const Tt=Math.pow(10,Math.ceil(-Math.log(mt)/Math.LN10));return Math.round(mt*Tt)/Tt}(dt),ut*dt}(o),ot=rt/o;this._container.innerHTML=_!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:_}).format(rt):`${rt}&nbsp;${o1[_]}`,this._container.style.width=et*ot+"px"})}onAdd(et){return this._map=et,this._language=et.getLanguage(),this._container=zt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",et.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(et){this._language=et,this._update()}setUnit(et){this.options.unit=et,this._update()}},FullscreenControl:class{constructor(et={}){this._fullscreen=!1,et&&et.container&&(et.container instanceof HTMLElement?this._container=et.container:c.w("Full screen control 'container' must be a DOM element.")),c.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(et){return this._map=et,this._container||(this._container=this._map.getContainer()),this._controlContainer=zt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const et=this._fullscreenButton=zt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);zt("span","mapboxgl-ctrl-icon",et).setAttribute("aria-hidden","true"),et.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const et=this._getTitle();this._fullscreenButton.setAttribute("aria-label",et),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",et)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:$x,Popup:class extends c.E{constructor(et){super(),this.options=Object.assign(Object.create(gp),et),this._altitude=this.options.altitude,c.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(et&&et.className?et.className.trim().split(/\s+/):[])}addTo(et){return this._map&&this.remove(),this._map=et,this.options.closeOnClick&&et.on("preclick",this._onClose),this.options.closeOnMove&&et.on("move",this._onClose),et.on("remove",this.remove),this._update(),et._addPopup(this),this._focusFirstElement(),this._trackPointer?(et.on("mousemove",this._onMouseEvent),et.on("mouseup",this._onMouseEvent),et._canvasContainer.classList.add("mapboxgl-track-pointer")):et.on("move",this._update),this.fire(new c.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const et=this._map;return et&&(et.off("move",this._update),et.off("move",this._onClose),et.off("preclick",this._onClose),et.off("click",this._onClose),et.off("remove",this.remove),et.off("mousemove",this._onMouseEvent),et.off("mouseup",this._onMouseEvent),et.off("drag",this._onMouseEvent),et._canvasContainer&&et._canvasContainer.classList.remove("mapboxgl-track-pointer"),et._removePopup(this),this._map=void 0),this.fire(new c.z("close")),this}getLngLat(){return this._lngLat}setLngLat(et){this._lngLat=c.aT.convert(et),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(et){return this._altitude=et,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const et=this._map;return et&&(et.off("move",this._update),et.on("mousemove",this._onMouseEvent),et.on("drag",this._onMouseEvent),et._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(et){return this.setDOMContent(document.createTextNode(et))}setHTML(et){const o=document.createDocumentFragment(),_=document.createElement("body");let rt;for(_.innerHTML=et;rt=_.firstChild,rt;)o.appendChild(rt);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(et){return this.options.maxWidth=et,this._update(),this}setDOMContent(et){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=zt("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(et),this.options.closeButton){const _=this._closeButton=zt("button","mapboxgl-popup-close-button",o);_.type="button",_.setAttribute("aria-label","Close popup"),_.innerHTML='<span aria-hidden="true">&#215;</span>',_.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(et){return this._classList.add(et),this._updateClassList(),this}removeClassName(et){return this._classList.delete(et),this._updateClassList(),this}setOffset(et){return this.options.offset=et,this._update(),this}toggleClassName(et){let o;return this._classList.delete(et)?o=!1:(this._classList.add(et),o=!0),this._updateClassList(),o}_onMouseEvent(et){this._update(et.point)}_getAnchor(et){if(this.options.anchor)return this.options.anchor;const o=this._map,_=this._container,rt=this._pos;if(!o||!_||!rt)return"bottom";const ot=_.offsetWidth,lt=_.offsetHeight,ut=rt.x<ot/2,dt=rt.x>o.transform.width-ot/2;if(rt.y+et<lt)return ut?"top-left":dt?"top-right":"top";if(rt.y>o.transform.height-lt){if(ut)return"bottom-left";if(dt)return"bottom-right"}return ut?"left":dt?"right":"bottom"}_updateClassList(){const et=this._container;if(!et)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),et.className=o.join(" ")}_update(et){const o=this._map,_=this._content;if(!o||!this._lngLat&&!this._trackPointer||!_)return;let rt=this._container;if(rt||(rt=this._container=zt("div","mapboxgl-popup",o.getContainer()),this._tip=zt("div","mapboxgl-popup-tip",rt),rt.appendChild(_)),this.options.maxWidth&&rt.style.maxWidth!==this.options.maxWidth&&(rt.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=n1(this._lngLat,this._pos,o.transform)),!this._trackPointer||et){const ot=this._pos=this._trackPointer&&et instanceof c.P?et:o.project(this._lngLat,this._altitude),lt=fx(this.options.offset),ut=this._anchor=this._getAnchor(lt.y),dt=fx(this.options.offset,ut),mt=ot.add(dt).round();o._requestDomTask(()=>{this._container&&ut&&(this._container.style.transform=`${Eu[ut]} translate(${mt.x}px,${mt.y}px)`)})}if(!this._marker&&o._showingGlobe()){const ot=c.f5(o.transform,this._lngLat)?0:1;this._setOpacity(ot)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const et=this._container.querySelector(xp);et&&et.focus()}_onClose(){this.remove()}_setOpacity(et){this._container&&(this._container.style.opacity=`${et}`),this._content&&(this._content.style.pointerEvents=et?"auto":"none")}},Marker:T_,Style:pp,LngLat:c.aT,LngLatBounds:c.aI,Point:c.P,MercatorCoordinate:c.ae,FreeCameraOptions:ku,Evented:c.E,config:c.e,prewarm:c.f9,clearPrewarmedResources:c.f8,get accessToken(){return c.e.ACCESS_TOKEN},set accessToken(et){c.e.ACCESS_TOKEN=et},get baseApiUrl(){return c.e.API_URL},set baseApiUrl(et){c.e.API_URL=et},get workerCount(){return c.fi.workerCount},set workerCount(et){c.fi.workerCount=et},get maxParallelImageRequests(){return c.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(et){c.e.MAX_PARALLEL_IMAGE_REQUESTS=et},clearStorage(et){c.fh(et)},get workerUrl(){return c.fg.workerUrl},set workerUrl(et){c.fg.workerUrl=et},get workerClass(){return c.fg.workerClass},set workerClass(et){c.fg.workerClass=et},get workerParams(){return c.fg.workerParams},set workerParams(et){c.fg.workerParams=et},get dracoUrl(){return c.ff()},set dracoUrl(et){c.fe(et)},get meshoptUrl(){return c.fd()},set meshoptUrl(et){c.fc(et)},setNow:c.o.setNow,restoreNow:c.o.restoreNow}});var ct=_e;return ct})})(mapboxGl);var mapboxGlExports=mapboxGl.exports;const mapboxgl=getDefaultExportFromCjs(mapboxGlExports),injectAnimations=()=>{if(typeof document<"u"&&!document.getElementById("mapbox-animations")){const e=document.createElement("style");e.id="mapbox-animations",e.textContent=`
      @keyframes pulse-ring {
        0% { transform: scale(1); opacity: 0.7; }
        50% { transform: scale(1.3); opacity: 0.3; }
        100% { transform: scale(1.6); opacity: 0; }
      }
      
      @keyframes pulse-danger {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
      }
      
      @keyframes bounce-click {
        0% { transform: scale(1); }
        30% { transform: scale(0.9); }
        60% { transform: scale(1.1); }
        100% { transform: scale(1); }
      }
      
      .station-marker {
        will-change: transform;
      }
    `,document.head.appendChild(e)}};injectAnimations();mapboxgl.accessToken="pk.your_mapbox_access_token_here";const MapboxMap=({stations:e,userLocation:i,onStationSelect:d,selectedOrder:j,isUK:_e=!1,fuelType:nt="regular"})=>{const ct=reactExports.useRef(null),c=reactExports.useRef(null),pt=reactExports.useRef([]),gt=reactExports.useRef(null),St=reactExports.useRef(null);reactExports.useEffect(()=>{typeof window<"u"&&(window.selectStation=er=>{const dr=e.find(mr=>mr.id===er);dr&&d(dr)})},[e,d]);const kt=reactExports.useRef(null),[At,Nt]=reactExports.useState(0),Vt=reactExports.useRef(null),zt=reactExports.useRef([]);reactExports.useEffect(()=>{if(!(!ct.current||!i))return c.current=new mapboxgl.Map({container:ct.current,style:"mapbox://styles/mapbox/streets-v12",center:[i.lon,i.lat],zoom:12,attributionControl:!1}),c.current.addControl(new mapboxgl.NavigationControl,"top-right"),Jt(_e),()=>{if(c.current){try{c.current.remove()}catch(er){console.error("Error removing map:",er)}c.current=null}tr()}},[i]),reactExports.useEffect(()=>{var ms,Ms;if(!c.current||!i)return;pt.current.forEach(Kr=>Kr.remove()),pt.current=[];const er=document.createElement("div");er.className="user-marker",er.innerHTML=`
      <div style="
        width: 30px;
        height: 30px;
        position: relative;
      ">
        <img 
          src="/pinpoint.png" 
          alt="Your Location" 
          style="
            width: 100%;
            height: 100%;
            object-fit: contain;
          "
        />
      </div>
      <div style="
        position: absolute;
        top: 35px;
        left: 50%;
        transform: translateX(-50%);
        background: white;
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 600;
        color: #3F4249;
        white-space: nowrap;
        box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.1);
      ">Me</div>
    `;const dr=new mapboxgl.Marker(er).setLngLat([i.lon,i.lat]).addTo(c.current);pt.current.push(dr);const mr=e.map(Kr=>{var xr,jr;return((xr=Kr.fuelPrices)==null?void 0:xr[nt])||((jr=Kr.fuelPrices)==null?void 0:jr.regular)||0}).filter(Kr=>Kr>0),Ur=Math.min(...mr),Dr=Math.max(...mr),Yr=mr.reduce((Kr,xr)=>Kr+xr,0)/mr.length;e.forEach(Kr=>{var xr,jr,rr,ar,$r;if(Kr.lat&&Kr.lon){const Ar={hasStore:Kr.hasStore??Math.random()>.3,hasRestroom:Kr.hasRestroom??Math.random()>.2,hasATM:Kr.hasATM??Math.random()>.5,occupancy_level:Kr.occupancy_level||(Math.random()>.6?"High":Math.random()>.3?"Medium":"Low"),updatedAt:Kr.updatedAt||new Date(Date.now()-Math.random()*36e5*24).toISOString()},Xr=((xr=Kr.fuelPrices)==null?void 0:xr[nt])||((jr=Kr.fuelPrices)==null?void 0:jr.regular)||0;let us="#FFA500";Xr<=Ur+(Yr-Ur)*.3?us="#3AC36C":Xr>=Dr-(Dr-Yr)*.3?us="#FF6B6B":us="#FFA500";const Wr="28px",Vs=document.createElement("div");Vs.className="station-marker",Vs.innerHTML=`
          <div style="
            width: ${Wr};
            height: ${Wr};
            background: ${us};
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: center;
          ">
             <!-- Interactive inner elements -->
             <div style="
                position: relative;
                width: 100%;
                height: 100%;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
             ">
                <!-- Central price indicator -->
                <div style="
                  font-size: 8px;
                  font-weight: bold;
                  color: white;
                  text-shadow: 0 1px 2px rgba(0,0,0,0.5);
                ">$${Xr.toFixed(1)}</div>
                
                <!-- Animated pulse ring -->
                <div style="
                  position: absolute;
                  width: 100%;
                  height: 100%;
                  border: 2px solid ${us};
                  border-radius: 50%;
                  animation: pulse-ring 2s infinite;
                  opacity: 0.7;
                "></div>
             </div>
             
             <!-- Occupancy indicator with animation -->
             <div style="
                position: absolute;
                top: -2px;
                right: -2px;
                width: 12px;
                height: 12px;
                background: ${Ar.occupancy_level==="High"?"#FF5252":Ar.occupancy_level==="Medium"?"#FFA000":"#4CAF50"};
                border: 2px solid white;
                border-radius: 50%;
                box-shadow: 0 2px 4px rgba(0,0,0,0.3);
                animation: ${Ar.occupancy_level==="High"?"pulse-danger":"none"} 1.5s infinite;
             "></div>
             
             <!-- Amenities quick view -->
             <div style="
                position: absolute;
                bottom: -8px;
                left: 50%;
                transform: translateX(-50%);
                display: flex;
                gap: 2px;
                background: rgba(255,255,255,0.9);
                padding: 1px 3px;
                border-radius: 6px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.2);
             ">
                ${Ar.hasStore?'<div style="width: 8px; height: 8px; background: #4CAF50; border-radius: 50%;" title="Store"></div>':""}
                ${Ar.hasRestroom?'<div style="width: 8px; height: 8px; background: #2196F3; border-radius: 50%;" title="Restroom"></div>':""}
                ${Ar.hasATM?'<div style="width: 8px; height: 8px; background: #FF9800; border-radius: 50%;" title="ATM"></div>':""}
             </div>
          </div>
          
          <!-- Enhanced Price Badge with trend indicator -->
          <div style="
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, white 0%, #f8f9fa 100%);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            color: #3F4249;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 2px solid ${us};
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 4px;
          ">
            <span>$${Xr.toFixed(2)}</span>
            <!-- Trend indicator -->
            <span style="
              font-size: 10px;
              color: ${Xr<=Yr?"#4CAF50":"#FF5722"};
            ">${Xr<=Yr?"":""}</span>
          </div>
        `,Vs.addEventListener("mouseenter",()=>{Vs.style.transform="scale(1.25) translateY(-5px)",Vs.style.zIndex="100";const qr=Vs.querySelector("div");qr&&(qr.style.boxShadow=`0 0 20px ${us}, 0 8px 16px rgba(0,0,0,0.4)`);const Zs=Vs.querySelector("div:nth-child(2) > div:last-child");Zs&&(Zs.style.transform="translateX(-50%) scale(1.1)",Zs.style.opacity="1")}),Vs.addEventListener("mouseleave",()=>{Vs.style.transform="scale(1) translateY(0)",Vs.style.zIndex="auto";const qr=Vs.querySelector("div");qr&&(qr.style.boxShadow="0 4px 12px rgba(0,0,0,0.3)");const Zs=Vs.querySelector("div:nth-child(2) > div:last-child");Zs&&(Zs.style.transform="translateX(-50%) scale(1)",Zs.style.opacity="0.9")}),Vs.addEventListener("click",qr=>{qr.stopPropagation(),Vs.style.animation="bounce-click 0.4s ease",setTimeout(()=>{Vs.style.animation=""},400),d(Kr)});const yn=Math.floor((Date.now()-new Date(Ar.updatedAt).getTime())/6e4),_n=yn<60?`${yn}m ago`:`${Math.floor(yn/60)}h ago`,zo=`
            <div style="padding: 8px; min-width: 160px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                    <span style="font-weight: bold; font-size: 14px; color: #2c3e50;">${Kr.name}</span>
                    <span style="
                        font-size: 11px; 
                        padding: 2px 6px; 
                        border-radius: 12px;
                        background: ${Ar.occupancy_level==="High"?"#FFEBEE":Ar.occupancy_level==="Medium"?"#FFF3E0":"#E8F5E9"};
                        color: ${Ar.occupancy_level==="High"?"#D32F2F":Ar.occupancy_level==="Medium"?"#EF6C00":"#2E7D32"};
                        font-weight: 600;
                        display: flex;
                        align-items: center;
                        gap: 4px;
                    ">
                        <span style="width: 8px; height: 8px; background: currentColor; border-radius: 50%;"></span>
                        ${Ar.occupancy_level} Traffic
                    </span>
                </div>
                
                <!-- Fuel Prices Section -->
                <div style="margin-bottom: 10px; padding: 8px; background: #f8f9fa; border-radius: 6px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 4px;">Fuel Prices:</div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                      ${(rr=Kr.fuelPrices)!=null&&rr.regular?`<div style="font-size: 11px; padding: 2px 6px; background: #e3f2fd; border-radius: 4px;">
                        Regular: <strong>$${Kr.fuelPrices.regular.toFixed(2)}</strong>
                      </div>`:""}
                      ${(ar=Kr.fuelPrices)!=null&&ar.premium?`<div style="font-size: 11px; padding: 2px 6px; background: #f3e5f5; border-radius: 4px;">
                        Premium: <strong>$${Kr.fuelPrices.premium.toFixed(2)}</strong>
                      </div>`:""}
                      ${($r=Kr.fuelPrices)!=null&&$r.diesel?`<div style="font-size: 11px; padding: 2px 6px; background: #e8f5e9; border-radius: 4px;">
                        Diesel: <strong>$${Kr.fuelPrices.diesel.toFixed(2)}</strong>
                      </div>`:""}
                    </div>
                </div>
                
                <!-- Amenities Section -->
                <div style="margin-bottom: 8px;">
                    <div style="font-size: 12px; color: #666; margin-bottom: 6px; display: flex; align-items: center; gap: 6px;">
                      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="#666" stroke-width="2">
                        <circle cx="12" cy="10" r="3"/><path d="M12 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><path d="M20 21v-2a4 4 0 0 0-4-4h-2a4 4 0 0 0-4 4v2"/>
                      </svg>
                      Available Amenities:
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                         ${Ar.hasStore?`<span style="font-size: 11px; padding: 3px 8px; background: #4CAF50; color: white; border-radius: 12px; display: flex; align-items: center; gap: 4px;">
                           <svg width="12" height="12" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2"/><rect x="9" y="9" width="6" height="6"/></svg>
                           Store
                         </span>`:""}
                         ${Ar.hasRestroom?`<span style="font-size: 11px; padding: 3px 8px; background: #2196F3; color: white; border-radius: 12px; display: flex; align-items: center; gap: 4px;">
                           <svg width="12" height="12" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M6 20v-8h12v8"/></svg>
                           Restroom
                         </span>`:""}
                         ${Ar.hasATM?`<span style="font-size: 11px; padding: 3px 8px; background: #FF9800; color: white; border-radius: 12px; display: flex; align-items: center; gap: 4px;">
                           <svg width="12" height="12" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><rect x="2" y="5" width="20" height="14" rx="2"/><line x1="2" y1="10" x2="22" y2="10"/></svg>
                           ATM
                         </span>`:""}
                    </div>
                </div>

                <div style="font-size: 11px; color: #888; border-top: 1px solid #eee; padding-top: 6px; display: flex; justify-content: space-between; align-items: center;">
                    <span>Last updated: ${_n}</span>
                    <button onclick="window.selectStation('${Kr.id}')" style="
                      background: #3AC36C; 
                      color: white; 
                      border: none; 
                      padding: 4px 8px; 
                      border-radius: 4px; 
                      font-size: 11px; 
                      cursor: pointer;
                      font-weight: 500;
                    ">View Details</button>
                </div>
            </div>
        `,Cn=new mapboxgl.Popup({offset:25,closeButton:!1}).setHTML(zo),On=new mapboxgl.Marker({element:Vs,anchor:"center"}).setLngLat([Kr.lon,Kr.lat]).setPopup(Cn).addTo(c.current);Vs.addEventListener("mouseenter",()=>Cn.addTo(c.current)),Vs.addEventListener("mouseleave",()=>Cn.remove()),pt.current.push(On)}});const es=()=>{!c.current||!c.current.getStyle()||e.forEach((Kr,xr)=>{if(Kr.lat&&Kr.lon&&i&&c.current){const jr=`line-${Kr.id}`,rr=`line-source-${Kr.id}`;c.current.getSource(rr)||c.current.addSource(rr,{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[i.lon,i.lat],[Kr.lon,Kr.lat]]}}}),c.current.getLayer(jr)||c.current.addLayer({id:jr,type:"line",source:rr,paint:{"line-color":"#3AC36C","line-width":2,"line-opacity":.7,"line-dasharray":[2,2]}})}})};if(c.current.isStyleLoaded()?es():c.current.on("style.load",es),j&&i){console.log(" Starting car animation");const Kr=[i.lon,i.lat];let xr=[i.lon+.01,i.lat+.01];(ms=j.station)!=null&&ms.lon&&((Ms=j.station)!=null&&Ms.lat)?xr=[j.station.lon,j.station.lat]:e.length>0&&(xr=[e[0].lon,e[0].lat]);const jr=[Kr,[(Kr[0]+xr[0])/2,(Kr[1]+xr[1])/2],xr];St.current||(console.log(" Creating car element"),St.current=document.createElement("div"),St.current.className="car-marker",St.current.innerHTML=`
          <div style="
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s ease-out;
          ">
            <img 
              src="/car.png" 
              alt="Moving Car" 
              style="
                width: 100%;
                height: 100%;
                object-fit: contain;
                transform: rotate(0deg);
              "
              onload="console.log(' Car image loaded successfully')"
              onerror="console.error(' Failed to load car image')"
            />
          </div>
        `),gt.current?gt.current.setLngLat(Kr):gt.current=new mapboxgl.Marker(St.current).setLngLat(Kr).addTo(c.current);let rr=0;const ar=500,$r=()=>{if(!gt.current||!St.current)return;const Ar=jr[Math.floor(rr)%jr.length],Xr=jr[(Math.floor(rr)+1)%jr.length],us=Ar[0]+(Xr[0]-Ar[0])*(rr%1),Wr=Ar[1]+(Xr[1]-Ar[1])*(rr%1);if(gt.current.setLngLat([us,Wr]),Ar&&Xr){const Vs=Xr[0]-Ar[0],yn=Xr[1]-Ar[1],_n=Math.atan2(Vs,yn)*(180/Math.PI),zo=St.current.querySelector("img");zo&&(zo.style.transform=`rotate(${_n}deg)`)}c.current&&c.current.setCenter([us,Wr]),rr+=.01,rr<ar&&(kt.current=requestAnimationFrame($r))};kt.current=requestAnimationFrame($r)}return()=>{if(kt.current&&cancelAnimationFrame(kt.current),gt.current&&(gt.current.remove(),gt.current=null),e.forEach(Kr=>{const xr=`line-${Kr.id}`,jr=`line-source-${Kr.id}`;if(c.current)try{c.current.getStyle()&&c.current.getLayer(xr)&&c.current.removeLayer(xr),c.current.getStyle()&&c.current.getSource(jr)&&c.current.removeSource(jr)}catch(rr){console.warn("Mapbox cleanup error (ignored):",rr)}}),c.current)try{c.current.off("style.load",es)}catch{}pt.current.forEach(Kr=>Kr.remove()),pt.current=[]}},[e,i,d,j,nt]);const Jt=er=>{if(!c.current)return;tr();const dr=document.createElement("canvas");dr.width=800,dr.height=600;const mr=dr.getContext("2d");mr&&(er?Dt(mr,dr.width,dr.height):It(mr,dr.width,dr.height),Vt.current=new mapboxgl.Marker({element:dr,anchor:"center"}).setLngLat([i.lon,i.lat]).addTo(c.current)),Ht(er)},Dt=(er,dr,mr)=>{er.globalAlpha=.4,er.fillStyle="#f8f9fa",Mt(er,50,30,180,60,"#ffffff"),Mt(er,300,80,200,70,"#f0f0f0"),Mt(er,150,150,150,50,"#fafafa"),Mt(er,450,120,170,55,"#f5f5f5"),er.globalAlpha=.2,er.fillStyle="#e6f3ff";for(let Ur=0;Ur<80;Ur++){const Dr=Math.random()*dr,Yr=Math.random()*mr,es=1+Math.random()*3;er.beginPath(),er.arc(Dr,Yr,es,0,Math.PI*2),er.fill()}},It=(er,dr,mr)=>{er.globalAlpha=.35,er.fillStyle="#ffffff",Mt(er,20,20,120,45,"#ffffff"),Mt(er,200,40,130,50,"#f8f8f8"),Mt(er,350,100,100,40,"#f0f0f0"),Mt(er,100,180,140,55,"#f5f5f5"),Mt(er,500,60,110,42,"#fafafa"),er.globalAlpha=.25;const Ur=er.createRadialGradient(dr/2,mr/2,0,dr/2,mr/2,100);Ur.addColorStop(0,"#fff9c4"),Ur.addColorStop(1,"transparent"),er.fillStyle=Ur,er.beginPath(),er.arc(dr/2,mr/2,100,0,Math.PI*2),er.fill()},Mt=(er,dr,mr,Ur,Dr,Yr)=>{er.fillStyle=Yr,er.beginPath(),er.ellipse(dr+Ur/4,mr+Dr/2,Ur/4,Dr/2,0,0,Math.PI*2),er.ellipse(dr+Ur/2,mr+Dr/3,Ur/3,Dr/2.5,0,0,Math.PI*2),er.ellipse(dr+Ur*.75,mr+Dr/2,Ur/5,Dr/3,0,0,Math.PI*2),er.fill(),er.globalAlpha=.7,er.fillStyle="#e0e0e0";for(let es=0;es<5;es++){const ms=dr+20+Math.random()*(Ur-40),Ms=mr+10+Math.random()*(Dr-20),Kr=5+Math.random()*10;er.beginPath(),er.arc(ms,Ms,Kr,0,Math.PI*2),er.fill()}er.globalAlpha=.35},Ht=er=>{if(!c.current)return;const dr=er?50:35;for(let mr=0;mr<dr;mr++)setTimeout(()=>{if(!c.current)return;const Ur=document.createElement("div"),Dr=er&&Math.random()>.3,Yr=Dr?3+Math.random()*5:4+Math.random()*8;if(Ur.style.cssText=`
          width: ${Yr}px;
          height: ${Yr}px;
          background: ${Dr?"#e6f3ff":"#fff9c4"};
          border-radius: ${Dr?"50%":"30%"};
          opacity: ${.4+Math.random()*.4};
          box-shadow: 0 0 ${Dr?"8px":"12px"} ${Dr?"#cce6ff":"#fff066"};
          animation: float-${er?"snow":"sun"} ${er?6+Math.random()*4:4+Math.random()*3}s linear infinite;
          filter: ${Dr?"blur(0.5px)":"blur(1px)"};
        `,!document.getElementById("realistic-weather-animation")){const Kr=document.createElement("style");Kr.id="realistic-weather-animation",Kr.textContent=`
            @keyframes float-snow {
              0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
              10% { opacity: 0.7; }
              90% { opacity: 0.7; }
              100% { transform: translateY(-150px) translateX(${20-Math.random()*40}px) rotate(${Math.random()*360}deg); opacity: 0; }
            }
            @keyframes float-sun {
              0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 0; }
              10% { opacity: 0.6; }
              90% { opacity: 0.6; }
              100% { transform: translateY(-120px) translateX(${15-Math.random()*30}px) rotate(${Math.random()*180}deg); opacity: 0; }
            }
          `,document.head.appendChild(Kr)}const es=(Math.random()-.5)*.03,ms=(Math.random()-.5)*.03,Ms=new mapboxgl.Marker({element:Ur,anchor:"center"}).setLngLat([i.lon+ms,i.lat+es]).addTo(c.current);zt.current.push(Ms)},mr*200)},tr=()=>{Vt.current&&(Vt.current.remove(),Vt.current=null),zt.current.forEach(er=>er.remove()),zt.current=[]};return jsxRuntimeExports.jsx("div",{ref:ct,className:"w-full h-full",style:{minHeight:"420px"}})},StationCard=({station:e,index:i})=>{var _e,nt,ct;const d=useNavigate(),j=i%2===0?"/image-card-1.png":"/image-card-2.png";return jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-gray-800 dark:border-gray-700 rounded-2xl shadow-xl border border-gray-100 p-0 flex flex-col sm:flex-row hover:shadow-2xl transition-all duration-300 hover:-translate-y-1",children:[jsxRuntimeExports.jsx("div",{className:"w-full sm:w-[118px] h-[200px] sm:h-[183px] p-2 relative",children:jsxRuntimeExports.jsx("img",{src:e.imageUrl||e.image||j,alt:e.name,className:"w-full sm:w-[102px] h-full sm:h-[164px] object-cover rounded-lg shadow-md",onError:c=>{c.currentTarget.src=j}})}),jsxRuntimeExports.jsx("div",{className:"flex-1 p-2",children:jsxRuntimeExports.jsxs("div",{className:"p-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-base font-bold text-[#3F4249] dark:text-white mb-3",children:e.name}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Fuel,{size:20,className:"text-[#3AC36C]"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-[#3F4249] dark:text-gray-300",children:"Fuel Price"})]}),jsxRuntimeExports.jsxs("span",{className:"text-sm sm:text-base font-bold text-[#3F4249] dark:text-gray-200",children:["$",((_e=e.fuelPrices)==null?void 0:_e.regular)||((nt=e.fuelPrices)==null?void 0:nt.premium)||((ct=e.fuelPrices)==null?void 0:ct.diesel)||"N/A"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(MapPin,{size:20,className:"text-[#FF5630]"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-[#3F4249] dark:text-gray-300 flex-1 truncate",children:[e.address||"Address not available","  ",e.distance||"Distance N/A"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx("div",{className:"w-5 h-5 rounded-full bg-yellow-100 dark:bg-yellow-900 flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"})}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-medium text-[#3F4249] dark:text-gray-300 flex-1",children:["Average Delivery: ",e.averageDeliveryTime||30," minutes"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Star,{size:20,className:"text-[#FFC107] fill-current"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-bold text-[#3F4249] dark:text-gray-300",children:[e.rating||"N/A"," Rating"]}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-[#3AC36C]",children:["(",e.reviewCount||e.totalReviews||0," reviews)"]})]})]}),jsxRuntimeExports.jsx(TouchFeedback,{onPress:()=>d(`/station/${e.id}`,{state:{station:e}}),className:"mt-4 block",children:jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",className:"w-full py-3 px-4 text-sm font-bold shadow-lg hover:shadow-xl rounded-full",children:"Select Station"})})]})})]})},HomeScreen=()=>{const{user:e,logout:i}=useAppContext(),[d,j]=reactExports.useState([]),[_e,nt]=reactExports.useState([]),[ct,c]=reactExports.useState(!0),[pt,gt]=reactExports.useState(""),[St,kt]=reactExports.useState(null),[At,Nt]=reactExports.useState(""),[Vt,zt]=reactExports.useState(!1),[Jt,Dt]=reactExports.useState(!1),[It,Mt]=reactExports.useState({fuelType:"",priceRange:"",distance:"",rating:""}),[Ht,tr]=reactExports.useState(!1),[er,dr]=reactExports.useState(null),[mr,Ur]=reactExports.useState(!1),[Dr,Yr]=reactExports.useState(""),[es,ms]=reactExports.useState([]),[Ms,Kr]=reactExports.useState(!1),xr=useNavigate();reactExports.useEffect(()=>{(async()=>{if(!localStorage.getItem("token")){xr("/login");return}try{await apiGetMe()}catch(Os){console.error("Token validation failed:",Os),i(),xr("/login")}})()},[xr,i]);const jr=qr=>qr?qr.lat>49&&qr.lat<60&&qr.lon>-10&&qr.lon<2:!1,rr=qr=>{dr(qr),localStorage.setItem("userLocationPreference",qr),kt(qr==="UK"?{lat:51.5074,lon:-.1278}:{lat:40.7128,lon:-74.006});const Zs=ar(qr);Yr(Zs),Ur(!0),setTimeout(()=>{Ur(!1)},3e3)},ar=qr=>{const Zs=new Date,Os=qr==="UK"?"Europe/London":"America/New_York",Us=new Intl.DateTimeFormat("en-US",{timeZone:Os,hour:"numeric",hour12:!1}).format(Zs),Nn=parseInt(Us);return Nn>=5&&Nn<12?"Good morning":Nn>=12&&Nn<17?"Good afternoon":Nn>=17&&Nn<21?"Good evening":"Good night"};reactExports.useEffect(()=>{const qr=localStorage.getItem("userLocationPreference");tr(!0),qr&&(dr(qr),kt(qr==="UK"?{lat:51.5074,lon:-.1278}:{lat:40.7128,lon:-74.006}))},[]);const $r=()=>{if(er){const qr=ar(er);Yr(qr),Ur(!0),setTimeout(()=>{Ur(!1)},3e3),tr(!1)}},Ar=()=>{rr("UK"),tr(!1)},Xr=()=>{rr("US"),tr(!1)},us=()=>{if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){alert("Voice search not supported in this browser");return}const qr=window.webkitSpeechRecognition||window.SpeechRecognition,Zs=new qr;Zs.continuous=!1,Zs.interimResults=!1,Zs.lang="en-US",zt(!0),Zs.onresult=Os=>{const Us=Os.results[0][0].transcript;Nt(Us),zt(!1)},Zs.onerror=()=>{zt(!1),alert("Voice search failed. Please try again.")},Zs.onend=()=>{zt(!1)},Zs.start()},Wr=(qr,Zs=It)=>{let Os=[..._e];if(qr.trim()&&(Os=Os.filter(Us=>Us.name.toLowerCase().includes(qr.toLowerCase())||Us.address&&Us.address.toLowerCase().includes(qr.toLowerCase()))),Zs.fuelType&&(Os=Os.filter(Us=>!0)),Zs.priceRange&&(Os=Os.filter(Us=>{const Nn=Us.regularPrice||0;switch(Zs.priceRange){case"low":return Nn<30;case"medium":return Nn>=30&&Nn<40;case"high":return Nn>=40;default:return!0}})),Zs.distance&&(Os=Os.filter(Us=>!0)),Zs.rating){const Us=parseFloat(Zs.rating);Os=Os.filter(Nn=>(Nn.rating||0)>=Us)}j(Os)},Vs=(qr,Zs)=>{const Os={...It,[qr]:Zs};Mt(Os),Wr(At,Os)},yn=()=>{const qr={fuelType:"",priceRange:"",distance:"",rating:""};Mt(qr),Wr(At,qr)},_n=()=>{const qr=er==="UK"||jr(St),Zs=["Shell","Exxon Mobil","Chevron","BP","Marathon","Speedway","7-Eleven","Circle K","Sunoco","Valero","Phillips 66","Sinclair","Gulf","Wawa","Sheetz","Buc-ee's","Casey's","QuikTrip","Costco Gasoline","Kum & Go","Love's Travel Stops","Pilot Flying J"],Os=["BP","Shell","Esso","Texaco","Jet","Tesco","Sainsbury's","Asda","Morrisons","Applegreen","Murco","Gulf (UK)","Harvest Energy","Gleaner","Moto","Welcome Break","Roadchef"],Us=[{id:"grocery-uk-1",name:"Bottled Water",price:1.2,description:"Pure mineral water"},{id:"grocery-uk-2",name:"Energy Drink",price:2.5,description:"Red Bull energy boost"},{id:"grocery-uk-3",name:"Crisps",price:1.5,description:"Walkers salted crisps"},{id:"grocery-uk-4",name:"Tea",price:2,description:"PG Tips tea bags"},{id:"grocery-uk-5",name:"Chocolate Bar",price:1,description:"Cadbury Dairy Milk"},{id:"grocery-uk-6",name:"Sandwich",price:3.5,description:"Prawn mayo sandwich"},{id:"grocery-uk-7",name:"Soft Drink",price:1.8,description:"Coca Cola 500ml"},{id:"grocery-uk-8",name:"Biscuits",price:1.2,description:"Digestive biscuits"},{id:"grocery-uk-9",name:"Juice",price:2.2,description:"Orange juice 1L"},{id:"grocery-uk-10",name:"Mints",price:.8,description:"Extra strong mints"}],Nn=[{id:"grocery-us-1",name:"Bottled Water",price:2.5,description:"Pure drinking water"},{id:"grocery-us-2",name:"Energy Drink",price:3.99,description:"Monster energy boost"},{id:"grocery-us-3",name:"Potato Chips",price:2.99,description:"Lays classic chips"},{id:"grocery-us-4",name:"Coffee",price:5.99,description:"Starbucks coffee"},{id:"grocery-us-5",name:"Sandwich",price:7.99,description:"Turkey club sandwich"},{id:"grocery-us-6",name:"Chocolate Bar",price:2.99,description:"Hershey chocolate"},{id:"grocery-us-7",name:"Soda",price:2.49,description:"Coca Cola 2L"},{id:"grocery-us-8",name:"Donut",price:3.49,description:"Glazed donut"},{id:"grocery-us-9",name:"Gatorade",price:4.99,description:"Sports drink"},{id:"grocery-us-10",name:"Protein Bar",price:6.99,description:"High protein bar"},{id:"grocery-us-11",name:"Ice Cream",price:4.99,description:"Vanilla ice cream"},{id:"grocery-us-12",name:"Energy Bar",price:3.99,description:"Cliff energy bar"}],cn=[{id:"friend-uk-1",name:"James Mitchell",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:4.99,phone:"+447712345678"},{id:"friend-uk-2",name:"Emma Thompson",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:5.49,phone:"+447712345679"},{id:"friend-uk-3",name:"Michael Davies",rating:4.7,reviewCount:142,avatarUrl:"/fuel friend.png",location:"0.8 miles away",rate:4.49,phone:"+447712345680"},{id:"friend-uk-4",name:"Sarah Williams",rating:5,reviewCount:189,avatarUrl:"/fuel friend.png",location:"0.6 miles away",rate:6.99,phone:"+447712345681"}],Bn=[{id:"friend-us-1",name:"David Johnson",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:5.99,phone:"+12125551234"},{id:"friend-us-2",name:"Jennifer Smith",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:6.99,phone:"+12125551235"},{id:"friend-us-3",name:"Robert Wilson",rating:4.7,reviewCount:142,avatarUrl:"/fuel friend.png",location:"0.8 miles away",rate:5.49,phone:"+12125551236"},{id:"friend-us-4",name:"Maria Garcia",rating:5,reviewCount:189,avatarUrl:"/fuel friend.png",location:"0.6 miles away",rate:7.99,phone:"+12125551237"}],Pn=qr?Os:Zs,Zn=qr?["Oxford Street, London W1D 1BS","Regent Street, London W1B 4HY","High Holborn, London WC1V 7RA","Tottenham Court Road, London W1T 2BF","Bond Street, London W1S 1AS","Covent Garden, London WC2E 8RF"]:["Times Square, New York, NY 10036","Broadway, New York, NY 10036","5th Avenue, New York, NY 10001","Madison Avenue, New York, NY 10016","Park Avenue, New York, NY 10016","Lexington Avenue, New York, NY 10016"];return Pn.slice(0,6).map((Qo,Wo)=>{const uo=qr?"Petrol Station":"Gas Station",eo=qr?1.3+Math.random()*.3:3+Math.random()*1,to=qr?1.5+Math.random()*.3:3.5+Math.random()*1,Io=qr?1.4+Math.random()*.3:3.2+Math.random()*1;return{id:`station-${qr?"uk":"us"}-${Wo}-${Date.now()}`,name:`${Qo} ${uo}`,address:Zn[Wo]||(qr?"London, UK":"New York, NY"),distance:`${(.3+Math.random()*.7).toFixed(1)} miles`,deliveryTime:`${Math.floor(10+Math.random()*15)} mins`,rating:parseFloat((4+Math.random()*1).toFixed(1)),reviewCount:Math.floor(50+Math.random()*200),imageUrl:Wo%2===0?"/image-card-1.png":"/image-card-2.png",bannerUrl:Wo%2===0?"/image-card-1.png":"/image-card-2.png",logoUrl:"/logo-green.png",fuelPrices:{regular:parseFloat(eo.toFixed(2)),premium:parseFloat(to.toFixed(2)),diesel:parseFloat(Io.toFixed(2))},lat:qr?51.5074+(Math.random()-.5)*.02:40.758+(Math.random()-.5)*.02,lon:qr?-.1278+(Math.random()-.5)*.02:-73.9855+(Math.random()-.5)*.02,groceries:qr?Us:Nn,fuelFriends:qr?cn:Bn}})},zo=(qr,Zs,Os,Us)=>{const cn=(Os-qr)*Math.PI/180,Bn=(Us-Zs)*Math.PI/180,Pn=Math.sin(cn/2)*Math.sin(cn/2)+Math.cos(qr*Math.PI/180)*Math.cos(Os*Math.PI/180)*Math.sin(Bn/2)*Math.sin(Bn/2);return 3958.8*(2*Math.atan2(Math.sqrt(Pn),Math.sqrt(1-Pn)))},Cn=qr=>{if(Nt(qr),qr.trim().length>0){const Zs=_e.filter(Us=>Us.name.toLowerCase().includes(qr.toLowerCase())).map(Us=>({type:"station",...Us})),Os=[];_e.forEach(Us=>{Us.groceries&&Us.groceries.forEach(Nn=>{Nn.name.toLowerCase().includes(qr.toLowerCase())&&(Os.some(cn=>cn.name===Nn.name)||Os.push({type:"grocery",...Nn,stationId:Us.id,stationName:Us.name}))})}),ms([...Zs,...Os].slice(0,5)),Kr(!0)}else ms([]),Kr(!1);Wr(qr,It)},On=qr=>{Nt(qr.name),Kr(!1),qr.type==="station"?xr(`/station/${qr.id}`):qr.type==="grocery"&&qr.stationId&&xr(`/station/${qr.stationId}`,{state:{initialTab:"groceries"}})};return reactExports.useEffect(()=>{kt({lat:40.758,lon:-73.9855})},[]),reactExports.useEffect(()=>{(async()=>{if(St){c(!0),gt("");try{let Zs="pk.your_mapbox_access_token_here";Zs||(Zs="pk.eyJ1IjoidmluYTk4IiwiYSI6ImNtN3I3eDF6ZTB2OW0yam9kdzFxdndhdTkifQ.HNqbNgBUAoBPYmoAMISdaw",console.warn("Using fallback Mapbox token"));const Os=St.lat,Us=St.lon,Nn=[Us-.1,Os-.1,Us+.1,Os+.1].join(","),cn=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/fuel.json?access_token=${Zs}&bbox=${Nn}&limit=10&types=poi&country=US,GB`);if(!cn.ok)throw new Error(`Mapbox API error: ${cn.status}`);const Bn=await cn.json();let Pn=[];Bn.features&&Bn.features.length>0&&(Pn=Bn.features.map((Ro,Ho)=>{const Zn=zo(St.lat,St.lon,Ro.geometry.coordinates[1],Ro.geometry.coordinates[0]),Qo=jr(St),Wo=Qo?"":"$",uo=Qo?(1.3+Math.random()*.3).toFixed(2):(3+Math.random()*1).toFixed(2),eo=Qo?(1.5+Math.random()*.3).toFixed(2):(3.5+Math.random()*1).toFixed(2),to=Qo?(1.4+Math.random()*.3).toFixed(2):(3.2+Math.random()*1).toFixed(2);return{id:`station-${Ho}-${Date.now()}`,name:Ro.text||"Fuel Station",address:Ro.place_name||"Address not available",distance:`${Zn.toFixed(1)} miles`,deliveryTime:`${Math.floor(Math.random()*20)+10} mins`,rating:parseFloat((4+Math.random()*1).toFixed(1)),reviewCount:Math.floor(Math.random()*200)+20,imageUrl:Ho%2===0?"/image-card-1.png":"/image-card-2.png",bannerUrl:Ho%2===0?"/image-card-1.png":"/image-card-2.png",logoUrl:"/logo-green.png",fuelPrices:{regular:parseFloat(uo),premium:parseFloat(eo),diesel:parseFloat(to)},lat:Ro.geometry.coordinates[1],lon:Ro.geometry.coordinates[0],groceries:[],fuelFriends:[]}})),Pn.length===0&&(console.warn("No stations found from API, using fallback data"),Pn=_n()),nt(Pn),j(Pn)}catch(Zs){console.error("Error fetching stations:",Zs),gt(Zs.message||"Failed to load fuel stations");const Os=_n();nt(Os),j(Os)}finally{c(!1)}}})()},[St]),jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-black overflow-y-auto min-h-screen overflow-x-hidden",style:{width:"100vw",maxWidth:"100vw"},children:[mr&&jsxRuntimeExports.jsx("div",{className:"fixed top-0 left-0 right-0 z-50 animate-slide-down",children:jsxRuntimeExports.jsx("div",{className:"bg-white dark:bg-black border-b border-gray-200 dark:border-gray-800 px-4 py-3 shadow-sm",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center",children:jsxRuntimeExports.jsx("div",{className:"text-gray-900 font-medium",children:Dr})})})}),jsxRuntimeExports.jsxs("div",{className:"sticky top-0 bg-white z-10 shadow-sm",children:[jsxRuntimeExports.jsx("div",{className:"h-[38px] bg-white"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center px-4 py-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>xr("/profile"),className:"w-7 h-7 rounded-full bg-gray-200 overflow-hidden hover:ring-2 hover:ring-[#3AC36C] transition-all duration-200 flex-shrink-0",rippleColor:"rgba(58, 195, 108, 0.3)",scaleEffect:!1,children:jsxRuntimeExports.jsx("img",{src:"/fuel friend.png",alt:"Profile",className:"w-full h-full object-cover",onError:qr=>{qr.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28'%3E%3Ccircle cx='14' cy='14' r='14' fill='%23e5e7eb'/%3E%3Cpath d='M14 8a3 3 0 1 0 0 6 3 3 0 0 0 0-6zM8 20a6 6 0 0 1 12 0H8z' fill='%23999'/%3E%3C/svg%3E"}})}),jsxRuntimeExports.jsx("img",{src:"/tulisan.svg",alt:"FuelFriendly",className:"h-6 flex-1 max-w-none",style:{width:"calc(100% - 3rem)"},onError:qr=>{qr.currentTarget.style.display="none";const Zs=qr.currentTarget.nextElementSibling;Zs&&Zs.style&&(Zs.style.display="block")}}),jsxRuntimeExports.jsx("span",{className:"text-lg font-bold text-[#3AC36C] hidden flex-1",children:"FUELFRIENDLY"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 ml-3",children:[jsxRuntimeExports.jsx("div",{className:"relative",children:jsxRuntimeExports.jsx("button",{onClick:()=>tr(!0),className:"w-7 h-7 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors flex-shrink-0",children:er==="UK"?jsxRuntimeExports.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/en/a/ae/Flag_of_the_United_Kingdom.svg",alt:"UK",className:"w-4 h-3 object-cover rounded",onError:qr=>{qr.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30"><clipPath id="a"><rect width="60" height="30"/></clipPath><clipPath id="b"><path d="M0 0v30h60V0z"/></clipPath><g clip-path="url(%23a)"><path d="M0 0v30h60V0z" fill="#012169"/><path d="M0 0 60 30M60 0 0 30" stroke="#fff" stroke-width="6"/><path d="M0 0 60 30M60 0 0 30" clip-path="url(%23b)" stroke="#C8102E" stroke-width="4"/><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"/><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"/></g></svg>'}}):jsxRuntimeExports.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/en/a/a4/Flag_of_the_United_States.svg",alt:"US",className:"w-4 h-3 object-cover rounded",onError:qr=>{qr.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7410 3900"><rect width="7410" height="3900" fill="%23b22234"/><path d="M0 450h7410m0 600H0m0 600h7410m0 600H0m0 600h7410m0 600H0" stroke="%23fff" stroke-width="300"/><rect width="2964" height="2100" fill="%233c3b6e"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(63 42)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(126 84)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(189 126)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(252 168)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(315 210)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(378 252)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(441 294)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(504 336)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(567 378)"/></svg>'}})})}),jsxRuntimeExports.jsxs(TapEffectButton,{onClick:()=>xr("/notifications"),className:"w-7 h-7 bg-gray-100 rounded-full flex items-center justify-center hover:bg-gray-200 transition-colors relative flex-shrink-0",rippleColor:"rgba(156, 163, 175, 0.3)",scaleEffect:!1,children:[jsxRuntimeExports.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"#3F4249",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),jsxRuntimeExports.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]}),jsxRuntimeExports.jsx("span",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("span",{className:"text-white text-xs font-bold",children:"3"})})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 pb-3 relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex-1 flex items-center bg-white border border-gray-400 rounded-full px-4 py-3 shadow-sm relative z-20",children:[jsxRuntimeExports.jsx(Search,{size:20,className:"text-[#3F4249] mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Search for fuel and groceries",value:At,onChange:qr=>Cn(qr.target.value),onFocus:()=>{At&&Kr(!0)},className:"flex-1 outline-none text-base text-gray-600 placeholder-gray-500"}),jsxRuntimeExports.jsx("button",{onClick:us,className:`ml-3 p-1 hover:bg-gray-100 rounded-full transition-colors ${Vt?"bg-red-100 text-red-600":""}`,disabled:Vt,children:jsxRuntimeExports.jsx(Mic,{size:20,className:Vt?"text-red-600 animate-pulse":"text-[#3F4249]"})})]}),jsxRuntimeExports.jsx("button",{onClick:()=>Dt(!Jt),className:`w-12 h-12 border border-gray-400 rounded-full flex items-center justify-center transition-colors shadow-sm ${Jt||Object.values(It).some(qr=>qr)?"bg-[#3AC36C] text-white":"bg-[#E3FFEE] hover:bg-[#d1f7dd] text-[#3F4249]"}`,children:jsxRuntimeExports.jsx(SlidersHorizontal,{size:24,className:"rotate-180"})})]}),Ms&&es.length>0&&jsxRuntimeExports.jsx("div",{className:"absolute top-16 left-4 right-4 bg-white shadow-xl max-h-64 overflow-y-auto z-50 border border-gray-100 rounded-2xl animate-fade-in",children:es.map((qr,Zs)=>jsxRuntimeExports.jsxs("button",{className:"w-full text-left px-4 py-3 border-b border-gray-100 last:border-0 hover:bg-gray-50 flex items-center gap-3 transition-colors",onClick:()=>On(qr),children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0",children:qr.type==="station"?jsxRuntimeExports.jsx(Fuel,{size:16,className:"text-[#3AC36C]"}):jsxRuntimeExports.jsx(ShoppingBag,{size:16,className:"text-orange-500"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"text-sm font-semibold text-gray-900",children:qr.name}),qr.type==="grocery"&&jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500",children:["at ",qr.stationName]}),qr.type==="station"&&jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:qr.address})]})]},Zs))})]}),Jt&&jsxRuntimeExports.jsx("div",{className:"px-4 pb-3",children:jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-2xl p-4 space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-[#3F4249]",children:"Filters"}),jsxRuntimeExports.jsx("button",{onClick:yn,className:"text-sm text-[#3AC36C] hover:underline",children:"Clear All"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-[#3F4249] mb-2",children:"Fuel Type"}),jsxRuntimeExports.jsx("div",{className:"flex bg-gray-200 p-1 rounded-lg",children:["Regular","Premium","Diesel"].map(qr=>jsxRuntimeExports.jsx("button",{onClick:()=>Vs("fuelType",qr.toLowerCase()),className:`flex-1 py-1.5 text-sm font-medium rounded-md transition-all ${It.fuelType===qr.toLowerCase()||!It.fuelType&&qr==="Regular"?"bg-white text-[#3AC36C] shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:qr},qr))})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-[#3F4249] mb-2",children:"Price Range"}),jsxRuntimeExports.jsxs("select",{value:It.priceRange,onChange:qr=>Vs("priceRange",qr.target.value),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[jsxRuntimeExports.jsx("option",{value:"",children:"All Prices"}),jsxRuntimeExports.jsx("option",{value:"low",children:"Under $30"}),jsxRuntimeExports.jsx("option",{value:"medium",children:"$30 - $40"}),jsxRuntimeExports.jsx("option",{value:"high",children:"Above $40"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm font-medium text-[#3F4249] mb-2",children:"Min Rating"}),jsxRuntimeExports.jsxs("select",{value:It.rating,onChange:qr=>Vs("rating",qr.target.value),className:"w-full p-2 border border-gray-300 rounded-lg text-sm",children:[jsxRuntimeExports.jsx("option",{value:"",children:"Any Rating"}),jsxRuntimeExports.jsx("option",{value:"4",children:"4+ Stars"}),jsxRuntimeExports.jsx("option",{value:"4.5",children:"4.5+ Stars"}),jsxRuntimeExports.jsx("option",{value:"5",children:"5 Stars"})]})]})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"px-4 mb-4 relative",children:jsxRuntimeExports.jsxs("div",{className:"h-[280px] rounded-2xl overflow-hidden border-2 border-[#3F4249] relative",children:[jsxRuntimeExports.jsx(MapboxMap,{stations:d,userLocation:St,onStationSelect:qr=>xr(`/station/${qr.id}`),isUK:jr(St),fuelType:It.fuelType||"regular"}),jsxRuntimeExports.jsxs("div",{className:"absolute right-4 bottom-4 flex flex-col gap-2",children:[jsxRuntimeExports.jsx(TouchFeedback,{className:"block",children:jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",className:"w-8 h-8 rounded-2xl shadow-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(Plus,{size:18,className:"text-white"})})}),jsxRuntimeExports.jsx(TouchFeedback,{className:"block",children:jsxRuntimeExports.jsx(Button,{variant:"primary",size:"sm",className:"w-8 h-8 rounded-2xl shadow-lg flex items-center justify-center",children:jsxRuntimeExports.jsx(Minus,{size:18,className:"text-white"})})})]}),jsxRuntimeExports.jsxs("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col gap-2",children:[jsxRuntimeExports.jsx(TouchFeedback,{className:"block",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"w-8 h-8 rounded-2xl shadow-lg flex items-center justify-center border-2 border-gray-200",children:jsxRuntimeExports.jsx("div",{className:"w-3 h-3 bg-[#3AC36C] rounded-sm"})})}),jsxRuntimeExports.jsx(TouchFeedback,{className:"block",children:jsxRuntimeExports.jsx(Button,{variant:"ghost",size:"sm",className:"w-8 h-8 rounded-2xl shadow-lg flex items-center justify-center border-2 border-gray-200",children:jsxRuntimeExports.jsx(MapPin,{size:16,className:"text-[#3AC36C]"})})})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 pb-20",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-[#3F4249] mb-4",children:"Fuel Station nearby"}),jsxRuntimeExports.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:ct?jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center py-20",children:jsxRuntimeExports.jsx("div",{className:"w-10 h-10 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin"})}):pt?jsxRuntimeExports.jsx("div",{className:"text-center text-red-500 py-8",children:jsxRuntimeExports.jsx("p",{children:pt})}):d.length===0&&At?jsxRuntimeExports.jsxs("div",{className:"text-center text-gray-500 py-8",children:[jsxRuntimeExports.jsxs("p",{children:['No stations found for "',At,'"']}),jsxRuntimeExports.jsx("button",{onClick:()=>Cn(""),className:"text-[#3AC36C] underline mt-2",children:"Clear search"})]}):d.length===0?jsxRuntimeExports.jsx("div",{className:"text-center text-gray-500 py-8",children:jsxRuntimeExports.jsx("p",{children:"No stations found"})}):d.map((qr,Zs)=>jsxRuntimeExports.jsx(StationCard,{station:qr,index:Zs},qr.id))})]}),Ht&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Welcome!"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Please select your location"})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("button",{onClick:Ar,className:`w-full p-4 rounded-2xl border-2 transition-all duration-200 ${er==="UK"?"border-[#3AC36C] bg-white":"border-gray-200 hover:border-[#3AC36C] hover:bg-gray-50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/en/a/ae/Flag_of_the_United_Kingdom.svg",alt:"UK Flag",className:"w-12 h-8 object-cover rounded border",onError:qr=>{qr.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30"><clipPath id="a"><rect width="60" height="30"/></clipPath><clipPath id="b"><path d="M0 0v30h60V0z"/></clipPath><g clip-path="url(%23a)"><path d="M0 0v30h60V0z" fill="#012169"/><path d="M0 0 60 30M60 0 0 30" stroke="#fff" stroke-width="6"/><path d="M0 0 60 30M60 0 0 30" clip-path="url(%23b)" stroke="#C8102E" stroke-width="4"/><path d="M30 0v30M0 15h60" stroke="#fff" stroke-width="10"/><path d="M30 0v30M0 15h60" stroke="#C8102E" stroke-width="6"/></g></svg>'}}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("div",{className:"font-semibold text-lg text-gray-900",children:"United Kingdom"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-500",children:"London, Manchester, Birmingham..."})]})]})}),jsxRuntimeExports.jsx("button",{onClick:Xr,className:`w-full p-4 rounded-2xl border-2 transition-all duration-200 ${er==="US"?"border-[#3AC36C] bg-white":"border-gray-200 hover:border-[#3AC36C] hover:bg-gray-50"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("img",{src:"https://upload.wikimedia.org/wikipedia/en/a/a4/Flag_of_the_United_States.svg",alt:"US Flag",className:"w-12 h-8 object-cover rounded border",onError:qr=>{qr.currentTarget.src='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 7410 3900"><rect width="7410" height="3900" fill="%23b22234"/><path d="M0 450h7410m0 600H0m0 600h7410m0 600H0m0 600h7410m0 600H0" stroke="%23fff" stroke-width="300"/><rect width="2964" height="2100" fill="%233c3b6e"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(63 42)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(126 84)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(189 126)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(252 168)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(315 210)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(378 252)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(441 294)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(504 336)"/><path d="M247 90 317.53 307.08 545.5 307.08 361 441.27 431.53 658.35 247 524.16 62.47 658.35 133 441.27 -51.53 307.08 176.47 307.08z" fill="%23fff" transform="scale(11.84) translate(567 378)"/></svg>'}}),jsxRuntimeExports.jsxs("div",{className:"text-left",children:[jsxRuntimeExports.jsx("div",{className:"font-semibold text-lg text-gray-900",children:"United States"}),jsxRuntimeExports.jsx("div",{className:"text-sm text-gray-500",children:"New York, Los Angeles, Chicago..."})]})]})})]}),jsxRuntimeExports.jsx("button",{onClick:$r,disabled:!er,className:`w-full mt-6 py-3 rounded-full font-semibold transition-all duration-200 ${er?"bg-[#3AC36C] text-white hover:bg-[#2ea85a]":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:"Continue"})]})})]})})},WaterIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M12 2C12 2 8 6 8 12C8 15.3142 9.68571 18 12 18C14.3143 18 16 15.3142 16 12C16 6 12 2 12 2Z",fill:"#3B82F6",stroke:"#1E40AF",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M10 12C10 13.1046 10.8954 14 12 14C13.1046 14 14 13.1046 14 12C14 10.8954 13.1046 10 12 10C10.8954 10 10 10.8954 10 12Z",fill:"#60A5FA"}),jsxRuntimeExports.jsx("rect",{x:"11",y:"18",width:"2",height:"4",fill:"#1E40AF"})]}),EnergyDrinkIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"6",y:"8",width:"12",height:"10",rx:"2",fill:"#EF4444",stroke:"#DC2626",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M8 6H16V8C16 8.55228 15.5523 9 15 9H9C8.44772 9 8 8.55228 8 8V6Z",fill:"#FCA5A5"}),jsxRuntimeExports.jsx("path",{d:"M10 4H14V6C14 6.55228 13.5523 7 13 7H11C10.4477 7 10 6.55228 10 6V4Z",fill:"#FEE2E2"}),jsxRuntimeExports.jsx("path",{d:"M11 11L13 13L11 15",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("path",{d:"M13 13H9",stroke:"white",strokeWidth:"1.5",strokeLinecap:"round"})]}),SnackIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"4",y:"10",width:"16",height:"8",rx:"2",fill:"#F59E0B",stroke:"#D97706",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"6",y:"8",width:"12",height:"4",rx:"1",fill:"#FCD34D"}),jsxRuntimeExports.jsx("circle",{cx:"8",cy:"14",r:"1",fill:"#92400E"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"14",r:"1",fill:"#92400E"}),jsxRuntimeExports.jsx("circle",{cx:"16",cy:"14",r:"1",fill:"#92400E"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"12",r:"1",fill:"#78350F"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"12",r:"1",fill:"#78350F"})]}),CoffeeIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M6 8H16C16 8 18 8 18 10C18 12 16 12 16 12H6C6 12 4 12 4 10C4 8 6 8 6 8Z",fill:"#6B4423",stroke:"#4B2C0F",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M6 12H16V16C16 17.1046 15.1046 18 14 18H8C6.89543 18 6 17.1046 6 16V12Z",fill:"#8B5A3C"}),jsxRuntimeExports.jsx("path",{d:"M18 10C18 10 20 10 20 12C20 14 18 14 18 14",stroke:"#6B4423",strokeWidth:"1.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M8 14H14",stroke:"#4B2C0F",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M10 2V6",stroke:"#4B2C0F",strokeWidth:"1.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M14 2V6",stroke:"#4B2C0F",strokeWidth:"1.5",strokeLinecap:"round"})]}),SandwichIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M4 18H20V20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V18Z",fill:"#D2691E",stroke:"#A0522D",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"14",width:"16",height:"4",fill:"#90EE90",stroke:"#228B22",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"11",width:"16",height:"3",fill:"#FF6347",stroke:"#DC143C",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"8",width:"16",height:"3",fill:"#FFA500",stroke:"#FF8C00",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M4 4H20V8C20 8.55228 19.5523 9 19 9H5C4.44772 9 4 8.55228 4 8V4Z",fill:"#F4A460",stroke:"#D2691E",strokeWidth:"1"}),jsxRuntimeExports.jsx("circle",{cx:"8",cy:"12.5",r:"0.5",fill:"#8B0000"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12.5",r:"0.5",fill:"#8B0000"}),jsxRuntimeExports.jsx("circle",{cx:"16",cy:"12.5",r:"0.5",fill:"#8B0000"})]}),ChocolateIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"4",y:"6",width:"16",height:"12",rx:"1",fill:"#6B4423",stroke:"#4B2C0F",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"4",y:"6",width:"16",height:"2",fill:"#8B5A3C"}),jsxRuntimeExports.jsx("path",{d:"M8 8V18M12 8V18M16 8V18",stroke:"#4B2C0F",strokeWidth:"0.5"}),jsxRuntimeExports.jsx("path",{d:"M4 10H20M4 14H20",stroke:"#4B2C0F",strokeWidth:"0.5"}),jsxRuntimeExports.jsx("circle",{cx:"6",cy:"7",r:"0.5",fill:"#D2691E"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"7",r:"0.5",fill:"#D2691E"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"7",r:"0.5",fill:"#D2691E"}),jsxRuntimeExports.jsx("circle",{cx:"18",cy:"7",r:"0.5",fill:"#D2691E"})]}),BreadIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M4 12C4 12 4 16 12 16C20 16 20 12 20 12C20 12 20 8 12 8C4 8 4 12 4 12Z",fill:"#D2B48C",stroke:"#8B4513",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M6 10C6 10 7 9 9 9C11 9 13 9 15 9C17 9 18 10 18 10",stroke:"#8B4513",strokeWidth:"0.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M6 12C6 12 7 11 9 11C11 11 13 11 15 11C17 11 18 12 18 12",stroke:"#8B4513",strokeWidth:"0.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M6 14C6 14 7 13 9 13C11 13 13 13 15 13C17 13 18 14 18 14",stroke:"#8B4513",strokeWidth:"0.5",strokeLinecap:"round"})]}),MilkIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M8 6C8 4 10 2 12 2C14 2 16 4 16 6V8C16 10 14 12 12 12C10 12 8 10 8 8V6Z",fill:"#F0F8FF",stroke:"#ADD8E6",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M6 8H18V20C18 21.1046 17.1046 22 16 22H8C6.89543 22 6 21.1046 6 20V8Z",fill:"#F0F8FF",stroke:"#ADD8E6",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M10 8H14",stroke:"#ADD8E6",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M10 12H14",stroke:"#ADD8E6",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M10 16H14",stroke:"#ADD8E6",strokeWidth:"1",strokeLinecap:"round"})]}),EggsIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("ellipse",{cx:"12",cy:"12",rx:"6",ry:"8",fill:"#FFF8DC",stroke:"#D2B48C",strokeWidth:"1"}),jsxRuntimeExports.jsx("ellipse",{cx:"10",cy:"10",rx:"1.5",ry:"2",fill:"#F5DEB3",stroke:"#CD853F",strokeWidth:"0.5"}),jsxRuntimeExports.jsx("ellipse",{cx:"14",cy:"14",rx:"1.5",ry:"2",fill:"#F5DEB3",stroke:"#CD853F",strokeWidth:"0.5"})]}),FruitIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M12 4C8 4 5 7 5 11C5 15 8 18 12 20C16 18 19 15 19 11C19 7 16 4 12 4Z",fill:"#FF6347",stroke:"#DC143C",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M12 4L12 2",stroke:"#228B22",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M10 3C10 3 11 5 12 5C13 5 14 3 14 3",stroke:"#228B22",strokeWidth:"0.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("circle",{cx:"9",cy:"8",r:"1",fill:"#FFD700"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"11",r:"1",fill:"#FFD700"})]}),VegetableIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M12 15L8 20H16L12 15Z",fill:"#228B22",stroke:"#006400",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M12 3L15 8L12 15L9 8L12 3Z",fill:"#32CD32",stroke:"#228B22",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M10 7L8 9",stroke:"#228B22",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M14 7L16 9",stroke:"#228B22",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M12 10L12 12",stroke:"#228B22",strokeWidth:"1",strokeLinecap:"round"})]}),CerealIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"5",y:"8",width:"14",height:"12",rx:"2",fill:"#D2B48C",stroke:"#8B4513",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"6",y:"9",width:"12",height:"2",fill:"#F5DEB3"}),jsxRuntimeExports.jsx("path",{d:"M8 12L10 14L8 16",stroke:"#8B4513",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("path",{d:"M16 12L14 14L16 16",stroke:"#8B4513",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),jsxRuntimeExports.jsx("rect",{x:"7",y:"17",width:"10",height:"2",fill:"#8B4513",rx:"1"})]}),SodaIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"8",y:"4",width:"8",height:"16",rx:"4",fill:"#FF6347",stroke:"#DC143C",strokeWidth:"1"}),jsxRuntimeExports.jsx("rect",{x:"9",y:"5",width:"6",height:"4",fill:"#FFA07A"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"7",r:"1",fill:"#FFE4B5"}),jsxRuntimeExports.jsx("path",{d:"M10 20L10 22",stroke:"#DC143C",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M14 20L14 22",stroke:"#DC143C",strokeWidth:"1",strokeLinecap:"round"})]}),BeerIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("rect",{x:"9",y:"3",width:"6",height:"18",rx:"1",fill:"#FFD700",stroke:"#DAA520",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M9 6H15",stroke:"#DAA520",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M9 10H15",stroke:"#DAA520",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M9 14H15",stroke:"#DAA520",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M10 3L10 1",stroke:"#DAA520",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M14 3L14 1",stroke:"#DAA520",strokeWidth:"1",strokeLinecap:"round"})]}),ChipsIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M4 12C4 12 6 8 12 8C18 8 20 12 20 12C20 12 18 16 12 16C6 16 4 12 4 12Z",fill:"#FFD700",stroke:"#FFA500",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M6 11C7 10 9 11 10 12C11 13 13 13 14 12C15 11 17 10 18 11",stroke:"#FF8C00",strokeWidth:"0.5",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M7 13C8 14 10 13 11 12C12 11 14 11 15 12C16 13 17 14 18 13",stroke:"#FF8C00",strokeWidth:"0.5",strokeLinecap:"round"})]}),IceCreamIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M8 10C8 7 10 5 12 5C14 5 16 7 16 10C16 11 15 13 15 13H9C9 13 8 11 8 10Z",fill:"#F5DEB3",stroke:"#CD853F",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M9 13L7 18H17L15 13",fill:"#F0E68C",stroke:"#DAA520",strokeWidth:"1"}),jsxRuntimeExports.jsx("circle",{cx:"10",cy:"9",r:"1",fill:"#FF69B4"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"8",r:"1",fill:"#87CEEB"})]}),YogurtIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M7 12C7 12 7 18 12 18C17 18 17 12 17 12C17 12 17 8 12 8C7 8 7 12 7 12Z",fill:"#FFF8DC",stroke:"#D2B48C",strokeWidth:"1"}),jsxRuntimeExports.jsx("path",{d:"M9 10H15",stroke:"#D2B48C",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M9 14H15",stroke:"#D2B48C",strokeWidth:"1",strokeLinecap:"round"}),jsxRuntimeExports.jsx("path",{d:"M12 18V20",stroke:"#D2B48C",strokeWidth:"1",strokeLinecap:"round"})]}),CookieIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("circle",{cx:"12",cy:"12",r:"8",fill:"#8B4513",stroke:"#654321",strokeWidth:"1"}),jsxRuntimeExports.jsx("circle",{cx:"9",cy:"9",r:"1",fill:"#D2B48C"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"8",r:"1",fill:"#D2B48C"}),jsxRuntimeExports.jsx("circle",{cx:"11",cy:"13",r:"1",fill:"#D2B48C"}),jsxRuntimeExports.jsx("circle",{cx:"15",cy:"14",r:"1",fill:"#D2B48C"}),jsxRuntimeExports.jsx("circle",{cx:"8",cy:"14",r:"1",fill:"#D2B48C"})]}),PizzaIcon=({className:e="w-6 h-6"})=>jsxRuntimeExports.jsxs("svg",{className:e,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[jsxRuntimeExports.jsx("path",{d:"M12 4C7 4 3 8 3 12C3 16 7 20 12 20C17 20 21 16 21 12C21 8 17 4 12 4Z",fill:"#FFA500",stroke:"#FF8C00",strokeWidth:"1"}),jsxRuntimeExports.jsx("circle",{cx:"9",cy:"9",r:"1",fill:"#FF6347"}),jsxRuntimeExports.jsx("circle",{cx:"14",cy:"8",r:"1",fill:"#FF6347"}),jsxRuntimeExports.jsx("circle",{cx:"11",cy:"13",r:"1",fill:"#FF6347"}),jsxRuntimeExports.jsx("circle",{cx:"15",cy:"14",r:"1",fill:"#FF6347"}),jsxRuntimeExports.jsx("circle",{cx:"8",cy:"14",r:"1",fill:"#FF6347"}),jsxRuntimeExports.jsx("path",{d:"M12 4V2",stroke:"#FF8C00",strokeWidth:"1",strokeLinecap:"round"})]}),getGroceryIcon=(e,i="w-6 h-6")=>{const d=e.toLowerCase();return d.includes("water")||d.includes("mineral")?jsxRuntimeExports.jsx(WaterIcon,{className:i}):d.includes("energy")||d.includes("drink")||d.includes("red bull")||d.includes("monster")?jsxRuntimeExports.jsx(EnergyDrinkIcon,{className:i}):d.includes("snack")||d.includes("chips")||d.includes("crisps")?jsxRuntimeExports.jsx(ChipsIcon,{className:i}):d.includes("coffee")||d.includes("caffeine")?jsxRuntimeExports.jsx(CoffeeIcon,{className:i}):d.includes("sandwich")||d.includes("burger")?jsxRuntimeExports.jsx(SandwichIcon,{className:i}):d.includes("bread")||d.includes("roll")||d.includes("bagel")||d.includes("croissant")?jsxRuntimeExports.jsx(BreadIcon,{className:i}):d.includes("milk")||d.includes("dairy")?jsxRuntimeExports.jsx(MilkIcon,{className:i}):d.includes("egg")||d.includes("eggs")?jsxRuntimeExports.jsx(EggsIcon,{className:i}):d.includes("fruit")||d.includes("apple")||d.includes("banana")||d.includes("orange")||d.includes("berries")?jsxRuntimeExports.jsx(FruitIcon,{className:i}):d.includes("vegetable")||d.includes("veggie")||d.includes("lettuce")||d.includes("tomato")||d.includes("carrot")||d.includes("onion")||d.includes("potato")?jsxRuntimeExports.jsx(VegetableIcon,{className:i}):d.includes("cereal")||d.includes("oats")||d.includes("granola")?jsxRuntimeExports.jsx(CerealIcon,{className:i}):d.includes("soda")||d.includes("coke")||d.includes("pepsi")||d.includes("sprite")?jsxRuntimeExports.jsx(SodaIcon,{className:i}):d.includes("beer")||d.includes("lager")||d.includes("ale")||d.includes("cider")?jsxRuntimeExports.jsx(BeerIcon,{className:i}):d.includes("chocolate")||d.includes("candy")||d.includes("sweet")?jsxRuntimeExports.jsx(ChocolateIcon,{className:i}):d.includes("ice cream")||d.includes("ice-cream")||d.includes("gelato")?jsxRuntimeExports.jsx(IceCreamIcon,{className:i}):d.includes("yogurt")||d.includes("yoghurt")?jsxRuntimeExports.jsx(YogurtIcon,{className:i}):d.includes("cookie")||d.includes("biscuit")||d.includes("cracker")?jsxRuntimeExports.jsx(CookieIcon,{className:i}):d.includes("pizza")||d.includes("pie")?jsxRuntimeExports.jsx(PizzaIcon,{className:i}):d.includes("tea")?jsxRuntimeExports.jsx(CoffeeIcon,{className:i}):d.includes("donut")||d.includes("doughnut")?jsxRuntimeExports.jsx(CookieIcon,{className:i}):d.includes("protein")||d.includes("bar")?jsxRuntimeExports.jsx(SnackIcon,{className:i}):d.includes("juice")?jsxRuntimeExports.jsx(WaterIcon,{className:i}):d.includes("mints")||d.includes("mint")?jsxRuntimeExports.jsx(WaterIcon,{className:i}):jsxRuntimeExports.jsx(SnackIcon,{className:i})},StationDetailsScreen=()=>{var dr,mr,Ur;const{id:e}=useParams(),i=useNavigate(),d=useLocation(),[j,_e]=reactExports.useState(null),[nt,ct]=reactExports.useState(!0),[c,pt]=reactExports.useState(""),[gt,St]=reactExports.useState([]),[kt,At]=reactExports.useState(null),[Nt,Vt]=reactExports.useState(!1),[zt,Jt]=reactExports.useState(!1),Dt=Dr=>{const Yr=(Dr==null?void 0:Dr.toLowerCase())||"";return console.log("Station name for logo:",Yr),Yr.includes("shell")||Yr.includes("turbofuel")?"https://logos-world.net/wp-content/uploads/2020/04/Shell-Logo.png":Yr.includes("bp")||Yr.includes("british petroleum")?"https://logos-world.net/wp-content/uploads/2020/04/BP-Logo.png":Yr.includes("exxon")||Yr.includes("mobil")?"https://logos-world.net/wp-content/uploads/2020/04/ExxonMobil-Logo.png":Yr.includes("chevron")?"https://logos-world.net/wp-content/uploads/2020/04/Chevron-Logo.png":Yr.includes("total")?"https://logos-world.net/wp-content/uploads/2020/04/Total-Logo.png":Yr.includes("ecofuel")||Yr.includes("eco")?"https://logos-world.net/wp-content/uploads/2020/04/BP-Logo.png":Yr.includes("quickstop")||Yr.includes("quick")?"https://logos-world.net/wp-content/uploads/2020/04/Chevron-Logo.png":Yr.includes("premium")||Yr.includes("fuel hub")?"https://logos-world.net/wp-content/uploads/2020/04/ExxonMobil-Logo.png":"https://logos-world.net/wp-content/uploads/2020/04/Shell-Logo.png"};reactExports.useEffect(()=>{var Dr,Yr;(Dr=d.state)!=null&&Dr.selectedFuelFriend&&At(d.state.selectedFuelFriend),(Yr=d.state)!=null&&Yr.cartItems&&St(d.state.cartItems)},[d.state]);const It=(j==null?void 0:j.groceries)||[],Mt=(j==null?void 0:j.fuelFriends)||[];reactExports.useEffect(()=>{(async()=>{var Yr,es,ms,Ms,Kr,xr,jr;if(e){ct(!0);try{if((Yr=d.state)!=null&&Yr.station){console.log("Using station data from HomeScreen:",d.state.station),_e(d.state.station);return}const rr=await apiGetStationDetails(e);_e(rr)}catch(rr){if(console.error("Error fetching station details:",rr),pt(rr.message),(es=d.state)!=null&&es.station){if((Kr=d.state)!=null&&Kr.station){const ar=d.state.station;if((!ar.groceries||ar.groceries.length===0)&&(ar.groceries=[{id:"grocery-1",name:"Bottled Water",price:2.5,description:"Pure drinking water"},{id:"grocery-2",name:"Energy Drink",price:3.99,description:"Refreshing energy boost"},{id:"grocery-3",name:"Potato Chips",price:4.99,description:"Crispy potato chips"},{id:"grocery-4",name:"Coffee",price:5.99,description:"Hot coffee"},{id:"grocery-5",name:"Fresh Sandwich",price:7.99,description:"Fresh sandwich with ingredients"},{id:"grocery-6",name:"Chocolate Bar",price:2.99,description:"Chocolate treat"},{id:"grocery-7",name:"Fresh Milk",price:4.25,description:"Whole milk, 1 gallon"},{id:"grocery-8",name:"Bread Loaf",price:3.49,description:"Fresh baked bread"},{id:"grocery-9",name:"Fresh Eggs",price:5.99,description:"Large eggs, 12-pack"},{id:"grocery-10",name:"Apple",price:.99,description:"Fresh red apple"}]),!ar.fuelFriends||ar.fuelFriends.length===0){const Ar=((xr=ar==null?void 0:ar.address)==null?void 0:xr.toLowerCase().includes("uk"))||((jr=ar==null?void 0:ar.address)==null?void 0:jr.toLowerCase().includes("london"))||(ar==null?void 0:ar.lat)&&ar.lat>49&&ar.lat<60&&(ar==null?void 0:ar.lon)&&ar.lon>-10&&ar.lon<2?[{id:"friend-uk-1",name:"James Mitchell",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:4.99,phone:"+447712345678"},{id:"friend-uk-2",name:"Emma Thompson",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:5.49,phone:"+447712345679"}]:[{id:"friend-us-1",name:"David Johnson",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:5.99,phone:"+12125551234"},{id:"friend-us-2",name:"Jennifer Smith",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:6.99,phone:"+12125551235"}];ar.fuelFriends=Ar}_e(ar)}}else{console.warn("No station data from HomeScreen, using fallback data");const ar=[{name:"Shell Gas Station",tag:"24/7",description:"Convenient Shell location offering premium gasoline, diesel, and quick service. Located at 1234 Highway 1, Nashville, TN 37201. Features clean restrooms, ATM, and car wash facilities."},{name:"BP Connect",tag:"BP",description:"BP Connect station with premium fuels and convenience store. Address: 5678 Interstate Drive, Atlanta, GA 30301. Open 24/7 with coffee bar and fresh food options."},{name:"Exxon Select",tag:"EXXON",description:"Exxon Select fuel station featuring Synergy Supreme+ gasoline. Located at 9012 Petroleum Blvd, Dallas, TX 75201. Offers loyalty rewards and premium car care products."},{name:"Chevron Extra Mile",tag:"CHEVRON",description:"Chevron Extra Mile station with Techron fuel additive. Address: 3456 Energy Lane, Phoenix, AZ 85001. Features diesel exhaust fluid and fleet services."},{name:"7-Eleven Fuel",tag:"7/11",description:"7-Eleven Fuel Center offering Slurpee drinks and fresh food. Located at 789 Convenience Ave, Miami, FL 33101. Open 24 hours with EV charging stations."},{name:"Wawa Fuel",tag:"WAWA",description:"Wawa Fuel location famous for fresh coffee and hoagies. Address: 1123 Travel Plaza, Philadelphia, PA 19101. Features Wawa App pay and premium fuel options."}],$r=[{name:"Tesco Fuel Station",tag:"TESCO",description:"Tesco petrol station offering supermarket fuel with Clubcard points. Located at 456 High Street, London SW1A 1AA. Features Tesco Express shop and car wash facilities."},{name:"Shell Service Station",tag:"SHELL",description:"Shell service station with V-Power fuels and convenience store. Address: 789 Oxford Street, London W1D 1BS. Open 24/7 with coffee shop and ATMs."},{name:"BP Garage",tag:"BP",description:"BP garage featuring Ultimate fuels and Wild Bean Caf. Located at 123 Regent Street, London W1B 4HY. Offers loyalty cards and premium car care services."},{name:"Esso Express",tag:"ESSO",description:"Esso Express station with Synergy Supreme+ fuels. Address: 567 Kings Road, London SW3 4UT. Features forecourt shop and professional car cleaning services."},{name:"Sainsburys Local Fuel",tag:"SAINSBURYS",description:"Sainsburys Local fuel station with Nectar points. Located at 890 High Holborn, London WC1V 7RA. Open late with fresh food and grocery essentials."},{name:"Morrisons Daily",tag:"MORRISONS",description:"Morrisons Daily petrol station with quality fuels and fresh food. Address: 234 Tottenham Court Road, London W1T 2BF. Features Morrisons caf and loyalty rewards."}],Ar=Math.random()>.5,Xr=Ar?$r:ar,us=parseInt((e==null?void 0:e.replace(/\D/g,""))||"0")%Xr.length,Wr=Xr[us],Vs=[{id:"grocery-1",name:"Premium Coffee Beans",price:12.99,description:"Ethiopian single-origin coffee beans",category:"beverages",icon:"",imageUrl:"/coffee-beans.jpg"},{id:"grocery-2",name:"Craft Beer Selection",price:8.99,description:"Local craft brewery variety pack",category:"beverages",icon:"",imageUrl:"/craft-beer.jpg"},{id:"grocery-3",name:"Sparkling Water",price:2.49,description:"Natural mineral sparkling water",category:"beverages",icon:"",imageUrl:"/sparkling-water.jpg"},{id:"grocery-4",name:"Fresh Coconut Water",price:3.99,description:"100% pure coconut water",category:"beverages",icon:"",imageUrl:"/coconut-water.jpg"},{id:"grocery-5",name:"Gourmet Truffle Chips",price:6.99,description:"Artisan truffle-flavored potato chips",category:"snacks",icon:"",imageUrl:"/truffle-chips.jpg"},{id:"grocery-6",name:"International Chocolate Box",price:14.99,description:"Assorted premium chocolates from around the world",category:"snacks",icon:"",imageUrl:"/chocolate-box.jpg"},{id:"grocery-7",name:"Korean Kimchi Snacks",price:4.49,description:"Authentic Korean spicy kimchi-flavored crisps",category:"snacks",icon:"",imageUrl:"/kimchi-snacks.jpg"},{id:"grocery-8",name:"Japanese Seaweed Snacks",price:3.99,description:"Roasted nori seaweed sheets",category:"snacks",icon:"",imageUrl:"/seaweed-snacks.jpg"},{id:"grocery-9",name:"Artisan Sourdough Bread",price:5.99,description:"Freshly baked sourdough loaf",category:"fresh-food",icon:"",imageUrl:"/sourdough-bread.jpg"},{id:"grocery-10",name:"Gourmet Cheese Board",price:18.99,description:"Selection of aged cheeses with crackers",category:"fresh-food",icon:"",imageUrl:"/cheese-board.jpg"},{id:"grocery-11",name:"Fresh Avocados",price:2.49,description:"Ripe Hass avocados, pack of 3",category:"fresh-food",icon:"",imageUrl:"/avocados.jpg"},{id:"grocery-12",name:"Organic Mixed Berries",price:7.99,description:"Seasonal organic berry mix",category:"fresh-food",icon:"",imageUrl:"/mixed-berries.jpg"},{id:"grocery-13",name:"Gourmet Sushi Box",price:15.99,description:"Chef-prepared sushi assortment",category:"prepared-food",icon:"",imageUrl:"/sushi-box.jpg"},{id:"grocery-14",name:"Gourmet Sandwich Collection",price:9.99,description:"Artisan sandwiches with premium ingredients",category:"prepared-food",icon:"",imageUrl:"/sandwich-collection.jpg"},{id:"grocery-15",name:"Fresh Soup of the Day",price:6.49,description:"Chef's daily soup selection",category:"prepared-food",icon:"",imageUrl:"/soup-of-day.jpg"},{id:"grocery-16",name:"Protein Shake Mix",price:11.99,description:"Premium whey protein powder",category:"health",icon:"",imageUrl:"/protein-shake.jpg"},{id:"grocery-17",name:"Organic Energy Bars",price:2.99,description:"All-natural energy bars, pack of 5",category:"health",icon:"",imageUrl:"/energy-bars.jpg"},{id:"grocery-18",name:"Cold-Pressed Juice",price:5.99,description:"Fresh vegetable and fruit juice blend",category:"health",icon:"",imageUrl:"/cold-pressed-juice.jpg"},{id:"grocery-19",name:"Italian Pasta Selection",price:4.99,description:"Authentic Italian pasta varieties",category:"international",icon:"",imageUrl:"/italian-pasta.jpg"},{id:"grocery-20",name:"Middle Eastern Spice Set",price:8.99,description:"Premium spice collection for cooking",category:"international",icon:"",imageUrl:"/spice-set.jpg"},{id:"grocery-21",name:"Mexican Street Corn Kit",price:7.49,description:"Authentic Mexican street corn seasoning kit",category:"international",icon:"",imageUrl:"/mexican-corn-kit.jpg"},{id:"grocery-22",name:"French Macarons",price:12.99,description:"Delicate French almond meringue cookies",category:"international",icon:"",imageUrl:"/french-macarons.jpg"},{id:"grocery-23",name:"Wagyu Beef Sliders",price:24.99,description:"Premium Japanese Wagyu beef mini burgers",category:"premium",icon:"",imageUrl:"/wagyu-sliders.jpg"},{id:"grocery-24",name:"Caviar Tin",price:45.99,description:"Premium Russian sturgeon caviar",category:"premium",icon:"",imageUrl:"/caviar-tin.jpg"},{id:"grocery-25",name:"Champagne Bottle",price:29.99,description:"Premium French champagne",category:"premium",icon:"",imageUrl:"/champagne-bottle.jpg"}],yn=[{id:"friend-uk-1",name:"James Mitchell",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:4.99,phone:"+447712345678"},{id:"friend-uk-2",name:"Emma Thompson",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:5.49,phone:"+447712345679"}],_n=[{id:"friend-us-1",name:"David Johnson",rating:4.8,reviewCount:156,avatarUrl:"/fuel friend.png",location:"0.5 miles away",rate:5.99,phone:"+12125551234"},{id:"friend-us-2",name:"Jennifer Smith",rating:4.9,reviewCount:203,avatarUrl:"/fuel friend.png",location:"0.3 miles away",rate:6.99,phone:"+12125551235"}],Cn=((ms=j==null?void 0:j.address)==null?void 0:ms.toLowerCase().includes("uk"))||((Ms=j==null?void 0:j.address)==null?void 0:Ms.toLowerCase().includes("london"))||(j==null?void 0:j.lat)&&j.lat>49&&j.lat<60&&(j==null?void 0:j.lon)&&j.lon>-10&&j.lon<2?yn:_n;_e({id:e,name:Wr.name,address:Ar?"123 High Street, London SW1A 1AA":"1234 Highway 1, Nashville, TN 37201",distance:"2.7 miles away",deliveryTime:"30 minutes",rating:4.7,reviews:146,image:"/brand1.png",description:Wr.description,fuelPrices:{regular:1.23,premium:1.75,diesel:2.14},groceries:Vs,fuelFriends:Cn})}}finally{ct(!1)}}})()},[e,d.state]);const Ht=(Dr,Yr)=>{St(es=>{const ms=es.find(Ms=>Ms.id===Dr);if(ms)return ms.quantity+Yr<=0?es.filter(Ms=>Ms.id!==Dr):es.map(Ms=>Ms.id===Dr?{...Ms,quantity:Ms.quantity+Yr}:Ms);if(Yr>0){const Ms=It.find(Kr=>Kr.id===Dr);if(Ms)return[...es,{id:Dr,name:Ms.name,price:Ms.price,quantity:1}]}return es})},tr=Dr=>{const Yr=gt.find(es=>es.id===Dr);return Yr?Yr.quantity:0},er=Dr=>{St(Yr=>Yr.filter(es=>es.id!==Dr))};return nt?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center min-h-screen",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin"})})}):c&&!j?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center min-h-screen",children:jsxRuntimeExports.jsx("p",{className:"text-red-500",children:c})})}):jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("div",{className:"h-48 bg-gradient-to-r from-orange-400 to-pink-400 relative overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:"/image-card-1.png",alt:"Station",className:"w-full h-full object-cover"}),jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>i(-1),className:"absolute top-4 left-4 p-2 bg-white/80 rounded-full",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-white",children:"Station Details"})})]}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-white rounded-full p-2 shadow-lg",children:jsxRuntimeExports.jsx("img",{src:Dt(j==null?void 0:j.name),alt:j==null?void 0:j.name,className:"w-full h-full object-contain",onError:Dr=>{Dr.currentTarget.src="https://logos-world.net/wp-content/uploads/2020/04/Shell-Logo.png"}})})})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 pt-12 pb-6 text-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:j==null?void 0:j.name}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center text-gray-600 mb-4",children:[jsxRuntimeExports.jsx("img",{src:"/pinpoint.png",alt:"Location",className:"w-4 h-4 mr-1"}),jsxRuntimeExports.jsx("span",{className:"text-sm",children:j==null?void 0:j.address})]}),(j==null?void 0:j.description)&&jsxRuntimeExports.jsxs("div",{className:"mt-6 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"About"}),jsxRuntimeExports.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:j.description})]})]}),jsxRuntimeExports.jsx("div",{className:"mx-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4 text-center",children:"Fuel Prices"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Regular"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["$",(dr=j==null?void 0:j.fuelPrices)==null?void 0:dr.regular," per liter"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Premium"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["$",(mr=j==null?void 0:j.fuelPrices)==null?void 0:mr.premium," per liter"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Diesel"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold",children:["$",(Ur=j==null?void 0:j.fuelPrices)==null?void 0:Ur.diesel," per liter"]})]})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6 space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center text-gray-600",children:[jsxRuntimeExports.jsx("img",{src:"/pinpoint.png",alt:"Location",className:"w-4 h-4 mr-2"}),jsxRuntimeExports.jsxs("span",{className:"text-sm",children:["Distance: ",j==null?void 0:j.distance]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center text-gray-600",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4 mr-2 text-gray-500"}),jsxRuntimeExports.jsxs("span",{className:"text-sm",children:["Average Pickup time: ",j==null?void 0:j.deliveryTime]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center text-gray-600",children:[jsxRuntimeExports.jsx(Star,{className:"w-4 h-4 mr-2 text-yellow-500 fill-current"}),jsxRuntimeExports.jsxs("span",{className:"text-sm",children:[j==null?void 0:j.rating," Rating "]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-green-600",children:["(",j==null?void 0:j.reviewCount," reviews)"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>i(`/station/${e}/reviews`),className:"text-green-600 text-sm font-medium hover:underline",children:"See all reviews"})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Groceries"}),It.length>4&&jsxRuntimeExports.jsx("button",{onClick:()=>Vt(!Nt),className:"text-green-600 text-sm font-medium",children:Nt?"Show less":"See all"})]}),nt?jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center py-8",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin"})}):It.length>0?jsxRuntimeExports.jsx("div",{className:"space-y-3",children:(Nt?It:It.slice(0,4)).map(Dr=>{const Yr=tr(Dr.id);return jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-gray-50 rounded-lg",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:getGroceryIcon(Dr.name,"w-12 h-12")}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:Dr.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["$",Dr.price]})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-2",children:Yr>0?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>Ht(Dr.id,-1),className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Minus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("span",{className:"w-8 text-center font-medium",children:Yr}),jsxRuntimeExports.jsx("button",{onClick:()=>Ht(Dr.id,1),className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4"})}),jsxRuntimeExports.jsx("button",{onClick:()=>er(Dr.id),className:"w-8 h-8 bg-red-100 rounded-full flex items-center justify-center ml-2",children:jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 text-red-600"})})]}):jsxRuntimeExports.jsx("button",{onClick:()=>Ht(Dr.id,1),className:"bg-green-500 text-white px-4 py-2 rounded-full text-sm font-medium",children:"Add"})})]},Dr.id)})}):jsxRuntimeExports.jsx("div",{className:"text-center py-8 text-gray-500",children:jsxRuntimeExports.jsx("p",{children:"No groceries available at this station"})})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Fuel friend"}),Mt.length>4&&jsxRuntimeExports.jsx("button",{onClick:()=>Jt(!zt),className:"text-green-600 text-sm font-medium",children:zt?"Show less":"See all"})]}),kt?jsxRuntimeExports.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-4",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("img",{src:kt.avatarUrl||"/fuel friend.png",alt:kt.name,className:"w-12 h-12 rounded-full object-cover",onError:Dr=>{Dr.currentTarget.src="/fuel friend.png"}}),jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx("svg",{className:"w-3 h-3 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:kt.name}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:["$",kt.rate||"N/A"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1",children:[jsxRuntimeExports.jsx(Star,{className:"w-3 h-3 text-yellow-500 fill-current"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-600",children:kt.rating}),jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-green-500"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Selected"})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>At(null),className:"text-red-500 text-sm font-medium",children:"Remove"})]})}):nt?jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center py-8",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin"})}):jsxRuntimeExports.jsx("div",{className:"grid grid-cols-2 gap-3 mb-4",children:Mt.length>0?(zt?Mt:Mt.slice(0,4)).map(Dr=>jsxRuntimeExports.jsxs("div",{className:`rounded-lg p-3 transition-all duration-200 ${(kt==null?void 0:kt.id)===Dr.id?"bg-green-100 border-2 border-green-500":"bg-gray-50 border border-gray-200 hover:bg-gray-100"}`,children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("img",{src:Dr.avatarUrl||"/fuel friend.png",alt:Dr.name,className:"w-8 h-8 rounded-full object-cover",onError:Yr=>{Yr.currentTarget.src="/fuel friend.png"}}),(kt==null?void 0:kt.id)===Dr.id&&jsxRuntimeExports.jsx("div",{className:"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center border-2 border-white",children:jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-white"})})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsx("button",{onClick:()=>i(`/fuel-friend/${Dr.id}`,{state:{fuelFriend:Dr,cartItems:gt,stationId:e}}),className:"text-sm font-medium text-gray-900 truncate hover:text-green-600 transition-colors text-left",children:Dr.name}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-600",children:["$",Dr.rate||"N/A"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1 mb-2",children:[jsxRuntimeExports.jsx("img",{src:"/pinpoint.png",alt:"Location",className:"w-3 h-3"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-600",children:Dr.location||"Location N/A"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-1 mb-3",children:[jsxRuntimeExports.jsx(Star,{className:"w-3 h-3 text-yellow-500 fill-current"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-600",children:Dr.rating||"N/A"}),jsxRuntimeExports.jsxs("span",{className:"text-xs text-green-600",children:["(",Dr.reviewCount||Dr.reviews||0," reviews)"]})]}),jsxRuntimeExports.jsx("button",{onClick:()=>At(Dr),className:`w-full py-2 rounded-full text-sm font-medium transition-colors flex items-center justify-center space-x-1 ${(kt==null?void 0:kt.id)===Dr.id?"bg-green-600 text-white":"bg-green-500 text-white hover:bg-green-600"}`,children:(kt==null?void 0:kt.id)===Dr.id?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(Check,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Selected"})]}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(User,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Select"})]})})]},Dr.id)):jsxRuntimeExports.jsx("div",{className:"col-span-2 text-center py-8 text-gray-500",children:jsxRuntimeExports.jsx("p",{children:"No fuel friends available at this station"})})}),!kt&&Mt.length>4&&!zt?jsxRuntimeExports.jsxs("button",{onClick:()=>Jt(!0),className:"w-full text-green-600 text-sm font-medium py-2",children:["View More (",Mt.length," total)"]}):null]}),jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:jsxRuntimeExports.jsx("button",{onClick:()=>{console.log("StationDetails - Order Now clicked"),console.log("StationDetails - station:",j),console.log("StationDetails - cart:",gt),console.log("StationDetails - selectedFuelFriend:",kt);const Dr={station:j||{id:"default-station",name:"Fuel Station",address:"Station Address",fuelPrices:{regular:3.29,premium:3.79,diesel:3.59},regularPrice:3.29,deliveryTime:"15-20 mins",rating:4.5,reviewCount:128,imageUrl:"/brand1.png",bannerUrl:"/brand1.png",logoUrl:"/logo-green.png",groceries:[],fuelFriends:[]},cartItems:gt||[],selectedFuelFriend:kt||null,totalItems:((gt==null?void 0:gt.length)||0)+(kt?1:0)};console.log("StationDetails - navigation state:",Dr);try{i("/checkout",{state:Dr})}catch(Yr){console.error("Navigation error:",Yr),i("/checkout")}},className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold hover:bg-green-600 transition-colors",children:`Order Now${gt.length>0||kt?` (${gt.length+(kt?1:0)} items)`:""}`})})]})})},StationReviewsScreen=()=>{const e=useNavigate(),{id:i}=useParams(),[d,j]=reactExports.useState([]),[_e,nt]=reactExports.useState(!0);reactExports.useEffect(()=>{(async()=>{var gt;if(i)try{nt(!0);const St=await apiGetStationReviews(i);j(St.map(kt=>({id:kt.id,userName:kt.userName||"Anonymous",rating:kt.rating,createdAt:ct(kt.createdAt),comment:kt.comment||"",userAvatar:kt.userAvatar||"/avatar.png"})))}catch(St){console.error("Failed to fetch reviews:",St),(gt=St.message)!=null&&gt.includes("not found")?(alert("Station not found"),e("/home")):alert("Failed to load reviews. Please try again.")}finally{nt(!1)}})()},[i]);const ct=pt=>{const gt=new Date(pt),kt=Math.abs(new Date().getTime()-gt.getTime()),At=Math.ceil(kt/(1e3*60*60*24));return At===1?"1 day ago":At<30?`${At} days ago`:At<60?"1 month ago":`${Math.floor(At/30)} months ago`},c=pt=>Array.from({length:5},(gt,St)=>jsxRuntimeExports.jsx(Star,{className:`w-4 h-4 ${St<pt?"text-yellow-500 fill-current":"text-gray-300"}`},St));return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center sticky top-0 bg-white z-10 shadow-sm border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-center flex-grow -ml-10 text-[#3F4249]",children:"Reviews"})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"h-32 bg-gradient-to-r from-orange-400 to-pink-400 relative overflow-hidden",children:jsxRuntimeExports.jsx("img",{src:"/image-card-1.png",alt:"Station",className:"w-full h-full object-cover"})}),jsxRuntimeExports.jsx("div",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-white rounded-full p-2 shadow-lg",children:jsxRuntimeExports.jsx("img",{src:"/brand1.png",alt:"Station Logo",className:"w-full h-full object-contain"})})})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 pt-12 pb-6 text-center",children:[jsxRuntimeExports.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Petro Tennessee"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:" Abcd Canada"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-[#3F4249] mb-4",children:"Reviews"}),_e?jsxRuntimeExports.jsx("div",{className:"flex justify-center py-8",children:jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin"})}):jsxRuntimeExports.jsx("div",{className:"space-y-4",children:d.length>0?d.map(pt=>jsxRuntimeExports.jsx("div",{className:"bg-white border border-gray-100 rounded-lg p-4 shadow-sm",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3",children:[jsxRuntimeExports.jsx("img",{src:pt.userAvatar,alt:pt.userName,className:"w-10 h-10 rounded-full object-cover border-2 border-gray-200",onError:gt=>{gt.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Ccircle cx='20' cy='20' r='20' fill='%23e5e7eb'/%3E%3Cpath d='M20 10a6 6 0 1 0 0 12 6 6 0 0 0 0-12zM12 30a8 8 0 0 1 16 0H12z' fill='%23999'/%3E%3C/svg%3E"}}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-[#3F4249]",children:pt.userName}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500",children:pt.createdAt})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center mb-3",children:c(pt.rating)}),pt.comment&&jsxRuntimeExports.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:pt.comment})]})]})},pt.id)):jsxRuntimeExports.jsx("div",{className:"text-center py-8",children:jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:"No reviews yet"})})}),jsxRuntimeExports.jsx("div",{className:"mt-6 mb-8 text-center",children:jsxRuntimeExports.jsx("button",{className:"text-[#3AC36C] font-medium text-sm hover:underline",children:"Read More"})})]})]})})},formatTimeAgo=e=>{const i=new Date(e),j=Math.floor((new Date().getTime()-i.getTime())/(1e3*60*60));if(j<1)return"Just now";if(j<24)return`${j}h ago`;const _e=Math.floor(j/24);return _e<7?`${_e}d ago`:i.toLocaleDateString()},FuelFriendDetailsScreen=()=>{const{id:e}=useParams(),i=useNavigate(),d=useLocation(),{user:j}=useAppContext(),[_e,nt]=reactExports.useState(null),[ct,c]=reactExports.useState([]),[pt,gt]=reactExports.useState(!0),[St,kt]=reactExports.useState(""),[At,Nt]=reactExports.useState({rating:0,comment:""}),[Vt,zt]=reactExports.useState(!1);reactExports.useEffect(()=>{(async()=>{var er;if(e){gt(!0);try{if((er=d.state)!=null&&er.fuelFriend){console.log("Using fuel friend data from StationDetailsScreen:",d.state.fuelFriend),nt(d.state.fuelFriend);try{const Ur=await apiGetFuelFriendReviews(e);c(Ur)}catch(Ur){console.warn("Failed to fetch reviews, using fallback:",Ur),c(Dt())}return}const[dr,mr]=await Promise.all([apiGetFuelFriendDetails(e),apiGetFuelFriendReviews(e)]);nt(dr),c(mr)}catch(dr){console.error("Error fetching fuel friend data:",dr),kt(dr.message),console.warn("Using fallback fuel friend data");const mr=Jt(e),Ur=Dt();nt(mr),c(Ur)}finally{gt(!1)}}})()},[e,d.state]);const Jt=tr=>{const er=[{id:"friend-uk-1",fullName:"James Mitchell",location:"0.5 miles away",deliveryFee:4.99,rating:4.8,totalReviews:156,profilePhoto:"/2.png",about:"Experienced fuel delivery professional with over 5 years of service. Specializes in quick and efficient fuel delivery with excellent customer service. Always on time and very professional."},{id:"friend-uk-2",fullName:"Emma Thompson",location:"0.3 miles away",deliveryFee:5.49,rating:4.9,totalReviews:203,profilePhoto:"/2.png",about:"Friendly and reliable fuel delivery expert. Known for her attention to detail and exceptional customer service. Always ensures safe and clean fuel delivery."},{id:"friend-us-1",fullName:"David Johnson",location:"0.5 miles away",deliveryFee:5.99,rating:4.8,totalReviews:156,profilePhoto:"/2.png",about:"Experienced fuel delivery professional with over 5 years of service. Specializes in quick and efficient fuel delivery with excellent customer service. Always on time and very professional."},{id:"friend-us-2",fullName:"Jennifer Smith",location:"0.3 miles away",deliveryFee:6.99,rating:4.9,totalReviews:203,profilePhoto:"/2.png",about:"Friendly and reliable fuel delivery expert. Known for her attention to detail and exceptional customer service. Always ensures safe and clean fuel delivery."}];return er.find(dr=>dr.id===tr)||er[0]},Dt=()=>[{id:"review-1",rating:5,comment:"Excellent service! Very professional and quick delivery.",createdAt:"2024-01-15T10:30:00Z",userName:"John D.",userAvatar:"/avatar.png"},{id:"review-2",rating:5,comment:"Great experience! Friendly and efficient service.",createdAt:"2024-01-14T14:20:00Z",userName:"Sarah M.",userAvatar:"/avatar-female.png"},{id:"review-3",rating:4,comment:"Good service, arrived on time as promised.",createdAt:"2024-01-13T09:15:00Z",userName:"Mike R.",userAvatar:"/avatar-male.png"},{id:"review-4",rating:5,comment:"Outstanding service! Very professional and courteous.",createdAt:"2024-01-12T16:45:00Z",userName:"Emily S.",userAvatar:"/avatar-female-2.png"},{id:"review-5",rating:4,comment:"Reliable and quick. Would recommend!",createdAt:"2024-01-11T11:30:00Z",userName:"David L.",userAvatar:"/avatar.png"}],It=()=>{const tr={5:0,4:0,3:0,2:0,1:0};ct.forEach(dr=>{tr[dr.rating]++});const er=ct.length||1;return Object.entries(tr).reverse().map(([dr,mr])=>({rating:parseInt(dr),percentage:Math.round(mr/er*100)}))},Mt=async()=>{if(!(!At.rating||!At.comment.trim()||!(j!=null&&j.id))){zt(!0);try{await apiAddReview({customerId:j.id,fuelFriendId:e,rating:At.rating,comment:At.comment});const tr=await apiGetFuelFriendReviews(e);c(tr),Nt({rating:0,comment:""})}catch(tr){console.error("Failed to submit review:",tr)}finally{zt(!1)}}};if(pt)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx("div",{className:"w-6 h-6 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-24 h-5 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-6"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-6 text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-300 rounded-full mx-auto mb-4 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-32 h-6 bg-gray-300 rounded mx-auto mb-2 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-40 h-4 bg-gray-300 rounded mx-auto mb-2 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-28 h-4 bg-gray-300 rounded mx-auto animate-pulse"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-5 bg-gray-300 rounded mb-3 animate-pulse"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsx("div",{className:"w-full h-3 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-5/6 h-3 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-4/5 h-3 bg-gray-300 rounded animate-pulse"})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-40 h-5 bg-gray-300 rounded mb-4 animate-pulse"}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-6 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-8 bg-gray-300 rounded mb-2 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-16 h-3 bg-gray-300 rounded mb-1 animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-20 h-3 bg-gray-300 rounded animate-pulse"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 space-y-2",children:[1,2,3,4,5].map(tr=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-2 bg-gray-300 rounded animate-pulse"}),jsxRuntimeExports.jsx("div",{className:"w-8 h-3 bg-gray-300 rounded animate-pulse"})]},tr))})]})]})]})});if(St||!_e)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center min-h-screen",children:jsxRuntimeExports.jsx("p",{className:"text-red-500",children:St||"Fuel friend not found"})})});const Ht=It();return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>i(-1),className:"p-2 hover:bg-gray-100 rounded-full",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold",children:"Fuel friend"}),jsxRuntimeExports.jsx("div",{className:"w-9"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 py-6 text-center",children:[jsxRuntimeExports.jsxs("div",{className:"relative inline-block mb-4",children:[jsxRuntimeExports.jsx("img",{src:_e.profilePhoto||"/fuel friend.png",alt:_e.fullName,className:"w-24 h-24 rounded-full object-cover mx-auto",onError:tr=>{tr.currentTarget.src="/fuel friend.png"}}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-1 right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-white"})]}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:_e.fullName}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center space-x-4 mb-2",children:[jsxRuntimeExports.jsxs("span",{className:"text-lg font-semibold",children:["$",_e.deliveryFee]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Star,{className:"w-4 h-4 text-yellow-500 fill-current mr-1"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:_e.rating}),jsxRuntimeExports.jsxs("span",{className:"text-gray-600 ml-1",children:["(",_e.totalReviews,")"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center text-gray-600",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 mr-1 text-red-500"}),jsxRuntimeExports.jsx("span",{children:_e.location})]})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"About"}),jsxRuntimeExports.jsx("p",{className:"text-gray-700 text-sm leading-relaxed",children:_e.about||"No description available."})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Rating and Reviews"}),jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-6 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"text-3xl font-bold text-gray-900",children:_e.rating}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center mb-1",children:[1,2,3,4,5].map(tr=>jsxRuntimeExports.jsx(Star,{className:`w-4 h-4 ${tr<=Math.floor(_e.rating)?"text-yellow-500 fill-current":"text-gray-300"}`},tr))}),jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-600",children:[_e.totalReviews," All ratings"]})]}),jsxRuntimeExports.jsx("div",{className:"flex-1",children:Ht.map(({rating:tr,percentage:er})=>jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[jsxRuntimeExports.jsx("span",{className:"text-sm w-2",children:tr}),jsxRuntimeExports.jsx(Star,{className:"w-3 h-3 text-yellow-500 fill-current"}),jsxRuntimeExports.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2",children:jsxRuntimeExports.jsx("div",{className:"bg-yellow-500 h-2 rounded-full",style:{width:`${er}%`}})}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-600 w-8",children:[er,"%"]})]},tr))})]}),jsxRuntimeExports.jsxs("div",{className:"border border-gray-200 rounded-lg p-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Add review"}),jsxRuntimeExports.jsx("div",{className:"flex space-x-1",children:[1,2,3,4,5].map(tr=>jsxRuntimeExports.jsx(Star,{className:`w-5 h-5 cursor-pointer ${tr<=At.rating?"text-yellow-500 fill-current":"text-gray-300"}`,onClick:()=>Nt(er=>({...er,rating:tr}))},tr))})]}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Your review here",value:At.comment,onChange:tr=>Nt(er=>({...er,comment:tr.target.value})),className:"w-full text-sm text-gray-600 bg-transparent border-none outline-none mb-3"}),jsxRuntimeExports.jsx("div",{className:"flex justify-end",children:jsxRuntimeExports.jsx("button",{onClick:Mt,disabled:!At.rating||!At.comment.trim()||Vt,className:"bg-green-500 text-white px-6 py-2 rounded-full text-sm font-medium disabled:bg-gray-300",children:Vt?"Adding...":"Add"})})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:ct.slice(0,2).map(tr=>jsxRuntimeExports.jsxs("div",{className:"border-b border-gray-100 pb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:tr.userName}),jsxRuntimeExports.jsx("div",{className:"flex",children:[1,2,3,4,5].map(er=>jsxRuntimeExports.jsx(Star,{className:`w-3 h-3 ${er<=tr.rating?"text-yellow-500 fill-current":"text-gray-300"}`},er))}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:formatTimeAgo(tr.createdAt)})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-700",children:tr.comment})]},tr.id))}),ct.length>2&&jsxRuntimeExports.jsx("button",{className:"text-gray-600 text-sm mt-4",children:"Read More"})]}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Contact"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{alert(`Calling ${_e.fullName}...`)},className:"flex items-center justify-center space-x-2 bg-green-500 text-white py-3 rounded-full font-medium",children:[jsxRuntimeExports.jsx(Phone,{size:20}),jsxRuntimeExports.jsx("span",{children:"Call"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{alert(`Messaging ${_e.fullName}...`)},className:"flex items-center justify-center space-x-2 bg-gray-100 text-gray-800 py-3 rounded-full font-medium",children:[jsxRuntimeExports.jsx(MessageCircle,{size:20}),jsxRuntimeExports.jsx("span",{children:"Message"})]})]})]}),jsxRuntimeExports.jsx("div",{className:"px-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>{alert(`Getting directions to ${_e.fullName}...`)},className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx(Navigation,{size:24,className:"text-gray-600 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-700",children:"Directions"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{alert(`${_e.fullName} is available now!`)},className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx(Clock,{size:24,className:"text-gray-600 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-700",children:"Availability"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>{alert(`${_e.fullName} is verified!`)},className:"flex flex-col items-center justify-center p-3 bg-gray-50 rounded-xl",children:[jsxRuntimeExports.jsx(CircleCheckBig,{size:24,className:"text-green-500 mb-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-700",children:"Verified"})]})]})}),jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:jsxRuntimeExports.jsx("button",{onClick:()=>{var tr;(tr=d.state)!=null&&tr.stationId?i(`/station/${d.state.stationId}`,{state:{selectedFuelFriend:_e,cartItems:d.state.cartItems,station:d.state.station}}):i(-1)},className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold",children:"Select Fuel friend"})})]})})},AddressAutocomplete=({value:e,onChange:i,placeholder:d="Enter your address",className:j=""})=>{const[_e,nt]=reactExports.useState([]),[ct,c]=reactExports.useState(!1),[pt,gt]=reactExports.useState(!1),St=reactExports.useRef(null),kt=reactExports.useRef(null),Nt=(()=>{try{return"pk.your_mapbox_access_token_here"}catch{return"pk.eyJ1IjoidmluYTk4IiwiYSI6ImNtN3I3eDF6ZTB2OW0yam9kdzFxdndhdTkifQ.HNqbNgBUAoBPYmoAMISdaw"}})(),Vt=async Mt=>{if(Mt.length<3){nt([]),c(!1);return}gt(!0);try{const tr=await(await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(Mt)}.json?access_token=${Nt}&country=ID&language=id&limit=5&types=address,poi`)).json();tr.features&&(nt(tr.features),c(!0))}catch(Ht){console.error("Error searching address:",Ht),nt([])}finally{gt(!1)}},zt=Mt=>{const Ht=Mt.target.value;i(Ht),Vt(Ht)},Jt=Mt=>{var Ht;i(Mt.place_name),nt([]),c(!1),(Ht=St.current)==null||Ht.blur()},Dt=()=>{setTimeout(()=>{c(!1)},200)},It=()=>{_e.length>0&&c(!0)};return jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{ref:St,type:"text",value:e,onChange:zt,onFocus:It,onBlur:Dt,className:`w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ${j}`,placeholder:d}),ct&&_e.length>0&&jsxRuntimeExports.jsx("div",{ref:kt,className:"absolute top-full left-0 right-0 bg-white border border-gray-200 rounded-2xl shadow-lg z-50 mt-1 max-h-60 overflow-y-auto",children:_e.map(Mt=>jsxRuntimeExports.jsxs("button",{onClick:()=>Jt(Mt),className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-start space-x-3 border-b border-gray-100 last:border-b-0",children:[jsxRuntimeExports.jsx(MapPin,{className:"w-4 h-4 text-gray-400 mt-0.5 flex-shrink-0"}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-700 leading-relaxed",children:Mt.place_name})]},Mt.id))}),pt&&jsxRuntimeExports.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-green-500"})})]})},SERVICE_FEES={car:3.99,suv:4.99,nonSubscriberAdditionalFee:5},VAT_RATE=.1,CheckoutBreakdownComponent=({breakdown:e,isNonSubscriber:i,vehicleType:d})=>{if(!e)return null;const j=d==="car"?SERVICE_FEES.car:SERVICE_FEES.suv;return jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 space-y-3",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Order Summary"}),e.fuelCost!==void 0&&e.fuelCost!==null&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Fuel Cost"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",e.fuelCost.toFixed(2)]})]}),e.convenienceItemsCost&&e.convenienceItemsCost>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Convenience Items"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",e.convenienceItemsCost.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-600",children:["Service Fee (",d==="car"?"Car":"SUV/Truck",")"]}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",j.toFixed(2)]})]}),i&&e.nonSubscriberFee&&e.nonSubscriberFee>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Non-Subscriber Fee"}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-orange-600",children:["+$",e.nonSubscriberFee.toFixed(2)]})]}),e.subscriptionPlan&&e.subscriptionPlan.price&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-600",children:[e.subscriptionPlan.name," (Monthly)"]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-green-600",children:["$",e.subscriptionPlan.price.toFixed(2)]})]}),e.additionalVehicles&&e.additionalVehicleCost&&e.additionalVehicles>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-600",children:["Additional Vehicles (",e.additionalVehicles,")"]}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",e.additionalVehicleCost.toFixed(2)]})]}),e.vat&&e.vat>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"VAT (10% on convenience items)"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",e.vat.toFixed(2)]})]}),e.tip&&e.tip>0&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between text-sm",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Tip for Fuel Friend"}),jsxRuntimeExports.jsxs("span",{className:"font-medium",children:["$",e.tip.toFixed(2)]})]}),i&&e.nonSubscriberFee&&e.nonSubscriberFee>0&&jsxRuntimeExports.jsx("div",{className:"border border-gray-200 rounded-2xl p-3 mt-3 bg-white",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"mt-0.5 flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("p",{className:"text-gray-800 font-medium text-sm",children:["Save $",e.nonSubscriberFee.toFixed(2)," on this order"]}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-xs mt-0.5",children:"Subscribe to remove the non-subscriber fee"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"text-xs text-gray-500 mt-4",children:[jsxRuntimeExports.jsxs("p",{className:"mb-1",children:[jsxRuntimeExports.jsx("strong",{children:"Service Fees:"})," $",SERVICE_FEES.car.toFixed(2)," for cars, $",SERVICE_FEES.suv.toFixed(2)," for SUVs/trucks"]}),jsxRuntimeExports.jsxs("p",{className:"mb-1",children:[jsxRuntimeExports.jsx("strong",{children:"Payment Processing:"})," Service fees are held for 12 hours before approval"]}),jsxRuntimeExports.jsxs("p",{children:[jsxRuntimeExports.jsx("strong",{children:"VAT:"})," 10% applies to convenience store items only"]})]})]})},TipSelector=({onTipChange:e,initialTip:i=0})=>{const[d,j]=reactExports.useState(i),[_e,nt]=reactExports.useState(i>=2?i.toString():""),ct=[2,5,10,15],c=gt=>{j(gt),nt(""),e(gt)},pt=gt=>{nt(gt);const St=parseFloat(gt);!isNaN(St)&&St>=2?(j(St),e(St)):gt===""&&(j(0),e(0))};return jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-3xl p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center mb-3",children:[jsxRuntimeExports.jsx(DollarSign,{className:"w-5 h-5 text-gray-600 mr-2"}),jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900",children:"Tip for Fuel Friend"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Thank your Fuel Friend for excellent service (minimum $2)"}),jsxRuntimeExports.jsx("div",{className:"grid grid-cols-4 gap-2 mb-4",children:ct.map(gt=>jsxRuntimeExports.jsxs(TapEffectButton,{onClick:()=>c(gt),className:`py-2 rounded-2xl font-medium transition-colors ${d===gt&&_e===""?"bg-green-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:["$",gt]},gt))}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-500",children:"$"}),jsxRuntimeExports.jsx("input",{type:"number",min:"2",step:"0.01",placeholder:"Custom amount",value:_e,onChange:gt=>pt(gt.target.value),className:"w-full pl-8 pr-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ios-input"})]}),d>0&&jsxRuntimeExports.jsx("div",{className:"mt-3 p-3 bg-gray-50 border border-gray-200 rounded-2xl",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-700",children:[jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Tip added:"})," $",d.toFixed(2)]})]})})]})},useCheckoutCalculation=({fuelCost:e,convenienceItemsCost:i,vehicleType:d,subscriptionPlan:j,additionalVehicles:_e=0,tip:nt=0,isNonSubscriber:ct})=>reactExports.useMemo(()=>{const c=d==="car"?SERVICE_FEES.car:SERVICE_FEES.suv;let pt=0;pt=SERVICE_FEES.nonSubscriberAdditionalFee;let gt=0;j&&(gt=j.price);let St=0;_e>0&&j&&(St=_e*j.additionalVehiclePrice);const kt=i*VAT_RATE,At=e+i+c+pt+gt+St+kt+nt;return isNaN(At)?(console.error("Total calculation resulted in NaN",{fuelCost:e,convenienceItemsCost:i,serviceFee:c,nonSubscriberFee:pt,subscriptionCost:gt,additionalVehicleCost:St,vat:kt,tip:nt}),{fuelCost:isNaN(e)?0:e,convenienceItemsCost:isNaN(i)?0:i,serviceFee:isNaN(c)?0:c,nonSubscriberFee:isNaN(pt)?0:pt,subscriptionPlan:j,additionalVehicles:_e>0?_e:void 0,additionalVehicleCost:St>0?isNaN(St)?0:St:void 0,vat:isNaN(kt)?0:kt,total:0,tip:nt>0?isNaN(nt)?0:nt:void 0}):{fuelCost:e,convenienceItemsCost:i,serviceFee:c,nonSubscriberFee:pt,subscriptionPlan:j,additionalVehicles:_e>0?_e:void 0,additionalVehicleCost:St>0?St:void 0,vat:kt,total:At,tip:nt>0?nt:void 0}},[e,i,d,j,_e,nt,ct]),CheckoutScreen=()=>{var Cn,On,qr,Zs,Os,Us,Nn;const e=useNavigate(),i=useLocation(),{user:d,isAuthenticated:j}=useAppContext();console.log(" CheckoutScreen - Component mounted"),console.log(" CheckoutScreen - isAuthenticated:",j),console.log(" CheckoutScreen - user:",d),console.log(" CheckoutScreen - location.state:",i.state);const[_e,nt]=reactExports.useState(1),[ct,c]=reactExports.useState(!1),[pt,gt]=reactExports.useState(!1),[St,kt]=reactExports.useState(16),[At,Nt]=reactExports.useState("12:45 am"),[Vt,zt]=reactExports.useState("February"),[Jt,Dt]=reactExports.useState(),[It,Mt]=reactExports.useState(0),[Ht,tr]=reactExports.useState(0),[er,dr]=reactExports.useState(!1),[mr,Ur]=reactExports.useState(!1),[Dr,Yr]=reactExports.useState("instant"),es=cn=>{Yr(cn),dr(!1),cn==="schedule"?Ur(!0):$r(Bn=>({...Bn,deliveryTime:"Instant (15-20 mins)"}))},ms=Array.from({length:28},(cn,Bn)=>Bn+1),Ms=["S","M","T","W","T","F","S"],Kr=!0,xr=((Cn=i.state)==null?void 0:Cn.station)||{id:"default-station",name:"Default Fuel Station",address:"Station Address",fuelPrices:{regular:3.29,premium:3.79,diesel:3.59},regularPrice:3.29},jr=((On=i.state)==null?void 0:On.cartItems)||[],rr=((qr=i.state)==null?void 0:qr.selectedFuelFriend)||{id:"default-friend",name:"Fuel Friend",avatarUrl:"/fuel friend.png"};console.log("CheckoutScreen - location.state:",i.state),console.log("CheckoutScreen - station:",xr),console.log("CheckoutScreen - cartItems:",jr),console.log("CheckoutScreen - selectedFuelFriend:",rr);const[ar,$r]=reactExports.useState({address:"",phoneNumber:"",vehicleColor:"",vehicleBrand:"",fuelType:"Regular",quantity:"10 liters",deliveryTime:"15-20 mins",numberPlate:""}),Ar=xr?parseFloat(((Zs=xr.fuelPrices)==null?void 0:Zs.regular)||xr.regularPrice||"3.29")*parseFloat(((Os=ar==null?void 0:ar.quantity)==null?void 0:Os.replace(" liters",""))||"10"):32.9,Xr=jr.reduce((cn,Bn)=>{const Pn=typeof Bn.price=="string"?parseFloat(Bn.price):Bn.price;return cn+(isNaN(Pn)?0:Pn*Bn.quantity)},0),us=(Us=ar.fuelType)!=null&&Us.toLowerCase().includes("suv")||(Nn=ar.fuelType)!=null&&Nn.toLowerCase().includes("truck")?"suv":"car",Wr=useCheckoutCalculation({fuelCost:Ar,convenienceItemsCost:Xr,vehicleType:us,subscriptionPlan:Jt,additionalVehicles:Ht,tip:It,isNonSubscriber:Kr}),Vs=cn=>{Dt(cn)},yn=cn=>{Mt(cn)},_n=(cn,Bn)=>{$r(Pn=>({...Pn,[cn]:Bn}))};reactExports.useEffect(()=>{if(console.log(" CheckoutScreen - Auth check - isAuthenticated:",j),!j){console.log(" CheckoutScreen - Not authenticated, redirecting to login"),localStorage.setItem("redirectAfterLogin","/checkout"),e("/login");return}},[j,e]),reactExports.useEffect(()=>{d&&$r(cn=>({...cn,address:(d==null?void 0:d.address)||(d==null?void 0:d.city)||"",phoneNumber:(d==null?void 0:d.phone)||""}))},[d]);const zo=()=>{if(console.log(" Checkout - Save & Continue clicked"),console.log(" Checkout - formData:",ar),console.log(" Checkout - station:",xr),console.log(" Checkout - cartItems:",jr),console.log(" Checkout - selectedFuelFriend:",rr),console.log(" Checkout - user:",d),!ar.address||ar.address.trim()===""){alert("Please enter your delivery address");return}if(!ar.phoneNumber||ar.phoneNumber.trim()===""){alert("Please enter your phone number");return}e("/order-summary",{state:{formData:ar,station:xr,cartItems:jr,selectedFuelFriend:rr,user:d,subscriptionPlan:Jt,tip:It,additionalVehicles:Ht,breakdown:Wr}})};return j?jsxRuntimeExports.jsxs(AnimatedPage,{children:[jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e(-1),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Checkout"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center space-x-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${_e>=1?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:"1"}),jsxRuntimeExports.jsx("span",{className:`ml-2 text-sm ${_e>=1?"text-green-500 font-medium":"text-gray-500"}`,children:"Order"})]}),jsxRuntimeExports.jsx("div",{className:`w-12 h-0.5 ${_e>=2?"bg-green-500":"bg-gray-300"}`}),jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${_e>=2?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:"2"}),jsxRuntimeExports.jsx("span",{className:`ml-2 text-sm ${_e>=2?"text-green-500 font-medium":"text-gray-500"}`,children:"Order Summary"})]}),jsxRuntimeExports.jsx("div",{className:`w-12 h-0.5 ${_e>=3?"bg-green-500":"bg-gray-300"}`}),jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${_e>=3?"bg-green-500 text-white":"bg-gray-200 text-gray-500"}`,children:"3"}),jsxRuntimeExports.jsx("span",{className:`ml-2 text-sm ${_e>=3?"text-green-500 font-medium":"text-gray-500"}`,children:"Payment"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 pb-32",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Delivery Information"}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Delivery Address"}),jsxRuntimeExports.jsx(AddressAutocomplete,{value:ar.address,onChange:cn=>_n("address",cn),placeholder:"Enter your delivery address"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Phone Number"}),jsxRuntimeExports.jsx("input",{type:"tel",value:ar.phoneNumber,onChange:cn=>_n("phoneNumber",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Enter your phone number"})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Delivery Time"}),jsxRuntimeExports.jsxs(TapEffectButton,{onClick:()=>dr(!0),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent text-left flex items-center justify-between mobile-button",children:[jsxRuntimeExports.jsx("span",{children:Dr==="schedule"?`${St} Feb, ${At}`:ar.deliveryTime}),jsxRuntimeExports.jsx(ChevronDown,{className:"w-4 h-4 text-gray-400"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Vehicle Information"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Vehicle Color"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar.vehicleColor,onChange:cn=>_n("vehicleColor",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent",placeholder:"Color"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Vehicle Brand"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar.vehicleBrand,onChange:cn=>_n("vehicleBrand",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ios-input",placeholder:"Brand"})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Fuel Type"}),jsxRuntimeExports.jsxs("select",{value:ar.fuelType,onChange:cn=>_n("fuelType",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ios-input",children:[jsxRuntimeExports.jsx("option",{value:"Regular",children:"Regular"}),jsxRuntimeExports.jsx("option",{value:"Premium",children:"Premium"}),jsxRuntimeExports.jsx("option",{value:"Diesel",children:"Diesel"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"Quantity"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar.quantity,onChange:cn=>_n("quantity",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ios-input",placeholder:"Quantity"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("label",{className:"block text-gray-700 text-sm font-medium mb-2",children:"License Plate"}),jsxRuntimeExports.jsx("input",{type:"text",value:ar.numberPlate,onChange:cn=>_n("numberPlate",cn.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent ios-input",placeholder:"Enter license plate"})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Subscription Plans"}),jsxRuntimeExports.jsx(SubscriptionPlans,{selectedPlan:Jt==null?void 0:Jt.id,onPlanSelect:Vs})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Add Tip for Fuel Friend"}),jsxRuntimeExports.jsx(TipSelector,{initialTip:It,onTipChange:yn})]}),jsxRuntimeExports.jsx("div",{className:"mb-6",children:jsxRuntimeExports.jsx(CheckoutBreakdownComponent,{breakdown:Wr,isNonSubscriber:Kr,vehicleType:us})})]}),jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:zo,className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold hover:bg-green-600 transition-all duration-200 mobile-button haptic-button",style:{borderRadius:"9999px"},children:"Save & Continue"})})]}),er&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in",style:{zIndex:6e3},children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-in relative",children:[jsxRuntimeExports.jsx("button",{onClick:()=>dr(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-center text-gray-900 mb-6",children:"Select order type"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>es("instant"),className:"w-full py-4 bg-[#3AC36C] text-white rounded-full font-semibold flex items-center justify-center gap-2 hover:bg-[#2ea85a] transition-all shadow-md",children:[jsxRuntimeExports.jsx(Zap,{className:"w-5 h-5 fill-white"}),"Instant order"]}),jsxRuntimeExports.jsxs("button",{onClick:()=>es("schedule"),className:"w-full py-4 bg-white border border-gray-200 text-gray-900 rounded-full font-semibold flex items-center justify-center gap-2 hover:border-[#3AC36C] hover:text-[#3AC36C] transition-all shadow-sm",children:[jsxRuntimeExports.jsx(Clock,{className:"w-5 h-5"}),"Schedule Order"]})]})]})}),mr&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 animate-fade-in",style:{zIndex:6001},children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-2xl animate-scale-in relative",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("button",{className:"p-1 rounded-full hover:bg-gray-100",children:jsxRuntimeExports.jsx(ChevronLeft,{className:"w-5 h-5 text-[#3AC36C]"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"February"}),jsxRuntimeExports.jsx("button",{className:"p-1 rounded-full hover:bg-gray-100",children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-5 h-5 text-[#3AC36C]"})})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("div",{className:"grid grid-cols-7 mb-2",children:Ms.map(cn=>jsxRuntimeExports.jsx("div",{className:"text-center text-xs font-semibold text-gray-500 py-1",children:cn},cn))}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-7 gap-y-2",children:[jsxRuntimeExports.jsx("div",{}),ms.map(cn=>jsxRuntimeExports.jsx("div",{className:"flex justify-center",children:jsxRuntimeExports.jsx("button",{onClick:()=>kt(cn),className:`w-8 h-8 flex items-center justify-center rounded-full text-sm font-medium transition-all ${St===cn?"bg-[#3AC36C] text-white shadow-md":"text-gray-700 hover:bg-gray-100"}`,children:cn})},cn))]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"relative flex-1",children:[jsxRuntimeExports.jsxs("select",{value:At,onChange:cn=>Nt(cn.target.value),className:"w-full appearance-none pl-4 pr-10 py-3 border border-gray-300 rounded-full text-gray-700 focus:outline-none focus:border-[#3AC36C] bg-white",children:[jsxRuntimeExports.jsx("option",{children:"12:45 am"}),jsxRuntimeExports.jsx("option",{children:"1:00 am"}),jsxRuntimeExports.jsx("option",{children:"1:15 am"}),jsxRuntimeExports.jsx("option",{children:"9:00 am"}),jsxRuntimeExports.jsx("option",{children:"12:00 pm"}),jsxRuntimeExports.jsx("option",{children:"3:00 pm"}),jsxRuntimeExports.jsx("option",{children:"6:00 pm"})]}),jsxRuntimeExports.jsx(ChevronDown,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]}),jsxRuntimeExports.jsx("button",{onClick:()=>{Ur(!1),$r(cn=>({...cn,deliveryTime:`${St} Feb, ${At}`}))},className:"flex-1 bg-[#3AC36C] text-white font-semibold py-3 rounded-full hover:bg-[#2ea85a] transition-all shadow-md",children:"Schedule"})]})]})})]}):jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Redirecting to login..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"})]})})},CallModal=({isOpen:e,onClose:i,phoneNumber:d,driverName:j})=>{if(React.useEffect(()=>(e&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow="auto"}),[e]),!e)return null;const _e=()=>{window.location.href=`tel:${d}`,i()};return jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[9999] p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Call Driver"}),jsxRuntimeExports.jsx("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:jsxRuntimeExports.jsx(X,{size:20,className:"text-gray-500"})})]}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3",children:jsxRuntimeExports.jsx(Phone,{size:24,className:"text-green-600"})}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-2",children:"You're about to call"}),jsxRuntimeExports.jsx("p",{className:"text-xl font-semibold text-gray-900",children:j}),jsxRuntimeExports.jsx("p",{className:"text-gray-500",children:d})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"flex-1 py-3 px-4 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsxs("button",{onClick:_e,className:"flex-1 py-3 px-4 bg-green-500 text-white rounded-lg font-medium hover:bg-green-600 transition-colors flex items-center justify-center gap-2",children:[jsxRuntimeExports.jsx(Phone,{size:18}),"Call"]})]})]})})},ChatModal=({isOpen:e,onClose:i,driverName:d,driverAvatar:j,driverPhone:_e,onCall:nt})=>{console.log("ChatModal render - isOpen:",e);const[ct,c]=reactExports.useState(""),[pt,gt]=reactExports.useState([{id:1,text:"Hello! I've arrived and I'm waiting for your pickup.",sender:"driver",time:"Just now"}]),St=reactExports.useRef(null),kt=()=>{var Nt;(Nt=St.current)==null||Nt.scrollIntoView({behavior:"smooth"})};if(reactExports.useEffect(()=>(kt(),e&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow="auto"}),[pt,e]),!e)return console.log("ChatModal: Not rendering because isOpen is false"),null;console.log("ChatModal: Rendering because isOpen is true");const At=()=>{ct.trim()&&(gt([...pt,{id:Date.now(),text:ct,sender:"user",time:"Now"}]),c(""))};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-[99998]"}),jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 bg-[#F8F9FA] z-[99999] flex flex-col animate-slide-up",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white px-4 py-3 shadow-sm flex items-center justify-between border-b border-gray-100 space-x-3 z-10",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"p-2 -ml-2 hover:bg-gray-50 rounded-full transition-colors active:scale-95",children:jsxRuntimeExports.jsx(X,{className:"w-6 h-6 text-gray-600"})}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("img",{src:j,className:"w-10 h-10 rounded-full object-cover border border-gray-100",alt:"Driver"}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-gray-900 leading-tight",children:d}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 font-medium bg-green-50 px-2 py-0.5 rounded-full inline-block mt-0.5",children:"Online"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:nt,className:"p-2.5 bg-green-50 text-green-600 rounded-full hover:bg-green-100 transition-colors active:scale-95",title:"Call FuelFriend",children:jsxRuntimeExports.jsx(Phone,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 rounded-full",children:jsxRuntimeExports.jsx(EllipsisVertical,{className:"w-5 h-5"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6 bg-[#F8F9FA]",children:[jsxRuntimeExports.jsx("div",{className:"text-center",children:jsxRuntimeExports.jsx("span",{className:"text-xs font-medium text-gray-400 bg-gray-100 px-3 py-1 rounded-full",children:"Today"})}),pt.map(Nt=>jsxRuntimeExports.jsx("div",{className:`flex ${Nt.sender==="user"?"justify-end":"justify-start"} animate-scale-in`,children:jsxRuntimeExports.jsxs("div",{className:`max-w-[75%] shadow-sm px-4 py-3 ${Nt.sender==="user"?"bg-[#3AC36C] text-white rounded-2xl rounded-tr-sm":"bg-white text-gray-800 rounded-2xl rounded-tl-sm border border-gray-100"}`,children:[jsxRuntimeExports.jsx("p",{className:"text-[15px] leading-relaxed",children:Nt.text}),jsxRuntimeExports.jsx("span",{className:`text-[10px] mt-1 block text-right font-medium ${Nt.sender==="user"?"text-green-100":"text-gray-400"}`,children:Nt.time})]})},Nt.id)),jsxRuntimeExports.jsx("div",{ref:St})]}),jsxRuntimeExports.jsx("div",{className:"bg-white p-3 border-t border-gray-100 safe-area-bottom mb-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3 bg-gray-50 rounded-[28px] px-4 py-3 border border-gray-100 focus-within:border-green-200 focus-within:ring-2 focus-within:ring-green-100 transition-all",children:[jsxRuntimeExports.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:jsxRuntimeExports.jsx(Image$1,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("input",{type:"text",value:ct,onChange:Nt=>c(Nt.target.value),placeholder:"Message...",className:"flex-1 bg-transparent border-none focus:ring-0 text-gray-900 placeholder-gray-400 text-[15px]",onKeyPress:Nt=>Nt.key==="Enter"&&At()}),ct.trim()?jsxRuntimeExports.jsx("button",{onClick:At,className:"p-2.5 bg-[#3AC36C] text-white rounded-full shadow-md hover:bg-[#2ea85a] transform transition-all active:scale-95",children:jsxRuntimeExports.jsx(Send,{className:"w-5 h-5 ml-0.5"})}):jsxRuntimeExports.jsx("button",{className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:jsxRuntimeExports.jsx(Mic,{className:"w-6 h-6"})})]})})]})]})};mapboxgl.accessToken="pk.your_mapbox_access_token_here";const TrackOrderScreen=()=>{var yn,_n,zo,Cn,On;const e=useNavigate(),{orderId:i}=useParams(),d=useLocation(),{user:j,token:_e}=useAppContext(),nt=(yn=d.state)==null?void 0:yn.selectedOrder,ct=sessionStorage.getItem("lastOrder"),c=ct?JSON.parse(ct):null,[pt,gt]=reactExports.useState(nt||c||null),[St,kt]=reactExports.useState(!nt&&!c),[At,Nt]=reactExports.useState(!1),[Vt,zt]=reactExports.useState(!1),[Jt,Dt]=reactExports.useState(!1);console.log("TrackOrderScreen render - showChatModal:",Vt,"showCallModal:",At);const[It,Mt]=reactExports.useState(60),[Ht,tr]=reactExports.useState(!1),[er,dr]=reactExports.useState(0),[mr,Ur]=reactExports.useState(60),Dr=reactExports.useRef(null),Yr=reactExports.useRef(null),es=reactExports.useRef(null),[ms,Ms]=reactExports.useState(!1),Kr=qr=>{if(qr){const Zs=["+44 7723 489201","+44 7845 167392","+44 7398 521047","+44 7561 834729","+44 7924 605813","+44 7481 932650","+44 7650 271846","+44 7136 849502"];return Zs[Math.floor(Math.random()*Zs.length)]}else{const Zs=["+1 (347) 823-4916","+1 (619) 357-8204","+1 (415) 902-7531","+1 (713) 648-2905","+1 (212) 579-3648","+1 (310) 846-1729","+1 (404) 731-9652","+1 (512) 284-6037"];return Zs[Math.floor(Math.random()*Zs.length)]}},xr=qr=>{var Os,Us,Nn,cn,Bn,Pn;if(console.log("getDriverData called with:",qr),qr!=null&&qr.fuelfriend){const Ro=((Os=j==null?void 0:j.city)==null?void 0:Os.toLowerCase().includes("london"))||((Us=j==null?void 0:j.city)==null?void 0:Us.toLowerCase().includes("uk"))||((Nn=j==null?void 0:j.city)==null?void 0:Nn.toLowerCase().includes("england"));return{name:qr.fuelfriend.name||"James Michell",location:qr.fuelfriend.location||qr.deliveryAddress||"Waiting for pickup",phone:qr.fuelfriend.phone||Kr(Ro),avatar:qr.fuelfriend.avatar||"/fuel friend.png"}}if(console.log("User data:",j),((cn=j==null?void 0:j.city)==null?void 0:cn.toLowerCase().includes("london"))||((Bn=j==null?void 0:j.city)==null?void 0:Bn.toLowerCase().includes("uk"))||((Pn=j==null?void 0:j.city)==null?void 0:Pn.toLowerCase().includes("england"))){const Ro=[{name:"James Michell",phone:"+44 7723 489201"},{name:"Robert Johnson",phone:"+44 7845 167392"},{name:"Michael Williams",phone:"+44 7398 521047"},{name:"William Brown",phone:"+44 7561 834729"},{name:"David Wilson",phone:"+44 7924 605813"},{name:"Richard Taylor",phone:"+44 7481 932650"},{name:"Charles Davies",phone:"+44 7650 271846"},{name:"Joseph Evans",phone:"+44 7136 849502"}],Ho=Ro[Math.floor(Math.random()*Ro.length)];return{name:Ho.name,location:(qr==null?void 0:qr.deliveryAddress)||"Waiting for pickup",phone:Ho.phone,avatar:"/fuel friend.png"}}else{const Ro=[{name:"James Michell",phone:"+1 (347) 823-4916"},{name:"Robert Johnson",phone:"+1 (619) 357-8204"},{name:"Michael Williams",phone:"+1 (415) 902-7531"},{name:"William Brown",phone:"+1 (713) 648-2905"},{name:"David Wilson",phone:"+1 (212) 579-3648"},{name:"Richard Taylor",phone:"+1 (310) 846-1729"},{name:"Charles Davies",phone:"+1 (404) 731-9652"},{name:"Joseph Evans",phone:"+1 (512) 284-6037"}],Ho=Ro[Math.floor(Math.random()*Ro.length)];return{name:Ho.name,location:(qr==null?void 0:qr.deliveryAddress)||"Waiting for pickup",phone:Ho.phone,avatar:"/fuel friend.png"}}},jr=qr=>{tr(!0),dr(qr.touches[0].clientY),Ur(It)},rr=qr=>{if(!Ht)return;const Zs=qr.touches[0].clientY,Os=er-Zs,Us=window.innerHeight,Nn=Os/Us*100;let cn=mr+Nn;cn=Math.max(20,Math.min(85,cn)),Mt(cn)},ar=()=>{tr(!1),It<35?Mt(20):It>70?Mt(85):Mt(60)};reactExports.useEffect(()=>{var Pn,Ro,Ho,Zn,Qo,Wo,uo;(()=>{if(c&&(j!=null&&j.id)){const eo=JSON.parse(localStorage.getItem(`userOrders_${j.id}`)||"[]");if(!eo.some(Io=>Io.trackingNumber===c.trackingNumber)){const Io={...c,id:c.orderId||`order_${Date.now()}`,status:"ongoing",createdAt:new Date().toISOString()};eo.unshift(Io),localStorage.setItem(`userOrders_${j.id}`,JSON.stringify(eo)),console.log(" Order auto-saved to My Orders:",Io.trackingNumber)}}})();const Zs=((Pn=j==null?void 0:j.city)==null?void 0:Pn.toLowerCase().includes("london"))||((Ro=j==null?void 0:j.city)==null?void 0:Ro.toLowerCase().includes("uk"))||((Ho=j==null?void 0:j.city)==null?void 0:Ho.toLowerCase().includes("england"))||((Zn=j==null?void 0:j.city)==null?void 0:Zn.toLowerCase().includes("scotland"))||((Qo=j==null?void 0:j.city)==null?void 0:Qo.toLowerCase().includes("manchester"))||((Wo=j==null?void 0:j.city)==null?void 0:Wo.toLowerCase().includes("birmingham"))||((uo=j==null?void 0:j.city)==null?void 0:uo.toLowerCase().includes("ireland")),Os=Zs?"London, UK":"New York, USA",Us=Zs?"Shell Station London":"Shell Station New York",Nn=Zs?"":"$",cn=Zs?28.5:32.9,Bn=async()=>{try{if(nt){console.log(" Using selectedOrder from navigation state"),gt(nt),kt(!1);return}if(c){console.log(" Using lastOrderData from sessionStorage"),console.log(" lastOrderData contents:",c),gt(c),kt(!1);return}if(_e&&j){console.log(" Fetching orders from API");const eo=await apiGetOrders(_e);if(eo&&eo.length>0){const to=i?eo.find(Io=>Io.id===i||Io.trackingNumber===i):eo[0];if(to){console.log(" Found matching order:",to),gt(to),kt(!1);return}}}console.log(" No order data found, showing appropriate screen"),gt({id:"default-order",trackingNumber:"FF-123456",status:"on_the_way",deliveryAddress:Os,fuelfriend:{name:"FuelFriend Driver",location:`On the way to ${Os}`,phone:Zs?"+44-20-1234-5678":"+1-555-123-4567",avatar:"/fuel friend.png"},cartItems:[{id:"1",name:"Regular Fuel",price:cn,quantity:1},{id:"2",name:"Service Fee",price:Zs?2.49:2.99,quantity:1}],fuelQuantity:"10 liters",fuelType:"Regular",stationName:Us,currency:Nn,fuelCost:cn,serviceFee:Zs?2.49:2.99}),kt(!1)}catch(eo){console.error("Error fetching order data:",eo),kt(!1)}};console.log(" fetchOrderData effect running"),pt?kt(!1):Bn()},[i,_e,j,nt,ct]),reactExports.useEffect(()=>{if(!Yr.current){console.log(" Map container ref not available");return}console.log(" Initializing Mapbox map..."),console.log(" Mapbox token:",mapboxgl.accessToken?"Available":"Missing");try{es.current=new mapboxgl.Map({container:Yr.current,style:"mapbox://styles/mapbox/streets-v12",center:[-90.049,35.1495],zoom:13,attributionControl:!1}),console.log(" Map instance created"),es.current.addControl(new mapboxgl.NavigationControl,"top-right"),es.current.on("load",()=>{var qr;console.log(" Map loaded successfully"),(qr=es.current)==null||qr.resize(),Ms(!0),es.current.isStyleLoaded()?(console.log(" Map style already loaded, setting up layers"),$r(es.current)):es.current.once("style.load",()=>{es.current&&(console.log(" Map style loaded, setting up layers"),$r(es.current))})}),es.current.on("error",qr=>{console.error(" Map error:",qr)})}catch(qr){console.error(" Map initialization error:",qr),Ms(!0)}return()=>{if(es.current)try{es.current.remove(),console.log(" Map removed")}catch(qr){console.warn(" Error removing map:",qr)}}},[]);async function $r(qr){console.log(" Setting up map layers with curved route...");const Zs=[-90.049,35.1495],Os=[-90.029,35.1295];try{const Nn=new AbortController,cn=setTimeout(()=>Nn.abort(),1500),Bn=`https://api.mapbox.com/directions/v5/mapbox/driving/${Zs[0]},${Zs[1]};${Os[0]},${Os[1]}?geometries=geojson&access_token=${mapboxgl.accessToken}`,Pn=await fetch(Bn,{signal:Nn.signal});clearTimeout(cn);const Ro=await Pn.json();if(Ro.routes&&Ro.routes.length>0){const Ho=Ro.routes[0].geometry;console.log(" Got curved route from Mapbox Directions API"),qr.getSource("route")||qr.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:Ho}}),qr.getLayer("route")||qr.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3AC36C","line-width":8,"line-opacity":.9}}),qr.getLayer("route-outline")||qr.addLayer({id:"route-outline",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#2ea85a","line-width":10,"line-opacity":.3}},"route"),qr.getSource("arrows")||qr.addSource("arrows",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),qr.getLayer("arrows")||qr.addLayer({id:"arrows",type:"symbol",source:"arrows",layout:{"symbol-placement":"line","symbol-spacing":50,"icon-image":"arrow-forward","icon-rotate":["get","angle"],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-size":.6}}),qr.getLayer("3d-buildings")||qr.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:13,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],13,0,13.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],13,0,13.05,["get","min_height"]],"fill-extrusion-opacity":.6}}),qr.getLayer("3d-buildings")||qr.addLayer({id:"3d-buildings",source:"composite","source-layer":"building",filter:["==","extrude","true"],type:"fill-extrusion",minzoom:13,paint:{"fill-extrusion-color":"#aaa","fill-extrusion-height":["interpolate",["linear"],["zoom"],13,0,13.05,["get","height"]],"fill-extrusion-base":["interpolate",["linear"],["zoom"],13,0,13.05,["get","min_height"]],"fill-extrusion-opacity":.6}});const Zn=Ho.coordinates,Qo=Zn.reduce((Dl,Jl)=>Dl.extend(Jl),new mapboxgl.LngLatBounds(Zn[0],Zn[0]));qr.fitBounds(Qo,{padding:80,maxZoom:14,duration:1e3});let Wo=0;const uo=document.createElement("div");uo.className="car-marker",uo.innerHTML=`
          <div style="
            position: relative;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.4));
            z-index: 999;
          ">
             <!-- GPS Label -->
            <div style="
                position: absolute; 
                top: -30px; 
                left: 50%; 
                transform: translateX(-50%); 
                background: white; 
                padding: 4px 10px; 
                border-radius: 20px; 
                box-shadow: 0 4px 10px rgba(0,0,0,0.15);
                font-size: 11px; 
                font-weight: 700; 
                color: #3F4249;
                white-space: nowrap;
                display: flex;
                align-items: center;
                gap: 5px;
            ">
                <div style="width: 6px; height: 6px; background: #3AC36C; border-radius: 50%; box-shadow: 0 0 0 2px rgba(58, 195, 108, 0.2);"></div>
                Tracking
            </div>
            
            <div style="
                width: 100%; 
                height: 100%; 
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                transition: transform 0.1s ease;
            " class="car-rotate-container">
                <img src="/mobil hijau.png" alt="Driver Car" style="width: 100%; height: 100%; object-fit: contain;" />
                <!-- Direction indicator arrow -->
                <div style="
                  position: absolute;
                  top: -15px;
                  left: 50%;
                  transform: translateX(-50%);
                  width: 0;
                  height: 0;
                  borderLeft: 6px solid transparent;
                  borderRight: 6px solid transparent;
                  borderBottom: 10px solid #3AC36C;
                  filter: drop-shadow(0 1px 2px rgba(0,0,0,0.3));
                "></div>
                <!-- Add a pulsing effect around the car -->
                <div style="
                  position: absolute;
                  top: 50%;
                  left: 50%;
                  transform: translate(-50%, -50%);
                  width: 80px;
                  height: 80px;
                  border-radius: 50%;
                  border: 2px solid rgba(58, 195, 108, 0.5);
                  animation: pulse-animation 1.5s infinite;
                  pointer-events: none;
                "></div>
            </div>
          </div>
        `;const eo=new mapboxgl.Marker(uo).setLngLat(Zn[0]).addTo(qr);let to=!0,Io=0;const ou=()=>{let Dl=0;const Jl=performance.now(),Ju=6e4;let zu=0;for(let Vo=1;Vo<Zn.length;Vo++){const Gl=Zn[Vo-1],fu=Zn[Vo],ju=fu[0]-Gl[0],au=fu[1]-Gl[1];zu+=Math.sqrt(ju*ju+au*au)}const vu=Vo=>{var ju;const Gl=Vo-Jl,fu=Math.min(Gl/Ju,1);if(fu<1){let au=fu*zu,pu=0,Il=0;for(let qo=0;qo<Zn.length-1;qo++){const wn=Zn[qo],Nl=Zn[qo+1],vp=Nl[0]-wn[0],cu=Nl[1]-wn[1],bp=Math.sqrt(vp*vp+cu*cu);if(au<=pu+bp){Il=qo,au-=pu;break}pu+=bp}const Ou=Zn[Il],Zu=Zn[Il+1],_o=Zu[0]-Ou[0],Ol=Zu[1]-Ou[1],oo=Math.sqrt(_o*_o+Ol*Ol),Uo=oo>0?au/oo:0,Lo=Ou[0]+_o*Uo,lu=Ou[1]+Ol*Uo;if(!isFinite(Lo)||!isFinite(lu)||isNaN(Lo)||isNaN(lu)){console.warn(" Invalid coordinates detected, skipping frame"),requestAnimationFrame(vu);return}const ps=[Lo,lu];if(eo.setLngLat(ps),qr){const qo=14.5+.8*Math.sin(fu*Math.PI*2);qr.setCenter(ps),qr.setZoom(Math.max(13,Math.min(16,qo)))}let Wl=0;if(Il>0){const qo=Zn[Math.max(0,Il-1)],wn=[Lo,lu],Nl=wn[0]-qo[0],vp=wn[1]-qo[1];if(Nl!==0||vp!==0){let cu=Math.atan2(vp,Nl)*180/Math.PI;cu=(cu%360+360)%360,Wl=cu}else{const cu=Zn[Il],bp=Zn[Math.min(Zn.length-1,Il+1)],Hr=bp[0]-cu[0],Qt=bp[1]-cu[1];let or=Math.atan2(Qt,Hr)*180/Math.PI;or=(or%360+360)%360,Wl=or}}else{const qo=Zn[0],wn=Zn[1],Nl=wn[0]-qo[0],vp=wn[1]-qo[1];let cu=Math.atan2(vp,Nl)*180/Math.PI;cu=(cu%360+360)%360,Wl=cu}const Bu=uo.querySelector(".car-rotate-container");if(Bu){const qo=(Wl%360+360)%360;let wn=qo;qo>180&&(wn=qo-360);const Nl=(wn%360+360)%360;Bu.style.transition="transform 0.05s ease-out",Bu.style.transform=`rotate(${Nl}deg)`,Il%5===0&&(console.log(` POS CHECK - Segment ${Il}:`),console.log(`   Raw heading: ${Wl.toFixed(1)}`),console.log(`   Ultra normalized: ${qo.toFixed(1)}`),console.log(`   Safe heading: ${wn.toFixed(1)}`),console.log(`   FINAL applied: ${Nl.toFixed(1)}`),console.log(`   Progress: ${(fu*100).toFixed(1)}%`))}requestAnimationFrame(vu)}else{if(console.log(" Car arrived at destination!"),Wr){Wr.status="delivered",gt({...Wr,status:"delivered"});const au={...Wr,driverName:Vs.name,driverPhone:Vs.phone,createdAt:new Date().toISOString(),totalAmount:Wr.fuelCost+(Wr.serviceFee||0)+(((ju=Wr.cartItems)==null?void 0:ju.reduce((Il,Ou)=>Il+Ou.price*Ou.quantity,0))||0)},pu=JSON.parse(localStorage.getItem("user")||"{}");if(pu.id){const Il=JSON.parse(localStorage.getItem(`userReceipts_${pu.id}`)||"[]");Il.unshift(au),localStorage.setItem(`userReceipts_${pu.id}`,JSON.stringify(Il))}}setTimeout(()=>Dt(!0),500)}};requestAnimationFrame(vu)};console.log(" Starting smooth car animation for 1 minute..."),requestAnimationFrame(ou)}else console.warn(" No route found from API, using fallback"),Ar(qr,Zs,Os)}catch(Nn){console.error(" Error fetching route or timeout:",Nn),console.log(" Switching to fallback route due to error/timeout"),Ar(qr,Zs,Os)}const Us=document.createElement("div");Us.className="destination-marker",Us.innerHTML=`
      <div style="
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
      ">
        <svg width="40" height="40" viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
          <path d="M 20 5 C 14 5 9 10 9 16 C 9 24 20 35 20 35 C 20 35 31 24 31 16 C 31 10 26 5 20 5 Z" fill="#EF4444"/>
          <circle cx="20" cy="16" r="5" fill="white"/>
        </svg>
      </div>
    `,new mapboxgl.Marker(Us).setLngLat(Os).addTo(qr)}function Ar(qr,Zs,Os){const Us=[(Zs[0]+Os[0])/2,(Zs[1]+Os[1])/2],Nn=.02,cn=[Us[0]+Nn,Us[1]+Nn*.5],Bn=[Us[0]-Nn*.5,Us[1]-Nn],Pn=[];for(let uo=0;uo<=1;uo+=.05){const eo=uo,to=Math.pow(1-eo,3)*Zs[0]+3*Math.pow(1-eo,2)*eo*cn[0]+3*(1-eo)*Math.pow(eo,2)*Bn[0]+Math.pow(eo,3)*Os[0],Io=Math.pow(1-eo,3)*Zs[1]+3*Math.pow(1-eo,2)*eo*cn[1]+3*(1-eo)*Math.pow(eo,2)*Bn[1]+Math.pow(eo,3)*Os[1];Pn.push([to,Io])}qr.getSource("route")||qr.addSource("route",{type:"geojson",data:{type:"Feature",properties:{},geometry:{type:"LineString",coordinates:Pn}}}),qr.getLayer("route")||qr.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3AC36C","line-width":6}});const Ro=document.createElement("div");Ro.className="car-marker",Ro.innerHTML=`
      <div class="car-rotate-container" style="
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        transition: transform 0.08s ease-out; /* Smooth rotation transition */
        position: relative;
      ">
        <img src="/mobil hijau.png" alt="Driver Car" style="width: 100%; height: 100%; object-fit: contain;" />
        <!-- Add a pulsing effect around the car -->
        <div style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          width: 70px;
          height: 70px;
          border-radius: 50%;
          border: 2px solid rgba(58, 195, 108, 0.5);
          animation: pulse-animation 1.5s infinite;
          pointer-events: none;
        "></div>
      </div>
    `;const Ho=new mapboxgl.Marker(Ro).setLngLat(Zs).addTo(qr),Zn=performance.now(),Qo=6e4,Wo=uo=>{const eo=uo-Zn;let to=eo/Qo;if(to<1){to=.5-.5*Math.cos(to*Math.PI);const Io=Zs[0]+(Os[0]-Zs[0])*to,ou=Zs[1]+(Os[1]-Zs[1])*to,Dl=Zs[0]+(Os[0]-Zs[0])*to,Jl=Zs[1]+(Os[1]-Zs[1])*to,Ju=Os[0]-Dl,zu=Os[1]-Jl;let vu=Math.atan2(zu,Ju)*180/Math.PI;vu=(vu%360+360)%360;const Vo=Ro.querySelector(".car-rotate-container");Vo&&(Vo.style.transition="transform 0.3s ease",Vo.style.transform=`rotate(${vu}deg)`),Ho.setLngLat([Io,ou]),eo>1e3&&qr.easeTo({center:[Io,ou],duration:2e3,easing:Gl=>Gl,animate:!0}),requestAnimationFrame(Wo)}else console.log(" Car arrived (fallback)!"),Wr&&(Wr.status="delivered",gt({...Wr,status:"delivered"})),setTimeout(()=>Dt(!0),500)};requestAnimationFrame(Wo)}reactExports.useEffect(()=>{if(!ms){const qr=setTimeout(()=>{console.log("Map loading timed out, force showing content"),Ms(!0)},1500);return()=>clearTimeout(qr)}},[ms]);const[Xr,us]=reactExports.useState(!1);reactExports.useEffect(()=>{const qr=setTimeout(()=>{St&&(console.log(" Loading timeout reached, forcing loading to false"),kt(!1),us(!0))},1e4);return()=>clearTimeout(qr)},[St]);const Wr=pt||c||nt,Vs=xr(Wr);return console.log("Driver data:",Vs),console.log("Current order:",Wr),(Wr==null?void 0:Wr.status)==="completed"||(Wr==null?void 0:Wr.status)==="delivered"||(Wr==null?void 0:Wr.status)==="on_the_way"||(Wr==null?void 0:Wr.status)==="preparing"||Wr==null||Wr.status,Wr!=null&&Wr.status,(Wr==null?void 0:Wr.status)==="completed"||(Wr==null?void 0:Wr.status)==="delivered"||(Wr==null?void 0:Wr.status)==="on_the_way"||(Wr==null?void 0:Wr.status)==="preparing"||Wr==null||Wr.status,St?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen flex flex-col bg-white",children:jsxRuntimeExports.jsx("div",{className:"flex-1 flex items-center justify-center",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Loading order details..."}),Xr&&jsxRuntimeExports.jsx("p",{className:"text-red-500 text-sm mt-2",children:"Taking longer than expected..."})]})})})}):(console.log(" TrackOrderScreen data:",{order:!!pt,lastOrderData:!!c,currentOrder:!!Wr,token:!!_e,user:!!j}),jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(AnimatedPage,{children:[jsxRuntimeExports.jsx("style",{children:`
          .car-marker, .mapboxgl-marker {
            z-index: 999 !important;
            opacity: 1 !important;
            display: block !important;
          }
          .destination-marker {
            z-index: 998 !important;
          }
        `}),jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen flex flex-col",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center px-4 py-4 bg-white absolute top-0 left-0 right-0 z-[3000] shadow-sm",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-bold text-gray-900 flex-1 text-center -ml-10",children:"Track Your Order"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 relative w-full h-full min-h-[50vh] rounded-3xl overflow-hidden",children:[jsxRuntimeExports.jsx("div",{ref:Yr,className:"w-full h-full absolute inset-0",style:{width:"100%",height:"100%"}}),!ms&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-50 z-10",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-8 h-8 border-4 border-[#3AC36C] border-t-transparent rounded-full animate-spin mx-auto mb-2"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Loading map..."})]})})]}),jsxRuntimeExports.jsxs("div",{ref:Dr,className:"bg-white rounded-t-3xl shadow-2xl absolute bottom-0 left-0 right-0 z-[3000]",style:{height:`${It}%`,transform:`translateY(${100-It}%)`},onTouchStart:jr,onTouchMove:rr,onTouchEnd:ar,children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center py-3",children:jsxRuntimeExports.jsx("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),jsxRuntimeExports.jsxs("div",{className:"px-4 pb-20 overflow-y-auto",style:{maxHeight:"80vh"},children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-3",children:[jsxRuntimeExports.jsx("img",{src:Vs.avatar,alt:Vs.name,className:"w-12 h-12 rounded-full object-cover"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900",children:Vs.name}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:Vs.location})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:qr=>{qr.stopPropagation(),console.log("Message button clicked!"),zt(!0)},className:"p-3 bg-[#3AC36C] rounded-full w-12 h-12 flex items-center justify-center shadow-md hover:bg-[#2ea85a] transition-all active:scale-95 touch-manipulation","aria-label":"Message Agent",children:jsxRuntimeExports.jsx(MessageCircle,{className:"w-6 h-6 text-white"})}),jsxRuntimeExports.jsx("button",{onClick:qr=>{qr.stopPropagation(),Nt(!0)},className:"p-3 bg-[#3AC36C] rounded-full w-12 h-12 flex items-center justify-center shadow-md hover:bg-[#2ea85a] transition-all active:scale-95 touch-manipulation","aria-label":"Call Agent",children:jsxRuntimeExports.jsx(Phone,{className:"w-6 h-6 text-white"})})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h4",{className:"font-bold text-gray-900 text-lg mb-1",children:"Your Pickup Time"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm mb-4",children:(Wr==null?void 0:Wr.deliveryTime)||"Estimated 15-20 mins"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-2 py-4 relative",children:[jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center relative z-10",children:jsxRuntimeExports.jsx("img",{src:"/orang icon.png",alt:"User",className:"w-10 h-10 object-contain"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 border-t-2 border-dashed border-green-500 mx-2"}),jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center relative z-10",children:jsxRuntimeExports.jsx("img",{src:"/mobil icon.png",alt:"Car",className:"w-10 h-10 object-contain"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300 mx-2"}),jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center relative z-10",children:jsxRuntimeExports.jsx("img",{src:"/isi icon.png",alt:"Fuel",className:"w-10 h-10 object-contain"})}),jsxRuntimeExports.jsx("div",{className:"flex-1 border-t-2 border-dashed border-gray-300 mx-2"}),jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center relative z-10",children:jsxRuntimeExports.jsx("img",{src:"/done icon.png",alt:"Done",className:"w-10 h-10 object-contain"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"Order Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-700 font-medium",children:[(Wr==null?void 0:Wr.fuelType)||"Regular"," Fuel"]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",(Wr==null?void 0:Wr.fuelQuantity)||"10 liters",")"]})]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[(Wr==null?void 0:Wr.currency)||"$",typeof(Wr==null?void 0:Wr.fuelCost)=="number"?Wr.fuelCost.toFixed(2):(Wr==null?void 0:Wr.fuelCost)||"32.90"]})]}),(_n=Wr==null?void 0:Wr.cartItems)==null?void 0:_n.filter(qr=>(qr==null?void 0:qr.name)&&typeof qr.name=="string"&&qr.name.toLowerCase().includes("fee")===!1).map((qr,Zs)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100 last:border-0",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:(qr==null?void 0:qr.name)||"Item"}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(x",(qr==null?void 0:qr.quantity)||1,")"]})]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[(Wr==null?void 0:Wr.currency)||"$",typeof(qr==null?void 0:qr.price)=="number"?qr.price.toFixed(2):(qr==null?void 0:qr.price)||"0.00"]})]},(qr==null?void 0:qr.id)||Zs)),(Wr==null?void 0:Wr.serviceFee)&&typeof Wr.serviceFee=="number"&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Service Fee"}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[(Wr==null?void 0:Wr.currency)||"$",Wr.serviceFee.toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700 text-sm",children:"Station"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900 text-sm",children:(Wr==null?void 0:Wr.stationName)||"Fuel Station"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700 text-sm",children:"Pickup Location"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900 text-sm",children:(Wr==null?void 0:Wr.deliveryAddress)||"Location"})]})]})]})]})]})]}),At&&jsxRuntimeExports.jsx(CallModal,{isOpen:At,onClose:()=>Nt(!1),driverName:Vs.name,phoneNumber:Vs.phone||Kr(((zo=j==null?void 0:j.city)==null?void 0:zo.toLowerCase().includes("london"))||((Cn=j==null?void 0:j.city)==null?void 0:Cn.toLowerCase().includes("uk"))||((On=j==null?void 0:j.city)==null?void 0:On.toLowerCase().includes("england")))}),Jt&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-[5000] p-4 animate-fade-in",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-scale-in",children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-4",children:jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-green-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-12 h-12 text-green-500"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Completed!"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Your order has been completed successfully."})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Order ID"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-900",children:(Wr==null?void 0:Wr.trackingNumber)||"N/A"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Fuel Friend"}),jsxRuntimeExports.jsx("span",{className:"text-sm font-medium text-gray-900",children:Vs.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Total Amount"}),jsxRuntimeExports.jsxs("span",{className:"text-sm font-bold text-green-600",children:[(Wr==null?void 0:Wr.currency)||"$",(Wr==null?void 0:Wr.grandTotal)||(Wr==null?void 0:Wr.totalAmount)||"0.00"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{Dt(!1),e("/home")},className:"w-full py-3 bg-[#3AC36C] text-white rounded-full font-semibold hover:bg-[#2ea85a] transition-all duration-200",children:"Back to Home"}),jsxRuntimeExports.jsx("button",{onClick:()=>{Dt(!1),e("/orders")},className:"w-full py-3 border-2 border-gray-200 text-gray-700 rounded-full font-semibold hover:border-[#3AC36C] hover:text-[#3AC36C] transition-all duration-200",children:"View All Orders"})]})]})})]}),Vt&&jsxRuntimeExports.jsx(ChatModal,{isOpen:Vt,onClose:()=>zt(!1),driverName:Vs.name,driverAvatar:Vs.avatar,driverPhone:Vs.phone||"+1234567890",onCall:()=>{var Os,Us,Nn;zt(!1);const qr=((Os=j==null?void 0:j.city)==null?void 0:Os.toLowerCase().includes("london"))||((Us=j==null?void 0:j.city)==null?void 0:Us.toLowerCase().includes("uk"))||((Nn=j==null?void 0:j.city)==null?void 0:Nn.toLowerCase().includes("england")),Zs=Kr(qr);alert(`Calling ${Vs.name} at ${Vs.phone||Zs}`)}})]}))},LottieAnimation=({animationData:e,width:i=100,height:d=100,loop:j=!0,autoplay:_e=!0})=>{const nt={width:`${i}px`,height:`${d}px`};return jsxRuntimeExports.jsx(Lottie,{animationData:e,style:nt,loop:j,autoplay:_e})},DisputeSuccessModal=({isOpen:e,onClose:i})=>(useNavigate(),e?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4 animate-in fade-in duration-200",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-3xl p-8 w-full max-w-sm shadow-xl flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full bg-green-50 flex items-center justify-center mb-6",children:jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full bg-[#3AC36C] flex items-center justify-center shadow-lg shadow-green-200",children:jsxRuntimeExports.jsx(CircleCheckBig,{size:24,color:"white",strokeWidth:3})})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-[#3F4249] mb-8",children:"Order disputed Successfully!"}),jsxRuntimeExports.jsx("button",{onClick:i,className:"w-full py-4 bg-[#3AC36C] text-white font-bold rounded-full shadow-md text-base transition-transform active:scale-95 hover:bg-[#2ea85a]",children:"Back to Order List"})]})}):null),DisputeModal=({isOpen:e,onClose:i,onConfirm:d,order:j})=>{var _e,nt,ct,c,pt,gt;return!e||!j?null:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm animate-in fade-in zoom-in duration-200",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 rounded-full overflow-hidden border-4 border-gray-100 mb-4 shadow-sm",children:jsxRuntimeExports.jsx("img",{src:j.fuelFriendPhoto||((_e=j.fuelFriend)==null?void 0:_e.avatarUrl)||((nt=j.fuelfriend)==null?void 0:nt.avatar)||"/fuel friend.png",alt:j.fuelFriendName||((ct=j.fuelFriend)==null?void 0:ct.name)||((c=j.fuelfriend)==null?void 0:c.name)||"Fuel Friend",className:"w-full h-full object-cover",onError:St=>{St.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23e5e7eb'/%3E%3Cpath d='M32 16a8 8 0 1 0 0 16 8 8 0 0 0 0-16zM20 48a12 12 0 0 1 24 0H20z' fill='%23999'/%3E%3C/svg%3E"}})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-[#3F4249] mb-2",children:j.fuelFriendName||((pt=j.fuelFriend)==null?void 0:pt.name)||((gt=j.fuelfriend)==null?void 0:gt.name)||"Fuel Friend"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6 px-4",children:"Please confirm Do you wish to dispute this Job"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3 w-full",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"flex-1 py-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-full hover:bg-gray-50 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:d,className:"flex-1 py-3 bg-[#FF4D4D] text-white font-bold rounded-full hover:bg-[#ff3333] shadow-md transition-colors",children:"Dispute"})]})]})})})},OrderCard=({order:e,type:i,onDispute:d,onRequestCompleted:j})=>{var _e,nt,ct,c,pt,gt,St,kt,At;return jsxRuntimeExports.jsxs("div",{className:"bg-white p-5 rounded-2xl mb-4 shadow-sm border border-gray-100",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("img",{src:e.fuelFriendPhoto||((_e=e.fuelFriend)==null?void 0:_e.avatarUrl)||((nt=e.fuelfriend)==null?void 0:nt.avatar)||"/fuel friend.png",alt:e.fuelFriendName||((ct=e.fuelFriend)==null?void 0:ct.name)||"Fuel Friend",className:"w-14 h-14 rounded-full border-2 border-gray-100 object-cover",onError:Nt=>{Nt.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23e5e7eb'/%3E%3Cpath d='M32 16a8 8 0 1 0 0 16 8 8 0 0 0 0-16zM20 48a12 12 0 0 1 24 0H20z' fill='%23999'/%3E%3C/svg%3E"}}),jsxRuntimeExports.jsx("div",{className:"ml-4 flex-grow",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-bold text-[#3F4249] text-base",children:e.fuelFriendName||((c=e.fuelFriend)==null?void 0:c.name)||((pt=e.fuelfriend)==null?void 0:pt.name)||"Fuel Friend"}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-500 flex items-center mt-1",children:[jsxRuntimeExports.jsx(MapPin,{size:14,className:"mr-1 text-[#FF4D4D]"}),jsxRuntimeExports.jsx("span",{className:"truncate max-w-[150px]",children:e.deliveryAddress||e.fuelFriendLocation||((gt=e.fuelFriend)==null?void 0:gt.location)||((St=e.fuelfriend)==null?void 0:St.location)||"Location"})]})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-400 mb-1",children:"Tracking no:"}),jsxRuntimeExports.jsx("p",{className:"text-xs font-semibold text-gray-600",children:e.trackingNumber||e.trackingNo||"N/A"})]})]})})]}),jsxRuntimeExports.jsx("div",{className:"mt-5 flex space-x-3",children:i==="ongoing"?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("button",{onClick:()=>j&&j(e),className:"flex-1 bg-[#3AC36C] text-white py-2.5 rounded-full text-sm font-bold shadow-md active:scale-95 transition-transform",children:"Request Completed"}),jsxRuntimeExports.jsx("button",{onClick:()=>d&&d(e),className:"flex-1 bg-white border border-[#3AC36C] text-[#3AC36C] py-2.5 rounded-full text-sm font-bold active:scale-95 transition-transform",children:"Dispute"})]}):jsxRuntimeExports.jsx("div",{className:`w-full text-right py-2 text-sm font-bold ${((kt=e.status)==null?void 0:kt.toLowerCase())==="delivered"||((At=e.status)==null?void 0:At.toLowerCase())==="completed"?"text-[#3AC36C]":"text-[#FF4D4D]"}`,children:e.status||"History"})})]})},RatingModal=({isOpen:e,onClose:i,onSubmit:d,order:j})=>{var pt,gt,St,kt,At,Nt;const[_e,nt]=reactExports.useState(0),[ct,c]=reactExports.useState("");return!e||!j?null:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 px-4 animate-in fade-in duration-200",children:jsxRuntimeExports.jsx("div",{className:"bg-white rounded-3xl p-6 w-full max-w-sm shadow-xl transform transition-all scale-100",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center text-center",children:[jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-[#3F4249] mb-4",children:"Rate Service"}),jsxRuntimeExports.jsxs("div",{className:"w-20 h-20 rounded-full overflow-hidden border-4 border-gray-100 mb-3 shadow-sm relative",children:[jsxRuntimeExports.jsx("img",{src:j.fuelFriendPhoto||((pt=j.fuelFriend)==null?void 0:pt.avatarUrl)||((gt=j.fuelfriend)==null?void 0:gt.avatar)||"/fuel friend.png",alt:j.fuelFriendName||((St=j.fuelFriend)==null?void 0:St.name)||((kt=j.fuelfriend)==null?void 0:kt.name)||"Fuel Friend",className:"w-full h-full object-cover",onError:Vt=>{Vt.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='64' height='64' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23e5e7eb'/%3E%3Cpath d='M32 16a8 8 0 1 0 0 16 8 8 0 0 0 0-16zM20 48a12 12 0 0 1 24 0H20z' fill='%23999'/%3E%3C/svg%3E"}}),jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 right-0 bg-[#3AC36C] rounded-full p-1 border-2 border-white",children:jsxRuntimeExports.jsx(CircleCheckBig,{size:12,color:"white"})})]}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-bold text-[#3F4249] mb-1",children:j.fuelFriendName||((At=j.fuelFriend)==null?void 0:At.name)||((Nt=j.fuelfriend)==null?void 0:Nt.name)||"Fuel Friend"}),jsxRuntimeExports.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"How was your fuel pickup?"}),jsxRuntimeExports.jsx("div",{className:"flex space-x-2 mb-6",children:[1,2,3,4,5].map(Vt=>jsxRuntimeExports.jsx("button",{onClick:()=>nt(Vt),className:`focus:outline-none transition-all duration-300 ${Vt<=_e?"scale-110 text-yellow-400 drop-shadow-sm":"text-gray-300 hover:scale-125 hover:text-yellow-200"} active:scale-90 active:rotate-12`,children:jsxRuntimeExports.jsx(Star,{size:32,fill:Vt<=_e?"#FFD700":"none",color:Vt<=_e?"#FFD700":"#D1D5DB",strokeWidth:Vt<=_e?0:1.5,className:"filter drop-shadow-sm"})},Vt))}),jsxRuntimeExports.jsx("textarea",{value:ct,onChange:Vt=>c(Vt.target.value),placeholder:"Additional comments... (Optional)",className:"w-full bg-gray-50 border border-gray-200 rounded-xl p-3 text-sm text-gray-700 mb-6 focus:outline-none focus:ring-2 focus:ring-[#3AC36C] resize-none",rows:3}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3 w-full",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"flex-1 py-3 bg-white border border-gray-300 text-gray-700 font-bold rounded-full hover:bg-gray-50 transition-colors active:scale-95 duration-200",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:()=>d(_e,ct),disabled:_e===0,className:`flex-1 py-3 text-white font-bold rounded-full shadow-md transition-all active:scale-95 duration-200 ${_e===0?"bg-gray-300 cursor-not-allowed":"bg-[#3AC36C] hover:bg-[#2ea85a]"}`,children:"Submit"})]})]})})})},MyOrdersScreen=()=>{const e=useNavigate(),{user:i,token:d}=useAppContext(),[j,_e]=reactExports.useState("ongoing"),[nt,ct]=reactExports.useState([]),[c,pt]=reactExports.useState(!0),[gt,St]=reactExports.useState(!1),[kt,At]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState(null),[zt,Jt]=reactExports.useState(!1),[Dt,It]=reactExports.useState(null),Mt=Ur=>{Vt(Ur),St(!0)},Ht=Ur=>{It(Ur),Jt(!0)},tr=async(Ur,Dr)=>{if(!Dt)return;console.log(`Rating order ${Dt.id}: ${Ur} stars, feedback: ${Dr}`);const Yr=nt.map(es=>es.id===Dt.id||es.trackingNumber===Dt.trackingNumber?{...es,status:"completed",rating:Ur,feedback:Dr}:es);if(ct(Yr),i!=null&&i.id){const es=localStorage.getItem(`userOrders_${i.id}`);if(es){const Ms=JSON.parse(es).map(Kr=>Kr.id===Dt.id||Kr.trackingNumber===Dt.trackingNumber?{...Kr,status:"completed",rating:Ur,feedback:Dr}:Kr);localStorage.setItem(`userOrders_${i.id}`,JSON.stringify(Ms))}}Jt(!1),_e("history")},er=()=>{if(!Nt)return;console.log("Disputing order:",Nt.id);const Ur=nt.map(Dr=>Dr.id===Nt.id||Dr.trackingNumber===Nt.trackingNumber?{...Dr,status:"cancelled"}:Dr);if(ct(Ur),i!=null&&i.id){const Dr=localStorage.getItem(`userOrders_${i.id}`);if(Dr){const es=JSON.parse(Dr).map(ms=>ms.id===Nt.id||ms.trackingNumber===Nt.trackingNumber?{...ms,status:"cancelled"}:ms);localStorage.setItem(`userOrders_${i.id}`,JSON.stringify(es))}}St(!1),setTimeout(()=>At(!0),300),_e("history")};if(reactExports.useEffect(()=>{if(!d||!i){pt(!1);return}(async()=>{try{pt(!0);let Dr=[];try{const Kr=new Promise((xr,jr)=>setTimeout(()=>jr(new Error("API Timeout")),1500));Dr=await Promise.race([apiGetOrders(),Kr]),Array.isArray(Dr)||(Dr=[])}catch{console.log("API fetch slow or failed, using local data only.")}const Yr=localStorage.getItem(`userOrders_${i.id}`),es=Yr?JSON.parse(Yr):[];console.log(" API Orders:",Dr.length),console.log(" Local Orders:",es.length);const Ms=[...es,...Dr].filter((Kr,xr,jr)=>xr===jr.findIndex(rr=>rr.trackingNumber&&rr.trackingNumber===Kr.trackingNumber||rr.id&&rr.id===Kr.id));ct(Ms)}catch(Dr){console.error("Failed to fetch orders:",Dr),ct([])}finally{pt(!1)}})()},[d,i]),!d||!i)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center sticky top-0 bg-white z-10",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 rounded-full hover:bg-gray-100",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-center flex-grow -ml-10",children:"My Orders"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#9CA3AF",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to view your orders and track your fuel deliveries."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})]})});const dr=Array.isArray(nt)?nt.filter(Ur=>{var Dr;return["pending","confirmed","in_progress","on_the_way","ongoing"].includes((Dr=Ur.status)==null?void 0:Dr.toLowerCase())}):[],mr=Array.isArray(nt)?nt.filter(Ur=>{var Dr;return["completed","cancelled","delivered","rejected"].includes((Dr=Ur.status)==null?void 0:Dr.toLowerCase())}):[];return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-gray-50",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center sticky top-0 bg-white z-10 shadow-sm",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-center flex-grow -ml-10 text-[#3F4249]",children:"Manage Orders"})]}),jsxRuntimeExports.jsx("div",{className:"px-4",children:jsxRuntimeExports.jsxs("div",{className:"flex border-b-2 border-gray-200",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>_e("ongoing"),className:`flex-1 py-4 font-bold transition-all duration-200 relative ${j==="ongoing"?"text-[#3AC36C] border-b-3 border-[#3AC36C]":"text-gray-500 hover:text-gray-700"}`,children:["Ongoing",j==="ongoing"&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-[#3AC36C] rounded-t-full"})]}),jsxRuntimeExports.jsxs("button",{onClick:()=>_e("history"),className:`flex-1 py-4 font-bold transition-all duration-200 relative ${j==="history"?"text-[#3AC36C] border-b-3 border-[#3AC36C]":"text-gray-500 hover:text-gray-700"}`,children:["History",j==="history"&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-[#3AC36C] rounded-t-full"})]})]})}),jsxRuntimeExports.jsx("div",{className:"p-4 flex-grow overflow-y-auto",children:c?jsxRuntimeExports.jsx("div",{className:"flex justify-center items-center h-full",children:jsxRuntimeExports.jsx(LottieAnimation,{animationData:tapAnimation,width:100,height:100})}):j==="ongoing"?dr.length>0?dr.map(Ur=>jsxRuntimeExports.jsx(OrderCard,{order:Ur,type:"ongoing",onDispute:Mt,onRequestCompleted:Ht},Ur.id)):jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center mt-8",children:jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 mt-2",children:"No ongoing orders."})}):mr.length>0?mr.map(Ur=>jsxRuntimeExports.jsx(OrderCard,{order:Ur,type:"history"},Ur.id)):jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center mt-8",children:jsxRuntimeExports.jsx("p",{className:"text-center text-gray-500 mt-2",children:"No past orders."})})}),jsxRuntimeExports.jsx(DisputeModal,{isOpen:gt,onClose:()=>St(!1),onConfirm:er,order:Nt}),jsxRuntimeExports.jsx(DisputeSuccessModal,{isOpen:kt,onClose:()=>At(!1)}),jsxRuntimeExports.jsx(RatingModal,{isOpen:zt,onClose:()=>Jt(!1),onSubmit:tr,order:Dt})]})})},ConfirmationModal=({isOpen:e,onClose:i,onConfirm:d,title:j,message:_e,confirmText:nt="Confirm",cancelText:ct="Cancel",type:c="confirm"})=>{if(!e)return null;const pt=()=>{switch(c){case"warning":return jsxRuntimeExports.jsx(TriangleAlert,{className:"w-8 h-8 text-yellow-500"});case"error":return jsxRuntimeExports.jsx(CircleX,{className:"w-8 h-8 text-red-500"});case"info":return jsxRuntimeExports.jsx(Info,{className:"w-8 h-8 text-blue-500"});default:return jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-green-500"})}},gt=()=>{switch(c){case"warning":return"bg-yellow-500 hover:bg-yellow-600";case"error":return"bg-red-500 hover:bg-red-600";case"info":return"bg-blue-500 hover:bg-blue-600";default:return"bg-[#3AC36C] hover:bg-[#2ea85a]"}};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-[99998] flex items-center justify-center p-4",onClick:i,children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm shadow-2xl animate-scale-in",onClick:St=>St.stopPropagation(),children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-4",children:pt()}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-bold text-gray-900 text-center mb-2",children:j}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-center mb-6 leading-relaxed",children:_e}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"flex-1 py-3 border-2 border-gray-200 text-gray-700 rounded-full font-semibold hover:border-gray-300 transition-colors",children:ct}),jsxRuntimeExports.jsx("button",{onClick:()=>{d(),i()},className:`flex-1 py-3 ${gt()} text-white rounded-full font-semibold transition-colors`,children:nt})]})]})})})},SettingsItem=({icon:e,text:i,onClick:d})=>jsxRuntimeExports.jsxs("div",{onClick:d,className:"flex items-center justify-between p-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-900 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"mr-4 text-gray-600 dark:text-gray-400",children:e}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 dark:text-gray-200 text-base",children:i})]}),jsxRuntimeExports.jsx(ChevronRight,{className:"text-gray-400 dark:text-gray-600",size:20})]}),SettingsScreen=()=>{const e=useNavigate(),{logout:i,user:d}=useAppContext(),[j,_e]=reactExports.useState(""),[nt,ct]=reactExports.useState(!1),c=()=>{ct(!0)},pt=()=>{i(),e("/login")};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-background",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-background border-b border-gray-100 dark:border-gray-800",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600 dark:text-gray-400"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900 dark:text-white",children:"Settings"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-6",children:[j&&jsxRuntimeExports.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-blue-600 text-sm text-center",children:j})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium mb-3 px-2",children:"Security & Passwords"}),jsxRuntimeExports.jsxs("div",{className:"bg-background border-t border-b border-gray-200 dark:border-gray-800",children:[jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(CreditCard,{size:20}),text:"Manage Payment Method",onClick:()=>e("/payment-methods")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(Calculator,{size:20}),text:"Fuel Efficiency Calculator",onClick:()=>e("/fuel-efficiency")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(Sun,{size:20}),text:"Themes",onClick:()=>e("/theme")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(Bell,{size:20}),text:"Notification Settings",onClick:()=>e("/notification-settings")})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-500 dark:text-gray-400 text-sm font-medium mb-3 px-2",children:"Customer Care"}),jsxRuntimeExports.jsxs("div",{className:"bg-background border-t border-b border-gray-200 dark:border-gray-800",children:[jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(CircleHelp,{size:20}),text:"Help and Support",onClick:()=>e("/support-help")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(FileText,{size:20}),text:"Terms and Conditions",onClick:()=>e("/terms-conditions")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(Shield,{size:20}),text:"Privacy Policy",onClick:()=>e("/privacy-policy")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(FileText,{size:20}),text:"My Receipts",onClick:()=>e("/receipts")}),jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-800"}),jsxRuntimeExports.jsx(SettingsItem,{icon:jsxRuntimeExports.jsx(Trash2,{size:20}),text:"Request Account Deletion",onClick:()=>e("/account-deletion")})]})]}),!1,d&&jsxRuntimeExports.jsx("div",{className:"pt-4",children:jsxRuntimeExports.jsxs("button",{onClick:c,className:"w-full bg-red-500 text-white py-4 rounded-full font-bold hover:bg-red-600 transition-colors shadow-lg flex items-center justify-center",children:[jsxRuntimeExports.jsx(LogOut,{size:20,className:"mr-2"}),"Sign Out"]})})]})]})}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:nt,onClose:()=>ct(!1),onConfirm:pt,title:"Sign Out",message:"Are you sure you want to log out of your account?",confirmText:"Sign Out",cancelText:"Cancel",type:"warning"})]})},NotificationsScreen=()=>{const e=useNavigate(),{user:i,isAuthenticated:d}=useAppContext(),[j,_e]=reactExports.useState([]),[nt,ct]=reactExports.useState(!0),[c,pt]=reactExports.useState(null),gt=async()=>{try{const Dt=await apiGetNotifications();_e(Dt),console.log("Notifications loaded:",Dt.length)}catch(Dt){console.error("Error loading notifications:",Dt)}finally{ct(!1)}};if(reactExports.useEffect(()=>{if(!d||!i){ct(!1);return}gt()},[d,i]),reactExports.useEffect(()=>{const Dt=()=>{pt(null)};return c&&document.addEventListener("click",Dt),()=>{document.removeEventListener("click",Dt)}},[c]),!d||!i)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Notifications"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(Mail,{className:"w-10 h-10 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to view your notifications."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})]})});const St=async Dt=>{try{await apiMarkNotificationAsRead(Dt),_e(It=>It.map(Mt=>Mt.id===Dt?{...Mt,isRead:!0}:Mt))}catch(It){console.error("Error marking notification as read:",It)}},kt=Dt=>{_e(It=>It.filter(Mt=>Mt.id!==Dt)),pt(null)},At=(Dt,It)=>{Dt.stopPropagation(),pt(c===It?null:It)},Nt=Dt=>{switch((Dt.data?JSON.parse(Dt.data):{}).type||"info"){case"order_confirmed":case"order_delivered":return jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-6 h-6 text-green-500"});case"order_cancelled":return jsxRuntimeExports.jsx(CircleX,{className:"w-6 h-6 text-red-500"});case"payment":return jsxRuntimeExports.jsx(CreditCard,{className:"w-6 h-6 text-orange-500"});case"account":return jsxRuntimeExports.jsx(User,{className:"w-6 h-6 text-gray-600"});default:return jsxRuntimeExports.jsx(Mail,{className:"w-6 h-6 text-blue-500"})}},Vt=Dt=>{const It=new Date(Dt),Ht=new Date().getTime()-It.getTime(),tr=Math.floor(Ht/(1e3*60*60)),er=Math.floor(tr/24);return tr<1?"Just now":tr<24?`${tr}h ago`:er===1?"Yesterday":er<7?`${er}d ago`:It.toLocaleDateString()},zt=Dt=>{const It={Today:[],Yesterday:[],"Last week":[],Older:[]};return Dt.forEach(Mt=>{const Ht=new Date(Mt.sentAt),er=Math.floor((new Date().getTime()-Ht.getTime())/(1e3*60*60*24));er===0?It.Today.push(Mt):er===1?It.Yesterday.push(Mt):er<=7?It["Last week"].push(Mt):It.Older.push(Mt)}),Object.keys(It).forEach(Mt=>{It[Mt].length===0&&delete It[Mt]}),It};if(nt)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-black min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-800",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-64",children:jsxRuntimeExports.jsx("div",{className:"text-gray-500 dark:text-gray-400",children:"Loading notifications..."})})]})});const Jt=zt(j);return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-black min-h-screen",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-800",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Notifications"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-4",children:Object.keys(Jt).length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx(Mail,{className:"w-12 h-12 text-gray-300 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No notifications yet"})]}):Object.entries(Jt).map(([Dt,It])=>jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-3",children:Dt}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:It.map(Mt=>jsxRuntimeExports.jsx("div",{className:`relative cursor-pointer ${Mt.isRead?"opacity-70":""}`,onClick:()=>!Mt.isRead&&St(Mt.id),children:jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0 mt-1",children:Nt(Mt)}),jsxRuntimeExports.jsxs("div",{className:"flex-1 min-w-0",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2",children:[jsxRuntimeExports.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white",children:Mt.title}),!Mt.isRead&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:Mt.body}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-400 dark:text-gray-500 mt-1",children:Vt(Mt.sentAt)})]}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("button",{onClick:Ht=>At(Ht,Mt.id),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-800 rounded-full transition-colors",children:jsxRuntimeExports.jsx(EllipsisVertical,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"})}),c===Mt.id&&jsxRuntimeExports.jsx("div",{className:"absolute right-0 top-8 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-10 min-w-48",children:jsxRuntimeExports.jsxs("button",{onClick:Ht=>{Ht.stopPropagation(),kt(Mt.id)},className:"w-full flex items-center px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-900 text-red-600",children:[jsxRuntimeExports.jsx(Trash2,{className:"w-4 h-4 mr-3"}),"Delete this notification"]})})]})]})},Mt.id))})]},Dt))})]})})},ConfettiEffect=({show:e,duration:i=3e3})=>{const[d,j]=reactExports.useState([]);return reactExports.useEffect(()=>{if(e){const _e=["#3AC36C","#FFD700","#FF6B6B","#4ECDC4","#45B7D1","#FFA07A"],nt=Array.from({length:50},(c,pt)=>({id:pt,x:Math.random()*100,y:-10,color:_e[Math.floor(Math.random()*_e.length)],rotation:Math.random()*360,delay:Math.random()*.5}));j(nt);const ct=setTimeout(()=>{j([])},i);return()=>clearTimeout(ct)}},[e,i]),!e||d.length===0?null:jsxRuntimeExports.jsxs("div",{className:"fixed inset-0 pointer-events-none z-50 overflow-hidden",children:[d.map(_e=>jsxRuntimeExports.jsx("div",{className:"absolute w-3 h-3 animate-confetti",style:{left:`${_e.x}%`,top:`${_e.y}%`,backgroundColor:_e.color,transform:`rotate(${_e.rotation}deg)`,animationDelay:`${_e.delay}s`,borderRadius:Math.random()>.5?"50%":"0"}},_e.id)),jsxRuntimeExports.jsx("style",{children:`
        @keyframes confetti {
          0% {
            transform: translateY(0) rotate(0deg);
            opacity: 1;
          }
          100% {
            transform: translateY(100vh) rotate(720deg);
            opacity: 0;
          }
        }
        .animate-confetti {
          animation: confetti 3s ease-out forwards;
        }
      `})]})},PaymentScreen=()=>{var ms,Ms;const e=useNavigate(),i=useLocation(),{user:d,token:j,isAuthenticated:_e}=useAppContext();console.log(" PaymentScreen - Component mounted"),console.log(" PaymentScreen - isAuthenticated:",_e),console.log(" PaymentScreen - user:",d),console.log(" PaymentScreen - location.state:",i.state);const[nt,ct]=reactExports.useState("card"),[c,pt]=reactExports.useState(!1),[gt,St]=reactExports.useState(""),[kt,At]=reactExports.useState(!1),[Nt,Vt]=reactExports.useState(!1),{formData:zt,station:Jt,cartItems:Dt=[],selectedFuelFriend:It,subscriptionPlan:Mt,tip:Ht,additionalVehicles:tr,breakdown:er}=i.state||{};if(!_e)return console.log(" PaymentScreen - Not authenticated, redirecting to login"),localStorage.setItem("redirectAfterLogin","/payment"),e("/login"),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Redirecting to login..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"})]})});if(!i.state)return console.log(" PaymentScreen - No state data, redirecting to home"),e("/home"),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Redirecting..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"})]})});const dr={breakdown:er||{fuelCost:32.9,convenienceItemsCost:0,serviceFee:2.99,subscriptionCost:0,vat:7.18,tip:0,total:43.07}},mr=!(d!=null&&d.subscriptionPlan)&&!Mt,Ur=((zt==null?void 0:zt.fuelType)||"").toLowerCase().includes("suv")||((zt==null?void 0:zt.fuelType)||"").toLowerCase().includes("truck")?"suv":"car",Dr=((ms=d==null?void 0:d.city)==null?void 0:ms.toLowerCase())||"",Yr=Dr.includes("london")||Dr.includes("uk")||Dr.includes("england")||Dr.includes("scotland")||Dr.includes("wales")||Dr.includes("ireland");reactExports.useEffect(()=>{(async()=>{try{await apiHealthCheck(),console.log("API connection successful")}catch(xr){console.log("API connection failed:",xr)}})()},[]);const es=async()=>{var Kr,xr;if(console.log(" Place Order clicked - User state:",d),console.log(" User ID:",d==null?void 0:d.id),console.log(" Token:",j),!d){console.log(" No user found, redirecting to login");const jr={formData:zt,station:Jt,cartItems:Dt,selectedFuelFriend:It,subscriptionPlan:Mt,tip:Ht,additionalVehicles:tr,breakdown:er};sessionStorage.setItem("pendingCheckout",JSON.stringify(jr)),localStorage.setItem("redirectAfterLogin","/payment"),alert("Please login to complete your order"),e("/login");return}if(!(Jt!=null&&Jt.id)){alert("Station information missing. Please go back and select a station."),e("/home");return}At(!0);try{await new Promise(Wr=>setTimeout(Wr,2e3));const jr=Yr?.2:.08,rr=(er==null?void 0:er.total)||0,ar=rr*jr,$r=rr+ar,Ar={customerId:d.id.toString(),stationId:Jt.id.toString(),deliveryAddress:(zt==null?void 0:zt.address)||(d==null?void 0:d.address)||(d==null?void 0:d.city)||"Address not provided",deliveryPhone:(zt==null?void 0:zt.phoneNumber)||d.phone||"1234567890",fuelType:(zt==null?void 0:zt.fuelType)||"Premium",fuelQuantity:(((Kr=zt==null?void 0:zt.quantity)==null?void 0:Kr.replace(" liters",""))||"10").toString(),fuelCost:((er==null?void 0:er.fuelCost)||0).toFixed(2),convenienceItemsCost:((er==null?void 0:er.convenienceItemsCost)||0).toFixed(2),serviceFee:((er==null?void 0:er.serviceFee)||0).toFixed(2),nonSubscriberFee:((er==null?void 0:er.nonSubscriberFee)||0).toFixed(2),subscriptionPlanId:(Mt==null?void 0:Mt.id)||null,subscriptionCost:(((xr=er==null?void 0:er.subscriptionPlan)==null?void 0:xr.price)||0).toFixed(2),additionalVehicles:tr||0,additionalVehicleCost:((er==null?void 0:er.additionalVehicleCost)||0).toFixed(2),vat:((er==null?void 0:er.vat)||0).toFixed(2),tip:(Ht||0).toFixed(2),totalAmount:rr.toFixed(2),taxAmount:ar.toFixed(2),grandTotal:$r.toFixed(2),vehicleType:Ur,fuelFriendId:(It==null?void 0:It.id)||"1",fuelFriendName:(It==null?void 0:It.name)||"John Doe",fuelFriendPhoto:(It==null?void 0:It.avatarUrl)||"/fuel friend.png",orderStatus:"pending",paymentMethod:nt==="card"?"credit_card":nt,paymentStatus:"paid",orderDate:new Date().toISOString(),estimatedDeliveryTime:(zt==null?void 0:zt.deliveryTime)||"Instant order",orderType:(zt==null?void 0:zt.orderType)||"instant",cartItems:Dt.map(Wr=>({id:Wr.id,name:Wr.name,price:parseFloat(Wr.price),quantity:parseInt(Wr.quantity)})),currency:Yr?"GBP":"USD",taxRate:jr,taxLabel:Yr?"VAT":"Sales Tax",trackingNumber:`FF-${Math.floor(1e5+Math.random()*9e5)}`,status:"on_the_way",timestamp:new Date().toISOString(),fuelfriend:{name:(It==null?void 0:It.name)||"John Doe",location:(zt==null?void 0:zt.address)||(d==null?void 0:d.address)||(d==null?void 0:d.city)||"On the way to your location",phone:(zt==null?void 0:zt.phoneNumber)||d.phone||"1234567890",avatar:(It==null?void 0:It.avatarUrl)||"/fuel friend.png"}};console.log(" Order data being sent:",{customerId:Ar.customerId,stationId:Ar.stationId,vehicleId:Ar.vehicleId,fuelFriendId:Ar.fuelFriendId,user:d,userVehicles:d==null?void 0:d.vehicles}),It!=null&&It.id&&(Ar.fuelFriendId=It.id.toString());let Xr=null;if(d!=null&&d.vehicles&&d.vehicles.length>0){const Wr=d.vehicles[0];Xr=Wr==null?void 0:Wr.id}!Xr&&(d!=null&&d.id)&&console.log(" No vehicle in user context, will create order without vehicleId"),Xr?(Ar.vehicleId=Xr.toString(),console.log(" Vehicle ID added to order:",Xr)):console.log(" No vehicle found for user, order will be created without vehicleId");const us={success:!0,trackingNumber:Ar.trackingNumber,orderId:`ORD-${Date.now()}`,...Ar};if(us){St(us.trackingNumber),sessionStorage.setItem("lastOrder",JSON.stringify(us));const Wr=sessionStorage.getItem("lastOrder");console.log(" Order stored in sessionStorage:",Wr),console.log(" Order created successfully, showing success modal"),pt(!0),Vt(!0),At(!1)}else throw new Error("Failed to create order")}catch(jr){console.error("Order creation failed:",jr),alert("Failed to create order. Please try again.")}finally{At(!1)}};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white dark:bg-black min-h-screen pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"bg-blue-500 text-white text-center py-1 text-xs",children:["PaymentScreen - Processing: ",kt?"Yes":"No"," | User: ",d?"Found":"Not Found"]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200 dark:border-gray-800",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Payment"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-green-500 border-2 border-green-500 text-white",children:jsxRuntimeExports.jsx(Check,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:"Order"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-0.5 mx-2 bg-green-500"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-green-500 border-2 border-green-500 text-white",children:jsxRuntimeExports.jsx(Check,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:"Order summary"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-0.5 mx-2 bg-green-500"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-green-500 border-2 border-green-500 text-white",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"3"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:"Payment"})]})]})}),jsxRuntimeExports.jsxs("div",{className:"px-4 mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Select Payment Method"}),jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>ct("card"),className:`w-full p-4 border-2 rounded-3xl transition-all duration-200 mobile-button ${nt==="card"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-4",children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${nt==="card"?"border-green-500 bg-green-500":"border-gray-300 dark:border-gray-600"}`,children:nt==="card"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),jsxRuntimeExports.jsx("img",{src:"/Visa.png",alt:"Visa",className:"h-6 w-auto"})]})})}),jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>ct("paypal"),className:`w-full p-4 border-2 rounded-3xl transition-all duration-200 mobile-button ${nt==="paypal"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-4",children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${nt==="paypal"?"border-green-500 bg-green-500":"border-gray-300 dark:border-gray-600"}`,children:nt==="paypal"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),jsxRuntimeExports.jsx("img",{src:"/paypal.png",alt:"PayPal",className:"h-6 w-auto"})]})})}),jsxRuntimeExports.jsx("div",{className:"mb-4",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>ct("apple"),className:`w-full p-4 border-2 rounded-3xl transition-all duration-200 mobile-button ${nt==="apple"?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-4",children:jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${nt==="apple"?"border-green-500 bg-green-500":"border-gray-300 dark:border-gray-600"}`,children:nt==="apple"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})}),jsxRuntimeExports.jsx("img",{src:"/apple.svg",alt:"Apple Pay",className:"h-6 w-auto"})]})})}),jsxRuntimeExports.jsx(TapEffectButton,{className:"w-full p-4 border-2 border-dashed border-gray-300 rounded-3xl text-gray-600 hover:border-green-300 hover:text-green-600 transition-all duration-200 mobile-button",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5"}),jsxRuntimeExports.jsx("span",{className:"font-medium",children:"Add New Payment Method"})]})})]}),jsxRuntimeExports.jsx("div",{className:"mx-4 mb-6",children:jsxRuntimeExports.jsx(CheckoutBreakdownComponent,{breakdown:dr.breakdown,isNonSubscriber:mr,vehicleType:Ur})}),jsxRuntimeExports.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:jsxRuntimeExports.jsx(TapEffectButton,{onClick:es,disabled:kt,className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold disabled:opacity-50 mobile-button haptic-button",style:{borderRadius:"9999px"},children:kt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Processing..."]}):"Place Order"})}),kt&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-8 w-full max-w-sm text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 border-4 border-green-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Processing Order"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Please wait while we process your payment..."})]})}),c&&jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-8 w-full max-w-sm text-center",children:[jsxRuntimeExports.jsx("button",{onClick:()=>pt(!1),className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-green-500 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(Check,{className:"w-10 h-10 text-white"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Your payment has Been made Successfully"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 mb-8",children:["Tracking ID No: ",gt||"#12345"]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 rounded-xl p-4 mb-6 text-left",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Receipt Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-1 text-sm",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Subtotal:"}),jsxRuntimeExports.jsxs("span",{className:"text-gray-900",children:["$",((Ms=er==null?void 0:er.total)==null?void 0:Ms.toFixed(2))||"0.00"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-600",children:"Tax (VAT 20% for UK / Sales Tax 8% for US):"}),jsxRuntimeExports.jsxs("span",{className:"text-gray-900",children:["$",(((er==null?void 0:er.total)||0)*(Yr?.2:.08)).toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between border-t border-gray-200 pt-2 mt-2",children:[jsxRuntimeExports.jsx("span",{className:"font-semibold text-gray-900",children:"Grand Total:"}),jsxRuntimeExports.jsxs("span",{className:"font-semibold text-gray-900",children:["$",(((er==null?void 0:er.total)||0)*(1+(Yr?.2:.08))).toFixed(2)]})]}),jsxRuntimeExports.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-200",children:[jsxRuntimeExports.jsx("div",{className:"text-xs text-gray-500",children:"Status:"}),jsxRuntimeExports.jsx("div",{className:"font-semibold text-green-600",children:"PAID"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:()=>{pt(!1),e("/track")},className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold",children:"Track Order"}),jsxRuntimeExports.jsx("button",{onClick:()=>{pt(!1),e("/home")},className:"w-full text-green-500 text-lg font-medium underline rounded-full py-4",children:"Back To Home"})]})]})}),jsxRuntimeExports.jsx(ConfettiEffect,{show:Nt})]})})},OrderSummaryScreen=()=>{var Vt,zt;console.log(" OrderSummaryScreen component mounted");const e=useNavigate(),i=useLocation();console.log(" OrderSummaryScreen - location.state:",i.state),console.log(" OrderSummaryScreen - location.state type:",typeof i.state);const{formData:d,station:j,cartItems:_e=[],selectedFuelFriend:nt,user:ct,subscriptionPlan:c,tip:pt,additionalVehicles:gt,breakdown:St}=i.state||{};if(console.log(" OrderSummaryScreen - location.state:",i.state),console.log(" OrderSummaryScreen - station:",j),console.log(" OrderSummaryScreen - cartItems:",_e),console.log(" OrderSummaryScreen - selectedFuelFriend:",nt),console.log(" OrderSummaryScreen - breakdown:",St),console.log(" OrderSummaryScreen - user:",ct),!i.state)return console.log(" OrderSummaryScreen - No state data, redirecting to home"),e("/home"),jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen bg-white",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-4",children:"Redirecting..."}),jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-500 mx-auto"})]})});const kt={station:j||{id:"default-station",name:"Fuel Station",address:"Station Address",fuelPrices:{regular:3.29,premium:3.79,diesel:3.59},regularPrice:3.29,deliveryTime:"15-20 mins",rating:4.5,reviewCount:128},cartItems:_e||[],selectedFuelFriend:nt||null,breakdown:St||{fuelCost:32.9,convenienceItemsCost:0,serviceFee:2.99,subscriptionCost:0,vat:7.18,tip:0,total:43.07}},At=!(ct!=null&&ct.subscriptionPlan)&&!c,Nt=(Vt=d==null?void 0:d.fuelType)!=null&&Vt.toLowerCase().includes("suv")||(zt=d==null?void 0:d.fuelType)!=null&&zt.toLowerCase().includes("truck")?"suv":"car";return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"bg-white min-h-screen pb-24",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between px-4 py-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Order summary"}),jsxRuntimeExports.jsx("div",{className:"w-10"})]}),jsxRuntimeExports.jsx("div",{className:"px-4 py-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-8",children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-green-500 border-2 border-green-500 text-white",children:jsxRuntimeExports.jsx(Check,{className:"w-6 h-6"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 mt-2",children:"Order"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-0.5 mx-2 bg-green-500"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center bg-green-500 border-2 border-green-500 text-white",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"2"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 mt-2",children:"Order summary"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-0.5 mx-2 bg-gray-300"}),jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center border-2 border-gray-300 text-gray-400",children:jsxRuntimeExports.jsx("span",{className:"font-semibold",children:"3"})}),jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600 mt-2",children:"Payment"})]})]})}),jsxRuntimeExports.jsx("div",{className:"mx-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-2xl p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 text-center mb-6",children:"Fuel order details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Station Name"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:kt.station.name})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Fuel Type"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:(d==null?void 0:d.fuelType)||"Regular"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Quantity"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:(d==null?void 0:d.quantity)||"10 liters"})]}),kt.cartItems.map(Jt=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-700",children:[Jt.name," (x",Jt.quantity,")"]}),jsxRuntimeExports.jsxs("span",{className:"text-gray-900 font-medium",children:["$",(Jt.price*Jt.quantity).toFixed(2)]})]},Jt.id)),kt.selectedFuelFriend&&jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Fuel Friend"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:kt.selectedFuelFriend.name||kt.selectedFuelFriend.fullName})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Pickup Time"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:(d==null?void 0:d.deliveryTime)||"15-20 mins"})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Vehicle"}),jsxRuntimeExports.jsxs("span",{className:"text-gray-900 font-medium",children:[(d==null?void 0:d.vehicleBrand)||"Toyota"," (",(d==null?void 0:d.vehicleColor)||"Silver",")"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"License Number"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:(d==null?void 0:d.numberPlate)||"N/A"})]})]})]})}),jsxRuntimeExports.jsx("div",{className:"px-4 mb-6",children:jsxRuntimeExports.jsx(CheckoutBreakdownComponent,{breakdown:kt.breakdown,isNonSubscriber:At,vehicleType:Nt})}),jsxRuntimeExports.jsxs("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-200",children:[jsxRuntimeExports.jsx("button",{onClick:()=>e("/payment",{state:{formData:d,station:kt.station,cartItems:kt.cartItems,selectedFuelFriend:kt.selectedFuelFriend,user:ct,subscriptionPlan:c,tip:pt,additionalVehicles:gt,breakdown:kt.breakdown}}),className:"w-full bg-green-500 text-white py-4 rounded-full text-lg font-semibold mb-4",children:"Confirm Payment & Address"}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/home"),className:"w-full text-green-500 text-lg font-medium rounded-full py-4",children:"Edit Details"})]})]})})},LogoutModal=({isOpen:e,onClose:i})=>{const d=useNavigate(),{logout:j}=useAppContext(),_e=()=>{j(),d("/login")};return e?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999] px-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(Lock,{className:"w-8 h-8 text-gray-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-semibold text-gray-900 text-center mb-2",children:"Log Out?"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-center mb-6",children:"Are you sure want to log out?"}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3",children:[jsxRuntimeExports.jsx("button",{onClick:i,className:"flex-1 py-3 border border-gray-300 text-gray-700 rounded-full font-medium hover:bg-gray-50 transition-colors",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:_e,className:"flex-1 py-3 bg-red-500 text-white rounded-full font-medium hover:bg-red-600 transition-colors",children:"Log Out"})]})]})}):null},ProfileScreen=()=>{var er;const e=useNavigate(),{user:i,logout:d,updateUser:j}=useAppContext(),[_e,nt]=reactExports.useState(!1),[ct,c]=reactExports.useState(i),[pt,gt]=reactExports.useState(!1),[St,kt]=reactExports.useState(!1),[At,Nt]=reactExports.useState(!1),[Vt,zt]=reactExports.useState(""),[Jt,Dt]=reactExports.useState(!1);if(reactExports.useEffect(()=>{i?(gt(!0),c(i)):gt(!1)},[i]),!pt)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center sticky top-0 bg-white z-10 shadow-sm",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-center flex-grow -ml-10 text-[#3F4249]",children:"My Profile"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsxs("svg",{width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"#9CA3AF",strokeWidth:"2",children:[jsxRuntimeExports.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),jsxRuntimeExports.jsx("circle",{cx:"12",cy:"7",r:"4"})]})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to view and edit your profile information."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})]})});if(!ct)return jsxRuntimeExports.jsx("div",{children:"Loading profile..."});const It=dr=>{const{name:mr,value:Ur}=dr.target;if(mr.startsWith("vehicle.")){const Dr=mr.split(".")[1];c(Yr=>{if(!Yr)return null;const es=[...Yr.vehicles||[]];return es.length===0&&es.push({brand:"",color:"",licenseNumber:"",fuelType:"Petrol"}),es[0][Dr]=Ur,{...Yr,vehicles:es}})}else c(Dr=>Dr?{...Dr,[mr]:Ur}:null)},Mt=async()=>{if(ct){Nt(!0),zt("");try{const dr={customerId:i==null?void 0:i.id,fullName:ct.fullName,email:ct.email,phoneNumber:ct.phone,city:ct.city,gender:ct.gender,vehicle:{brand:tr.brand,color:tr.color,licenseNumber:tr.licenseNumber}},mr=await apiUpdateProfile(dr),Ur={...i,...mr.customer,vehicles:mr.vehicles};j(Ur),c(Ur),nt(!1)}catch(dr){zt(dr.message||"Failed to update profile")}finally{Nt(!1)}}},Ht=()=>{c(i),nt(!1)},tr=((er=ct.vehicles)==null?void 0:er[0])||{};return jsxRuntimeExports.jsxs(AnimatedPage,{children:[jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white dark:bg-black",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center justify-between sticky top-0 bg-white dark:bg-black z-10 shadow-sm border-b border-gray-100 dark:border-gray-800",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>_e?Ht():e("/home"),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-bold text-[#3F4249] dark:text-white",children:"My Profile"}),jsxRuntimeExports.jsx("button",{onClick:()=>nt(!_e),className:`p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors ${_e?"text-[#3AC36C]":"text-gray-600 dark:text-gray-400"}`,children:jsxRuntimeExports.jsx(SquarePen,{size:24})})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[Vt&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3 mb-4",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:Vt})}),jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center space-y-4 mb-8",children:jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("img",{src:ct.avatarUrl,alt:"Profile",className:"w-24 h-24 rounded-full object-cover border-4 border-gray-200 shadow-lg",onError:dr=>{dr.currentTarget.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='96' height='96' viewBox='0 0 96 96'%3E%3Ccircle cx='48' cy='48' r='48' fill='%23e5e7eb'/%3E%3Cpath d='M48 24a12 12 0 1 0 0 24 12 12 0 0 0 0-24zM24 72a24 24 0 0 1 48 0H24z' fill='%23999'/%3E%3C/svg%3E"}}),_e&&jsxRuntimeExports.jsx("button",{className:"absolute bottom-0 right-0 p-2 bg-[#3AC36C] text-white rounded-full shadow-lg hover:bg-[#2ea85a] transition-colors",children:jsxRuntimeExports.jsx(Camera,{size:20})})]})}),jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-[#3F4249] mb-4",children:"Personal Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Full Name"}),jsxRuntimeExports.jsx("input",{type:"text",name:"fullName",value:ct.fullName,onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Gender"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>_e&&Dt(!Jt),disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600 text-left flex items-center justify-between",children:[jsxRuntimeExports.jsx("span",{children:ct.gender||"Male"}),_e&&jsxRuntimeExports.jsx(ChevronDown,{size:20,className:"text-gray-400"})]}),Jt&&_e&&jsxRuntimeExports.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10",children:[jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{It({target:{name:"gender",value:"Male"}}),Dt(!1)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center",children:[jsxRuntimeExports.jsx("div",{className:`w-4 h-4 rounded-full border-2 mr-3 flex items-center justify-center ${ct.gender==="Male"?"border-[#3AC36C]":"border-gray-300"}`,children:ct.gender==="Male"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-[#3AC36C]"})}),"Male"]}),jsxRuntimeExports.jsxs("button",{type:"button",onClick:()=>{It({target:{name:"gender",value:"Female"}}),Dt(!1)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 flex items-center",children:[jsxRuntimeExports.jsx("div",{className:`w-4 h-4 rounded-full border-2 mr-3 flex items-center justify-center ${ct.gender==="Female"?"border-[#3AC36C]":"border-gray-300"}`,children:ct.gender==="Female"&&jsxRuntimeExports.jsx("div",{className:"w-2 h-2 rounded-full bg-[#3AC36C]"})}),"Female"]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Phone Number"}),jsxRuntimeExports.jsx("input",{type:"tel",name:"phone",value:ct.phone,onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Email Address"}),jsxRuntimeExports.jsx("input",{type:"email",name:"email",value:ct.email,onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"City of Residence"}),jsxRuntimeExports.jsx("input",{type:"text",name:"city",value:ct.city,onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-bold text-lg text-[#3F4249] mb-4",children:"Vehicle Details"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Vehicle Make and Model"}),jsxRuntimeExports.jsx("input",{type:"text",name:"vehicle.brand",value:tr.brand||"",onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"Vehicle Color"}),jsxRuntimeExports.jsx("input",{type:"text",name:"vehicle.color",value:tr.color||"",onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-sm text-gray-600 mb-2 block",children:"License Number"}),jsxRuntimeExports.jsx("input",{type:"text",name:"vehicle.licenseNumber",value:tr.licenseNumber||"",onChange:It,disabled:!_e,className:"w-full px-4 py-3 rounded-full border border-gray-300 bg-white focus:outline-none focus:ring-2 focus:ring-[#3AC36C] focus:border-[#3AC36C] disabled:bg-gray-50 disabled:text-gray-600"})]})]})]})]}),jsxRuntimeExports.jsx("div",{className:"mt-8 mb-20",children:_e?jsxRuntimeExports.jsx("button",{onClick:Mt,disabled:At,className:"w-full bg-[#3AC36C] text-white py-4 rounded-full font-bold hover:bg-[#2ea85a] transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",children:At?"Saving...":"Save"}):jsxRuntimeExports.jsxs("button",{onClick:()=>kt(!0),className:"w-full bg-red-500 text-white py-4 rounded-full font-bold hover:bg-red-600 transition-colors shadow-lg flex items-center justify-center",children:[jsxRuntimeExports.jsx(LogOut,{size:20,className:"mr-2"}),"Sign Out"]})})]})]}),jsxRuntimeExports.jsx(LogoutModal,{isOpen:St,onClose:()=>kt(!1)})]})},PasswordChangeSuccessModal=({isOpen:e,onClose:i})=>{const d=useNavigate(),j=()=>{i(),d("/home")},_e=()=>{i()};return e?jsxRuntimeExports.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-sm relative",children:[jsxRuntimeExports.jsx("button",{onClick:_e,className:"absolute top-4 right-4 p-1 text-gray-400 hover:text-gray-600",children:jsxRuntimeExports.jsx(X,{size:20})}),jsxRuntimeExports.jsx("div",{className:"flex justify-center mb-6 mt-4",children:jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-[#3AC36C] rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Check,{size:32,className:"text-white"})})}),jsxRuntimeExports.jsxs("div",{className:"text-center mb-8",children:[jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Your password has been"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Changed successfully"})]}),jsxRuntimeExports.jsx("button",{onClick:j,className:"w-full py-4 bg-[#3AC36C] text-white rounded-full font-semibold text-base hover:bg-[#2ea85a] transition-colors",children:"Back To Home"})]})}):null},ManagePasswordScreen=()=>{const e=useNavigate(),{user:i}=useAppContext(),[d,j]=reactExports.useState(!1),[_e,nt]=reactExports.useState(!1),[ct,c]=reactExports.useState(!1),[pt,gt]=reactExports.useState(!1),[St,kt]=reactExports.useState(i),[At,Nt]=reactExports.useState(!1),[Vt,zt]=reactExports.useState(""),[Jt,Dt]=reactExports.useState(!1),[It,Mt]=reactExports.useState({email:(i==null?void 0:i.email)||"",currentPassword:"",oldPassword:"",newPassword:"",confirmPassword:""});reactExports.useEffect(()=>{const dr=localStorage.getItem("user"),mr=localStorage.getItem("token");if(!dr||!mr){gt(!1);return}try{const Ur=JSON.parse(dr);kt(Ur),gt(!0),Mt(Dr=>({...Dr,email:Ur.email||""}))}catch(Ur){console.error("Failed to parse user data:",Ur),gt(!1)}},[]);const Ht=()=>{localStorage.setItem("redirectAfterLogin","/manage-password"),e("/login")},tr=dr=>{Mt({...It,[dr.target.name]:dr.target.value})},er=async()=>{if(!pt){Ht();return}if(Nt(!0),zt(""),!It.currentPassword){zt("Current password is required"),Nt(!1);return}if(!It.newPassword){zt("New password is required"),Nt(!1);return}if(It.newPassword!==It.confirmPassword){zt("New passwords do not match"),Nt(!1);return}if(It.newPassword.length<6){zt("New password must be at least 6 characters"),Nt(!1);return}try{await apiChangePassword((St==null?void 0:St.id)||(i==null?void 0:i.id)||"",It.currentPassword,It.newPassword),Dt(!0),Mt({...It,currentPassword:"",oldPassword:"",newPassword:"",confirmPassword:""})}catch(dr){zt(dr.message||"Failed to change password")}finally{Nt(!1)}};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Manage Password"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-6",children:[pt?null:jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5 text-yellow-600 mr-2"}),jsxRuntimeExports.jsxs("p",{className:"text-yellow-800 text-sm",children:["You are not logged in. ",jsxRuntimeExports.jsx("button",{onClick:Ht,className:"text-[#3AC36C] font-medium underline",children:"Login"})," to change your password."]})]})}),pt?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[Vt&&jsxRuntimeExports.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-3",children:jsxRuntimeExports.jsx("p",{className:"text-red-600 text-sm text-center",children:Vt})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium mb-4",children:"Current Password"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-600 text-sm mb-2 block",children:"Email"}),jsxRuntimeExports.jsx("input",{type:"email",name:"email",value:It.email,onChange:tr,className:"w-full px-4 py-3 border border-gray-300 rounded-full bg-gray-50 text-gray-600",readOnly:!0})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-600 text-sm mb-2 block",children:"Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:d?"text":"password",name:"currentPassword",value:It.currentPassword,onChange:tr,placeholder:"password",className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:border-[#3AC36C]"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>j(!d),className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:d?jsxRuntimeExports.jsx(EyeOff,{size:20,className:"text-gray-400"}):jsxRuntimeExports.jsx(Eye,{size:20,className:"text-gray-400"})})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium mb-4",children:"Change Current Password"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-600 text-sm mb-2 block",children:"Enter Old Password"}),jsxRuntimeExports.jsx("input",{type:"email",name:"oldPassword",value:It.oldPassword,onChange:tr,placeholder:"robinabc35@gmail.com",className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:border-[#3AC36C]"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-600 text-sm mb-2 block",children:"Write New Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:_e?"text":"password",name:"newPassword",value:It.newPassword,onChange:tr,placeholder:"Password",className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:border-[#3AC36C]"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>nt(!_e),className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:_e?jsxRuntimeExports.jsx(EyeOff,{size:20,className:"text-gray-400"}):jsxRuntimeExports.jsx(Eye,{size:20,className:"text-gray-400"})})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-600 text-sm mb-2 block",children:"Confirm New Password"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("input",{type:ct?"text":"password",name:"confirmPassword",value:It.confirmPassword,onChange:tr,placeholder:"Password",className:"w-full px-4 py-3 border border-gray-300 rounded-full focus:outline-none focus:border-[#3AC36C]"}),jsxRuntimeExports.jsx("button",{type:"button",onClick:()=>c(!ct),className:"absolute right-4 top-1/2 transform -translate-y-1/2",children:ct?jsxRuntimeExports.jsx(EyeOff,{size:20,className:"text-gray-400"}):jsxRuntimeExports.jsx(Eye,{size:20,className:"text-gray-400"})})]})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:er,disabled:At,className:"w-full py-4 bg-[#3AC36C] text-white rounded-full font-semibold text-base hover:bg-[#2ea85a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed ios-button active:scale-96",children:At?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Changing Password..."]}):"Password Change"})]}):jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(Lock,{className:"w-8 h-8 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Password Management"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Log in to manage your password and security settings."}),jsxRuntimeExports.jsx("button",{onClick:Ht,className:"bg-[#3AC36C] text-white px-6 py-3 rounded-full font-medium hover:bg-[#2ea85a] transition-colors",children:"Log In to Manage Password"})]})]}),jsxRuntimeExports.jsx(PasswordChangeSuccessModal,{isOpen:Jt,onClose:()=>Dt(!1)})]})})};var Theme=(e=>(e.LIGHT="light",e.DARK="dark",e.DEFAULT="default",e))(Theme||{});const ThemeScreen=()=>{const e=useNavigate(),{theme:i,setTheme:d}=useAppContext(),j=[{id:Theme.LIGHT,name:"Light Mode",icon:jsxRuntimeExports.jsx(Sun,{size:20,className:"text-gray-600"})},{id:Theme.DARK,name:"Dark Mode",icon:jsxRuntimeExports.jsx(Moon,{size:20,className:"text-gray-600"})},{id:Theme.DEFAULT,name:"System Default",icon:jsxRuntimeExports.jsx(Settings,{size:20,className:"text-gray-600"})}],_e=nt=>{d(nt),console.log("Theme changed to:",nt)};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white dark:bg-gray-900 border-b border-gray-100 dark:border-gray-700",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e(-1),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900 dark:text-white",children:"Theme"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 dark:text-white font-medium text-lg mb-2",children:"Appearance"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"Select your preferred theme"})]}),jsxRuntimeExports.jsx("div",{className:"space-y-0",children:j.map((nt,ct)=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("button",{onClick:()=>_e(nt.id),className:"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"mr-4",children:React.cloneElement(nt.icon,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),jsxRuntimeExports.jsx("span",{className:"text-gray-800 dark:text-gray-200 text-base",children:nt.name})]}),jsxRuntimeExports.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${i===nt.id?"border-[#3AC36C] bg-white dark:bg-gray-800":"border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800"}`,children:i===nt.id&&jsxRuntimeExports.jsx("div",{className:"w-3 h-3 rounded-full bg-[#3AC36C]"})})]}),ct<j.length-1&&jsxRuntimeExports.jsx("div",{className:"border-t border-gray-100 dark:border-gray-700 ml-12"})]},nt.id))})]})]})})},FuelEfficiencyCalculatorScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState({totalDistance:"80",fuelFilled:"10",fuelCostPerLiter:"30"}),[j,_e]=reactExports.useState({monthlyUsage:0,monthlyCost:0,fuelEfficiency:0}),nt=pt=>{const{name:gt,value:St}=pt.target;d({...i,[gt]:St})};reactExports.useEffect(()=>{const pt=parseFloat(i.totalDistance)||0,gt=parseFloat(i.fuelFilled)||0,St=parseFloat(i.fuelCostPerLiter)||0;if(pt>0&&gt>0){const kt=pt/gt,Vt=pt*4/kt,zt=Vt*St;_e({monthlyUsage:Math.round(Vt),monthlyCost:Math.round(zt),fuelEfficiency:parseFloat(kt.toFixed(1))})}else _e({monthlyUsage:0,monthlyCost:0,fuelEfficiency:0})},[i]);const ct=[{day:"MON",value:8},{day:"TUE",value:12},{day:"WED",value:18},{day:"THU",value:10},{day:"FRI",value:15},{day:"SAT",value:20},{day:"SUN",value:16}],c=Math.max(...ct.map(pt=>pt.value));return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Fuel Efficiency Calculator"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-6",children:[jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Track your fuel consumption and optimize your fuel usage. Enter your weekly driving data below."})}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-700 text-sm mb-2 block",children:"Total Distance Driven (KM)"}),jsxRuntimeExports.jsx("input",{type:"number",name:"totalDistance",value:i.totalDistance,onChange:nt,placeholder:"80 KM",min:"0",step:"0.1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#3AC36C]"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-700 text-sm mb-2 block",children:"Fuel Filled (Liters)"}),jsxRuntimeExports.jsx("input",{type:"number",name:"fuelFilled",value:i.fuelFilled,onChange:nt,placeholder:"10 L",min:"0",step:"0.1",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#3AC36C]"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-700 text-sm mb-2 block",children:"Fuel Cost Per Liter (Optional)"}),jsxRuntimeExports.jsx("input",{type:"number",name:"fuelCostPerLiter",value:i.fuelCostPerLiter,onChange:nt,placeholder:"$30/L",min:"0",step:"0.01",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#3AC36C]"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium text-lg mb-4",children:"Fuel Efficiency & Monthly Estimates"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Fuel,{className:"w-5 h-5 text-gray-500 mr-3"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Estimated Monthly Usage"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-900 font-semibold",children:[j.monthlyUsage," Liters"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(DollarSign,{className:"w-5 h-5 text-gray-500 mr-3"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Estimated Monthly Cost"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-900 font-semibold",children:["$",j.monthlyCost]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-5 h-5 text-gray-500 mr-3"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Fuel Efficiency"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-900 font-semibold",children:[j.fuelEfficiency," KM/L"]})]})]})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium",children:"Fuel Usage Trends"}),jsxRuntimeExports.jsx("span",{className:"text-gray-500 text-sm",children:"Week"})]}),jsxRuntimeExports.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[jsxRuntimeExports.jsx("div",{className:"flex items-end justify-between h-32 mb-2",children:ct.map((pt,gt)=>jsxRuntimeExports.jsx("div",{className:"flex flex-col items-center flex-1",children:jsxRuntimeExports.jsx("div",{className:"w-6 bg-[#3AC36C] rounded-t-sm mb-1",style:{height:`${pt.value/c*100}px`,minHeight:"8px"}})},gt))}),jsxRuntimeExports.jsx("div",{className:"flex justify-between text-xs text-gray-500",children:ct.map((pt,gt)=>jsxRuntimeExports.jsx("span",{className:"flex-1 text-center",children:pt.day},gt))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium text-lg mb-4",children:"Fuel-Saving Tips"}),jsxRuntimeExports.jsxs("div",{className:"space-y-2",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full mt-2 mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Maintain proper tire pressure"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full mt-2 mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Avoid excessive idling"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full mt-2 mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Drive at a steady speed"})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-gray-400 rounded-full mt-2 mr-3 flex-shrink-0"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Use cruise control on highways"})]})]})]})]})]})})},PaymentMethodsScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState([{id:"1",type:"Visa",lastFour:"4242",expiry:"12/25",isDefault:!0},{id:"2",type:"Mastercard",lastFour:"5893",expiry:"08/24",isDefault:!1},{id:"3",type:"PayPal",lastFour:"",expiry:"",isDefault:!1}]),[j,_e]=reactExports.useState(!1),[nt,ct]=reactExports.useState({type:"Visa",number:"",expiry:"",cvv:""}),c=St=>{d(kt=>kt.map(At=>({...At,isDefault:At.id===St})))},pt=St=>{if(i.length<=1){alert("You must have at least one payment method.");return}d(kt=>kt.filter(At=>At.id!==St))},gt=()=>{if(nt.number.length<16){alert("Please enter a valid card number");return}const St=nt.number.slice(-4);d(kt=>[...kt,{id:(kt.length+1).toString(),type:nt.type,lastFour:St,expiry:nt.expiry,isDefault:kt.length===0}]),ct({type:"Visa",number:"",expiry:"",cvv:""}),_e(!1)};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Payment Methods"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium mb-4",children:"Saved Cards"}),jsxRuntimeExports.jsx("div",{className:"space-y-3",children:i.map(St=>jsxRuntimeExports.jsx("div",{className:`p-4 border rounded-xl ${St.isDefault?"border-green-500 bg-green-50":"border-gray-200 bg-white"}`,children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx("div",{className:"mr-3 p-2 bg-gray-100 rounded-lg",children:jsxRuntimeExports.jsx(CreditCard,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("div",{className:"font-medium text-gray-900",children:[St.type," ",St.lastFour?` ${St.lastFour}`:""]}),St.expiry&&jsxRuntimeExports.jsxs("div",{className:"text-sm text-gray-500",children:["Expires ",St.expiry]}),St.isDefault&&jsxRuntimeExports.jsxs("div",{className:"flex items-center mt-1",children:[jsxRuntimeExports.jsx(Check,{className:"w-3 h-3 text-green-600 mr-1"}),jsxRuntimeExports.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Default"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>c(St.id),className:`px-3 py-1 rounded-full text-xs font-medium ${St.isDefault?"bg-green-100 text-green-700":"bg-gray-100 text-gray-600"}`,children:St.isDefault?"Default":"Set Default"}),jsxRuntimeExports.jsx("button",{onClick:()=>pt(St.id),className:"p-2 text-gray-400 hover:text-red-500",children:jsxRuntimeExports.jsx(Trash2,{size:16})})]})]})},St.id))})]}),j?jsxRuntimeExports.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Add New Card"}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Card Number"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"1234 5678 9012 3456",value:nt.number,onChange:St=>ct({...nt,number:St.target.value.replace(/\D/g,"")}),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"Expiry Date"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"MM/YY",value:nt.expiry,onChange:St=>ct({...nt,expiry:St.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"CVV"}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"123",value:nt.cvv,onChange:St=>ct({...nt,cvv:St.target.value}),className:"w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3 pt-2",children:[jsxRuntimeExports.jsx("button",{onClick:()=>_e(!1),className:"flex-1 py-3 border border-gray-300 rounded-lg text-gray-700 font-medium",children:"Cancel"}),jsxRuntimeExports.jsx("button",{onClick:gt,className:"flex-1 py-3 bg-green-500 text-white rounded-lg font-medium",children:"Save Card"})]})]})]}):jsxRuntimeExports.jsxs("button",{onClick:()=>_e(!0),className:"w-full py-4 border-2 border-dashed border-gray-300 rounded-xl text-gray-600 font-medium flex items-center justify-center",children:[jsxRuntimeExports.jsx(Plus,{className:"w-5 h-5 mr-2"}),"Add New Payment Method"]})]})]})})},NotificationSettingsScreen=()=>{const e=useNavigate(),{user:i,isAuthenticated:d}=useAppContext(),[j,_e]=reactExports.useState(!1),[nt,ct]=reactExports.useState({orderUpdates:!0,paymentConfirmations:!0,orderCancellations:!1,fuelDelivery:!0,safetyAlerts:!1});reactExports.useEffect(()=>{if(!d||!i){_e(!1);return}_e(!0);const kt=localStorage.getItem("notificationSettings");if(kt)try{ct(JSON.parse(kt))}catch(At){console.error("Error loading notification settings:",At)}},[d,i]);const c=()=>{localStorage.setItem("redirectAfterLogin","/notification-settings"),e("/login")},pt=kt=>{const At={...nt,[kt]:!nt[kt]};ct(At),j&&localStorage.setItem("notificationSettings",JSON.stringify(At))},gt=()=>{e("/theme")},St=({icon:kt,title:At,description:Nt,isEnabled:Vt,onToggle:zt,isClickable:Jt=!1})=>jsxRuntimeExports.jsxs("div",{className:"flex items-start space-x-3 py-4",children:[jsxRuntimeExports.jsx("div",{className:"mt-1",children:kt}),jsxRuntimeExports.jsxs("div",{className:"flex-1",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:At}),Nt&&jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500 mt-1",children:Nt})]}),Jt?jsxRuntimeExports.jsx("button",{onClick:zt,className:"p-2 hover:bg-gray-100 rounded-full transition-colors",children:jsxRuntimeExports.jsx(ChevronRight,{className:"w-4 h-4 text-gray-400"})}):jsxRuntimeExports.jsx("button",{onClick:zt,className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors ${Vt?"bg-[#3AC36C]":"bg-gray-300"}`,children:jsxRuntimeExports.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${Vt?"translate-x-6":"translate-x-1"}`})})]});return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Notification Settings"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-6",children:[j?null:jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5 text-yellow-600 mr-2"}),jsxRuntimeExports.jsxs("p",{className:"text-yellow-800 text-sm",children:["You are not logged in. ",jsxRuntimeExports.jsx("button",{onClick:c,className:"text-[#3AC36C] font-medium underline",children:"Login"})," to save your notification preferences."]})]})}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Customize your notification preferences to stay updated."}),jsxRuntimeExports.jsxs("div",{className:"space-y-1",children:[jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(Bell,{className:"w-5 h-5 text-[#3AC36C]"}),title:"Order Updates",description:"Get notified about your fuel order status",isEnabled:nt.orderUpdates,onToggle:()=>pt("orderUpdates")}),jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(CreditCard,{className:"w-5 h-5 text-[#3AC36C]"}),title:"Payment Confirmations",description:"Get notified when a transaction is successful",isEnabled:nt.paymentConfirmations,onToggle:()=>pt("paymentConfirmations")}),jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-gray-400"}),title:"Order Cancellation Updates",description:"Get notified if an order is cancelled",isEnabled:nt.orderCancellations,onToggle:()=>pt("orderCancellations")}),jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(Truck,{className:"w-5 h-5 text-[#3AC36C]"}),title:"Fuel Delivery Updates",description:"Get notified before a scheduled fuel delivery.",isEnabled:nt.fuelDelivery,onToggle:()=>pt("fuelDelivery")}),jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(X,{className:"w-5 h-5 text-gray-400"}),title:"Safety Alerts",description:"Receive important safety notifications",isEnabled:nt.safetyAlerts,onToggle:()=>pt("safetyAlerts")}),jsxRuntimeExports.jsx(St,{icon:jsxRuntimeExports.jsx(Moon,{className:"w-5 h-5 text-gray-900"}),title:"Change Theme",description:"",isClickable:!0,onToggle:gt})]})]})]})})},SupportHelpScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState(0),j=[{question:"How does the fuel delivery service work?",answer:"Our fuel delivery service connects you with nearby fuel stations and fuel friends who can deliver fuel to your location. Simply select a station, choose your fuel type and amount, and we'll deliver it to your vehicle."},{question:"Can I order Groceries with fuel?",answer:"Yes! You can add groceries and snacks to your fuel order. Browse our selection of convenience items and add them to your cart along with your fuel purchase."},{question:"How does the fuel delivery service work?",answer:"Our delivery process is simple: place your order, track your delivery in real-time, and our certified delivery partner will arrive at your location with your fuel and any additional items you ordered."},{question:"How do I manage my profile?",answer:"You can manage your profile by going to Settings > My Profile. There you can update your personal information, vehicle details, and delivery preferences."},{question:"What payment methods are accepted?",answer:"We accept all major credit cards, debit cards, digital wallets, and mobile payment methods. You can manage your payment methods in the Settings section."}],_e=c=>{d(i===c?null:c)},nt=()=>{e("/live-chat")},ct=()=>{e("/report-issue")};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Support & help"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"Need help with Fuelfriendly? Find answers to common questions or contact our support team."}),jsxRuntimeExports.jsxs("div",{className:"mb-8",children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium mb-4",children:"Frequently Asked Questions"}),jsxRuntimeExports.jsx("div",{className:"space-y-2",children:j.map((c,pt)=>jsxRuntimeExports.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>_e(pt),className:"w-full px-4 py-4 text-left flex items-center justify-between hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium text-sm pr-2",children:c.question}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-5 h-5 text-gray-400 transition-transform flex-shrink-0 ${i===pt?"rotate-180":""}`})]}),i===pt&&jsxRuntimeExports.jsx("div",{className:"px-4 pb-4 border-t border-gray-100",children:jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm leading-relaxed pt-3",children:c.answer})})]},pt))})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"text-gray-900 font-medium mb-4",children:"Contact Support"}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsxs("button",{onClick:nt,className:"w-full flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx(MessageCircle,{className:"w-5 h-5 text-gray-600 mr-3"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:"Live Chat Support"})]}),jsxRuntimeExports.jsxs("button",{onClick:ct,className:"w-full flex items-center p-4 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:[jsxRuntimeExports.jsx(TriangleAlert,{className:"w-5 h-5 text-gray-600 mr-3"}),jsxRuntimeExports.jsx("span",{className:"text-gray-900 font-medium",children:"Report an Issue"})]})]})]})]})]})})},LiveChatSupportScreen=()=>{const e=useNavigate(),{user:i,isAuthenticated:d}=useAppContext(),[j,_e]=reactExports.useState([]),[nt,ct]=reactExports.useState(""),c=reactExports.useRef(null);if(reactExports.useEffect(()=>{d&&i&&_e([{id:"1",text:"Hello! Welcome to FuelFriend support. How can I help you with your fuel pickup today?",isUser:!1,timestamp:"23:20"}])},[d,i]),!d)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen flex flex-col bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/support-help"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Live Chat Support"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(Send,{className:"w-10 h-10 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to start a live chat with our support team."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})]})});const pt=()=>{var kt;(kt=c.current)==null||kt.scrollIntoView({behavior:"smooth"})};reactExports.useEffect(()=>{pt()},[j]);const gt=()=>{if(nt.trim()==="")return;const kt={id:Date.now().toString(),text:nt,isUser:!0,timestamp:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})};_e(At=>[...At,kt]),ct(""),setTimeout(()=>{const At={id:(Date.now()+1).toString(),text:"I can help you with that! Let me check the status of your fuel pickup order TRK-123456789. One moment please...",isUser:!1,timestamp:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})};_e(Nt=>[...Nt,At]),setTimeout(()=>{const Nt={id:(Date.now()+2).toString(),text:"I can see your order is currently being prepared at the station. Your fuel will be ready for pickup at 123 Main Street in approximately 12 minutes. Is there anything specific about your pickup you'd like to know?",isUser:!1,timestamp:new Date().toLocaleTimeString("en-US",{hour12:!1,hour:"2-digit",minute:"2-digit"})};_e(Vt=>[...Vt,Nt])},2e3)},2e3)},St=kt=>{kt.key==="Enter"&&gt()};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white flex flex-col",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/support-help"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Live Chat Support"})]}),jsxRuntimeExports.jsxs("div",{className:"flex-1 p-4 overflow-y-auto",children:[jsxRuntimeExports.jsx("div",{className:"space-y-4",children:j.map(kt=>jsxRuntimeExports.jsx("div",{className:`flex ${kt.isUser?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-2xl ${kt.isUser?"bg-[#3AC36C] text-white":"bg-gray-100 text-gray-900"}`,children:[jsxRuntimeExports.jsx("p",{className:"text-sm",children:kt.text}),jsxRuntimeExports.jsx("p",{className:`text-xs mt-1 ${kt.isUser?"text-green-100":"text-gray-500"}`,children:kt.timestamp})]})},kt.id))}),jsxRuntimeExports.jsx("div",{ref:c})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 border-t border-gray-100",children:[jsxRuntimeExports.jsx("div",{className:"flex items-center space-x-3",children:jsxRuntimeExports.jsxs("div",{className:"flex-1 relative",children:[jsxRuntimeExports.jsx("input",{type:"text",value:nt,onChange:kt=>ct(kt.target.value),onKeyPress:St,placeholder:"Ask about your fuel pickup, order status, or any other support...",className:"w-full px-4 py-3 pr-12 border border-gray-300 rounded-full focus:outline-none focus:border-[#3AC36C] text-sm"}),jsxRuntimeExports.jsx("button",{onClick:gt,disabled:nt.trim()==="",className:"absolute right-2 top-1/2 transform -translate-y-1/2 p-2 text-[#3AC36C] hover:bg-green-50 rounded-full transition-colors disabled:text-gray-300 disabled:hover:bg-transparent",children:jsxRuntimeExports.jsx(Send,{className:"w-4 h-4"})})]})}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500 text-center mt-2",children:"Fuel pickup support typically responds within 2 minutes"})]})]})})},ReportIssueScreen=()=>{const e=useNavigate(),{user:i}=useAppContext(),[d,j]=reactExports.useState(!1),[_e,nt]=reactExports.useState(i),[ct,c]=reactExports.useState(null),[pt,gt]=reactExports.useState(""),[St,kt]=reactExports.useState([]),[At,Nt]=reactExports.useState(!1),[Vt,zt]=reactExports.useState(!1),Jt=reactExports.useRef(null);reactExports.useEffect(()=>{const Yr=localStorage.getItem("user"),es=localStorage.getItem("token");if(!Yr||!es){j(!1);return}try{const ms=JSON.parse(Yr);nt(ms),j(!0)}catch(ms){console.error("Failed to parse user data:",ms),j(!1)}},[]);const Dt=()=>{localStorage.setItem("redirectAfterLogin","/report-issue"),e("/login")},It=["Select a Category","Fuel Delivery Problem","Payment Issue","App Technical Problem","Account Access","Other"],Mt=Yr=>{Yr!=="Select a Category"&&c(Yr),Nt(!1)},Ht=Yr=>{const es=Yr.target.files;if(es&&es.length>0){const ms=Array.from(es).slice(0,3-St.length);kt(Ms=>[...Ms,...ms])}Jt.current&&(Jt.current.value="")},tr=Yr=>{kt(es=>es.filter((ms,Ms)=>Ms!==Yr))},er=()=>{var Yr;(Yr=Jt.current)==null||Yr.click()},dr=async()=>{if(!d){Dt();return}if(!ct||ct==="Select a Category"||!pt.trim()){alert("Please fill in all required fields");return}zt(!0),setTimeout(()=>{zt(!1),e("/report-submitted")},2e3)},mr=pt.length,Ur=10,Dr=()=>{setTimeout(()=>Nt(!1),150)};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/support-help"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Report an Issue"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4 space-y-6",children:[d?null:jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center",children:[jsxRuntimeExports.jsx(CircleAlert,{className:"w-5 h-5 text-yellow-600 mr-2"}),jsxRuntimeExports.jsxs("p",{className:"text-yellow-800 text-sm",children:["You are not logged in. ",jsxRuntimeExports.jsx("button",{onClick:Dt,className:"text-[#3AC36C] font-medium underline",children:"Login"})," to submit your report."]})]})}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm",children:"Please provide details about the issue you're experiencing. Our support team will review and respond as soon as possible."}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-900 font-medium mb-3 block",children:"Issue Category"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>Nt(!At),onBlur:Dr,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-left flex items-center justify-between focus:outline-none focus:border-[#3AC36C]",children:[jsxRuntimeExports.jsx("span",{className:ct&&ct!=="Select a Category"?"text-gray-900":"text-gray-500",children:ct||"Select a Category"}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-5 h-5 text-gray-400 transition-transform ${At?"rotate-180":""}`})]}),At&&jsxRuntimeExports.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:It.map((Yr,es)=>jsxRuntimeExports.jsx("button",{onClick:()=>Mt(Yr),className:`w-full px-4 py-3 text-left hover:bg-gray-50 text-gray-900 ${es===0?"bg-[#3AC36C] text-white hover:bg-[#2ea85a]":""} ${es===It.length-1?"rounded-b-lg":""}`,children:Yr},Yr))})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-900 font-medium mb-3 block",children:"Description"}),jsxRuntimeExports.jsx("textarea",{value:pt,onChange:Yr=>gt(Yr.target.value),placeholder:"Please describe the issue in details...",rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#3AC36C] resize-none text-sm"}),jsxRuntimeExports.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[mr,"/",Ur," characters (minimum ",Ur,")"]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("label",{className:"text-gray-900 font-medium mb-3 block",children:"Attachments (Optional)"}),jsxRuntimeExports.jsxs("div",{className:"flex items-start gap-3",children:[St.map((Yr,es)=>jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-gray-100 rounded-lg overflow-hidden border",children:jsxRuntimeExports.jsx("img",{src:URL.createObjectURL(Yr),alt:`Attachment ${es+1}`,className:"w-full h-full object-cover"})}),jsxRuntimeExports.jsx("button",{onClick:()=>tr(es),className:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1",children:jsxRuntimeExports.jsx(X,{size:12})})]},es)),St.length<3&&jsxRuntimeExports.jsxs("button",{onClick:er,className:"w-20 h-20 border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-400 hover:border-[#3AC36C] hover:text-[#3AC36C] transition-colors",children:[jsxRuntimeExports.jsx(Upload,{size:20}),jsxRuntimeExports.jsx("span",{className:"text-xs mt-1",children:"Add"})]})]})]}),jsxRuntimeExports.jsx("button",{onClick:dr,disabled:Vt,className:"w-full py-4 bg-[#3AC36C] text-white rounded-full font-semibold text-base hover:bg-[#2ea85a] transition-colors disabled:opacity-50 disabled:cursor-not-allowed ios-button active:scale-96",children:Vt?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-center",children:[jsxRuntimeExports.jsxs("svg",{className:"animate-spin h-5 w-5 text-white mr-2",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[jsxRuntimeExports.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),jsxRuntimeExports.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Submitting..."]}):"Submit Report"}),jsxRuntimeExports.jsx("input",{type:"file",ref:Jt,onChange:Ht,accept:"image/*",multiple:!0,className:"hidden"}),!d&&jsxRuntimeExports.jsx("div",{className:"mt-8 p-4 bg-blue-50 rounded-lg border border-blue-100",children:jsxRuntimeExports.jsxs("div",{className:"flex items-start",children:[jsxRuntimeExports.jsx(User,{className:"w-5 h-5 text-blue-600 mt-0.5 mr-3 flex-shrink-0"}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h4",{className:"font-medium text-blue-900 mb-1",children:"Account Benefits"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-blue-800",children:"Logging in ensures our support team can contact you regarding your report and provide personalized assistance."})]})]})})]})]})})},ReportSubmittedSuccessScreen=()=>{const e=useNavigate(),[i,d]=useState(!1);if(useEffect(()=>{if(!localStorage.getItem("user")){d(!1);return}d(!0)},[]),!i)return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(Check,{className:"w-10 h-10 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to view report submission status."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})});const j=()=>{e("/report-issue")},_e=()=>{e("/home")};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-[#3AC36C] rounded-full flex items-center justify-center mx-auto mb-8",children:jsxRuntimeExports.jsx(Check,{className:"w-10 h-10 text-white stroke-[3]"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Report Submitted Successfully!"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm leading-relaxed mb-12",children:"Thank you for reporting the issue. Our team will review your report and get back to you as soon as possible."}),jsxRuntimeExports.jsxs("div",{className:"space-y-4",children:[jsxRuntimeExports.jsx("button",{onClick:j,className:"w-full py-4 border border-gray-300 text-gray-700 rounded-full font-medium hover:bg-gray-50 transition-colors",children:"Submit another report"}),jsxRuntimeExports.jsx("button",{onClick:_e,className:"w-full py-4 bg-transparent text-[#3AC36C] font-medium hover:underline transition-colors",children:"Go to Home"})]})]})})})},TermsConditionsScreen=()=>{const e=useNavigate();return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Terms & Conditions"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-500 text-sm mb-6",children:"Last Update 10 June 2024"}),jsxRuntimeExports.jsxs("div",{className:"space-y-6 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"1. Introduction"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:'Welcome to FuelFriendly. These Terms and Conditions govern your use of the FuelFriend mobile application and website (collectively, the "Service").'})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"2. Definitions"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-2",children:"Fuel Friend refers to our delivery partners who deliver fuel and other items to users."}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"User refers to individuals who access or use our Service."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"3. Use of Service"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"FuelFriend provides a platform connecting users with fuel delivery services and convenience store items. We do not own, sell, or distribute fuel ourselves."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"4. Payments and Fees"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"All payments are processed securely through our payment providers. By providing payment information, you represent that you are authorized to use the payment method."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"5. Delivery Services"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"Delivery times are estimates and may vary based on traffic, weather conditions, and other factors beyond our control."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"6. Contact Us"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-2",children:"If you have any questions about these Terms, please contact us at:"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 leading-relaxed",children:["support@fuelfriendly.com",jsxRuntimeExports.jsx("br",{}),"FuelFriendly, Inc.",jsxRuntimeExports.jsx("br",{}),"123 Delivery Lane",jsxRuntimeExports.jsx("br",{}),"San Francisco, CA 94107"]})]})]})]})]})})},PrivacyPolicyScreen=()=>{const e=useNavigate();return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("header",{className:"p-4 flex items-center bg-white border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/settings"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx("img",{src:"/Back.png",alt:"Back",className:"w-5 h-5"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Privacy Policy"})]}),jsxRuntimeExports.jsxs("div",{className:"p-4",children:[jsxRuntimeExports.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 mb-6",children:jsxRuntimeExports.jsx("p",{className:"text-green-700 text-sm",children:"Last Update 10 June 2024"})}),jsxRuntimeExports.jsxs("div",{className:"space-y-6 text-sm",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"1. Introduction"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:'FuelFriendly ("we", "our", or "us") is committed to protecting your privacy. This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our mobile application and website (collectively, the "Service").'})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"2. Information We Collect"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-3",children:"Personal Information"}),jsxRuntimeExports.jsxs("ul",{className:"text-gray-600 leading-relaxed space-y-1 ml-4",children:[jsxRuntimeExports.jsx("li",{children:" Name"}),jsxRuntimeExports.jsx("li",{children:" Email address"}),jsxRuntimeExports.jsx("li",{children:" Phone number"}),jsxRuntimeExports.jsx("li",{children:" Billing address"}),jsxRuntimeExports.jsx("li",{children:" Payment information"}),jsxRuntimeExports.jsx("li",{children:" Vehicle information (make, model, color, fuel type)"}),jsxRuntimeExports.jsx("li",{children:" Location data"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"3. How We Use Your Information"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-3",children:"We use the collected information for various purposes, including to:"}),jsxRuntimeExports.jsxs("ul",{className:"text-gray-600 leading-relaxed space-y-1 ml-4",children:[jsxRuntimeExports.jsx("li",{children:" Provide and maintain our Service"}),jsxRuntimeExports.jsx("li",{children:" Process and complete transactions"}),jsxRuntimeExports.jsx("li",{children:" Send you order confirmations and updates"}),jsxRuntimeExports.jsx("li",{children:" Provide customer support"}),jsxRuntimeExports.jsx("li",{children:" Gather analysis to improve our Service"}),jsxRuntimeExports.jsx("li",{children:" Monitor the usage of our Service"}),jsxRuntimeExports.jsx("li",{children:" Detect, prevent, and address technical issues"})]})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"4. Data Security"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-3",children:"The security of your data is important to us, but remember that no method of transmission over the Internet or method of electronic storage is 100% secure."}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"We implement appropriate security measures to protect your personal information, including encryption of sensitive data and secure payment processing."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"5. Changes to This Privacy Policy"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-3",children:'We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page and updating the "Last updated" date.'}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed",children:"You are advised to review this Privacy Policy periodically for any changes. Changes to this Privacy Policy are effective when they are posted on this page."})]}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"6. Contact Us"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 leading-relaxed mb-2",children:"If you have any questions about these Terms, please contact us at:"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 leading-relaxed",children:["support@fuelfriendly.com",jsxRuntimeExports.jsx("br",{}),"FuelFriendly, Inc.",jsxRuntimeExports.jsx("br",{}),"123 Delivery Lane",jsxRuntimeExports.jsx("br",{}),"San Francisco, CA 94107"]})]})]})]})]})})},AccountDeletionScreen=()=>{const e=useNavigate(),{logout:i,user:d}=useAppContext(),[j,_e]=reactExports.useState(""),[nt,ct]=reactExports.useState(!1),[c,pt]=reactExports.useState(!1),[gt,St]=reactExports.useState(!1);if(!(!!d&&!!localStorage.getItem("user")))return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-sm w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-10 h-10 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Login Required"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-8 max-w-sm",children:"Please login to manage your account deletion request."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/login"),className:"bg-[#3AC36C] text-white px-8 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Login Now"})]})})});const At=["No longer need the service","Facing technical issues","Privacy concern","App Technical Problem","Found a better alternative","Other"],Nt=It=>{_e(It),ct(!1)},Vt=()=>{setTimeout(()=>ct(!1),150)},zt=()=>{if(!(d!=null&&d.id)){alert("User not found. Please login again."),e("/login");return}St(!0)},Jt=async()=>{St(!1),pt(!0);try{await apiDeleteAccount(d.id,j),i(),e("/account-deleted")}catch(It){console.error("Delete account error:",It),alert(It.message||"Failed to delete account. Please try again.")}finally{pt(!1)}},Dt=()=>{e("/settings")};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"max-w-sm w-full text-center",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-red-50 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(TriangleAlert,{className:"w-8 h-8 text-red-500"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Are you sure you want to delete your account?"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm mb-6",children:"This Action is permanent and cannot be undone."}),jsxRuntimeExports.jsxs("div",{className:"text-left mb-6",children:[jsxRuntimeExports.jsx("p",{className:"text-gray-900 font-medium text-sm mb-3",children:"Deleting your FuelFriendly account will:"}),jsxRuntimeExports.jsxs("ul",{className:"text-gray-600 text-sm space-y-2",children:[jsxRuntimeExports.jsxs("li",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-red-500 mr-2",children:""}),"Remove all your personal data and saved information."]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-red-500 mr-2",children:""}),"Cancel any active subscriptions or ongoing orders."]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-red-500 mr-2",children:""}),"Erase your payment methods and transaction history."]}),jsxRuntimeExports.jsxs("li",{className:"flex items-start",children:[jsxRuntimeExports.jsx("span",{className:"text-red-500 mr-2",children:""}),"Disable access to the FuelFriend app and services."]})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("label",{className:"text-gray-900 font-medium text-sm mb-3 block text-left",children:"Tell us why you are leaving (Optional)"}),jsxRuntimeExports.jsxs("div",{className:"relative",children:[jsxRuntimeExports.jsxs("button",{onClick:()=>ct(!nt),onBlur:Vt,className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-left flex items-center justify-between focus:outline-none focus:border-red-500",children:[jsxRuntimeExports.jsx("span",{className:j?"text-gray-900":"text-gray-500",children:j||"Select..."}),jsxRuntimeExports.jsx(ChevronDown,{className:`w-5 h-5 text-gray-400 transition-transform ${nt?"rotate-180":""}`})]}),nt&&jsxRuntimeExports.jsx("div",{className:"absolute bottom-full left-0 right-0 mb-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 max-h-48 overflow-y-auto",children:At.map((It,Mt)=>jsxRuntimeExports.jsx("button",{onClick:()=>Nt(It),className:`w-full px-4 py-3 text-left hover:bg-gray-50 text-gray-900 text-sm ${j===It?"bg-[#3AC36C] text-white hover:bg-[#2ea85a]":""} ${Mt===0?"rounded-t-lg":""} ${Mt===At.length-1?"rounded-b-lg":""}`,children:It},It))})]})]}),jsxRuntimeExports.jsxs("div",{className:"space-y-3",children:[jsxRuntimeExports.jsx("button",{onClick:zt,disabled:c,className:"w-full py-4 bg-red-500 text-white rounded-full font-semibold hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Deleting Account...":"Delete Account"}),jsxRuntimeExports.jsx("button",{onClick:Dt,disabled:c,className:"w-full py-4 border border-gray-300 text-gray-700 rounded-full font-medium hover:bg-gray-50 transition-colors disabled:opacity-50",children:"Cancel"})]})]})})}),jsxRuntimeExports.jsx(ConfirmationModal,{isOpen:gt,onClose:()=>St(!1),onConfirm:Jt,title:"Delete Account",message:"Are you absolutely sure? This action cannot be undone and will permanently delete all your data.",confirmText:"Delete Account",cancelText:"Cancel",type:"warning"})]})},AccountDeletedSuccessScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState(!1);reactExports.useEffect(()=>{if(localStorage.getItem("user")){e("/settings");return}d(!1)},[e]);const j=()=>{e("/register")};return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsx("div",{className:"min-h-screen bg-white flex flex-col items-center justify-center px-4",children:jsxRuntimeExports.jsxs("div",{className:"text-center max-w-sm",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-[#3AC36C] rounded-full flex items-center justify-center mx-auto mb-8",children:jsxRuntimeExports.jsx(Check,{className:"w-10 h-10 text-white stroke-[3]"})}),jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Your Account has been deleted"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 text-sm leading-relaxed mb-12",children:"Your FuelFriendly account and all associated data have been permanently removed. We're sorry to see you go!"}),jsxRuntimeExports.jsx("button",{onClick:j,className:"text-[#3AC36C] font-medium hover:underline transition-colors",children:"Create account"})]})})})},ChatScreen=()=>{const e=useNavigate(),[i,d]=reactExports.useState(""),[j]=reactExports.useState([{id:"1",text:"Hi there! I'm preparing your fuel order for pickup. Your order #TRK-123456789 will be ready in 15 minutes.",isUser:!1,timestamp:new Date(Date.now()-3e5)},{id:"2",text:"Great! I'll be there to collect at the station on 123 Main Street.",isUser:!0,timestamp:new Date(Date.now()-24e4)},{id:"3",text:"Perfect! Just to confirm - you've ordered 20 liters of Regular unleaded?",isUser:!1,timestamp:new Date(Date.now()-18e4)},{id:"4",text:"Yes, that's correct. Could you also prepare some convenience items like Coca-Cola Zero Sugar?",isUser:!0,timestamp:new Date(Date.now()-12e4)},{id:"5",text:"Will do! I'll have those ready for you. Is there anything else you need?",isUser:!1,timestamp:new Date(Date.now()-6e4)},{id:"6",text:"That's all, thanks! On my way now.",isUser:!0,timestamp:new Date}]);return jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col",children:[jsxRuntimeExports.jsxs("header",{className:"bg-white p-4 flex items-center border-b border-gray-100",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e(-1),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold text-center flex-grow -ml-10 text-gray-900",children:"Chat with Station"})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 p-4 space-y-4 overflow-y-auto",children:j.map(_e=>jsxRuntimeExports.jsx("div",{className:`flex ${_e.isUser?"justify-end":"justify-start"}`,children:jsxRuntimeExports.jsx("div",{className:`max-w-xs px-4 py-3 rounded-2xl ${_e.isUser?"bg-[#3AC36C] text-white":"bg-white text-gray-800 border border-gray-200"}`,children:jsxRuntimeExports.jsx("p",{className:"text-sm",children:_e.text})})},_e.id))}),jsxRuntimeExports.jsx("div",{className:"bg-white p-4 border-t border-gray-100",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center bg-gray-100 rounded-full px-4 py-3",children:[jsxRuntimeExports.jsx("button",{className:"p-1 mr-3",children:jsxRuntimeExports.jsx(Mic,{className:"w-5 h-5 text-gray-500"})}),jsxRuntimeExports.jsx("input",{type:"text",placeholder:"Type a message",value:i,onChange:_e=>d(_e.target.value),className:"flex-1 bg-transparent outline-none text-gray-700 placeholder-gray-500"}),jsxRuntimeExports.jsx("button",{className:"p-1 ml-3",children:jsxRuntimeExports.jsx(Send,{className:"w-5 h-5 text-[#3AC36C]"})})]})})]})})},Receipt=({order:e,onDownload:i,onPrint:d})=>{var _e;const j=nt=>new Date(nt).toLocaleString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 max-w-md mx-auto",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-6",children:[jsxRuntimeExports.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(CircleCheckBig,{className:"w-8 h-8 text-green-600"})}),jsxRuntimeExports.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Order Receipt"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Thank you for your purchase!"})]}),jsxRuntimeExports.jsxs("div",{className:"border-b border-gray-200 pb-4 mb-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Order ID"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:e.trackingNumber})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Date"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:j(e.createdAt)})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Fuel Friend"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900",children:e.driverName})]})]}),jsxRuntimeExports.jsxs("div",{className:"mb-4",children:[jsxRuntimeExports.jsx("h3",{className:"font-semibold text-gray-900 mb-3",children:"Order Details"}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("span",{className:"text-gray-700 font-medium",children:[e.fuelType," Fuel"]}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(",e.fuelQuantity,")"]})]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[e.currency,e.fuelCost.toFixed(2)]})]}),(_e=e.cartItems)==null?void 0:_e.filter(nt=>!nt.name.toLowerCase().includes("fee")).map((nt,ct)=>jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:nt.name}),jsxRuntimeExports.jsxs("span",{className:"text-sm text-gray-500 ml-2",children:["(x",nt.quantity,")"]})]}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[e.currency,(nt.price*nt.quantity).toFixed(2)]})]},ct)),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center py-2 border-b border-gray-100",children:[jsxRuntimeExports.jsx("span",{className:"text-gray-700",children:"Service Fee"}),jsxRuntimeExports.jsxs("span",{className:"font-medium text-gray-900",children:[e.currency,e.serviceFee.toFixed(2)]})]})]}),jsxRuntimeExports.jsx("div",{className:"bg-gray-50 rounded-xl p-4 mb-6",children:jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-lg font-semibold text-gray-900",children:"Total"}),jsxRuntimeExports.jsxs("span",{className:"text-lg font-bold text-green-600",children:[e.currency,e.totalAmount.toFixed(2)]})]})}),jsxRuntimeExports.jsxs("div",{className:"border-t border-gray-200 pt-4 mb-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center mb-2",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Station"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900 text-sm",children:e.stationName})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center",children:[jsxRuntimeExports.jsx("span",{className:"text-sm text-gray-600",children:"Pickup Location"}),jsxRuntimeExports.jsx("span",{className:"font-medium text-gray-900 text-sm",children:e.deliveryAddress})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex gap-3",children:[jsxRuntimeExports.jsxs("button",{onClick:i,className:"flex-1 flex items-center justify-center gap-2 py-3 bg-[#3AC36C] text-white rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:[jsxRuntimeExports.jsx(Download,{className:"w-5 h-5"}),"Download PDF"]}),jsxRuntimeExports.jsxs("button",{onClick:d,className:"flex-1 flex items-center justify-center gap-2 py-3 border-2 border-gray-200 text-gray-700 rounded-full font-semibold hover:border-[#3AC36C] hover:text-[#3AC36C] transition-colors",children:[jsxRuntimeExports.jsx(Printer,{className:"w-5 h-5"}),"Print"]})]}),jsxRuntimeExports.jsx("div",{className:"text-center mt-6 pt-4 border-t border-gray-200",children:jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"FuelFriendly - Your trusted fuel delivery service"})})]})},ReceiptsScreen=()=>{const e=useNavigate(),{user:i}=useAppContext(),[d,j]=reactExports.useState([]),[_e,nt]=reactExports.useState(null),[ct,c]=reactExports.useState(!1);reactExports.useEffect(()=>{if(i!=null&&i.id){const At=JSON.parse(localStorage.getItem(`userReceipts_${i.id}`)||"[]");j(At)}},[i==null?void 0:i.id]);const pt=At=>{const Nt=document.createElement("a"),Vt=new Blob([St(At)],{type:"text/plain"});Nt.href=URL.createObjectURL(Vt),Nt.download=`receipt_${At.trackingNumber}.txt`,document.body.appendChild(Nt),Nt.click(),document.body.removeChild(Nt)},gt=At=>{const Nt=kt(At),Vt=window.open("","_blank");Vt&&(Vt.document.write(Nt),Vt.document.close(),Vt.print())},St=At=>{var Nt;return`
FUELFRIENDLY RECEIPT
====================
Order ID: ${At.trackingNumber}
Date: ${new Date(At.createdAt).toLocaleString()}
Fuel Friend: ${At.driverName}

ORDER DETAILS:
${At.fuelType} Fuel (${At.fuelQuantity}) - ${At.currency}${At.fuelCost.toFixed(2)}
${((Nt=At.cartItems)==null?void 0:Nt.filter(Vt=>!Vt.name.toLowerCase().includes("fee")).map(Vt=>`${Vt.name} (x${Vt.quantity}) - ${At.currency}${(Vt.price*Vt.quantity).toFixed(2)}`).join(`
`))||""}

Service Fee: ${At.currency}${At.serviceFee.toFixed(2)}
TOTAL: ${At.currency}${At.totalAmount.toFixed(2)}

Station: ${At.stationName}
Pickup Location: ${At.deliveryAddress}

Thank you for choosing FuelFriendly!
    `},kt=At=>{var Nt;return`
      <!DOCTYPE html>
      <html>
      <head>
        <title>Receipt - ${At.trackingNumber}</title>
        <style>
          body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
          .header { text-align: center; margin-bottom: 30px; }
          .info { margin-bottom: 20px; }
          .items { margin-bottom: 20px; }
          .item { display: flex; justify-content: space-between; margin-bottom: 10px; }
          .total { background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0; }
          .location { margin-top: 20px; padding-top: 20px; border-top: 1px solid #ddd; }
        </style>
      </head>
      <body>
        <div class="header">
          <h1>FUELFRIENDLY RECEIPT</h1>
          <p>Thank you for your purchase!</p>
        </div>
        
        <div class="info">
          <p><strong>Order ID:</strong> ${At.trackingNumber}</p>
          <p><strong>Date:</strong> ${new Date(At.createdAt).toLocaleString()}</p>
          <p><strong>Fuel Friend:</strong> ${At.driverName}</p>
        </div>
        
        <div class="items">
          <h3>Order Details</h3>
          <div class="item">
            <span>${At.fuelType} Fuel (${At.fuelQuantity})</span>
            <span>${At.currency}${At.fuelCost.toFixed(2)}</span>
          </div>
          ${((Nt=At.cartItems)==null?void 0:Nt.filter(Vt=>!Vt.name.toLowerCase().includes("fee")).map(Vt=>`
              <div class="item">
                <span>${Vt.name} (x${Vt.quantity})</span>
                <span>${At.currency}${(Vt.price*Vt.quantity).toFixed(2)}</span>
              </div>
            `).join(""))||""}
          <div class="item">
            <span>Service Fee</span>
            <span>${At.currency}${At.serviceFee.toFixed(2)}</span>
          </div>
        </div>
        
        <div class="total">
          <div class="item">
            <strong>TOTAL</strong>
            <strong>${At.currency}${At.totalAmount.toFixed(2)}</strong>
          </div>
        </div>
        
        <div class="location">
          <p><strong>Station:</strong> ${At.stationName}</p>
          <p><strong>Pickup Location:</strong> ${At.deliveryAddress}</p>
        </div>
        
        <div style="text-align: center; margin-top: 30px; color: #666;">
          <p>FuelFriendly - Your trusted fuel delivery service</p>
        </div>
      </body>
      </html>
    `};return ct&&_e?jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-gray-50 p-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center mb-6",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>{c(!1),nt(null)},className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900 flex-1 text-center -ml-10",children:"Receipt Details"})]}),jsxRuntimeExports.jsx(Receipt,{order:_e,onDownload:()=>pt(_e),onPrint:()=>gt(_e)})]})}):jsxRuntimeExports.jsx(AnimatedPage,{children:jsxRuntimeExports.jsxs("div",{className:"min-h-screen bg-white",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center p-4 border-b border-gray-200",children:[jsxRuntimeExports.jsx(TapEffectButton,{onClick:()=>e("/home"),className:"p-2 -ml-2",children:jsxRuntimeExports.jsx(ArrowLeft,{className:"w-5 h-5 text-gray-600"})}),jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-gray-900 flex-1 text-center -ml-10",children:"My Receipts"})]}),jsxRuntimeExports.jsx("div",{className:"p-4",children:d.length===0?jsxRuntimeExports.jsxs("div",{className:"text-center py-12",children:[jsxRuntimeExports.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-6",children:jsxRuntimeExports.jsx(FileText,{className:"w-12 h-12 text-gray-400"})}),jsxRuntimeExports.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No Receipts Yet"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Your receipts will appear here after completing orders."}),jsxRuntimeExports.jsx("button",{onClick:()=>e("/home"),className:"bg-[#3AC36C] text-white px-6 py-3 rounded-full font-semibold hover:bg-[#2ea85a] transition-colors",children:"Start Ordering"})]}):jsxRuntimeExports.jsx("div",{className:"space-y-4",children:d.map(At=>jsxRuntimeExports.jsxs("div",{onClick:()=>{nt(At),c(!0)},className:"bg-white border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition-shadow cursor-pointer",children:[jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-start mb-3",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsxs("h3",{className:"font-semibold text-gray-900",children:["Order #",At.trackingNumber]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:new Date(At.createdAt).toLocaleDateString()})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsxs("p",{className:"font-bold text-green-600",children:[At.currency,At.totalAmount.toFixed(2)]}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:"Total"})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx("span",{children:At.stationName}),jsxRuntimeExports.jsxs("div",{className:"flex items-center gap-2",children:[jsxRuntimeExports.jsx(Download,{className:"w-4 h-4"}),jsxRuntimeExports.jsx(Printer,{className:"w-4 h-4"})]})]})]},At.id))})})]})})},homeIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANvSURBVHgB7ZxNTttAFMffc5ysc4QcgU2lAoHiG5QTlOwqCCo5QeEEgPhQd+EG4QamoQpIXUBvkBs02ybOTGdCqFQpNnj8xh6H91tZcT7sn8ee9/d4AsAwDMMwDMMwTOlBcJj34edGxfe7EmBl9gLKazGZHt0H34bgKM4KfRfurlR9L1SL9f/XyOEE5fbP5uUjOIgHDrL+Y+/TYpkabFSlF6722x/BQZwTunrb/iIlXsFCmf+oI0Jv9fveATiGU0LXbttf1TXo5LXvRw+P9WfAIZy5hs7FHIIZh4ON8yNwACeErvX3u6oH34EMSMSTu+ZZBwqmUKFb4UH9jx911UbQdDAor2qTaucmOBlBQRQmVMscV6MQ5LzGpOOxFvlBUVILEaoLdvQrIQI2wApyKKJpUEQAyF2ofZnPFCM117JJp598ZGqw4anf0gcQciS3FtoM21vChx4kF+w2GE1QBHlF1VxaqI6SSmZMlLROXUXVB70NkAPWheqCfR4lC0VvQx6pyuopnzH92MJqqrImdL2/fyxROnfzYo41qeRCZwV7ZXqcNUpaR6WqQfOiBcSQCrWYfmxBnqrIOiVd75VMpmZl7E8eKGtVkhaaX/qxBV2qyiy0/DKfoZGaSWj8QFppyZyqjK+hyQNppUWnqjBLqjJqoXogLc3YTxmRQnbuPlyk3sfULTTtQFpZMR0ATNVCHY2StkmVql4tlGIgraykGQB8UahOPxM/6km1CG+ba5WqWi+lqkShusb0qn6vZOnHJo8iiraTatVYoctTsFOTHABie3mWGQeqhuZ349bGCwVcpoKdFEzoT5Lq0FNg4oh1k9wp3ba34tZ5Qh0lD5x68o2QU6F69UUrpihGSVnf+ObIWn93R8WJLiwjEluDzbMrMMDJJ5jLDAslhoUSw0KJYaHEsFBifHAFKVoCvSEYgPJpmg04gDNCxVTc3AeXQzDg6UaOG7vCpzwxLJQYFkoMCyWGhRLDQolhocSwUGJYKDEslBgWSgwLJYaFEsNCiWGhxLBQYlgoMSyUGBa6iAr+BkOMhdamtWugQsphlhls88+STYAV4/EvMMRY6PxZc5I55xIw8z+CSQlUU7Uz/T9pplN+sHF+qId/1aLRVD6pjosACO42zzO3dv0dSuq28baos0Si7Mz2iWEYhmEYhmGYt81fOUJOa8kvObkAAAAASUVORK5CYII=",myOrdersIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAVvSURBVHgB7ZxNbttGFMffjGQgRVtANyh9gsonqHqCOICdoKtYdrvIphJPYPsElNJFgRa24lXRKICTE0Q+QdUTlDeoinZRx9K8vKEIJ3E44htpGInS/DayPdQz+dd8vI8ZAXg8Ho/H4/F4PJ7SI8CSqNdvSIRj+rEB68tAXVeb4ZMHMVhiJWjUuwwkjv+CzSBW4r+dsNkc2bxJWl2MNyewOQSgPjsAS6wEpQ79DWwQUlTugyVsQaNfLuugP7XNoh71ejWbN/B7aGXcgM2jBuMv6jZvqHIvlAKM3R9RPAM+NSFwN7NFwBCVGAKT1E5WDxrRPb0EJmQnAJPXUkn+xwCYsASl1b0GaOqhGLeP9pvAJOr9FgisZgqqlHoVHj06ASbd834A2UKM2kd7Fvd0WSPv5e+sNglCd6Q2MOEN+cmkYWpClAMoOWHzgXaNBobmwGYeZQkqpdo1tdFwYQ+tVUahujI38t0n5qJkdpfI+b2CdUDNGGlCNIBJrqA6OgKDu4Q0TGwjiVUl/GF/QC+ZzyJBsv3v/B6qbhqmJsTJK1gjFCjT89SiX/sNYJAraAWkOVqQ5V+QPgDFwNhWwV1gkCsoCmwYWuKw+ZDtM5YCuWVcYMl9+ho4JhjXZLoMCvBPWDNS9ynObkWW68QR1DBRi69gPckUDkGwFl+OoHH2n0VgmzhYddIEkEFQ9Q8wyBWUhrbJz6zNky9cZWT1xhxiIg6AYyP3iok5yUD5wta69NKpvy0eGy94w4sI8wWtVvVKbpo/gor6MoKSkyZHXpuvwGH45LsYGOQKqlc+inO7pnZyqw6e9voRt6dWoNoytUkhH0c/J5FZLrpYSC+mXGXwU69/DCw7VCeDRMzAfJXsABNWkS79BHVxbpZoMZk7aR3uXWTboGopvdDsnpuwFQI6k/+r3ayqY9R7Xqeqa3vm8HzHUAkIw2YSVt6xc1mrwrilEluzngvj1uHDbWDCrnpGZ/02JZk5w1tPD0OBIp7+qmo4TS7MM9cO3tlJRoP+MKwy6CmxQKSpS45SO0FqJ/ee1PV4mzvcNXxBKTEssbopJeRbWof7VqV2y6qnJw8vqGOWKSh5DxAqMd7WEz8sACZbZ8bbCkQXlgy76umQEUVfF3A96bw32W9HZ88PaNE71iEt15AWEidwmiaHNW2a6zuAlRPJ8wKc42RRIoG69HRDoXOntIKKOysx6h5IxTwhyY2Bfy9mZfmTRC7lHgWly8THK/GIRBwiwhX908F7QmbeL6hKY3pPqk72gjt2YtRhNUWCQoqWqbRtuyi5ERTVqU35d9WIzn9/RmWOzB7tV/kl4wV1jBfUMV5Qx3hBHeMFdYwX1DFeUMcUHnomtZoZ23k+QIo4Kxl8xx4VB29YuzhsbbugMEHTIzi9ZKOuYAYbmGyijZVSYfj9o5cGm6/JXgC2kG0q1XR+bO6HUCCFDPnbB5/vcFggpbzsnr/4KBRMPqAFDk5QDqDN3fQ1L4UIuuiDT8FORuEvgEWRqgEF4lzQdD9pAxaH5srP7efKJVNADx0H4AoxV0FuqbgXdCLc7SRBLN3uaPeCVioDcIQU8g8oGc4FTXaa6BLHwugNBvul23JeTKQkttoLFt5G6nryLZSQQgRNeqnY2kl7qtU8mFYwd2x2a6wShUVK6fbqA/0zdwMY3BuNyn5M55OUkef5qomy4rNNjvGCOsYL6hgvqGO8oI7xgjrGC+oYJ34oZdjvPz17UfhRRWSet5xF1r2SXWffR+XGsUeopwcKVp+C79UPecd4QR1jIei9Uict5gOtv2CBLeg0cbz8QwGfFv6RxNt32FwcHu61FcLpoqc2Vh19JkCfUDEds/R4PB6Px+PxeDxrzls/2/zkVHuiLQAAAABJRU5ErkJggg==",trackOrderIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAewSURBVHgB7ZxbbttGFIbPDOUGRQPU2YGygtorML2C2Kidtk+x7LZAHhqLK4i8AtrJQ4G2sZSnopaB2CuIvIJoB2F2IKDOgy1pTs8hJdeSyOFFQ4kB+AGGJQ4pUb/mcm4jgJKSkpKSkpKSkpKSLx4BBcdtvqtKHDTp4Ro/FyguhrfWkfN824MCUmhBR2K+p4fVqSZPiet1p1brQcGQUGRU34ZZMcE/pr7egwJSbEEF2pFNUPkOCkixBf0CKQU1TCmoYQq5ytPqvgpwa0uUh/TUjjitowQcAVS6Tm27MKt9YQR1m20SELfo4RO6rSqkowuAV0qIC6e224ElslRBuSdWYHCoEFjINTCDRx+rcbi/8xaWwNIEfd08JyGxQQ9XIR+8ZQi7cEHdP87W5IpoAhrrkXF46qayuShXdaGrPPdKWREfFigmU5UPBh9fN9svYQEspIfyXGlB30UUe7BEhIDjF7VdB3Ikd0FZTAkU4MjYKxHQo9v0AOmP51uBPOeuiuyLWJcCK5t5BVZyF/Sk2U41xFlA6slvQUEHKtdd3Qd3/2zbYOGWTG9q5SZqroK+arZpmEM9yblIhjoO4cj5JZsdyeIKC16KaEdgAoqrtl4c7NTAMLkJyosA2ZeN+DPRU0NRyyrkNO6bsz0p4GWSHqtw6DgHPx6DQXIRdBQY/hh3nt8rxfW26aHnNv+uWmrFReF7XlrUANedX592wRAVyIFRlF2LAjxx9p8mmg74CwoeDeh/xSPf3dOd79R+4vZt9027EfRWzb1WBKdX1sEQxntoMOT8m4yEpoIj52C3EfkafnBkaFtKPUMhbAj3pjp0+y11Y13pjHb39PxYAh6C9n7MDX3jgp6ctnmoV6PaaQW/qB/sbEe1Z3FJeYHRJe7onnjE2JqX6NGq/9jE1GPUU+LeCRoxeQHC236oYc3Dmj84ick9JZV/T3PlHnlD79mtDWtXorINvj0byaqpHJVRQWmox7h3suE89+e3Ce5lN23ITpXd2pPT82fTDRwvVUpqPSQprGdgAGNDPohnQuRixCt6fX93c/a6yFRxZtQQNsPMsLihH3VdGsz1UNSbKGy0hx2X2G+AQTH917Tgnfv72DL4HxVxD3dY8WZW7HuDISSIjehW9MK++WDOFUaG2hSr1ld9d/rg6B68qIvoMzyBOTEiaGDmRPvrCuAy7Hj8nJsdMre2fF9/+l5Q6QLOVbfZnCvgbaiHDvTBj6G4mD7Ecy4YHuozhA1hJTu6SyQ+3IA5SOUpjXNAqET1/nFErOquC53o/Tk332CXDKaTSW+sUukCDqIvEqL+6s35xBeBgjKsMQ7E3eWQkOyrMXYP95/OuHYJjG0jqJvB42lTLc75iCBRKiXxkM+6GiOIKO9jIWkQ+SC0BsqD9HAqpRl3Uoo5NONqHETaw8gr2zkBeV6PZo6B+gTZiO0EaRalwtViZsVC61vIiTSCZosZisgFazFfkJodIRjkpVLDgZ24cxILqsSgFhNgCEVEz7seLIIKhn1xGQT1AztHcWelsls4Eg7KsgXICVtNBL3QjrqOQmOPpkNj7ukZxSmFNk45P+iRhfF4+iit8hh5CZlIONWrKXH4CeT1cZLwXio7dBQJb43+7nD/Ot+SMrraGAYPeTLvTBxjY9+CXAVFnDXifYciWk5KiXCicKcDGTHjKVlWR9sulT19aGTs66+bk9AhGhPE4dQ1zIERQUf1mV5UuxQy1OSKjf7MAS0grbDYqz4Agt15o/bGok2UdLvUNFfDAhX59dLwBSQufkBBnCuYE3Px0KHepKAYZWhkKUF6IjVKoRPaO1GfAY37DEkwJuiot+nmHzu0l3J6Qgw3TYmqUNacn3+YjW4F+S47+srwmG1ajOaUKNZ4qX0zC5ph8Ua2HgJR5xn+XIFCKYyD71vTLX5gJ0G+Cwxgtj5UfsUZS92kThGrh+/CGljUQ8o5ke+d1oHocZ5fic/rUT3MUkOO3lejX4LtVTOVzjkUOrTrUoCrOydJnSYPUXIgnohgN910r+6RKdlFpEUkxuBOVmMl9gorKEOeyAeIicyQ6I3faruJzCZ/muh/U/WfDFd6Scu7k1X/hXtTWcmnWIwWH5ovY+ubBOLF8HbFMV3/7hf54oCnFjvu3LAA9DzkUmPPcxkNs9jSa06kccVHWHFCVoL6gAGPEDvuXL/GyqCYTK5JnZPTs1aKwLS/My7rxq1RoQWv5HaS89NU/6UhV0FHQ4+Hfpp0h0d99zJuV1yQuh6sUXRngyyDvVQl4QK6h7VdYyWMky+dMxlFvQ87Cz2ab2kllz30Q4X8J6qQBRJTwRe8aYHxexMOG3F1mnlDw/wtiM/1PH9aY6E76ZJUFOcFL5LOwe4x5MxCBWU46i/Rep95yKaFh3gfaybr6PVvtyTS7NbISG9Uep57r7zP0gQdY1rYkUt6mTQHZJqlCzpmvCtOgNhIu+3Q333HFX4UzzS13ykrhRH0Pr7vTok93c44WrGvQMljsP7tFOkHsQop6Bj39J+WhPB8FOeM6jlsLZyX8ldxDFMKaphSUMMUW1CMzvVT1L8DBaTYgvo5qrD8EiXkbvpz59DzoNCCjlPMflAjSP5xLqmjboabpgPDJSUlJSUlJSUlJSUld/wHfb53kVgA+0sAAAAASUVORK5CYII=",settingsIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFQAAABUCAYAAAAcaxDBAAAACXBIWXMAACE4AAAhOAFFljFgAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAkcSURBVHgB7ZxvbtRGFMDfzG4KKlTanqDOCdicgM0JICpJyyfyR0XiSxOfgOUEm0ClSlRhl09tCVLCCVhOkOUELCfoVrQSEHum79kOpMHz10OcVv59acp47fHzzPtvAzQ0NDQ0NDQ0NDQ0/OdhcE4YDPd6XMJd/LMHfsyYZAcpfxPHa2szqIk2nAMGw/2Iy+Q5VKMjmVzl8nKEfy9CTXA4B3B51Idw9Aa/7PWgJs6FQFHzXIWQcNGDmqhdoKQ78T8RBIQzfgtqov4VKuV1CE9U17av3ShxzXaXUh7gEUqLzZiMQOUV5Nt+DGdMrQIl6w4y6ZaPyunWxsqS4fcd9A7+KBsrtn0fzph6t7w46imHAJ6BgXhtiVbvWDFcy7YPukIfDPfuCgmkE/FG5Ut8XoeCiZfx2srk9LGDh0+6nLGB8mQMRmABXu8ZZ+XbnrdgMPh5fym+szT917VxZQMkXVQ3V5iArmSkHhgew0ab6zceQwWCRUr3h3sDKWFLc8iYhCyknLWg9Q064ST4TvmhcrK5vrIAFui2fcEUz/fs43Uz4UWqg4VM43jj+23wJIhAi7CxaqRzArbqslJ2Hu3RtXsQhplgf837hq9BdCgKcwjBkFPXbScSGUM4Oi3x1QA8qSzQwe6TVQjnmM/Eu9Q5Do9vr0xQlwYTKuUEfA1aJYFmSQ3G7kIYZrjSFuM7N6fgQbyxvI1CvQeBQIPmdV+VBNqCZBMCrE6JBku8SxZopUEFUKh9ND5rpDagOr2dR0+dQ1hvo1Sk3F6pxrPVItkEWNpljF/FC5EDf9KqzyTmL6WQj+MflscQGFJFjLFb7FNjRdcdo7V/DYKPOZe0KHqK00zRQC24GChvge48ejLCnyueIBmWlfnT/zoYDjvwttOBi7PZWSaB0ReNsj9KrjsY/ooLo30IChdOSHEv3viuD5Z4CZSePupOpWVHXVh5+54lg93f+xiqqnQmGsr2wungQIVXpKQzRLidRvHt5aDCzCMbWkFJhFOeYsg5hZDwL7Yxp7AJ5au0wy8ktHisvA/nFVqEl33VOBqXeV9LfZI8WMiiqWuKyAYfmnwh3s1t264e7fV297YwhFX6nyKFRRtd7yTQE7WfqGycDBFZWqiAT7EOi3Oj9H3rXlXBGiKu8eb6snGVOrlNRe0nKh+V06rCpHxAEcL2XH6XFecuJIeD3d+2oAK4CnV+rJUb5eiHsivKEcnH4AnpyJ3h3qEhuWKiw1lrQCoJPCm29FQ1jvPrgQFXx76jGqBV4uMIEy2RDtG770IASL/7CrX4XaQaR9/1TzDgJFD0yQxJCzlyjYHpJopUXjBIqD7z0BnbjMSco3W28hapsjwmt/BDTdHW8fkwNJ1g1HMgBK0QGRWRV8/wOwwulufBgp9wZ6W4GHTH2BpcZ4EWCV0Sqm6LWoVs+mgr82kPJH+zVnaePMJpPdcli23yqsVDVUZKhIv34pwcoTqOYMmSIQERgfhSa2CyAp1GmHQTWxs3llQPJV67iQ9tjrL6mp0gV8FA4bmohQmYa3DwXryyTfnNZHlL5QrEUG5TexJNgY62uM1NfHy4ynn0svyBAtNDxf07iddXVsEB7/RdJlTUlaC+mY7WMDC1ypCpfbI4m4cUO6pxLi+r23xEojGGcireJtoydun1oAJ5plx9M8DTrvrCSp925pzOE2ofGItuSsPU0jRZUOXAJ4SuXlPiYqQeZB31WLneklqdqKDdnvjMAd01ZdXVNx9RXaBHFzvgR+nvGEjf8wWEec+hskDbc8k19ajUuU3T8n9mETiTeEVZmFRRzS+qp0j38ElXG12IlnIriqyzpJSO681gmm9VOcb4oWoMnfkXyt+1YPgh0+8yF/Akc4jbbF99BGafdMZFqnWlS8WxcH00xiV5qfxxKsegJsIM1r7O7SrDS6CmvGhx6j5orzx3ABr/0SbBkUVtkOyr5kHVVJ1xKcLjMajpotv13EWozgI9EXpG6qPM3R+ZUw5S2WFHquT+7lPltssS0YDz0GSpGLARGMDAAMvOoNP13Za4ZN0Z4xzL403u67ND6BBb+nBFxdGUHEHjITGm5+Pj5AjqRdriPf2vyiuvpfMwlD/yObDRjxs31sA0V3DAIsVlnWk6xuZmfHCtbeE8sPKp1902nXmO+VC4rh/nsWv5mFpoIHDrdpYdcnTMs64TYDu6Y7AioM9PQMiMPZWPN74dgQeCtSlmdo+Qys5VoVAYr9/YqjqPYBl7hnrV1cU4hgwUJoMXTCvEwIw68KoUCnMXTJO0kWwMBtxWKDUEaLJLphyoCVohQjBTrvUTPjSb5erDG/ReNH41Vg7eHxm7+9wz9vq2FTQG7fkgjQcULbWwPAxwtSwcpSQKViGfoXN+EKLtx9he9LlKIASWLl5pYm6rhgAXMlVydCnK/iedm32OZjOslZH7FpWP2rtgfs1iuHowPFT21Nu2rZwXzO6gfc9/hXZGbfWztEhXKP2M4A1fGo6bzcquaaq8kn7ecthxFRpu9VEOY7CdCvmSZ6WOLDv/ScMtZC5K9XeDSueX68RbJdedYOQ1zSIvzHjlmSpNsdAxQKj0Ws3g0dNtDtLo7FqA4Wp7MYgxy5vNyLhEUBHyrbcsws2TVEsws1Yf9IkFWyhV9sq3lecY0oVFs1kElcFVbOEmnaZakY4yRgHfvPBp5TnmwfDpprGVxgne96krVdryx6CBoqy4VxmiBOcXBSxbehywd5NOE+RNOpGGe+kKLLpOThP4myVgTI5rCLJCCWOfEll0ySYS0tfoAkRc17GBehmDg6/BAovVSYnsx2hhZnRdRm8ga3YTHrsTr694h9DBBEpQbhPdJRQUloIlHzMOE3EkXsDc31Pn11ksgwN9yKhOdmfBSZtdwYTPAsvcOtlBq/64ahd2UIG6oksu264UfYDh9lZzCOr9ogNvj5RDwDT1/pwi8uqpxsW7oxdwxtS6QgndCmOGj7hA/jWx0iqCa8gYitq/iqP7xIVk7HomGg9sKp6fg/q/26TZ9lWoY7sTtQvU8GUbL0wNDp+T+lco5NseAlLXdifOx8cEs20f5KMBkPue9Wx34lwINO+VTxdlxa2fF+vSxbq2e0NDQ0NDQ0NDQ0PD/4R/AB5qpWsI9I2xAAAAAElFTkSuQmCC",NavItem=({to:e,icon:i,label:d})=>{const[j,_e]=reactExports.useState(0),[nt,ct]=reactExports.useState(!1),c=reactExports.useRef(null);reactExports.useEffect(()=>()=>{c.current&&(window.clearTimeout(c.current),c.current=null)},[]);const pt=()=>{_e(gt=>gt+1),ct(!0),c.current&&window.clearTimeout(c.current),c.current=window.setTimeout(()=>{ct(!1)},550)};return jsxRuntimeExports.jsx(NavLink,{to:e,onClick:pt,className:({isActive:gt})=>`flex flex-col items-center justify-center space-y-1 w-full text-sm md:text-base transition-[transform,opacity,color] duration-200 ease-out active:scale-95 hover:opacity-90 ${gt?"text-[#3AC36C]":"text-gray-400"}`,children:({isActive:gt})=>jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"relative w-6 h-6 md:w-7 md:h-7",children:[nt&&jsxRuntimeExports.jsx("div",{className:"absolute inset-0 pointer-events-none",style:{transform:"scale(1.9)"},children:jsxRuntimeExports.jsx(Lottie,{animationData:tapAnimation,loop:!1,autoplay:!0,style:{width:"100%",height:"100%"}},j)}),jsxRuntimeExports.jsx("img",{src:i,alt:d,className:`w-6 h-6 md:w-7 md:h-7 object-contain transition-[transform,filter,opacity] duration-200 ease-out ${gt?"filter-green":"grayscale"}`,style:{filter:gt?"brightness(0) saturate(100%) invert(64%) sepia(98%) saturate(451%) hue-rotate(81deg) brightness(95%) contrast(87%)":"grayscale(100%)"}})]}),jsxRuntimeExports.jsx("span",{className:`text-xs md:text-sm mt-1 font-medium transition-colors duration-200 ${gt?"text-[#3AC36C]":"text-gray-400"}`,children:d})]})})},BottomNav=()=>jsxRuntimeExports.jsx("footer",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg w-full z-50",style:{paddingBottom:"env(safe-area-inset-bottom)"},children:jsxRuntimeExports.jsxs("div",{className:"flex justify-around items-center h-16 md:h-20 px-2 md:px-4",children:[jsxRuntimeExports.jsx(NavItem,{to:"/home",icon:homeIcon,label:"Home"}),jsxRuntimeExports.jsx(NavItem,{to:"/orders",icon:myOrdersIcon,label:"My Orders"}),jsxRuntimeExports.jsx(NavItem,{to:"/track",icon:trackOrderIcon,label:"Track Order"}),jsxRuntimeExports.jsx(NavItem,{to:"/settings",icon:settingsIcon,label:"Settings"})]})}),apiLogout=()=>{localStorage.removeItem("token"),localStorage.removeItem("user")},apiLoginWithGoogleCredential=async()=>{if(window.Capacitor&&window.Capacitor.isNativePlatform())try{const{GoogleAuth:e}=await __vitePreload(async()=>{const{GoogleAuth:d}=await import("./index-DKmFobsG.js");return{GoogleAuth:d}},[]);await e.initialize({clientId:void 0,scopes:["profile","email"],grantOfflineAccess:!0});const i=await e.signIn();return{id:`google-${i.id}`,fullName:i.name,email:i.email,phone:"",city:"",avatarUrl:i.imageUrl||`https://ui-avatars.com/api/?name=${encodeURIComponent(i.name)}&background=random`,vehicles:[]}}catch(e){return console.error("Mobile Google Auth error:",e),{id:`google-${Date.now()}`,fullName:"Google User (Mobile)",email:"mobile.user@gmail.com",phone:"",city:"",avatarUrl:"https://ui-avatars.com/api/?name=Google+User&background=random",vehicles:[]}}return new Promise((e,i)=>{if(typeof window.google>"u"){i(new Error("Google SDK not loaded"));return}window.google.accounts.id.initialize({client_id:"",callback:d=>{try{const j=JSON.parse(atob(d.credential.split(".")[1])),_e={id:`google-${j.sub}`,fullName:j.name||"Google User",email:j.email,phone:"",city:"",avatarUrl:j.picture||`https://ui-avatars.com/api/?name=${encodeURIComponent(j.name||"User")}&background=random`,vehicles:[]};e(_e)}catch(j){i(j)}}}),window.google.accounts.id.prompt()})},queryClient=new QueryClient,AppNavigator=()=>{console.log(" AppNavigator component rendering");const{isAuthenticated:e,user:i}=useAppContext(),d=useNavigate(),j=useLocation();reactExports.useEffect(()=>{console.log(" AppNavigator useEffect triggered"),console.log("Current path:",j.pathname),console.log("isAuthenticated:",e),console.log("Browser history length:",window.history.length),console.log("redirectAfterLogin:",localStorage.getItem("redirectAfterLogin"));const nt=["/","/login","/login-form","/register","/forgot-password","/password-reset-success"],ct=j.pathname,pt=["/home","/station/","/fuel-friend/","/checkout","/order-summary","/payment","/track","/orders","/notifications","/settings","/profile","/chat"].some(gt=>ct===gt||ct.startsWith(gt));console.log("publicRoutes.includes(currentPath):",nt.includes(ct)),console.log("isExemptRoute:",pt),e&&nt.includes(ct)&&!pt&&ct!=="/"&&ct!=="/register"?(console.log(" Redirecting authenticated user to home from:",ct),d("/home")):!e&&!nt.includes(ct)&&!pt&&["/home","/my-orders","/settings","/profile","/orders","/track","/notifications","/checkout","/payment"].some(St=>ct===St||ct.startsWith(St))&&(localStorage.setItem("redirectAfterLogin",ct),d("/login"))},[e,d,j.pathname]);const _e=e&&(["/home","/orders","/track","/settings"].includes(j.pathname)||j.pathname.startsWith("/track/"));return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs(Routes,{children:[jsxRuntimeExports.jsx(Route,{path:"/",element:jsxRuntimeExports.jsx(SplashScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/login",element:jsxRuntimeExports.jsx(LoginScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/login-form",element:jsxRuntimeExports.jsx(LoginFormScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/forgot-password",element:jsxRuntimeExports.jsx(ForgotPasswordScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/password-reset-success",element:jsxRuntimeExports.jsx(PasswordResetSuccess,{})}),jsxRuntimeExports.jsx(Route,{path:"/register",element:jsxRuntimeExports.jsx(RegistrationScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/home",element:jsxRuntimeExports.jsx(HomeScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/station/:id",element:jsxRuntimeExports.jsx(StationDetailsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/station/:id/reviews",element:jsxRuntimeExports.jsx(StationReviewsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/fuel-friend/:id",element:jsxRuntimeExports.jsx(FuelFriendDetailsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/checkout",element:jsxRuntimeExports.jsx(CheckoutScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/order-summary",element:jsxRuntimeExports.jsx(OrderSummaryScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/payment",element:jsxRuntimeExports.jsx(PaymentScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/track",element:jsxRuntimeExports.jsx(TrackOrderScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/track/:orderId",element:jsxRuntimeExports.jsx(TrackOrderScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/orders",element:jsxRuntimeExports.jsx(MyOrdersScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/notifications",element:jsxRuntimeExports.jsx(NotificationsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/settings",element:jsxRuntimeExports.jsx(SettingsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/manage-password",element:jsxRuntimeExports.jsx(ManagePasswordScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/theme",element:jsxRuntimeExports.jsx(ThemeScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/payment-methods",element:jsxRuntimeExports.jsx(PaymentMethodsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/fuel-efficiency",element:jsxRuntimeExports.jsx(FuelEfficiencyCalculatorScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/notification-settings",element:jsxRuntimeExports.jsx(NotificationSettingsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/support-help",element:jsxRuntimeExports.jsx(SupportHelpScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/live-chat",element:jsxRuntimeExports.jsx(LiveChatSupportScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/report-issue",element:jsxRuntimeExports.jsx(ReportIssueScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/report-submitted",element:jsxRuntimeExports.jsx(ReportSubmittedSuccessScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/terms-conditions",element:jsxRuntimeExports.jsx(TermsConditionsScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/privacy-policy",element:jsxRuntimeExports.jsx(PrivacyPolicyScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/account-deletion",element:jsxRuntimeExports.jsx(AccountDeletionScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/account-deleted",element:jsxRuntimeExports.jsx(AccountDeletedSuccessScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/profile",element:jsxRuntimeExports.jsx(ProfileScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/chat",element:jsxRuntimeExports.jsx(ChatScreen,{})}),jsxRuntimeExports.jsx(Route,{path:"/receipts",element:jsxRuntimeExports.jsx(ReceiptsScreen,{})})]}),_e&&jsxRuntimeExports.jsx(BottomNav,{})]})},App=()=>{console.log(" App component rendering");const[e,i]=reactExports.useState(Theme.LIGHT),[d,j]=reactExports.useState(!1),[_e,nt]=reactExports.useState(null),[ct,c]=reactExports.useState(null);reactExports.useEffect(()=>{const Nt=localStorage.getItem("token");if(Nt){if(console.log(" Found stored token:",Nt),console.log("Current pathname:",window.location.pathname),window.location.pathname==="/register"){console.log(" Skipping token validation during registration");return}c(Nt),(async()=>{try{console.log(" Validating token with backend...");const Jt=await apiGetMe();console.log(" Token valid, user data:",Jt),nt(Jt),window.location.pathname.includes("/register")||j(!0)}catch(Jt){console.error(" Token validation failed:",Jt),localStorage.removeItem("token"),localStorage.removeItem("user"),c(null),nt(null),j(!1)}})()}else console.log(" No token found in localStorage");const Vt=localStorage.getItem("theme");if(console.log("Saved theme from localStorage:",Vt),Vt){const zt=Vt;i(zt),zt===Theme.DARK?document.documentElement.classList.add("dark"):zt===Theme.LIGHT?document.documentElement.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),console.log("Applied saved theme:",zt)}else i(Theme.LIGHT),document.documentElement.classList.remove("dark"),console.log("No saved theme, defaulted to LIGHT")},[]),reactExports.useEffect(()=>{const Nt=window.document.documentElement;e===Theme.DARK?Nt.classList.add("dark"):e===Theme.LIGHT?Nt.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?Nt.classList.add("dark"):Nt.classList.remove("dark")},[e]);const pt=Nt=>{console.log("Setting theme to:",Nt),i(Nt),localStorage.setItem("theme",Nt);const Vt=window.document.documentElement;Nt===Theme.DARK?Vt.classList.add("dark"):Nt===Theme.LIGHT?Vt.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?Vt.classList.add("dark"):Vt.classList.remove("dark")},gt=async(Nt,Vt)=>{const zt={id:`user-${Date.now()}`,fullName:Nt.split("@")[0],email:Nt,phone:"+1234567890",city:"New York",avatarUrl:`https://ui-avatars.com/api/?name=${encodeURIComponent(Nt.split("@")[0])}&background=random`,vehicles:[{id:`vehicle-${Date.now()}`,brand:"Toyota",color:"Blue",licenseNumber:"ABC123",fuelType:"Petrol"}]};nt(zt),j(!0);const Jt=`mock_token_${Date.now()}`;c(Jt),localStorage.setItem("token",Jt),localStorage.setItem("user",JSON.stringify(zt));try{const{pushNotificationService:Dt}=await __vitePreload(async()=>{const{pushNotificationService:It}=await import("./pushNotification-DZy721SZ.js");return{pushNotificationService:It}},[]);await Dt.initializePushNotifications(zt.id)}catch(Dt){console.log("Push notification setup failed:",Dt)}},St=async()=>{try{if(typeof window.google>"u"){const zt={id:`user-${Date.now()}`,fullName:"Google User",email:"google.user@example.com",phone:"",city:"London",avatarUrl:"https://ui-avatars.com/api/?name=Google+User&background=random",vehicles:[]};nt(zt),j(!0),localStorage.setItem("user",JSON.stringify(zt)),localStorage.setItem("token",`mock_token_${Date.now()}`);return}const Nt=await apiLoginWithGoogleCredential();nt(Nt),j(!0);const Vt=Nt.token||`mock_token_${Date.now()}`;c(Vt),localStorage.setItem("token",Vt),localStorage.setItem("user",JSON.stringify(Nt))}catch(Nt){console.error("Google login error:",Nt);const Vt={id:`user-${Date.now()}`,fullName:"Google User",email:"google.user@example.com",phone:"",city:"London",avatarUrl:"https://ui-avatars.com/api/?name=Google+User&background=random",vehicles:[]};nt(Vt),j(!0);const zt=`mock_token_${Date.now()}`;c(zt),localStorage.setItem("user",JSON.stringify(Vt)),localStorage.setItem("token",zt)}},kt=async()=>{try{apiLogout(),nt(null),j(!1),c(null),localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("redirectAfterLogin")}catch(Nt){console.error("Error signing out:",Nt)}},At=Nt=>{nt(Nt),Nt&&(window.location.pathname.includes("/register")||j(!0),localStorage.setItem("user",JSON.stringify(Nt)))};return jsxRuntimeExports.jsx(ErrorBoundary,{children:jsxRuntimeExports.jsx(QueryClientProvider,{client:queryClient,children:jsxRuntimeExports.jsx(AppContext.Provider,{value:{theme:e,setTheme:pt,isAuthenticated:d,user:_e,token:ct,login:gt,loginWithGoogle:St,logout:kt,updateUser:At},children:jsxRuntimeExports.jsxs("div",{className:"w-full h-full font-sans bg-white dark:bg-black text-gray-900 dark:text-white transition-colors duration-200",style:{height:"100dvh",maxHeight:"100dvh",maxWidth:"100vw",fontFamily:"Poppins, Inter, -apple-system, BlinkMacSystemFont, Segoe UI, sans-serif"},children:[jsxRuntimeExports.jsx($e,{position:"top-center",toastOptions:{className:"ios-toast",style:{background:"rgba(255, 255, 255, 0.9)",color:"#000000",border:"none",borderRadius:"25px",fontSize:"15px",fontWeight:"500",padding:"12px 24px",backdropFilter:"blur(12px)",boxShadow:"0 8px 30px rgba(0, 0, 0, 0.12)",width:"auto",minWidth:"300px",marginBottom:"16px"},duration:3e3}}),jsxRuntimeExports.jsx(BrowserRouter,{children:jsxRuntimeExports.jsx(AppNavigator,{})})]})})})})};/*! Capacitor: https://capacitorjs.com/ - MIT License */const createCapacitorPlatforms=e=>{const i=new Map;i.set("web",{name:"web"});const d=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:i},j=(nt,ct)=>{d.platforms.set(nt,ct)},_e=nt=>{d.platforms.has(nt)&&(d.currentPlatform=d.platforms.get(nt))};return d.addPlatform=j,d.setPlatform=_e,d},initPlatforms=e=>e.CapacitorPlatforms=createCapacitorPlatforms(e),CapacitorPlatforms=initPlatforms(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});CapacitorPlatforms.addPlatform;CapacitorPlatforms.setPlatform;var ExceptionCode;(function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={}));class CapacitorException extends Error{constructor(i,d,j){super(i),this.message=i,this.code=d,this.data=j}}const getPlatformId=e=>{var i,d;return e!=null&&e.androidBridge?"android":!((d=(i=e==null?void 0:e.webkit)===null||i===void 0?void 0:i.messageHandlers)===null||d===void 0)&&d.bridge?"ios":"web"},createCapacitor=e=>{var i,d,j,_e,nt;const ct=e.CapacitorCustomPlatform||null,c=e.Capacitor||{},pt=c.Plugins=c.Plugins||{},gt=e.CapacitorPlatforms,St=()=>ct!==null?ct.name:getPlatformId(e),kt=((i=gt==null?void 0:gt.currentPlatform)===null||i===void 0?void 0:i.getPlatform)||St,At=()=>kt()!=="web",Nt=((d=gt==null?void 0:gt.currentPlatform)===null||d===void 0?void 0:d.isNativePlatform)||At,Vt=dr=>{const mr=Ht.get(dr);return!!(mr!=null&&mr.platforms.has(kt())||Dt(dr))},zt=((j=gt==null?void 0:gt.currentPlatform)===null||j===void 0?void 0:j.isPluginAvailable)||Vt,Jt=dr=>{var mr;return(mr=c.PluginHeaders)===null||mr===void 0?void 0:mr.find(Ur=>Ur.name===dr)},Dt=((_e=gt==null?void 0:gt.currentPlatform)===null||_e===void 0?void 0:_e.getPluginHeader)||Jt,It=dr=>e.console.error(dr),Mt=(dr,mr,Ur)=>Promise.reject(`${Ur} does not have an implementation of "${mr}".`),Ht=new Map,tr=(dr,mr={})=>{const Ur=Ht.get(dr);if(Ur)return console.warn(`Capacitor plugin "${dr}" already registered. Cannot register plugins twice.`),Ur.proxy;const Dr=kt(),Yr=Dt(dr);let es;const ms=async()=>(!es&&Dr in mr?es=typeof mr[Dr]=="function"?es=await mr[Dr]():es=mr[Dr]:ct!==null&&!es&&"web"in mr&&(es=typeof mr.web=="function"?es=await mr.web():es=mr.web),es),Ms=($r,Ar)=>{var Xr,us;if(Yr){const Wr=Yr==null?void 0:Yr.methods.find(Vs=>Ar===Vs.name);if(Wr)return Wr.rtype==="promise"?Vs=>c.nativePromise(dr,Ar.toString(),Vs):(Vs,yn)=>c.nativeCallback(dr,Ar.toString(),Vs,yn);if($r)return(Xr=$r[Ar])===null||Xr===void 0?void 0:Xr.bind($r)}else{if($r)return(us=$r[Ar])===null||us===void 0?void 0:us.bind($r);throw new CapacitorException(`"${dr}" plugin is not implemented on ${Dr}`,ExceptionCode.Unimplemented)}},Kr=$r=>{let Ar;const Xr=(...us)=>{const Wr=ms().then(Vs=>{const yn=Ms(Vs,$r);if(yn){const _n=yn(...us);return Ar=_n==null?void 0:_n.remove,_n}else throw new CapacitorException(`"${dr}.${$r}()" is not implemented on ${Dr}`,ExceptionCode.Unimplemented)});return $r==="addListener"&&(Wr.remove=async()=>Ar()),Wr};return Xr.toString=()=>`${$r.toString()}() { [capacitor code] }`,Object.defineProperty(Xr,"name",{value:$r,writable:!1,configurable:!1}),Xr},xr=Kr("addListener"),jr=Kr("removeListener"),rr=($r,Ar)=>{const Xr=xr({eventName:$r},Ar),us=async()=>{const Vs=await Xr;jr({eventName:$r,callbackId:Vs},Ar)},Wr=new Promise(Vs=>Xr.then(()=>Vs({remove:us})));return Wr.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await us()},Wr},ar=new Proxy({},{get($r,Ar){switch(Ar){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return Yr?rr:xr;case"removeListener":return jr;default:return Kr(Ar)}}});return pt[dr]=ar,Ht.set(dr,{name:dr,proxy:ar,platforms:new Set([...Object.keys(mr),...Yr?[Dr]:[]])}),ar},er=((nt=gt==null?void 0:gt.currentPlatform)===null||nt===void 0?void 0:nt.registerPlugin)||tr;return c.convertFileSrc||(c.convertFileSrc=dr=>dr),c.getPlatform=kt,c.handleError=It,c.isNativePlatform=Nt,c.isPluginAvailable=zt,c.pluginMethodNoop=Mt,c.registerPlugin=er,c.Exception=CapacitorException,c.DEBUG=!!c.DEBUG,c.isLoggingEnabled=!!c.isLoggingEnabled,c.platform=c.getPlatform(),c.isNative=c.isNativePlatform(),c},initCapacitorGlobal=e=>e.Capacitor=createCapacitor(e),Capacitor=initCapacitorGlobal(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),registerPlugin=Capacitor.registerPlugin;Capacitor.Plugins;class WebPlugin{constructor(i){this.listeners={},this.retainedEventArguments={},this.windowListeners={},i&&(console.warn(`Capacitor WebPlugin "${i.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=i)}addListener(i,d){let j=!1;this.listeners[i]||(this.listeners[i]=[],j=!0),this.listeners[i].push(d);const nt=this.windowListeners[i];nt&&!nt.registered&&this.addWindowListener(nt),j&&this.sendRetainedArgumentsForEvent(i);const ct=async()=>this.removeListener(i,d);return Promise.resolve({remove:ct})}async removeAllListeners(){this.listeners={};for(const i in this.windowListeners)this.removeWindowListener(this.windowListeners[i]);this.windowListeners={}}notifyListeners(i,d,j){const _e=this.listeners[i];if(!_e){if(j){let nt=this.retainedEventArguments[i];nt||(nt=[]),nt.push(d),this.retainedEventArguments[i]=nt}return}_e.forEach(nt=>nt(d))}hasListeners(i){return!!this.listeners[i].length}registerWindowListener(i,d){this.windowListeners[d]={registered:!1,windowEventName:i,pluginEventName:d,handler:j=>{this.notifyListeners(d,j)}}}unimplemented(i="not implemented"){return new Capacitor.Exception(i,ExceptionCode.Unimplemented)}unavailable(i="not available"){return new Capacitor.Exception(i,ExceptionCode.Unavailable)}async removeListener(i,d){const j=this.listeners[i];if(!j)return;const _e=j.indexOf(d);this.listeners[i].splice(_e,1),this.listeners[i].length||this.removeWindowListener(this.windowListeners[i])}addWindowListener(i){window.addEventListener(i.windowEventName,i.handler),i.registered=!0}removeWindowListener(i){i&&(window.removeEventListener(i.windowEventName,i.handler),i.registered=!1)}sendRetainedArgumentsForEvent(i){const d=this.retainedEventArguments[i];d&&(delete this.retainedEventArguments[i],d.forEach(j=>{this.notifyListeners(i,j)}))}}const encode=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),decode=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class CapacitorCookiesPluginWeb extends WebPlugin{async getCookies(){const i=document.cookie,d={};return i.split(";").forEach(j=>{if(j.length<=0)return;let[_e,nt]=j.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");_e=decode(_e).trim(),nt=decode(nt).trim(),d[_e]=nt}),d}async setCookie(i){try{const d=encode(i.key),j=encode(i.value),_e=`; expires=${(i.expires||"").replace("expires=","")}`,nt=(i.path||"/").replace("path=",""),ct=i.url!=null&&i.url.length>0?`domain=${i.url}`:"";document.cookie=`${d}=${j||""}${_e}; path=${nt}; ${ct};`}catch(d){return Promise.reject(d)}}async deleteCookie(i){try{document.cookie=`${i.key}=; Max-Age=0`}catch(d){return Promise.reject(d)}}async clearCookies(){try{const i=document.cookie.split(";")||[];for(const d of i)document.cookie=d.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(i){return Promise.reject(i)}}async clearAllCookies(){try{await this.clearCookies()}catch(i){return Promise.reject(i)}}}registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});const readBlobAsBase64=async e=>new Promise((i,d)=>{const j=new FileReader;j.onload=()=>{const _e=j.result;i(_e.indexOf(",")>=0?_e.split(",")[1]:_e)},j.onerror=_e=>d(_e),j.readAsDataURL(e)}),normalizeHttpHeaders=(e={})=>{const i=Object.keys(e);return Object.keys(e).map(_e=>_e.toLocaleLowerCase()).reduce((_e,nt,ct)=>(_e[nt]=e[i[ct]],_e),{})},buildUrlParams=(e,i=!0)=>e?Object.entries(e).reduce((j,_e)=>{const[nt,ct]=_e;let c,pt;return Array.isArray(ct)?(pt="",ct.forEach(gt=>{c=i?encodeURIComponent(gt):gt,pt+=`${nt}=${c}&`}),pt.slice(0,-1)):(c=i?encodeURIComponent(ct):ct,pt=`${nt}=${c}`),`${j}&${pt}`},"").substr(1):null,buildRequestInit=(e,i={})=>{const d=Object.assign({method:e.method||"GET",headers:e.headers},i),_e=normalizeHttpHeaders(e.headers)["content-type"]||"";if(typeof e.data=="string")d.body=e.data;else if(_e.includes("application/x-www-form-urlencoded")){const nt=new URLSearchParams;for(const[ct,c]of Object.entries(e.data||{}))nt.set(ct,c);d.body=nt.toString()}else if(_e.includes("multipart/form-data")||e.data instanceof FormData){const nt=new FormData;if(e.data instanceof FormData)e.data.forEach((c,pt)=>{nt.append(pt,c)});else for(const c of Object.keys(e.data))nt.append(c,e.data[c]);d.body=nt;const ct=new Headers(d.headers);ct.delete("content-type"),d.headers=ct}else(_e.includes("application/json")||typeof e.data=="object")&&(d.body=JSON.stringify(e.data));return d};class CapacitorHttpPluginWeb extends WebPlugin{async request(i){const d=buildRequestInit(i,i.webFetchExtra),j=buildUrlParams(i.params,i.shouldEncodeUrlParams),_e=j?`${i.url}?${j}`:i.url,nt=await fetch(_e,d),ct=nt.headers.get("content-type")||"";let{responseType:c="text"}=nt.ok?i:{};ct.includes("application/json")&&(c="json");let pt,gt;switch(c){case"arraybuffer":case"blob":gt=await nt.blob(),pt=await readBlobAsBase64(gt);break;case"json":pt=await nt.json();break;case"document":case"text":default:pt=await nt.text()}const St={};return nt.headers.forEach((kt,At)=>{St[At]=kt}),{data:pt,headers:St,status:nt.status,url:nt.url}}async get(i){return this.request(Object.assign(Object.assign({},i),{method:"GET"}))}async post(i){return this.request(Object.assign(Object.assign({},i),{method:"POST"}))}async put(i){return this.request(Object.assign(Object.assign({},i),{method:"PUT"}))}async patch(i){return this.request(Object.assign(Object.assign({},i),{method:"PATCH"}))}async delete(i){return this.request(Object.assign(Object.assign({},i),{method:"DELETE"}))}}registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb});const showUpdateNotification=()=>{var i,d;const e=document.createElement("div");e.className=`
    fixed top-4 left-1/2 transform -translate-x-1/2 z-[99999]
    bg-white border border-blue-200 rounded-lg p-4 shadow-xl
    animate-fade-in-down
  `,e.innerHTML=`
    <div class="flex items-start gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-blue-500 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <div class="flex-1">
        <p class="font-medium text-blue-800">New version available!</p>
        <p class="text-sm text-blue-600 mt-1">Refresh to update the app</p>
        <div class="flex gap-2 mt-3">
          <button id="update-dismiss" class="text-sm text-gray-500 hover:text-gray-700 px-3 py-1">
            Dismiss
          </button>
          <button id="update-refresh" class="text-sm bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600">
            Refresh Now
          </button>
        </div>
      </div>
    </div>
  `,document.body.appendChild(e),(i=document.getElementById("update-dismiss"))==null||i.addEventListener("click",()=>{e.remove()}),(d=document.getElementById("update-refresh"))==null||d.addEventListener("click",()=>{window.location.reload()}),setTimeout(()=>{e.parentNode&&e.remove()},1e4)};"serviceWorker"in navigator&&!Capacitor.isNativePlatform()&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(e=>{console.log("SW registered: ",e),e.addEventListener("updatefound",()=>{const i=e.installing;i&&i.addEventListener("statechange",()=>{i.state==="installed"&&navigator.serviceWorker.controller&&showUpdateNotification()})})}).catch(e=>{console.log("SW registration failed: ",e)})});const testImages=["/fuel friend.png","/tulisan.svg","/logo-white.png","/mobil hijau.png"];testImages.forEach(e=>{const i=new Image;i.onload=()=>console.log(` Loaded: ${e}`),i.onerror=()=>console.log(` Failed to load: ${e}`),i.src=e});const rootElement=document.getElementById("root");if(!rootElement)throw new Error("Could not find root element to mount to");const root=client.createRoot(rootElement);root.render(jsxRuntimeExports.jsx(App,{}));export{WebPlugin as W,__vitePreload as _,apiRegisterFCMToken as a,registerPlugin as r};
